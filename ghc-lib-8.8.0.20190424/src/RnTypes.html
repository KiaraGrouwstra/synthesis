<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[RnSource]{Main pass of renamer}
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RnTypes</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>        </span><span class="hs-comment">-- Type related stuff</span><span>
</span><a name="line-14"></a><span>        </span><a href="RnTypes.html#rnHsType"><span class="hs-identifier hs-var">rnHsType</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnLHsTypes"><span class="hs-identifier hs-var">rnLHsTypes</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnContext"><span class="hs-identifier hs-var">rnContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="RnTypes.html#rnHsKind"><span class="hs-identifier hs-var">rnHsKind</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnLHsKind"><span class="hs-identifier hs-var">rnLHsKind</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnLHsTypeArgs"><span class="hs-identifier hs-var">rnLHsTypeArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnHsWcType"><span class="hs-identifier hs-var">rnHsWcType</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="RnTypes.html#HsSigWcTypeScoping"><span class="hs-identifier hs-type">HsSigWcTypeScoping</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnHsSigWcType"><span class="hs-identifier hs-var">rnHsSigWcType</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnHsSigWcTypeScoped"><span class="hs-identifier hs-var">rnHsSigWcTypeScoped</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="RnTypes.html#newTyVarNameRn"><span class="hs-identifier hs-var">newTyVarNameRn</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="RnTypes.html#rnConDeclFields"><span class="hs-identifier hs-var">rnConDeclFields</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier hs-var">rnLTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>        </span><span class="hs-comment">-- Precence related stuff</span><span>
</span><a name="line-23"></a><span>        </span><a href="RnTypes.html#mkOpAppRn"><span class="hs-identifier hs-var">mkOpAppRn</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#mkNegAppRn"><span class="hs-identifier hs-var">mkNegAppRn</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#mkOpFormRn"><span class="hs-identifier hs-var">mkOpFormRn</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#mkConOpPatRn"><span class="hs-identifier hs-var">mkConOpPatRn</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="RnTypes.html#checkPrecMatch"><span class="hs-identifier hs-var">checkPrecMatch</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#checkSectionPrec"><span class="hs-identifier hs-var">checkSectionPrec</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>        </span><span class="hs-comment">-- Binding related stuff</span><span>
</span><a name="line-27"></a><span>        </span><a href="RnTypes.html#bindLHsTyVarBndr"><span class="hs-identifier hs-var">bindLHsTyVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#bindLHsTyVarBndrs"><span class="hs-identifier hs-var">bindLHsTyVarBndrs</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rnImplicitBndrs"><span class="hs-identifier hs-var">rnImplicitBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="RnTypes.html#bindSigTyVarsFV"><span class="hs-identifier hs-var">bindSigTyVarsFV</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier hs-var">bindHsQTyVars</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#bindLRdrNames"><span class="hs-identifier hs-var">bindLRdrNames</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="RnTypes.html#extractFilteredRdrTyVars"><span class="hs-identifier hs-var">extractFilteredRdrTyVars</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#extractFilteredRdrTyVarsDups"><span class="hs-identifier hs-var">extractFilteredRdrTyVarsDups</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="RnTypes.html#extractHsTyRdrTyVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVars</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#extractHsTyRdrTyVarsKindVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVarsKindVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="RnTypes.html#extractHsTyRdrTyVarsDups"><span class="hs-identifier hs-var">extractHsTyRdrTyVarsDups</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#extractHsTysRdrTyVars"><span class="hs-identifier hs-var">extractHsTysRdrTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="RnTypes.html#extractHsTysRdrTyVarsDups"><span class="hs-identifier hs-var">extractHsTysRdrTyVarsDups</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#rmDupsInRdrTyVars"><span class="hs-identifier hs-var">rmDupsInRdrTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="RnTypes.html#extractRdrKindSigVars"><span class="hs-identifier hs-var">extractRdrKindSigVars</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#extractDataDefnKindVars"><span class="hs-identifier hs-var">extractDataDefnKindVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="RnTypes.html#extractHsTvBndrs"><span class="hs-identifier hs-var">extractHsTvBndrs</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#extractHsTyArgRdrKiTyVarsDup"><span class="hs-identifier hs-var">extractHsTyArgRdrKiTyVarsDup</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="RnTypes.html#freeKiTyVarsAllVars"><span class="hs-identifier hs-var">freeKiTyVarsAllVars</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier hs-var">freeKiTyVarsKindVars</span></a><span class="hs-special">,</span><span> </span><a href="RnTypes.html#freeKiTyVarsTypeVars"><span class="hs-identifier hs-var">freeKiTyVarsTypeVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="RnTypes.html#elemRdr"><span class="hs-identifier hs-var">elemRdr</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="RnSplice.html"><span class="hs-identifier">RnSplice</span></a><span class="hs-special">(</span><span> </span><a href="RnSplice.html#rnSpliceType"><span class="hs-identifier hs-var">rnSpliceType</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsSyn</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="RnHsDoc.html"><span class="hs-identifier">RnHsDoc</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="RnHsDoc.html#rnLHsDoc"><span class="hs-identifier hs-var">rnLHsDoc</span></a><span class="hs-special">,</span><span> </span><a href="RnHsDoc.html#rnMbLHsDoc"><span class="hs-identifier hs-var">rnMbLHsDoc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="RnEnv.html"><span class="hs-identifier">RnEnv</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="RnUtils.html"><span class="hs-identifier">RnUtils</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#withHsDocContext"><span class="hs-identifier hs-var">withHsDocContext</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span>
</span><a name="line-48"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#pprHsDocContext"><span class="hs-identifier hs-var">pprHsDocContext</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#typeAppErr"><span class="hs-identifier hs-var">typeAppErr</span></a><span>
</span><a name="line-49"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkShadowedRdrNames"><span class="hs-identifier hs-var">checkShadowedRdrNames</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="RnFixity.html"><span class="hs-identifier">RnFixity</span></a><span>         </span><span class="hs-special">(</span><span> </span><a href="RnFixity.html#lookupFieldFixityRn"><span class="hs-identifier hs-var">lookupFieldFixityRn</span></a><span class="hs-special">,</span><span> </span><a href="RnFixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span>
</span><a name="line-51"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="RnFixity.html#lookupTyFixityRn"><span class="hs-identifier hs-var">lookupTyFixityRn</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">RdrName</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrelNames</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysPrim</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">funTyConName</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">NameSet</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FieldLabel</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ListSetOps</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">deleteBys</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">compareFixity</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">funTyFixity</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">negateFixity</span><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>                          </span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FixityDirection</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LexicalFixity</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Maybes</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.LanguageExtensions</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">nubBy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">partition</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">\\</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">unless</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-75"></a><span class="hs-comment">{-
These type renamers are in a separate module, rather than in (say) RnSource,
to break several loop.

*********************************************************
*                                                       *
           HsSigWcType (i.e with wildcards)
*                                                       *
*********************************************************
-}</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-keyword">data</span><span> </span><a name="HsSigWcTypeScoping"><a href="RnTypes.html#HsSigWcTypeScoping"><span class="hs-identifier">HsSigWcTypeScoping</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="AlwaysBind"><a href="RnTypes.html#AlwaysBind"><span class="hs-identifier">AlwaysBind</span></a></a><span>
</span><a name="line-87"></a><span>                          </span><span class="hs-comment">-- ^ Always bind any free tyvars of the given type,</span><span>
</span><a name="line-88"></a><span>                          </span><span class="hs-comment">--   regardless of whether we have a forall at the top</span><span>
</span><a name="line-89"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="BindUnlessForall"><a href="RnTypes.html#BindUnlessForall"><span class="hs-identifier">BindUnlessForall</span></a></a><span>
</span><a name="line-90"></a><span>                          </span><span class="hs-comment">-- ^ Unless there's forall at the top, do the same</span><span>
</span><a name="line-91"></a><span>                          </span><span class="hs-comment">--   thing as 'AlwaysBind'</span><span>
</span><a name="line-92"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="NeverBind"><a href="RnTypes.html#NeverBind"><span class="hs-identifier">NeverBind</span></a></a><span>
</span><a name="line-93"></a><span>                          </span><span class="hs-comment">-- ^ Never bind any free tyvars</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-identifier">rnHsSigWcType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#HsSigWcTypeScoping"><span class="hs-identifier hs-type">HsSigWcTypeScoping</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-96"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><a name="rnHsSigWcType"><a href="RnTypes.html#rnHsSigWcType"><span class="hs-identifier">rnHsSigWcType</span></a></a><span> </span><a name="local-6989586621682098480"><a href="#local-6989586621682098480"><span class="hs-identifier">scoping</span></a></a><span> </span><a name="local-6989586621682098481"><a href="#local-6989586621682098481"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621682098482"><a href="#local-6989586621682098482"><span class="hs-identifier">sig_ty</span></a></a><span>
</span><a name="line-98"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rn_hs_sig_wc_type"><span class="hs-identifier hs-var">rn_hs_sig_wc_type</span></a><span> </span><a href="#local-6989586621682098480"><span class="hs-identifier hs-var">scoping</span></a><span> </span><a href="#local-6989586621682098481"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621682098482"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682098483"><a href="#local-6989586621682098483"><span class="hs-identifier">sig_ty'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098483"><span class="hs-identifier hs-var">sig_ty'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-identifier">rnHsSigWcTypeScoped</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#HsSigWcTypeScoping"><span class="hs-identifier hs-type">HsSigWcTypeScoping</span></a><span>
</span><a name="line-102"></a><span>                       </span><span class="hs-comment">-- AlwaysBind: for pattern type sigs and rules we /do/ want</span><span>
</span><a name="line-103"></a><span>                       </span><span class="hs-comment">--             to bring those type variables into scope, even</span><span>
</span><a name="line-104"></a><span>                       </span><span class="hs-comment">--             if there's a forall at the top which usually</span><span>
</span><a name="line-105"></a><span>                       </span><span class="hs-comment">--             stops that happening</span><span>
</span><a name="line-106"></a><span>                       </span><span class="hs-comment">-- e.g  \ (x :: forall a. a-&gt; b) -&gt; e</span><span>
</span><a name="line-107"></a><span>                       </span><span class="hs-comment">-- Here we do bring 'b' into scope</span><span>
</span><a name="line-108"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-109"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098479"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098479"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- Used for</span><span>
</span><a name="line-112"></a><span class="hs-comment">--   - Signatures on binders in a RULE</span><span>
</span><a name="line-113"></a><span class="hs-comment">--   - Pattern type signatures</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- Wildcards are allowed</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- type signatures on binders only allowed with ScopedTypeVariables</span><span>
</span><a name="line-116"></a><a name="rnHsSigWcTypeScoped"><a href="RnTypes.html#rnHsSigWcTypeScoped"><span class="hs-identifier">rnHsSigWcTypeScoped</span></a></a><span> </span><a name="local-6989586621682098484"><a href="#local-6989586621682098484"><span class="hs-identifier">scoping</span></a></a><span> </span><a name="local-6989586621682098485"><a href="#local-6989586621682098485"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621682098486"><a href="#local-6989586621682098486"><span class="hs-identifier">sig_ty</span></a></a><span> </span><a name="local-6989586621682098487"><a href="#local-6989586621682098487"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-117"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098488"><a href="#local-6989586621682098488"><span class="hs-identifier">ty_sig_okay</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.ScopedTypeVariables</span><span>
</span><a name="line-118"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkErr"><span class="hs-identifier hs-var">checkErr</span></a><span> </span><a href="#local-6989586621682098488"><span class="hs-identifier hs-var">ty_sig_okay</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#unexpectedTypeSigErr"><span class="hs-identifier hs-var">unexpectedTypeSigErr</span></a><span> </span><a href="#local-6989586621682098486"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#rn_hs_sig_wc_type"><span class="hs-identifier hs-var">rn_hs_sig_wc_type</span></a><span> </span><a href="#local-6989586621682098484"><span class="hs-identifier hs-var">scoping</span></a><span> </span><a href="#local-6989586621682098485"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621682098486"><span class="hs-identifier hs-var">sig_ty</span></a><span> </span><a href="#local-6989586621682098487"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-120"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-identifier">rn_hs_sig_wc_type</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#HsSigWcTypeScoping"><span class="hs-identifier hs-type">HsSigWcTypeScoping</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-123"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098478"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098478"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- rn_hs_sig_wc_type is used for source-language type signatures</span><span>
</span><a name="line-126"></a><a name="rn_hs_sig_wc_type"><a href="RnTypes.html#rn_hs_sig_wc_type"><span class="hs-identifier">rn_hs_sig_wc_type</span></a></a><span> </span><a name="local-6989586621682098489"><a href="#local-6989586621682098489"><span class="hs-identifier">scoping</span></a></a><span> </span><a name="local-6989586621682098490"><a href="#local-6989586621682098490"><span class="hs-identifier">ctxt</span></a></a><span>
</span><a name="line-127"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWC</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsIB</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098491"><a href="#local-6989586621682098491"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>                  </span><a name="local-6989586621682098492"><a href="#local-6989586621682098492"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-129"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098493"><a href="#local-6989586621682098493"><span class="hs-identifier">free_vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractFilteredRdrTyVarsDups"><span class="hs-identifier hs-var">extractFilteredRdrTyVarsDups</span></a><span> </span><a href="#local-6989586621682098491"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-130"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098494"><a href="#local-6989586621682098494"><span class="hs-identifier">tv_rdrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098495"><a href="#local-6989586621682098495"><span class="hs-identifier">nwc_rdrs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#partition_nwcs"><span class="hs-identifier hs-var">partition_nwcs</span></a><span> </span><a href="#local-6989586621682098493"><span class="hs-identifier hs-var">free_vars</span></a><span>
</span><a name="line-131"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098496"><a href="#local-6989586621682098496"><span class="hs-identifier">nwc_rdrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#nubL"><span class="hs-identifier hs-var">nubL</span></a><span> </span><a href="#local-6989586621682098495"><span class="hs-identifier hs-var">nwc_rdrs'</span></a><span>
</span><a name="line-132"></a><span>             </span><a name="local-6989586621682098497"><a href="#local-6989586621682098497"><span class="hs-identifier">bind_free_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682098489"><span class="hs-identifier hs-var">scoping</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-133"></a><span>                               </span><a href="RnTypes.html#AlwaysBind"><span class="hs-identifier hs-var">AlwaysBind</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-134"></a><span>                               </span><a href="RnTypes.html#BindUnlessForall"><span class="hs-identifier hs-var">BindUnlessForall</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isLHsForAllTy</span><span> </span><a href="#local-6989586621682098491"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>                               </span><a href="RnTypes.html#NeverBind"><span class="hs-identifier hs-var">NeverBind</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-136"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#rnImplicitBndrs"><span class="hs-identifier hs-var">rnImplicitBndrs</span></a><span> </span><a href="#local-6989586621682098497"><span class="hs-identifier hs-var">bind_free_tvs</span></a><span> </span><a href="#local-6989586621682098494"><span class="hs-identifier hs-var">tv_rdrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682098498"><a href="#local-6989586621682098498"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098499"><a href="#local-6989586621682098499"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098500"><a href="#local-6989586621682098500"><span class="hs-identifier">hs_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098501"><a href="#local-6989586621682098501"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnWcBody"><span class="hs-identifier hs-var">rnWcBody</span></a><span> </span><a href="#local-6989586621682098490"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682098496"><span class="hs-identifier hs-var">nwc_rdrs</span></a><span> </span><a href="#local-6989586621682098491"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-138"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098502"><a href="#local-6989586621682098502"><span class="hs-identifier">sig_ty'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsWC</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098499"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098503"><span class="hs-identifier hs-var">ib_ty'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-139"></a><span>             </span><a name="local-6989586621682098503"><a href="#local-6989586621682098503"><span class="hs-identifier">ib_ty'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsIB</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098498"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-140"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098500"><span class="hs-identifier hs-var">hs_ty'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-141"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098504"><a href="#local-6989586621682098504"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098505"><a href="#local-6989586621682098505"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682098492"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621682098502"><span class="hs-identifier hs-var">sig_ty'</span></a><span>
</span><a name="line-142"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098504"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098501"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098505"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-143"></a><span class="hs-identifier">rn_hs_sig_wc_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsImplicitBndrs</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rn_hs_sig_wc_type&quot;</span><span>
</span><a name="line-145"></a><span class="hs-identifier">rn_hs_sig_wc_type</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsWildCardBndrs</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rn_hs_sig_wc_type&quot;</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-identifier">rnHsWcType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsWcType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsWcType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-149"></a><a name="rnHsWcType"><a href="RnTypes.html#rnHsWcType"><span class="hs-identifier">rnHsWcType</span></a></a><span> </span><a name="local-6989586621682098506"><a href="#local-6989586621682098506"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWC</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098507"><a href="#local-6989586621682098507"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098508"><a href="#local-6989586621682098508"><span class="hs-identifier">free_vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractFilteredRdrTyVars"><span class="hs-identifier hs-var">extractFilteredRdrTyVars</span></a><span> </span><a href="#local-6989586621682098507"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-151"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682098509"><a href="#local-6989586621682098509"><span class="hs-identifier">nwc_rdrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#partition_nwcs"><span class="hs-identifier hs-var">partition_nwcs</span></a><span> </span><a href="#local-6989586621682098508"><span class="hs-identifier hs-var">free_vars</span></a><span>
</span><a name="line-152"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098510"><a href="#local-6989586621682098510"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098511"><a href="#local-6989586621682098511"><span class="hs-identifier">hs_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098512"><a href="#local-6989586621682098512"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnWcBody"><span class="hs-identifier hs-var">rnWcBody</span></a><span> </span><a href="#local-6989586621682098506"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682098509"><span class="hs-identifier hs-var">nwc_rdrs</span></a><span> </span><a href="#local-6989586621682098507"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-153"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098513"><a href="#local-6989586621682098513"><span class="hs-identifier">sig_ty'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsWC</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hswc_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098510"><span class="hs-identifier hs-var">wcs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hswc_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098511"><span class="hs-identifier hs-var">hs_ty'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-154"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098513"><span class="hs-identifier hs-var">sig_ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098512"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-155"></a><span class="hs-identifier">rnHsWcType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsWildCardBndrs</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnHsWcType&quot;</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-identifier">rnWcBody</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-158"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-159"></a><a name="rnWcBody"><a href="RnTypes.html#rnWcBody"><span class="hs-identifier">rnWcBody</span></a></a><span> </span><a name="local-6989586621682098514"><a href="#local-6989586621682098514"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682098515"><a href="#local-6989586621682098515"><span class="hs-identifier">nwc_rdrs</span></a></a><span> </span><a name="local-6989586621682098516"><a href="#local-6989586621682098516"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-160"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098551"><a href="#local-6989586621682098551"><span class="hs-identifier">nwcs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="RnUtils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a><span> </span><a href="#local-6989586621682098515"><span class="hs-identifier hs-var">nwc_rdrs</span></a><span>
</span><a name="line-161"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098552"><a href="#local-6989586621682098552"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#RTKE"><span class="hs-identifier hs-var">RTKE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rtke_level</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span>
</span><a name="line-162"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_what</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span>
</span><a name="line-163"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_nwcs</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNameSet</span><span> </span><a href="#local-6989586621682098551"><span class="hs-identifier hs-var">nwcs</span></a><span>
</span><a name="line-164"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_ctxt</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098514"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-165"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098553"><a href="#local-6989586621682098553"><span class="hs-identifier">hs_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098554"><a href="#local-6989586621682098554"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-6989586621682098551"><span class="hs-identifier hs-var">nwcs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-166"></a><span>                          </span><a href="#local-6989586621682098517"><span class="hs-identifier hs-var">rn_lty</span></a><span> </span><a href="#local-6989586621682098552"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098516"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-167"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098551"><span class="hs-identifier hs-var">nwcs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098553"><span class="hs-identifier hs-var">hs_ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098554"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-168"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-169"></a><span>    </span><a name="local-6989586621682098517"><a href="#local-6989586621682098517"><span class="hs-identifier">rn_lty</span></a></a><span> </span><a name="local-6989586621682098520"><a href="#local-6989586621682098520"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098521"><a href="#local-6989586621682098521"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682098522"><a href="#local-6989586621682098522"><span class="hs-identifier">hs_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682098521"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-171"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098523"><a href="#local-6989586621682098523"><span class="hs-identifier">hs_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098524"><a href="#local-6989586621682098524"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682098518"><span class="hs-identifier hs-var">rn_ty</span></a><span> </span><a href="#local-6989586621682098520"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098522"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-172"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098521"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682098523"><span class="hs-identifier hs-var">hs_ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098524"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span>    </span><span class="hs-identifier">rn_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>    </span><span class="hs-comment">-- A lot of faff just to allow the extra-constraints wildcard to appear</span><span>
</span><a name="line-176"></a><span>    </span><a name="local-6989586621682098518"><a href="#local-6989586621682098518"><span class="hs-identifier">rn_ty</span></a></a><span> </span><a name="local-6989586621682098525"><a href="#local-6989586621682098525"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098526"><a href="#local-6989586621682098526"><span class="hs-identifier">hs_ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsForAllTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098527"><a href="#local-6989586621682098527"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098528"><a href="#local-6989586621682098528"><span class="hs-identifier">hs_body</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-177"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#bindLHsTyVarBndrs"><span class="hs-identifier hs-var">bindLHsTyVarBndrs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098525"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnTypes.html#inTypeDoc"><span class="hs-identifier hs-var">inTypeDoc</span></a><span> </span><a href="#local-6989586621682098526"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621682098527"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682098529"><a href="#local-6989586621682098529"><span class="hs-identifier">tvs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098530"><a href="#local-6989586621682098530"><span class="hs-identifier">hs_body'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098531"><a href="#local-6989586621682098531"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682098517"><span class="hs-identifier hs-var">rn_lty</span></a><span> </span><a href="#local-6989586621682098525"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098528"><span class="hs-identifier hs-var">hs_body</span></a><span>
</span><a name="line-179"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsForAllTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_xforall</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098529"><span class="hs-identifier hs-var">tvs'</span></a><span>
</span><a name="line-180"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098530"><span class="hs-identifier hs-var">hs_body'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098531"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span>    </span><span class="hs-identifier">rn_ty</span><span> </span><a name="local-6989586621682098532"><a href="#local-6989586621682098532"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsQualTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098533"><a href="#local-6989586621682098533"><span class="hs-identifier">cx</span></a></a><span> </span><a name="local-6989586621682098534"><a href="#local-6989586621682098534"><span class="hs-identifier">hs_ctxt</span></a></a><span>
</span><a name="line-183"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098535"><a href="#local-6989586621682098535"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098536"><a href="#local-6989586621682098536"><span class="hs-identifier">hs_ctxt1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098537"><a href="#local-6989586621682098537"><span class="hs-identifier">hs_ctxt_last</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">snocView</span><span> </span><a href="#local-6989586621682098534"><span class="hs-identifier hs-var">hs_ctxt</span></a><span>
</span><a name="line-185"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098538"><a href="#local-6989586621682098538"><span class="hs-identifier">lx</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWildCardTy</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ignoreParens</span><span> </span><a href="#local-6989586621682098537"><span class="hs-identifier hs-var">hs_ctxt_last</span></a><span>
</span><a name="line-186"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098539"><a href="#local-6989586621682098539"><span class="hs-identifier">hs_ctxt1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098540"><a href="#local-6989586621682098540"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098519"><span class="hs-identifier hs-var">rn_top_constraint</span></a><span> </span><a href="#local-6989586621682098532"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098536"><span class="hs-identifier hs-var">hs_ctxt1</span></a><span>
</span><a name="line-187"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682098538"><span class="hs-identifier hs-var">lx</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnTypes.html#checkExtraConstraintWildCard"><span class="hs-identifier hs-var">checkExtraConstraintWildCard</span></a><span> </span><a href="#local-6989586621682098532"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098536"><span class="hs-identifier hs-var">hs_ctxt1</span></a><span>
</span><a name="line-188"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098541"><a href="#local-6989586621682098541"><span class="hs-identifier">hs_ctxt'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098539"><span class="hs-identifier hs-var">hs_ctxt1'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098538"><span class="hs-identifier hs-var">lx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWildCardTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-189"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098542"><a href="#local-6989586621682098542"><span class="hs-identifier">hs_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098543"><a href="#local-6989586621682098543"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098532"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098535"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-190"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsQualTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_xqual</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span>
</span><a name="line-191"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098533"><span class="hs-identifier hs-var">cx</span></a><span> </span><a href="#local-6989586621682098541"><span class="hs-identifier hs-var">hs_ctxt'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098542"><span class="hs-identifier hs-var">hs_ty'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-192"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098540"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098543"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-195"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098544"><a href="#local-6989586621682098544"><span class="hs-identifier">hs_ctxt'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098545"><a href="#local-6989586621682098545"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098519"><span class="hs-identifier hs-var">rn_top_constraint</span></a><span> </span><a href="#local-6989586621682098532"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098534"><span class="hs-identifier hs-var">hs_ctxt</span></a><span>
</span><a name="line-196"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098546"><a href="#local-6989586621682098546"><span class="hs-identifier">hs_ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098547"><a href="#local-6989586621682098547"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098532"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098535"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-197"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsQualTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_xqual</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span>
</span><a name="line-198"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098533"><span class="hs-identifier hs-var">cx</span></a><span> </span><a href="#local-6989586621682098544"><span class="hs-identifier hs-var">hs_ctxt'</span></a><span>
</span><a name="line-199"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098546"><span class="hs-identifier hs-var">hs_ty'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-200"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098545"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098547"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>    </span><span class="hs-identifier">rn_ty</span><span> </span><a name="local-6989586621682098548"><a href="#local-6989586621682098548"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098549"><a href="#local-6989586621682098549"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnHsTyKi"><span class="hs-identifier hs-var">rnHsTyKi</span></a><span> </span><a href="#local-6989586621682098548"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098549"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span>    </span><a name="local-6989586621682098519"><a href="#local-6989586621682098519"><span class="hs-identifier">rn_top_constraint</span></a></a><span> </span><a name="local-6989586621682098550"><a href="#local-6989586621682098550"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098550"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rtke_what</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#RnTopConstraint"><span class="hs-identifier hs-var">RnTopConstraint</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-identifier">checkExtraConstraintWildCard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsContext</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- Rename the extra-constraint spot in a type signature</span><span>
</span><a name="line-209"></a><span class="hs-comment">--    (blah, _) =&gt; type</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- Check that extra-constraints are allowed at all, and</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- if so that it's an anonymous wildcard</span><span>
</span><a name="line-212"></a><a name="checkExtraConstraintWildCard"><a href="RnTypes.html#checkExtraConstraintWildCard"><span class="hs-identifier">checkExtraConstraintWildCard</span></a></a><span> </span><a name="local-6989586621682098555"><a href="#local-6989586621682098555"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098556"><a href="#local-6989586621682098556"><span class="hs-identifier">hs_ctxt</span></a></a><span>
</span><a name="line-213"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#checkWildCard"><span class="hs-identifier hs-var">checkWildCard</span></a><span> </span><a href="#local-6989586621682098555"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098557"><span class="hs-identifier hs-var">mb_bad</span></a><span>
</span><a name="line-214"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-215"></a><span>    </span><a name="local-6989586621682098557"><a href="#local-6989586621682098557"><span class="hs-identifier">mb_bad</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extraConstraintWildCardsAllowed"><span class="hs-identifier hs-var">extraConstraintWildCardsAllowed</span></a><span> </span><a href="#local-6989586621682098555"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682098558"><span class="hs-identifier hs-var">base_msg</span></a><span>
</span><a name="line-217"></a><span>             </span><span class="hs-comment">-- Currently, we do not allow wildcards in their full glory in</span><span>
</span><a name="line-218"></a><span>             </span><span class="hs-comment">-- standalone deriving declarations. We only allow a single</span><span>
</span><a name="line-219"></a><span>             </span><span class="hs-comment">-- extra-constraints wildcard &#224; la:</span><span>
</span><a name="line-220"></a><span>             </span><span class="hs-comment">--</span><span>
</span><a name="line-221"></a><span>             </span><span class="hs-comment">--   deriving instance _ =&gt; Eq (Foo a)</span><span>
</span><a name="line-222"></a><span>             </span><span class="hs-comment">--</span><span>
</span><a name="line-223"></a><span>             </span><span class="hs-comment">-- i.e., we don't support things like</span><span>
</span><a name="line-224"></a><span>             </span><span class="hs-comment">--</span><span>
</span><a name="line-225"></a><span>             </span><span class="hs-comment">--   deriving instance (Eq a, _) =&gt; Eq (Foo a)</span><span>
</span><a name="line-226"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="RnUtils.html#DerivDeclCtx"><span class="hs-identifier hs-var">DerivDeclCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098555"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-227"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621682098556"><span class="hs-identifier hs-var">hs_ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682098559"><span class="hs-identifier hs-var">deriv_decl_msg</span></a><span>
</span><a name="line-229"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-230"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span>    </span><a name="local-6989586621682098558"><a href="#local-6989586621682098558"><span class="hs-identifier">base_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Extra-constraint wildcard&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-identifier hs-var">pprAnonWildCard</span><span>
</span><a name="line-233"></a><span>                   </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;not allowed&quot;</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span>    </span><a name="local-6989586621682098559"><a href="#local-6989586621682098559"><span class="hs-identifier">deriv_decl_msg</span></a></a><span>
</span><a name="line-236"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><a href="#local-6989586621682098558"><span class="hs-identifier hs-var">base_msg</span></a><span>
</span><a name="line-237"></a><span>           </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;except as the sole constraint&quot;</span><span>
</span><a name="line-238"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;e.g., deriving instance _ =&gt; Eq (Foo a)&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-identifier">extraConstraintWildCardsAllowed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-241"></a><a name="extraConstraintWildCardsAllowed"><a href="RnTypes.html#extraConstraintWildCardsAllowed"><span class="hs-identifier">extraConstraintWildCardsAllowed</span></a></a><span> </span><a name="local-6989586621682098560"><a href="#local-6989586621682098560"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-242"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098560"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-243"></a><span>      </span><a href="RnUtils.html#TypeSigCtx"><span class="hs-identifier hs-var">TypeSigCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-244"></a><span>      </span><a href="RnUtils.html#ExprWithTySigCtx"><span class="hs-identifier hs-var">ExprWithTySigCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-245"></a><span>      </span><a href="RnUtils.html#DerivDeclCtx"><span class="hs-identifier hs-var">DerivDeclCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-246"></a><span>      </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-comment">-- | Finds free type and kind variables in a type,</span><span>
</span><a name="line-249"></a><span class="hs-comment">--     without duplicates, and</span><span>
</span><a name="line-250"></a><span class="hs-comment">--     without variables that are already in scope in LocalRdrEnv</span><span>
</span><a name="line-251"></a><span class="hs-comment">--   NB: this includes named wildcards, which look like perfectly</span><span>
</span><a name="line-252"></a><span class="hs-comment">--       ordinary type variables at this point</span><span>
</span><a name="line-253"></a><span class="hs-identifier">extractFilteredRdrTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><a href="RnTypes.html#FreeKiTyVarsNoDups"><span class="hs-identifier hs-type">FreeKiTyVarsNoDups</span></a><span>
</span><a name="line-254"></a><a name="extractFilteredRdrTyVars"><a href="RnTypes.html#extractFilteredRdrTyVars"><span class="hs-identifier">extractFilteredRdrTyVars</span></a></a><span> </span><a name="local-6989586621682098561"><a href="#local-6989586621682098561"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-255"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098562"><a href="#local-6989586621682098562"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a><span>
</span><a name="line-256"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#filterInScope"><span class="hs-identifier hs-var">filterInScope</span></a><span> </span><a href="#local-6989586621682098562"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extractHsTyRdrTyVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVars</span></a><span> </span><a href="#local-6989586621682098561"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">-- | Finds free type and kind variables in a type,</span><span>
</span><a name="line-259"></a><span class="hs-comment">--     with duplicates, but</span><span>
</span><a name="line-260"></a><span class="hs-comment">--     without variables that are already in scope in LocalRdrEnv</span><span>
</span><a name="line-261"></a><span class="hs-comment">--   NB: this includes named wildcards, which look like perfectly</span><span>
</span><a name="line-262"></a><span class="hs-comment">--       ordinary type variables at this point</span><span>
</span><a name="line-263"></a><span class="hs-identifier">extractFilteredRdrTyVarsDups</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-264"></a><a name="extractFilteredRdrTyVarsDups"><a href="RnTypes.html#extractFilteredRdrTyVarsDups"><span class="hs-identifier">extractFilteredRdrTyVarsDups</span></a></a><span> </span><a name="local-6989586621682098563"><a href="#local-6989586621682098563"><span class="hs-identifier">hs_ty</span></a></a><span>
</span><a name="line-265"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098564"><a href="#local-6989586621682098564"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a><span>
</span><a name="line-266"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#filterInScope"><span class="hs-identifier hs-var">filterInScope</span></a><span> </span><a href="#local-6989586621682098564"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extractHsTyRdrTyVarsDups"><span class="hs-identifier hs-var">extractHsTyRdrTyVarsDups</span></a><span> </span><a href="#local-6989586621682098563"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-comment">-- | When the NamedWildCards extension is enabled, partition_nwcs</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- removes type variables that start with an underscore from the</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- FreeKiTyVars in the argument and returns them in a separate list.</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- When the extension is disabled, the function returns the argument</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- and empty list.  See Note [Renaming named wild cards]</span><span>
</span><a name="line-273"></a><span class="hs-identifier">partition_nwcs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><a name="partition_nwcs"><a href="RnTypes.html#partition_nwcs"><span class="hs-identifier">partition_nwcs</span></a></a><span> </span><a name="local-6989586621682098565"><a href="#local-6989586621682098565"><span class="hs-identifier">free_vars</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098566"><a href="#local-6989586621682098566"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098569"><a href="#local-6989586621682098569"><span class="hs-identifier">wildcards_enabled</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">xopt</span><span> </span><span class="hs-identifier hs-var">LangExt.NamedWildCards</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-276"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098570"><a href="#local-6989586621682098570"><span class="hs-identifier">nwcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098571"><a href="#local-6989586621682098571"><span class="hs-identifier">no_nwcs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098569"><span class="hs-identifier hs-var">wildcards_enabled</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><a href="#local-6989586621682098567"><span class="hs-identifier hs-var">is_wildcard</span></a><span> </span><a href="#local-6989586621682098566"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-277"></a><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098566"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>             </span><a name="local-6989586621682098572"><a href="#local-6989586621682098572"><span class="hs-identifier">free_vars'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098565"><span class="hs-identifier hs-var">free_vars</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098571"><span class="hs-identifier hs-var">no_nwcs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-279"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098572"><span class="hs-identifier hs-var">free_vars'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098570"><span class="hs-identifier hs-var">nwcs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-280"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-281"></a><span>     </span><span class="hs-identifier">is_wildcard</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-282"></a><span>     </span><a name="local-6989586621682098567"><a href="#local-6989586621682098567"><span class="hs-identifier">is_wildcard</span></a></a><span> </span><a name="local-6989586621682098568"><a href="#local-6989586621682098568"><span class="hs-identifier">rdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">startsWithUnderscore</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rdrNameOcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682098568"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-comment">{- Note [Renaming named wild cards]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Identifiers starting with an underscore are always parsed as type variables.
It is only here in the renamer that we give the special treatment.
See Note [The wildcard story for types] in HsTypes.

It's easy!  When we collect the implicitly bound type variables, ready
to bring them into scope, and NamedWildCards is on, we partition the
variables into the ones that start with an underscore (the named
wildcards) and the rest. Then we just add them to the hswc_wcs field
of the HsWildCardBndrs structure, and we are done.


*********************************************************
*                                                       *
           HsSigtype (i.e. no wildcards)
*                                                       *
****************************************************** -}</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-identifier">rnHsSigType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsSigType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-304"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsSigType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- Used for source-language type signatures</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- that cannot have wildcards</span><span>
</span><a name="line-307"></a><a name="rnHsSigType"><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier">rnHsSigType</span></a></a><span> </span><a name="local-6989586621682098573"><a href="#local-6989586621682098573"><span class="hs-identifier">ctx</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIB</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098574"><a href="#local-6989586621682098574"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rnHsSigType&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098574"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-309"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098575"><a href="#local-6989586621682098575"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#extractFilteredRdrTyVarsDups"><span class="hs-identifier hs-var">extractFilteredRdrTyVarsDups</span></a><span> </span><a href="#local-6989586621682098574"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-310"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#rnImplicitBndrs"><span class="hs-identifier hs-var">rnImplicitBndrs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isLHsForAllTy</span><span> </span><a href="#local-6989586621682098574"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098575"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682098576"><a href="#local-6989586621682098576"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-311"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098577"><a href="#local-6989586621682098577"><span class="hs-identifier">body'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098578"><a href="#local-6989586621682098578"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-6989586621682098573"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621682098574"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-312"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">HsIB</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsib_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098576"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-313"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsib_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098577"><span class="hs-identifier hs-var">body'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-314"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098578"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-315"></a><span class="hs-identifier">rnHsSigType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsImplicitBndrs</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnHsSigType&quot;</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span class="hs-identifier">rnImplicitBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>    </span><span class="hs-comment">-- True &lt;=&gt; bring into scope any free type variables</span><span>
</span><a name="line-318"></a><span>                           </span><span class="hs-comment">-- E.g.  f :: forall a. a-&gt;b</span><span>
</span><a name="line-319"></a><span>                           </span><span class="hs-comment">--  we do not want to bring 'b' into scope, hence False</span><span>
</span><a name="line-320"></a><span>                           </span><span class="hs-comment">-- But   f :: a -&gt; b</span><span>
</span><a name="line-321"></a><span>                           </span><span class="hs-comment">--  we want to bring both 'a' and 'b' into scope</span><span>
</span><a name="line-322"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-323"></a><span>                                   </span><span class="hs-comment">-- Free vars of hs_ty (excluding wildcards)</span><span>
</span><a name="line-324"></a><span>                                   </span><span class="hs-comment">-- May have duplicates, which is</span><span>
</span><a name="line-325"></a><span>                                   </span><span class="hs-comment">-- checked here</span><span>
</span><a name="line-326"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098477"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098477"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-328"></a><a name="rnImplicitBndrs"><a href="RnTypes.html#rnImplicitBndrs"><span class="hs-identifier">rnImplicitBndrs</span></a></a><span> </span><a name="local-6989586621682098579"><a href="#local-6989586621682098579"><span class="hs-identifier">bind_free_tvs</span></a></a><span>
</span><a name="line-329"></a><span>                </span><a name="local-6989586621682098580"><a href="#local-6989586621682098580"><span class="hs-identifier">fvs_with_dups</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098581"><a href="#local-6989586621682098581"><span class="hs-identifier">kvs_with_dups</span></a></a><span>
</span><a name="line-330"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098582"><a href="#local-6989586621682098582"><span class="hs-identifier">tvs_with_dups</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>                </span><a name="local-6989586621682098583"><a href="#local-6989586621682098583"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-332"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><a name="local-6989586621682098586"><a href="#local-6989586621682098586"><span class="hs-identifier">kvs</span></a></a><span> </span><a name="local-6989586621682098587"><a href="#local-6989586621682098587"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rmDupsInRdrTyVars"><span class="hs-identifier hs-var">rmDupsInRdrTyVars</span></a><span> </span><a href="#local-6989586621682098580"><span class="hs-identifier hs-var">fvs_with_dups</span></a><span>
</span><a name="line-333"></a><span>             </span><a name="local-6989586621682098588"><a href="#local-6989586621682098588"><span class="hs-identifier">real_tvs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098579"><span class="hs-identifier hs-var">bind_free_tvs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098587"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-334"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-335"></a><span>             </span><span class="hs-comment">-- We always bind over free /kind/ variables.</span><span>
</span><a name="line-336"></a><span>             </span><span class="hs-comment">-- Bind free /type/ variables only if there is no</span><span>
</span><a name="line-337"></a><span>             </span><span class="hs-comment">-- explicit forall.  E.g.</span><span>
</span><a name="line-338"></a><span>             </span><span class="hs-comment">--    f :: Proxy (a :: k) -&gt; b</span><span>
</span><a name="line-339"></a><span>             </span><span class="hs-comment">--         Quantify over {k} and {a,b}</span><span>
</span><a name="line-340"></a><span>             </span><span class="hs-comment">--    g :: forall a. Proxy (a :: k) -&gt; b</span><span>
</span><a name="line-341"></a><span>             </span><span class="hs-comment">--         Quantify over {k} and {}</span><span>
</span><a name="line-342"></a><span>             </span><span class="hs-comment">-- Note that we always do the implicit kind-quantification</span><span>
</span><a name="line-343"></a><span>             </span><span class="hs-comment">-- but, rather arbitrarily, we switch off the type-quantification</span><span>
</span><a name="line-344"></a><span>             </span><span class="hs-comment">-- if there is an explicit forall</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rnImplicitBndrs&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098586"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098587"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098588"><span class="hs-identifier hs-var">real_tvs</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><span class="hs-identifier hs-var">Opt_WarnImplicitKindVars</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-349"></a><span>         </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098579"><span class="hs-identifier hs-var">bind_free_tvs</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621682098586"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-350"></a><span>         </span><a href="TcRnMonad.html#addWarnAt"><span class="hs-identifier hs-var">addWarnAt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnImplicitKindVars</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621682098586"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-351"></a><span>         </span><a href="#local-6989586621682098584"><span class="hs-identifier hs-var">implicit_kind_vars_msg</span></a><span> </span><a href="#local-6989586621682098586"><span class="hs-identifier hs-var">kvs</span></a><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098589"><a href="#local-6989586621682098589"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-354"></a><span>          </span><span class="hs-comment">-- NB: kinds before tvs, as mandated by</span><span>
</span><a name="line-355"></a><span>          </span><span class="hs-comment">-- Note [Ordering of implicit variables]</span><span>
</span><a name="line-356"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098590"><a href="#local-6989586621682098590"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="RnUtils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098589"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098586"><span class="hs-identifier hs-var">kvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682098588"><span class="hs-identifier hs-var">real_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;checkMixedVars2&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-359"></a><span>           </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;kvs_with_dups&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098581"><span class="hs-identifier hs-var">kvs_with_dups</span></a><span>
</span><a name="line-360"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tvs_with_dups&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098582"><span class="hs-identifier hs-var">tvs_with_dups</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-6989586621682098590"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-363"></a><span>         </span><a href="#local-6989586621682098583"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621682098590"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-364"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-365"></a><span>    </span><a name="local-6989586621682098584"><a href="#local-6989586621682098584"><span class="hs-identifier">implicit_kind_vars_msg</span></a></a><span> </span><a name="local-6989586621682098585"><a href="#local-6989586621682098585"><span class="hs-identifier">kvs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-366"></a><span>      </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;An explicit&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;forall&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-367"></a><span>             </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;was used, but the following kind variables&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-368"></a><span>             </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;are not quantified:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-369"></a><span>             </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">punctuate</span><span> </span><span class="hs-identifier hs-var">comma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ppr</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098585"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-370"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Despite this fact, GHC will introduce them into scope,&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-371"></a><span>             </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;but it will stop doing so in the future.&quot;</span><span>
</span><a name="line-372"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Suggested fix: add&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-373"></a><span>             </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;forall&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098585"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'.'</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-comment">{- ******************************************************
*                                                       *
           LHsType and HsType
*                                                       *
****************************************************** -}</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-comment">{-
rnHsType is here because we call it from loadInstDecl, and I didn't
want a gratuitous knot.

Note [Context quantification]
-----------------------------
Variables in type signatures are implicitly quantified
when (1) they are in a type signature not beginning
with &quot;forall&quot; or (2) in any qualified type T =&gt; R.
We are phasing out (2) since it leads to inconsistencies
(Trac #4426):

data A = A (a -&gt; a)           is an error
data A = A (Eq a =&gt; a -&gt; a)   binds &quot;a&quot;
data A = A (Eq a =&gt; a -&gt; b)   binds &quot;a&quot; and &quot;b&quot;
data A = A (() =&gt; a -&gt; b)     binds &quot;a&quot; and &quot;b&quot;
f :: forall a. a -&gt; b         is an error
f :: forall a. () =&gt; a -&gt; b   is an error
f :: forall a. a -&gt; (() =&gt; b) binds &quot;a&quot; and &quot;b&quot;

This situation is now considered to be an error. See rnHsTyKi for case
HsForAllTy Qualified.

Note [QualTy in kinds]
~~~~~~~~~~~~~~~~~~~~~~
I was wondering whether QualTy could occur only at TypeLevel.  But no,
we can have a qualified type in a kind too. Here is an example:

  type family F a where
    F Bool = Nat
    F Nat  = Type

  type family G a where
    G Type = Type -&gt; Type
    G ()   = Nat

  data X :: forall k1 k2. (F k1 ~ G k2) =&gt; k1 -&gt; k2 -&gt; Type where
    MkX :: X 'True '()

See that k1 becomes Bool and k2 becomes (), so the equality is
satisfied. If I write MkX :: X 'True 'False, compilation fails with a
suitable message:

  MkX :: X 'True '()
    &#8226; Couldn't match kind &#8216;G Bool&#8217; with &#8216;Nat&#8217;
      Expected kind: G Bool
        Actual kind: F Bool

However: in a kind, the constraints in the QualTy must all be
equalities; or at least, any kinds with a class constraint are
uninhabited.
-}</span><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span class="hs-keyword">data</span><span> </span><a name="RnTyKiEnv"><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier">RnTyKiEnv</span></a></a><span>
</span><a name="line-435"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="RTKE"><a href="RnTypes.html#RTKE"><span class="hs-identifier">RTKE</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="rtke_ctxt"><a href="RnTypes.html#rtke_ctxt"><span class="hs-identifier">rtke_ctxt</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-436"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="rtke_level"><a href="RnTypes.html#rtke_level"><span class="hs-identifier">rtke_level</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeOrKind</span><span>  </span><span class="hs-comment">-- Am I renaming a type or a kind?</span><span>
</span><a name="line-437"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="rtke_what"><a href="RnTypes.html#rtke_what"><span class="hs-identifier">rtke_what</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiWhat"><span class="hs-identifier hs-type">RnTyKiWhat</span></a><span>  </span><span class="hs-comment">-- And within that what am I renaming?</span><span>
</span><a name="line-438"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="rtke_nwcs"><a href="RnTypes.html#rtke_nwcs"><span class="hs-identifier">rtke_nwcs</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NameSet</span><span>     </span><span class="hs-comment">-- These are the in-scope named wildcards</span><span>
</span><a name="line-439"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span class="hs-keyword">data</span><span> </span><a name="RnTyKiWhat"><a href="RnTypes.html#RnTyKiWhat"><span class="hs-identifier">RnTyKiWhat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="RnTypeBody"><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier">RnTypeBody</span></a></a><span>
</span><a name="line-442"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a name="RnTopConstraint"><a href="RnTypes.html#RnTopConstraint"><span class="hs-identifier">RnTopConstraint</span></a></a><span>   </span><span class="hs-comment">-- Top-level context of HsSigWcTypes</span><span>
</span><a name="line-443"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a name="RnConstraint"><a href="RnTypes.html#RnConstraint"><span class="hs-identifier">RnConstraint</span></a></a><span>      </span><span class="hs-comment">-- All other constraints</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-446"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#RTKE"><span class="hs-identifier hs-var">RTKE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rtke_level</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098455"><a href="#local-6989586621682098455"><span class="hs-identifier">lev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_what</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098456"><a href="#local-6989586621682098456"><span class="hs-identifier">what</span></a></a><span>
</span><a name="line-447"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_nwcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098457"><a href="#local-6989586621682098457"><span class="hs-identifier">wcs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098458"><a href="#local-6989586621682098458"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;RTKE&quot;</span><span>
</span><a name="line-449"></a><span>      </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">braces</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098455"><span class="hs-identifier hs-var">lev</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098456"><span class="hs-identifier hs-var">what</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098457"><span class="hs-identifier hs-var">wcs</span></a><span>
</span><a name="line-450"></a><span>                      </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#pprHsDocContext"><span class="hs-identifier hs-var">pprHsDocContext</span></a><span> </span><a href="#local-6989586621682098458"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-451"></a><span>
</span><a name="line-452"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="RnTypes.html#RnTyKiWhat"><span class="hs-identifier hs-type">RnTyKiWhat</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-453"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;RnTypeBody&quot;</span><span>
</span><a name="line-454"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="RnTypes.html#RnTopConstraint"><span class="hs-identifier hs-var">RnTopConstraint</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;RnTopConstraint&quot;</span><span>
</span><a name="line-455"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="RnTypes.html#RnConstraint"><span class="hs-identifier hs-var">RnConstraint</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;RnConstraint&quot;</span><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-identifier">mkTyKiEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeOrKind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#RnTyKiWhat"><span class="hs-identifier hs-type">RnTyKiWhat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span>
</span><a name="line-458"></a><a name="mkTyKiEnv"><a href="RnTypes.html#mkTyKiEnv"><span class="hs-identifier">mkTyKiEnv</span></a></a><span> </span><a name="local-6989586621682098591"><a href="#local-6989586621682098591"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621682098592"><a href="#local-6989586621682098592"><span class="hs-identifier">level</span></a></a><span> </span><a name="local-6989586621682098593"><a href="#local-6989586621682098593"><span class="hs-identifier">what</span></a></a><span>
</span><a name="line-459"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#RTKE"><span class="hs-identifier hs-var">RTKE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rtke_level</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098592"><span class="hs-identifier hs-var">level</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_nwcs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyNameSet</span><span>
</span><a name="line-460"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_what</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098593"><span class="hs-identifier hs-var">what</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtke_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098591"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span class="hs-identifier">isRnKindLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-463"></a><a name="isRnKindLevel"><a href="RnTypes.html#isRnKindLevel"><span class="hs-identifier">isRnKindLevel</span></a></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#RTKE"><span class="hs-identifier hs-var">RTKE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rtke_level</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">KindLevel</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-464"></a><span class="hs-identifier">isRnKindLevel</span><span> </span><span class="hs-identifier">_</span><span>                                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-465"></a><span>
</span><a name="line-466"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-467"></a><span class="hs-identifier">rnLHsType</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-468"></a><a name="rnLHsType"><a href="RnTypes.html#rnLHsType"><span class="hs-identifier">rnLHsType</span></a></a><span> </span><a name="local-6989586621682098594"><a href="#local-6989586621682098594"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682098595"><a href="#local-6989586621682098595"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#mkTyKiEnv"><span class="hs-identifier hs-var">mkTyKiEnv</span></a><span> </span><a href="#local-6989586621682098594"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098595"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span class="hs-identifier">rnLHsTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-471"></a><a name="rnLHsTypes"><a href="RnTypes.html#rnLHsTypes"><span class="hs-identifier">rnLHsTypes</span></a></a><span> </span><a name="local-6989586621682098596"><a href="#local-6989586621682098596"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621682098597"><a href="#local-6989586621682098597"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-6989586621682098596"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098597"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-472"></a><span>
</span><a name="line-473"></a><span class="hs-identifier">rnHsType</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-474"></a><a name="rnHsType"><a href="RnTypes.html#rnHsType"><span class="hs-identifier">rnHsType</span></a></a><span> </span><a name="local-6989586621682098598"><a href="#local-6989586621682098598"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682098599"><a href="#local-6989586621682098599"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnHsTyKi"><span class="hs-identifier hs-var">rnHsTyKi</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#mkTyKiEnv"><span class="hs-identifier hs-var">mkTyKiEnv</span></a><span> </span><a href="#local-6989586621682098598"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098599"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-475"></a><span>
</span><a name="line-476"></a><span class="hs-identifier">rnLHsKind</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsKind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsKind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-477"></a><a name="rnLHsKind"><a href="RnTypes.html#rnLHsKind"><span class="hs-identifier">rnLHsKind</span></a></a><span> </span><a name="local-6989586621682098600"><a href="#local-6989586621682098600"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682098601"><a href="#local-6989586621682098601"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#mkTyKiEnv"><span class="hs-identifier hs-var">mkTyKiEnv</span></a><span> </span><a href="#local-6989586621682098600"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-identifier hs-var">KindLevel</span><span> </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098601"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span class="hs-identifier">rnHsKind</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsKind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsKind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-480"></a><a name="rnHsKind"><a href="RnTypes.html#rnHsKind"><span class="hs-identifier">rnHsKind</span></a></a><span> </span><a name="local-6989586621682098602"><a href="#local-6989586621682098602"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682098603"><a href="#local-6989586621682098603"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnHsTyKi"><span class="hs-identifier hs-var">rnHsTyKi</span></a><span>  </span><span class="hs-special">(</span><a href="RnTypes.html#mkTyKiEnv"><span class="hs-identifier hs-var">mkTyKiEnv</span></a><span> </span><a href="#local-6989586621682098602"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-identifier hs-var">KindLevel</span><span> </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098603"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-481"></a><span>
</span><a name="line-482"></a><span class="hs-comment">-- renaming a type only, not a kind</span><span>
</span><a name="line-483"></a><span class="hs-identifier">rnLHsTypeArg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsTypeArg</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-484"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsTypeArg</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-485"></a><a name="rnLHsTypeArg"><a href="RnTypes.html#rnLHsTypeArg"><span class="hs-identifier">rnLHsTypeArg</span></a></a><span> </span><a name="local-6989586621682098604"><a href="#local-6989586621682098604"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsValArg</span><span> </span><a name="local-6989586621682098605"><a href="#local-6989586621682098605"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-486"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098606"><a href="#local-6989586621682098606"><span class="hs-identifier">tys_rn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098607"><a href="#local-6989586621682098607"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a><span> </span><a href="#local-6989586621682098604"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682098605"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-487"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsValArg</span><span> </span><a href="#local-6989586621682098606"><span class="hs-identifier hs-var">tys_rn</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098607"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-488"></a><span class="hs-identifier">rnLHsTypeArg</span><span> </span><a name="local-6989586621682098608"><a href="#local-6989586621682098608"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTypeArg</span><span> </span><a name="local-6989586621682098609"><a href="#local-6989586621682098609"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682098610"><a href="#local-6989586621682098610"><span class="hs-identifier">ki</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-489"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098611"><a href="#local-6989586621682098611"><span class="hs-identifier">kis_rn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098612"><a href="#local-6989586621682098612"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsKind"><span class="hs-identifier hs-var">rnLHsKind</span></a><span> </span><a href="#local-6989586621682098608"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682098610"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-490"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTypeArg</span><span> </span><a href="#local-6989586621682098609"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682098611"><span class="hs-identifier hs-var">kis_rn</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098612"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-491"></a><span class="hs-identifier">rnLHsTypeArg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsArgPar</span><span> </span><a name="local-6989586621682098613"><a href="#local-6989586621682098613"><span class="hs-identifier">sp</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-492"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsArgPar</span><span> </span><a href="#local-6989586621682098613"><span class="hs-identifier hs-var">sp</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-493"></a><span>
</span><a name="line-494"></a><span class="hs-identifier">rnLHsTypeArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTypeArg</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>
</span><a name="line-495"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTypeArg</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-496"></a><a name="rnLHsTypeArgs"><a href="RnTypes.html#rnLHsTypeArgs"><span class="hs-identifier">rnLHsTypeArgs</span></a></a><span> </span><a name="local-6989586621682098614"><a href="#local-6989586621682098614"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621682098615"><a href="#local-6989586621682098615"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnLHsTypeArg"><span class="hs-identifier hs-var">rnLHsTypeArg</span></a><span> </span><a href="#local-6989586621682098614"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098615"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-499"></a><span class="hs-identifier">rnTyKiContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsContext</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-500"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsContext</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-501"></a><a name="rnTyKiContext"><a href="RnTypes.html#rnTyKiContext"><span class="hs-identifier">rnTyKiContext</span></a></a><span> </span><a name="local-6989586621682098616"><a href="#local-6989586621682098616"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098617"><a href="#local-6989586621682098617"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682098618"><a href="#local-6989586621682098618"><span class="hs-identifier">cxt</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-502"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;rncontext&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098618"><span class="hs-identifier hs-var">cxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098619"><a href="#local-6989586621682098619"><span class="hs-identifier">env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098616"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rtke_what</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#RnConstraint"><span class="hs-identifier hs-var">RnConstraint</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-504"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098620"><a href="#local-6989586621682098620"><span class="hs-identifier">cxt'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098621"><a href="#local-6989586621682098621"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098619"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098618"><span class="hs-identifier hs-var">cxt</span></a><span>
</span><a name="line-505"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098617"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682098620"><span class="hs-identifier hs-var">cxt'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098621"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-identifier">rnContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsContext</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-508"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsContext</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-509"></a><a name="rnContext"><a href="RnTypes.html#rnContext"><span class="hs-identifier">rnContext</span></a></a><span> </span><a name="local-6989586621682098622"><a href="#local-6989586621682098622"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621682098623"><a href="#local-6989586621682098623"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rnTyKiContext"><span class="hs-identifier hs-var">rnTyKiContext</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#mkTyKiEnv"><span class="hs-identifier hs-var">mkTyKiEnv</span></a><span> </span><a href="#local-6989586621682098622"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="RnTypes.html#RnConstraint"><span class="hs-identifier hs-var">RnConstraint</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098623"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-512"></a><span class="hs-identifier">rnLHsTyKi</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-513"></a><a name="rnLHsTyKi"><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier">rnLHsTyKi</span></a></a><span> </span><a name="local-6989586621682098624"><a href="#local-6989586621682098624"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098625"><a href="#local-6989586621682098625"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682098626"><a href="#local-6989586621682098626"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682098625"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-515"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098627"><a href="#local-6989586621682098627"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098628"><a href="#local-6989586621682098628"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsTyKi"><span class="hs-identifier hs-var">rnHsTyKi</span></a><span> </span><a href="#local-6989586621682098624"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098626"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-516"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098625"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682098627"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098628"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><a name="rnHsTyKi"><a href="RnTypes.html#rnHsTyKi"><span class="hs-identifier">rnHsTyKi</span></a></a><span> </span><a name="local-6989586621682098629"><a href="#local-6989586621682098629"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098630"><a href="#local-6989586621682098630"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsForAllTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098631"><a href="#local-6989586621682098631"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098632"><a href="#local-6989586621682098632"><span class="hs-identifier">tau</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#checkPolyKinds"><span class="hs-identifier hs-var">checkPolyKinds</span></a><span> </span><a href="#local-6989586621682098629"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098630"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-522"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#bindLHsTyVarBndrs"><span class="hs-identifier hs-var">bindLHsTyVarBndrs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098629"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnTypes.html#inTypeDoc"><span class="hs-identifier hs-var">inTypeDoc</span></a><span> </span><a href="#local-6989586621682098630"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>                           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621682098631"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682098633"><a href="#local-6989586621682098633"><span class="hs-identifier">tyvars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-524"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098634"><a href="#local-6989586621682098634"><span class="hs-identifier">tau'</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621682098635"><a href="#local-6989586621682098635"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098629"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098632"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-525"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">HsForAllTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_xforall</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098633"><span class="hs-identifier hs-var">tyvars'</span></a><span>
</span><a name="line-526"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621682098634"><span class="hs-identifier hs-var">tau'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-527"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098635"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-528"></a><span>
</span><a name="line-529"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098636"><a href="#local-6989586621682098636"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098637"><a href="#local-6989586621682098637"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsQualTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098638"><a href="#local-6989586621682098638"><span class="hs-identifier">lctxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098639"><a href="#local-6989586621682098639"><span class="hs-identifier">tau</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-530"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#checkPolyKinds"><span class="hs-identifier hs-var">checkPolyKinds</span></a><span> </span><a href="#local-6989586621682098636"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098637"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-comment">-- See Note [QualTy in kinds]</span><span>
</span><a name="line-531"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098640"><a href="#local-6989586621682098640"><span class="hs-identifier">ctxt'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098641"><a href="#local-6989586621682098641"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnTyKiContext"><span class="hs-identifier hs-var">rnTyKiContext</span></a><span> </span><a href="#local-6989586621682098636"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098638"><span class="hs-identifier hs-var">lctxt</span></a><span>
</span><a name="line-532"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098642"><a href="#local-6989586621682098642"><span class="hs-identifier">tau'</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621682098643"><a href="#local-6989586621682098643"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098636"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098639"><span class="hs-identifier hs-var">tau</span></a><span>
</span><a name="line-533"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsQualTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_xqual</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098640"><span class="hs-identifier hs-var">ctxt'</span></a><span>
</span><a name="line-534"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621682098642"><span class="hs-identifier hs-var">tau'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-535"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098641"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098643"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-536"></a><span>
</span><a name="line-537"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098644"><a href="#local-6989586621682098644"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTyVar</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098645"><a href="#local-6989586621682098645"><span class="hs-identifier">ip</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098646"><a href="#local-6989586621682098646"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682098647"><a href="#local-6989586621682098647"><span class="hs-identifier">rdr_name</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#isRnKindLevel"><span class="hs-identifier hs-var">isRnKindLevel</span></a><span> </span><a href="#local-6989586621682098644"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isRdrTyVar</span><span> </span><a href="#local-6989586621682098647"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-539"></a><span>         </span><a href="TcRnMonad.html#unlessXOptM"><span class="hs-identifier hs-var">unlessXOptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.PolyKinds</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-540"></a><span>         </span><a href="RnUtils.html#withHsDocContext"><span class="hs-identifier hs-var">withHsDocContext</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098644"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-541"></a><span>         </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Unexpected kind variable&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098647"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Perhaps you intended to use PolyKinds&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-543"></a><span>           </span><span class="hs-comment">-- Any type variable at the kind level is illegal without the use</span><span>
</span><a name="line-544"></a><span>           </span><span class="hs-comment">-- of PolyKinds (see #14710)</span><span>
</span><a name="line-545"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098648"><a href="#local-6989586621682098648"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnTyVar"><span class="hs-identifier hs-var">rnTyVar</span></a><span> </span><a href="#local-6989586621682098644"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098647"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-546"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTyVar</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098645"><span class="hs-identifier hs-var">ip</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098646"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682098648"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitFV</span><span> </span><a href="#local-6989586621682098648"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098649"><a href="#local-6989586621682098649"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098650"><a href="#local-6989586621682098650"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsOpTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098651"><a href="#local-6989586621682098651"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621682098652"><a href="#local-6989586621682098652"><span class="hs-identifier">l_op</span></a></a><span> </span><a name="local-6989586621682098653"><a href="#local-6989586621682098653"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-549"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getLoc</span><span> </span><a href="#local-6989586621682098652"><span class="hs-identifier hs-var">l_op</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-550"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098654"><a href="#local-6989586621682098654"><span class="hs-identifier">l_op'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098655"><a href="#local-6989586621682098655"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsTyOp"><span class="hs-identifier hs-var">rnHsTyOp</span></a><span> </span><a href="#local-6989586621682098649"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098650"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682098652"><span class="hs-identifier hs-var">l_op</span></a><span>
</span><a name="line-551"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098656"><a href="#local-6989586621682098656"><span class="hs-identifier">fix</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnFixity.html#lookupTyFixityRn"><span class="hs-identifier hs-var">lookupTyFixityRn</span></a><span> </span><a href="#local-6989586621682098654"><span class="hs-identifier hs-var">l_op'</span></a><span>
</span><a name="line-552"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098657"><a href="#local-6989586621682098657"><span class="hs-identifier">ty1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098658"><a href="#local-6989586621682098658"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098649"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098651"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-553"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098659"><a href="#local-6989586621682098659"><span class="hs-identifier">ty2'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098660"><a href="#local-6989586621682098660"><span class="hs-identifier">fvs3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098649"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098653"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-554"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098663"><a href="#local-6989586621682098663"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#mkHsOpTyRn"><span class="hs-identifier hs-var">mkHsOpTyRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682098661"><a href="#local-6989586621682098661"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621682098662"><a href="#local-6989586621682098662"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">HsOpTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098661"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621682098654"><span class="hs-identifier hs-var">l_op'</span></a><span> </span><a href="#local-6989586621682098662"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-555"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682098654"><span class="hs-identifier hs-var">l_op'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098656"><span class="hs-identifier hs-var">fix</span></a><span> </span><a href="#local-6989586621682098657"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621682098659"><span class="hs-identifier hs-var">ty2'</span></a><span>
</span><a name="line-556"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098663"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">plusFVs</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682098655"><span class="hs-identifier hs-var">fvs1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098658"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098660"><span class="hs-identifier hs-var">fvs3</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098664"><a href="#local-6989586621682098664"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsParTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098665"><a href="#local-6989586621682098665"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098666"><a href="#local-6989586621682098666"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098667"><a href="#local-6989586621682098667"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098664"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098665"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-560"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsParTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098666"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098667"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-561"></a><span>
</span><a name="line-562"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098668"><a href="#local-6989586621682098668"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsBangTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098669"><a href="#local-6989586621682098669"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621682098670"><a href="#local-6989586621682098670"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098671"><a href="#local-6989586621682098671"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098672"><a href="#local-6989586621682098672"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098668"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098670"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-564"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsBangTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098669"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621682098671"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098672"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098673"><a href="#local-6989586621682098673"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098674"><a href="#local-6989586621682098674"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098675"><a href="#local-6989586621682098675"><span class="hs-identifier">flds</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-567"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098678"><a href="#local-6989586621682098678"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098673"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-568"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098679"><a href="#local-6989586621682098679"><span class="hs-identifier">fls</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682098676"><span class="hs-identifier hs-var">get_fields</span></a><span> </span><a href="#local-6989586621682098678"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-569"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098680"><a href="#local-6989586621682098680"><span class="hs-identifier">flds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098681"><a href="#local-6989586621682098681"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnConDeclFields"><span class="hs-identifier hs-var">rnConDeclFields</span></a><span> </span><a href="#local-6989586621682098678"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682098679"><span class="hs-identifier hs-var">fls</span></a><span> </span><a href="#local-6989586621682098675"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-570"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098680"><span class="hs-identifier hs-var">flds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098681"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-571"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-572"></a><span>    </span><a name="local-6989586621682098676"><a href="#local-6989586621682098676"><span class="hs-identifier">get_fields</span></a></a><span> </span><span class="hs-special">(</span><a href="RnUtils.html#ConDeclCtx"><span class="hs-identifier hs-var">ConDeclCtx</span></a><span> </span><a name="local-6989586621682098677"><a href="#local-6989586621682098677"><span class="hs-identifier">names</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-573"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMapM</span><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupConstructorFields"><span class="hs-identifier hs-var">lookupConstructorFields</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098677"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-574"></a><span>    </span><span class="hs-identifier">get_fields</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-575"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Record syntax is illegal here:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-576"></a><span>                                   </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098674"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-577"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098682"><a href="#local-6989586621682098682"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFunTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098683"><a href="#local-6989586621682098683"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621682098684"><a href="#local-6989586621682098684"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098685"><a href="#local-6989586621682098685"><span class="hs-identifier">ty1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098686"><a href="#local-6989586621682098686"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098682"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098683"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-581"></a><span>        </span><span class="hs-comment">-- Might find a for-all as the arg of a function type</span><span>
</span><a name="line-582"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098687"><a href="#local-6989586621682098687"><span class="hs-identifier">ty2'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098688"><a href="#local-6989586621682098688"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098682"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098684"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-583"></a><span>        </span><span class="hs-comment">-- Or as the result.  This happens when reading Prelude.hi</span><span>
</span><a name="line-584"></a><span>        </span><span class="hs-comment">-- when we find return :: forall m. Monad m -&gt; forall a. a -&gt; m a</span><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span>        </span><span class="hs-comment">-- Check for fixity rearrangements</span><span>
</span><a name="line-587"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098689"><a href="#local-6989586621682098689"><span class="hs-identifier">res_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#mkHsOpTyRn"><span class="hs-identifier hs-var">mkHsOpTyRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFunTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">funTyConName</span><span> </span><span class="hs-identifier hs-var">funTyFixity</span><span> </span><a href="#local-6989586621682098685"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621682098687"><span class="hs-identifier hs-var">ty2'</span></a><span>
</span><a name="line-588"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098689"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098686"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098688"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-589"></a><span>
</span><a name="line-590"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098690"><a href="#local-6989586621682098690"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098691"><a href="#local-6989586621682098691"><span class="hs-identifier">listTy</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsListTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098692"><a href="#local-6989586621682098692"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-591"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098693"><a href="#local-6989586621682098693"><span class="hs-identifier">data_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DataKinds</span><span>
</span><a name="line-592"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682098693"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="RnTypes.html#isRnKindLevel"><span class="hs-identifier hs-var">isRnKindLevel</span></a><span> </span><a href="#local-6989586621682098690"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>              </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#dataKindsErr"><span class="hs-identifier hs-var">dataKindsErr</span></a><span> </span><a href="#local-6989586621682098690"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098691"><span class="hs-identifier hs-var">listTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-594"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098694"><a href="#local-6989586621682098694"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098695"><a href="#local-6989586621682098695"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098690"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098692"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-595"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsListTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098694"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098695"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098696"><a href="#local-6989586621682098696"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098697"><a href="#local-6989586621682098697"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsKindSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098698"><a href="#local-6989586621682098698"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682098699"><a href="#local-6989586621682098699"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-598"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#checkPolyKinds"><span class="hs-identifier hs-var">checkPolyKinds</span></a><span> </span><a href="#local-6989586621682098696"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098697"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-599"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098700"><a href="#local-6989586621682098700"><span class="hs-identifier">kind_sigs_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.KindSignatures</span><span>
</span><a name="line-600"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682098700"><span class="hs-identifier hs-var">kind_sigs_ok</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#badKindSigErr"><span class="hs-identifier hs-var">badKindSigErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098696"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098698"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098701"><a href="#local-6989586621682098701"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098702"><a href="#local-6989586621682098702"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098696"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098698"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-602"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098703"><a href="#local-6989586621682098703"><span class="hs-identifier">k'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098704"><a href="#local-6989586621682098704"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098696"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rtke_level</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">KindLevel</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098699"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-603"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsKindSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098701"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621682098703"><span class="hs-identifier hs-var">k'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098702"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098704"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-604"></a><span>
</span><a name="line-605"></a><span class="hs-comment">-- Unboxed tuples are allowed to have poly-typed arguments.  These</span><span>
</span><a name="line-606"></a><span class="hs-comment">-- sometimes crop up as a result of CPR worker-wrappering dictionaries.</span><span>
</span><a name="line-607"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098705"><a href="#local-6989586621682098705"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098706"><a href="#local-6989586621682098706"><span class="hs-identifier">tupleTy</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTupleTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098707"><a href="#local-6989586621682098707"><span class="hs-identifier">tup_con</span></a></a><span> </span><a name="local-6989586621682098708"><a href="#local-6989586621682098708"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098709"><a href="#local-6989586621682098709"><span class="hs-identifier">data_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DataKinds</span><span>
</span><a name="line-609"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682098709"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="RnTypes.html#isRnKindLevel"><span class="hs-identifier hs-var">isRnKindLevel</span></a><span> </span><a href="#local-6989586621682098705"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-610"></a><span>              </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#dataKindsErr"><span class="hs-identifier hs-var">dataKindsErr</span></a><span> </span><a href="#local-6989586621682098705"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098706"><span class="hs-identifier hs-var">tupleTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-611"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098710"><a href="#local-6989586621682098710"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098711"><a href="#local-6989586621682098711"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098705"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098708"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-612"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTupleTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098707"><span class="hs-identifier hs-var">tup_con</span></a><span> </span><a href="#local-6989586621682098710"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098711"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-613"></a><span>
</span><a name="line-614"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098712"><a href="#local-6989586621682098712"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098713"><a href="#local-6989586621682098713"><span class="hs-identifier">sumTy</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSumTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098714"><a href="#local-6989586621682098714"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-615"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098715"><a href="#local-6989586621682098715"><span class="hs-identifier">data_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DataKinds</span><span>
</span><a name="line-616"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682098715"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="RnTypes.html#isRnKindLevel"><span class="hs-identifier hs-var">isRnKindLevel</span></a><span> </span><a href="#local-6989586621682098712"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-617"></a><span>              </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#dataKindsErr"><span class="hs-identifier hs-var">dataKindsErr</span></a><span> </span><a href="#local-6989586621682098712"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098713"><span class="hs-identifier hs-var">sumTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098716"><a href="#local-6989586621682098716"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098717"><a href="#local-6989586621682098717"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098712"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098714"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-619"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSumTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098716"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098717"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span class="hs-comment">-- Ensure that a type-level integer is nonnegative (#8306, #8412)</span><span>
</span><a name="line-622"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098718"><a href="#local-6989586621682098718"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098719"><a href="#local-6989586621682098719"><span class="hs-identifier">tyLit</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTyLit</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098720"><a href="#local-6989586621682098720"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-623"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098724"><a href="#local-6989586621682098724"><span class="hs-identifier">data_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DataKinds</span><span>
</span><a name="line-624"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682098724"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#dataKindsErr"><span class="hs-identifier hs-var">dataKindsErr</span></a><span> </span><a href="#local-6989586621682098718"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098719"><span class="hs-identifier hs-var">tyLit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-625"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098721"><span class="hs-identifier hs-var">negLit</span></a><span> </span><a href="#local-6989586621682098720"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="#local-6989586621682098722"><span class="hs-identifier hs-var">negLitErr</span></a><span class="hs-special">)</span><span>
</span><a name="line-626"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#checkPolyKinds"><span class="hs-identifier hs-var">checkPolyKinds</span></a><span> </span><a href="#local-6989586621682098718"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098719"><span class="hs-identifier hs-var">tyLit</span></a><span>
</span><a name="line-627"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTyLit</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098720"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-628"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-629"></a><span>    </span><a name="local-6989586621682098721"><a href="#local-6989586621682098721"><span class="hs-identifier">negLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsStrTy</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-630"></a><span>    </span><span class="hs-identifier">negLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsNumTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098723"><a href="#local-6989586621682098723"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098723"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-631"></a><span>    </span><a name="local-6989586621682098722"><a href="#local-6989586621682098722"><span class="hs-identifier">negLitErr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal literal in type (type literals must not be negative):&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098719"><span class="hs-identifier hs-var">tyLit</span></a><span>
</span><a name="line-632"></a><span>
</span><a name="line-633"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098725"><a href="#local-6989586621682098725"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsAppTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098726"><a href="#local-6989586621682098726"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621682098727"><a href="#local-6989586621682098727"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-634"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098728"><a href="#local-6989586621682098728"><span class="hs-identifier">ty1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098729"><a href="#local-6989586621682098729"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098725"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098726"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-635"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098730"><a href="#local-6989586621682098730"><span class="hs-identifier">ty2'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098731"><a href="#local-6989586621682098731"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098725"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098727"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-636"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsAppTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098728"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621682098730"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098729"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098731"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-637"></a><span>
</span><a name="line-638"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098732"><a href="#local-6989586621682098732"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsAppKindTy</span><span> </span><a name="local-6989586621682098733"><a href="#local-6989586621682098733"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682098734"><a href="#local-6989586621682098734"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682098735"><a href="#local-6989586621682098735"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-639"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098736"><a href="#local-6989586621682098736"><span class="hs-identifier">kind_app</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.TypeApplications</span><span>
</span><a name="line-640"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682098736"><span class="hs-identifier hs-var">kind_app</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnUtils.html#typeAppErr"><span class="hs-identifier hs-var">typeAppErr</span></a><span> </span><span class="hs-string">&quot;kind&quot;</span><span> </span><a href="#local-6989586621682098735"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098737"><a href="#local-6989586621682098737"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098738"><a href="#local-6989586621682098738"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098732"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098734"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-642"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098739"><a href="#local-6989586621682098739"><span class="hs-identifier">k'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098740"><a href="#local-6989586621682098740"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098732"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">rtke_level</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">KindLevel</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098735"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-643"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsAppKindTy</span><span> </span><a href="#local-6989586621682098733"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682098737"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621682098739"><span class="hs-identifier hs-var">k'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098738"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098740"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098741"><a href="#local-6989586621682098741"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098742"><a href="#local-6989586621682098742"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIParamTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098743"><a href="#local-6989586621682098743"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621682098744"><a href="#local-6989586621682098744"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-646"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#notInKinds"><span class="hs-identifier hs-var">notInKinds</span></a><span> </span><a href="#local-6989586621682098741"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098742"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-647"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098745"><a href="#local-6989586621682098745"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098746"><a href="#local-6989586621682098746"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098741"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098744"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-648"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIParamTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098743"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621682098745"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098746"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsStarTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098747"><a href="#local-6989586621682098747"><span class="hs-identifier">isUni</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsStarTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098747"><span class="hs-identifier hs-var">isUni</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSpliceTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098748"><a href="#local-6989586621682098748"><span class="hs-identifier">sp</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-654"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnSplice.html#rnSpliceType"><span class="hs-identifier hs-var">rnSpliceType</span></a><span> </span><a href="#local-6989586621682098748"><span class="hs-identifier hs-var">sp</span></a><span>
</span><a name="line-655"></a><span>
</span><a name="line-656"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098749"><a href="#local-6989586621682098749"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsDocTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098750"><a href="#local-6989586621682098750"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682098751"><a href="#local-6989586621682098751"><span class="hs-identifier">haddock_doc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-657"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098752"><a href="#local-6989586621682098752"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098753"><a href="#local-6989586621682098753"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098749"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098750"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-658"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098754"><a href="#local-6989586621682098754"><span class="hs-identifier">haddock_doc'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnLHsDoc"><span class="hs-identifier hs-var">rnLHsDoc</span></a><span> </span><a href="#local-6989586621682098751"><span class="hs-identifier hs-var">haddock_doc</span></a><span>
</span><a name="line-659"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsDocTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098752"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621682098754"><span class="hs-identifier hs-var">haddock_doc'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098753"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NHsCoreTy</span><span> </span><a name="local-6989586621682098755"><a href="#local-6989586621682098755"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NHsCoreTy</span><span> </span><a href="#local-6989586621682098755"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>    </span><span class="hs-comment">-- The emptyFVs probably isn't quite right</span><span>
</span><a name="line-664"></a><span>    </span><span class="hs-comment">-- but I don't think it matters</span><span>
</span><a name="line-665"></a><span>
</span><a name="line-666"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098756"><a href="#local-6989586621682098756"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098757"><a href="#local-6989586621682098757"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsExplicitListTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098758"><a href="#local-6989586621682098758"><span class="hs-identifier">ip</span></a></a><span> </span><a name="local-6989586621682098759"><a href="#local-6989586621682098759"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#checkPolyKinds"><span class="hs-identifier hs-var">checkPolyKinds</span></a><span> </span><a href="#local-6989586621682098756"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098757"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-668"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098760"><a href="#local-6989586621682098760"><span class="hs-identifier">data_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DataKinds</span><span>
</span><a name="line-669"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682098760"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#dataKindsErr"><span class="hs-identifier hs-var">dataKindsErr</span></a><span> </span><a href="#local-6989586621682098756"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098757"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-670"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098761"><a href="#local-6989586621682098761"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098762"><a href="#local-6989586621682098762"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098756"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098759"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-671"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsExplicitListTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098758"><span class="hs-identifier hs-var">ip</span></a><span> </span><a href="#local-6989586621682098761"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098762"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-672"></a><span>
</span><a name="line-673"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098763"><a href="#local-6989586621682098763"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098764"><a href="#local-6989586621682098764"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsExplicitTupleTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098765"><a href="#local-6989586621682098765"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-674"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#checkPolyKinds"><span class="hs-identifier hs-var">checkPolyKinds</span></a><span> </span><a href="#local-6989586621682098763"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098764"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-675"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098766"><a href="#local-6989586621682098766"><span class="hs-identifier">data_kinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DataKinds</span><span>
</span><a name="line-676"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682098766"><span class="hs-identifier hs-var">data_kinds</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#dataKindsErr"><span class="hs-identifier hs-var">dataKindsErr</span></a><span> </span><a href="#local-6989586621682098763"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098764"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-677"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098767"><a href="#local-6989586621682098767"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098768"><a href="#local-6989586621682098768"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098763"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098765"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-678"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsExplicitTupleTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098767"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098768"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><span class="hs-identifier">rnHsTyKi</span><span> </span><a name="local-6989586621682098769"><a href="#local-6989586621682098769"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWildCardTy</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#checkAnonWildCard"><span class="hs-identifier hs-var">checkAnonWildCard</span></a><span> </span><a href="#local-6989586621682098769"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-682"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWildCardTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-685"></a><span class="hs-identifier">rnTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-686"></a><a name="rnTyVar"><a href="RnTypes.html#rnTyVar"><span class="hs-identifier">rnTyVar</span></a></a><span> </span><a name="local-6989586621682098770"><a href="#local-6989586621682098770"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098771"><a href="#local-6989586621682098771"><span class="hs-identifier">rdr_name</span></a></a><span>
</span><a name="line-687"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098772"><a href="#local-6989586621682098772"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupTypeOccRn"><span class="hs-identifier hs-var">lookupTypeOccRn</span></a><span> </span><a href="#local-6989586621682098771"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-688"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#checkNamedWildCard"><span class="hs-identifier hs-var">checkNamedWildCard</span></a><span> </span><a href="#local-6989586621682098770"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098772"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-689"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682098772"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-690"></a><span>
</span><a name="line-691"></a><span class="hs-identifier">rnLTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-692"></a><span class="hs-comment">-- Called externally; does not deal with wildards</span><span>
</span><a name="line-693"></a><a name="rnLTyVar"><a href="RnTypes.html#rnLTyVar"><span class="hs-identifier">rnLTyVar</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098773"><a href="#local-6989586621682098773"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682098774"><a href="#local-6989586621682098774"><span class="hs-identifier">rdr_name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-694"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098775"><a href="#local-6989586621682098775"><span class="hs-identifier">tyvar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupTypeOccRn"><span class="hs-identifier hs-var">lookupTypeOccRn</span></a><span> </span><a href="#local-6989586621682098774"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-695"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098773"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682098775"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-696"></a><span>
</span><a name="line-697"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-698"></a><span class="hs-identifier">rnHsTyOp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="#local-6989586621682098476"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-699"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682098476"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-700"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-701"></a><a name="rnHsTyOp"><a href="RnTypes.html#rnHsTyOp"><span class="hs-identifier">rnHsTyOp</span></a></a><span> </span><a name="local-6989586621682098776"><a href="#local-6989586621682098776"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098777"><a href="#local-6989586621682098777"><span class="hs-identifier">overall_ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098778"><a href="#local-6989586621682098778"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682098779"><a href="#local-6989586621682098779"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-702"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098780"><a href="#local-6989586621682098780"><span class="hs-identifier">ops_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.TypeOperators</span><span>
</span><a name="line-703"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098781"><a href="#local-6989586621682098781"><span class="hs-identifier">op'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnTyVar"><span class="hs-identifier hs-var">rnTyVar</span></a><span> </span><a href="#local-6989586621682098776"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098779"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-704"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098780"><span class="hs-identifier hs-var">ops_ok</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621682098781"><span class="hs-identifier hs-var">op'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">eqTyConKey</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-705"></a><span>           </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#opTyErr"><span class="hs-identifier hs-var">opTyErr</span></a><span> </span><a href="#local-6989586621682098779"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621682098777"><span class="hs-identifier hs-var">overall_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-706"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098782"><a href="#local-6989586621682098782"><span class="hs-identifier">l_op'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098778"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682098781"><span class="hs-identifier hs-var">op'</span></a><span>
</span><a name="line-707"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098782"><span class="hs-identifier hs-var">l_op'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitFV</span><span> </span><a href="#local-6989586621682098781"><span class="hs-identifier hs-var">op'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span class="hs-comment">--------------</span><span>
</span><a name="line-710"></a><span class="hs-identifier">notAllowed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-711"></a><a name="notAllowed"><a href="RnTypes.html#notAllowed"><span class="hs-identifier">notAllowed</span></a></a><span> </span><a name="local-6989586621682098783"><a href="#local-6989586621682098783"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-712"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Wildcard&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><a href="#local-6989586621682098783"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;not allowed&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>
</span><a name="line-714"></a><span class="hs-identifier">checkWildCard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-715"></a><a name="checkWildCard"><a href="RnTypes.html#checkWildCard"><span class="hs-identifier">checkWildCard</span></a></a><span> </span><a name="local-6989586621682098784"><a href="#local-6989586621682098784"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682098785"><a href="#local-6989586621682098785"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-716"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682098785"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="RnUtils.html#pprHsDocContext"><span class="hs-identifier hs-var">pprHsDocContext</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098784"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-717"></a><span class="hs-identifier">checkWildCard</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-718"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-719"></a><span>
</span><a name="line-720"></a><span class="hs-identifier">checkAnonWildCard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span class="hs-comment">-- Report an error if an anonymous wildcard is illegal here</span><span>
</span><a name="line-722"></a><a name="checkAnonWildCard"><a href="RnTypes.html#checkAnonWildCard"><span class="hs-identifier">checkAnonWildCard</span></a></a><span> </span><a name="local-6989586621682098786"><a href="#local-6989586621682098786"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-723"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#checkWildCard"><span class="hs-identifier hs-var">checkWildCard</span></a><span> </span><a href="#local-6989586621682098786"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098787"><span class="hs-identifier hs-var">mb_bad</span></a><span>
</span><a name="line-724"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-725"></a><span>    </span><span class="hs-identifier">mb_bad</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-726"></a><span>    </span><a name="local-6989586621682098787"><a href="#local-6989586621682098787"><span class="hs-identifier">mb_bad</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#wildCardsAllowed"><span class="hs-identifier hs-var">wildCardsAllowed</span></a><span> </span><a href="#local-6989586621682098786"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-727"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#notAllowed"><span class="hs-identifier hs-var">notAllowed</span></a><span> </span><span class="hs-identifier hs-var">pprAnonWildCard</span><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-729"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">rtke_what</span><span> </span><a href="#local-6989586621682098786"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-730"></a><span>               </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-731"></a><span>               </span><a href="RnTypes.html#RnConstraint"><span class="hs-identifier hs-var">RnConstraint</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682098788"><span class="hs-identifier hs-var">constraint_msg</span></a><span>
</span><a name="line-732"></a><span>               </span><a href="RnTypes.html#RnTopConstraint"><span class="hs-identifier hs-var">RnTopConstraint</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682098788"><span class="hs-identifier hs-var">constraint_msg</span></a><span>
</span><a name="line-733"></a><span>
</span><a name="line-734"></a><span>    </span><a name="local-6989586621682098788"><a href="#local-6989586621682098788"><span class="hs-identifier">constraint_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span>
</span><a name="line-735"></a><span>                         </span><span class="hs-special">(</span><a href="RnTypes.html#notAllowed"><span class="hs-identifier hs-var">notAllowed</span></a><span> </span><span class="hs-identifier hs-var">pprAnonWildCard</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in a constraint&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-736"></a><span>                        </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621682098789"><span class="hs-identifier hs-var">hint_msg</span></a><span>
</span><a name="line-737"></a><span>    </span><a name="local-6989586621682098789"><a href="#local-6989586621682098789"><span class="hs-identifier">hint_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;except as the last top-level constraint of a type signature&quot;</span><span>
</span><a name="line-738"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;e.g  f :: (Eq a, _) =&gt; blah&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span class="hs-identifier">checkNamedWildCard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-741"></a><span class="hs-comment">-- Report an error if a named wildcard is illegal here</span><span>
</span><a name="line-742"></a><a name="checkNamedWildCard"><a href="RnTypes.html#checkNamedWildCard"><span class="hs-identifier">checkNamedWildCard</span></a></a><span> </span><a name="local-6989586621682098790"><a href="#local-6989586621682098790"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098791"><a href="#local-6989586621682098791"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-743"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#checkWildCard"><span class="hs-identifier hs-var">checkWildCard</span></a><span> </span><a href="#local-6989586621682098790"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098792"><span class="hs-identifier hs-var">mb_bad</span></a><span>
</span><a name="line-744"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-745"></a><span>    </span><a name="local-6989586621682098792"><a href="#local-6989586621682098792"><span class="hs-identifier">mb_bad</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098791"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elemNameSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">rtke_nwcs</span><span> </span><a href="#local-6989586621682098790"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-746"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- Not a wildcard</span><span>
</span><a name="line-747"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#wildCardsAllowed"><span class="hs-identifier hs-var">wildCardsAllowed</span></a><span> </span><a href="#local-6989586621682098790"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-748"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#notAllowed"><span class="hs-identifier hs-var">notAllowed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098791"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-749"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-750"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">rtke_what</span><span> </span><a href="#local-6989586621682098790"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-751"></a><span>               </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-comment">-- Allowed</span><span>
</span><a name="line-752"></a><span>               </span><a href="RnTypes.html#RnTopConstraint"><span class="hs-identifier hs-var">RnTopConstraint</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-comment">-- Allowed</span><span>
</span><a name="line-753"></a><span>               </span><a href="RnTypes.html#RnConstraint"><span class="hs-identifier hs-var">RnConstraint</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682098793"><span class="hs-identifier hs-var">constraint_msg</span></a><span>
</span><a name="line-754"></a><span>    </span><a name="local-6989586621682098793"><a href="#local-6989586621682098793"><span class="hs-identifier">constraint_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#notAllowed"><span class="hs-identifier hs-var">notAllowed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098791"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in a constraint&quot;</span><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span class="hs-identifier">wildCardsAllowed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-757"></a><span class="hs-comment">-- ^ In what contexts are wildcards permitted</span><span>
</span><a name="line-758"></a><a name="wildCardsAllowed"><a href="RnTypes.html#wildCardsAllowed"><span class="hs-identifier">wildCardsAllowed</span></a></a><span> </span><a name="local-6989586621682098794"><a href="#local-6989586621682098794"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-759"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">rtke_ctxt</span><span> </span><a href="#local-6989586621682098794"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-760"></a><span>       </span><a href="RnUtils.html#TypeSigCtx"><span class="hs-identifier hs-var">TypeSigCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-761"></a><span>       </span><a href="RnUtils.html#TypBrCtx"><span class="hs-identifier hs-var">TypBrCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- Template Haskell quoted type</span><span>
</span><a name="line-762"></a><span>       </span><a href="RnUtils.html#SpliceTypeCtx"><span class="hs-identifier hs-var">SpliceTypeCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- Result of a Template Haskell splice</span><span>
</span><a name="line-763"></a><span>       </span><a href="RnUtils.html#ExprWithTySigCtx"><span class="hs-identifier hs-var">ExprWithTySigCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-764"></a><span>       </span><a href="RnUtils.html#PatCtx"><span class="hs-identifier hs-var">PatCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-765"></a><span>       </span><a href="RnUtils.html#RuleCtx"><span class="hs-identifier hs-var">RuleCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-766"></a><span>       </span><a href="RnUtils.html#FamPatCtx"><span class="hs-identifier hs-var">FamPatCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- Not named wildcards though</span><span>
</span><a name="line-767"></a><span>       </span><a href="RnUtils.html#GHCiCtx"><span class="hs-identifier hs-var">GHCiCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-768"></a><span>       </span><a href="RnUtils.html#HsTypeCtx"><span class="hs-identifier hs-var">HsTypeCtx</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-769"></a><span>       </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-770"></a><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><span>
</span><a name="line-773"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-774"></a><span class="hs-comment">-- | Ensures either that we're in a type or that -XPolyKinds is set</span><span>
</span><a name="line-775"></a><span class="hs-identifier">checkPolyKinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="#local-6989586621682098475"><span class="hs-identifier hs-type">ty</span></a><span>
</span><a name="line-776"></a><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span>
</span><a name="line-777"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682098475"><span class="hs-identifier hs-type">ty</span></a><span>      </span><span class="hs-comment">-- ^ type</span><span>
</span><a name="line-778"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-779"></a><a name="checkPolyKinds"><a href="RnTypes.html#checkPolyKinds"><span class="hs-identifier">checkPolyKinds</span></a></a><span> </span><a name="local-6989586621682098795"><a href="#local-6989586621682098795"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098796"><a href="#local-6989586621682098796"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-780"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="RnTypes.html#isRnKindLevel"><span class="hs-identifier hs-var">isRnKindLevel</span></a><span> </span><a href="#local-6989586621682098795"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-781"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098797"><a href="#local-6989586621682098797"><span class="hs-identifier">polykinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.PolyKinds</span><span>
</span><a name="line-782"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682098797"><span class="hs-identifier hs-var">polykinds</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-783"></a><span>         </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal kind:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098796"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$$</span><span>
</span><a name="line-784"></a><span>                 </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Did you mean to enable PolyKinds?&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-785"></a><span class="hs-identifier">checkPolyKinds</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-786"></a><span>
</span><a name="line-787"></a><span class="hs-identifier">notInKinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="#local-6989586621682098474"><span class="hs-identifier hs-type">ty</span></a><span>
</span><a name="line-788"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span>
</span><a name="line-789"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682098474"><span class="hs-identifier hs-type">ty</span></a><span>
</span><a name="line-790"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-791"></a><a name="notInKinds"><a href="RnTypes.html#notInKinds"><span class="hs-identifier">notInKinds</span></a></a><span> </span><a name="local-6989586621682098798"><a href="#local-6989586621682098798"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682098799"><a href="#local-6989586621682098799"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-792"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="RnTypes.html#isRnKindLevel"><span class="hs-identifier hs-var">isRnKindLevel</span></a><span> </span><a href="#local-6989586621682098798"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-793"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal kind:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098799"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span class="hs-identifier">notInKinds</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-795"></a><span>
</span><a name="line-796"></a><span class="hs-comment">{- *****************************************************
*                                                      *
          Binding type variables
*                                                      *
***************************************************** -}</span><span>
</span><a name="line-801"></a><span>
</span><a name="line-802"></a><span class="hs-identifier">bindSigTyVarsFV</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-803"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098473"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-804"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098473"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-805"></a><span class="hs-comment">-- Used just before renaming the defn of a function</span><span>
</span><a name="line-806"></a><span class="hs-comment">-- with a separate type signature, to bring its tyvars into scope</span><span>
</span><a name="line-807"></a><span class="hs-comment">-- With no -XScopedTypeVariables, this is a no-op</span><span>
</span><a name="line-808"></a><a name="bindSigTyVarsFV"><a href="RnTypes.html#bindSigTyVarsFV"><span class="hs-identifier">bindSigTyVarsFV</span></a></a><span> </span><a name="local-6989586621682098800"><a href="#local-6989586621682098800"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621682098801"><a href="#local-6989586621682098801"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-809"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098802"><a href="#local-6989586621682098802"><span class="hs-identifier">scoped_tyvars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.ScopedTypeVariables</span><span>
</span><a name="line-810"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682098802"><span class="hs-identifier hs-var">scoped_tyvars</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-811"></a><span>                </span><a href="#local-6989586621682098801"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-812"></a><span>          </span><span class="hs-keyword">else</span><span>
</span><a name="line-813"></a><span>                </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-6989586621682098800"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621682098801"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-814"></a><span>
</span><a name="line-815"></a><span class="hs-comment">-- | Simply bring a bunch of RdrNames into scope. No checking for</span><span>
</span><a name="line-816"></a><span class="hs-comment">-- validity, at all. The binding location is taken from the location</span><span>
</span><a name="line-817"></a><span class="hs-comment">-- on each name.</span><span>
</span><a name="line-818"></a><span class="hs-identifier">bindLRdrNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-819"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098472"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098472"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-821"></a><a name="bindLRdrNames"><a href="RnTypes.html#bindLRdrNames"><span class="hs-identifier">bindLRdrNames</span></a></a><span> </span><a name="local-6989586621682098803"><a href="#local-6989586621682098803"><span class="hs-identifier">rdrs</span></a></a><span> </span><a name="local-6989586621682098804"><a href="#local-6989586621682098804"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-822"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098805"><a href="#local-6989586621682098805"><span class="hs-identifier">var_names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#newTyVarNameRn"><span class="hs-identifier hs-var">newTyVarNameRn</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098803"><span class="hs-identifier hs-var">rdrs</span></a><span>
</span><a name="line-823"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-6989586621682098805"><span class="hs-identifier hs-var">var_names</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-824"></a><span>         </span><a href="#local-6989586621682098804"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621682098805"><span class="hs-identifier hs-var">var_names</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-825"></a><span>
</span><a name="line-826"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-827"></a><span class="hs-identifier">bindHsQTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682098470"><a href="#local-6989586621682098470"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621682098471"><a href="#local-6989586621682098471"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-828"></a><span>                 </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-829"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>         </span><span class="hs-comment">-- Just d =&gt; check for unused tvs</span><span>
</span><a name="line-830"></a><span>                                    </span><span class="hs-comment">--   d is a phrase like &quot;in the type ...&quot;</span><span>
</span><a name="line-831"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682098470"><span class="hs-identifier hs-type">a</span></a><span>            </span><span class="hs-comment">-- Just _  =&gt; an associated type decl</span><span>
</span><a name="line-832"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Kind variables from scope, no dups</span><span>
</span><a name="line-833"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsQTyVars</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-834"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsQTyVars</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098471"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-835"></a><span>                  </span><span class="hs-comment">-- The Bool is True &lt;=&gt; all kind variables used in the</span><span>
</span><a name="line-836"></a><span>                  </span><span class="hs-comment">-- kind signature are bound on the left.  Reason:</span><span>
</span><a name="line-837"></a><span>                  </span><span class="hs-comment">-- the last clause of Note [CUSKs: Complete user-supplied</span><span>
</span><a name="line-838"></a><span>                  </span><span class="hs-comment">-- kind signatures] in HsDecls</span><span>
</span><a name="line-839"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098471"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-840"></a><span>
</span><a name="line-841"></a><span class="hs-comment">-- See Note [bindHsQTyVars examples]</span><span>
</span><a name="line-842"></a><span class="hs-comment">-- (a) Bring kind variables into scope</span><span>
</span><a name="line-843"></a><span class="hs-comment">--     both (i)  passed in body_kv_occs</span><span>
</span><a name="line-844"></a><span class="hs-comment">--     and  (ii) mentioned in the kinds of hsq_bndrs</span><span>
</span><a name="line-845"></a><span class="hs-comment">-- (b) Bring type variables into scope</span><span>
</span><a name="line-846"></a><span class="hs-comment">--</span><span>
</span><a name="line-847"></a><a name="bindHsQTyVars"><a href="RnTypes.html#bindHsQTyVars"><span class="hs-identifier">bindHsQTyVars</span></a></a><span> </span><a name="local-6989586621682098806"><a href="#local-6989586621682098806"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621682098807"><a href="#local-6989586621682098807"><span class="hs-identifier">mb_in_doc</span></a></a><span> </span><a name="local-6989586621682098808"><a href="#local-6989586621682098808"><span class="hs-identifier">mb_assoc</span></a></a><span> </span><a name="local-6989586621682098809"><a href="#local-6989586621682098809"><span class="hs-identifier">body_kv_occs</span></a></a><span> </span><a name="local-6989586621682098810"><a href="#local-6989586621682098810"><span class="hs-identifier">hsq_bndrs</span></a></a><span> </span><a name="local-6989586621682098811"><a href="#local-6989586621682098811"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-848"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098817"><a href="#local-6989586621682098817"><span class="hs-identifier">hs_tv_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsQTvExplicit</span><span> </span><a href="#local-6989586621682098810"><span class="hs-identifier hs-var">hsq_bndrs</span></a><span>
</span><a name="line-849"></a><span>             </span><a name="local-6989586621682098818"><a href="#local-6989586621682098818"><span class="hs-identifier">bndr_kv_occs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extractHsTyVarBndrsKVs"><span class="hs-identifier hs-var">extractHsTyVarBndrsKVs</span></a><span> </span><a href="#local-6989586621682098817"><span class="hs-identifier hs-var">hs_tv_bndrs</span></a><span>
</span><a name="line-850"></a><span>
</span><a name="line-851"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- See Note [bindHsQTyVars examples] for what</span><span>
</span><a name="line-852"></a><span>             </span><span class="hs-comment">-- all these various things are doing</span><span>
</span><a name="line-853"></a><span>             </span><span class="hs-identifier">bndrs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">kv_occs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">implicit_kvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-854"></a><span>             </span><a name="local-6989586621682098819"><a href="#local-6989586621682098819"><span class="hs-identifier">bndrs</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">hsLTyVarLocName</span><span> </span><a href="#local-6989586621682098817"><span class="hs-identifier hs-var">hs_tv_bndrs</span></a><span>
</span><a name="line-855"></a><span>             </span><a name="local-6989586621682098820"><a href="#local-6989586621682098820"><span class="hs-identifier">kv_occs</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#nubL"><span class="hs-identifier hs-var">nubL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098818"><span class="hs-identifier hs-var">bndr_kv_occs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682098809"><span class="hs-identifier hs-var">body_kv_occs</span></a><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>                                 </span><span class="hs-comment">-- Make sure to list the binder kvs before the</span><span>
</span><a name="line-857"></a><span>                                 </span><span class="hs-comment">-- body kvs, as mandated by</span><span>
</span><a name="line-858"></a><span>                                 </span><span class="hs-comment">-- Note [Ordering of implicit variables]</span><span>
</span><a name="line-859"></a><span>             </span><a name="local-6989586621682098821"><a href="#local-6989586621682098821"><span class="hs-identifier">implicit_kvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098812"><span class="hs-identifier hs-var">filter_occs</span></a><span> </span><a href="#local-6989586621682098819"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><a href="#local-6989586621682098820"><span class="hs-identifier hs-var">kv_occs</span></a><span>
</span><a name="line-860"></a><span>             </span><span class="hs-comment">-- dep_bndrs is the subset of bndrs that are dependent</span><span>
</span><a name="line-861"></a><span>             </span><span class="hs-comment">--   i.e. appear in bndr/body_kv_occs</span><span>
</span><a name="line-862"></a><span>             </span><span class="hs-comment">-- Can't use implicit_kvs because we've deleted bndrs from that!</span><span>
</span><a name="line-863"></a><span>             </span><a name="local-6989586621682098822"><a href="#local-6989586621682098822"><span class="hs-identifier">dep_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="RnTypes.html#elemRdr"><span class="hs-identifier hs-var">elemRdr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098820"><span class="hs-identifier hs-var">kv_occs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098819"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-864"></a><span>             </span><a name="local-6989586621682098823"><a href="#local-6989586621682098823"><span class="hs-identifier">del</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">deleteBys</span><span> </span><span class="hs-identifier hs-var">eqLocated</span><span>
</span><a name="line-865"></a><span>             </span><a name="local-6989586621682098824"><a href="#local-6989586621682098824"><span class="hs-identifier">all_bound_on_lhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621682098809"><span class="hs-identifier hs-var">body_kv_occs</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621682098823"><span class="hs-identifier hs-var">del</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098819"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621682098823"><span class="hs-identifier hs-var">del</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098818"><span class="hs-identifier hs-var">bndr_kv_occs</span></a><span class="hs-special">)</span><span>
</span><a name="line-866"></a><span>
</span><a name="line-867"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;checkMixedVars3&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-868"></a><span>           </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;kv_occs&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098820"><span class="hs-identifier hs-var">kv_occs</span></a><span>
</span><a name="line-869"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;bndrs&quot;</span><span>   </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098817"><span class="hs-identifier hs-var">hs_tv_bndrs</span></a><span>
</span><a name="line-870"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;bndr_kv_occs&quot;</span><span>   </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098818"><span class="hs-identifier hs-var">bndr_kv_occs</span></a><span>
</span><a name="line-871"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;wubble&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621682098820"><span class="hs-identifier hs-var">kv_occs</span></a><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="#local-6989586621682098819"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="#local-6989586621682098818"><span class="hs-identifier hs-var">bndr_kv_occs</span></a><span class="hs-special">)</span><span>
</span><a name="line-872"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-873"></a><span>
</span><a name="line-874"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098825"><a href="#local-6989586621682098825"><span class="hs-identifier">implicit_kv_nms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#newTyVarNameRn"><span class="hs-identifier hs-var">newTyVarNameRn</span></a><span> </span><a href="#local-6989586621682098808"><span class="hs-identifier hs-var">mb_assoc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098821"><span class="hs-identifier hs-var">implicit_kvs</span></a><span>
</span><a name="line-875"></a><span>
</span><a name="line-876"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-6989586621682098825"><span class="hs-identifier hs-var">implicit_kv_nms</span></a><span>                     </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-877"></a><span>         </span><a href="RnTypes.html#bindLHsTyVarBndrs"><span class="hs-identifier hs-var">bindLHsTyVarBndrs</span></a><span> </span><a href="#local-6989586621682098806"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621682098807"><span class="hs-identifier hs-var">mb_in_doc</span></a><span> </span><a href="#local-6989586621682098808"><span class="hs-identifier hs-var">mb_assoc</span></a><span> </span><a href="#local-6989586621682098817"><span class="hs-identifier hs-var">hs_tv_bndrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682098826"><a href="#local-6989586621682098826"><span class="hs-identifier">rn_bndrs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-878"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a><span> </span><span class="hs-string">&quot;bindHsQTyVars&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098810"><span class="hs-identifier hs-var">hsq_bndrs</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098825"><span class="hs-identifier hs-var">implicit_kv_nms</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098826"><span class="hs-identifier hs-var">rn_bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-879"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098827"><a href="#local-6989586621682098827"><span class="hs-identifier">dep_bndr_nms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupLocalOccRn"><span class="hs-identifier hs-var">lookupLocalOccRn</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098822"><span class="hs-identifier hs-var">dep_bndrs</span></a><span>
</span><a name="line-880"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621682098811"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsQTvs</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsq_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsQTvsRn</span><span>
</span><a name="line-881"></a><span>                                   </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsq_implicit</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098825"><span class="hs-identifier hs-var">implicit_kv_nms</span></a><span>
</span><a name="line-882"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsq_dependent</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNameSet</span><span> </span><a href="#local-6989586621682098827"><span class="hs-identifier hs-var">dep_bndr_nms</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-883"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsq_explicit</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098826"><span class="hs-identifier hs-var">rn_bndrs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-884"></a><span>                      </span><a href="#local-6989586621682098824"><span class="hs-identifier hs-var">all_bound_on_lhs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-885"></a><span>
</span><a name="line-886"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-887"></a><span>    </span><span class="hs-identifier">filter_occs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Bound here</span><span>
</span><a name="line-888"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Potential implicit binders</span><span>
</span><a name="line-889"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Final implicit binders</span><span>
</span><a name="line-890"></a><span>    </span><span class="hs-comment">-- Filter out any potential implicit binders that are either</span><span>
</span><a name="line-891"></a><span>    </span><span class="hs-comment">-- already in scope, or are explicitly bound in the same HsQTyVars</span><span>
</span><a name="line-892"></a><span>    </span><a name="local-6989586621682098812"><a href="#local-6989586621682098812"><span class="hs-identifier">filter_occs</span></a></a><span> </span><a name="local-6989586621682098813"><a href="#local-6989586621682098813"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-6989586621682098814"><a href="#local-6989586621682098814"><span class="hs-identifier">occs</span></a></a><span>
</span><a name="line-893"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterOut</span><span> </span><a href="#local-6989586621682098815"><span class="hs-identifier hs-var">is_in_scope</span></a><span> </span><a href="#local-6989586621682098814"><span class="hs-identifier hs-var">occs</span></a><span>
</span><a name="line-894"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-895"></a><span>        </span><a name="local-6989586621682098815"><a href="#local-6989586621682098815"><span class="hs-identifier">is_in_scope</span></a></a><span> </span><a name="local-6989586621682098816"><a href="#local-6989586621682098816"><span class="hs-identifier">locc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098816"><span class="hs-identifier hs-var">locc</span></a><span> </span><span class="hs-special">`</span><a href="RnTypes.html#elemRdr"><span class="hs-identifier hs-var">elemRdr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098813"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-896"></a><span>
</span><a name="line-897"></a><span class="hs-comment">{- Note [bindHsQTyVars examples]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
   data T k (a::k1) (b::k) :: k2 -&gt; k1 -&gt; *

Then:
  hs_tv_bndrs = [k, a::k1, b::k], the explicitly-bound variables
  bndrs       = [k,a,b]

  bndr_kv_occs = [k,k1], kind variables free in kind signatures
                         of hs_tv_bndrs

  body_kv_occs = [k2,k1], kind variables free in the
                          result kind signature

  implicit_kvs = [k1,k2], kind variables free in kind signatures
                          of hs_tv_bndrs, and not bound by bndrs

* We want to quantify add implicit bindings for implicit_kvs

* The &quot;dependent&quot; bndrs (hsq_dependent) are the subset of
  bndrs that are free in bndr_kv_occs or body_kv_occs

* If implicit_body_kvs is non-empty, then there is a kind variable
  mentioned in the kind signature that is not bound &quot;on the left&quot;.
  That's one of the rules for a CUSK, so we pass that info on
  as the second argument to thing_inside.

* Order is not important in these lists.  All we are doing is
  bring Names into scope.

Finally, you may wonder why filter_occs removes in-scope variables
from bndr/body_kv_occs.  How can anything be in scope?  Answer:
HsQTyVars is /also/ used (slightly oddly) for Haskell-98 syntax
ConDecls
   data T a = forall (b::k). MkT a b
The ConDecl has a LHsQTyVars in it; but 'a' scopes over the entire
ConDecl.  Hence the local RdrEnv may be non-empty and we must filter
out 'a' from the free vars.  (Mind you, in this situation all the
implicit kind variables are bound at the data type level, so there
are none to bind in the ConDecl, so there are no implicitly bound
variables at all.

Note [Kind variable scoping]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If we have
  data T (a :: k) k = ...
we report &quot;k is out of scope&quot; for (a::k).  Reason: k is not brought
into scope until the explicit k-binding that follows.  It would be
terribly confusing to bring into scope an /implicit/ k for a's kind
and a distinct, shadowing explicit k that follows, something like
  data T {k1} (a :: k1) k = ...

So the rule is:

   the implicit binders never include any
   of the explicit binders in the group

Note that in the denerate case
  data T (a :: a) = blah
we get a complaint the second 'a' is not in scope.

That applies to foralls too: e.g.
   forall (a :: k) k . blah

But if the foralls are split, we treat the two groups separately:
   forall (a :: k). forall k. blah
Here we bring into scope an implicit k, which is later shadowed
by the explicit k.

In implementation terms

* In bindHsQTyVars 'k' is free in bndr_kv_occs; then we delete
  the binders {a,k}, and so end with no implicit binders.  Then we
  rename the binders left-to-right, and hence see that 'k' is out of
  scope in the kind of 'a'.

* Similarly in extract_hs_tv_bndrs

Note [Variables used as both types and kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We bind the type variables tvs, and kvs is the set of free variables of the
kinds in the scope of the binding. Here is one typical example:

   forall a b. a -&gt; (b::k) -&gt; (c::a)

Here, tvs will be {a,b}, and kvs {k,a}.

We must make sure that kvs includes all of variables in the kinds of type
variable bindings. For instance:

   forall k (a :: k). Proxy a

If we only look in the body of the `forall` type, we will mistakenly conclude
that kvs is {}. But in fact, the type variable `k` is also used as a kind
variable in (a :: k), later in the binding. (This mistake lead to #14710.)
So tvs is {k,a} and kvs is {k}.

NB: we do this only at the binding site of 'tvs'.
-}</span><span>
</span><a name="line-997"></a><span>
</span><a name="line-998"></a><span class="hs-identifier">bindLHsTyVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-999"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>            </span><span class="hs-comment">-- Just d =&gt; check for unused tvs</span><span>
</span><a name="line-1000"></a><span>                                           </span><span class="hs-comment">--   d is a phrase like &quot;in the type ...&quot;</span><span>
</span><a name="line-1001"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682098468"><span class="hs-identifier hs-type">a</span></a><span>               </span><span class="hs-comment">-- Just _  =&gt; an associated type decl</span><span>
</span><a name="line-1002"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- User-written tyvars</span><span>
</span><a name="line-1003"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098469"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1004"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098469"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1005"></a><a name="bindLHsTyVarBndrs"><a href="RnTypes.html#bindLHsTyVarBndrs"><span class="hs-identifier">bindLHsTyVarBndrs</span></a></a><span> </span><a name="local-6989586621682098828"><a href="#local-6989586621682098828"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621682098829"><a href="#local-6989586621682098829"><span class="hs-identifier">mb_in_doc</span></a></a><span> </span><a name="local-6989586621682098830"><a href="#local-6989586621682098830"><span class="hs-identifier">mb_assoc</span></a></a><span> </span><a name="local-6989586621682098831"><a href="#local-6989586621682098831"><span class="hs-identifier">tv_bndrs</span></a></a><span> </span><a name="local-6989586621682098832"><a href="#local-6989586621682098832"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1006"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621682098830"><span class="hs-identifier hs-var">mb_assoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnUtils.html#checkShadowedRdrNames"><span class="hs-identifier hs-var">checkShadowedRdrNames</span></a><span> </span><a href="#local-6989586621682098833"><span class="hs-identifier hs-var">tv_names_w_loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1007"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><a href="#local-6989586621682098833"><span class="hs-identifier hs-var">tv_names_w_loc</span></a><span>
</span><a name="line-1008"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621682098834"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621682098831"><span class="hs-identifier hs-var">tv_bndrs</span></a><span> </span><a href="#local-6989586621682098832"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1010"></a><span>    </span><a name="local-6989586621682098833"><a href="#local-6989586621682098833"><span class="hs-identifier">tv_names_w_loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">hsLTyVarLocName</span><span> </span><a href="#local-6989586621682098831"><span class="hs-identifier hs-var">tv_bndrs</span></a><span>
</span><a name="line-1011"></a><span>
</span><a name="line-1012"></a><span>    </span><a name="local-6989586621682098834"><a href="#local-6989586621682098834"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><a name="local-6989586621682098836"><a href="#local-6989586621682098836"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682098836"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1013"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098837"><a href="#local-6989586621682098837"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621682098838"><a href="#local-6989586621682098838"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682098839"><a href="#local-6989586621682098839"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#bindLHsTyVarBndr"><span class="hs-identifier hs-var">bindLHsTyVarBndr</span></a><span> </span><a href="#local-6989586621682098828"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621682098830"><span class="hs-identifier hs-var">mb_assoc</span></a><span> </span><a href="#local-6989586621682098837"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682098840"><a href="#local-6989586621682098840"><span class="hs-identifier">b'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1014"></a><span>                             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098842"><a href="#local-6989586621682098842"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098843"><a href="#local-6989586621682098843"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682098834"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621682098838"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682098841"><a href="#local-6989586621682098841"><span class="hs-identifier">bs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1015"></a><span>                                                </span><a href="#local-6989586621682098839"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098840"><span class="hs-identifier hs-var">b'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621682098841"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1016"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621682098835"><span class="hs-identifier hs-var">warn_unused</span></a><span> </span><a href="#local-6989586621682098840"><span class="hs-identifier hs-var">b'</span></a><span> </span><a href="#local-6989586621682098843"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1017"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098842"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098843"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1018"></a><span>
</span><a name="line-1019"></a><span>    </span><a name="local-6989586621682098835"><a href="#local-6989586621682098835"><span class="hs-identifier">warn_unused</span></a></a><span> </span><a name="local-6989586621682098844"><a href="#local-6989586621682098844"><span class="hs-identifier">tv_bndr</span></a></a><span> </span><a name="local-6989586621682098845"><a href="#local-6989586621682098845"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682098829"><span class="hs-identifier hs-var">mb_in_doc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1020"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682098846"><a href="#local-6989586621682098846"><span class="hs-identifier">in_doc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#warnUnusedForAll"><span class="hs-identifier hs-var">warnUnusedForAll</span></a><span> </span><a href="#local-6989586621682098846"><span class="hs-identifier hs-var">in_doc</span></a><span> </span><a href="#local-6989586621682098844"><span class="hs-identifier hs-var">tv_bndr</span></a><span> </span><a href="#local-6989586621682098845"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1021"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1022"></a><span>
</span><a name="line-1023"></a><span class="hs-identifier">bindLHsTyVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span>
</span><a name="line-1024"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682098466"><span class="hs-identifier hs-type">a</span></a><span>   </span><span class="hs-comment">-- associated class</span><span>
</span><a name="line-1025"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1026"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098467"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1027"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098467"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1028"></a><a name="bindLHsTyVarBndr"><a href="RnTypes.html#bindLHsTyVarBndr"><span class="hs-identifier">bindLHsTyVarBndr</span></a></a><span> </span><a name="local-6989586621682098847"><a href="#local-6989586621682098847"><span class="hs-identifier">_doc</span></a></a><span> </span><a name="local-6989586621682098848"><a href="#local-6989586621682098848"><span class="hs-identifier">mb_assoc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098849"><a href="#local-6989586621682098849"><span class="hs-identifier">loc</span></a></a><span>
</span><a name="line-1029"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UserTyVar</span><span> </span><a name="local-6989586621682098850"><a href="#local-6989586621682098850"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-1030"></a><span>                                    </span><a name="local-6989586621682098851"><a href="#local-6989586621682098851"><span class="hs-identifier">lrdr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098852"><a href="#local-6989586621682098852"><span class="hs-identifier">lv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682098853"><a href="#local-6989586621682098853"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1031"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098854"><a href="#local-6989586621682098854"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#newTyVarNameRn"><span class="hs-identifier hs-var">newTyVarNameRn</span></a><span> </span><a href="#local-6989586621682098848"><span class="hs-identifier hs-var">mb_assoc</span></a><span> </span><a href="#local-6989586621682098851"><span class="hs-identifier hs-var">lrdr</span></a><span>
</span><a name="line-1032"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682098854"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1033"></a><span>         </span><a href="#local-6989586621682098853"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098849"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">UserTyVar</span><span> </span><a href="#local-6989586621682098850"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098852"><span class="hs-identifier hs-var">lv</span></a><span> </span><a href="#local-6989586621682098854"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1034"></a><span>
</span><a name="line-1035"></a><span class="hs-identifier">bindLHsTyVarBndr</span><span> </span><a name="local-6989586621682098855"><a href="#local-6989586621682098855"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621682098856"><a href="#local-6989586621682098856"><span class="hs-identifier">mb_assoc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098857"><a href="#local-6989586621682098857"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTyVar</span><span> </span><a name="local-6989586621682098858"><a href="#local-6989586621682098858"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682098859"><a href="#local-6989586621682098859"><span class="hs-identifier">lrdr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098860"><a href="#local-6989586621682098860"><span class="hs-identifier">lv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682098861"><a href="#local-6989586621682098861"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1036"></a><span>                 </span><a name="local-6989586621682098862"><a href="#local-6989586621682098862"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1037"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098863"><a href="#local-6989586621682098863"><span class="hs-identifier">sig_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.KindSignatures</span><span>
</span><a name="line-1038"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682098863"><span class="hs-identifier hs-var">sig_ok</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#badKindSigErr"><span class="hs-identifier hs-var">badKindSigErr</span></a><span> </span><a href="#local-6989586621682098855"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621682098861"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1039"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098864"><a href="#local-6989586621682098864"><span class="hs-identifier">kind'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098865"><a href="#local-6989586621682098865"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsKind"><span class="hs-identifier hs-var">rnLHsKind</span></a><span> </span><a href="#local-6989586621682098855"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621682098861"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1040"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098866"><a href="#local-6989586621682098866"><span class="hs-identifier">tv_nm</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#newTyVarNameRn"><span class="hs-identifier hs-var">newTyVarNameRn</span></a><span> </span><a href="#local-6989586621682098856"><span class="hs-identifier hs-var">mb_assoc</span></a><span> </span><a href="#local-6989586621682098859"><span class="hs-identifier hs-var">lrdr</span></a><span>
</span><a name="line-1041"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098867"><a href="#local-6989586621682098867"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098868"><a href="#local-6989586621682098868"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682098866"><span class="hs-identifier hs-var">tv_nm</span></a><span class="hs-special">]</span><span>
</span><a name="line-1042"></a><span>               </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621682098862"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098857"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTyVar</span><span> </span><a href="#local-6989586621682098858"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098860"><span class="hs-identifier hs-var">lv</span></a><span> </span><a href="#local-6989586621682098866"><span class="hs-identifier hs-var">tv_nm</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098864"><span class="hs-identifier hs-var">kind'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1043"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098867"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098865"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682098868"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1044"></a><span>
</span><a name="line-1045"></a><span class="hs-identifier">bindLHsTyVarBndr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XTyVarBndr</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;bindLHsTyVarBndr&quot;</span><span>
</span><a name="line-1046"></a><span class="hs-identifier">bindLHsTyVarBndr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;bindLHsTyVarBndr: Impossible Match&quot;</span><span>
</span><a name="line-1047"></a><span>                             </span><span class="hs-comment">-- due to #15884</span><span>
</span><a name="line-1048"></a><span>
</span><a name="line-1049"></a><span class="hs-identifier">newTyVarNameRn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682098465"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1050"></a><a name="newTyVarNameRn"><a href="RnTypes.html#newTyVarNameRn"><span class="hs-identifier">newTyVarNameRn</span></a></a><span> </span><a name="local-6989586621682098869"><a href="#local-6989586621682098869"><span class="hs-identifier">mb_assoc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098870"><a href="#local-6989586621682098870"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682098871"><a href="#local-6989586621682098871"><span class="hs-identifier">rdr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1051"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098872"><a href="#local-6989586621682098872"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a><span>
</span><a name="line-1052"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098869"><span class="hs-identifier hs-var">mb_assoc</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">lookupLocalRdrEnv</span><span> </span><a href="#local-6989586621682098872"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621682098871"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1053"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682098873"><a href="#local-6989586621682098873"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682098873"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1054"></a><span>              </span><span class="hs-comment">-- Use the same Name as the parent class decl</span><span>
</span><a name="line-1055"></a><span>
</span><a name="line-1056"></a><span>           </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnUtils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098870"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682098871"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1057"></a><span class="hs-comment">{-
*********************************************************
*                                                       *
        ConDeclField
*                                                       *
*********************************************************

When renaming a ConDeclField, we have to find the FieldLabel
associated with each field.  But we already have all the FieldLabels
available (since they were brought into scope by
RnNames.getLocalNonValBinders), so we just take the list as an
argument, build a map and look them up.
-}</span><span>
</span><a name="line-1070"></a><span>
</span><a name="line-1071"></a><span class="hs-identifier">rnConDeclFields</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FieldLabel</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LConDeclField</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>
</span><a name="line-1072"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LConDeclField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1073"></a><span class="hs-comment">-- Also called from RnSource</span><span>
</span><a name="line-1074"></a><span class="hs-comment">-- No wildcards can appear in record fields</span><span>
</span><a name="line-1075"></a><a name="rnConDeclFields"><a href="RnTypes.html#rnConDeclFields"><span class="hs-identifier">rnConDeclFields</span></a></a><span> </span><a name="local-6989586621682098874"><a href="#local-6989586621682098874"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682098875"><a href="#local-6989586621682098875"><span class="hs-identifier">fls</span></a></a><span> </span><a name="local-6989586621682098876"><a href="#local-6989586621682098876"><span class="hs-identifier">fields</span></a></a><span>
</span><a name="line-1076"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnField"><span class="hs-identifier hs-var">rnField</span></a><span> </span><a href="#local-6989586621682098878"><span class="hs-identifier hs-var">fl_env</span></a><span> </span><a href="#local-6989586621682098877"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098876"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a name="line-1077"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1078"></a><span>    </span><a name="local-6989586621682098877"><a href="#local-6989586621682098877"><span class="hs-identifier">env</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#mkTyKiEnv"><span class="hs-identifier hs-var">mkTyKiEnv</span></a><span> </span><a href="#local-6989586621682098874"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="RnTypes.html#RnTypeBody"><span class="hs-identifier hs-var">RnTypeBody</span></a><span>
</span><a name="line-1079"></a><span>    </span><a name="local-6989586621682098878"><a href="#local-6989586621682098878"><span class="hs-identifier">fl_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkFsEnv</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">flLabel</span><span> </span><a href="#local-6989586621682098879"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098879"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621682098879"><a href="#local-6989586621682098879"><span class="hs-identifier">fl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682098875"><span class="hs-identifier hs-var">fls</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1080"></a><span>
</span><a name="line-1081"></a><span class="hs-identifier">rnField</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FastStringEnv</span><span> </span><span class="hs-identifier hs-type">FieldLabel</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LConDeclField</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1082"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LConDeclField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1083"></a><a name="rnField"><a href="RnTypes.html#rnField"><span class="hs-identifier">rnField</span></a></a><span> </span><a name="local-6989586621682098880"><a href="#local-6989586621682098880"><span class="hs-identifier">fl_env</span></a></a><span> </span><a name="local-6989586621682098881"><a href="#local-6989586621682098881"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098882"><a href="#local-6989586621682098882"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConDeclField</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098883"><a href="#local-6989586621682098883"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621682098884"><a href="#local-6989586621682098884"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682098885"><a href="#local-6989586621682098885"><span class="hs-identifier">haddock_doc</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1084"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682098891"><a href="#local-6989586621682098891"><span class="hs-identifier">new_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621682098886"><span class="hs-identifier hs-var">lookupField</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098883"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-1085"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098892"><a href="#local-6989586621682098892"><span class="hs-identifier">new_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098893"><a href="#local-6989586621682098893"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnLHsTyKi"><span class="hs-identifier hs-var">rnLHsTyKi</span></a><span> </span><a href="#local-6989586621682098881"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682098884"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1086"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682098894"><a href="#local-6989586621682098894"><span class="hs-identifier">new_haddock_doc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnHsDoc.html#rnMbLHsDoc"><span class="hs-identifier hs-var">rnMbLHsDoc</span></a><span> </span><a href="#local-6989586621682098885"><span class="hs-identifier hs-var">haddock_doc</span></a><span>
</span><a name="line-1087"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098882"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConDeclField</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098891"><span class="hs-identifier hs-var">new_names</span></a><span> </span><a href="#local-6989586621682098892"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><a href="#local-6989586621682098894"><span class="hs-identifier hs-var">new_haddock_doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1088"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098893"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1089"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1090"></a><span>    </span><span class="hs-identifier">lookupField</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FieldOcc</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FieldOcc</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span>
</span><a name="line-1091"></a><span>    </span><a name="local-6989586621682098886"><a href="#local-6989586621682098886"><span class="hs-identifier">lookupField</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FieldOcc</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098887"><a href="#local-6989586621682098887"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621682098888"><a href="#local-6989586621682098888"><span class="hs-identifier">rdr</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1092"></a><span>        </span><span class="hs-identifier hs-var">FieldOcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">flSelector</span><span> </span><a href="#local-6989586621682098890"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098887"><span class="hs-identifier hs-var">lr</span></a><span> </span><a href="#local-6989586621682098888"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1093"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1094"></a><span>        </span><a name="local-6989586621682098889"><a href="#local-6989586621682098889"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occNameFS</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">rdrNameOcc</span><span> </span><a href="#local-6989586621682098888"><span class="hs-identifier hs-var">rdr</span></a><span>
</span><a name="line-1095"></a><span>        </span><a name="local-6989586621682098890"><a href="#local-6989586621682098890"><span class="hs-identifier">fl</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">expectJust</span><span> </span><span class="hs-string">&quot;rnField&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lookupFsEnv</span><span> </span><a href="#local-6989586621682098880"><span class="hs-identifier hs-var">fl_env</span></a><span> </span><a href="#local-6989586621682098889"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-1096"></a><span>    </span><span class="hs-identifier">lookupField</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XFieldOcc</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnField&quot;</span><span>
</span><a name="line-1097"></a><span class="hs-identifier">rnField</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XConDeclField</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnField&quot;</span><span>
</span><a name="line-1098"></a><span class="hs-identifier">rnField</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnField: Impossible Match&quot;</span><span>
</span><a name="line-1099"></a><span>                             </span><span class="hs-comment">-- due to #15884</span><span>
</span><a name="line-1100"></a><span>
</span><a name="line-1101"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Fixities and precedence parsing
*                                                                      *
************************************************************************

@mkOpAppRn@ deals with operator fixities.  The argument expressions
are assumed to be already correctly arranged.  It needs the fixities
recorded in the OpApp nodes, because fixity info applies to the things
the programmer actually wrote, so you can't find it out from the Name.

Furthermore, the second argument is guaranteed not to be another
operator application.  Why? Because the parser parses all
operator applications left-associatively, EXCEPT negation, which
we need to handle specially.
Infix types are read in a *right-associative* way, so that
        a `op` b `op` c
is always read in as
        a `op` (b `op` c)

mkHsOpTyRn rearranges where necessary.  The two arguments
have already been renamed and rearranged.  It's made rather tiresome
by the presence of -&gt;, which is a separate syntactic construct.
-}</span><span>
</span><a name="line-1126"></a><span>
</span><a name="line-1127"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-1128"></a><span class="hs-comment">-- Building (ty1 `op1` (ty21 `op2` ty22))</span><span>
</span><a name="line-1129"></a><span class="hs-identifier">mkHsOpTyRn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1130"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span>
</span><a name="line-1131"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><a name="mkHsOpTyRn"><a href="RnTypes.html#mkHsOpTyRn"><span class="hs-identifier">mkHsOpTyRn</span></a></a><span> </span><a name="local-6989586621682098895"><a href="#local-6989586621682098895"><span class="hs-identifier">mk1</span></a></a><span> </span><a name="local-6989586621682098896"><a href="#local-6989586621682098896"><span class="hs-identifier">pp_op1</span></a></a><span> </span><a name="local-6989586621682098897"><a href="#local-6989586621682098897"><span class="hs-identifier">fix1</span></a></a><span> </span><a name="local-6989586621682098898"><a href="#local-6989586621682098898"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098899"><a href="#local-6989586621682098899"><span class="hs-identifier">loc2</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsOpTy</span><span> </span><a name="local-6989586621682098900"><a href="#local-6989586621682098900"><span class="hs-identifier">noExt</span></a></a><span> </span><a name="local-6989586621682098901"><a href="#local-6989586621682098901"><span class="hs-identifier">ty21</span></a></a><span> </span><a name="local-6989586621682098902"><a href="#local-6989586621682098902"><span class="hs-identifier">op2</span></a></a><span> </span><a name="local-6989586621682098903"><a href="#local-6989586621682098903"><span class="hs-identifier">ty22</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1134"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098904"><a href="#local-6989586621682098904"><span class="hs-identifier">fix2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnFixity.html#lookupTyFixityRn"><span class="hs-identifier hs-var">lookupTyFixityRn</span></a><span> </span><a href="#local-6989586621682098902"><span class="hs-identifier hs-var">op2</span></a><span>
</span><a name="line-1135"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnTypes.html#mk_hs_op_ty"><span class="hs-identifier hs-var">mk_hs_op_ty</span></a><span> </span><a href="#local-6989586621682098895"><span class="hs-identifier hs-var">mk1</span></a><span> </span><a href="#local-6989586621682098896"><span class="hs-identifier hs-var">pp_op1</span></a><span> </span><a href="#local-6989586621682098897"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098898"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1136"></a><span>                      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682098905"><a href="#local-6989586621682098905"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621682098906"><a href="#local-6989586621682098906"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">HsOpTy</span><span> </span><a href="#local-6989586621682098900"><span class="hs-identifier hs-var">noExt</span></a><span> </span><a href="#local-6989586621682098905"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621682098902"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621682098906"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1137"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682098902"><span class="hs-identifier hs-var">op2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098904"><span class="hs-identifier hs-var">fix2</span></a><span> </span><a href="#local-6989586621682098901"><span class="hs-identifier hs-var">ty21</span></a><span> </span><a href="#local-6989586621682098903"><span class="hs-identifier hs-var">ty22</span></a><span> </span><a href="#local-6989586621682098899"><span class="hs-identifier hs-var">loc2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1138"></a><span>
</span><a name="line-1139"></a><span class="hs-identifier">mkHsOpTyRn</span><span> </span><a name="local-6989586621682098907"><a href="#local-6989586621682098907"><span class="hs-identifier">mk1</span></a></a><span> </span><a name="local-6989586621682098908"><a href="#local-6989586621682098908"><span class="hs-identifier">pp_op1</span></a></a><span> </span><a name="local-6989586621682098909"><a href="#local-6989586621682098909"><span class="hs-identifier">fix1</span></a></a><span> </span><a name="local-6989586621682098910"><a href="#local-6989586621682098910"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098911"><a href="#local-6989586621682098911"><span class="hs-identifier">loc2</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFunTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098912"><a href="#local-6989586621682098912"><span class="hs-identifier">ty21</span></a></a><span> </span><a name="local-6989586621682098913"><a href="#local-6989586621682098913"><span class="hs-identifier">ty22</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1140"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#mk_hs_op_ty"><span class="hs-identifier hs-var">mk_hs_op_ty</span></a><span> </span><a href="#local-6989586621682098907"><span class="hs-identifier hs-var">mk1</span></a><span> </span><a href="#local-6989586621682098908"><span class="hs-identifier hs-var">pp_op1</span></a><span> </span><a href="#local-6989586621682098909"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098910"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1141"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFunTy</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">funTyConName</span><span> </span><span class="hs-identifier hs-var">funTyFixity</span><span> </span><a href="#local-6989586621682098912"><span class="hs-identifier hs-var">ty21</span></a><span> </span><a href="#local-6989586621682098913"><span class="hs-identifier hs-var">ty22</span></a><span> </span><a href="#local-6989586621682098911"><span class="hs-identifier hs-var">loc2</span></a><span>
</span><a name="line-1142"></a><span>
</span><a name="line-1143"></a><span class="hs-identifier">mkHsOpTyRn</span><span> </span><a name="local-6989586621682098914"><a href="#local-6989586621682098914"><span class="hs-identifier">mk1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098915"><a href="#local-6989586621682098915"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621682098916"><a href="#local-6989586621682098916"><span class="hs-identifier">ty2</span></a></a><span>              </span><span class="hs-comment">-- Default case, no rearrangment</span><span>
</span><a name="line-1144"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098914"><span class="hs-identifier hs-var">mk1</span></a><span> </span><a href="#local-6989586621682098915"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621682098916"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1145"></a><span>
</span><a name="line-1146"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-1147"></a><span class="hs-identifier">mk_hs_op_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1148"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span>
</span><a name="line-1149"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1150"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span>
</span><a name="line-1151"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><a name="mk_hs_op_ty"><a href="RnTypes.html#mk_hs_op_ty"><span class="hs-identifier">mk_hs_op_ty</span></a></a><span> </span><a name="local-6989586621682098917"><a href="#local-6989586621682098917"><span class="hs-identifier">mk1</span></a></a><span> </span><a name="local-6989586621682098918"><a href="#local-6989586621682098918"><span class="hs-identifier">op1</span></a></a><span> </span><a name="local-6989586621682098919"><a href="#local-6989586621682098919"><span class="hs-identifier">fix1</span></a></a><span> </span><a name="local-6989586621682098920"><a href="#local-6989586621682098920"><span class="hs-identifier">ty1</span></a></a><span>
</span><a name="line-1153"></a><span>            </span><a name="local-6989586621682098921"><a href="#local-6989586621682098921"><span class="hs-identifier">mk2</span></a></a><span> </span><a name="local-6989586621682098922"><a href="#local-6989586621682098922"><span class="hs-identifier">op2</span></a></a><span> </span><a name="local-6989586621682098923"><a href="#local-6989586621682098923"><span class="hs-identifier">fix2</span></a></a><span> </span><a name="local-6989586621682098924"><a href="#local-6989586621682098924"><span class="hs-identifier">ty21</span></a></a><span> </span><a name="local-6989586621682098925"><a href="#local-6989586621682098925"><span class="hs-identifier">ty22</span></a></a><span> </span><a name="local-6989586621682098926"><a href="#local-6989586621682098926"><span class="hs-identifier">loc2</span></a></a><span>
</span><a name="line-1154"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098927"><span class="hs-identifier hs-var">nofix_error</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#precParseErr"><span class="hs-identifier hs-var">precParseErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><a href="#local-6989586621682098918"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">,</span><a href="#local-6989586621682098919"><span class="hs-identifier hs-var">fix1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><a href="#local-6989586621682098922"><span class="hs-identifier hs-var">op2</span></a><span class="hs-special">,</span><a href="#local-6989586621682098923"><span class="hs-identifier hs-var">fix2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1155"></a><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098917"><span class="hs-identifier hs-var">mk1</span></a><span> </span><a href="#local-6989586621682098920"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098926"><span class="hs-identifier hs-var">loc2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098921"><span class="hs-identifier hs-var">mk2</span></a><span> </span><a href="#local-6989586621682098924"><span class="hs-identifier hs-var">ty21</span></a><span> </span><a href="#local-6989586621682098925"><span class="hs-identifier hs-var">ty22</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1156"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098928"><span class="hs-identifier hs-var">associate_right</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098917"><span class="hs-identifier hs-var">mk1</span></a><span> </span><a href="#local-6989586621682098920"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098926"><span class="hs-identifier hs-var">loc2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098921"><span class="hs-identifier hs-var">mk2</span></a><span> </span><a href="#local-6989586621682098924"><span class="hs-identifier hs-var">ty21</span></a><span> </span><a href="#local-6989586621682098925"><span class="hs-identifier hs-var">ty22</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1157"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Rearrange to ((ty1 `op1` ty21) `op2` ty22)</span><span>
</span><a name="line-1158"></a><span>                           </span><a name="local-6989586621682098929"><a href="#local-6989586621682098929"><span class="hs-identifier">new_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#mkHsOpTyRn"><span class="hs-identifier hs-var">mkHsOpTyRn</span></a><span> </span><a href="#local-6989586621682098917"><span class="hs-identifier hs-var">mk1</span></a><span> </span><a href="#local-6989586621682098918"><span class="hs-identifier hs-var">op1</span></a><span> </span><a href="#local-6989586621682098919"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098920"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621682098924"><span class="hs-identifier hs-var">ty21</span></a><span>
</span><a name="line-1159"></a><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098921"><span class="hs-identifier hs-var">mk2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><a href="#local-6989586621682098929"><span class="hs-identifier hs-var">new_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098925"><span class="hs-identifier hs-var">ty22</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1160"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1161"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682098927"><a href="#local-6989586621682098927"><span class="hs-identifier">nofix_error</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098928"><a href="#local-6989586621682098928"><span class="hs-identifier">associate_right</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compareFixity</span><span> </span><a href="#local-6989586621682098919"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098923"><span class="hs-identifier hs-var">fix2</span></a><span>
</span><a name="line-1162"></a><span>
</span><a name="line-1163"></a><span>
</span><a name="line-1164"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1165"></a><span class="hs-identifier">mkOpAppRn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span>             </span><span class="hs-comment">-- Left operand; already rearranged</span><span>
</span><a name="line-1166"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span>   </span><span class="hs-comment">-- Operator and fixity</span><span>
</span><a name="line-1167"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span>             </span><span class="hs-comment">-- Right operand (not an OpApp, but might</span><span>
</span><a name="line-1168"></a><span>                                       </span><span class="hs-comment">-- be a NegApp)</span><span>
</span><a name="line-1169"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span class="hs-comment">-- (e11 `op1` e12) `op2` e2</span><span>
</span><a name="line-1172"></a><a name="mkOpAppRn"><a href="RnTypes.html#mkOpAppRn"><span class="hs-identifier">mkOpAppRn</span></a></a><span> </span><a name="local-6989586621682098930"><a href="#local-6989586621682098930"><span class="hs-identifier">e1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a name="local-6989586621682098931"><a href="#local-6989586621682098931"><span class="hs-identifier">fix1</span></a></a><span> </span><a name="local-6989586621682098932"><a href="#local-6989586621682098932"><span class="hs-identifier">e11</span></a></a><span> </span><a name="local-6989586621682098933"><a href="#local-6989586621682098933"><span class="hs-identifier">op1</span></a></a><span> </span><a name="local-6989586621682098934"><a href="#local-6989586621682098934"><span class="hs-identifier">e12</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682098935"><a href="#local-6989586621682098935"><span class="hs-identifier">op2</span></a></a><span> </span><a name="local-6989586621682098936"><a href="#local-6989586621682098936"><span class="hs-identifier">fix2</span></a></a><span> </span><a name="local-6989586621682098937"><a href="#local-6989586621682098937"><span class="hs-identifier">e2</span></a></a><span>
</span><a name="line-1173"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098939"><span class="hs-identifier hs-var">nofix_error</span></a><span>
</span><a name="line-1174"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="RnTypes.html#precParseErr"><span class="hs-identifier hs-var">precParseErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682098933"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">,</span><a href="#local-6989586621682098931"><span class="hs-identifier hs-var">fix1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682098935"><span class="hs-identifier hs-var">op2</span></a><span class="hs-special">,</span><a href="#local-6989586621682098936"><span class="hs-identifier hs-var">fix2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a href="#local-6989586621682098936"><span class="hs-identifier hs-var">fix2</span></a><span> </span><a href="#local-6989586621682098930"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621682098935"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621682098937"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1176"></a><span>
</span><a name="line-1177"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098940"><span class="hs-identifier hs-var">associate_right</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1178"></a><span>    </span><a name="local-6989586621682098941"><a href="#local-6989586621682098941"><span class="hs-identifier">new_e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#mkOpAppRn"><span class="hs-identifier hs-var">mkOpAppRn</span></a><span> </span><a href="#local-6989586621682098934"><span class="hs-identifier hs-var">e12</span></a><span> </span><a href="#local-6989586621682098935"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621682098936"><span class="hs-identifier hs-var">fix2</span></a><span> </span><a href="#local-6989586621682098937"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1179"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a href="#local-6989586621682098931"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098932"><span class="hs-identifier hs-var">e11</span></a><span> </span><a href="#local-6989586621682098933"><span class="hs-identifier hs-var">op1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098938"><span class="hs-identifier hs-var">loc'</span></a><span> </span><a href="#local-6989586621682098941"><span class="hs-identifier hs-var">new_e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1180"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1181"></a><span>    </span><a name="local-6989586621682098938"><a href="#local-6989586621682098938"><span class="hs-identifier">loc'</span></a></a><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">combineLocs</span><span> </span><a href="#local-6989586621682098934"><span class="hs-identifier hs-var">e12</span></a><span> </span><a href="#local-6989586621682098937"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1182"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682098939"><a href="#local-6989586621682098939"><span class="hs-identifier">nofix_error</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098940"><a href="#local-6989586621682098940"><span class="hs-identifier">associate_right</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compareFixity</span><span> </span><a href="#local-6989586621682098931"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098936"><span class="hs-identifier hs-var">fix2</span></a><span>
</span><a name="line-1183"></a><span>
</span><a name="line-1184"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1185"></a><span class="hs-comment">--      (- neg_arg) `op` e2</span><span>
</span><a name="line-1186"></a><span class="hs-identifier">mkOpAppRn</span><span> </span><a name="local-6989586621682098942"><a href="#local-6989586621682098942"><span class="hs-identifier">e1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NegApp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098943"><a href="#local-6989586621682098943"><span class="hs-identifier">neg_arg</span></a></a><span> </span><a name="local-6989586621682098944"><a href="#local-6989586621682098944"><span class="hs-identifier">neg_name</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682098945"><a href="#local-6989586621682098945"><span class="hs-identifier">op2</span></a></a><span> </span><a name="local-6989586621682098946"><a href="#local-6989586621682098946"><span class="hs-identifier">fix2</span></a></a><span> </span><a name="local-6989586621682098947"><a href="#local-6989586621682098947"><span class="hs-identifier">e2</span></a></a><span>
</span><a name="line-1187"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098949"><span class="hs-identifier hs-var">nofix_error</span></a><span>
</span><a name="line-1188"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="RnTypes.html#precParseErr"><span class="hs-identifier hs-var">precParseErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NegateOp"><span class="hs-identifier hs-var">NegateOp</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">negateFixity</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682098945"><span class="hs-identifier hs-var">op2</span></a><span class="hs-special">,</span><a href="#local-6989586621682098946"><span class="hs-identifier hs-var">fix2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1189"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a href="#local-6989586621682098946"><span class="hs-identifier hs-var">fix2</span></a><span> </span><a href="#local-6989586621682098942"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621682098945"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621682098947"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1190"></a><span>
</span><a name="line-1191"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098950"><span class="hs-identifier hs-var">associate_right</span></a><span>
</span><a name="line-1192"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621682098951"><a href="#local-6989586621682098951"><span class="hs-identifier">new_e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#mkOpAppRn"><span class="hs-identifier hs-var">mkOpAppRn</span></a><span> </span><a href="#local-6989586621682098943"><span class="hs-identifier hs-var">neg_arg</span></a><span> </span><a href="#local-6989586621682098945"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621682098946"><span class="hs-identifier hs-var">fix2</span></a><span> </span><a href="#local-6989586621682098947"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1193"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NegApp</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098948"><span class="hs-identifier hs-var">loc'</span></a><span> </span><a href="#local-6989586621682098951"><span class="hs-identifier hs-var">new_e</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682098944"><span class="hs-identifier hs-var">neg_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1194"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1195"></a><span>    </span><a name="local-6989586621682098948"><a href="#local-6989586621682098948"><span class="hs-identifier">loc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">combineLocs</span><span> </span><a href="#local-6989586621682098943"><span class="hs-identifier hs-var">neg_arg</span></a><span> </span><a href="#local-6989586621682098947"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1196"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682098949"><a href="#local-6989586621682098949"><span class="hs-identifier">nofix_error</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098950"><a href="#local-6989586621682098950"><span class="hs-identifier">associate_right</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compareFixity</span><span> </span><span class="hs-identifier hs-var">negateFixity</span><span> </span><a href="#local-6989586621682098946"><span class="hs-identifier hs-var">fix2</span></a><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1199"></a><span class="hs-comment">--      e1 `op` - neg_arg</span><span>
</span><a name="line-1200"></a><span class="hs-identifier">mkOpAppRn</span><span> </span><a name="local-6989586621682098952"><a href="#local-6989586621682098952"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621682098953"><a href="#local-6989586621682098953"><span class="hs-identifier">op1</span></a></a><span> </span><a name="local-6989586621682098954"><a href="#local-6989586621682098954"><span class="hs-identifier">fix1</span></a></a><span> </span><a name="local-6989586621682098955"><a href="#local-6989586621682098955"><span class="hs-identifier">e2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NegApp</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NegApp can occur on the right</span><span>
</span><a name="line-1201"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682098956"><span class="hs-identifier hs-var">associate_right</span></a><span>                        </span><span class="hs-comment">-- We *want* right association</span><span>
</span><a name="line-1202"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="RnTypes.html#precParseErr"><span class="hs-identifier hs-var">precParseErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682098953"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098954"><span class="hs-identifier hs-var">fix1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NegateOp"><span class="hs-identifier hs-var">NegateOp</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">negateFixity</span><span class="hs-special">)</span><span>
</span><a name="line-1203"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a href="#local-6989586621682098954"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098952"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621682098953"><span class="hs-identifier hs-var">op1</span></a><span> </span><a href="#local-6989586621682098955"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1204"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1205"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682098956"><a href="#local-6989586621682098956"><span class="hs-identifier">associate_right</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compareFixity</span><span> </span><a href="#local-6989586621682098954"><span class="hs-identifier hs-var">fix1</span></a><span> </span><span class="hs-identifier hs-var">negateFixity</span><span>
</span><a name="line-1206"></a><span>
</span><a name="line-1207"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1208"></a><span class="hs-comment">--      Default case</span><span>
</span><a name="line-1209"></a><span class="hs-identifier">mkOpAppRn</span><span> </span><a name="local-6989586621682098957"><a href="#local-6989586621682098957"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621682098958"><a href="#local-6989586621682098958"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621682098959"><a href="#local-6989586621682098959"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-6989586621682098960"><a href="#local-6989586621682098960"><span class="hs-identifier">e2</span></a></a><span>                  </span><span class="hs-comment">-- Default case, no rearrangment</span><span>
</span><a name="line-1210"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">right_op_ok</span><span> </span><span class="hs-identifier">fix</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#right_op_ok"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><span class="hs-identifier">e2</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1211"></a><span>             </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">e1</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;---&quot;</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">op</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;---&quot;</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">fix</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;---&quot;</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">e2</span><span>
</span><a name="line-1212"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a href="#local-6989586621682098959"><span class="hs-identifier hs-var">fix</span></a><span> </span><a href="#local-6989586621682098957"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621682098958"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621682098960"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1214"></a><span>
</span><a name="line-1215"></a><span class="hs-comment">----------------------------</span><span>
</span><a name="line-1216"></a><span>
</span><a name="line-1217"></a><span class="hs-comment">-- | Name of an operator in an operator application or section</span><span>
</span><a name="line-1218"></a><span class="hs-keyword">data</span><span> </span><a name="OpName"><a href="RnTypes.html#OpName"><span class="hs-identifier">OpName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NormalOp"><a href="RnTypes.html#NormalOp"><span class="hs-identifier">NormalOp</span></a></a><span> </span><span class="hs-identifier hs-type">Name</span><span>         </span><span class="hs-comment">-- ^ A normal identifier</span><span>
</span><a name="line-1219"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="NegateOp"><a href="RnTypes.html#NegateOp"><span class="hs-identifier">NegateOp</span></a></a><span>              </span><span class="hs-comment">-- ^ Prefix negation</span><span>
</span><a name="line-1220"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="UnboundOp"><a href="RnTypes.html#UnboundOp"><span class="hs-identifier">UnboundOp</span></a></a><span> </span><span class="hs-identifier hs-type">UnboundVar</span><span>  </span><span class="hs-comment">-- ^ An unbound indentifier</span><span>
</span><a name="line-1221"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="RecFldOp"><a href="RnTypes.html#RecFldOp"><span class="hs-identifier">RecFldOp</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AmbiguousFieldOcc</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1222"></a><span>              </span><span class="hs-comment">-- ^ A (possibly ambiguous) record field occurrence</span><span>
</span><a name="line-1223"></a><span>
</span><a name="line-1224"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1225"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><a name="local-6989586621682098452"><a href="#local-6989586621682098452"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098452"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1226"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="RnTypes.html#NegateOp"><span class="hs-identifier hs-var">NegateOp</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-identifier hs-var">negateName</span><span>
</span><a name="line-1227"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#UnboundOp"><span class="hs-identifier hs-var">UnboundOp</span></a><span> </span><a name="local-6989586621682098453"><a href="#local-6989586621682098453"><span class="hs-identifier">uv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098453"><span class="hs-identifier hs-var">uv</span></a><span>
</span><a name="line-1228"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#RecFldOp"><span class="hs-identifier hs-var">RecFldOp</span></a><span> </span><a name="local-6989586621682098454"><a href="#local-6989586621682098454"><span class="hs-identifier">fld</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098454"><span class="hs-identifier hs-var">fld</span></a><span>
</span><a name="line-1229"></a><span>
</span><a name="line-1230"></a><span class="hs-identifier">get_op</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span>
</span><a name="line-1231"></a><span class="hs-comment">-- An unbound name could be either HsVar or HsUnboundVar</span><span>
</span><a name="line-1232"></a><span class="hs-comment">-- See RnExpr.rnUnboundVar</span><span>
</span><a name="line-1233"></a><a name="get_op"><a href="RnTypes.html#get_op"><span class="hs-identifier">get_op</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsVar</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098961"><a href="#local-6989586621682098961"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682098961"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1234"></a><span class="hs-identifier">get_op</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsUnboundVar</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098962"><a href="#local-6989586621682098962"><span class="hs-identifier">uv</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#UnboundOp"><span class="hs-identifier hs-var">UnboundOp</span></a><span> </span><a href="#local-6989586621682098962"><span class="hs-identifier hs-var">uv</span></a><span>
</span><a name="line-1235"></a><span class="hs-identifier">get_op</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFld</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682098963"><a href="#local-6989586621682098963"><span class="hs-identifier">fld</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#RecFldOp"><span class="hs-identifier hs-var">RecFldOp</span></a><span> </span><a href="#local-6989586621682098963"><span class="hs-identifier hs-var">fld</span></a><span>
</span><a name="line-1236"></a><span class="hs-identifier">get_op</span><span> </span><a name="local-6989586621682098964"><a href="#local-6989586621682098964"><span class="hs-identifier">other</span></a></a><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;get_op&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682098964"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-1237"></a><span>
</span><a name="line-1238"></a><span class="hs-comment">-- Parser left-associates everything, but</span><span>
</span><a name="line-1239"></a><span class="hs-comment">-- derived instances may have correctly-associated things to</span><span>
</span><a name="line-1240"></a><span class="hs-comment">-- in the right operand.  So we just check that the right operand is OK</span><span>
</span><a name="line-1241"></a><span class="hs-identifier">right_op_ok</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1242"></a><a name="right_op_ok"><a href="RnTypes.html#right_op_ok"><span class="hs-identifier">right_op_ok</span></a></a><span> </span><a name="local-6989586621682098965"><a href="#local-6989586621682098965"><span class="hs-identifier">fix1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a name="local-6989586621682098966"><a href="#local-6989586621682098966"><span class="hs-identifier">fix2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1243"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682098967"><span class="hs-identifier hs-var">error_please</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621682098968"><span class="hs-identifier hs-var">associate_right</span></a><span>
</span><a name="line-1244"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1245"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682098967"><a href="#local-6989586621682098967"><span class="hs-identifier">error_please</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098968"><a href="#local-6989586621682098968"><span class="hs-identifier">associate_right</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compareFixity</span><span> </span><a href="#local-6989586621682098965"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098966"><span class="hs-identifier hs-var">fix2</span></a><span>
</span><a name="line-1246"></a><span class="hs-identifier">right_op_ok</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1247"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1248"></a><span>
</span><a name="line-1249"></a><span class="hs-comment">-- Parser initially makes negation bind more tightly than any other operator</span><span>
</span><a name="line-1250"></a><span class="hs-comment">-- And &quot;deriving&quot; code should respect this (use HsPar if not)</span><span>
</span><a name="line-1251"></a><span class="hs-identifier">mkNegAppRn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GhcPass</span><span> </span><a href="#local-6989586621682098464"><span class="hs-identifier hs-type">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SyntaxExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GhcPass</span><span> </span><a href="#local-6989586621682098464"><span class="hs-identifier hs-type">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1252"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GhcPass</span><span> </span><a href="#local-6989586621682098464"><span class="hs-identifier hs-type">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1253"></a><a name="mkNegAppRn"><a href="RnTypes.html#mkNegAppRn"><span class="hs-identifier">mkNegAppRn</span></a></a><span> </span><a name="local-6989586621682098969"><a href="#local-6989586621682098969"><span class="hs-identifier">neg_arg</span></a></a><span> </span><a name="local-6989586621682098970"><a href="#local-6989586621682098970"><span class="hs-identifier">neg_name</span></a></a><span>
</span><a name="line-1254"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not_op_app</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unLoc</span><span> </span><span class="hs-identifier">neg_arg</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1255"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NegApp</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098969"><span class="hs-identifier hs-var">neg_arg</span></a><span> </span><a href="#local-6989586621682098970"><span class="hs-identifier hs-var">neg_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1256"></a><span>
</span><a name="line-1257"></a><span class="hs-identifier">not_op_app</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span> </span><a href="#local-6989586621682098463"><span class="hs-identifier hs-type">id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1258"></a><a name="not_op_app"><a href="RnTypes.html#not_op_app"><span class="hs-identifier">not_op_app</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1259"></a><span class="hs-identifier">not_op_app</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1260"></a><span>
</span><a name="line-1261"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1262"></a><span class="hs-identifier">mkOpFormRn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsCmdTop</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span>            </span><span class="hs-comment">-- Left operand; already rearranged</span><span>
</span><a name="line-1263"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span>     </span><span class="hs-comment">-- Operator and fixity</span><span>
</span><a name="line-1264"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsCmdTop</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span>             </span><span class="hs-comment">-- Right operand (not an infix)</span><span>
</span><a name="line-1265"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsCmd</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1266"></a><span>
</span><a name="line-1267"></a><span class="hs-comment">-- (e11 `op1` e12) `op2` e2</span><span>
</span><a name="line-1268"></a><a name="mkOpFormRn"><a href="RnTypes.html#mkOpFormRn"><span class="hs-identifier">mkOpFormRn</span></a></a><span> </span><a name="local-6989586621682098971"><a href="#local-6989586621682098971"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098972"><a href="#local-6989586621682098972"><span class="hs-identifier">loc</span></a></a><span>
</span><a name="line-1269"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdTop</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1270"></a><span>                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdArrForm</span><span> </span><a name="local-6989586621682098973"><a href="#local-6989586621682098973"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682098974"><a href="#local-6989586621682098974"><span class="hs-identifier">op1</span></a></a><span> </span><a name="local-6989586621682098975"><a href="#local-6989586621682098975"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682098976"><a href="#local-6989586621682098976"><span class="hs-identifier">fix1</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1271"></a><span>                        </span><span class="hs-special">[</span><a name="local-6989586621682098977"><a href="#local-6989586621682098977"><span class="hs-identifier">a11</span></a></a><span class="hs-special">,</span><a name="local-6989586621682098978"><a href="#local-6989586621682098978"><span class="hs-identifier">a12</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1272"></a><span>        </span><a name="local-6989586621682098979"><a href="#local-6989586621682098979"><span class="hs-identifier">op2</span></a></a><span> </span><a name="local-6989586621682098980"><a href="#local-6989586621682098980"><span class="hs-identifier">fix2</span></a></a><span> </span><a name="local-6989586621682098981"><a href="#local-6989586621682098981"><span class="hs-identifier">a2</span></a></a><span>
</span><a name="line-1273"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098982"><span class="hs-identifier hs-var">nofix_error</span></a><span>
</span><a name="line-1274"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="RnTypes.html#precParseErr"><span class="hs-identifier hs-var">precParseErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682098974"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">,</span><a href="#local-6989586621682098976"><span class="hs-identifier hs-var">fix1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682098979"><span class="hs-identifier hs-var">op2</span></a><span class="hs-special">,</span><a href="#local-6989586621682098980"><span class="hs-identifier hs-var">fix2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1275"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdArrForm</span><span> </span><a href="#local-6989586621682098973"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682098979"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621682098975"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682098980"><span class="hs-identifier hs-var">fix2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682098971"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098981"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1276"></a><span>
</span><a name="line-1277"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682098983"><span class="hs-identifier hs-var">associate_right</span></a><span>
</span><a name="line-1278"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621682098984"><a href="#local-6989586621682098984"><span class="hs-identifier">new_c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#mkOpFormRn"><span class="hs-identifier hs-var">mkOpFormRn</span></a><span> </span><a href="#local-6989586621682098978"><span class="hs-identifier hs-var">a12</span></a><span> </span><a href="#local-6989586621682098979"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621682098980"><span class="hs-identifier hs-var">fix2</span></a><span> </span><a href="#local-6989586621682098981"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-1279"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdArrForm</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098974"><span class="hs-identifier hs-var">op1</span></a><span> </span><a href="#local-6989586621682098975"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682098976"><span class="hs-identifier hs-var">fix1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1280"></a><span>               </span><span class="hs-special">[</span><a href="#local-6989586621682098977"><span class="hs-identifier hs-var">a11</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098972"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdTop</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098972"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682098984"><span class="hs-identifier hs-var">new_c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1281"></a><span>        </span><span class="hs-comment">-- TODO: locs are wrong</span><span>
</span><a name="line-1282"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1283"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682098982"><a href="#local-6989586621682098982"><span class="hs-identifier">nofix_error</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098983"><a href="#local-6989586621682098983"><span class="hs-identifier">associate_right</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compareFixity</span><span> </span><a href="#local-6989586621682098976"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098980"><span class="hs-identifier hs-var">fix2</span></a><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><span class="hs-comment">--      Default case</span><span>
</span><a name="line-1286"></a><span class="hs-identifier">mkOpFormRn</span><span> </span><a name="local-6989586621682098985"><a href="#local-6989586621682098985"><span class="hs-identifier">arg1</span></a></a><span> </span><a name="local-6989586621682098986"><a href="#local-6989586621682098986"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621682098987"><a href="#local-6989586621682098987"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-6989586621682098988"><a href="#local-6989586621682098988"><span class="hs-identifier">arg2</span></a></a><span>                     </span><span class="hs-comment">-- Default case, no rearrangment</span><span>
</span><a name="line-1287"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdArrForm</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682098986"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-identifier hs-var">Infix</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682098987"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682098985"><span class="hs-identifier hs-var">arg1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098988"><span class="hs-identifier hs-var">arg2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1288"></a><span>
</span><a name="line-1289"></a><span>
</span><a name="line-1290"></a><span class="hs-comment">--------------------------------------</span><span>
</span><a name="line-1291"></a><span class="hs-identifier">mkConOpPatRn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span>
</span><a name="line-1292"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1293"></a><span>
</span><a name="line-1294"></a><a name="mkConOpPatRn"><a href="RnTypes.html#mkConOpPatRn"><span class="hs-identifier">mkConOpPatRn</span></a></a><span> </span><a name="local-6989586621682098989"><a href="#local-6989586621682098989"><span class="hs-identifier">op2</span></a></a><span> </span><a name="local-6989586621682098990"><a href="#local-6989586621682098990"><span class="hs-identifier">fix2</span></a></a><span> </span><a name="local-6989586621682098991"><a href="#local-6989586621682098991"><span class="hs-identifier">p1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682098992"><a href="#local-6989586621682098992"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a name="local-6989586621682098993"><a href="#local-6989586621682098993"><span class="hs-identifier">op1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a name="local-6989586621682098994"><a href="#local-6989586621682098994"><span class="hs-identifier">p11</span></a></a><span> </span><a name="local-6989586621682098995"><a href="#local-6989586621682098995"><span class="hs-identifier">p12</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682098996"><a href="#local-6989586621682098996"><span class="hs-identifier">p2</span></a></a><span>
</span><a name="line-1295"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682098997"><a href="#local-6989586621682098997"><span class="hs-identifier">fix1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnFixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682098993"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1296"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682098998"><a href="#local-6989586621682098998"><span class="hs-identifier">nofix_error</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682098999"><a href="#local-6989586621682098999"><span class="hs-identifier">associate_right</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compareFixity</span><span> </span><a href="#local-6989586621682098997"><span class="hs-identifier hs-var">fix1</span></a><span> </span><a href="#local-6989586621682098990"><span class="hs-identifier hs-var">fix2</span></a><span>
</span><a name="line-1297"></a><span>
</span><a name="line-1298"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621682098998"><span class="hs-identifier hs-var">nofix_error</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1299"></a><span>                </span><span class="hs-special">{</span><span> </span><a href="RnTypes.html#precParseErr"><span class="hs-identifier hs-var">precParseErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682098993"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621682098997"><span class="hs-identifier hs-var">fix1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1300"></a><span>                               </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682098989"><span class="hs-identifier hs-var">op2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621682098990"><span class="hs-identifier hs-var">fix2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1301"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a href="#local-6989586621682098989"><span class="hs-identifier hs-var">op2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a href="#local-6989586621682098991"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621682098996"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1302"></a><span>
</span><a name="line-1303"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621682098999"><span class="hs-identifier hs-var">associate_right</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1304"></a><span>                </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682099000"><a href="#local-6989586621682099000"><span class="hs-identifier">new_p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#mkConOpPatRn"><span class="hs-identifier hs-var">mkConOpPatRn</span></a><span> </span><a href="#local-6989586621682098989"><span class="hs-identifier hs-var">op2</span></a><span> </span><a href="#local-6989586621682098990"><span class="hs-identifier hs-var">fix2</span></a><span> </span><a href="#local-6989586621682098995"><span class="hs-identifier hs-var">p12</span></a><span> </span><a href="#local-6989586621682098996"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-1305"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a href="#local-6989586621682098993"><span class="hs-identifier hs-var">op1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a href="#local-6989586621682098994"><span class="hs-identifier hs-var">p11</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682098992"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682099000"><span class="hs-identifier hs-var">new_p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1306"></a><span>                </span><span class="hs-comment">-- XXX loc right?</span><span>
</span><a name="line-1307"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a href="#local-6989586621682098989"><span class="hs-identifier hs-var">op2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a href="#local-6989586621682098991"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621682098996"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1308"></a><span>
</span><a name="line-1309"></a><span class="hs-identifier">mkConOpPatRn</span><span> </span><a name="local-6989586621682099001"><a href="#local-6989586621682099001"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099002"><a href="#local-6989586621682099002"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621682099003"><a href="#local-6989586621682099003"><span class="hs-identifier">p2</span></a></a><span>                         </span><span class="hs-comment">-- Default case, no rearrangment</span><span>
</span><a name="line-1310"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not_op_pat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unLoc</span><span> </span><a href="RnTypes.html#not_op_pat"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1311"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a href="#local-6989586621682099001"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a href="#local-6989586621682099002"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621682099003"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1312"></a><span>
</span><a name="line-1313"></a><span class="hs-identifier">not_op_pat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1314"></a><a name="not_op_pat"><a href="RnTypes.html#not_op_pat"><span class="hs-identifier">not_op_pat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1315"></a><span class="hs-identifier">not_op_pat</span><span> </span><span class="hs-identifier">_</span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1316"></a><span>
</span><a name="line-1317"></a><span class="hs-comment">--------------------------------------</span><span>
</span><a name="line-1318"></a><span class="hs-identifier">checkPrecMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MatchGroup</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><a href="#local-6989586621682098462"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1319"></a><span>  </span><span class="hs-comment">-- Check precedence of a function binding written infix</span><span>
</span><a name="line-1320"></a><span>  </span><span class="hs-comment">--   eg  a `op` b `C` c = ...</span><span>
</span><a name="line-1321"></a><span>  </span><span class="hs-comment">-- See comments with rnExpr (OpApp ...) about &quot;deriving&quot;</span><span>
</span><a name="line-1322"></a><span>
</span><a name="line-1323"></a><a name="checkPrecMatch"><a href="RnTypes.html#checkPrecMatch"><span class="hs-identifier">checkPrecMatch</span></a></a><span> </span><a name="local-6989586621682099004"><a href="#local-6989586621682099004"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MG</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_alts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099005"><a href="#local-6989586621682099005"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1324"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="#local-6989586621682099006"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621682099005"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-1325"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1326"></a><span>    </span><a name="local-6989586621682099006"><a href="#local-6989586621682099006"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682099007"><a href="#local-6989586621682099007"><span class="hs-identifier">l1</span></a></a><span> </span><a name="local-6989586621682099008"><a href="#local-6989586621682099008"><span class="hs-identifier">p1</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1327"></a><span>                                   </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682099009"><a href="#local-6989586621682099009"><span class="hs-identifier">l2</span></a></a><span> </span><a name="local-6989586621682099010"><a href="#local-6989586621682099010"><span class="hs-identifier">p2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1328"></a><span>                                   </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">combineSrcSpans</span><span> </span><a href="#local-6989586621682099007"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621682099009"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1330"></a><span>        </span><span class="hs-keyword">do</span><span> </span><a href="RnTypes.html#checkPrec"><span class="hs-identifier hs-var">checkPrec</span></a><span> </span><a href="#local-6989586621682099004"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621682099008"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1331"></a><span>           </span><a href="RnTypes.html#checkPrec"><span class="hs-identifier hs-var">checkPrec</span></a><span> </span><a href="#local-6989586621682099004"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621682099010"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1332"></a><span>
</span><a name="line-1333"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1334"></a><span>        </span><span class="hs-comment">-- This can happen.  Consider</span><span>
</span><a name="line-1335"></a><span>        </span><span class="hs-comment">--      a `op` True = ...</span><span>
</span><a name="line-1336"></a><span>        </span><span class="hs-comment">--      op          = ...</span><span>
</span><a name="line-1337"></a><span>        </span><span class="hs-comment">-- The infix flag comes from the first binding of the group</span><span>
</span><a name="line-1338"></a><span>        </span><span class="hs-comment">-- but the second eqn has no args (an error, but not discovered</span><span>
</span><a name="line-1339"></a><span>        </span><span class="hs-comment">-- until the type checker).  So we don't want to crash on the</span><span>
</span><a name="line-1340"></a><span>        </span><span class="hs-comment">-- second eqn.</span><span>
</span><a name="line-1341"></a><span class="hs-identifier">checkPrecMatch</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XMatchGroup</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;checkPrecMatch&quot;</span><span>
</span><a name="line-1342"></a><span>
</span><a name="line-1343"></a><span class="hs-identifier">checkPrec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IOEnv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Env</span><span> </span><span class="hs-identifier hs-type">TcGblEnv</span><span> </span><span class="hs-identifier hs-type">TcLclEnv</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1344"></a><a name="checkPrec"><a href="RnTypes.html#checkPrec"><span class="hs-identifier">checkPrec</span></a></a><span> </span><a name="local-6989586621682099011"><a href="#local-6989586621682099011"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a name="local-6989586621682099012"><a href="#local-6989586621682099012"><span class="hs-identifier">op1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682099013"><a href="#local-6989586621682099013"><span class="hs-identifier">right</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1345"></a><span>    </span><a name="local-6989586621682099014"><a href="#local-6989586621682099014"><span class="hs-identifier">op_fix</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Fixity</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099015"><a href="#local-6989586621682099015"><span class="hs-identifier">op_prec</span></a></a><span>  </span><a name="local-6989586621682099016"><a href="#local-6989586621682099016"><span class="hs-identifier">op_dir</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnFixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span> </span><a href="#local-6989586621682099011"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-1346"></a><span>    </span><a name="local-6989586621682099017"><a href="#local-6989586621682099017"><span class="hs-identifier">op1_fix</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Fixity</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099018"><a href="#local-6989586621682099018"><span class="hs-identifier">op1_prec</span></a></a><span> </span><a name="local-6989586621682099019"><a href="#local-6989586621682099019"><span class="hs-identifier">op1_dir</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnFixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682099012"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1347"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1348"></a><span>        </span><a name="local-6989586621682099020"><a href="#local-6989586621682099020"><span class="hs-identifier">inf_ok</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099018"><span class="hs-identifier hs-var">op1_prec</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621682099015"><span class="hs-identifier hs-var">op_prec</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1349"></a><span>                 </span><span class="hs-special">(</span><a href="#local-6989586621682099018"><span class="hs-identifier hs-var">op1_prec</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621682099015"><span class="hs-identifier hs-var">op_prec</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1350"></a><span>                  </span><span class="hs-special">(</span><a href="#local-6989586621682099019"><span class="hs-identifier hs-var">op1_dir</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">InfixR</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621682099016"><span class="hs-identifier hs-var">op_dir</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">InfixR</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621682099013"><span class="hs-identifier hs-var">right</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-1351"></a><span>                   </span><a href="#local-6989586621682099019"><span class="hs-identifier hs-var">op1_dir</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">InfixL</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621682099016"><span class="hs-identifier hs-var">op_dir</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">InfixL</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682099013"><span class="hs-identifier hs-var">right</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1352"></a><span>
</span><a name="line-1353"></a><span>        </span><a name="local-6989586621682099021"><a href="#local-6989586621682099021"><span class="hs-identifier">info</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><a href="#local-6989586621682099011"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">,</span><span>          </span><a href="#local-6989586621682099014"><span class="hs-identifier hs-var">op_fix</span></a><span class="hs-special">)</span><span>
</span><a name="line-1354"></a><span>        </span><a name="local-6989586621682099022"><a href="#local-6989586621682099022"><span class="hs-identifier">info1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682099012"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682099017"><span class="hs-identifier hs-var">op1_fix</span></a><span class="hs-special">)</span><span>
</span><a name="line-1355"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621682099023"><a href="#local-6989586621682099023"><span class="hs-identifier">infol</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682099024"><a href="#local-6989586621682099024"><span class="hs-identifier">infor</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621682099013"><span class="hs-identifier hs-var">right</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682099021"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682099022"><span class="hs-identifier hs-var">info1</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682099022"><span class="hs-identifier hs-var">info1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682099021"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-1356"></a><span>    </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682099020"><span class="hs-identifier hs-var">inf_ok</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#precParseErr"><span class="hs-identifier hs-var">precParseErr</span></a><span> </span><a href="#local-6989586621682099023"><span class="hs-identifier hs-var">infol</span></a><span> </span><a href="#local-6989586621682099024"><span class="hs-identifier hs-var">infor</span></a><span class="hs-special">)</span><span>
</span><a name="line-1357"></a><span>
</span><a name="line-1358"></a><span class="hs-identifier">checkPrec</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1359"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1360"></a><span>
</span><a name="line-1361"></a><span class="hs-comment">-- Check precedence of (arg op) or (op arg) respectively</span><span>
</span><a name="line-1362"></a><span class="hs-comment">-- If arg is itself an operator application, then either</span><span>
</span><a name="line-1363"></a><span class="hs-comment">--   (a) its precedence must be higher than that of op</span><span>
</span><a name="line-1364"></a><span class="hs-comment">--   (b) its precedency &amp; associativity must be the same as that of op</span><span>
</span><a name="line-1365"></a><span class="hs-identifier">checkSectionPrec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FixityDirection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1366"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1367"></a><a name="checkSectionPrec"><a href="RnTypes.html#checkSectionPrec"><span class="hs-identifier">checkSectionPrec</span></a></a><span> </span><a name="local-6989586621682099025"><a href="#local-6989586621682099025"><span class="hs-identifier">direction</span></a></a><span> </span><a name="local-6989586621682099026"><a href="#local-6989586621682099026"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621682099027"><a href="#local-6989586621682099027"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621682099028"><a href="#local-6989586621682099028"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-1368"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682099028"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1369"></a><span>        </span><span class="hs-identifier hs-var">OpApp</span><span> </span><a name="local-6989586621682099037"><a href="#local-6989586621682099037"><span class="hs-identifier">fix</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099038"><a href="#local-6989586621682099038"><span class="hs-identifier">op'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682099030"><span class="hs-identifier hs-var">go_for_it</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682099038"><span class="hs-identifier hs-var">op'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682099037"><span class="hs-identifier hs-var">fix</span></a><span>
</span><a name="line-1370"></a><span>        </span><span class="hs-identifier hs-var">NegApp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682099030"><span class="hs-identifier hs-var">go_for_it</span></a><span> </span><a href="RnTypes.html#NegateOp"><span class="hs-identifier hs-var">NegateOp</span></a><span>     </span><span class="hs-identifier hs-var">negateFixity</span><span>
</span><a name="line-1371"></a><span>        </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1372"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1373"></a><span>    </span><a name="local-6989586621682099029"><a href="#local-6989586621682099029"><span class="hs-identifier">op_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682099027"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-1374"></a><span>    </span><a name="local-6989586621682099030"><a href="#local-6989586621682099030"><span class="hs-identifier">go_for_it</span></a></a><span> </span><a name="local-6989586621682099031"><a href="#local-6989586621682099031"><span class="hs-identifier">arg_op</span></a></a><span> </span><a name="local-6989586621682099032"><a href="#local-6989586621682099032"><span class="hs-identifier">arg_fix</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Fixity</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099033"><a href="#local-6989586621682099033"><span class="hs-identifier">arg_prec</span></a></a><span> </span><a name="local-6989586621682099034"><a href="#local-6989586621682099034"><span class="hs-identifier">assoc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1375"></a><span>          </span><a name="local-6989586621682099035"><a href="#local-6989586621682099035"><span class="hs-identifier">op_fix</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Fixity</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099036"><a href="#local-6989586621682099036"><span class="hs-identifier">op_prec</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#lookupFixityOp"><span class="hs-identifier hs-var">lookupFixityOp</span></a><span> </span><a href="#local-6989586621682099029"><span class="hs-identifier hs-var">op_name</span></a><span>
</span><a name="line-1376"></a><span>          </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682099036"><span class="hs-identifier hs-var">op_prec</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621682099033"><span class="hs-identifier hs-var">arg_prec</span></a><span>
</span><a name="line-1377"></a><span>                  </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682099036"><span class="hs-identifier hs-var">op_prec</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621682099033"><span class="hs-identifier hs-var">arg_prec</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621682099025"><span class="hs-identifier hs-var">direction</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621682099034"><span class="hs-identifier hs-var">assoc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1378"></a><span>                 </span><span class="hs-special">(</span><a href="RnTypes.html#sectionPrecErr"><span class="hs-identifier hs-var">sectionPrecErr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#get_op"><span class="hs-identifier hs-var">get_op</span></a><span> </span><a href="#local-6989586621682099027"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682099035"><span class="hs-identifier hs-var">op_fix</span></a><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><span>                                 </span><span class="hs-special">(</span><a href="#local-6989586621682099031"><span class="hs-identifier hs-var">arg_op</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682099032"><span class="hs-identifier hs-var">arg_fix</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682099026"><span class="hs-identifier hs-var">section</span></a><span class="hs-special">)</span><span>
</span><a name="line-1380"></a><span>
</span><a name="line-1381"></a><span class="hs-comment">-- | Look up the fixity for an operator name.  Be careful to use</span><span>
</span><a name="line-1382"></a><span class="hs-comment">-- 'lookupFieldFixityRn' for (possibly ambiguous) record fields</span><span>
</span><a name="line-1383"></a><span class="hs-comment">-- (see Trac #13132).</span><span>
</span><a name="line-1384"></a><span class="hs-identifier">lookupFixityOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span>
</span><a name="line-1385"></a><a name="lookupFixityOp"><a href="RnTypes.html#lookupFixityOp"><span class="hs-identifier">lookupFixityOp</span></a></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><a name="local-6989586621682099039"><a href="#local-6989586621682099039"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnFixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span> </span><a href="#local-6989586621682099039"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1386"></a><span class="hs-identifier">lookupFixityOp</span><span> </span><a href="RnTypes.html#NegateOp"><span class="hs-identifier hs-var">NegateOp</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RnFixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span> </span><span class="hs-identifier hs-var">negateName</span><span>
</span><a name="line-1387"></a><span class="hs-identifier">lookupFixityOp</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#UnboundOp"><span class="hs-identifier hs-var">UnboundOp</span></a><span> </span><a name="local-6989586621682099040"><a href="#local-6989586621682099040"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnFixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkUnboundName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unboundVarOcc</span><span> </span><a href="#local-6989586621682099040"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1388"></a><span class="hs-identifier">lookupFixityOp</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#RecFldOp"><span class="hs-identifier hs-var">RecFldOp</span></a><span> </span><a name="local-6989586621682099041"><a href="#local-6989586621682099041"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnFixity.html#lookupFieldFixityRn"><span class="hs-identifier hs-var">lookupFieldFixityRn</span></a><span> </span><a href="#local-6989586621682099041"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-1389"></a><span>
</span><a name="line-1390"></a><span>
</span><a name="line-1391"></a><span class="hs-comment">-- Precedence-related error messages</span><span>
</span><a name="line-1392"></a><span>
</span><a name="line-1393"></a><span class="hs-identifier">precParseErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1394"></a><a name="precParseErr"><a href="RnTypes.html#precParseErr"><span class="hs-identifier">precParseErr</span></a></a><span> </span><a name="local-6989586621682099042"><a href="#local-6989586621682099042"><span class="hs-identifier">op1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621682099043"><a href="#local-6989586621682099043"><span class="hs-identifier">n1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682099044"><a href="#local-6989586621682099044"><span class="hs-identifier">op2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621682099045"><a href="#local-6989586621682099045"><span class="hs-identifier">n2</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1395"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="RnTypes.html#is_unbound"><span class="hs-identifier hs-var">is_unbound</span></a><span> </span><a href="#local-6989586621682099043"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="RnTypes.html#is_unbound"><span class="hs-identifier hs-var">is_unbound</span></a><span> </span><a href="#local-6989586621682099045"><span class="hs-identifier hs-var">n2</span></a><span>
</span><a name="line-1396"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Avoid error cascade</span><span>
</span><a name="line-1397"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1398"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Precedence parsing error&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1399"></a><span>      </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;cannot mix&quot;</span><span class="hs-special">,</span><span> </span><a href="RnTypes.html#ppr_opfix"><span class="hs-identifier hs-var">ppr_opfix</span></a><span> </span><a href="#local-6989586621682099042"><span class="hs-identifier hs-var">op1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;and&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1400"></a><span>               </span><a href="RnTypes.html#ppr_opfix"><span class="hs-identifier hs-var">ppr_opfix</span></a><span> </span><a href="#local-6989586621682099044"><span class="hs-identifier hs-var">op2</span></a><span class="hs-special">,</span><span>
</span><a name="line-1401"></a><span>               </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in the same infix expression&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1402"></a><span>
</span><a name="line-1403"></a><span class="hs-identifier">sectionPrecErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1404"></a><a name="sectionPrecErr"><a href="RnTypes.html#sectionPrecErr"><span class="hs-identifier">sectionPrecErr</span></a></a><span> </span><a name="local-6989586621682099046"><a href="#local-6989586621682099046"><span class="hs-identifier">op</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621682099047"><a href="#local-6989586621682099047"><span class="hs-identifier">n1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682099048"><a href="#local-6989586621682099048"><span class="hs-identifier">arg_op</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621682099049"><a href="#local-6989586621682099049"><span class="hs-identifier">n2</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682099050"><a href="#local-6989586621682099050"><span class="hs-identifier">section</span></a></a><span>
</span><a name="line-1405"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="RnTypes.html#is_unbound"><span class="hs-identifier hs-var">is_unbound</span></a><span> </span><a href="#local-6989586621682099047"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="RnTypes.html#is_unbound"><span class="hs-identifier hs-var">is_unbound</span></a><span> </span><a href="#local-6989586621682099049"><span class="hs-identifier hs-var">n2</span></a><span>
</span><a name="line-1406"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Avoid error cascade</span><span>
</span><a name="line-1407"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1408"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;The operator&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="RnTypes.html#ppr_opfix"><span class="hs-identifier hs-var">ppr_opfix</span></a><span> </span><a href="#local-6989586621682099046"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;of a section&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1409"></a><span>         </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;must have lower precedence than that of the operand,&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1410"></a><span>                      </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;namely&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="RnTypes.html#ppr_opfix"><span class="hs-identifier hs-var">ppr_opfix</span></a><span> </span><a href="#local-6989586621682099048"><span class="hs-identifier hs-var">arg_op</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1411"></a><span>         </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in the section:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099050"><span class="hs-identifier hs-var">section</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1412"></a><span>
</span><a name="line-1413"></a><span class="hs-identifier">is_unbound</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1414"></a><a name="is_unbound"><a href="RnTypes.html#is_unbound"><span class="hs-identifier">is_unbound</span></a></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#NormalOp"><span class="hs-identifier hs-var">NormalOp</span></a><span> </span><a name="local-6989586621682099051"><a href="#local-6989586621682099051"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isUnboundName</span><span> </span><a href="#local-6989586621682099051"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1415"></a><span class="hs-identifier">is_unbound</span><span> </span><a href="RnTypes.html#UnboundOp"><span class="hs-identifier hs-var">UnboundOp</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1416"></a><span class="hs-identifier">is_unbound</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1417"></a><span>
</span><a name="line-1418"></a><span class="hs-identifier">ppr_opfix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#OpName"><span class="hs-identifier hs-type">OpName</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1419"></a><a name="ppr_opfix"><a href="RnTypes.html#ppr_opfix"><span class="hs-identifier">ppr_opfix</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621682099052"><a href="#local-6989586621682099052"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682099053"><a href="#local-6989586621682099053"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099054"><span class="hs-identifier hs-var">pp_op</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099053"><span class="hs-identifier hs-var">fixity</span></a><span class="hs-special">)</span><span>
</span><a name="line-1420"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1421"></a><span>     </span><a name="local-6989586621682099054"><a href="#local-6989586621682099054"><span class="hs-identifier">pp_op</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="RnTypes.html#NegateOp"><span class="hs-identifier hs-var">NegateOp</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682099052"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;prefix `-'&quot;</span><span>
</span><a name="line-1422"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099052"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-1423"></a><span>
</span><a name="line-1424"></a><span>
</span><a name="line-1425"></a><span class="hs-comment">{- *****************************************************
*                                                      *
                 Errors
*                                                      *
***************************************************** -}</span><span>
</span><a name="line-1430"></a><span>
</span><a name="line-1431"></a><span class="hs-identifier">unexpectedTypeSigErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1432"></a><a name="unexpectedTypeSigErr"><a href="RnTypes.html#unexpectedTypeSigErr"><span class="hs-identifier">unexpectedTypeSigErr</span></a></a><span> </span><a name="local-6989586621682099055"><a href="#local-6989586621682099055"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1433"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal type signature:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099055"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1434"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Type signatures are only allowed in patterns with ScopedTypeVariables&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1435"></a><span>
</span><a name="line-1436"></a><span class="hs-identifier">badKindSigErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1437"></a><a name="badKindSigErr"><a href="RnTypes.html#badKindSigErr"><span class="hs-identifier">badKindSigErr</span></a></a><span> </span><a name="local-6989586621682099056"><a href="#local-6989586621682099056"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682099057"><a href="#local-6989586621682099057"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682099058"><a href="#local-6989586621682099058"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1438"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682099057"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1439"></a><span>    </span><a href="RnUtils.html#withHsDocContext"><span class="hs-identifier hs-var">withHsDocContext</span></a><span> </span><a href="#local-6989586621682099056"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1440"></a><span>    </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal kind signature:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099058"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1441"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Perhaps you intended to use KindSignatures&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1442"></a><span>
</span><a name="line-1443"></a><span class="hs-identifier">dataKindsErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#RnTyKiEnv"><span class="hs-identifier hs-type">RnTyKiEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1444"></a><a name="dataKindsErr"><a href="RnTypes.html#dataKindsErr"><span class="hs-identifier">dataKindsErr</span></a></a><span> </span><a name="local-6989586621682099059"><a href="#local-6989586621682099059"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621682099060"><a href="#local-6989586621682099060"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1445"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621682099061"><span class="hs-identifier hs-var">pp_what</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099060"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1446"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Perhaps you intended to use DataKinds&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1447"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1448"></a><span>    </span><a name="local-6989586621682099061"><a href="#local-6989586621682099061"><span class="hs-identifier">pp_what</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="RnTypes.html#isRnKindLevel"><span class="hs-identifier hs-var">isRnKindLevel</span></a><span> </span><a href="#local-6989586621682099059"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;kind&quot;</span><span>
</span><a name="line-1449"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;type&quot;</span><span>
</span><a name="line-1450"></a><span>
</span><a name="line-1451"></a><span class="hs-identifier">inTypeDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1452"></a><a name="inTypeDoc"><a href="RnTypes.html#inTypeDoc"><span class="hs-identifier">inTypeDoc</span></a></a><span> </span><a name="local-6989586621682099062"><a href="#local-6989586621682099062"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In the type&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099062"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1453"></a><span>
</span><a name="line-1454"></a><span class="hs-identifier">warnUnusedForAll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1455"></a><a name="warnUnusedForAll"><a href="RnTypes.html#warnUnusedForAll"><span class="hs-identifier">warnUnusedForAll</span></a></a><span> </span><a name="local-6989586621682099063"><a href="#local-6989586621682099063"><span class="hs-identifier">in_doc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682099064"><a href="#local-6989586621682099064"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682099065"><a href="#local-6989586621682099065"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682099066"><a href="#local-6989586621682099066"><span class="hs-identifier">used_names</span></a></a><span>
</span><a name="line-1456"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><span class="hs-identifier hs-var">Opt_WarnUnusedForalls</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1457"></a><span>    </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsTyVarName</span><span> </span><a href="#local-6989586621682099065"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elemNameSet</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682099066"><span class="hs-identifier hs-var">used_names</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1458"></a><span>    </span><a href="TcRnMonad.html#addWarnAt"><span class="hs-identifier hs-var">addWarnAt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnUnusedForalls</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682099064"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1459"></a><span>    </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Unused quantified type variable&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099065"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1460"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682099063"><span class="hs-identifier hs-var">in_doc</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1461"></a><span>
</span><a name="line-1462"></a><span class="hs-identifier">opTyErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="#local-6989586621682098461"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682098461"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1463"></a><a name="opTyErr"><a href="RnTypes.html#opTyErr"><span class="hs-identifier">opTyErr</span></a></a><span> </span><a name="local-6989586621682099067"><a href="#local-6989586621682099067"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621682099068"><a href="#local-6989586621682099068"><span class="hs-identifier">overall_ty</span></a></a><span>
</span><a name="line-1464"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal operator&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099067"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;in type&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682099068"><span class="hs-identifier hs-var">overall_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1465"></a><span>         </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Use TypeOperators to allow operators in types&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1466"></a><span>
</span><a name="line-1467"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
      Finding the free type variables of a (HsType RdrName)
*                                                                      *
************************************************************************


Note [Kind and type-variable binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In a type signature we may implicitly bind type variable and, more
recently, kind variables.  For example:
  *   f :: a -&gt; a
      f = ...
    Here we need to find the free type variables of (a -&gt; a),
    so that we know what to quantify

  *   class C (a :: k) where ...
    This binds 'k' in ..., as well as 'a'

  *   f (x :: a -&gt; [a]) = ....
    Here we bind 'a' in ....

  *   f (x :: T a -&gt; T (b :: k)) = ...
    Here we bind both 'a' and the kind variable 'k'

  *   type instance F (T (a :: Maybe k)) = ...a...k...
    Here we want to constrain the kind of 'a', and bind 'k'.

In general we want to walk over a type, and find
  * Its free type variables
  * The free kind variables of any kind signatures in the type

Hence we return a pair (kind-vars, type vars)
(See Note [HsBSig binder lists] in HsTypes.)
Moreover, we preserve the left-to-right order of the first occurrence of each
variable, while preserving dependency order.
(See Note [Ordering of implicit variables].)

Most clients of this code just want to know the kind/type vars, without
duplicates. The function rmDupsInRdrTyVars removes duplicates. That function
also makes sure that no variable is reported as both a kind var and
a type var, preferring kind vars. Why kind vars? Consider this:

 foo :: forall (a :: k). Proxy k -&gt; Proxy a -&gt; ...

Should that be accepted?

Normally, if a type signature has an explicit forall, it must list *all*
tyvars mentioned in the type. But there's an exception for tyvars mentioned in
a kind, as k is above. Note that k is also used &quot;as a type variable&quot;, as the
argument to the first Proxy. So, do we consider k to be type-variable-like and
require it in the forall? Or do we consider k to be kind-variable-like and not
require it?

It's not just in type signatures: kind variables are implicitly brought into
scope in a variety of places. Should vars used at both the type level and kind
level be treated this way?

GHC indeed allows kind variables to be brought into scope implicitly even when
the kind variable is also used as a type variable. Thus, we must prefer to keep
a variable listed as a kind var in rmDupsInRdrTyVars. If we kept it as a type
var, then this would prevent it from being implicitly quantified (see
rnImplicitBndrs). In the `foo` example above, that would have the consequence
of the k in Proxy k being reported as out of scope.

Note [Ordering of implicit variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Since the advent of -XTypeApplications, GHC makes promises about the ordering
of implicit variable quantification. Specifically, we offer that implicitly
quantified variables (such as those in const :: a -&gt; b -&gt; a, without a `forall`)
will occur in left-to-right order of first occurrence. Here are a few examples:

  const :: a -&gt; b -&gt; a       -- forall a b. ...
  f :: Eq a =&gt; b -&gt; a -&gt; a   -- forall a b. ...  contexts are included

  type a &lt;-&lt; b = b -&gt; a
  g :: a &lt;-&lt; b               -- forall a b. ...  type synonyms matter

  class Functor f where
    fmap :: (a -&gt; b) -&gt; f a -&gt; f b   -- forall f a b. ...
    -- The f is quantified by the class, so only a and b are considered in fmap

This simple story is complicated by the possibility of dependency: all variables
must come after any variables mentioned in their kinds.

  typeRep :: Typeable a =&gt; TypeRep (a :: k)   -- forall k a. ...

The k comes first because a depends on k, even though the k appears later than
the a in the code. Thus, GHC does ScopedSort on the variables.
See Note [ScopedSort] in Type.

Implicitly bound variables are collected by any function which returns a
FreeKiTyVars, FreeKiTyVarsWithDups, or FreeKiTyVarsNoDups, which notably
includes the `extract-` family of functions (extractHsTysRdrTyVars,
extractHsTyVarBndrsKVs, etc.).
These functions thus promise to keep left-to-right ordering.
Look for pointers to this note to see the places where the action happens.

Note that we also maintain this ordering in kind signatures. Even though
there's no visible kind application (yet), having implicit variables be
quantified in left-to-right order in kind signatures is nice since:

* It's consistent with the treatment for type signatures.
* It can affect how types are displayed with -fprint-explicit-kinds (see
  #15568 for an example), which is a situation where knowing the order in
  which implicit variables are quantified can be useful.
* In the event that visible kind application is implemented, the order in
  which we would expect implicit variables to be ordered in kinds will have
  already been established.
-}</span><span>
</span><a name="line-1578"></a><span>
</span><a name="line-1579"></a><span class="hs-comment">-- See Note [Kind and type-variable binders]</span><span>
</span><a name="line-1580"></a><span class="hs-comment">-- These lists are guaranteed to preserve left-to-right ordering of</span><span>
</span><a name="line-1581"></a><span class="hs-comment">-- the types the variables were extracted from. See also</span><span>
</span><a name="line-1582"></a><span class="hs-comment">-- Note [Ordering of implicit variables].</span><span>
</span><a name="line-1583"></a><span class="hs-keyword">data</span><span> </span><a name="FreeKiTyVars"><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier">FreeKiTyVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FKTV"><a href="RnTypes.html#FKTV"><span class="hs-identifier">FKTV</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="fktv_kis"><a href="RnTypes.html#fktv_kis"><span class="hs-identifier">fktv_kis</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1584"></a><span>                         </span><span class="hs-special">,</span><span> </span><a name="fktv_tys"><a href="RnTypes.html#fktv_tys"><span class="hs-identifier">fktv_tys</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1585"></a><span>
</span><a name="line-1586"></a><span class="hs-comment">-- | A 'FreeKiTyVars' list that is allowed to have duplicate variables.</span><span>
</span><a name="line-1587"></a><span class="hs-keyword">type</span><span> </span><a name="FreeKiTyVarsWithDups"><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier">FreeKiTyVarsWithDups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span>
</span><a name="line-1588"></a><span>
</span><a name="line-1589"></a><span class="hs-comment">-- | A 'FreeKiTyVars' list that contains no duplicate variables.</span><span>
</span><a name="line-1590"></a><span class="hs-keyword">type</span><span> </span><a name="FreeKiTyVarsNoDups"><a href="RnTypes.html#FreeKiTyVarsNoDups"><span class="hs-identifier">FreeKiTyVarsNoDups</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span>
</span><a name="line-1591"></a><span>
</span><a name="line-1592"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1593"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098450"><a href="#local-6989586621682098450"><span class="hs-identifier">kis</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682098451"><a href="#local-6989586621682098451"><span class="hs-identifier">tys</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098450"><span class="hs-identifier hs-var">kis</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682098451"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1594"></a><span>
</span><a name="line-1595"></a><span class="hs-identifier">emptyFKTV</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#FreeKiTyVarsNoDups"><span class="hs-identifier hs-type">FreeKiTyVarsNoDups</span></a><span>
</span><a name="line-1596"></a><a name="emptyFKTV"><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier">emptyFKTV</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1597"></a><span>
</span><a name="line-1598"></a><span class="hs-identifier">freeKiTyVarsAllVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1599"></a><a name="freeKiTyVarsAllVars"><a href="RnTypes.html#freeKiTyVarsAllVars"><span class="hs-identifier">freeKiTyVarsAllVars</span></a></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099069"><a href="#local-6989586621682099069"><span class="hs-identifier">kvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099070"><a href="#local-6989586621682099070"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099069"><span class="hs-identifier hs-var">kvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682099070"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1600"></a><span>
</span><a name="line-1601"></a><span class="hs-identifier">freeKiTyVarsKindVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1602"></a><a name="freeKiTyVarsKindVars"><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier">freeKiTyVarsKindVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fktv_kis</span><span>
</span><a name="line-1603"></a><span>
</span><a name="line-1604"></a><span class="hs-identifier">freeKiTyVarsTypeVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1605"></a><a name="freeKiTyVarsTypeVars"><a href="RnTypes.html#freeKiTyVarsTypeVars"><span class="hs-identifier">freeKiTyVarsTypeVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fktv_tys</span><span>
</span><a name="line-1606"></a><span>
</span><a name="line-1607"></a><span class="hs-identifier">filterInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LocalRdrEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span>
</span><a name="line-1608"></a><a name="filterInScope"><a href="RnTypes.html#filterInScope"><span class="hs-identifier">filterInScope</span></a></a><span> </span><a name="local-6989586621682099071"><a href="#local-6989586621682099071"><span class="hs-identifier">rdr_env</span></a></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099072"><a href="#local-6989586621682099072"><span class="hs-identifier">kis</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099073"><a href="#local-6989586621682099073"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1609"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterOut</span><span> </span><a href="#local-6989586621682099074"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621682099072"><span class="hs-identifier hs-var">kis</span></a><span>
</span><a name="line-1610"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterOut</span><span> </span><a href="#local-6989586621682099074"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621682099073"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1611"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1612"></a><span>    </span><a name="local-6989586621682099074"><a href="#local-6989586621682099074"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#inScope"><span class="hs-identifier hs-var">inScope</span></a><span> </span><a href="#local-6989586621682099071"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span>
</span><a name="line-1613"></a><span>
</span><a name="line-1614"></a><span class="hs-identifier">inScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LocalRdrEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1615"></a><a name="inScope"><a href="RnTypes.html#inScope"><span class="hs-identifier">inScope</span></a></a><span> </span><a name="local-6989586621682099075"><a href="#local-6989586621682099075"><span class="hs-identifier">rdr_env</span></a></a><span> </span><a name="local-6989586621682099076"><a href="#local-6989586621682099076"><span class="hs-identifier">rdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099076"><span class="hs-identifier hs-var">rdr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elemLocalRdrEnv</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682099075"><span class="hs-identifier hs-var">rdr_env</span></a><span>
</span><a name="line-1616"></a><span>
</span><a name="line-1617"></a><span class="hs-comment">-- | 'extractHsTyRdrTyVars' finds the</span><span>
</span><a name="line-1618"></a><span class="hs-comment">--        free (kind, type) variables of an 'HsType'</span><span>
</span><a name="line-1619"></a><span class="hs-comment">-- or the free (sort, kind) variables of an 'HsKind'.</span><span>
</span><a name="line-1620"></a><span class="hs-comment">-- It's used when making the @forall@s explicit.</span><span>
</span><a name="line-1621"></a><span class="hs-comment">-- Does not return any wildcards.</span><span>
</span><a name="line-1622"></a><span class="hs-comment">-- When the same name occurs multiple times in the types, only the first</span><span>
</span><a name="line-1623"></a><span class="hs-comment">-- occurrence is returned.</span><span>
</span><a name="line-1624"></a><span class="hs-comment">-- See Note [Kind and type-variable binders]</span><span>
</span><a name="line-1625"></a><span>
</span><a name="line-1626"></a><span>
</span><a name="line-1627"></a><span class="hs-identifier">extract_tyarg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsTypeArg</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1628"></a><a name="extract_tyarg"><a href="RnTypes.html#extract_tyarg"><span class="hs-identifier">extract_tyarg</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsValArg</span><span> </span><a name="local-6989586621682099077"><a href="#local-6989586621682099077"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682099078"><a href="#local-6989586621682099078"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="#local-6989586621682099077"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682099078"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1629"></a><span class="hs-identifier">extract_tyarg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTypeArg</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099079"><a href="#local-6989586621682099079"><span class="hs-identifier">ki</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682099080"><a href="#local-6989586621682099080"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><span class="hs-identifier hs-var">KindLevel</span><span> </span><a href="#local-6989586621682099079"><span class="hs-identifier hs-var">ki</span></a><span> </span><a href="#local-6989586621682099080"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1630"></a><span class="hs-identifier">extract_tyarg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsArgPar</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682099081"><a href="#local-6989586621682099081"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099081"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1631"></a><span>
</span><a name="line-1632"></a><span class="hs-identifier">extract_tyargs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTypeArg</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1633"></a><a name="extract_tyargs"><a href="RnTypes.html#extract_tyargs"><span class="hs-identifier">extract_tyargs</span></a></a><span> </span><a name="local-6989586621682099082"><a href="#local-6989586621682099082"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621682099083"><a href="#local-6989586621682099083"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="RnTypes.html#extract_tyarg"><span class="hs-identifier hs-var">extract_tyarg</span></a><span> </span><a href="#local-6989586621682099083"><span class="hs-identifier hs-var">acc</span></a><span> </span><a href="#local-6989586621682099082"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1634"></a><span>
</span><a name="line-1635"></a><span class="hs-identifier">extractHsTyArgRdrKiTyVarsDup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTypeArg</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1636"></a><a name="extractHsTyArgRdrKiTyVarsDup"><a href="RnTypes.html#extractHsTyArgRdrKiTyVarsDup"><span class="hs-identifier">extractHsTyArgRdrKiTyVarsDup</span></a></a><span> </span><a name="local-6989586621682099084"><a href="#local-6989586621682099084"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_tyargs"><span class="hs-identifier hs-var">extract_tyargs</span></a><span> </span><a href="#local-6989586621682099084"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier hs-var">emptyFKTV</span></a><span>
</span><a name="line-1637"></a><span>
</span><a name="line-1638"></a><span class="hs-identifier">extractHsTyRdrTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsNoDups"><span class="hs-identifier hs-type">FreeKiTyVarsNoDups</span></a><span>
</span><a name="line-1639"></a><a name="extractHsTyRdrTyVars"><a href="RnTypes.html#extractHsTyRdrTyVars"><span class="hs-identifier">extractHsTyRdrTyVars</span></a></a><span> </span><a name="local-6989586621682099085"><a href="#local-6989586621682099085"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1640"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rmDupsInRdrTyVars"><span class="hs-identifier hs-var">rmDupsInRdrTyVars</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extractHsTyRdrTyVarsDups"><span class="hs-identifier hs-var">extractHsTyRdrTyVarsDups</span></a><span> </span><a href="#local-6989586621682099085"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1641"></a><span>
</span><a name="line-1642"></a><span class="hs-comment">-- | 'extractHsTyRdrTyVarsDups' find the</span><span>
</span><a name="line-1643"></a><span class="hs-comment">--        free (kind, type) variables of an 'HsType'</span><span>
</span><a name="line-1644"></a><span class="hs-comment">-- or the free (sort, kind) variables of an 'HsKind'.</span><span>
</span><a name="line-1645"></a><span class="hs-comment">-- It's used when making the @forall@s explicit.</span><span>
</span><a name="line-1646"></a><span class="hs-comment">-- Does not return any wildcards.</span><span>
</span><a name="line-1647"></a><span class="hs-comment">-- When the same name occurs multiple times in the types, all occurrences</span><span>
</span><a name="line-1648"></a><span class="hs-comment">-- are returned.</span><span>
</span><a name="line-1649"></a><span class="hs-identifier">extractHsTyRdrTyVarsDups</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1650"></a><a name="extractHsTyRdrTyVarsDups"><a href="RnTypes.html#extractHsTyRdrTyVarsDups"><span class="hs-identifier">extractHsTyRdrTyVarsDups</span></a></a><span> </span><a name="local-6989586621682099086"><a href="#local-6989586621682099086"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1651"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="#local-6989586621682099086"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier hs-var">emptyFKTV</span></a><span>
</span><a name="line-1652"></a><span>
</span><a name="line-1653"></a><span class="hs-comment">-- | Extracts the free kind variables (but not the type variables) of an</span><span>
</span><a name="line-1654"></a><span class="hs-comment">-- 'HsType'. Does not return any wildcards.</span><span>
</span><a name="line-1655"></a><span class="hs-comment">-- When the same name occurs multiple times in the type, only the first</span><span>
</span><a name="line-1656"></a><span class="hs-comment">-- occurrence is returned, and the left-to-right order of variables is</span><span>
</span><a name="line-1657"></a><span class="hs-comment">-- preserved.</span><span>
</span><a name="line-1658"></a><span class="hs-comment">-- See Note [Kind and type-variable binders] and</span><span>
</span><a name="line-1659"></a><span class="hs-comment">-- Note [Ordering of implicit variables].</span><span>
</span><a name="line-1660"></a><span class="hs-identifier">extractHsTyRdrTyVarsKindVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1661"></a><a name="extractHsTyRdrTyVarsKindVars"><a href="RnTypes.html#extractHsTyRdrTyVarsKindVars"><span class="hs-identifier">extractHsTyRdrTyVarsKindVars</span></a></a><span> </span><a name="local-6989586621682099087"><a href="#local-6989586621682099087"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1662"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier hs-var">freeKiTyVarsKindVars</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extractHsTyRdrTyVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVars</span></a><span> </span><a href="#local-6989586621682099087"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1663"></a><span>
</span><a name="line-1664"></a><span class="hs-comment">-- | Extracts free type and kind variables from types in a list.</span><span>
</span><a name="line-1665"></a><span class="hs-comment">-- When the same name occurs multiple times in the types, only the first</span><span>
</span><a name="line-1666"></a><span class="hs-comment">-- occurrence is returned and the rest is filtered out.</span><span>
</span><a name="line-1667"></a><span class="hs-comment">-- See Note [Kind and type-variable binders]</span><span>
</span><a name="line-1668"></a><span class="hs-identifier">extractHsTysRdrTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsNoDups"><span class="hs-identifier hs-type">FreeKiTyVarsNoDups</span></a><span>
</span><a name="line-1669"></a><a name="extractHsTysRdrTyVars"><a href="RnTypes.html#extractHsTysRdrTyVars"><span class="hs-identifier">extractHsTysRdrTyVars</span></a></a><span> </span><a name="local-6989586621682099088"><a href="#local-6989586621682099088"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1670"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#rmDupsInRdrTyVars"><span class="hs-identifier hs-var">rmDupsInRdrTyVars</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extractHsTysRdrTyVarsDups"><span class="hs-identifier hs-var">extractHsTysRdrTyVarsDups</span></a><span> </span><a href="#local-6989586621682099088"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1671"></a><span>
</span><a name="line-1672"></a><span class="hs-comment">-- | Extracts free type and kind variables from types in a list.</span><span>
</span><a name="line-1673"></a><span class="hs-comment">-- When the same name occurs multiple times in the types, all occurrences</span><span>
</span><a name="line-1674"></a><span class="hs-comment">-- are returned.</span><span>
</span><a name="line-1675"></a><span class="hs-identifier">extractHsTysRdrTyVarsDups</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1676"></a><a name="extractHsTysRdrTyVarsDups"><a href="RnTypes.html#extractHsTysRdrTyVarsDups"><span class="hs-identifier">extractHsTysRdrTyVarsDups</span></a></a><span> </span><a name="local-6989586621682099089"><a href="#local-6989586621682099089"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1677"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_ltys"><span class="hs-identifier hs-var">extract_ltys</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="#local-6989586621682099089"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier hs-var">emptyFKTV</span></a><span>
</span><a name="line-1678"></a><span>
</span><a name="line-1679"></a><span class="hs-identifier">extractHsTyVarBndrsKVs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1680"></a><span class="hs-comment">-- Returns the free kind variables of any explictly-kinded binders, returning</span><span>
</span><a name="line-1681"></a><span class="hs-comment">-- variable occurrences in left-to-right order.</span><span>
</span><a name="line-1682"></a><span class="hs-comment">-- See Note [Ordering of implicit variables].</span><span>
</span><a name="line-1683"></a><span class="hs-comment">-- NB: Does /not/ delete the binders themselves.</span><span>
</span><a name="line-1684"></a><span class="hs-comment">--     However duplicates are removed</span><span>
</span><a name="line-1685"></a><span class="hs-comment">--     E.g. given  [k1, a:k1, b:k2]</span><span>
</span><a name="line-1686"></a><span class="hs-comment">--          the function returns [k1,k2], even though k1 is bound here</span><span>
</span><a name="line-1687"></a><a name="extractHsTyVarBndrsKVs"><a href="RnTypes.html#extractHsTyVarBndrsKVs"><span class="hs-identifier">extractHsTyVarBndrsKVs</span></a></a><span> </span><a name="local-6989586621682099090"><a href="#local-6989586621682099090"><span class="hs-identifier">tv_bndrs</span></a></a><span>
</span><a name="line-1688"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#nubL"><span class="hs-identifier hs-var">nubL</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extract_hs_tv_bndrs_kvs"><span class="hs-identifier hs-var">extract_hs_tv_bndrs_kvs</span></a><span> </span><a href="#local-6989586621682099090"><span class="hs-identifier hs-var">tv_bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1689"></a><span>
</span><a name="line-1690"></a><span class="hs-comment">-- | Removes multiple occurrences of the same name from FreeKiTyVars. If a</span><span>
</span><a name="line-1691"></a><span class="hs-comment">-- variable occurs as both a kind and a type variable, only keep the occurrence</span><span>
</span><a name="line-1692"></a><span class="hs-comment">-- as a kind variable.</span><span>
</span><a name="line-1693"></a><span class="hs-comment">-- See also Note [Kind and type-variable binders]</span><span>
</span><a name="line-1694"></a><span class="hs-identifier">rmDupsInRdrTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsNoDups"><span class="hs-identifier hs-type">FreeKiTyVarsNoDups</span></a><span>
</span><a name="line-1695"></a><a name="rmDupsInRdrTyVars"><a href="RnTypes.html#rmDupsInRdrTyVars"><span class="hs-identifier">rmDupsInRdrTyVars</span></a></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099091"><a href="#local-6989586621682099091"><span class="hs-identifier">kis</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099092"><a href="#local-6989586621682099092"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1696"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099093"><span class="hs-identifier hs-var">kis'</span></a><span>
</span><a name="line-1697"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#nubL"><span class="hs-identifier hs-var">nubL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filterOut</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="RnTypes.html#elemRdr"><span class="hs-identifier hs-var">elemRdr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682099093"><span class="hs-identifier hs-var">kis'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682099092"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1698"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1699"></a><span>    </span><a name="local-6989586621682099093"><a href="#local-6989586621682099093"><span class="hs-identifier">kis'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#nubL"><span class="hs-identifier hs-var">nubL</span></a><span> </span><a href="#local-6989586621682099091"><span class="hs-identifier hs-var">kis</span></a><span>
</span><a name="line-1700"></a><span>
</span><a name="line-1701"></a><span class="hs-identifier">extractRdrKindSigVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LFamilyResultSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1702"></a><span class="hs-comment">-- Returns the free kind variables in a type family result signature, returning</span><span>
</span><a name="line-1703"></a><span class="hs-comment">-- variable occurrences in left-to-right order.</span><span>
</span><a name="line-1704"></a><span class="hs-comment">-- See Note [Ordering of implicit variables].</span><span>
</span><a name="line-1705"></a><a name="extractRdrKindSigVars"><a href="RnTypes.html#extractRdrKindSigVars"><span class="hs-identifier">extractRdrKindSigVars</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099094"><a href="#local-6989586621682099094"><span class="hs-identifier">resultSig</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1706"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">KindSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099097"><a href="#local-6989586621682099097"><span class="hs-identifier">k</span></a></a><span>                              </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682099094"><span class="hs-identifier hs-var">resultSig</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099095"><span class="hs-identifier hs-var">kindRdrNameFromSig</span></a><span> </span><a href="#local-6989586621682099097"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1707"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">TyVarSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTyVar</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099098"><a href="#local-6989586621682099098"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682099094"><span class="hs-identifier hs-var">resultSig</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099095"><span class="hs-identifier hs-var">kindRdrNameFromSig</span></a><span> </span><a href="#local-6989586621682099098"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1708"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1709"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1710"></a><span>      </span><a name="local-6989586621682099095"><a href="#local-6989586621682099095"><span class="hs-identifier">kindRdrNameFromSig</span></a></a><span> </span><a name="local-6989586621682099096"><a href="#local-6989586621682099096"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#freeKiTyVarsAllVars"><span class="hs-identifier hs-var">freeKiTyVarsAllVars</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extractHsTyRdrTyVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVars</span></a><span> </span><a href="#local-6989586621682099096"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-1711"></a><span>
</span><a name="line-1712"></a><span class="hs-identifier">extractDataDefnKindVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsDataDefn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1713"></a><span class="hs-comment">-- Get the scoped kind variables mentioned free in the constructor decls</span><span>
</span><a name="line-1714"></a><span class="hs-comment">-- Eg: data T a = T1 (S (a :: k) | forall (b::k). T2 (S b)</span><span>
</span><a name="line-1715"></a><span class="hs-comment">--     Here k should scope over the whole definition</span><span>
</span><a name="line-1716"></a><span class="hs-comment">--</span><span>
</span><a name="line-1717"></a><span class="hs-comment">-- However, do NOT collect free kind vars from the deriving clauses:</span><span>
</span><a name="line-1718"></a><span class="hs-comment">-- Eg: (Trac #14331)    class C p q</span><span>
</span><a name="line-1719"></a><span class="hs-comment">--                      data D = D deriving ( C (a :: k) )</span><span>
</span><a name="line-1720"></a><span class="hs-comment">--     Here k should /not/ scope over the whole definition.  We intend</span><span>
</span><a name="line-1721"></a><span class="hs-comment">--     this to elaborate to:</span><span>
</span><a name="line-1722"></a><span class="hs-comment">--         class C @k1 @k2 (p::k1) (q::k2)</span><span>
</span><a name="line-1723"></a><span class="hs-comment">--         data D = D</span><span>
</span><a name="line-1724"></a><span class="hs-comment">--         instance forall k (a::k). C @k @* a D where ...</span><span>
</span><a name="line-1725"></a><span class="hs-comment">--</span><span>
</span><a name="line-1726"></a><span class="hs-comment">-- This returns variable occurrences in left-to-right order.</span><span>
</span><a name="line-1727"></a><span class="hs-comment">-- See Note [Ordering of implicit variables].</span><span>
</span><a name="line-1728"></a><a name="extractDataDefnKindVars"><a href="RnTypes.html#extractDataDefnKindVars"><span class="hs-identifier">extractDataDefnKindVars</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsDataDefn</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dd_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099099"><a href="#local-6989586621682099099"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_kindSig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099100"><a href="#local-6989586621682099100"><span class="hs-identifier">ksig</span></a></a><span>
</span><a name="line-1729"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dd_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099101"><a href="#local-6989586621682099101"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1730"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#nubL"><span class="hs-identifier hs-var">nubL</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier hs-var">freeKiTyVarsKindVars</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1731"></a><span>    </span><span class="hs-special">(</span><a href="RnTypes.html#extract_lctxt"><span class="hs-identifier hs-var">extract_lctxt</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="#local-6989586621682099099"><span class="hs-identifier hs-var">ctxt</span></a><span>  </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1732"></a><span>     </span><a href="RnTypes.html#extract_mb"><span class="hs-identifier hs-var">extract_mb</span></a><span> </span><a href="RnTypes.html#extract_lkind"><span class="hs-identifier hs-var">extract_lkind</span></a><span> </span><a href="#local-6989586621682099100"><span class="hs-identifier hs-var">ksig</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1733"></a><span>     </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682099102"><span class="hs-identifier hs-var">extract_con</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier hs-var">emptyFKTV</span></a><span> </span><a href="#local-6989586621682099101"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-1734"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1735"></a><span>    </span><a name="local-6989586621682099102"><a href="#local-6989586621682099102"><span class="hs-identifier">extract_con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConDeclGADT</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682099103"><a href="#local-6989586621682099103"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099103"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1736"></a><span>    </span><span class="hs-identifier">extract_con</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConDeclH98</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">con_ex_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099104"><a href="#local-6989586621682099104"><span class="hs-identifier">ex_tvs</span></a></a><span>
</span><a name="line-1737"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_mb_cxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099105"><a href="#local-6989586621682099105"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099106"><a href="#local-6989586621682099106"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682099107"><a href="#local-6989586621682099107"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-1738"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_hs_tv_bndrs"><span class="hs-identifier hs-var">extract_hs_tv_bndrs</span></a><span> </span><a href="#local-6989586621682099104"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><a href="#local-6989586621682099107"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1739"></a><span>        </span><a href="RnTypes.html#extract_mlctxt"><span class="hs-identifier hs-var">extract_mlctxt</span></a><span> </span><a href="#local-6989586621682099105"><span class="hs-identifier hs-var">ctxt</span></a><span>            </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1740"></a><span>        </span><a href="RnTypes.html#extract_ltys"><span class="hs-identifier hs-var">extract_ltys</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsConDeclArgTys</span><span> </span><a href="#local-6989586621682099106"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier hs-var">emptyFKTV</span></a><span>
</span><a name="line-1741"></a><span>    </span><span class="hs-identifier">extract_con</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XConDecl</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;extractDataDefnKindVars&quot;</span><span>
</span><a name="line-1742"></a><span class="hs-identifier">extractDataDefnKindVars</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsDataDefn</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;extractDataDefnKindVars&quot;</span><span>
</span><a name="line-1743"></a><span>
</span><a name="line-1744"></a><span class="hs-identifier">extract_mlctxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsContext</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-1745"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1746"></a><a name="extract_mlctxt"><a href="RnTypes.html#extract_mlctxt"><span class="hs-identifier">extract_mlctxt</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><a name="local-6989586621682099108"><a href="#local-6989586621682099108"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099108"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1747"></a><span class="hs-identifier">extract_mlctxt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682099109"><a href="#local-6989586621682099109"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682099110"><a href="#local-6989586621682099110"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_lctxt"><span class="hs-identifier hs-var">extract_lctxt</span></a><span> </span><span class="hs-identifier hs-var">TypeLevel</span><span> </span><a href="#local-6989586621682099109"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682099110"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1748"></a><span>
</span><a name="line-1749"></a><span class="hs-identifier">extract_lctxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeOrKind</span><span>
</span><a name="line-1750"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsContext</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1751"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1752"></a><a name="extract_lctxt"><a href="RnTypes.html#extract_lctxt"><span class="hs-identifier">extract_lctxt</span></a></a><span> </span><a name="local-6989586621682099111"><a href="#local-6989586621682099111"><span class="hs-identifier">t_or_k</span></a></a><span> </span><a name="local-6989586621682099112"><a href="#local-6989586621682099112"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_ltys"><span class="hs-identifier hs-var">extract_ltys</span></a><span> </span><a href="#local-6989586621682099111"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682099112"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1753"></a><span>
</span><a name="line-1754"></a><span class="hs-identifier">extract_ltys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeOrKind</span><span>
</span><a name="line-1755"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>
</span><a name="line-1756"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1757"></a><a name="extract_ltys"><a href="RnTypes.html#extract_ltys"><span class="hs-identifier">extract_ltys</span></a></a><span> </span><a name="local-6989586621682099113"><a href="#local-6989586621682099113"><span class="hs-identifier">t_or_k</span></a></a><span> </span><a name="local-6989586621682099114"><a href="#local-6989586621682099114"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621682099115"><a href="#local-6989586621682099115"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099113"><span class="hs-identifier hs-var">t_or_k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682099115"><span class="hs-identifier hs-var">acc</span></a><span> </span><a href="#local-6989586621682099114"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1758"></a><span>
</span><a name="line-1759"></a><span class="hs-identifier">extract_mb</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682098460"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span class="hs-special">)</span><span>
</span><a name="line-1760"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682098460"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1761"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1762"></a><a name="extract_mb"><a href="RnTypes.html#extract_mb"><span class="hs-identifier">extract_mb</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><a name="local-6989586621682099116"><a href="#local-6989586621682099116"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099116"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1763"></a><span class="hs-identifier">extract_mb</span><span> </span><a name="local-6989586621682099117"><a href="#local-6989586621682099117"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682099118"><a href="#local-6989586621682099118"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682099119"><a href="#local-6989586621682099119"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099117"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682099118"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682099119"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1764"></a><span>
</span><a name="line-1765"></a><span class="hs-identifier">extract_lkind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVars"><span class="hs-identifier hs-type">FreeKiTyVars</span></a><span>
</span><a name="line-1766"></a><a name="extract_lkind"><a href="RnTypes.html#extract_lkind"><span class="hs-identifier">extract_lkind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><span class="hs-identifier hs-var">KindLevel</span><span>
</span><a name="line-1767"></a><span>
</span><a name="line-1768"></a><span class="hs-identifier">extract_lty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeOrKind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1769"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1770"></a><a name="extract_lty"><a href="RnTypes.html#extract_lty"><span class="hs-identifier">extract_lty</span></a></a><span> </span><a name="local-6989586621682099120"><a href="#local-6989586621682099120"><span class="hs-identifier">t_or_k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099121"><a href="#local-6989586621682099121"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682099122"><a href="#local-6989586621682099122"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-1771"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682099121"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1772"></a><span>      </span><span class="hs-identifier hs-var">HsTyVar</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><a name="local-6989586621682099123"><a href="#local-6989586621682099123"><span class="hs-identifier">ltv</span></a></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_tv"><span class="hs-identifier hs-var">extract_tv</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099123"><span class="hs-identifier hs-var">ltv</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1773"></a><span>      </span><span class="hs-identifier hs-var">HsBangTy</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099124"><a href="#local-6989586621682099124"><span class="hs-identifier">ty</span></a></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099124"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1774"></a><span>      </span><span class="hs-identifier hs-var">HsRecTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099125"><a href="#local-6989586621682099125"><span class="hs-identifier">flds</span></a></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span>
</span><a name="line-1775"></a><span>                                            </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">cd_fld_type</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1776"></a><span>                                           </span><a href="#local-6989586621682099125"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-1777"></a><span>      </span><span class="hs-identifier hs-var">HsAppTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099126"><a href="#local-6989586621682099126"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621682099127"><a href="#local-6989586621682099127"><span class="hs-identifier">ty2</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099126"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1778"></a><span>                                     </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099127"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1779"></a><span>      </span><span class="hs-identifier hs-var">HsAppKindTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099128"><a href="#local-6989586621682099128"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682099129"><a href="#local-6989586621682099129"><span class="hs-identifier">k</span></a></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099128"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1780"></a><span>                                     </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><span class="hs-identifier hs-var">KindLevel</span><span> </span><a href="#local-6989586621682099129"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1781"></a><span>      </span><span class="hs-identifier hs-var">HsListTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099130"><a href="#local-6989586621682099130"><span class="hs-identifier">ty</span></a></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099130"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1782"></a><span>      </span><span class="hs-identifier hs-var">HsTupleTy</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099131"><a href="#local-6989586621682099131"><span class="hs-identifier">tys</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_ltys"><span class="hs-identifier hs-var">extract_ltys</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099131"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1783"></a><span>      </span><span class="hs-identifier hs-var">HsSumTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099132"><a href="#local-6989586621682099132"><span class="hs-identifier">tys</span></a></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_ltys"><span class="hs-identifier hs-var">extract_ltys</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099132"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1784"></a><span>      </span><span class="hs-identifier hs-var">HsFunTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099133"><a href="#local-6989586621682099133"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621682099134"><a href="#local-6989586621682099134"><span class="hs-identifier">ty2</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099133"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1785"></a><span>                                     </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099134"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1786"></a><span>      </span><span class="hs-identifier hs-var">HsIParamTy</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099135"><a href="#local-6989586621682099135"><span class="hs-identifier">ty</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099135"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1787"></a><span>      </span><span class="hs-identifier hs-var">HsOpTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099136"><a href="#local-6989586621682099136"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621682099137"><a href="#local-6989586621682099137"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621682099138"><a href="#local-6989586621682099138"><span class="hs-identifier">ty2</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_tv"><span class="hs-identifier hs-var">extract_tv</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099137"><span class="hs-identifier hs-var">tv</span></a><span>   </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1788"></a><span>                                     </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099136"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1789"></a><span>                                     </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099138"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1790"></a><span>      </span><span class="hs-identifier hs-var">HsParTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099139"><a href="#local-6989586621682099139"><span class="hs-identifier">ty</span></a></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099139"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1791"></a><span>      </span><span class="hs-identifier hs-var">HsSpliceTy</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>  </span><span class="hs-comment">-- Type splices mention no tvs</span><span>
</span><a name="line-1792"></a><span>      </span><span class="hs-identifier hs-var">HsDocTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099140"><a href="#local-6989586621682099140"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099140"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1793"></a><span>      </span><span class="hs-identifier hs-var">HsExplicitListTy</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099141"><a href="#local-6989586621682099141"><span class="hs-identifier">tys</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_ltys"><span class="hs-identifier hs-var">extract_ltys</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099141"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1794"></a><span>      </span><span class="hs-identifier hs-var">HsExplicitTupleTy</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099142"><a href="#local-6989586621682099142"><span class="hs-identifier">tys</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_ltys"><span class="hs-identifier hs-var">extract_ltys</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099142"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1795"></a><span>      </span><span class="hs-identifier hs-var">HsTyLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1796"></a><span>      </span><span class="hs-identifier hs-var">HsStarTy</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1797"></a><span>      </span><span class="hs-identifier hs-var">HsKindSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099143"><a href="#local-6989586621682099143"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682099144"><a href="#local-6989586621682099144"><span class="hs-identifier">ki</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099143"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1798"></a><span>                                     </span><a href="RnTypes.html#extract_lkind"><span class="hs-identifier hs-var">extract_lkind</span></a><span> </span><a href="#local-6989586621682099144"><span class="hs-identifier hs-var">ki</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1799"></a><span>      </span><span class="hs-identifier hs-var">HsForAllTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099145"><a href="#local-6989586621682099145"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099146"><a href="#local-6989586621682099146"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1800"></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_hs_tv_bndrs"><span class="hs-identifier hs-var">extract_hs_tv_bndrs</span></a><span> </span><a href="#local-6989586621682099145"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1801"></a><span>                                     </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099146"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier hs-var">emptyFKTV</span></a><span>
</span><a name="line-1802"></a><span>      </span><span class="hs-identifier hs-var">HsQualTy</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hst_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099147"><a href="#local-6989586621682099147"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">hst_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099148"><a href="#local-6989586621682099148"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1803"></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#extract_lctxt"><span class="hs-identifier hs-var">extract_lctxt</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099147"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1804"></a><span>                                     </span><a href="RnTypes.html#extract_lty"><span class="hs-identifier hs-var">extract_lty</span></a><span> </span><a href="#local-6989586621682099120"><span class="hs-identifier hs-var">t_or_k</span></a><span> </span><a href="#local-6989586621682099148"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1805"></a><span>      </span><span class="hs-identifier hs-var">XHsType</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1806"></a><span>      </span><span class="hs-comment">-- We deal with these separately in rnLHsTypeWithWildCards</span><span>
</span><a name="line-1807"></a><span>      </span><span class="hs-identifier hs-var">HsWildCardTy</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682099122"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1808"></a><span>
</span><a name="line-1809"></a><span class="hs-identifier">extractHsTvBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>
</span><a name="line-1810"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>           </span><span class="hs-comment">-- Free in body</span><span>
</span><a name="line-1811"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>       </span><span class="hs-comment">-- Free in result</span><span>
</span><a name="line-1812"></a><a name="extractHsTvBndrs"><a href="RnTypes.html#extractHsTvBndrs"><span class="hs-identifier">extractHsTvBndrs</span></a></a><span> </span><a name="local-6989586621682099149"><a href="#local-6989586621682099149"><span class="hs-identifier">tv_bndrs</span></a></a><span> </span><a name="local-6989586621682099150"><a href="#local-6989586621682099150"><span class="hs-identifier">body_fvs</span></a></a><span>
</span><a name="line-1813"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_hs_tv_bndrs"><span class="hs-identifier hs-var">extract_hs_tv_bndrs</span></a><span> </span><a href="#local-6989586621682099149"><span class="hs-identifier hs-var">tv_bndrs</span></a><span> </span><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier hs-var">emptyFKTV</span></a><span> </span><a href="#local-6989586621682099150"><span class="hs-identifier hs-var">body_fvs</span></a><span>
</span><a name="line-1814"></a><span>
</span><a name="line-1815"></a><span class="hs-identifier">extract_hs_tv_bndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>
</span><a name="line-1816"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>  </span><span class="hs-comment">-- Accumulator</span><span>
</span><a name="line-1817"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>  </span><span class="hs-comment">-- Free in body</span><span>
</span><a name="line-1818"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1819"></a><span class="hs-comment">-- In (forall (a :: Maybe e). a -&gt; b) we have</span><span>
</span><a name="line-1820"></a><span class="hs-comment">--     'a' is bound by the forall</span><span>
</span><a name="line-1821"></a><span class="hs-comment">--     'b' is a free type variable</span><span>
</span><a name="line-1822"></a><span class="hs-comment">--     'e' is a free kind variable</span><span>
</span><a name="line-1823"></a><a name="extract_hs_tv_bndrs"><a href="RnTypes.html#extract_hs_tv_bndrs"><span class="hs-identifier">extract_hs_tv_bndrs</span></a></a><span> </span><a name="local-6989586621682099151"><a href="#local-6989586621682099151"><span class="hs-identifier">tv_bndrs</span></a></a><span>
</span><a name="line-1824"></a><span>      </span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099152"><a href="#local-6989586621682099152"><span class="hs-identifier">acc_kvs</span></a></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099153"><a href="#local-6989586621682099153"><span class="hs-identifier">acc_tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Accumulator</span><span>
</span><a name="line-1825"></a><span>      </span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099154"><a href="#local-6989586621682099154"><span class="hs-identifier">body_kvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682099155"><a href="#local-6989586621682099155"><span class="hs-identifier">body_tvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Free in the body</span><span>
</span><a name="line-1826"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621682099151"><span class="hs-identifier hs-var">tv_bndrs</span></a><span>
</span><a name="line-1827"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099154"><span class="hs-identifier hs-var">body_kvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682099152"><span class="hs-identifier hs-var">acc_kvs</span></a><span>
</span><a name="line-1828"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099155"><span class="hs-identifier hs-var">body_tvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682099153"><span class="hs-identifier hs-var">acc_tvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1829"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1830"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterOut</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="RnTypes.html#elemRdr"><span class="hs-identifier hs-var">elemRdr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682099157"><span class="hs-identifier hs-var">tv_bndr_rdrs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682099158"><span class="hs-identifier hs-var">all_kv_occs</span></a><span>
</span><a name="line-1831"></a><span>                      </span><span class="hs-comment">-- NB: delete all tv_bndr_rdrs from bndr_kvs as well</span><span>
</span><a name="line-1832"></a><span>                      </span><span class="hs-comment">-- as body_kvs; see Note [Kind variable scoping]</span><span>
</span><a name="line-1833"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682099152"><span class="hs-identifier hs-var">acc_kvs</span></a><span>
</span><a name="line-1834"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterOut</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="RnTypes.html#elemRdr"><span class="hs-identifier hs-var">elemRdr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682099157"><span class="hs-identifier hs-var">tv_bndr_rdrs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682099155"><span class="hs-identifier hs-var">body_tvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682099153"><span class="hs-identifier hs-var">acc_tvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1835"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1836"></a><span>    </span><a name="local-6989586621682099156"><a href="#local-6989586621682099156"><span class="hs-identifier">bndr_kvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#extract_hs_tv_bndrs_kvs"><span class="hs-identifier hs-var">extract_hs_tv_bndrs_kvs</span></a><span> </span><a href="#local-6989586621682099151"><span class="hs-identifier hs-var">tv_bndrs</span></a><span>
</span><a name="line-1837"></a><span>
</span><a name="line-1838"></a><span>    </span><span class="hs-identifier">tv_bndr_rdrs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">all_kv_occs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1839"></a><span>    </span><a name="local-6989586621682099157"><a href="#local-6989586621682099157"><span class="hs-identifier">tv_bndr_rdrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">hsLTyVarLocName</span><span> </span><a href="#local-6989586621682099151"><span class="hs-identifier hs-var">tv_bndrs</span></a><span>
</span><a name="line-1840"></a><span>    </span><a name="local-6989586621682099158"><a href="#local-6989586621682099158"><span class="hs-identifier">all_kv_occs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099156"><span class="hs-identifier hs-var">bndr_kvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682099154"><span class="hs-identifier hs-var">body_kvs</span></a><span>
</span><a name="line-1841"></a><span>       </span><span class="hs-comment">-- We must include both kind variables from the binding as well</span><span>
</span><a name="line-1842"></a><span>       </span><span class="hs-comment">-- as the body of the `forall` type.</span><span>
</span><a name="line-1843"></a><span>       </span><span class="hs-comment">-- See Note [Variables used as both types and kinds].</span><span>
</span><a name="line-1844"></a><span>
</span><a name="line-1845"></a><span class="hs-identifier">extract_hs_tv_bndrs_kvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsTyVarBndr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1846"></a><span class="hs-comment">-- Returns the free kind variables of any explictly-kinded binders, returning</span><span>
</span><a name="line-1847"></a><span class="hs-comment">-- variable occurrences in left-to-right order.</span><span>
</span><a name="line-1848"></a><span class="hs-comment">-- See Note [Ordering of implicit variables].</span><span>
</span><a name="line-1849"></a><span class="hs-comment">-- NB: Does /not/ delete the binders themselves.</span><span>
</span><a name="line-1850"></a><span class="hs-comment">--     Duplicates are /not/ removed</span><span>
</span><a name="line-1851"></a><span class="hs-comment">--     E.g. given  [k1, a:k1, b:k2]</span><span>
</span><a name="line-1852"></a><span class="hs-comment">--          the function returns [k1,k2], even though k1 is bound here</span><span>
</span><a name="line-1853"></a><a name="extract_hs_tv_bndrs_kvs"><a href="RnTypes.html#extract_hs_tv_bndrs_kvs"><span class="hs-identifier">extract_hs_tv_bndrs_kvs</span></a></a><span> </span><a name="local-6989586621682099159"><a href="#local-6989586621682099159"><span class="hs-identifier">tv_bndrs</span></a></a><span>
</span><a name="line-1854"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#freeKiTyVarsKindVars"><span class="hs-identifier hs-var">freeKiTyVarsKindVars</span></a><span> </span><span class="hs-operator hs-var">$</span><span>        </span><span class="hs-comment">-- There will /be/ no free tyvars!</span><span>
</span><a name="line-1855"></a><span>    </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="RnTypes.html#extract_lkind"><span class="hs-identifier hs-var">extract_lkind</span></a><span> </span><a href="RnTypes.html#emptyFKTV"><span class="hs-identifier hs-var">emptyFKTV</span></a><span>
</span><a name="line-1856"></a><span>          </span><span class="hs-special">[</span><a href="#local-6989586621682099160"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindedTyVar</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099160"><a href="#local-6989586621682099160"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682099159"><span class="hs-identifier hs-var">tv_bndrs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1857"></a><span>
</span><a name="line-1858"></a><span class="hs-identifier">extract_tv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeOrKind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-1859"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnTypes.html#FreeKiTyVarsWithDups"><span class="hs-identifier hs-type">FreeKiTyVarsWithDups</span></a><span>
</span><a name="line-1860"></a><a name="extract_tv"><a href="RnTypes.html#extract_tv"><span class="hs-identifier">extract_tv</span></a></a><span> </span><a name="local-6989586621682099161"><a href="#local-6989586621682099161"><span class="hs-identifier">t_or_k</span></a></a><span> </span><a name="local-6989586621682099162"><a href="#local-6989586621682099162"><span class="hs-identifier">ltv</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682099163"><a href="#local-6989586621682099163"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682099164"><a href="#local-6989586621682099164"><span class="hs-identifier">acc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><a name="local-6989586621682099165"><a href="#local-6989586621682099165"><span class="hs-identifier">kvs</span></a></a><span> </span><a name="local-6989586621682099166"><a href="#local-6989586621682099166"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1861"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isRdrTyVar</span><span> </span><a href="#local-6989586621682099163"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099164"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-1862"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTypeLevel</span><span> </span><a href="#local-6989586621682099161"><span class="hs-identifier hs-var">t_or_k</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099165"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099162"><span class="hs-identifier hs-var">ltv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621682099166"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1863"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="RnTypes.html#FKTV"><span class="hs-identifier hs-var">FKTV</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fktv_kis</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099162"><span class="hs-identifier hs-var">ltv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621682099165"><span class="hs-identifier hs-var">kvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fktv_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682099166"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1864"></a><span>
</span><a name="line-1865"></a><span class="hs-comment">-- Deletes duplicates in a list of Located things.</span><span>
</span><a name="line-1866"></a><span class="hs-comment">--</span><span>
</span><a name="line-1867"></a><span class="hs-comment">-- Importantly, this function is stable with respect to the original ordering</span><span>
</span><a name="line-1868"></a><span class="hs-comment">-- of things in the list. This is important, as it is a property that GHC</span><span>
</span><a name="line-1869"></a><span class="hs-comment">-- relies on to maintain the left-to-right ordering of implicitly quantified</span><span>
</span><a name="line-1870"></a><span class="hs-comment">-- type variables.</span><span>
</span><a name="line-1871"></a><span class="hs-comment">-- See Note [Ordering of implicit variables].</span><span>
</span><a name="line-1872"></a><span class="hs-identifier">nubL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621682098459"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><a href="#local-6989586621682098459"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><a href="#local-6989586621682098459"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-1873"></a><a name="nubL"><a href="RnTypes.html#nubL"><span class="hs-identifier">nubL</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nubBy</span><span> </span><span class="hs-identifier hs-var">eqLocated</span><span>
</span><a name="line-1874"></a><span>
</span><a name="line-1875"></a><span class="hs-identifier">elemRdr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1876"></a><a name="elemRdr"><a href="RnTypes.html#elemRdr"><span class="hs-identifier">elemRdr</span></a></a><span> </span><a name="local-6989586621682099167"><a href="#local-6989586621682099167"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">eqLocated</span><span> </span><a href="#local-6989586621682099167"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1877"></a></pre></body></html>