<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[RnPat]{Renaming of patterns}

Basically dependency analysis.

Handles @Match@, @GRHSs@, @HsExpr@, and @Qualifier@ datatypes.  In
general, all of these functions return a renamed thing, and a set of
free variables.
-}</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-17"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-18"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RnPat</span><span> </span><span class="hs-special">(</span><span class="hs-comment">-- main entry points</span><span>
</span><a name="line-21"></a><span>              </span><a href="RnPat.html#rnPat"><span class="hs-identifier hs-var">rnPat</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#rnPats"><span class="hs-identifier hs-var">rnPats</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#rnBindPat"><span class="hs-identifier hs-var">rnBindPat</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#rnPatAndThen"><span class="hs-identifier hs-var">rnPatAndThen</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span>              </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#applyNameMaker"><span class="hs-identifier hs-var">applyNameMaker</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- a utility for making names:</span><span>
</span><a name="line-24"></a><span>              </span><a href="RnPat.html#localRecNameMaker"><span class="hs-identifier hs-var">localRecNameMaker</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#topRecNameMaker"><span class="hs-identifier hs-var">topRecNameMaker</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">--   sometimes we want to make local names,</span><span>
</span><a name="line-25"></a><span>                                             </span><span class="hs-comment">--   sometimes we want to make top (qualified) names.</span><span>
</span><a name="line-26"></a><span>              </span><a href="RnPat.html#isTopRecNameMaker"><span class="hs-identifier hs-var">isTopRecNameMaker</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>              </span><a href="RnPat.html#rnHsRecFields"><span class="hs-identifier hs-var">rnHsRecFields</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#HsRecFieldContext"><span class="hs-identifier hs-type">HsRecFieldContext</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>              </span><a href="RnPat.html#rnHsRecUpdFields"><span class="hs-identifier hs-var">rnHsRecUpdFields</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>              </span><span class="hs-comment">-- CpsRn monad</span><span>
</span><a name="line-32"></a><span>              </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>              </span><span class="hs-comment">-- Literals</span><span>
</span><a name="line-35"></a><span>              </span><a href="RnPat.html#rnLit"><span class="hs-identifier hs-var">rnLit</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#rnOverLit"><span class="hs-identifier hs-var">rnOverLit</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span>             </span><span class="hs-comment">-- Pattern Error messages that are also used elsewhere</span><span>
</span><a name="line-38"></a><span>             </span><a href="RnUtils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a><span class="hs-special">,</span><span> </span><a href="RnPat.html#patSigErr"><span class="hs-identifier hs-var">patSigErr</span></a><span>
</span><a name="line-39"></a><span>             </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-comment">-- ENH: thin imports to only what is necessary for patterns</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="RnExpr.html"><span class="hs-identifier">RnExpr</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="RnSplice.html"><span class="hs-identifier">RnSplice</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="RnSplice.html#rnSplicePat"><span class="hs-identifier hs-var">rnSplicePat</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsSyn</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="TcHsSyn.html"><span class="hs-identifier">TcHsSyn</span></a><span>             </span><span class="hs-special">(</span><span> </span><a href="TcHsSyn.html#hsOverLitName"><span class="hs-identifier hs-var">hsOverLitName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="RnEnv.html"><span class="hs-identifier">RnEnv</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="RnFixity.html"><span class="hs-identifier">RnFixity</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="RnUtils.html"><span class="hs-identifier">RnUtils</span></a><span>             </span><span class="hs-special">(</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#bindLocalNames"><span class="hs-identifier hs-var">bindLocalNames</span></a><span>
</span><a name="line-56"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#warnUnusedMatches"><span class="hs-identifier hs-var">warnUnusedMatches</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a><span>
</span><a name="line-57"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkDupNames"><span class="hs-identifier hs-var">checkDupNames</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkDupAndShadowedNames"><span class="hs-identifier hs-var">checkDupAndShadowedNames</span></a><span>
</span><a name="line-58"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#unknownSubordinateErr"><span class="hs-identifier hs-var">unknownSubordinateErr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="RnTypes.html"><span class="hs-identifier">RnTypes</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrelNames</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">NameSet</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">RdrName</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ListSetOps</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">removeDups</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Literal</span><span>             </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">inCharRange</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysWiredIn</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">nilDataCon</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.LanguageExtensions</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">when</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">NE</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ratio</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
        The CpsRn Monad
*                                                      *
*********************************************************

Note [CpsRn monad]
~~~~~~~~~~~~~~~~~~
The CpsRn monad uses continuation-passing style to support this
style of programming:

        do { ...
           ; ns &lt;- bindNames rs
           ; ...blah... }

   where rs::[RdrName], ns::[Name]

The idea is that '...blah...'
  a) sees the bindings of ns
  b) returns the free variables it mentions
     so that bindNames can report unused ones

In particular,
    mapM rnPatAndThen [p1, p2, p3]
has a *left-to-right* scoping: it makes the binders in
p1 scope over p2,p3.
-}</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-keyword">newtype</span><span> </span><a name="CpsRn"><a href="RnPat.html#CpsRn"><span class="hs-identifier">CpsRn</span></a></a><span> </span><a name="local-6989586621682147434"><a href="#local-6989586621682147434"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CpsRn"><a href="RnPat.html#CpsRn"><span class="hs-identifier">CpsRn</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unCpsRn"><a href="RnPat.html#unCpsRn"><span class="hs-identifier">unCpsRn</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682147435"><a href="#local-6989586621682147435"><span class="hs-identifier">r</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147434"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147435"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>                                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147435"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-109"></a><span>        </span><span class="hs-comment">-- See Note [CpsRn monad]</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-112"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-115"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621682147440"><a href="#local-6989586621682147440"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147441"><a href="#local-6989586621682147441"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147441"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682147440"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-119"></a><span>  </span><span class="hs-special">(</span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><a name="local-6989586621682147436"><a href="#local-6989586621682147436"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621682147437"><a href="#local-6989586621682147437"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147438"><a href="#local-6989586621682147438"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147436"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147439"><a href="#local-6989586621682147439"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unCpsRn</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147437"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147439"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147438"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-identifier">runCps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><a href="#local-6989586621682147457"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147457"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-122"></a><a name="runCps"><a href="RnPat.html#runCps"><span class="hs-identifier">runCps</span></a></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><a name="local-6989586621682147458"><a href="#local-6989586621682147458"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147458"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147459"><a href="#local-6989586621682147459"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147459"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-identifier">liftCps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><a href="#local-6989586621682147456"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><a href="#local-6989586621682147456"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-125"></a><a name="liftCps"><a href="RnPat.html#liftCps"><span class="hs-identifier">liftCps</span></a></a><span> </span><a name="local-6989586621682147460"><a href="#local-6989586621682147460"><span class="hs-identifier">rn_thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147461"><a href="#local-6989586621682147461"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147460"><span class="hs-identifier hs-var">rn_thing</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621682147461"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-identifier">liftCpsFV</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147455"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><a href="#local-6989586621682147455"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-128"></a><a name="liftCpsFV"><a href="RnPat.html#liftCpsFV"><span class="hs-identifier">liftCpsFV</span></a></a><span> </span><a name="local-6989586621682147462"><a href="#local-6989586621682147462"><span class="hs-identifier">rn_thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147463"><a href="#local-6989586621682147463"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147464"><a href="#local-6989586621682147464"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><a name="local-6989586621682147465"><a href="#local-6989586621682147465"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682147462"><span class="hs-identifier hs-var">rn_thing</span></a><span>
</span><a name="line-129"></a><span>                                     </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147466"><a href="#local-6989586621682147466"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621682147467"><a href="#local-6989586621682147467"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682147463"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682147464"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-130"></a><span>                                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147466"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682147465"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682147467"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-identifier">wrapSrcSpanCps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HasSrcSpan</span><span> </span><a href="#local-6989586621682147453"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HasSrcSpan</span><span> </span><a href="#local-6989586621682147454"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-133"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SrcSpanLess</span><span> </span><a href="#local-6989586621682147453"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SrcSpanLess</span><span> </span><a href="#local-6989586621682147454"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147453"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><a href="#local-6989586621682147454"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-134"></a><span class="hs-comment">-- Set the location, and also wrap it around the value returned</span><span>
</span><a name="line-135"></a><a name="wrapSrcSpanCps"><a href="RnPat.html#wrapSrcSpanCps"><span class="hs-identifier">wrapSrcSpanCps</span></a></a><span> </span><a name="local-6989586621682147468"><a href="#local-6989586621682147468"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147469"><a href="#local-6989586621682147469"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682147470"><a href="#local-6989586621682147470"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147471"><a href="#local-6989586621682147471"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682147469"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-137"></a><span>                 </span><span class="hs-identifier">unCpsRn</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147468"><span class="hs-identifier hs-var">fn</span></a><span> </span><a href="#local-6989586621682147470"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682147472"><a href="#local-6989586621682147472"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-138"></a><span>                 </span><a href="#local-6989586621682147471"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147469"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147472"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-identifier">lookupConCps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><a name="lookupConCps"><a href="RnPat.html#lookupConCps"><span class="hs-identifier">lookupConCps</span></a></a><span> </span><a name="local-6989586621682147473"><a href="#local-6989586621682147473"><span class="hs-identifier">con_rdr</span></a></a><span>
</span><a name="line-142"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147474"><a href="#local-6989586621682147474"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147475"><a href="#local-6989586621682147475"><span class="hs-identifier">con_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621682147473"><span class="hs-identifier hs-var">con_rdr</span></a><span>
</span><a name="line-143"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147476"><a href="#local-6989586621682147476"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147477"><a href="#local-6989586621682147477"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682147474"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682147475"><span class="hs-identifier hs-var">con_name</span></a><span>
</span><a name="line-144"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147476"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">addOneFV</span><span> </span><a href="#local-6989586621682147477"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682147475"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>    </span><span class="hs-comment">-- We add the constructor name to the free vars</span><span>
</span><a name="line-146"></a><span>    </span><span class="hs-comment">-- See Note [Patterns are uses]</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-comment">{-
Note [Patterns are uses]
~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  module Foo( f, g ) where
  data T = T1 | T2

  f T1 = True
  f T2 = False

  g _ = T1

Arguably we should report T2 as unused, even though it appears in a
pattern, because it never occurs in a constructed position.  See
Trac #7336.
However, implementing this in the face of pattern synonyms would be
less straightforward, since given two pattern synonyms

  pattern P1 &lt;- P2
  pattern P2 &lt;- ()

we need to observe the dependency between P1 and P2 so that type
checking can be done in the correct order (just like for value
bindings). Dependencies between bindings is analyzed in the renamer,
where we don't know yet whether P2 is a constructor or a pattern
synonym. So for now, we do report conid occurrences in patterns as
uses.

*********************************************************
*                                                      *
        Name makers
*                                                      *
*********************************************************

Externally abstract type of name makers,
which is how you go from a RdrName to a Name
-}</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-keyword">data</span><span> </span><a name="NameMaker"><a href="RnPat.html#NameMaker"><span class="hs-identifier">NameMaker</span></a></a><span>
</span><a name="line-187"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="LamMk"><a href="RnPat.html#LamMk"><span class="hs-identifier">LamMk</span></a></a><span>       </span><span class="hs-comment">-- Lambdas</span><span>
</span><a name="line-188"></a><span>      </span><span class="hs-identifier hs-type">Bool</span><span>      </span><span class="hs-comment">-- True &lt;=&gt; report unused bindings</span><span>
</span><a name="line-189"></a><span>                </span><span class="hs-comment">--   (even if True, the warning only comes out</span><span>
</span><a name="line-190"></a><span>                </span><span class="hs-comment">--    if -Wunused-matches is on)</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LetMk"><a href="RnPat.html#LetMk"><span class="hs-identifier">LetMk</span></a></a><span>       </span><span class="hs-comment">-- Let bindings, incl top level</span><span>
</span><a name="line-193"></a><span>                </span><span class="hs-comment">-- Do *not* check for unused bindings</span><span>
</span><a name="line-194"></a><span>      </span><span class="hs-identifier hs-type">TopLevelFlag</span><span>
</span><a name="line-195"></a><span>      </span><a href="RnFixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-identifier">topRecNameMaker</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnFixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span>
</span><a name="line-198"></a><a name="topRecNameMaker"><a href="RnPat.html#topRecNameMaker"><span class="hs-identifier">topRecNameMaker</span></a></a><span> </span><a name="local-6989586621682147478"><a href="#local-6989586621682147478"><span class="hs-identifier">fix_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#LetMk"><span class="hs-identifier hs-var">LetMk</span></a><span> </span><span class="hs-identifier hs-var">TopLevel</span><span> </span><a href="#local-6989586621682147478"><span class="hs-identifier hs-var">fix_env</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-identifier">isTopRecNameMaker</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-201"></a><a name="isTopRecNameMaker"><a href="RnPat.html#isTopRecNameMaker"><span class="hs-identifier">isTopRecNameMaker</span></a></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#LetMk"><span class="hs-identifier hs-var">LetMk</span></a><span> </span><span class="hs-identifier hs-var">TopLevel</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-202"></a><span class="hs-identifier">isTopRecNameMaker</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-identifier">localRecNameMaker</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnFixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span>
</span><a name="line-205"></a><a name="localRecNameMaker"><a href="RnPat.html#localRecNameMaker"><span class="hs-identifier">localRecNameMaker</span></a></a><span> </span><a name="local-6989586621682147479"><a href="#local-6989586621682147479"><span class="hs-identifier">fix_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#LetMk"><span class="hs-identifier hs-var">LetMk</span></a><span> </span><span class="hs-identifier hs-var">NotTopLevel</span><span> </span><a href="#local-6989586621682147479"><span class="hs-identifier hs-var">fix_env</span></a><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-identifier">matchNameMaker</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><a href="#local-6989586621682147452"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span>
</span><a name="line-208"></a><a name="matchNameMaker"><a href="RnPat.html#matchNameMaker"><span class="hs-identifier">matchNameMaker</span></a></a><span> </span><a name="local-6989586621682147480"><a href="#local-6989586621682147480"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#LamMk"><span class="hs-identifier hs-var">LamMk</span></a><span> </span><a href="#local-6989586621682147481"><span class="hs-identifier hs-var">report_unused</span></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-comment">-- Do not report unused names in interactive contexts</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-comment">-- i.e. when you type 'x &lt;- e' at the GHCi prompt</span><span>
</span><a name="line-212"></a><span>    </span><a name="local-6989586621682147481"><a href="#local-6989586621682147481"><span class="hs-identifier">report_unused</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147480"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-213"></a><span>                      </span><span class="hs-identifier hs-var">StmtCtxt</span><span> </span><span class="hs-identifier hs-var">GhciStmtCtxt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-214"></a><span>                      </span><span class="hs-comment">-- also, don't warn in pattern quotes, as there</span><span>
</span><a name="line-215"></a><span>                      </span><span class="hs-comment">-- is no RHS where the variables can be used!</span><span>
</span><a name="line-216"></a><span>                      </span><span class="hs-identifier hs-var">ThPatQuote</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-217"></a><span>                      </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-identifier">rnHsSigCps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsSigWcType</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-220"></a><a name="rnHsSigCps"><a href="RnPat.html#rnHsSigCps"><span class="hs-identifier">rnHsSigCps</span></a></a><span> </span><a name="local-6989586621682147482"><a href="#local-6989586621682147482"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><a href="RnTypes.html#rnHsSigWcTypeScoped"><span class="hs-identifier hs-var">rnHsSigWcTypeScoped</span></a><span> </span><a href="RnTypes.html#AlwaysBind"><span class="hs-identifier hs-var">AlwaysBind</span></a><span> </span><a href="RnUtils.html#PatCtx"><span class="hs-identifier hs-var">PatCtx</span></a><span> </span><a href="#local-6989586621682147482"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-identifier">newPatLName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-223"></a><a name="newPatLName"><a href="RnPat.html#newPatLName"><span class="hs-identifier">newPatLName</span></a></a><span> </span><a name="local-6989586621682147483"><a href="#local-6989586621682147483"><span class="hs-identifier">name_maker</span></a></a><span> </span><a name="local-6989586621682147484"><a href="#local-6989586621682147484"><span class="hs-identifier">rdr_name</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147485"><a href="#local-6989586621682147485"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147486"><a href="#local-6989586621682147486"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#newPatName"><span class="hs-identifier hs-var">newPatName</span></a><span> </span><a href="#local-6989586621682147483"><span class="hs-identifier hs-var">name_maker</span></a><span> </span><a href="#local-6989586621682147484"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-225"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147485"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147486"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-identifier">newPatName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-228"></a><a name="newPatName"><a href="RnPat.html#newPatName"><span class="hs-identifier">newPatName</span></a></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#LamMk"><span class="hs-identifier hs-var">LamMk</span></a><span> </span><a name="local-6989586621682147487"><a href="#local-6989586621682147487"><span class="hs-identifier">report_unused</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682147488"><a href="#local-6989586621682147488"><span class="hs-identifier">rdr_name</span></a></a><span>
</span><a name="line-229"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682147489"><a href="#local-6989586621682147489"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-230"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147490"><a href="#local-6989586621682147490"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a><span> </span><a href="#local-6989586621682147488"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-231"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147491"><a href="#local-6989586621682147491"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147492"><a href="#local-6989586621682147492"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#bindLocalNames"><span class="hs-identifier hs-var">bindLocalNames</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682147490"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147489"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621682147490"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621682147487"><span class="hs-identifier hs-var">report_unused</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnUtils.html#warnUnusedMatches"><span class="hs-identifier hs-var">warnUnusedMatches</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682147490"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621682147492"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-233"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147491"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682147490"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">delFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682147492"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-identifier">newPatName</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#LetMk"><span class="hs-identifier hs-var">LetMk</span></a><span> </span><a name="local-6989586621682147493"><a href="#local-6989586621682147493"><span class="hs-identifier">is_top</span></a></a><span> </span><a name="local-6989586621682147494"><a href="#local-6989586621682147494"><span class="hs-identifier">fix_env</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682147495"><a href="#local-6989586621682147495"><span class="hs-identifier">rdr_name</span></a></a><span>
</span><a name="line-236"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-var">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682147496"><a href="#local-6989586621682147496"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-237"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147497"><a href="#local-6989586621682147497"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147493"><span class="hs-identifier hs-var">is_top</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-238"></a><span>                       </span><span class="hs-identifier hs-var">NotTopLevel</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnUtils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a><span> </span><a href="#local-6989586621682147495"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-239"></a><span>                       </span><span class="hs-identifier hs-var">TopLevel</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnEnv.html#newTopSrcBinder"><span class="hs-identifier hs-var">newTopSrcBinder</span></a><span> </span><a href="#local-6989586621682147495"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-240"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#bindLocalNames"><span class="hs-identifier hs-var">bindLocalNames</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682147497"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>       </span><span class="hs-comment">-- Do *not* use bindLocalNameFV here</span><span>
</span><a name="line-241"></a><span>                                        </span><span class="hs-comment">-- See Note [View pattern usage]</span><span>
</span><a name="line-242"></a><span>             </span><a href="RnFixity.html#addLocalFixities"><span class="hs-identifier hs-var">addLocalFixities</span></a><span> </span><a href="#local-6989586621682147494"><span class="hs-identifier hs-var">fix_env</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682147497"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-243"></a><span>             </span><a href="#local-6989586621682147496"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621682147497"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>    </span><span class="hs-comment">-- Note: the bindLocalNames is somewhat suspicious</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-comment">--       because it binds a top-level name as a local name.</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-comment">--       however, this binding seems to work, and it only exists for</span><span>
</span><a name="line-248"></a><span>    </span><span class="hs-comment">--       the duration of the patterns and the continuation;</span><span>
</span><a name="line-249"></a><span>    </span><span class="hs-comment">--       then the top-level name is added to the global env</span><span>
</span><a name="line-250"></a><span>    </span><span class="hs-comment">--       before going on to the RHSes (see RnSource.hs).</span><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">{-
Note [View pattern usage]
~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  let (r, (r -&gt; x)) = x in ...
Here the pattern binds 'r', and then uses it *only* in the view pattern.
We want to &quot;see&quot; this use, and in let-bindings we collect all uses and
report unused variables at the binding level. So we must use bindLocalNames
here, *not* bindLocalNameFV.  Trac #3943.


Note [Don't report shadowing for pattern synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There is one special context where a pattern doesn't introduce any new binders -
pattern synonym declarations. Therefore we don't check to see if pattern
variables shadow existing identifiers as they are never bound to anything
and have no scope.

Without this check, there would be quite a cryptic warning that the `x`
in the RHS of the pattern synonym declaration shadowed the top level `x`.

```
x :: ()
x = ()

pattern P x = Just x
```

See #12615 for some more examples.

*********************************************************
*                                                      *
        External entry points
*                                                      *
*********************************************************

There are various entry points to renaming patterns, depending on
 (1) whether the names created should be top-level names or local names
 (2) whether the scope of the names is entirely given in a continuation
     (e.g., in a case or lambda, but not in a let or at the top-level,
      because of the way mutually recursive bindings are handled)
 (3) whether the a type signature in the pattern can bind
        lexically-scoped type variables (for unpacking existential
        type vars in data constructors)
 (4) whether we do duplicate and unused variable checking
 (5) whether there are fixity declarations associated with the names
     bound by the patterns that need to be brought into scope with them.

 Rather than burdening the clients of this module with all of these choices,
 we export the three points in this design space that we actually need:
-}</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- ----------- Entry point 1: rnPats -------------------</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- Binds local names; the scope of the bindings is entirely in the thing_inside</span><span>
</span><a name="line-306"></a><span class="hs-comment">--   * allows type sigs to bind type vars</span><span>
</span><a name="line-307"></a><span class="hs-comment">--   * local namemaker</span><span>
</span><a name="line-308"></a><span class="hs-comment">--   * unused and duplicate checking</span><span>
</span><a name="line-309"></a><span class="hs-comment">--   * no fixities</span><span>
</span><a name="line-310"></a><span class="hs-identifier">rnPats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-comment">-- for error messages</span><span>
</span><a name="line-311"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>
</span><a name="line-312"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147451"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147451"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-314"></a><a name="rnPats"><a href="RnPat.html#rnPats"><span class="hs-identifier">rnPats</span></a></a><span> </span><a name="local-6989586621682147498"><a href="#local-6989586621682147498"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682147499"><a href="#local-6989586621682147499"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621682147500"><a href="#local-6989586621682147500"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-315"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147502"><a href="#local-6989586621682147502"><span class="hs-identifier">envs_before</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getRdrEnvs"><span class="hs-identifier hs-var">getRdrEnvs</span></a><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span>          </span><span class="hs-comment">-- (1) rename the patterns, bringing into scope all of the term variables</span><span>
</span><a name="line-318"></a><span>          </span><span class="hs-comment">-- (2) then do the thing inside.</span><span>
</span><a name="line-319"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">unCpsRn</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#rnLPatsAndThen"><span class="hs-identifier hs-var">rnLPatsAndThen</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#matchNameMaker"><span class="hs-identifier hs-var">matchNameMaker</span></a><span> </span><a href="#local-6989586621682147498"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147499"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682147503"><a href="#local-6989586621682147503"><span class="hs-identifier">pats'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-320"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Check for duplicated and shadowed names</span><span>
</span><a name="line-321"></a><span>          </span><span class="hs-comment">-- Must do this *after* renaming the patterns</span><span>
</span><a name="line-322"></a><span>          </span><span class="hs-comment">-- See Note [Collect binders only after renaming] in HsUtils</span><span>
</span><a name="line-323"></a><span>          </span><span class="hs-comment">-- Because we don't bind the vars all at once, we can't</span><span>
</span><a name="line-324"></a><span>          </span><span class="hs-comment">--    check incrementally for duplicates;</span><span>
</span><a name="line-325"></a><span>          </span><span class="hs-comment">-- Nor can we check incrementally for shadowing, else we'll</span><span>
</span><a name="line-326"></a><span>          </span><span class="hs-comment">--    complain *twice* about duplicates e.g. f (x,x) = ...</span><span>
</span><a name="line-327"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-328"></a><span>          </span><span class="hs-comment">-- See note [Don't report shadowing for pattern synonyms]</span><span>
</span><a name="line-329"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147504"><a href="#local-6989586621682147504"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">collectPatsBinders</span><span> </span><a href="#local-6989586621682147503"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-330"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><a href="#local-6989586621682147501"><span class="hs-identifier hs-var">doc_pat</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-331"></a><span>          </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isPatSynCtxt</span><span> </span><a href="#local-6989586621682147498"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-332"></a><span>             </span><span class="hs-keyword">then</span><span> </span><a href="RnUtils.html#checkDupNames"><span class="hs-identifier hs-var">checkDupNames</span></a><span> </span><a href="#local-6989586621682147504"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-333"></a><span>             </span><span class="hs-keyword">else</span><span> </span><a href="RnUtils.html#checkDupAndShadowedNames"><span class="hs-identifier hs-var">checkDupAndShadowedNames</span></a><span> </span><a href="#local-6989586621682147502"><span class="hs-identifier hs-var">envs_before</span></a><span> </span><a href="#local-6989586621682147504"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-334"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621682147500"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621682147503"><span class="hs-identifier hs-var">pats'</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-335"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-336"></a><span>    </span><a name="local-6989586621682147501"><a href="#local-6989586621682147501"><span class="hs-identifier">doc_pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprMatchContext</span><span> </span><a href="#local-6989586621682147498"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-identifier">rnPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-comment">-- for error messages</span><span>
</span><a name="line-339"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-340"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147450"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147450"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Variables bound by pattern do not</span><span>
</span><a name="line-342"></a><span>                               </span><span class="hs-comment">-- appear in the result FreeVars</span><span>
</span><a name="line-343"></a><a name="rnPat"><a href="RnPat.html#rnPat"><span class="hs-identifier">rnPat</span></a></a><span> </span><a name="local-6989586621682147505"><a href="#local-6989586621682147505"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682147506"><a href="#local-6989586621682147506"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621682147507"><a href="#local-6989586621682147507"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-344"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#rnPats"><span class="hs-identifier hs-var">rnPats</span></a><span> </span><a href="#local-6989586621682147505"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682147506"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682147508"><a href="#local-6989586621682147508"><span class="hs-identifier">pats'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-6989586621682147509"><a href="#local-6989586621682147509"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147508"><span class="hs-identifier hs-var">pats'</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621682147507"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621682147509"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-identifier">applyNameMaker</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-347"></a><a name="applyNameMaker"><a href="RnPat.html#applyNameMaker"><span class="hs-identifier">applyNameMaker</span></a></a><span> </span><a name="local-6989586621682147510"><a href="#local-6989586621682147510"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621682147511"><a href="#local-6989586621682147511"><span class="hs-identifier">rdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147512"><a href="#local-6989586621682147512"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147513"><a href="#local-6989586621682147513"><span class="hs-identifier">_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#runCps"><span class="hs-identifier hs-var">runCps</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#newPatLName"><span class="hs-identifier hs-var">newPatLName</span></a><span> </span><a href="#local-6989586621682147510"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147511"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>                           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682147512"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-comment">-- ----------- Entry point 2: rnBindPat -------------------</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- Binds local names; in a recursive scope that involves other bound vars</span><span>
</span><a name="line-352"></a><span class="hs-comment">--      e.g let { (x, Just y) = e1; ... } in ...</span><span>
</span><a name="line-353"></a><span class="hs-comment">--   * does NOT allows type sig to bind type vars</span><span>
</span><a name="line-354"></a><span class="hs-comment">--   * local namemaker</span><span>
</span><a name="line-355"></a><span class="hs-comment">--   * no unused and duplicate checking</span><span>
</span><a name="line-356"></a><span class="hs-comment">--   * fixities might be coming in</span><span>
</span><a name="line-357"></a><span class="hs-identifier">rnBindPat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span>
</span><a name="line-358"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-359"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-360"></a><span>   </span><span class="hs-comment">-- Returned FreeVars are the free variables of the pattern,</span><span>
</span><a name="line-361"></a><span>   </span><span class="hs-comment">-- of course excluding variables bound by this pattern</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><a name="rnBindPat"><a href="RnPat.html#rnBindPat"><span class="hs-identifier">rnBindPat</span></a></a><span> </span><a name="local-6989586621682147514"><a href="#local-6989586621682147514"><span class="hs-identifier">name_maker</span></a></a><span> </span><a name="local-6989586621682147515"><a href="#local-6989586621682147515"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#runCps"><span class="hs-identifier hs-var">runCps</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147514"><span class="hs-identifier hs-var">name_maker</span></a><span> </span><a href="#local-6989586621682147515"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
        The main event
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-comment">-- ----------- Entry point 3: rnLPatAndThen -------------------</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- General version: parametrized by how you make new names</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-identifier">rnLPatsAndThen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span>
</span><a name="line-377"></a><a name="rnLPatsAndThen"><a href="RnPat.html#rnLPatsAndThen"><span class="hs-identifier">rnLPatsAndThen</span></a></a><span> </span><a name="local-6989586621682147516"><a href="#local-6989586621682147516"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147516"><span class="hs-identifier hs-var">mk</span></a><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span>  </span><span class="hs-comment">-- Despite the map, the monad ensures that each pattern binds</span><span>
</span><a name="line-379"></a><span>  </span><span class="hs-comment">-- variables that may be mentioned in subsequent patterns in the list</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- The workhorse</span><span>
</span><a name="line-383"></a><span class="hs-identifier">rnLPatAndThen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-384"></a><a name="rnLPatAndThen"><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier">rnLPatAndThen</span></a></a><span> </span><a name="local-6989586621682147517"><a href="#local-6989586621682147517"><span class="hs-identifier">nm</span></a></a><span> </span><a name="local-6989586621682147518"><a href="#local-6989586621682147518"><span class="hs-identifier">lpat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#wrapSrcSpanCps"><span class="hs-identifier hs-var">wrapSrcSpanCps</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#rnPatAndThen"><span class="hs-identifier hs-var">rnPatAndThen</span></a><span> </span><a href="#local-6989586621682147517"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147518"><span class="hs-identifier hs-var">lpat</span></a><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-387"></a><a name="rnPatAndThen"><a href="RnPat.html#rnPatAndThen"><span class="hs-identifier">rnPatAndThen</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WildPat</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WildPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147519"><a href="#local-6989586621682147519"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParPat</span><span> </span><a name="local-6989586621682147520"><a href="#local-6989586621682147520"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147521"><a href="#local-6989586621682147521"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147522"><a href="#local-6989586621682147522"><span class="hs-identifier">pat'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147519"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147521"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-389"></a><span>                                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParPat</span><span> </span><a href="#local-6989586621682147520"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682147522"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-390"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147523"><a href="#local-6989586621682147523"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LazyPat</span><span> </span><a name="local-6989586621682147524"><a href="#local-6989586621682147524"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147525"><a href="#local-6989586621682147525"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147526"><a href="#local-6989586621682147526"><span class="hs-identifier">pat'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147523"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147525"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-391"></a><span>                                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LazyPat</span><span> </span><a href="#local-6989586621682147524"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682147526"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-392"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147527"><a href="#local-6989586621682147527"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BangPat</span><span> </span><a name="local-6989586621682147528"><a href="#local-6989586621682147528"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147529"><a href="#local-6989586621682147529"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147530"><a href="#local-6989586621682147530"><span class="hs-identifier">pat'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147527"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147529"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-393"></a><span>                                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BangPat</span><span> </span><a href="#local-6989586621682147528"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682147530"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-394"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147531"><a href="#local-6989586621682147531"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarPat</span><span> </span><a name="local-6989586621682147532"><a href="#local-6989586621682147532"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147533"><a href="#local-6989586621682147533"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682147534"><a href="#local-6989586621682147534"><span class="hs-identifier">rdr</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147535"><a href="#local-6989586621682147535"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-396"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147536"><a href="#local-6989586621682147536"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#newPatName"><span class="hs-identifier hs-var">newPatName</span></a><span> </span><a href="#local-6989586621682147531"><span class="hs-identifier hs-var">mk</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147535"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147534"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span>
</span><a name="line-397"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarPat</span><span> </span><a href="#local-6989586621682147532"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147533"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682147536"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-398"></a><span>     </span><span class="hs-comment">-- we need to bind pattern variables for view pattern expressions</span><span>
</span><a name="line-399"></a><span>     </span><span class="hs-comment">-- (e.g. in the pattern (x, x -&gt; y) x needs to be bound in the rhs of the tuple)</span><span>
</span><a name="line-400"></a><span>
</span><a name="line-401"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147537"><a href="#local-6989586621682147537"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigPat</span><span> </span><a name="local-6989586621682147538"><a href="#local-6989586621682147538"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147539"><a href="#local-6989586621682147539"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621682147540"><a href="#local-6989586621682147540"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>  </span><span class="hs-comment">-- When renaming a pattern type signature (e.g. f (a :: T) = ...), it is</span><span>
</span><a name="line-403"></a><span>  </span><span class="hs-comment">-- important to rename its type signature _before_ renaming the rest of the</span><span>
</span><a name="line-404"></a><span>  </span><span class="hs-comment">-- pattern, so that type variables are first bound by the _outermost_ pattern</span><span>
</span><a name="line-405"></a><span>  </span><span class="hs-comment">-- type signature they occur in. This keeps the type checker happy when</span><span>
</span><a name="line-406"></a><span>  </span><span class="hs-comment">-- pattern type signatures happen to be nested (#7827)</span><span>
</span><a name="line-407"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-408"></a><span>  </span><span class="hs-comment">-- f ((Just (x :: a) :: Maybe a)</span><span>
</span><a name="line-409"></a><span>  </span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~^       `a' is first bound here</span><span>
</span><a name="line-410"></a><span>  </span><span class="hs-comment">-- ~~~~~~~~~~~~~~~^                   the same `a' then used here</span><span>
</span><a name="line-411"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147541"><a href="#local-6989586621682147541"><span class="hs-identifier">sig'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnHsSigCps"><span class="hs-identifier hs-var">rnHsSigCps</span></a><span> </span><a href="#local-6989586621682147540"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-412"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147542"><a href="#local-6989586621682147542"><span class="hs-identifier">pat'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147537"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147539"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-413"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigPat</span><span> </span><a href="#local-6989586621682147538"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682147542"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-6989586621682147541"><span class="hs-identifier hs-var">sig'</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147543"><a href="#local-6989586621682147543"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitPat</span><span> </span><a name="local-6989586621682147544"><a href="#local-6989586621682147544"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147545"><a href="#local-6989586621682147545"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-416"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">HsString</span><span> </span><a name="local-6989586621682147547"><a href="#local-6989586621682147547"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621682147548"><a href="#local-6989586621682147548"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682147545"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-417"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147549"><a href="#local-6989586621682147549"><span class="hs-identifier">ovlStr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.OverloadedStrings</span><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621682147549"><span class="hs-identifier hs-var">ovlStr</span></a><span>
</span><a name="line-419"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="RnPat.html#rnPatAndThen"><span class="hs-identifier hs-var">rnPatAndThen</span></a><span> </span><a href="#local-6989586621682147543"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-420"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkNPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsIsString</span><span> </span><a href="#local-6989586621682147547"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621682147548"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>                                      </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621682147546"><span class="hs-identifier hs-var">normal_lit</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-423"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147546"><span class="hs-identifier hs-var">normal_lit</span></a><span>
</span><a name="line-424"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-425"></a><span>    </span><a name="local-6989586621682147546"><a href="#local-6989586621682147546"><span class="hs-identifier">normal_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#rnLit"><span class="hs-identifier hs-var">rnLit</span></a><span> </span><a href="#local-6989586621682147545"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitPat</span><span> </span><a href="#local-6989586621682147544"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">convertLit</span><span> </span><a href="#local-6989586621682147545"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NPat</span><span> </span><a name="local-6989586621682147550"><a href="#local-6989586621682147550"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147551"><a href="#local-6989586621682147551"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682147552"><a href="#local-6989586621682147552"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682147553"><a href="#local-6989586621682147553"><span class="hs-identifier">mb_neg</span></a></a><span> </span><a name="local-6989586621682147554"><a href="#local-6989586621682147554"><span class="hs-identifier">_eq</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-428"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147555"><a href="#local-6989586621682147555"><span class="hs-identifier">lit'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147556"><a href="#local-6989586621682147556"><span class="hs-identifier">mb_neg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnPat.html#rnOverLit"><span class="hs-identifier hs-var">rnOverLit</span></a><span> </span><a href="#local-6989586621682147552"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-429"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147561"><a href="#local-6989586621682147561"><span class="hs-identifier">mb_neg'</span></a></a><span> </span><span class="hs-comment">-- See Note [Negative zero]</span><span>
</span><a name="line-430"></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147557"><a href="#local-6989586621682147557"><span class="hs-identifier">negative</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147559"><a href="#local-6989586621682147559"><span class="hs-identifier">neg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147560"><a href="#local-6989586621682147560"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a><span> </span><span class="hs-identifier hs-var">negateName</span><span>
</span><a name="line-431"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682147559"><span class="hs-identifier hs-var">neg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682147560"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-432"></a><span>                  </span><a name="local-6989586621682147558"><a href="#local-6989586621682147558"><span class="hs-identifier">positive</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-433"></a><span>              </span><span class="hs-keyword">in</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147553"><span class="hs-identifier hs-var">mb_neg</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682147556"><span class="hs-identifier hs-var">mb_neg'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-434"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147557"><span class="hs-identifier hs-var">negative</span></a><span>
</span><a name="line-435"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147557"><span class="hs-identifier hs-var">negative</span></a><span>
</span><a name="line-436"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147558"><span class="hs-identifier hs-var">positive</span></a><span>
</span><a name="line-437"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147558"><span class="hs-identifier hs-var">positive</span></a><span>
</span><a name="line-438"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147562"><a href="#local-6989586621682147562"><span class="hs-identifier">eq'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnEnv.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a><span> </span><span class="hs-identifier hs-var">eqName</span><span>
</span><a name="line-439"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NPat</span><span> </span><a href="#local-6989586621682147550"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147551"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682147555"><span class="hs-identifier hs-var">lit'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147561"><span class="hs-identifier hs-var">mb_neg'</span></a><span> </span><a href="#local-6989586621682147562"><span class="hs-identifier hs-var">eq'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147563"><a href="#local-6989586621682147563"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NPlusKPat</span><span> </span><a name="local-6989586621682147564"><a href="#local-6989586621682147564"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147565"><a href="#local-6989586621682147565"><span class="hs-identifier">rdr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147566"><a href="#local-6989586621682147566"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682147567"><a href="#local-6989586621682147567"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147568"><a href="#local-6989586621682147568"><span class="hs-identifier">new_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#newPatName"><span class="hs-identifier hs-var">newPatName</span></a><span> </span><a href="#local-6989586621682147563"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147565"><span class="hs-identifier hs-var">rdr</span></a><span>
</span><a name="line-443"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147569"><a href="#local-6989586621682147569"><span class="hs-identifier">lit'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnPat.html#rnOverLit"><span class="hs-identifier hs-var">rnOverLit</span></a><span> </span><a href="#local-6989586621682147567"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-comment">-- See Note [Negative zero]</span><span>
</span><a name="line-444"></a><span>                                                </span><span class="hs-comment">-- We skip negateName as</span><span>
</span><a name="line-445"></a><span>                                                </span><span class="hs-comment">-- negative zero doesn't make</span><span>
</span><a name="line-446"></a><span>                                                </span><span class="hs-comment">-- sense in n + k patterns</span><span>
</span><a name="line-447"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147570"><a href="#local-6989586621682147570"><span class="hs-identifier">minus</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnEnv.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a><span> </span><span class="hs-identifier hs-var">minusName</span><span>
</span><a name="line-448"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147571"><a href="#local-6989586621682147571"><span class="hs-identifier">ge</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnEnv.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a><span> </span><span class="hs-identifier hs-var">geName</span><span>
</span><a name="line-449"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NPlusKPat</span><span> </span><a href="#local-6989586621682147564"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nameSrcSpan</span><span> </span><a href="#local-6989586621682147568"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147568"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147566"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682147569"><span class="hs-identifier hs-var">lit'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147569"><span class="hs-identifier hs-var">lit'</span></a><span> </span><a href="#local-6989586621682147571"><span class="hs-identifier hs-var">ge</span></a><span> </span><a href="#local-6989586621682147570"><span class="hs-identifier hs-var">minus</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-451"></a><span>                </span><span class="hs-comment">-- The Report says that n+k patterns must be in Integral</span><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147572"><a href="#local-6989586621682147572"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AsPat</span><span> </span><a name="local-6989586621682147573"><a href="#local-6989586621682147573"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147574"><a href="#local-6989586621682147574"><span class="hs-identifier">rdr</span></a></a><span> </span><a name="local-6989586621682147575"><a href="#local-6989586621682147575"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147576"><a href="#local-6989586621682147576"><span class="hs-identifier">new_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#newPatLName"><span class="hs-identifier hs-var">newPatLName</span></a><span> </span><a href="#local-6989586621682147572"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147574"><span class="hs-identifier hs-var">rdr</span></a><span>
</span><a name="line-455"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147577"><a href="#local-6989586621682147577"><span class="hs-identifier">pat'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147572"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147575"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-456"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AsPat</span><span> </span><a href="#local-6989586621682147573"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682147576"><span class="hs-identifier hs-var">new_name</span></a><span> </span><a href="#local-6989586621682147577"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-457"></a><span>
</span><a name="line-458"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147578"><a href="#local-6989586621682147578"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621682147579"><a href="#local-6989586621682147579"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ViewPat</span><span> </span><a name="local-6989586621682147580"><a href="#local-6989586621682147580"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147581"><a href="#local-6989586621682147581"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621682147582"><a href="#local-6989586621682147582"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147583"><a href="#local-6989586621682147583"><span class="hs-identifier">vp_flag</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.ViewPatterns</span><span>
</span><a name="line-460"></a><span>                      </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkErr"><span class="hs-identifier hs-var">checkErr</span></a><span> </span><a href="#local-6989586621682147583"><span class="hs-identifier hs-var">vp_flag</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#badViewPat"><span class="hs-identifier hs-var">badViewPat</span></a><span> </span><a href="#local-6989586621682147579"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-461"></a><span>         </span><span class="hs-comment">-- Because of the way we're arranging the recursive calls,</span><span>
</span><a name="line-462"></a><span>         </span><span class="hs-comment">-- this will be in the right context</span><span>
</span><a name="line-463"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147584"><a href="#local-6989586621682147584"><span class="hs-identifier">expr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621682147581"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-464"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147585"><a href="#local-6989586621682147585"><span class="hs-identifier">pat'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147578"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147582"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-465"></a><span>       </span><span class="hs-comment">-- Note: at this point the PreTcType in ty can only be a placeHolder</span><span>
</span><a name="line-466"></a><span>       </span><span class="hs-comment">-- ; return (ViewPat expr' pat' ty) }</span><span>
</span><a name="line-467"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ViewPat</span><span> </span><a href="#local-6989586621682147580"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682147584"><span class="hs-identifier hs-var">expr'</span></a><span> </span><a href="#local-6989586621682147585"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147586"><a href="#local-6989586621682147586"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a name="local-6989586621682147587"><a href="#local-6989586621682147587"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621682147588"><a href="#local-6989586621682147588"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-470"></a><span>   </span><span class="hs-comment">-- rnConPatAndThen takes care of reconstructing the pattern</span><span>
</span><a name="line-471"></a><span>   </span><span class="hs-comment">-- The pattern for the empty list needs to be replaced by an empty explicit list pattern when overloaded lists is turned on.</span><span>
</span><a name="line-472"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682147587"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">nameRdrName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConName</span><span> </span><span class="hs-identifier hs-var">nilDataCon</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-473"></a><span>      </span><span class="hs-identifier hs-var">True</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147589"><a href="#local-6989586621682147589"><span class="hs-identifier">ol_flag</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.OverloadedLists</span><span>
</span><a name="line-474"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621682147589"><span class="hs-identifier hs-var">ol_flag</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="RnPat.html#rnPatAndThen"><span class="hs-identifier hs-var">rnPatAndThen</span></a><span> </span><a href="#local-6989586621682147586"><span class="hs-identifier hs-var">mk</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span>                                 </span><span class="hs-keyword">else</span><span> </span><a href="RnPat.html#rnConPatAndThen"><span class="hs-identifier hs-var">rnConPatAndThen</span></a><span> </span><a href="#local-6989586621682147586"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147587"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621682147588"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">}</span><span>
</span><a name="line-476"></a><span>      </span><span class="hs-identifier hs-var">False</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#rnConPatAndThen"><span class="hs-identifier hs-var">rnConPatAndThen</span></a><span> </span><a href="#local-6989586621682147586"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147587"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621682147588"><span class="hs-identifier hs-var">stuff</span></a><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147590"><a href="#local-6989586621682147590"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682147591"><a href="#local-6989586621682147591"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147592"><a href="#local-6989586621682147592"><span class="hs-identifier">opt_OverloadedLists</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.OverloadedLists</span><span>
</span><a name="line-480"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147593"><a href="#local-6989586621682147593"><span class="hs-identifier">pats'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatsAndThen"><span class="hs-identifier hs-var">rnLPatsAndThen</span></a><span> </span><a href="#local-6989586621682147590"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147591"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-481"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147592"><span class="hs-identifier hs-var">opt_OverloadedLists</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-482"></a><span>          </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147594"><a href="#local-6989586621682147594"><span class="hs-identifier">to_list_name</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnEnv.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a><span> </span><span class="hs-identifier hs-var">toListName</span><span>
</span><a name="line-483"></a><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682147594"><span class="hs-identifier hs-var">to_list_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147593"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-484"></a><span>          </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621682147593"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147595"><a href="#local-6989586621682147595"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TuplePat</span><span> </span><a name="local-6989586621682147596"><a href="#local-6989586621682147596"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147597"><a href="#local-6989586621682147597"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621682147598"><a href="#local-6989586621682147598"><span class="hs-identifier">boxed</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-487"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnUtils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621682147597"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span>
</span><a name="line-488"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147599"><a href="#local-6989586621682147599"><span class="hs-identifier">pats'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatsAndThen"><span class="hs-identifier hs-var">rnLPatsAndThen</span></a><span> </span><a href="#local-6989586621682147595"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147597"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-489"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TuplePat</span><span> </span><a href="#local-6989586621682147596"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682147599"><span class="hs-identifier hs-var">pats'</span></a><span> </span><a href="#local-6989586621682147598"><span class="hs-identifier hs-var">boxed</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147600"><a href="#local-6989586621682147600"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SumPat</span><span> </span><a name="local-6989586621682147601"><a href="#local-6989586621682147601"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682147602"><a href="#local-6989586621682147602"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621682147603"><a href="#local-6989586621682147603"><span class="hs-identifier">alt</span></a></a><span> </span><a name="local-6989586621682147604"><a href="#local-6989586621682147604"><span class="hs-identifier">arity</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-492"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147605"><a href="#local-6989586621682147605"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147600"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147602"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-493"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SumPat</span><span> </span><a href="#local-6989586621682147601"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682147605"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621682147603"><span class="hs-identifier hs-var">alt</span></a><span> </span><a href="#local-6989586621682147604"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-494"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-comment">-- If a splice has been run already, just rename the result.</span><span>
</span><a name="line-497"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147606"><a href="#local-6989586621682147606"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SplicePat</span><span> </span><a name="local-6989586621682147607"><a href="#local-6989586621682147607"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSpliced</span><span> </span><a name="local-6989586621682147608"><a href="#local-6989586621682147608"><span class="hs-identifier">x2</span></a></a><span> </span><a name="local-6989586621682147609"><a href="#local-6989586621682147609"><span class="hs-identifier">mfs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSplicedPat</span><span> </span><a name="local-6989586621682147610"><a href="#local-6989586621682147610"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SplicePat</span><span> </span><a href="#local-6989586621682147607"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">HsSpliced</span><span> </span><a href="#local-6989586621682147608"><span class="hs-identifier hs-var">x2</span></a><span> </span><a href="#local-6989586621682147609"><span class="hs-identifier hs-var">mfs</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">HsSplicedPat</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="RnPat.html#rnPatAndThen"><span class="hs-identifier hs-var">rnPatAndThen</span></a><span> </span><a href="#local-6989586621682147606"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147610"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><a name="local-6989586621682147611"><a href="#local-6989586621682147611"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SplicePat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682147612"><a href="#local-6989586621682147612"><span class="hs-identifier">splice</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147613"><a href="#local-6989586621682147613"><span class="hs-identifier">eith</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnSplice.html#rnSplicePat"><span class="hs-identifier hs-var">rnSplicePat</span></a><span> </span><a href="#local-6989586621682147612"><span class="hs-identifier hs-var">splice</span></a><span>
</span><a name="line-502"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147613"><span class="hs-identifier hs-var">eith</span></a><span> </span><span class="hs-keyword">of</span><span>   </span><span class="hs-comment">-- See Note [rnSplicePat] in RnSplice</span><span>
</span><a name="line-503"></a><span>           </span><span class="hs-identifier hs-var">Left</span><span>  </span><a name="local-6989586621682147614"><a href="#local-6989586621682147614"><span class="hs-identifier">not_yet_renamed</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#rnPatAndThen"><span class="hs-identifier hs-var">rnPatAndThen</span></a><span> </span><a href="#local-6989586621682147611"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147614"><span class="hs-identifier hs-var">not_yet_renamed</span></a><span>
</span><a name="line-504"></a><span>           </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621682147615"><a href="#local-6989586621682147615"><span class="hs-identifier">already_renamed</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682147615"><span class="hs-identifier hs-var">already_renamed</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span class="hs-identifier">rnPatAndThen</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682147616"><a href="#local-6989586621682147616"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;rnLPatAndThen&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682147616"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-507"></a><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-510"></a><span class="hs-identifier">rnConPatAndThen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span>
</span><a name="line-511"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>    </span><span class="hs-comment">-- the constructor</span><span>
</span><a name="line-512"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsConPatDetails</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-513"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><a name="rnConPatAndThen"><a href="RnPat.html#rnConPatAndThen"><span class="hs-identifier">rnConPatAndThen</span></a></a><span> </span><a name="local-6989586621682147617"><a href="#local-6989586621682147617"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621682147618"><a href="#local-6989586621682147618"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><a name="local-6989586621682147619"><a href="#local-6989586621682147619"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147620"><a href="#local-6989586621682147620"><span class="hs-identifier">con'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#lookupConCps"><span class="hs-identifier hs-var">lookupConCps</span></a><span> </span><a href="#local-6989586621682147618"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-517"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147621"><a href="#local-6989586621682147621"><span class="hs-identifier">pats'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatsAndThen"><span class="hs-identifier hs-var">rnLPatsAndThen</span></a><span> </span><a href="#local-6989586621682147617"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147619"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-518"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a href="#local-6989586621682147620"><span class="hs-identifier hs-var">con'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><a href="#local-6989586621682147621"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-identifier">rnConPatAndThen</span><span> </span><a name="local-6989586621682147622"><a href="#local-6989586621682147622"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621682147623"><a href="#local-6989586621682147623"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a name="local-6989586621682147624"><a href="#local-6989586621682147624"><span class="hs-identifier">pat1</span></a></a><span> </span><a name="local-6989586621682147625"><a href="#local-6989586621682147625"><span class="hs-identifier">pat2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147626"><a href="#local-6989586621682147626"><span class="hs-identifier">con'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#lookupConCps"><span class="hs-identifier hs-var">lookupConCps</span></a><span> </span><a href="#local-6989586621682147623"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-522"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147627"><a href="#local-6989586621682147627"><span class="hs-identifier">pat1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147622"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147624"><span class="hs-identifier hs-var">pat1</span></a><span>
</span><a name="line-523"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147628"><a href="#local-6989586621682147628"><span class="hs-identifier">pat2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><a href="#local-6989586621682147622"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147625"><span class="hs-identifier hs-var">pat2</span></a><span>
</span><a name="line-524"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147629"><a href="#local-6989586621682147629"><span class="hs-identifier">fixity</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnFixity.html#lookupFixityRn"><span class="hs-identifier hs-var">lookupFixityRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682147626"><span class="hs-identifier hs-var">con'</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnPat.html#liftCps"><span class="hs-identifier hs-var">liftCps</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnTypes.html#mkConOpPatRn"><span class="hs-identifier hs-var">mkConOpPatRn</span></a><span> </span><a href="#local-6989586621682147626"><span class="hs-identifier hs-var">con'</span></a><span> </span><a href="#local-6989586621682147629"><span class="hs-identifier hs-var">fixity</span></a><span> </span><a href="#local-6989586621682147627"><span class="hs-identifier hs-var">pat1'</span></a><span> </span><a href="#local-6989586621682147628"><span class="hs-identifier hs-var">pat2'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span class="hs-identifier">rnConPatAndThen</span><span> </span><a name="local-6989586621682147630"><a href="#local-6989586621682147630"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621682147631"><a href="#local-6989586621682147631"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecCon</span><span> </span><a name="local-6989586621682147632"><a href="#local-6989586621682147632"><span class="hs-identifier">rpats</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147633"><a href="#local-6989586621682147633"><span class="hs-identifier">con'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#lookupConCps"><span class="hs-identifier hs-var">lookupConCps</span></a><span> </span><a href="#local-6989586621682147631"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-529"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147634"><a href="#local-6989586621682147634"><span class="hs-identifier">rpats'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnHsRecPatsAndThen"><span class="hs-identifier hs-var">rnHsRecPatsAndThen</span></a><span> </span><a href="#local-6989586621682147630"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147633"><span class="hs-identifier hs-var">con'</span></a><span> </span><a href="#local-6989586621682147632"><span class="hs-identifier hs-var">rpats</span></a><span>
</span><a name="line-530"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><a href="#local-6989586621682147633"><span class="hs-identifier hs-var">con'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecCon</span><span> </span><a href="#local-6989586621682147634"><span class="hs-identifier hs-var">rpats'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-531"></a><span>
</span><a name="line-532"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-533"></a><span class="hs-identifier">rnHsRecPatsAndThen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span>
</span><a name="line-534"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span>      </span><span class="hs-comment">-- Constructor</span><span>
</span><a name="line-535"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsRecFields</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-536"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnPat.html#CpsRn"><span class="hs-identifier hs-type">CpsRn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsRecFields</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-537"></a><a name="rnHsRecPatsAndThen"><a href="RnPat.html#rnHsRecPatsAndThen"><span class="hs-identifier">rnHsRecPatsAndThen</span></a></a><span> </span><a name="local-6989586621682147635"><a href="#local-6989586621682147635"><span class="hs-identifier">mk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682147636"><a href="#local-6989586621682147636"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>     </span><a name="local-6989586621682147637"><a href="#local-6989586621682147637"><span class="hs-identifier">hs_rec_fields</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rec_dotdot</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147638"><a href="#local-6989586621682147638"><span class="hs-identifier">dd</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147653"><a href="#local-6989586621682147653"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#liftCpsFV"><span class="hs-identifier hs-var">liftCpsFV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnPat.html#rnHsRecFields"><span class="hs-identifier hs-var">rnHsRecFields</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#HsRecFieldPat"><span class="hs-identifier hs-var">HsRecFieldPat</span></a><span> </span><a href="#local-6989586621682147636"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147639"><span class="hs-identifier hs-var">mkVarPat</span></a><span>
</span><a name="line-540"></a><span>                                            </span><a href="#local-6989586621682147637"><span class="hs-identifier hs-var">hs_rec_fields</span></a><span>
</span><a name="line-541"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147654"><a href="#local-6989586621682147654"><span class="hs-identifier">flds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621682147640"><span class="hs-identifier hs-var">rn_field</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147653"><span class="hs-identifier hs-var">flds</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">zip</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rec_flds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147654"><span class="hs-identifier hs-var">flds'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rec_dotdot</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147638"><span class="hs-identifier hs-var">dd</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-543"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-544"></a><span>    </span><a name="local-6989586621682147639"><a href="#local-6989586621682147639"><span class="hs-identifier">mkVarPat</span></a></a><span> </span><a name="local-6989586621682147642"><a href="#local-6989586621682147642"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682147643"><a href="#local-6989586621682147643"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">VarPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147642"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682147643"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-545"></a><span>    </span><a name="local-6989586621682147640"><a href="#local-6989586621682147640"><span class="hs-identifier">rn_field</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147644"><a href="#local-6989586621682147644"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682147645"><a href="#local-6989586621682147645"><span class="hs-identifier">fld</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147646"><a href="#local-6989586621682147646"><span class="hs-identifier">n'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-546"></a><span>      </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147647"><a href="#local-6989586621682147647"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnLPatAndThen"><span class="hs-identifier hs-var">rnLPatAndThen</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147641"><span class="hs-identifier hs-var">nested_mk</span></a><span> </span><a href="#local-6989586621682147638"><span class="hs-identifier hs-var">dd</span></a><span> </span><a href="#local-6989586621682147635"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621682147646"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsRecFieldArg</span><span> </span><a href="#local-6989586621682147645"><span class="hs-identifier hs-var">fld</span></a><span class="hs-special">)</span><span>
</span><a name="line-547"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147644"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147645"><span class="hs-identifier hs-var">fld</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147647"><span class="hs-identifier hs-var">arg'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span>        </span><span class="hs-comment">-- Suppress unused-match reporting for fields introduced by &quot;..&quot;</span><span>
</span><a name="line-550"></a><span>    </span><a name="local-6989586621682147641"><a href="#local-6989586621682147641"><span class="hs-identifier">nested_mk</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><a name="local-6989586621682147648"><a href="#local-6989586621682147648"><span class="hs-identifier">mk</span></a></a><span>                    </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147648"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-551"></a><span>    </span><span class="hs-identifier">nested_mk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682147649"><a href="#local-6989586621682147649"><span class="hs-identifier">mk</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RnPat.html#LetMk"><span class="hs-identifier hs-var">LetMk</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147649"><span class="hs-identifier hs-var">mk</span></a><span>
</span><a name="line-552"></a><span>    </span><span class="hs-identifier">nested_mk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682147650"><a href="#local-6989586621682147650"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#LamMk"><span class="hs-identifier hs-var">LamMk</span></a><span> </span><a name="local-6989586621682147651"><a href="#local-6989586621682147651"><span class="hs-identifier">report_unused</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682147652"><a href="#local-6989586621682147652"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#LamMk"><span class="hs-identifier hs-var">LamMk</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147651"><span class="hs-identifier hs-var">report_unused</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147652"><span class="hs-identifier hs-var">n'</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621682147650"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>
</span><a name="line-554"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Record fields
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-561"></a><span>
</span><a name="line-562"></a><span class="hs-keyword">data</span><span> </span><a name="HsRecFieldContext"><a href="RnPat.html#HsRecFieldContext"><span class="hs-identifier">HsRecFieldContext</span></a></a><span>
</span><a name="line-563"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="HsRecFieldCon"><a href="RnPat.html#HsRecFieldCon"><span class="hs-identifier">HsRecFieldCon</span></a></a><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-564"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HsRecFieldPat"><a href="RnPat.html#HsRecFieldPat"><span class="hs-identifier">HsRecFieldPat</span></a></a><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-565"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HsRecFieldUpd"><a href="RnPat.html#HsRecFieldUpd"><span class="hs-identifier">HsRecFieldUpd</span></a></a><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span class="hs-identifier">rnHsRecFields</span><span>
</span><a name="line-568"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682147449"><a href="#local-6989586621682147449"><span class="hs-identifier">arg</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">HasSrcSpan</span><span> </span><a href="#local-6989586621682147449"><span class="hs-identifier hs-type">arg</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-569"></a><span>       </span><a href="RnPat.html#HsRecFieldContext"><span class="hs-identifier hs-type">HsRecFieldContext</span></a><span>
</span><a name="line-570"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpanLess</span><span> </span><a href="#local-6989586621682147449"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-571"></a><span>         </span><span class="hs-comment">-- When punning, use this to build a new field</span><span>
</span><a name="line-572"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsRecFields</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><a href="#local-6989586621682147449"><span class="hs-identifier hs-type">arg</span></a><span>
</span><a name="line-573"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><a href="#local-6989586621682147449"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span class="hs-comment">-- This surprisingly complicated pass</span><span>
</span><a name="line-576"></a><span class="hs-comment">--   a) looks up the field name (possibly using disambiguation)</span><span>
</span><a name="line-577"></a><span class="hs-comment">--   b) fills in puns and dot-dot stuff</span><span>
</span><a name="line-578"></a><span class="hs-comment">-- When we've finished, we've renamed the LHS, but not the RHS,</span><span>
</span><a name="line-579"></a><span class="hs-comment">-- of each x=e binding</span><span>
</span><a name="line-580"></a><span class="hs-comment">--</span><span>
</span><a name="line-581"></a><span class="hs-comment">-- This is used for record construction and pattern-matching, but not updates.</span><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><a name="rnHsRecFields"><a href="RnPat.html#rnHsRecFields"><span class="hs-identifier">rnHsRecFields</span></a></a><span> </span><a name="local-6989586621682147655"><a href="#local-6989586621682147655"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682147656"><a href="#local-6989586621682147656"><span class="hs-identifier">mk_arg</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rec_flds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147657"><a href="#local-6989586621682147657"><span class="hs-identifier">flds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rec_dotdot</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147658"><a href="#local-6989586621682147658"><span class="hs-identifier">dotdot</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-584"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147699"><a href="#local-6989586621682147699"><span class="hs-identifier">pun_ok</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.RecordPuns</span><span>
</span><a name="line-585"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147700"><a href="#local-6989586621682147700"><span class="hs-identifier">disambig_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DisambiguateRecordFields</span><span>
</span><a name="line-586"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147701"><a href="#local-6989586621682147701"><span class="hs-identifier">parent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><a href="#local-6989586621682147700"><span class="hs-identifier hs-var">disambig_ok</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621682147659"><span class="hs-identifier hs-var">mb_con</span></a><span>
</span><a name="line-587"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147702"><a href="#local-6989586621682147702"><span class="hs-identifier">flds1</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147660"><span class="hs-identifier hs-var">rn_fld</span></a><span> </span><a href="#local-6989586621682147699"><span class="hs-identifier hs-var">pun_ok</span></a><span> </span><a href="#local-6989586621682147701"><span class="hs-identifier hs-var">parent</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147657"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-588"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="RnPat.html#dupFieldErr"><span class="hs-identifier hs-var">dupFieldErr</span></a><span> </span><a href="#local-6989586621682147655"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147662"><span class="hs-identifier hs-var">dup_flds</span></a><span>
</span><a name="line-589"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147703"><a href="#local-6989586621682147703"><span class="hs-identifier">dotdot_flds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682147661"><span class="hs-identifier hs-var">rn_dotdot</span></a><span> </span><a href="#local-6989586621682147658"><span class="hs-identifier hs-var">dotdot</span></a><span> </span><a href="#local-6989586621682147659"><span class="hs-identifier hs-var">mb_con</span></a><span> </span><a href="#local-6989586621682147702"><span class="hs-identifier hs-var">flds1</span></a><span>
</span><a name="line-590"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147704"><a href="#local-6989586621682147704"><span class="hs-identifier">all_flds</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621682147703"><span class="hs-identifier hs-var">dotdot_flds</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147702"><span class="hs-identifier hs-var">flds1</span></a><span>
</span><a name="line-591"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147702"><span class="hs-identifier hs-var">flds1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682147703"><span class="hs-identifier hs-var">dotdot_flds</span></a><span>
</span><a name="line-592"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147704"><span class="hs-identifier hs-var">all_flds</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkFVs</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#getFieldIds"><span class="hs-identifier hs-var">getFieldIds</span></a><span> </span><a href="#local-6989586621682147704"><span class="hs-identifier hs-var">all_flds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-593"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-594"></a><span>    </span><a name="local-6989586621682147659"><a href="#local-6989586621682147659"><span class="hs-identifier">mb_con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147655"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-595"></a><span>                </span><a href="RnPat.html#HsRecFieldCon"><span class="hs-identifier hs-var">HsRecFieldCon</span></a><span> </span><a name="local-6989586621682147663"><a href="#local-6989586621682147663"><span class="hs-identifier">con</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682147663"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-596"></a><span>                </span><a href="RnPat.html#HsRecFieldPat"><span class="hs-identifier hs-var">HsRecFieldPat</span></a><span> </span><a name="local-6989586621682147664"><a href="#local-6989586621682147664"><span class="hs-identifier">con</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682147664"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-597"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-comment">{- update -}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span>    </span><span class="hs-identifier">rn_fld</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsRecField</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><a href="#local-6989586621682147449"><span class="hs-identifier hs-type">arg</span></a><span>
</span><a name="line-600"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsRecField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><a href="#local-6989586621682147449"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>    </span><a name="local-6989586621682147660"><a href="#local-6989586621682147660"><span class="hs-identifier">rn_fld</span></a></a><span> </span><a name="local-6989586621682147665"><a href="#local-6989586621682147665"><span class="hs-identifier">pun_ok</span></a></a><span> </span><a name="local-6989586621682147666"><a href="#local-6989586621682147666"><span class="hs-identifier">parent</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147667"><a href="#local-6989586621682147667"><span class="hs-identifier">l</span></a></a><span>
</span><a name="line-602"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecField</span><span>
</span><a name="line-603"></a><span>                              </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-604"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147668"><a href="#local-6989586621682147668"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FieldOcc</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147669"><a href="#local-6989586621682147669"><span class="hs-identifier">ll</span></a></a><span> </span><a name="local-6989586621682147670"><a href="#local-6989586621682147670"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147671"><a href="#local-6989586621682147671"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-606"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecPun</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147672"><a href="#local-6989586621682147672"><span class="hs-identifier">pun</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147673"><a href="#local-6989586621682147673"><span class="hs-identifier">sel</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682147668"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnEnv.html#lookupRecFieldOcc"><span class="hs-identifier hs-var">lookupRecFieldOcc</span></a><span> </span><a href="#local-6989586621682147666"><span class="hs-identifier hs-var">parent</span></a><span> </span><a href="#local-6989586621682147670"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-608"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147675"><a href="#local-6989586621682147675"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621682147672"><span class="hs-identifier hs-var">pun</span></a><span>
</span><a name="line-609"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#checkErr"><span class="hs-identifier hs-var">checkErr</span></a><span> </span><a href="#local-6989586621682147665"><span class="hs-identifier hs-var">pun_ok</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#badPun"><span class="hs-identifier hs-var">badPun</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147668"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147670"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-610"></a><span>                               </span><span class="hs-comment">-- Discard any module qualifier (#11662)</span><span>
</span><a name="line-611"></a><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147674"><a href="#local-6989586621682147674"><span class="hs-identifier">arg_rdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkRdrUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rdrNameOcc</span><span> </span><a href="#local-6989586621682147670"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-612"></a><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147668"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147656"><span class="hs-identifier hs-var">mk_arg</span></a><span> </span><a href="#local-6989586621682147668"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147674"><span class="hs-identifier hs-var">arg_rdr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-613"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682147671"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-614"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147667"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecField</span><span>
</span><a name="line-615"></a><span>                             </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147668"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FieldOcc</span><span>
</span><a name="line-616"></a><span>                                                          </span><a href="#local-6989586621682147673"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147669"><span class="hs-identifier hs-var">ll</span></a><span> </span><a href="#local-6989586621682147670"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-617"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147675"><span class="hs-identifier hs-var">arg'</span></a><span>
</span><a name="line-618"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecPun</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147672"><span class="hs-identifier hs-var">pun</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-619"></a><span>    </span><span class="hs-identifier">rn_fld</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecField</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XFieldOcc</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-620"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnHsRecFields&quot;</span><span>
</span><a name="line-621"></a><span>    </span><span class="hs-identifier">rn_fld</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rn_fld: Impossible Match&quot;</span><span>
</span><a name="line-622"></a><span>                                </span><span class="hs-comment">-- due to #15884</span><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span>
</span><a name="line-625"></a><span>    </span><span class="hs-identifier">rn_dotdot</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- See Note [DotDot fields] in HsPat</span><span>
</span><a name="line-626"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-comment">-- The constructor (Nothing for an</span><span>
</span><a name="line-627"></a><span>                                </span><span class="hs-comment">--    out of scope constructor)</span><span>
</span><a name="line-628"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><a href="#local-6989586621682147449"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Explicit fields</span><span>
</span><a name="line-629"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><a href="#local-6989586621682147449"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Filled in .. fields</span><span>
</span><a name="line-630"></a><span>    </span><a name="local-6989586621682147661"><a href="#local-6989586621682147661"><span class="hs-identifier">rn_dotdot</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682147676"><a href="#local-6989586621682147676"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682147677"><a href="#local-6989586621682147677"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682147678"><a href="#local-6989586621682147678"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-comment">-- &quot;..&quot; on record construction / pat match</span><span>
</span><a name="line-631"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isUnboundName</span><span> </span><a href="#local-6989586621682147677"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- This test is because if the constructor</span><span>
</span><a name="line-632"></a><span>                                </span><span class="hs-comment">-- isn't in scope the constructor lookup will add</span><span>
</span><a name="line-633"></a><span>                                </span><span class="hs-comment">-- an error but still return an unbound name. We</span><span>
</span><a name="line-634"></a><span>                                </span><span class="hs-comment">-- don't want that to screw up the dot-dot fill-in stuff.</span><span>
</span><a name="line-635"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">flds</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682147678"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-636"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147679"><a href="#local-6989586621682147679"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span> </span><span class="hs-comment">-- Rather approximate</span><span>
</span><a name="line-637"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147680"><a href="#local-6989586621682147680"><span class="hs-identifier">dd_flag</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.RecordWildCards</span><span>
</span><a name="line-638"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#checkErr"><span class="hs-identifier hs-var">checkErr</span></a><span> </span><a href="#local-6989586621682147680"><span class="hs-identifier hs-var">dd_flag</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#needFlagDotDot"><span class="hs-identifier hs-var">needFlagDotDot</span></a><span> </span><a href="#local-6989586621682147655"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-639"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147681"><a href="#local-6989586621682147681"><span class="hs-identifier">rdr_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147682"><a href="#local-6989586621682147682"><span class="hs-identifier">lcl_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getRdrEnvs"><span class="hs-identifier hs-var">getRdrEnvs</span></a><span>
</span><a name="line-640"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147683"><a href="#local-6989586621682147683"><span class="hs-identifier">con_fields</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupConstructorFields"><span class="hs-identifier hs-var">lookupConstructorFields</span></a><span> </span><a href="#local-6989586621682147677"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-641"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621682147683"><span class="hs-identifier hs-var">con_fields</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#badDotDotCon"><span class="hs-identifier hs-var">badDotDotCon</span></a><span> </span><a href="#local-6989586621682147677"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147684"><a href="#local-6989586621682147684"><span class="hs-identifier">present_flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkOccSet</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">rdrNameOcc</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#getFieldLbls"><span class="hs-identifier hs-var">getFieldLbls</span></a><span> </span><a href="#local-6989586621682147678"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span>
</span><a name="line-643"></a><span>
</span><a name="line-644"></a><span>                   </span><span class="hs-comment">-- For constructor uses (but not patterns)</span><span>
</span><a name="line-645"></a><span>                   </span><span class="hs-comment">-- the arg should be in scope locally;</span><span>
</span><a name="line-646"></a><span>                   </span><span class="hs-comment">-- i.e. not top level or imported</span><span>
</span><a name="line-647"></a><span>                   </span><span class="hs-comment">-- Eg.  data R = R { x,y :: Int }</span><span>
</span><a name="line-648"></a><span>                   </span><span class="hs-comment">--      f x = R { .. }   -- Should expand to R {x=x}, not R{x=x,y=y}</span><span>
</span><a name="line-649"></a><span>                 </span><a name="local-6989586621682147685"><a href="#local-6989586621682147685"><span class="hs-identifier">arg_in_scope</span></a></a><span> </span><a name="local-6989586621682147688"><a href="#local-6989586621682147688"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkRdrUnqual</span><span> </span><a href="#local-6989586621682147688"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elemLocalRdrEnv</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682147682"><span class="hs-identifier hs-var">lcl_env</span></a><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621682147686"><a href="#local-6989586621682147686"><span class="hs-identifier">dot_dot_fields</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147687"><a href="#local-6989586621682147687"><span class="hs-identifier">dot_dot_gres</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147689"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682147691"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span>
</span><a name="line-653"></a><span>                                </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621682147689"><a href="#local-6989586621682147689"><span class="hs-identifier">fl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682147683"><span class="hs-identifier hs-var">con_fields</span></a><span>
</span><a name="line-654"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147690"><a href="#local-6989586621682147690"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarOccFS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">flLabel</span><span> </span><a href="#local-6989586621682147689"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">)</span><span>
</span><a name="line-655"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147690"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elemOccSet</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682147684"><span class="hs-identifier hs-var">present_flds</span></a><span class="hs-special">)</span><span>
</span><a name="line-656"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682147691"><a href="#local-6989586621682147691"><span class="hs-identifier">gre</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">lookupGRE_FieldLabel</span><span> </span><a href="#local-6989586621682147681"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621682147689"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">]</span><span>
</span><a name="line-657"></a><span>                                              </span><span class="hs-comment">-- Check selector is in scope</span><span>
</span><a name="line-658"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147655"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-659"></a><span>                                    </span><a href="RnPat.html#HsRecFieldCon"><span class="hs-identifier hs-var">HsRecFieldCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147685"><span class="hs-identifier hs-var">arg_in_scope</span></a><span> </span><a href="#local-6989586621682147690"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-660"></a><span>                                    </span><a name="local-6989586621682147692"><a href="#local-6989586621682147692"><span class="hs-identifier">_other</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-661"></a><span>
</span><a name="line-662"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="RnEnv.html#addUsedGREs"><span class="hs-identifier hs-var">addUsedGREs</span></a><span> </span><a href="#local-6989586621682147687"><span class="hs-identifier hs-var">dot_dot_gres</span></a><span>
</span><a name="line-663"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147679"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecField</span><span>
</span><a name="line-664"></a><span>                        </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147679"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FieldOcc</span><span> </span><a href="#local-6989586621682147694"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147679"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147695"><span class="hs-identifier hs-var">arg_rdr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-665"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147679"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147656"><span class="hs-identifier hs-var">mk_arg</span></a><span> </span><a href="#local-6989586621682147679"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147695"><span class="hs-identifier hs-var">arg_rdr</span></a><span class="hs-special">)</span><span>
</span><a name="line-666"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecPun</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621682147693"><a href="#local-6989586621682147693"><span class="hs-identifier">fl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682147686"><span class="hs-identifier hs-var">dot_dot_fields</span></a><span>
</span><a name="line-668"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147694"><a href="#local-6989586621682147694"><span class="hs-identifier">sel</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">flSelector</span><span> </span><a href="#local-6989586621682147693"><span class="hs-identifier hs-var">fl</span></a><span>
</span><a name="line-669"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147695"><a href="#local-6989586621682147695"><span class="hs-identifier">arg_rdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">flLabel</span><span> </span><a href="#local-6989586621682147693"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span>    </span><span class="hs-identifier">rn_dotdot</span><span> </span><a name="local-6989586621682147696"><a href="#local-6989586621682147696"><span class="hs-identifier">_dotdot</span></a></a><span> </span><a name="local-6989586621682147697"><a href="#local-6989586621682147697"><span class="hs-identifier">_mb_con</span></a></a><span> </span><a name="local-6989586621682147698"><a href="#local-6989586621682147698"><span class="hs-identifier">_flds</span></a></a><span>
</span><a name="line-672"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-673"></a><span>      </span><span class="hs-comment">-- _dotdot = Nothing =&gt; No &quot;..&quot; at all</span><span>
</span><a name="line-674"></a><span>      </span><span class="hs-comment">-- _mb_con = Nothing =&gt; Record update</span><span>
</span><a name="line-675"></a><span>      </span><span class="hs-comment">-- _mb_con = Just unbound =&gt; Out of scope data constructor</span><span>
</span><a name="line-676"></a><span>
</span><a name="line-677"></a><span>    </span><span class="hs-identifier">dup_flds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">NE.NonEmpty</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-678"></a><span>        </span><span class="hs-comment">-- Each list represents a RdrName that occurred more than once</span><span>
</span><a name="line-679"></a><span>        </span><span class="hs-comment">-- (the list contains all occurrences)</span><span>
</span><a name="line-680"></a><span>        </span><span class="hs-comment">-- Each list in dup_fields is non-empty</span><span>
</span><a name="line-681"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682147662"><a href="#local-6989586621682147662"><span class="hs-identifier">dup_flds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">removeDups</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#getFieldLbls"><span class="hs-identifier hs-var">getFieldLbls</span></a><span> </span><a href="#local-6989586621682147657"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span class="hs-comment">-- NB: Consider this:</span><span>
</span><a name="line-685"></a><span class="hs-comment">--      module Foo where { data R = R { fld :: Int } }</span><span>
</span><a name="line-686"></a><span class="hs-comment">--      module Odd where { import Foo; fld x = x { fld = 3 } }</span><span>
</span><a name="line-687"></a><span class="hs-comment">-- Arguably this should work, because the reference to 'fld' is</span><span>
</span><a name="line-688"></a><span class="hs-comment">-- unambiguous because there is only one field id 'fld' in scope.</span><span>
</span><a name="line-689"></a><span class="hs-comment">-- But currently it's rejected.</span><span>
</span><a name="line-690"></a><span>
</span><a name="line-691"></a><span class="hs-identifier">rnHsRecUpdFields</span><span>
</span><a name="line-692"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecUpdField</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>
</span><a name="line-693"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecUpdField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-694"></a><a name="rnHsRecUpdFields"><a href="RnPat.html#rnHsRecUpdFields"><span class="hs-identifier">rnHsRecUpdFields</span></a></a><span> </span><a name="local-6989586621682147705"><a href="#local-6989586621682147705"><span class="hs-identifier">flds</span></a></a><span>
</span><a name="line-695"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147730"><a href="#local-6989586621682147730"><span class="hs-identifier">pun_ok</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.RecordPuns</span><span>
</span><a name="line-696"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147731"><a href="#local-6989586621682147731"><span class="hs-identifier">overload_ok</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DuplicateRecordFields</span><span>
</span><a name="line-697"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147732"><a href="#local-6989586621682147732"><span class="hs-identifier">flds1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147733"><a href="#local-6989586621682147733"><span class="hs-identifier">fvss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAndUnzipM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147707"><span class="hs-identifier hs-var">rn_fld</span></a><span> </span><a href="#local-6989586621682147730"><span class="hs-identifier hs-var">pun_ok</span></a><span> </span><a href="#local-6989586621682147731"><span class="hs-identifier hs-var">overload_ok</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147705"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-698"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="RnPat.html#dupFieldErr"><span class="hs-identifier hs-var">dupFieldErr</span></a><span> </span><a href="RnPat.html#HsRecFieldUpd"><span class="hs-identifier hs-var">HsRecFieldUpd</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147708"><span class="hs-identifier hs-var">dup_flds</span></a><span>
</span><a name="line-699"></a><span>
</span><a name="line-700"></a><span>       </span><span class="hs-comment">-- Check for an empty record update  e {}</span><span>
</span><a name="line-701"></a><span>       </span><span class="hs-comment">-- NB: don't complain about e { .. }, because rn_dotdot has done that already</span><span>
</span><a name="line-702"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621682147705"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="RnPat.html#emptyUpdateErr"><span class="hs-identifier hs-var">emptyUpdateErr</span></a><span>
</span><a name="line-703"></a><span>
</span><a name="line-704"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682147732"><span class="hs-identifier hs-var">flds1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">plusFVs</span><span> </span><a href="#local-6989586621682147733"><span class="hs-identifier hs-var">fvss</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-705"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-706"></a><span>    </span><a name="local-6989586621682147706"><a href="#local-6989586621682147706"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;constructor field name&quot;</span><span>
</span><a name="line-707"></a><span>
</span><a name="line-708"></a><span>    </span><span class="hs-identifier">rn_fld</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsRecUpdField</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-709"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsRecUpdField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span>    </span><a name="local-6989586621682147707"><a href="#local-6989586621682147707"><span class="hs-identifier">rn_fld</span></a></a><span> </span><a name="local-6989586621682147709"><a href="#local-6989586621682147709"><span class="hs-identifier">pun_ok</span></a></a><span> </span><a name="local-6989586621682147710"><a href="#local-6989586621682147710"><span class="hs-identifier">overload_ok</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147711"><a href="#local-6989586621682147711"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecField</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682147712"><a href="#local-6989586621682147712"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682147713"><a href="#local-6989586621682147713"><span class="hs-identifier">f</span></a></a><span>
</span><a name="line-711"></a><span>                                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147714"><a href="#local-6989586621682147714"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-712"></a><span>                                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecPun</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147715"><a href="#local-6989586621682147715"><span class="hs-identifier">pun</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147716"><a href="#local-6989586621682147716"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span><span> </span><a href="#local-6989586621682147713"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-714"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147719"><a href="#local-6989586621682147719"><span class="hs-identifier">sel</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-715"></a><span>                      </span><span class="hs-comment">-- Defer renaming of overloaded fields to the typechecker</span><span>
</span><a name="line-716"></a><span>                      </span><span class="hs-comment">-- See Note [Disambiguating record fields] in TcExpr</span><span>
</span><a name="line-717"></a><span>                      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621682147710"><span class="hs-identifier hs-var">overload_ok</span></a><span>
</span><a name="line-718"></a><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147717"><a href="#local-6989586621682147717"><span class="hs-identifier">mb</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupGlobalOccRn_overloaded"><span class="hs-identifier hs-var">lookupGlobalOccRn_overloaded</span></a><span>
</span><a name="line-719"></a><span>                                            </span><a href="#local-6989586621682147710"><span class="hs-identifier hs-var">overload_ok</span></a><span> </span><a href="#local-6989586621682147716"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-720"></a><span>                                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147717"><span class="hs-identifier hs-var">mb</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-721"></a><span>                                      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-722"></a><span>                                        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span>
</span><a name="line-723"></a><span>                                               </span><span class="hs-special">(</span><a href="RnUtils.html#unknownSubordinateErr"><span class="hs-identifier hs-var">unknownSubordinateErr</span></a><span> </span><a href="#local-6989586621682147706"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621682147716"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>                                           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-725"></a><span>                                      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682147718"><a href="#local-6989586621682147718"><span class="hs-identifier">r</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682147718"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-726"></a><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnEnv.html#lookupGlobalOccRn"><span class="hs-identifier hs-var">lookupGlobalOccRn</span></a><span> </span><a href="#local-6989586621682147716"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-727"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682147721"><a href="#local-6989586621682147721"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621682147715"><span class="hs-identifier hs-var">pun</span></a><span>
</span><a name="line-728"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#checkErr"><span class="hs-identifier hs-var">checkErr</span></a><span> </span><a href="#local-6989586621682147709"><span class="hs-identifier hs-var">pun_ok</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#badPun"><span class="hs-identifier hs-var">badPun</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147716"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-729"></a><span>                               </span><span class="hs-comment">-- Discard any module qualifier (#11662)</span><span>
</span><a name="line-730"></a><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147720"><a href="#local-6989586621682147720"><span class="hs-identifier">arg_rdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkRdrUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rdrNameOcc</span><span> </span><a href="#local-6989586621682147716"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-731"></a><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsVar</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147720"><span class="hs-identifier hs-var">arg_rdr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-732"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682147714"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-733"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682147722"><a href="#local-6989586621682147722"><span class="hs-identifier">arg''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682147723"><a href="#local-6989586621682147723"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621682147721"><span class="hs-identifier hs-var">arg'</span></a><span>
</span><a name="line-734"></a><span>
</span><a name="line-735"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147724"><a href="#local-6989586621682147724"><span class="hs-identifier">fvs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147719"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-736"></a><span>                          </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621682147726"><a href="#local-6989586621682147726"><span class="hs-identifier">sel_name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147723"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">addOneFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682147726"><span class="hs-identifier hs-var">sel_name</span></a><span>
</span><a name="line-737"></a><span>                          </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><a name="local-6989586621682147727"><a href="#local-6989586621682147727"><span class="hs-identifier">sel_name</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147723"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">addOneFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682147727"><span class="hs-identifier hs-var">sel_name</span></a><span>
</span><a name="line-738"></a><span>                          </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682147723"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-739"></a><span>                 </span><a name="local-6989586621682147725"><a href="#local-6989586621682147725"><span class="hs-identifier">lbl'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147719"><span class="hs-identifier hs-var">sel</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-740"></a><span>                          </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621682147728"><a href="#local-6989586621682147728"><span class="hs-identifier">sel_name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-741"></a><span>                                     </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Unambiguous</span><span> </span><a href="#local-6989586621682147728"><span class="hs-identifier hs-var">sel_name</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147716"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-742"></a><span>                          </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><a name="local-6989586621682147729"><a href="#local-6989586621682147729"><span class="hs-identifier">sel_name</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-743"></a><span>                                     </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Unambiguous</span><span> </span><a href="#local-6989586621682147729"><span class="hs-identifier hs-var">sel_name</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147716"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-744"></a><span>                          </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Ambiguous</span><span>   </span><span class="hs-identifier hs-var">noExt</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147712"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682147716"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-745"></a><span>
</span><a name="line-746"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621682147711"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecField</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147725"><span class="hs-identifier hs-var">lbl'</span></a><span>
</span><a name="line-747"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147722"><span class="hs-identifier hs-var">arg''</span></a><span>
</span><a name="line-748"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecPun</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147715"><span class="hs-identifier hs-var">pun</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682147724"><span class="hs-identifier hs-var">fvs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span>    </span><span class="hs-identifier">dup_flds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">NE.NonEmpty</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-751"></a><span>        </span><span class="hs-comment">-- Each list represents a RdrName that occurred more than once</span><span>
</span><a name="line-752"></a><span>        </span><span class="hs-comment">-- (the list contains all occurrences)</span><span>
</span><a name="line-753"></a><span>        </span><span class="hs-comment">-- Each list in dup_fields is non-empty</span><span>
</span><a name="line-754"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682147708"><a href="#local-6989586621682147708"><span class="hs-identifier">dup_flds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">removeDups</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#getFieldUpdLbls"><span class="hs-identifier hs-var">getFieldUpdLbls</span></a><span> </span><a href="#local-6989586621682147705"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><span class="hs-identifier">getFieldIds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecField</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><a href="#local-6989586621682147448"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-759"></a><a name="getFieldIds"><a href="RnPat.html#getFieldIds"><span class="hs-identifier">getFieldIds</span></a></a><span> </span><a name="local-6989586621682147734"><a href="#local-6989586621682147734"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">hsRecFieldSel</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147734"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-760"></a><span>
</span><a name="line-761"></a><span class="hs-identifier">getFieldLbls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecField</span><span> </span><a href="#local-6989586621682147446"><span class="hs-identifier hs-type">id</span></a><span> </span><a href="#local-6989586621682147447"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-762"></a><a name="getFieldLbls"><a href="RnPat.html#getFieldLbls"><span class="hs-identifier">getFieldLbls</span></a></a><span> </span><a name="local-6989586621682147735"><a href="#local-6989586621682147735"><span class="hs-identifier">flds</span></a></a><span>
</span><a name="line-763"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">rdrNameFieldOcc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147735"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span class="hs-identifier">getFieldUpdLbls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecUpdField</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-766"></a><a name="getFieldUpdLbls"><a href="RnPat.html#getFieldUpdLbls"><span class="hs-identifier">getFieldUpdLbls</span></a></a><span> </span><a name="local-6989586621682147736"><a href="#local-6989586621682147736"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682147736"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span class="hs-identifier">needFlagDotDot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#HsRecFieldContext"><span class="hs-identifier hs-type">HsRecFieldContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-769"></a><a name="needFlagDotDot"><a href="RnPat.html#needFlagDotDot"><span class="hs-identifier">needFlagDotDot</span></a></a><span> </span><a name="local-6989586621682147737"><a href="#local-6989586621682147737"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal `..' in record&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="RnPat.html#pprRFC"><span class="hs-identifier hs-var">pprRFC</span></a><span> </span><a href="#local-6989586621682147737"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">,</span><span>
</span><a name="line-770"></a><span>                            </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Use RecordWildCards to permit this&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><span class="hs-identifier">badDotDotCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-773"></a><a name="badDotDotCon"><a href="RnPat.html#badDotDotCon"><span class="hs-identifier">badDotDotCon</span></a></a><span> </span><a name="local-6989586621682147738"><a href="#local-6989586621682147738"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-774"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal `..' notation for constructor&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682147738"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-775"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;The constructor has no labelled fields&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-776"></a><span>
</span><a name="line-777"></a><span class="hs-identifier">emptyUpdateErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-778"></a><a name="emptyUpdateErr"><a href="RnPat.html#emptyUpdateErr"><span class="hs-identifier">emptyUpdateErr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Empty record update&quot;</span><span>
</span><a name="line-779"></a><span>
</span><a name="line-780"></a><span class="hs-identifier">badPun</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-781"></a><a name="badPun"><a href="RnPat.html#badPun"><span class="hs-identifier">badPun</span></a></a><span> </span><a name="local-6989586621682147739"><a href="#local-6989586621682147739"><span class="hs-identifier">fld</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal use of punning for field&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682147739"><span class="hs-identifier hs-var">fld</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-782"></a><span>                   </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Use NamedFieldPuns to permit this&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-783"></a><span>
</span><a name="line-784"></a><span class="hs-identifier">dupFieldErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#HsRecFieldContext"><span class="hs-identifier hs-type">HsRecFieldContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">NE.NonEmpty</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-785"></a><a name="dupFieldErr"><a href="RnPat.html#dupFieldErr"><span class="hs-identifier">dupFieldErr</span></a></a><span> </span><a name="local-6989586621682147740"><a href="#local-6989586621682147740"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682147741"><a href="#local-6989586621682147741"><span class="hs-identifier">dups</span></a></a><span>
</span><a name="line-786"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;duplicate field name&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-787"></a><span>          </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NE.head</span><span> </span><a href="#local-6989586621682147741"><span class="hs-identifier hs-var">dups</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-788"></a><span>          </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in record&quot;</span><span class="hs-special">,</span><span> </span><a href="RnPat.html#pprRFC"><span class="hs-identifier hs-var">pprRFC</span></a><span> </span><a href="#local-6989586621682147740"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">]</span><span>
</span><a name="line-789"></a><span>
</span><a name="line-790"></a><span class="hs-identifier">pprRFC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#HsRecFieldContext"><span class="hs-identifier hs-type">HsRecFieldContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-791"></a><a name="pprRFC"><a href="RnPat.html#pprRFC"><span class="hs-identifier">pprRFC</span></a></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#HsRecFieldCon"><span class="hs-identifier hs-var">HsRecFieldCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;construction&quot;</span><span>
</span><a name="line-792"></a><span class="hs-identifier">pprRFC</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#HsRecFieldPat"><span class="hs-identifier hs-var">HsRecFieldPat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;pattern&quot;</span><span>
</span><a name="line-793"></a><span class="hs-identifier">pprRFC</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#HsRecFieldUpd"><span class="hs-identifier hs-var">HsRecFieldUpd</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;update&quot;</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{Literals}
*                                                                      *
************************************************************************

When literals occur we have to make sure
that the types and classes they involve
are made available.
-}</span><span>
</span><a name="line-806"></a><span>
</span><a name="line-807"></a><span class="hs-identifier">rnLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><a href="#local-6989586621682147445"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-808"></a><a name="rnLit"><a href="RnPat.html#rnLit"><span class="hs-identifier">rnLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsChar</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682147742"><a href="#local-6989586621682147742"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#checkErr"><span class="hs-identifier hs-var">checkErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">inCharRange</span><span> </span><a href="#local-6989586621682147742"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnPat.html#bogusCharError"><span class="hs-identifier hs-var">bogusCharError</span></a><span> </span><a href="#local-6989586621682147742"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-809"></a><span class="hs-identifier">rnLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>
</span><a name="line-811"></a><span class="hs-comment">-- Turn a Fractional-looking literal which happens to be an integer into an</span><span>
</span><a name="line-812"></a><span class="hs-comment">-- Integer-looking literal.</span><span>
</span><a name="line-813"></a><span class="hs-identifier">generalizeOverLitVal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OverLitVal</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OverLitVal</span><span>
</span><a name="line-814"></a><a name="generalizeOverLitVal"><a href="RnPat.html#generalizeOverLitVal"><span class="hs-identifier">generalizeOverLitVal</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFractional</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FL</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">fl_text</span><span class="hs-glyph">=</span><a name="local-6989586621682147743"><a href="#local-6989586621682147743"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span class="hs-identifier">fl_neg</span><span class="hs-glyph">=</span><a name="local-6989586621682147744"><a href="#local-6989586621682147744"><span class="hs-identifier">neg</span></a></a><span class="hs-special">,</span><span class="hs-identifier">fl_value</span><span class="hs-glyph">=</span><a name="local-6989586621682147745"><a href="#local-6989586621682147745"><span class="hs-identifier">val</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-815"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">denominator</span><span> </span><a href="#local-6989586621682147745"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IL</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">il_text</span><span class="hs-glyph">=</span><a href="#local-6989586621682147743"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-816"></a><span>                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">il_neg</span><span class="hs-glyph">=</span><a href="#local-6989586621682147744"><span class="hs-identifier hs-var">neg</span></a><span>
</span><a name="line-817"></a><span>                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">il_value</span><span class="hs-glyph">=</span><span class="hs-identifier hs-var">numerator</span><span> </span><a href="#local-6989586621682147745"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-818"></a><span class="hs-identifier">generalizeOverLitVal</span><span> </span><a name="local-6989586621682147746"><a href="#local-6989586621682147746"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147746"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-819"></a><span>
</span><a name="line-820"></a><span class="hs-identifier">isNegativeZeroOverLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><a href="#local-6989586621682147444"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-821"></a><a name="isNegativeZeroOverLit"><a href="RnPat.html#isNegativeZeroOverLit"><span class="hs-identifier">isNegativeZeroOverLit</span></a></a><span> </span><a name="local-6989586621682147747"><a href="#local-6989586621682147747"><span class="hs-identifier">lit</span></a></a><span>
</span><a name="line-822"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">ol_val</span><span> </span><a href="#local-6989586621682147747"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-823"></a><span>        </span><span class="hs-identifier hs-var">HsIntegral</span><span> </span><a name="local-6989586621682147748"><a href="#local-6989586621682147748"><span class="hs-identifier">i</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">il_value</span><span> </span><a href="#local-6989586621682147748"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">il_neg</span><span> </span><a href="#local-6989586621682147748"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-824"></a><span>        </span><span class="hs-identifier hs-var">HsFractional</span><span> </span><a name="local-6989586621682147749"><a href="#local-6989586621682147749"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">fl_value</span><span> </span><a href="#local-6989586621682147749"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">fl_neg</span><span> </span><a href="#local-6989586621682147749"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-825"></a><span>        </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-comment">{-
Note [Negative zero]
~~~~~~~~~~~~~~~~~~~~~~~~~
There were problems with negative zero in conjunction with Negative Literals
extension. Numeric literal value is contained in Integer and Rational types
inside IntegralLit and FractionalLit. These types cannot represent negative
zero value. So we had to add explicit field 'neg' which would hold information
about literal sign. Here in rnOverLit we use it to detect negative zeroes and
in this case return not only literal itself but also negateName so that users
can apply it explicitly. In this case it stays negative zero.  Trac #13211
-}</span><span>
</span><a name="line-838"></a><span>
</span><a name="line-839"></a><span class="hs-identifier">rnOverLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><a href="#local-6989586621682147443"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-840"></a><span>             </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-841"></a><a name="rnOverLit"><a href="RnPat.html#rnOverLit"><span class="hs-identifier">rnOverLit</span></a></a><span> </span><a name="local-6989586621682147750"><a href="#local-6989586621682147750"><span class="hs-identifier">origLit</span></a></a><span>
</span><a name="line-842"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147751"><a href="#local-6989586621682147751"><span class="hs-identifier">opt_NumDecimals</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.NumDecimals</span><span>
</span><a name="line-843"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682147752"><a href="#local-6989586621682147752"><span class="hs-identifier">lit</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">OverLit</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ol_val</span><span class="hs-glyph">=</span><a name="local-6989586621682147753"><a href="#local-6989586621682147753"><span class="hs-identifier">val</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-844"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682147751"><span class="hs-identifier hs-var">opt_NumDecimals</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147750"><span class="hs-identifier hs-var">origLit</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">ol_val</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnPat.html#generalizeOverLitVal"><span class="hs-identifier hs-var">generalizeOverLitVal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ol_val</span><span> </span><a href="#local-6989586621682147750"><span class="hs-identifier hs-var">origLit</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-845"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147750"><span class="hs-identifier hs-var">origLit</span></a><span>
</span><a name="line-846"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-847"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147754"><a href="#local-6989586621682147754"><span class="hs-identifier">std_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#hsOverLitName"><span class="hs-identifier hs-var">hsOverLitName</span></a><span> </span><a href="#local-6989586621682147753"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-848"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SyntaxExpr</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">syn_expr</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147755"><a href="#local-6989586621682147755"><span class="hs-identifier">from_thing_name</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682147756"><a href="#local-6989586621682147756"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-849"></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a><span> </span><a href="#local-6989586621682147754"><span class="hs-identifier hs-var">std_name</span></a><span>
</span><a name="line-850"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147757"><a href="#local-6989586621682147757"><span class="hs-identifier">rebindable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682147755"><span class="hs-identifier hs-var">from_thing_name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-851"></a><span>                                </span><span class="hs-identifier hs-var">HsVar</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682147758"><a href="#local-6989586621682147758"><span class="hs-identifier">lv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682147758"><span class="hs-identifier hs-var">lv</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621682147754"><span class="hs-identifier hs-var">std_name</span></a><span>
</span><a name="line-852"></a><span>                                </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnOverLit&quot;</span><span>
</span><a name="line-853"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682147759"><a href="#local-6989586621682147759"><span class="hs-identifier">lit'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147752"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_witness</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147755"><span class="hs-identifier hs-var">from_thing_name</span></a><span>
</span><a name="line-854"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682147757"><span class="hs-identifier hs-var">rebindable</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-855"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="RnPat.html#isNegativeZeroOverLit"><span class="hs-identifier hs-var">isNegativeZeroOverLit</span></a><span> </span><a href="#local-6989586621682147759"><span class="hs-identifier hs-var">lit'</span></a><span>
</span><a name="line-856"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SyntaxExpr</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">syn_expr</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682147760"><a href="#local-6989586621682147760"><span class="hs-identifier">negate_name</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682147761"><a href="#local-6989586621682147761"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-857"></a><span>                      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupSyntaxName"><span class="hs-identifier hs-var">lookupSyntaxName</span></a><span> </span><span class="hs-identifier hs-var">negateName</span><span>
</span><a name="line-858"></a><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621682147759"><span class="hs-identifier hs-var">lit'</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_val</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">negateOverLitVal</span><span> </span><a href="#local-6989586621682147753"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682147760"><span class="hs-identifier hs-var">negate_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-859"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682147756"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682147761"><span class="hs-identifier hs-var">fvs2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-860"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621682147759"><span class="hs-identifier hs-var">lit'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682147756"><span class="hs-identifier hs-var">fvs1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-861"></a><span>
</span><a name="line-862"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{Errors}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-identifier">patSigErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="#local-6989586621682147442"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621682147442"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-871"></a><a name="patSigErr"><a href="RnPat.html#patSigErr"><span class="hs-identifier">patSigErr</span></a></a><span> </span><a name="local-6989586621682147762"><a href="#local-6989586621682147762"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-872"></a><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal signature in pattern:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682147762"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-873"></a><span>        </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Use ScopedTypeVariables to permit it&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-874"></a><span>
</span><a name="line-875"></a><span class="hs-identifier">bogusCharError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-876"></a><a name="bogusCharError"><a href="RnPat.html#bogusCharError"><span class="hs-identifier">bogusCharError</span></a></a><span> </span><a name="local-6989586621682147763"><a href="#local-6989586621682147763"><span class="hs-identifier">c</span></a></a><span>
</span><a name="line-877"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;character literal out of range: '\\&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><a href="#local-6989586621682147763"><span class="hs-identifier hs-var">c</span></a><span>  </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\''</span><span>
</span><a name="line-878"></a><span>
</span><a name="line-879"></a><span class="hs-identifier">badViewPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-880"></a><a name="badViewPat"><a href="RnPat.html#badViewPat"><span class="hs-identifier">badViewPat</span></a></a><span> </span><a name="local-6989586621682147764"><a href="#local-6989586621682147764"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal view pattern: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682147764"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">,</span><span>
</span><a name="line-881"></a><span>                       </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Use ViewPatterns to enable view patterns&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-882"></a></pre></body></html>