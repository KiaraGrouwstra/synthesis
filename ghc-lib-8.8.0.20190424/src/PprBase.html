<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">--</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Pretty-printing assembly language</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- (c) The University of Glasgow 1993-2005</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PprBase</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>        </span><a href="PprBase.html#castFloatToWord8Array"><span class="hs-identifier hs-var">castFloatToWord8Array</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="PprBase.html#castDoubleToWord8Array"><span class="hs-identifier hs-var">castDoubleToWord8Array</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="PprBase.html#floatToBytes"><span class="hs-identifier hs-var">floatToBytes</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="PprBase.html#doubleToBytes"><span class="hs-identifier hs-var">doubleToBytes</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="PprBase.html#pprASCII"><span class="hs-identifier hs-var">pprASCII</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="PprBase.html#pprSectionHeader"><span class="hs-identifier hs-var">pprSectionHeader</span></a><span>
</span><a name="line-16"></a><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">where</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="AsmUtils.html"><span class="hs-identifier">AsmUtils</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="CLabel.html"><span class="hs-identifier">CLabel</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Cmm.html"><span class="hs-identifier">Cmm</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Array.Unsafe</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">U</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">castSTUArray</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Array.ST</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.ST</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-41"></a><span class="hs-comment">-- Converting floating-point literals to integrals for printing</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-identifier">castFloatToWord8Array</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">STUArray</span><span> </span><a href="#local-6989586621680056624"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621680056624"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">STUArray</span><span> </span><a href="#local-6989586621680056624"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><a name="castFloatToWord8Array"><a href="PprBase.html#castFloatToWord8Array"><span class="hs-identifier">castFloatToWord8Array</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">U.castSTUArray</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-identifier">castDoubleToWord8Array</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">STUArray</span><span> </span><a href="#local-6989586621680056623"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621680056623"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">STUArray</span><span> </span><a href="#local-6989586621680056623"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><a name="castDoubleToWord8Array"><a href="PprBase.html#castDoubleToWord8Array"><span class="hs-identifier">castDoubleToWord8Array</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">U.castSTUArray</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- floatToBytes and doubleToBytes convert to the host's byte</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- order.  Providing that we're not cross-compiling for a</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- target with the opposite endianness, this should work ok</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- on all targets.</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">-- ToDo: this stuff is very similar to the shenanigans in PprAbs,</span><span>
</span><a name="line-55"></a><span class="hs-comment">-- could they be merged?</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-identifier">floatToBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>
</span><a name="line-58"></a><a name="floatToBytes"><a href="PprBase.html#floatToBytes"><span class="hs-identifier">floatToBytes</span></a></a><span> </span><a name="local-6989586621680056625"><a href="#local-6989586621680056625"><span class="hs-identifier">f</span></a></a><span>
</span><a name="line-59"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">runST</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-60"></a><span>        </span><a name="local-6989586621680056626"><a href="#local-6989586621680056626"><span class="hs-identifier">arr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newArray_</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>        </span><span class="hs-identifier hs-var">writeArray</span><span> </span><a href="#local-6989586621680056626"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621680056625"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-62"></a><span>        </span><a name="local-6989586621680056627"><a href="#local-6989586621680056627"><span class="hs-identifier">arr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PprBase.html#castFloatToWord8Array"><span class="hs-identifier hs-var">castFloatToWord8Array</span></a><span> </span><a href="#local-6989586621680056626"><span class="hs-identifier hs-var">arr</span></a><span>
</span><a name="line-63"></a><span>        </span><a name="local-6989586621680056628"><a href="#local-6989586621680056628"><span class="hs-identifier">i0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056627"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-64"></a><span>        </span><a name="local-6989586621680056629"><a href="#local-6989586621680056629"><span class="hs-identifier">i1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056627"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-65"></a><span>        </span><a name="local-6989586621680056630"><a href="#local-6989586621680056630"><span class="hs-identifier">i2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056627"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-66"></a><span>        </span><a name="local-6989586621680056631"><a href="#local-6989586621680056631"><span class="hs-identifier">i3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056627"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-67"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680056628"><span class="hs-identifier hs-var">i0</span></a><span class="hs-special">,</span><a href="#local-6989586621680056629"><span class="hs-identifier hs-var">i1</span></a><span class="hs-special">,</span><a href="#local-6989586621680056630"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">,</span><a href="#local-6989586621680056631"><span class="hs-identifier hs-var">i3</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-identifier">doubleToBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>
</span><a name="line-71"></a><a name="doubleToBytes"><a href="PprBase.html#doubleToBytes"><span class="hs-identifier">doubleToBytes</span></a></a><span> </span><a name="local-6989586621680056632"><a href="#local-6989586621680056632"><span class="hs-identifier">d</span></a></a><span>
</span><a name="line-72"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">runST</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-73"></a><span>        </span><a name="local-6989586621680056633"><a href="#local-6989586621680056633"><span class="hs-identifier">arr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newArray_</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-number">7</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>        </span><span class="hs-identifier hs-var">writeArray</span><span> </span><a href="#local-6989586621680056633"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621680056632"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-75"></a><span>        </span><a name="local-6989586621680056634"><a href="#local-6989586621680056634"><span class="hs-identifier">arr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PprBase.html#castDoubleToWord8Array"><span class="hs-identifier hs-var">castDoubleToWord8Array</span></a><span> </span><a href="#local-6989586621680056633"><span class="hs-identifier hs-var">arr</span></a><span>
</span><a name="line-76"></a><span>        </span><a name="local-6989586621680056635"><a href="#local-6989586621680056635"><span class="hs-identifier">i0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056634"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-77"></a><span>        </span><a name="local-6989586621680056636"><a href="#local-6989586621680056636"><span class="hs-identifier">i1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056634"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-78"></a><span>        </span><a name="local-6989586621680056637"><a href="#local-6989586621680056637"><span class="hs-identifier">i2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056634"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-79"></a><span>        </span><a name="local-6989586621680056638"><a href="#local-6989586621680056638"><span class="hs-identifier">i3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056634"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-80"></a><span>        </span><a name="local-6989586621680056639"><a href="#local-6989586621680056639"><span class="hs-identifier">i4</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056634"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-81"></a><span>        </span><a name="local-6989586621680056640"><a href="#local-6989586621680056640"><span class="hs-identifier">i5</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056634"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-82"></a><span>        </span><a name="local-6989586621680056641"><a href="#local-6989586621680056641"><span class="hs-identifier">i6</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056634"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-83"></a><span>        </span><a name="local-6989586621680056642"><a href="#local-6989586621680056642"><span class="hs-identifier">i7</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readArray</span><span> </span><a href="#local-6989586621680056634"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-number">7</span><span>
</span><a name="line-84"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680056635"><span class="hs-identifier hs-var">i0</span></a><span class="hs-special">,</span><a href="#local-6989586621680056636"><span class="hs-identifier hs-var">i1</span></a><span class="hs-special">,</span><a href="#local-6989586621680056637"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">,</span><a href="#local-6989586621680056638"><span class="hs-identifier hs-var">i3</span></a><span class="hs-special">,</span><a href="#local-6989586621680056639"><span class="hs-identifier hs-var">i4</span></a><span class="hs-special">,</span><a href="#local-6989586621680056640"><span class="hs-identifier hs-var">i5</span></a><span class="hs-special">,</span><a href="#local-6989586621680056641"><span class="hs-identifier hs-var">i6</span></a><span class="hs-special">,</span><a href="#local-6989586621680056642"><span class="hs-identifier hs-var">i7</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- Printing ASCII strings.</span><span>
</span><a name="line-89"></a><span class="hs-comment">--</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- Print as a string and escape non-printable characters.</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- This is similar to charToC in Utils.</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-identifier">pprASCII</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-94"></a><a name="pprASCII"><a href="PprBase.html#pprASCII"><span class="hs-identifier">pprASCII</span></a></a><span> </span><a name="local-6989586621680056643"><a href="#local-6989586621680056643"><span class="hs-identifier">str</span></a></a><span>
</span><a name="line-95"></a><span>  </span><span class="hs-comment">-- Transform this given literal bytestring to escaped string and construct</span><span>
</span><a name="line-96"></a><span>  </span><span class="hs-comment">-- the literal SDoc directly.</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-comment">-- See Trac #14741</span><span>
</span><a name="line-98"></a><span>  </span><span class="hs-comment">-- and Note [Pretty print ASCII when AsmCodeGen]</span><span>
</span><a name="line-99"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680056648"><a href="#local-6989586621680056648"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621680056649"><a href="#local-6989586621680056649"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680056644"><span class="hs-identifier hs-var">do1</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680056648"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680056649"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621680056643"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-100"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-101"></a><span>       </span><span class="hs-identifier">do1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-102"></a><span>       </span><a name="local-6989586621680056644"><a href="#local-6989586621680056644"><span class="hs-identifier">do1</span></a></a><span> </span><a name="local-6989586621680056646"><a href="#local-6989586621680056646"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-char">'\t'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><a href="#local-6989586621680056646"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\\t&quot;</span><span>
</span><a name="line-103"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-char">'\n'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><a href="#local-6989586621680056646"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\\n&quot;</span><span>
</span><a name="line-104"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-char">'&quot;'</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><a href="#local-6989586621680056646"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\\\&quot;&quot;</span><span>
</span><a name="line-105"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-char">'\\'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><a href="#local-6989586621680056646"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\\\\&quot;</span><span>
</span><a name="line-106"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isPrint</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">chr</span><span> </span><a href="#local-6989586621680056646"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">chr</span><span> </span><a href="#local-6989586621680056646"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">]</span><span>
</span><a name="line-107"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'\\'</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680056645"><span class="hs-identifier hs-var">octal</span></a><span> </span><a href="#local-6989586621680056646"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span>       </span><span class="hs-identifier">octal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-110"></a><span>       </span><a name="local-6989586621680056645"><a href="#local-6989586621680056645"><span class="hs-identifier">octal</span></a></a><span> </span><a name="local-6989586621680056647"><a href="#local-6989586621680056647"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-char">'0'</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680056647"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">64</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-char">'0'</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680056647"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-char">'0'</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680056647"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>                 </span><span class="hs-special">]</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">{-
Note [Pretty print ASCII when AsmCodeGen]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Previously, when generating assembly code, we created SDoc with
`(ptext . sLit)` for every bytes in literal bytestring, then
combine them using `hcat`.

When handling literal bytestrings with millions of bytes,
millions of SDoc would be created and to combine, leading to
high memory usage.

Now we escape the given bytestring to string directly and construct
SDoc only once. This improvement could dramatically decrease the
memory allocation from 4.7GB to 1.3GB when embedding a 3MB literal
string in source code. See Trac #14741 for profiling results.
-}</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- Printing section headers.</span><span>
</span><a name="line-134"></a><span class="hs-comment">--</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- If -split-section was specified, include the suffix label, otherwise just</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- print the section type. For Darwin, where subsections-for-symbols are</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- used instead, only print section type.</span><span>
</span><a name="line-138"></a><span class="hs-comment">--</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- For string literals, additional flags are specified to enable merging of</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- identical strings in the linker. With -split-sections each string also gets</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- a unique section to allow strings from unused code to be GC'd.</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-identifier">pprSectionHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#Section"><span class="hs-identifier hs-type">Section</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-144"></a><a name="pprSectionHeader"><a href="PprBase.html#pprSectionHeader"><span class="hs-identifier">pprSectionHeader</span></a></a><span> </span><a name="local-6989586621680056650"><a href="#local-6989586621680056650"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a name="local-6989586621680056651"><a href="#local-6989586621680056651"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621680056652"><a href="#local-6989586621680056652"><span class="hs-identifier">suffix</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-145"></a><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621680056650"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-146"></a><span>   </span><span class="hs-identifier hs-var">OSAIX</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PprBase.html#pprXcoffSectionHeader"><span class="hs-identifier hs-var">pprXcoffSectionHeader</span></a><span> </span><a href="#local-6989586621680056651"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-147"></a><span>   </span><span class="hs-identifier hs-var">OSDarwin</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PprBase.html#pprDarwinSectionHeader"><span class="hs-identifier hs-var">pprDarwinSectionHeader</span></a><span> </span><a href="#local-6989586621680056651"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-148"></a><span>   </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PprBase.html#pprGNUSectionHeader"><span class="hs-identifier hs-var">pprGNUSectionHeader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'$'</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680056651"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680056652"><span class="hs-identifier hs-var">suffix</span></a><span>
</span><a name="line-149"></a><span>   </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PprBase.html#pprGNUSectionHeader"><span class="hs-identifier hs-var">pprGNUSectionHeader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'.'</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680056651"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680056652"><span class="hs-identifier hs-var">suffix</span></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-identifier">pprGNUSectionHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#SectionType"><span class="hs-identifier hs-type">SectionType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-152"></a><a name="pprGNUSectionHeader"><a href="PprBase.html#pprGNUSectionHeader"><span class="hs-identifier">pprGNUSectionHeader</span></a></a><span> </span><a name="local-6989586621680056653"><a href="#local-6989586621680056653"><span class="hs-identifier">sep</span></a></a><span> </span><a name="local-6989586621680056654"><a href="#local-6989586621680056654"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621680056655"><a href="#local-6989586621680056655"><span class="hs-identifier">suffix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sdocWithDynFlags</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680056660"><a href="#local-6989586621680056660"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-153"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680056661"><a href="#local-6989586621680056661"><span class="hs-identifier">splitSections</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_SplitSections</span><span> </span><a href="#local-6989586621680056660"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-154"></a><span>      </span><a name="local-6989586621680056662"><a href="#local-6989586621680056662"><span class="hs-identifier">subsection</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680056661"><span class="hs-identifier hs-var">splitSections</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680056653"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680056655"><span class="hs-identifier hs-var">suffix</span></a><span>
</span><a name="line-155"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;.section &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680056656"><span class="hs-identifier hs-var">header</span></a><span> </span><a href="#local-6989586621680056660"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621680056662"><span class="hs-identifier hs-var">subsection</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span>
</span><a name="line-157"></a><span>      </span><a href="#local-6989586621680056657"><span class="hs-identifier hs-var">flags</span></a><span> </span><a href="#local-6989586621680056660"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-158"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-159"></a><span>    </span><a name="local-6989586621680056656"><a href="#local-6989586621680056656"><span class="hs-identifier">header</span></a></a><span> </span><a name="local-6989586621680056658"><a href="#local-6989586621680056658"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680056654"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-160"></a><span>      </span><a href="Cmm.html#Text"><span class="hs-identifier hs-var">Text</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.text&quot;</span><span>
</span><a name="line-161"></a><span>      </span><a href="Cmm.html#Data"><span class="hs-identifier hs-var">Data</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.data&quot;</span><span>
</span><a name="line-162"></a><span>      </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680056658"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.rdata&quot;</span><span>
</span><a name="line-164"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.rodata&quot;</span><span>
</span><a name="line-165"></a><span>      </span><a href="Cmm.html#RelocatableReadOnlyData"><span class="hs-identifier hs-var">RelocatableReadOnlyData</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680056658"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>                                </span><span class="hs-comment">-- Concept does not exist on Windows,</span><span>
</span><a name="line-167"></a><span>                                </span><span class="hs-comment">-- So map these to R/O data.</span><span>
</span><a name="line-168"></a><span>                                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.rdata$rel.ro&quot;</span><span>
</span><a name="line-169"></a><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.data.rel.ro&quot;</span><span>
</span><a name="line-170"></a><span>      </span><a href="Cmm.html#UninitialisedData"><span class="hs-identifier hs-var">UninitialisedData</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.bss&quot;</span><span>
</span><a name="line-171"></a><span>      </span><a href="Cmm.html#ReadOnlyData16"><span class="hs-identifier hs-var">ReadOnlyData16</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680056658"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.rdata$cst16&quot;</span><span>
</span><a name="line-173"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.rodata.cst16&quot;</span><span>
</span><a name="line-174"></a><span>      </span><a href="Cmm.html#CString"><span class="hs-identifier hs-var">CString</span></a><span>
</span><a name="line-175"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680056658"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.rdata&quot;</span><span>
</span><a name="line-177"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.rodata.str&quot;</span><span>
</span><a name="line-178"></a><span>      </span><a href="Cmm.html#OtherSection"><span class="hs-identifier hs-var">OtherSection</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-179"></a><span>        </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PprBase.pprGNUSectionHeader: unknown section type&quot;</span><span>
</span><a name="line-180"></a><span>    </span><a name="local-6989586621680056657"><a href="#local-6989586621680056657"><span class="hs-identifier">flags</span></a></a><span> </span><a name="local-6989586621680056659"><a href="#local-6989586621680056659"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680056654"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-181"></a><span>      </span><a href="Cmm.html#CString"><span class="hs-identifier hs-var">CString</span></a><span>
</span><a name="line-182"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680056659"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-184"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;,\&quot;aMS\&quot;,&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="AsmUtils.html#sectionType"><span class="hs-identifier hs-var">sectionType</span></a><span> </span><span class="hs-string">&quot;progbits&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;,1&quot;</span><span>
</span><a name="line-185"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- XCOFF doesn't support relocating label-differences, so we place all</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- RO sections into .text[PR] sections</span><span>
</span><a name="line-189"></a><span class="hs-identifier">pprXcoffSectionHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#SectionType"><span class="hs-identifier hs-type">SectionType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-190"></a><a name="pprXcoffSectionHeader"><a href="PprBase.html#pprXcoffSectionHeader"><span class="hs-identifier">pprXcoffSectionHeader</span></a></a><span> </span><a name="local-6989586621680056663"><a href="#local-6989586621680056663"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680056663"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-191"></a><span>     </span><a href="Cmm.html#Text"><span class="hs-identifier hs-var">Text</span></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;.csect .text[PR]&quot;</span><span>
</span><a name="line-192"></a><span>     </span><a href="Cmm.html#Data"><span class="hs-identifier hs-var">Data</span></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;.csect .data[RW]&quot;</span><span>
</span><a name="line-193"></a><span>     </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;.csect .text[PR] # ReadOnlyData&quot;</span><span>
</span><a name="line-194"></a><span>     </span><a href="Cmm.html#RelocatableReadOnlyData"><span class="hs-identifier hs-var">RelocatableReadOnlyData</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;.csect .text[PR] # RelocatableReadOnlyData&quot;</span><span>
</span><a name="line-195"></a><span>     </span><a href="Cmm.html#ReadOnlyData16"><span class="hs-identifier hs-var">ReadOnlyData16</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;.csect .text[PR] # ReadOnlyData16&quot;</span><span>
</span><a name="line-196"></a><span>     </span><a href="Cmm.html#CString"><span class="hs-identifier hs-var">CString</span></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;.csect .text[PR] # CString&quot;</span><span>
</span><a name="line-197"></a><span>     </span><a href="Cmm.html#UninitialisedData"><span class="hs-identifier hs-var">UninitialisedData</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;.csect .data[BS]&quot;</span><span>
</span><a name="line-198"></a><span>     </span><a href="Cmm.html#OtherSection"><span class="hs-identifier hs-var">OtherSection</span></a><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-199"></a><span>       </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PprBase.pprXcoffSectionHeader: unknown section type&quot;</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-identifier">pprDarwinSectionHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#SectionType"><span class="hs-identifier hs-type">SectionType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-202"></a><a name="pprDarwinSectionHeader"><a href="PprBase.html#pprDarwinSectionHeader"><span class="hs-identifier">pprDarwinSectionHeader</span></a></a><span> </span><a name="local-6989586621680056664"><a href="#local-6989586621680056664"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680056664"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-204"></a><span>     </span><a href="Cmm.html#Text"><span class="hs-identifier hs-var">Text</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.text&quot;</span><span>
</span><a name="line-205"></a><span>     </span><a href="Cmm.html#Data"><span class="hs-identifier hs-var">Data</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.data&quot;</span><span>
</span><a name="line-206"></a><span>     </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.const&quot;</span><span>
</span><a name="line-207"></a><span>     </span><a href="Cmm.html#RelocatableReadOnlyData"><span class="hs-identifier hs-var">RelocatableReadOnlyData</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.const_data&quot;</span><span>
</span><a name="line-208"></a><span>     </span><a href="Cmm.html#UninitialisedData"><span class="hs-identifier hs-var">UninitialisedData</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.data&quot;</span><span>
</span><a name="line-209"></a><span>     </span><a href="Cmm.html#ReadOnlyData16"><span class="hs-identifier hs-var">ReadOnlyData16</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.const&quot;</span><span>
</span><a name="line-210"></a><span>     </span><a href="Cmm.html#CString"><span class="hs-identifier hs-var">CString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;.section\t__TEXT,__cstring,cstring_literals&quot;</span><span>
</span><a name="line-211"></a><span>     </span><a href="Cmm.html#OtherSection"><span class="hs-identifier hs-var">OtherSection</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-212"></a><span>       </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PprBase.pprDarwinSectionHeader: unknown section type&quot;</span><span>
</span><a name="line-213"></a></pre></body></html>