<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">X86.Regs</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-4"></a><span>        </span><span class="hs-comment">-- squeese functions for the graph allocator</span><span>
</span><a name="line-5"></a><span>        </span><a href="X86.Regs.html#virtualRegSqueeze"><span class="hs-identifier hs-var">virtualRegSqueeze</span></a><span class="hs-special">,</span><span>
</span><a name="line-6"></a><span>        </span><a href="X86.Regs.html#realRegSqueeze"><span class="hs-identifier hs-var">realRegSqueeze</span></a><span class="hs-special">,</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span>        </span><span class="hs-comment">-- immediates</span><span>
</span><a name="line-9"></a><span>        </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>        </span><a href="X86.Regs.html#strImmLit"><span class="hs-identifier hs-var">strImmLit</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span>        </span><span class="hs-comment">-- addressing modes</span><span>
</span><a name="line-14"></a><span>        </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="X86.Regs.html#addrOffset"><span class="hs-identifier hs-var">addrOffset</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>        </span><span class="hs-comment">-- registers</span><span>
</span><a name="line-18"></a><span>        </span><a href="X86.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="X86.Regs.html#argRegs"><span class="hs-identifier hs-var">argRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="X86.Regs.html#allArgRegs"><span class="hs-identifier hs-var">allArgRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="X86.Regs.html#allIntArgRegs"><span class="hs-identifier hs-var">allIntArgRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="X86.Regs.html#callClobberedRegs"><span class="hs-identifier hs-var">callClobberedRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="X86.Regs.html#instrClobberedRegs"><span class="hs-identifier hs-var">instrClobberedRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="X86.Regs.html#allMachRegNos"><span class="hs-identifier hs-var">allMachRegNos</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="X86.Regs.html#classOfRealReg"><span class="hs-identifier hs-var">classOfRealReg</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="X86.Regs.html#showReg"><span class="hs-identifier hs-var">showReg</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>        </span><span class="hs-comment">-- machine specific</span><span>
</span><a name="line-29"></a><span>        </span><a href="X86.Regs.html#EABase"><span class="hs-identifier hs-type">EABase</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#EAIndex"><span class="hs-identifier hs-type">EAIndex</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#addrModeRegs"><span class="hs-identifier hs-var">addrModeRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>        </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#ebx"><span class="hs-identifier hs-var">ebx</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#ecx"><span class="hs-identifier hs-var">ecx</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#esi"><span class="hs-identifier hs-var">esi</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#edi"><span class="hs-identifier hs-var">edi</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#ebp"><span class="hs-identifier hs-var">ebp</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="X86.Regs.html#fake0"><span class="hs-identifier hs-var">fake0</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#fake1"><span class="hs-identifier hs-var">fake1</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#fake2"><span class="hs-identifier hs-var">fake2</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#fake3"><span class="hs-identifier hs-var">fake3</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#fake4"><span class="hs-identifier hs-var">fake4</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#fake5"><span class="hs-identifier hs-var">fake5</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#firstfake"><span class="hs-identifier hs-var">firstfake</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>        </span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rbx"><span class="hs-identifier hs-var">rbx</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rcx"><span class="hs-identifier hs-var">rcx</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rsi"><span class="hs-identifier hs-var">rsi</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rdi"><span class="hs-identifier hs-var">rdi</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rbp"><span class="hs-identifier hs-var">rbp</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rsp"><span class="hs-identifier hs-var">rsp</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="X86.Regs.html#r8"><span class="hs-identifier hs-var">r8</span></a><span class="hs-special">,</span><span>  </span><a href="X86.Regs.html#r9"><span class="hs-identifier hs-var">r9</span></a><span class="hs-special">,</span><span>  </span><a href="X86.Regs.html#r10"><span class="hs-identifier hs-var">r10</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#r12"><span class="hs-identifier hs-var">r12</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#r13"><span class="hs-identifier hs-var">r13</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#r14"><span class="hs-identifier hs-var">r14</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#r15"><span class="hs-identifier hs-var">r15</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="X86.Regs.html#xmm0"><span class="hs-identifier hs-var">xmm0</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm1"><span class="hs-identifier hs-var">xmm1</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm2"><span class="hs-identifier hs-var">xmm2</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm3"><span class="hs-identifier hs-var">xmm3</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm4"><span class="hs-identifier hs-var">xmm4</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm5"><span class="hs-identifier hs-var">xmm5</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm6"><span class="hs-identifier hs-var">xmm6</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm7"><span class="hs-identifier hs-var">xmm7</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="X86.Regs.html#xmm8"><span class="hs-identifier hs-var">xmm8</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm9"><span class="hs-identifier hs-var">xmm9</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm10"><span class="hs-identifier hs-var">xmm10</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm11"><span class="hs-identifier hs-var">xmm11</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm12"><span class="hs-identifier hs-var">xmm12</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm13"><span class="hs-identifier hs-var">xmm13</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm14"><span class="hs-identifier hs-var">xmm14</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#xmm15"><span class="hs-identifier hs-var">xmm15</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="X86.Regs.html#xmm"><span class="hs-identifier hs-var">xmm</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>        </span><a href="X86.Regs.html#ripRel"><span class="hs-identifier hs-var">ripRel</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="X86.Regs.html#allFPArgRegs"><span class="hs-identifier hs-var">allFPArgRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>        </span><a href="X86.Regs.html#allocatableRegs"><span class="hs-identifier hs-var">allocatableRegs</span></a><span>
</span><a name="line-44"></a><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">where</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-cpp">#include &quot;nativeGen/NCG.h&quot;
#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="CodeGen.Platform.html"><span class="hs-identifier">CodeGen.Platform</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="Reg.html"><span class="hs-identifier">Reg</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="RegClass.html"><span class="hs-identifier">RegClass</span></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Cmm.html"><span class="hs-identifier">Cmm</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="CLabel.html"><span class="hs-identifier">CLabel</span></a><span>           </span><span class="hs-special">(</span><span> </span><a href="CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Array</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">A</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | regSqueeze_class reg</span><span>
</span><a name="line-66"></a><span class="hs-comment">--      Calculate the maximum number of register colors that could be</span><span>
</span><a name="line-67"></a><span class="hs-comment">--      denied to a node of this class due to having this reg</span><span>
</span><a name="line-68"></a><span class="hs-comment">--      as a neighbour.</span><span>
</span><a name="line-69"></a><span class="hs-comment">--</span><span>
</span><a name="line-70"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">virtualRegSqueeze</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-71"></a><span class="hs-identifier">virtualRegSqueeze</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#VirtualReg"><span class="hs-identifier hs-type">VirtualReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><a name="virtualRegSqueeze"><a href="X86.Regs.html#virtualRegSqueeze"><span class="hs-identifier">virtualRegSqueeze</span></a></a><span> </span><a name="local-6989586621684400195"><a href="#local-6989586621684400195"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621684400196"><a href="#local-6989586621684400196"><span class="hs-identifier">vr</span></a></a><span>
</span><a name="line-74"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400195"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-75"></a><span>        </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span>
</span><a name="line-76"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400196"><span class="hs-identifier hs-var">vr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-77"></a><span>                </span><a href="Reg.html#VirtualRegI"><span class="hs-identifier hs-var">VirtualRegI</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-78"></a><span>                </span><a href="Reg.html#VirtualRegHi"><span class="hs-identifier hs-var">VirtualRegHi</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-79"></a><span>                </span><a name="local-6989586621684400197"><a href="#local-6989586621684400197"><span class="hs-identifier">_other</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>        </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span>
</span><a name="line-82"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400196"><span class="hs-identifier hs-var">vr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-83"></a><span>                </span><a href="Reg.html#VirtualRegD"><span class="hs-identifier hs-var">VirtualRegD</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-84"></a><span>                </span><a href="Reg.html#VirtualRegF"><span class="hs-identifier hs-var">VirtualRegF</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-85"></a><span>                </span><a name="local-6989586621684400198"><a href="#local-6989586621684400198"><span class="hs-identifier">_other</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>        </span><a href="RegClass.html#RcDoubleSSE"><span class="hs-identifier hs-var">RcDoubleSSE</span></a><span>
</span><a name="line-88"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400196"><span class="hs-identifier hs-var">vr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-89"></a><span>                </span><a href="Reg.html#VirtualRegSSE"><span class="hs-identifier hs-var">VirtualRegSSE</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-90"></a><span>                </span><a name="local-6989586621684400199"><a href="#local-6989586621684400199"><span class="hs-identifier">_other</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span>        </span><a name="local-6989586621684400200"><a href="#local-6989586621684400200"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">realRegSqueeze</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-95"></a><span class="hs-identifier">realRegSqueeze</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-96"></a><a name="realRegSqueeze"><a href="X86.Regs.html#realRegSqueeze"><span class="hs-identifier">realRegSqueeze</span></a></a><span> </span><a name="local-6989586621684400201"><a href="#local-6989586621684400201"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621684400202"><a href="#local-6989586621684400202"><span class="hs-identifier">rr</span></a></a><span>
</span><a name="line-97"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400201"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-98"></a><span>        </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span>
</span><a name="line-99"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400202"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-100"></a><span>                </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621684400203"><a href="#local-6989586621684400203"><span class="hs-identifier">regNo</span></a></a><span>
</span><a name="line-101"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684400203"><span class="hs-identifier hs-var">regNo</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="X86.Regs.html#firstfake"><span class="hs-identifier hs-var">firstfake</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-102"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span>                </span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span>        </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span>
</span><a name="line-107"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400202"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-108"></a><span>                </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621684400204"><a href="#local-6989586621684400204"><span class="hs-identifier">regNo</span></a></a><span>
</span><a name="line-109"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684400204"><span class="hs-identifier hs-var">regNo</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="X86.Regs.html#firstfake"><span class="hs-identifier hs-var">firstfake</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684400204"><span class="hs-identifier hs-var">regNo</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="X86.Regs.html#lastfake"><span class="hs-identifier hs-var">lastfake</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-110"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span>                </span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span>        </span><a href="RegClass.html#RcDoubleSSE"><span class="hs-identifier hs-var">RcDoubleSSE</span></a><span>
</span><a name="line-115"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400202"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-116"></a><span>                </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621684400205"><a href="#local-6989586621684400205"><span class="hs-identifier">regNo</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684400205"><span class="hs-identifier hs-var">regNo</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="X86.Regs.html#firstxmm"><span class="hs-identifier hs-var">firstxmm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-117"></a><span>                </span><a name="local-6989586621684400206"><a href="#local-6989586621684400206"><span class="hs-identifier">_otherwise</span></a></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>        </span><a name="local-6989586621684400207"><a href="#local-6989586621684400207"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- Immediates</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-keyword">data</span><span> </span><a name="Imm"><a href="X86.Regs.html#Imm"><span class="hs-identifier">Imm</span></a></a><span>
</span><a name="line-125"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ImmInt"><a href="X86.Regs.html#ImmInt"><span class="hs-identifier">ImmInt</span></a></a><span>      </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-126"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImmInteger"><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier">ImmInteger</span></a></a><span>  </span><span class="hs-identifier hs-type">Integer</span><span>     </span><span class="hs-comment">-- Sigh.</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImmCLbl"><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier">ImmCLbl</span></a></a><span>     </span><a href="CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a><span>      </span><span class="hs-comment">-- AbstractC Label (with baggage)</span><span>
</span><a name="line-128"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImmLit"><a href="X86.Regs.html#ImmLit"><span class="hs-identifier">ImmLit</span></a></a><span>      </span><span class="hs-identifier hs-type">SDoc</span><span>        </span><span class="hs-comment">-- Simple string</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImmIndex"><a href="X86.Regs.html#ImmIndex"><span class="hs-identifier">ImmIndex</span></a></a><span>    </span><a href="CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-130"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImmFloat"><a href="X86.Regs.html#ImmFloat"><span class="hs-identifier">ImmFloat</span></a></a><span>    </span><span class="hs-identifier hs-type">Rational</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImmDouble"><a href="X86.Regs.html#ImmDouble"><span class="hs-identifier">ImmDouble</span></a></a><span>   </span><span class="hs-identifier hs-type">Rational</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImmConstantSum"><a href="X86.Regs.html#ImmConstantSum"><span class="hs-identifier">ImmConstantSum</span></a></a><span> </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span> </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImmConstantDiff"><a href="X86.Regs.html#ImmConstantDiff"><span class="hs-identifier">ImmConstantDiff</span></a></a><span> </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span> </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-identifier">strImmLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span>
</span><a name="line-136"></a><a name="strImmLit"><a href="X86.Regs.html#strImmLit"><span class="hs-identifier">strImmLit</span></a></a><span> </span><a name="local-6989586621684400208"><a href="#local-6989586621684400208"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmLit"><span class="hs-identifier hs-var">ImmLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621684400208"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-identifier">litToImm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span>
</span><a name="line-140"></a><a name="litToImm"><a href="X86.Regs.html#litToImm"><span class="hs-identifier">litToImm</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684400209"><a href="#local-6989586621684400209"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621684400210"><a href="#local-6989586621684400210"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">narrowS</span><span> </span><a href="#local-6989586621684400210"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621684400209"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>                </span><span class="hs-comment">-- narrow to the width: a CmmInt might be out of</span><span>
</span><a name="line-142"></a><span>                </span><span class="hs-comment">-- range, but we assume that ImmInteger only contains</span><span>
</span><a name="line-143"></a><span>                </span><span class="hs-comment">-- in-range values.  A signed value should be fine here.</span><span>
</span><a name="line-144"></a><span class="hs-identifier">litToImm</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><a name="local-6989586621684400211"><a href="#local-6989586621684400211"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmFloat"><span class="hs-identifier hs-var">ImmFloat</span></a><span> </span><a href="#local-6989586621684400211"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-145"></a><span class="hs-identifier">litToImm</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><a name="local-6989586621684400212"><a href="#local-6989586621684400212"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmDouble"><span class="hs-identifier hs-var">ImmDouble</span></a><span> </span><a href="#local-6989586621684400212"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-146"></a><span class="hs-identifier">litToImm</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684400213"><a href="#local-6989586621684400213"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684400213"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-147"></a><span class="hs-identifier">litToImm</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabelOff"><span class="hs-identifier hs-var">CmmLabelOff</span></a><span> </span><a name="local-6989586621684400214"><a href="#local-6989586621684400214"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621684400215"><a href="#local-6989586621684400215"><span class="hs-identifier">off</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmIndex"><span class="hs-identifier hs-var">ImmIndex</span></a><span> </span><a href="#local-6989586621684400214"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621684400215"><span class="hs-identifier hs-var">off</span></a><span>
</span><a name="line-148"></a><span class="hs-identifier">litToImm</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabelDiffOff"><span class="hs-identifier hs-var">CmmLabelDiffOff</span></a><span> </span><a name="local-6989586621684400216"><a href="#local-6989586621684400216"><span class="hs-identifier">l1</span></a></a><span> </span><a name="local-6989586621684400217"><a href="#local-6989586621684400217"><span class="hs-identifier">l2</span></a></a><span> </span><a name="local-6989586621684400218"><a href="#local-6989586621684400218"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-149"></a><span>                             </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmConstantSum"><span class="hs-identifier hs-var">ImmConstantSum</span></a><span>
</span><a name="line-150"></a><span>                               </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmConstantDiff"><span class="hs-identifier hs-var">ImmConstantDiff</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684400216"><span class="hs-identifier hs-var">l1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684400217"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>                               </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684400218"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span class="hs-identifier">litToImm</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;X86.Regs.litToImm: no match&quot;</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- addressing modes ------------------------------------------------------------</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-keyword">data</span><span> </span><a name="AddrMode"><a href="X86.Regs.html#AddrMode"><span class="hs-identifier">AddrMode</span></a></a><span>
</span><a name="line-157"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="AddrBaseIndex"><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier">AddrBaseIndex</span></a></a><span> </span><a href="X86.Regs.html#EABase"><span class="hs-identifier hs-type">EABase</span></a><span> </span><a href="X86.Regs.html#EAIndex"><span class="hs-identifier hs-type">EAIndex</span></a><span> </span><a href="X86.Regs.html#Displacement"><span class="hs-identifier hs-type">Displacement</span></a><span>
</span><a name="line-158"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="ImmAddr"><a href="X86.Regs.html#ImmAddr"><span class="hs-identifier">ImmAddr</span></a></a><span> </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-keyword">data</span><span> </span><a name="EABase"><a href="X86.Regs.html#EABase"><span class="hs-identifier">EABase</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a name="EABaseNone"><a href="X86.Regs.html#EABaseNone"><span class="hs-identifier">EABaseNone</span></a></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="EABaseReg"><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier">EABaseReg</span></a></a><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="EABaseRip"><a href="X86.Regs.html#EABaseRip"><span class="hs-identifier">EABaseRip</span></a></a><span>
</span><a name="line-161"></a><span class="hs-keyword">data</span><span> </span><a name="EAIndex"><a href="X86.Regs.html#EAIndex"><span class="hs-identifier">EAIndex</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a name="EAIndexNone"><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier">EAIndexNone</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="EAIndex"><a href="X86.Regs.html#EAIndex"><span class="hs-identifier">EAIndex</span></a></a><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-162"></a><span class="hs-keyword">type</span><span> </span><a name="Displacement"><a href="X86.Regs.html#Displacement"><span class="hs-identifier">Displacement</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#Imm"><span class="hs-identifier hs-type">Imm</span></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-identifier">addrOffset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span>
</span><a name="line-166"></a><a name="addrOffset"><a href="X86.Regs.html#addrOffset"><span class="hs-identifier">addrOffset</span></a></a><span> </span><a name="local-6989586621684400219"><a href="#local-6989586621684400219"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684400220"><a href="#local-6989586621684400220"><span class="hs-identifier">off</span></a></a><span>
</span><a name="line-167"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400219"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-168"></a><span>      </span><a href="X86.Regs.html#ImmAddr"><span class="hs-identifier hs-var">ImmAddr</span></a><span> </span><a name="local-6989586621684400221"><a href="#local-6989586621684400221"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621684400222"><a href="#local-6989586621684400222"><span class="hs-identifier">off0</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmAddr"><span class="hs-identifier hs-var">ImmAddr</span></a><span> </span><a href="#local-6989586621684400221"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684400222"><span class="hs-identifier hs-var">off0</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684400220"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span>      </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a name="local-6989586621684400223"><a href="#local-6989586621684400223"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621684400224"><a href="#local-6989586621684400224"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a name="local-6989586621684400225"><a href="#local-6989586621684400225"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a href="#local-6989586621684400223"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621684400224"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684400225"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684400220"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>      </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a name="local-6989586621684400226"><a href="#local-6989586621684400226"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621684400227"><a href="#local-6989586621684400227"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a name="local-6989586621684400228"><a href="#local-6989586621684400228"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a href="#local-6989586621684400226"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621684400227"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684400228"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621684400220"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span>      </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a name="local-6989586621684400229"><a href="#local-6989586621684400229"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621684400230"><a href="#local-6989586621684400230"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a name="local-6989586621684400231"><a href="#local-6989586621684400231"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a href="#local-6989586621684400229"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621684400230"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmIndex"><span class="hs-identifier hs-var">ImmIndex</span></a><span> </span><a href="#local-6989586621684400231"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621684400220"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>      </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a name="local-6989586621684400232"><a href="#local-6989586621684400232"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621684400233"><a href="#local-6989586621684400233"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmIndex"><span class="hs-identifier hs-var">ImmIndex</span></a><span> </span><a name="local-6989586621684400234"><a href="#local-6989586621684400234"><span class="hs-identifier">lbl</span></a></a><span> </span><a name="local-6989586621684400235"><a href="#local-6989586621684400235"><span class="hs-identifier">ix</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a href="#local-6989586621684400232"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621684400233"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmIndex"><span class="hs-identifier hs-var">ImmIndex</span></a><span> </span><a href="#local-6989586621684400234"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684400235"><span class="hs-identifier hs-var">ix</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684400220"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- in theory, shouldn't happen</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-identifier">addrModeRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-184"></a><a name="addrModeRegs"><a href="X86.Regs.html#addrModeRegs"><span class="hs-identifier">addrModeRegs</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a name="local-6989586621684400236"><a href="#local-6989586621684400236"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621684400237"><a href="#local-6989586621684400237"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621684400238"><span class="hs-identifier hs-var">b_regs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684400239"><span class="hs-identifier hs-var">i_regs</span></a><span>
</span><a name="line-185"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-186"></a><span>   </span><a name="local-6989586621684400238"><a href="#local-6989586621684400238"><span class="hs-identifier">b_regs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400236"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a name="local-6989586621684400240"><a href="#local-6989586621684400240"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684400240"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-187"></a><span>   </span><a name="local-6989586621684400239"><a href="#local-6989586621684400239"><span class="hs-identifier">i_regs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400237"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><a href="X86.Regs.html#EAIndex"><span class="hs-identifier hs-var">EAIndex</span></a><span> </span><a name="local-6989586621684400241"><a href="#local-6989586621684400241"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684400241"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-188"></a><span class="hs-identifier">addrModeRegs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">-- registers -------------------------------------------------------------------</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-comment">-- @spRel@ gives us a stack relative addressing mode for volatile</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- temporaries and for excess call arguments.  @fpRel@, where</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- applicable, is the same but for the frame pointer.</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-identifier">spRel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-199"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ desired stack offset in bytes, positive or negative</span><span>
</span><a name="line-200"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span>
</span><a name="line-201"></a><a name="spRel"><a href="X86.Regs.html#spRel"><span class="hs-identifier">spRel</span></a></a><span> </span><a name="local-6989586621684400242"><a href="#local-6989586621684400242"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684400243"><a href="#local-6989586621684400243"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-202"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684400242"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684400243"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="X86.Regs.html#rsp"><span class="hs-identifier hs-var">rsp</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684400243"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-comment">-- The register numbers must fit into 32 bits on x86, so that we can</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- use a Word32 to represent the set of free registers in the register</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- allocator.</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-identifier">firstfake</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lastfake</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span>
</span><a name="line-212"></a><a name="firstfake"><a href="X86.Regs.html#firstfake"><span class="hs-identifier">firstfake</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-213"></a><a name="lastfake"><a href="X86.Regs.html#lastfake"><span class="hs-identifier">lastfake</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">21</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-identifier">firstxmm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span>
</span><a name="line-216"></a><a name="firstxmm"><a href="X86.Regs.html#firstxmm"><span class="hs-identifier">firstxmm</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">24</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-identifier">lastxmm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span>
</span><a name="line-219"></a><a name="lastxmm"><a href="X86.Regs.html#lastxmm"><span class="hs-identifier">lastxmm</span></a></a><span> </span><a name="local-6989586621684400244"><a href="#local-6989586621684400244"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-220"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684400244"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">31</span><span>
</span><a name="line-221"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">39</span><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-identifier">lastint</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span>
</span><a name="line-224"></a><a name="lastint"><a href="X86.Regs.html#lastint"><span class="hs-identifier">lastint</span></a></a><span> </span><a name="local-6989586621684400245"><a href="#local-6989586621684400245"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-225"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684400245"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-comment">-- not %r8..%r15</span><span>
</span><a name="line-226"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">15</span><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-identifier">intregnos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span class="hs-special">]</span><span>
</span><a name="line-229"></a><a name="intregnos"><a href="X86.Regs.html#intregnos"><span class="hs-identifier">intregnos</span></a></a><span> </span><a name="local-6989586621684400246"><a href="#local-6989586621684400246"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="X86.Regs.html#lastint"><span class="hs-identifier hs-var">lastint</span></a><span> </span><a href="#local-6989586621684400246"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">]</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-identifier">fakeregnos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span class="hs-special">]</span><span>
</span><a name="line-232"></a><a name="fakeregnos"><a href="X86.Regs.html#fakeregnos"><span class="hs-identifier">fakeregnos</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#firstfake"><span class="hs-identifier hs-var">firstfake</span></a><span> </span><span class="hs-glyph">..</span><span> </span><a href="X86.Regs.html#lastfake"><span class="hs-identifier hs-var">lastfake</span></a><span class="hs-special">]</span><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-identifier">xmmregnos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span class="hs-special">]</span><span>
</span><a name="line-235"></a><a name="xmmregnos"><a href="X86.Regs.html#xmmregnos"><span class="hs-identifier">xmmregnos</span></a></a><span> </span><a name="local-6989586621684400247"><a href="#local-6989586621684400247"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#firstxmm"><span class="hs-identifier hs-var">firstxmm</span></a><span>  </span><span class="hs-glyph">..</span><span> </span><a href="X86.Regs.html#lastxmm"><span class="hs-identifier hs-var">lastxmm</span></a><span> </span><a href="#local-6989586621684400247"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">]</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-identifier">floatregnos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span class="hs-special">]</span><span>
</span><a name="line-238"></a><a name="floatregnos"><a href="X86.Regs.html#floatregnos"><span class="hs-identifier">floatregnos</span></a></a><span> </span><a name="local-6989586621684400248"><a href="#local-6989586621684400248"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#fakeregnos"><span class="hs-identifier hs-var">fakeregnos</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="X86.Regs.html#xmmregnos"><span class="hs-identifier hs-var">xmmregnos</span></a><span> </span><a href="#local-6989586621684400248"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-comment">-- argRegs is the set of regs which are read for an n-argument call to C.</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- For archs which pass all args on the stack (x86), is empty.</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- Sparc passes up to the first 6 args in regs.</span><span>
</span><a name="line-243"></a><span class="hs-identifier">argRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-244"></a><a name="argRegs"><a href="X86.Regs.html#argRegs"><span class="hs-identifier">argRegs</span></a></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;MachRegs.argRegs(x86): should not be used!&quot;</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-comment">-- | The complete set of machine registers.</span><span>
</span><a name="line-247"></a><span class="hs-identifier">allMachRegNos</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span class="hs-special">]</span><span>
</span><a name="line-248"></a><a name="allMachRegNos"><a href="X86.Regs.html#allMachRegNos"><span class="hs-identifier">allMachRegNos</span></a></a><span> </span><a name="local-6989586621684400249"><a href="#local-6989586621684400249"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#intregnos"><span class="hs-identifier hs-var">intregnos</span></a><span> </span><a href="#local-6989586621684400249"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="X86.Regs.html#floatregnos"><span class="hs-identifier hs-var">floatregnos</span></a><span> </span><a href="#local-6989586621684400249"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-comment">-- | Take the class of a register.</span><span>
</span><a name="line-251"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">classOfRealReg</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-252"></a><span class="hs-identifier">classOfRealReg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span>
</span><a name="line-253"></a><span class="hs-comment">-- On x86, we might want to have an 8-bit RegClass, which would</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- contain just regs 1-4 (the others don't have 8-bit versions).</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- However, we can get away without this at the moment because the</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- only allocatable integer regs are also 8-bit compatible (1, 3, 4).</span><span>
</span><a name="line-257"></a><a name="classOfRealReg"><a href="X86.Regs.html#classOfRealReg"><span class="hs-identifier">classOfRealReg</span></a></a><span> </span><a name="local-6989586621684400250"><a href="#local-6989586621684400250"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684400251"><a href="#local-6989586621684400251"><span class="hs-identifier">reg</span></a></a><span>
</span><a name="line-258"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684400251"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-259"></a><span>        </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621684400252"><a href="#local-6989586621684400252"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-260"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684400252"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="X86.Regs.html#lastint"><span class="hs-identifier hs-var">lastint</span></a><span> </span><a href="#local-6989586621684400250"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span>
</span><a name="line-261"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684400252"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="X86.Regs.html#lastfake"><span class="hs-identifier hs-var">lastfake</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span>
</span><a name="line-262"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RegClass.html#RcDoubleSSE"><span class="hs-identifier hs-var">RcDoubleSSE</span></a><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span>        </span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;X86.Regs.classOfRealReg: RegPairs on this arch&quot;</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- | Get the name of the register with this number.</span><span>
</span><a name="line-267"></a><span class="hs-identifier">showReg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-268"></a><a name="showReg"><a href="X86.Regs.html#showReg"><span class="hs-identifier">showReg</span></a></a><span> </span><a name="local-6989586621684400253"><a href="#local-6989586621684400253"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684400254"><a href="#local-6989586621684400254"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-269"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684400254"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="X86.Regs.html#firstxmm"><span class="hs-identifier hs-var">firstxmm</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;%xmm&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684400254"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><a href="X86.Regs.html#firstxmm"><span class="hs-identifier hs-var">firstxmm</span></a><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684400254"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="X86.Regs.html#firstfake"><span class="hs-identifier hs-var">firstfake</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;%fake&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684400254"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><a href="X86.Regs.html#firstfake"><span class="hs-identifier hs-var">firstfake</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684400254"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">8</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;%r&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684400254"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-272"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#regNames"><span class="hs-identifier hs-var">regNames</span></a><span> </span><a href="#local-6989586621684400253"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">A.!</span><span> </span><a href="#local-6989586621684400254"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-identifier">regNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">A.Array</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-275"></a><a name="regNames"><a href="X86.Regs.html#regNames"><span class="hs-identifier">regNames</span></a></a><span> </span><a name="local-6989586621684400255"><a href="#local-6989586621684400255"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-276"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684400255"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-277"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">A.listArray</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;%eax&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%ebx&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%ecx&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%edx&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%esi&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%edi&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%ebp&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%esp&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-278"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">A.listArray</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;%rax&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%rbx&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%rcx&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%rdx&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%rsi&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%rdi&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%rbp&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;%rsp&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">-- machine specific ------------------------------------------------------------</span><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-comment">{-
Intel x86 architecture:
- All registers except 7 (esp) are available for use.
- Only ebx, esi, edi and esp are available across a C call (they are callee-saves).
- Registers 0-7 have 16-bit counterparts (ax, bx etc.)
- Registers 0-3 have 8 bit counterparts (ah, bh etc.)
- Registers fake0..fake5 are fakes; we pretend x86 has 6 conventionally-addressable
  fp registers, and 3-operand insns for them, and we translate this into
  real stack-based x86 fp code after register allocation.

The fp registers are all Double registers; we don't have any RcFloat class
regs.  @regClass@ barfs if you give it a VirtualRegF, and mkVReg above should
never generate them.
-}</span><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-identifier">fake0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fake1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fake2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fake3</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fake4</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fake5</span><span class="hs-special">,</span><span>
</span><a name="line-301"></a><span>       </span><span class="hs-identifier">eax</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ebx</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ecx</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">edx</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">esp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ebp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">esi</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">edi</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><a name="eax"><a href="X86.Regs.html#eax"><span class="hs-identifier">eax</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-304"></a><a name="ebx"><a href="X86.Regs.html#ebx"><span class="hs-identifier">ebx</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-305"></a><a name="ecx"><a href="X86.Regs.html#ecx"><span class="hs-identifier">ecx</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-306"></a><a name="edx"><a href="X86.Regs.html#edx"><span class="hs-identifier">edx</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-307"></a><a name="esi"><a href="X86.Regs.html#esi"><span class="hs-identifier">esi</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-308"></a><a name="edi"><a href="X86.Regs.html#edi"><span class="hs-identifier">edi</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-309"></a><a name="ebp"><a href="X86.Regs.html#ebp"><span class="hs-identifier">ebp</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-310"></a><a name="esp"><a href="X86.Regs.html#esp"><span class="hs-identifier">esp</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">7</span><span>
</span><a name="line-311"></a><a name="fake0"><a href="X86.Regs.html#fake0"><span class="hs-identifier">fake0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">16</span><span>
</span><a name="line-312"></a><a name="fake1"><a href="X86.Regs.html#fake1"><span class="hs-identifier">fake1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">17</span><span>
</span><a name="line-313"></a><a name="fake2"><a href="X86.Regs.html#fake2"><span class="hs-identifier">fake2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">18</span><span>
</span><a name="line-314"></a><a name="fake3"><a href="X86.Regs.html#fake3"><span class="hs-identifier">fake3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">19</span><span>
</span><a name="line-315"></a><a name="fake4"><a href="X86.Regs.html#fake4"><span class="hs-identifier">fake4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">20</span><span>
</span><a name="line-316"></a><a name="fake5"><a href="X86.Regs.html#fake5"><span class="hs-identifier">fake5</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">21</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">{-
AMD x86_64 architecture:
- All 16 integer registers are addressable as 8, 16, 32 and 64-bit values:

  8     16    32    64
  ---------------------
  al    ax    eax   rax
  bl    bx    ebx   rbx
  cl    cx    ecx   rcx
  dl    dx    edx   rdx
  sil   si    esi   rsi
  dil   si    edi   rdi
  bpl   bp    ebp   rbp
  spl   sp    esp   rsp
  r10b  r10w  r10d  r10
  r11b  r11w  r11d  r11
  r12b  r12w  r12d  r12
  r13b  r13w  r13d  r13
  r14b  r14w  r14d  r14
  r15b  r15w  r15d  r15
-}</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-identifier">rax</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rbx</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rcx</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rdx</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rsp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rbp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rsi</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rdi</span><span class="hs-special">,</span><span>
</span><a name="line-343"></a><span>  </span><span class="hs-identifier">r8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r9</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r10</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r11</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r12</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r13</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r14</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r15</span><span class="hs-special">,</span><span>
</span><a name="line-344"></a><span>  </span><span class="hs-identifier">xmm0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm3</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm4</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm5</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm6</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm7</span><span class="hs-special">,</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-identifier">xmm8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm9</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm10</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm11</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm12</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm13</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm14</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">xmm15</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><a name="rax"><a href="X86.Regs.html#rax"><span class="hs-identifier">rax</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-348"></a><a name="rbx"><a href="X86.Regs.html#rbx"><span class="hs-identifier">rbx</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-349"></a><a name="rcx"><a href="X86.Regs.html#rcx"><span class="hs-identifier">rcx</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-350"></a><a name="rdx"><a href="X86.Regs.html#rdx"><span class="hs-identifier">rdx</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-351"></a><a name="rsi"><a href="X86.Regs.html#rsi"><span class="hs-identifier">rsi</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-352"></a><a name="rdi"><a href="X86.Regs.html#rdi"><span class="hs-identifier">rdi</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-353"></a><a name="rbp"><a href="X86.Regs.html#rbp"><span class="hs-identifier">rbp</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-354"></a><a name="rsp"><a href="X86.Regs.html#rsp"><span class="hs-identifier">rsp</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">7</span><span>
</span><a name="line-355"></a><a name="r8"><a href="X86.Regs.html#r8"><span class="hs-identifier">r8</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">8</span><span>
</span><a name="line-356"></a><a name="r9"><a href="X86.Regs.html#r9"><span class="hs-identifier">r9</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">9</span><span>
</span><a name="line-357"></a><a name="r10"><a href="X86.Regs.html#r10"><span class="hs-identifier">r10</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">10</span><span>
</span><a name="line-358"></a><a name="r11"><a href="X86.Regs.html#r11"><span class="hs-identifier">r11</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">11</span><span>
</span><a name="line-359"></a><a name="r12"><a href="X86.Regs.html#r12"><span class="hs-identifier">r12</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">12</span><span>
</span><a name="line-360"></a><a name="r13"><a href="X86.Regs.html#r13"><span class="hs-identifier">r13</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">13</span><span>
</span><a name="line-361"></a><a name="r14"><a href="X86.Regs.html#r14"><span class="hs-identifier">r14</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">14</span><span>
</span><a name="line-362"></a><a name="r15"><a href="X86.Regs.html#r15"><span class="hs-identifier">r15</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">15</span><span>
</span><a name="line-363"></a><a name="xmm0"><a href="X86.Regs.html#xmm0"><span class="hs-identifier">xmm0</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">24</span><span>
</span><a name="line-364"></a><a name="xmm1"><a href="X86.Regs.html#xmm1"><span class="hs-identifier">xmm1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">25</span><span>
</span><a name="line-365"></a><a name="xmm2"><a href="X86.Regs.html#xmm2"><span class="hs-identifier">xmm2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">26</span><span>
</span><a name="line-366"></a><a name="xmm3"><a href="X86.Regs.html#xmm3"><span class="hs-identifier">xmm3</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">27</span><span>
</span><a name="line-367"></a><a name="xmm4"><a href="X86.Regs.html#xmm4"><span class="hs-identifier">xmm4</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">28</span><span>
</span><a name="line-368"></a><a name="xmm5"><a href="X86.Regs.html#xmm5"><span class="hs-identifier">xmm5</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">29</span><span>
</span><a name="line-369"></a><a name="xmm6"><a href="X86.Regs.html#xmm6"><span class="hs-identifier">xmm6</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">30</span><span>
</span><a name="line-370"></a><a name="xmm7"><a href="X86.Regs.html#xmm7"><span class="hs-identifier">xmm7</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">31</span><span>
</span><a name="line-371"></a><a name="xmm8"><a href="X86.Regs.html#xmm8"><span class="hs-identifier">xmm8</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">32</span><span>
</span><a name="line-372"></a><a name="xmm9"><a href="X86.Regs.html#xmm9"><span class="hs-identifier">xmm9</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">33</span><span>
</span><a name="line-373"></a><a name="xmm10"><a href="X86.Regs.html#xmm10"><span class="hs-identifier">xmm10</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">34</span><span>
</span><a name="line-374"></a><a name="xmm11"><a href="X86.Regs.html#xmm11"><span class="hs-identifier">xmm11</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">35</span><span>
</span><a name="line-375"></a><a name="xmm12"><a href="X86.Regs.html#xmm12"><span class="hs-identifier">xmm12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">36</span><span>
</span><a name="line-376"></a><a name="xmm13"><a href="X86.Regs.html#xmm13"><span class="hs-identifier">xmm13</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">37</span><span>
</span><a name="line-377"></a><a name="xmm14"><a href="X86.Regs.html#xmm14"><span class="hs-identifier">xmm14</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">38</span><span>
</span><a name="line-378"></a><a name="xmm15"><a href="X86.Regs.html#xmm15"><span class="hs-identifier">xmm15</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-number">39</span><span>
</span><a name="line-379"></a><span>
</span><a name="line-380"></a><span class="hs-identifier">ripRel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.Regs.html#Displacement"><span class="hs-identifier hs-type">Displacement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span>
</span><a name="line-381"></a><a name="ripRel"><a href="X86.Regs.html#ripRel"><span class="hs-identifier">ripRel</span></a></a><span> </span><a name="local-6989586621684400256"><a href="#local-6989586621684400256"><span class="hs-identifier">imm</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a href="X86.Regs.html#EABaseRip"><span class="hs-identifier hs-var">EABaseRip</span></a><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><a href="#local-6989586621684400256"><span class="hs-identifier hs-var">imm</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span> </span><span class="hs-comment">-- so we can re-use some x86 code:</span><span>
</span><a name="line-385"></a><span class="hs-comment">{-
eax = rax
ebx = rbx
ecx = rcx
edx = rdx
esi = rsi
edi = rdi
ebp = rbp
esp = rsp
-}</span><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span class="hs-identifier">xmm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>
</span><a name="line-397"></a><a name="xmm"><a href="X86.Regs.html#xmm"><span class="hs-identifier">xmm</span></a></a><span> </span><a name="local-6989586621684400257"><a href="#local-6989586621684400257"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#firstxmm"><span class="hs-identifier hs-var">firstxmm</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684400257"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span>
</span><a name="line-401"></a><span>
</span><a name="line-402"></a><span class="hs-comment">-- | these are the regs which we cannot assume stay alive over a C call.</span><span>
</span><a name="line-403"></a><span class="hs-identifier">callClobberedRegs</span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- caller-saves registers</span><span>
</span><a name="line-405"></a><a name="callClobberedRegs"><a href="X86.Regs.html#callClobberedRegs"><span class="hs-identifier">callClobberedRegs</span></a></a><span> </span><a name="local-6989586621684400258"><a href="#local-6989586621684400258"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-406"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684400258"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">,</span><a href="X86.Regs.html#ecx"><span class="hs-identifier hs-var">ecx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#floatregnos"><span class="hs-identifier hs-var">floatregnos</span></a><span> </span><a href="#local-6989586621684400258"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684400258"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span>
</span><a name="line-408"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rcx"><span class="hs-identifier hs-var">rcx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r8"><span class="hs-identifier hs-var">r8</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r9"><span class="hs-identifier hs-var">r9</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r10"><span class="hs-identifier hs-var">r10</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span class="hs-special">]</span><span>
</span><a name="line-409"></a><span>   </span><span class="hs-comment">-- Only xmm0-5 are caller-saves registers on 64bit windows.</span><span>
</span><a name="line-410"></a><span>   </span><span class="hs-comment">-- ( https://docs.microsoft.com/en-us/cpp/build/register-usage )</span><span>
</span><a name="line-411"></a><span>   </span><span class="hs-comment">-- For details check the Win64 ABI.</span><span>
</span><a name="line-412"></a><span>   </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><a href="X86.Regs.html#fakeregnos"><span class="hs-identifier hs-var">fakeregnos</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="X86.Regs.html#xmm"><span class="hs-identifier hs-var">xmm</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span>  </span><span class="hs-glyph">..</span><span> </span><span class="hs-number">5</span><span class="hs-special">]</span><span>
</span><a name="line-413"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-414"></a><span>    </span><span class="hs-comment">-- all xmm regs are caller-saves</span><span>
</span><a name="line-415"></a><span>    </span><span class="hs-comment">-- caller-saves registers</span><span>
</span><a name="line-416"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rcx"><span class="hs-identifier hs-var">rcx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rsi"><span class="hs-identifier hs-var">rsi</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rdi"><span class="hs-identifier hs-var">rdi</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r8"><span class="hs-identifier hs-var">r8</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r9"><span class="hs-identifier hs-var">r9</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r10"><span class="hs-identifier hs-var">r10</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span class="hs-special">]</span><span>
</span><a name="line-417"></a><span>   </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#floatregnos"><span class="hs-identifier hs-var">floatregnos</span></a><span> </span><a href="#local-6989586621684400258"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span class="hs-identifier">allArgRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">,</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-420"></a><a name="allArgRegs"><a href="X86.Regs.html#allArgRegs"><span class="hs-identifier">allArgRegs</span></a></a><span> </span><a name="local-6989586621684400259"><a href="#local-6989586621684400259"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-421"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684400259"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#rcx"><span class="hs-identifier hs-var">rcx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r8"><span class="hs-identifier hs-var">r8</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r9"><span class="hs-identifier hs-var">r9</span></a><span class="hs-special">]</span><span>
</span><a name="line-422"></a><span>                                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#firstxmm"><span class="hs-identifier hs-var">firstxmm</span></a><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;X86.Regs.allArgRegs: not defined for this arch&quot;</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-identifier">allIntArgRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-426"></a><a name="allIntArgRegs"><a href="X86.Regs.html#allIntArgRegs"><span class="hs-identifier">allIntArgRegs</span></a></a><span> </span><a name="local-6989586621684400260"><a href="#local-6989586621684400260"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-427"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684400260"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684400260"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-428"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;X86.Regs.allIntArgRegs: not defined for this platform&quot;</span><span>
</span><a name="line-429"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#rdi"><span class="hs-identifier hs-var">rdi</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rsi"><span class="hs-identifier hs-var">rsi</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#rcx"><span class="hs-identifier hs-var">rcx</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r8"><span class="hs-identifier hs-var">r8</span></a><span class="hs-special">,</span><a href="X86.Regs.html#r9"><span class="hs-identifier hs-var">r9</span></a><span class="hs-special">]</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-identifier">allFPArgRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-432"></a><a name="allFPArgRegs"><a href="X86.Regs.html#allFPArgRegs"><span class="hs-identifier">allFPArgRegs</span></a></a><span> </span><a name="local-6989586621684400261"><a href="#local-6989586621684400261"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-433"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684400261"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span>
</span><a name="line-434"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;X86.Regs.allFPArgRegs: not defined for this platform&quot;</span><span>
</span><a name="line-435"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#firstxmm"><span class="hs-identifier hs-var">firstxmm</span></a><span> </span><span class="hs-glyph">..</span><span> </span><a href="X86.Regs.html#firstxmm"><span class="hs-identifier hs-var">firstxmm</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">7</span><span class="hs-special">]</span><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span class="hs-comment">-- Machine registers which might be clobbered by instructions that</span><span>
</span><a name="line-438"></a><span class="hs-comment">-- generate results into fixed registers, or need arguments in a fixed</span><span>
</span><a name="line-439"></a><span class="hs-comment">-- register.</span><span>
</span><a name="line-440"></a><span class="hs-identifier">instrClobberedRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-441"></a><a name="instrClobberedRegs"><a href="X86.Regs.html#instrClobberedRegs"><span class="hs-identifier">instrClobberedRegs</span></a></a><span> </span><a name="local-6989586621684400262"><a href="#local-6989586621684400262"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-442"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684400262"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#ecx"><span class="hs-identifier hs-var">ecx</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-443"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rcx"><span class="hs-identifier hs-var">rcx</span></a><span class="hs-special">,</span><span> </span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span class="hs-comment">--</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-comment">-- allocatableRegs is allMachRegNos with the fixed-use regs removed.</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- i.e., these are the regs for which we are prepared to allow the</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- register allocator to attempt to map VRegs to.</span><span>
</span><a name="line-450"></a><span class="hs-identifier">allocatableRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span class="hs-special">]</span><span>
</span><a name="line-451"></a><a name="allocatableRegs"><a href="X86.Regs.html#allocatableRegs"><span class="hs-identifier">allocatableRegs</span></a></a><span> </span><a name="local-6989586621684400263"><a href="#local-6989586621684400263"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-452"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684400264"><a href="#local-6989586621684400264"><span class="hs-identifier">isFree</span></a></a><span> </span><a name="local-6989586621684400265"><a href="#local-6989586621684400265"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CodeGen.Platform.html#freeReg"><span class="hs-identifier hs-var">freeReg</span></a><span> </span><a href="#local-6989586621684400263"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684400265"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-453"></a><span>     </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621684400264"><span class="hs-identifier hs-var">isFree</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#allMachRegNos"><span class="hs-identifier hs-var">allMachRegNos</span></a><span> </span><a href="#local-6989586621684400263"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a></pre></body></html>