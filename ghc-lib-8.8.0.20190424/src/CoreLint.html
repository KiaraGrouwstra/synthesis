<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1993-1998


A ``lint'' pass to check for Core correctness
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">CoreLint</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>    </span><a href="CoreLint.html#lintCoreBindings"><span class="hs-identifier hs-var">lintCoreBindings</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#lintUnfolding"><span class="hs-identifier hs-var">lintUnfolding</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="CoreLint.html#lintPassResult"><span class="hs-identifier hs-var">lintPassResult</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#lintInteractiveExpr"><span class="hs-identifier hs-var">lintInteractiveExpr</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#lintExpr"><span class="hs-identifier hs-var">lintExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="CoreLint.html#lintAnnots"><span class="hs-identifier hs-var">lintAnnots</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#lintTypes"><span class="hs-identifier hs-var">lintTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-comment">-- ** Debug output</span><span>
</span><a name="line-17"></a><span>    </span><a href="CoreLint.html#endPass"><span class="hs-identifier hs-var">endPass</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#endPassIO"><span class="hs-identifier hs-var">endPassIO</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>    </span><a href="CoreLint.html#dumpPassResult"><span class="hs-identifier hs-var">dumpPassResult</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>    </span><a href="CoreLint.html#dumpIfSet"><span class="hs-identifier hs-var">CoreLint.dumpIfSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreSyn</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreFVs</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreUtils</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreStats</span><span>   </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">coreBindsStats</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreMonad</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Bag</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Literal</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysWiredIn</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysPrim</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcType</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">isFloatingTy</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Var</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">VarEnv</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">VarSet</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Id</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">IdInfo</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PprCore</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ErrUtils</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Coercion</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Kind</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">RepType</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCoRep</span><span>       </span><span class="hs-comment">-- checks validity of types/coercions</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCon</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoAxiom</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ErrUtils</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Err</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ListSetOps</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrelNames</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">InstEnv</span><span>     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">instanceDFunId</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">OptCoercion</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">checkAxInstCo</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqSupply</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreArity</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">typeArity</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Demand</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">splitStrictSig</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isBotRes</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HscTypes</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Fail</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MonadFail</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">MonadUtils</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Foldable</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Pair</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.LanguageExtensions</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-comment">{-
Note [GHC Formalism]
~~~~~~~~~~~~~~~~~~~~
This file implements the type-checking algorithm for System FC, the &quot;official&quot;
name of the Core language. Type safety of FC is heart of the claim that
executables produced by GHC do not have segmentation faults. Thus, it is
useful to be able to reason about System FC independently of reading the code.
To this purpose, there is a document core-spec.pdf built in docs/core-spec that
contains a formalism of the types and functions dealt with here. If you change
just about anything in this file or you change other types/functions throughout
the Core language (all signposted to this note), you should update that
formalism. See docs/core-spec/README for more info about how to do so.

Note [check vs lint]
~~~~~~~~~~~~~~~~~~~~
This file implements both a type checking algorithm and also general sanity
checking. For example, the &quot;sanity checking&quot; checks for TyConApp on the left
of an AppTy, which should never happen. These sanity checks don't really
affect any notion of type soundness. Yet, it is convenient to do the sanity
checks at the same time as the type checks. So, we use the following naming
convention:

- Functions that begin with 'lint'... are involved in type checking. These
  functions might also do some sanity checking.

- Functions that begin with 'check'... are *not* involved in type checking.
  They exist only for sanity checking.

Issues surrounding variable naming, shadowing, and such are considered *not*
to be part of type checking, as the formalism omits these details.

Summary of checks
~~~~~~~~~~~~~~~~~
Checks that a set of core bindings is well-formed.  The PprStyle and String
just control what we print in the event of an error.  The Bool value
indicates whether we have done any specialisation yet (in which case we do
some extra checks).

We check for
        (a) type errors
        (b) Out-of-scope type variables
        (c) Out-of-scope local variables
        (d) Ill-kinded types
        (e) Incorrect unsafe coercions

If we have done specialisation the we check that there are
        (a) No top-level bindings of primitive (unboxed type)

Outstanding issues:

    -- Things are *not* OK if:
    --
    --  * Unsaturated type app before specialisation has been done;
    --
    --  * Oversaturated type app after specialisation (eta reduction
    --   may well be happening...);


Note [Linting function types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As described in Note [Representation of function types], all saturated
applications of funTyCon are represented with the FunTy constructor. We check
this invariant in lintType.

Note [Linting type lets]
~~~~~~~~~~~~~~~~~~~~~~~~
In the desugarer, it's very very convenient to be able to say (in effect)
        let a = Type Int in &lt;body&gt;
That is, use a type let.   See Note [Type let] in CoreSyn.

However, when linting &lt;body&gt; we need to remember that a=Int, else we might
reject a correct program.  So we carry a type substitution (in this example
[a -&gt; Int]) and apply this substitution before comparing types.  The functin
        lintInTy :: Type -&gt; LintM (Type, Kind)
returns a substituted type.

When we encounter a binder (like x::a) we must apply the substitution
to the type of the binding variable.  lintBinders does this.

For Ids, the type-substituted Id is added to the in_scope set (which
itself is part of the TCvSubst we are carrying down), and when we
find an occurrence of an Id, we fetch it from the in-scope set.

Note [Bad unsafe coercion]
~~~~~~~~~~~~~~~~~~~~~~~~~~
For discussion see https://ghc.haskell.org/trac/ghc/wiki/BadUnsafeCoercions
Linter introduces additional rules that checks improper coercion between
different types, called bad coercions. Following coercions are forbidden:

  (a) coercions between boxed and unboxed values;
  (b) coercions between unlifted values of the different sizes, here
      active size is checked, i.e. size of the actual value but not
      the space allocated for value;
  (c) coercions between floating and integral boxed values, this check
      is not yet supported for unboxed tuples, as no semantics were
      specified for that;
  (d) coercions from / to vector type
  (e) If types are unboxed tuples then tuple (# A_1,..,A_n #) can be
      coerced to (# B_1,..,B_m #) if n=m and for each pair A_i, B_i rules
      (a-e) holds.

Note [Join points]
~~~~~~~~~~~~~~~~~~
We check the rules listed in Note [Invariants on join points] in CoreSyn. The
only one that causes any difficulty is the first: All occurrences must be tail
calls. To this end, along with the in-scope set, we remember in le_joins the
subset of in-scope Ids that are valid join ids. For example:

  join j x = ... in
  case e of
    A -&gt; jump j y -- good
    B -&gt; case (jump j z) of -- BAD
           C -&gt; join h = jump j w in ... -- good
           D -&gt; let x = jump j v in ... -- BAD

A join point remains valid in case branches, so when checking the A
branch, j is still valid. When we check the scrutinee of the inner
case, however, we set le_joins to empty, and catch the
error. Similarly, join points can occur free in RHSes of other join
points but not the RHSes of value bindings (thunks and functions).

************************************************************************
*                                                                      *
                 Beginning and ending passes
*                                                                      *
************************************************************************

These functions are not CoreM monad stuff, but they probably ought to
be, and it makes a convenient place for them.  They print out stuff
before and after core passes, and do Core Lint when necessary.
-}</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-identifier">endPass</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreToDo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreProgram</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoreRule</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><a name="endPass"><a href="CoreLint.html#endPass"><span class="hs-identifier">endPass</span></a></a><span> </span><a name="local-6989586621679330375"><a href="#local-6989586621679330375"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621679330376"><a href="#local-6989586621679330376"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621679330377"><a href="#local-6989586621679330377"><span class="hs-identifier">rules</span></a></a><span>
</span><a name="line-211"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679330378"><a href="#local-6989586621679330378"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getHscEnv</span><span>
</span><a name="line-212"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679330379"><a href="#local-6989586621679330379"><span class="hs-identifier">print_unqual</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getPrintUnqualified</span><span>
</span><a name="line-213"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#endPassIO"><span class="hs-identifier hs-var">endPassIO</span></a><span> </span><a href="#local-6989586621679330378"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621679330379"><span class="hs-identifier hs-var">print_unqual</span></a><span> </span><a href="#local-6989586621679330375"><span class="hs-identifier hs-var">pass</span></a><span> </span><a href="#local-6989586621679330376"><span class="hs-identifier hs-var">binds</span></a><span> </span><a href="#local-6989586621679330377"><span class="hs-identifier hs-var">rules</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-identifier">endPassIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PrintUnqualified</span><span>
</span><a name="line-216"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreToDo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreProgram</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoreRule</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- Used by the IO-is CorePrep too</span><span>
</span><a name="line-218"></a><a name="endPassIO"><a href="CoreLint.html#endPassIO"><span class="hs-identifier">endPassIO</span></a></a><span> </span><a name="local-6989586621679330402"><a href="#local-6989586621679330402"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621679330403"><a href="#local-6989586621679330403"><span class="hs-identifier">print_unqual</span></a></a><span> </span><a name="local-6989586621679330404"><a href="#local-6989586621679330404"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621679330405"><a href="#local-6989586621679330405"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621679330406"><a href="#local-6989586621679330406"><span class="hs-identifier">rules</span></a></a><span>
</span><a name="line-219"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#dumpPassResult"><span class="hs-identifier hs-var">dumpPassResult</span></a><span> </span><a href="#local-6989586621679330407"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679330403"><span class="hs-identifier hs-var">print_unqual</span></a><span> </span><a href="#local-6989586621679330408"><span class="hs-identifier hs-var">mb_flag</span></a><span>
</span><a name="line-220"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679330404"><span class="hs-identifier hs-var">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprPassDetails</span><span> </span><a href="#local-6989586621679330404"><span class="hs-identifier hs-var">pass</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679330405"><span class="hs-identifier hs-var">binds</span></a><span> </span><a href="#local-6989586621679330406"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-221"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintPassResult"><span class="hs-identifier hs-var">lintPassResult</span></a><span> </span><a href="#local-6989586621679330402"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621679330404"><span class="hs-identifier hs-var">pass</span></a><span> </span><a href="#local-6989586621679330405"><span class="hs-identifier hs-var">binds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-222"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-223"></a><span>    </span><a name="local-6989586621679330407"><a href="#local-6989586621679330407"><span class="hs-identifier">dflags</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621679330402"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-224"></a><span>    </span><a name="local-6989586621679330408"><a href="#local-6989586621679330408"><span class="hs-identifier">mb_flag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="CoreLint.html#coreDumpFlag"><span class="hs-identifier hs-var">coreDumpFlag</span></a><span> </span><a href="#local-6989586621679330404"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-225"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679330409"><a href="#local-6989586621679330409"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">dopt</span><span> </span><a href="#local-6989586621679330409"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-6989586621679330407"><span class="hs-identifier hs-var">dflags</span></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679330409"><span class="hs-identifier hs-var">flag</span></a><span>
</span><a name="line-226"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">dopt</span><span> </span><span class="hs-identifier hs-var">Opt_D_verbose_core2core</span><span> </span><a href="#local-6989586621679330407"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679330409"><span class="hs-identifier hs-var">flag</span></a><span>
</span><a name="line-227"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span class="hs-identifier">dumpIfSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreToDo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-230"></a><a name="dumpIfSet"><a href="CoreLint.html#dumpIfSet"><span class="hs-identifier">dumpIfSet</span></a></a><span> </span><a name="local-6989586621679330410"><a href="#local-6989586621679330410"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679330411"><a href="#local-6989586621679330411"><span class="hs-identifier">dump_me</span></a></a><span> </span><a name="local-6989586621679330412"><a href="#local-6989586621679330412"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621679330413"><a href="#local-6989586621679330413"><span class="hs-identifier">extra_info</span></a></a><span> </span><a name="local-6989586621679330414"><a href="#local-6989586621679330414"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-231"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Err.dumpIfSet</span><span> </span><a href="#local-6989586621679330410"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679330411"><span class="hs-identifier hs-var">dump_me</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621679330410"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679330412"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679330413"><span class="hs-identifier hs-var">extra_info</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679330414"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-identifier">dumpPassResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-234"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PrintUnqualified</span><span>
</span><a name="line-235"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">DumpFlag</span><span>        </span><span class="hs-comment">-- Just df =&gt; show details in a file whose</span><span>
</span><a name="line-236"></a><span>                                        </span><span class="hs-comment">--            name is specified by df</span><span>
</span><a name="line-237"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>                  </span><span class="hs-comment">-- Header</span><span>
</span><a name="line-238"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>                  </span><span class="hs-comment">-- Extra info to appear after header</span><span>
</span><a name="line-239"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreProgram</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoreRule</span><span class="hs-special">]</span><span>
</span><a name="line-240"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-241"></a><a name="dumpPassResult"><a href="CoreLint.html#dumpPassResult"><span class="hs-identifier">dumpPassResult</span></a></a><span> </span><a name="local-6989586621679330415"><a href="#local-6989586621679330415"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679330416"><a href="#local-6989586621679330416"><span class="hs-identifier">unqual</span></a></a><span> </span><a name="local-6989586621679330417"><a href="#local-6989586621679330417"><span class="hs-identifier">mb_flag</span></a></a><span> </span><a name="local-6989586621679330418"><a href="#local-6989586621679330418"><span class="hs-identifier">hdr</span></a></a><span> </span><a name="local-6989586621679330419"><a href="#local-6989586621679330419"><span class="hs-identifier">extra_info</span></a></a><span> </span><a name="local-6989586621679330420"><a href="#local-6989586621679330420"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621679330421"><a href="#local-6989586621679330421"><span class="hs-identifier">rules</span></a></a><span>
</span><a name="line-242"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621679330417"><span class="hs-identifier hs-var">mb_flag</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679330425"><a href="#local-6989586621679330425"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-243"></a><span>           </span><span class="hs-identifier hs-var">Err.dumpSDoc</span><span> </span><a href="#local-6989586621679330415"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679330416"><span class="hs-identifier hs-var">unqual</span></a><span> </span><a href="#local-6989586621679330425"><span class="hs-identifier hs-var">flag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621679330415"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679330418"><span class="hs-identifier hs-var">hdr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679330423"><span class="hs-identifier hs-var">dump_doc</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>         </span><span class="hs-comment">-- Report result size</span><span>
</span><a name="line-246"></a><span>         </span><span class="hs-comment">-- This has the side effect of forcing the intermediate to be evaluated</span><span>
</span><a name="line-247"></a><span>         </span><span class="hs-comment">-- if it's not already forced by a -ddump flag.</span><span>
</span><a name="line-248"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">Err.debugTraceMsg</span><span> </span><a href="#local-6989586621679330415"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679330422"><span class="hs-identifier hs-var">size_doc</span></a><span>
</span><a name="line-249"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-252"></a><span>    </span><a name="local-6989586621679330422"><a href="#local-6989586621679330422"><span class="hs-identifier">size_doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Result size of&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679330418"><span class="hs-identifier hs-var">hdr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">equals</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coreBindsStats</span><span> </span><a href="#local-6989586621679330420"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span>    </span><a name="local-6989586621679330423"><a href="#local-6989586621679330423"><span class="hs-identifier">dump_doc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679330419"><span class="hs-identifier hs-var">extra_info</span></a><span>
</span><a name="line-255"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679330422"><span class="hs-identifier hs-var">size_doc</span></a><span>
</span><a name="line-256"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">blankLine</span><span>
</span><a name="line-257"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprCoreBindingsWithSize</span><span> </span><a href="#local-6989586621679330420"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-258"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppUnless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679330421"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679330424"><span class="hs-identifier hs-var">pp_rules</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621679330424"><a href="#local-6989586621679330424"><span class="hs-identifier">pp_rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">blankLine</span><span>
</span><a name="line-260"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;------ Local rules for imported ids --------&quot;</span><span>
</span><a name="line-261"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprRules</span><span> </span><a href="#local-6989586621679330421"><span class="hs-identifier hs-var">rules</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreToDo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">DumpFlag</span><span>
</span><a name="line-264"></a><a name="coreDumpFlag"><a href="CoreLint.html#coreDumpFlag"><span class="hs-identifier">coreDumpFlag</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoreDoSimplify</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_verbose_core2core</span><span>
</span><a name="line-265"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoreDoPluginPass</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_verbose_core2core</span><span>
</span><a name="line-266"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoFloatInwards</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_verbose_core2core</span><span>
</span><a name="line-267"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoreDoFloatOutwards</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_verbose_core2core</span><span>
</span><a name="line-268"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreLiberateCase</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_verbose_core2core</span><span>
</span><a name="line-269"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoStaticArgs</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_verbose_core2core</span><span>
</span><a name="line-270"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoCallArity</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_call_arity</span><span>
</span><a name="line-271"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoExitify</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_exitify</span><span>
</span><a name="line-272"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoStrictness</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_stranal</span><span>
</span><a name="line-273"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoWorkerWrapper</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_worker_wrapper</span><span>
</span><a name="line-274"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoSpecialising</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_spec</span><span>
</span><a name="line-275"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoSpecConstr</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_spec</span><span>
</span><a name="line-276"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreCSE</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_cse</span><span>
</span><a name="line-277"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDesugar</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_ds_preopt</span><span>
</span><a name="line-278"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDesugarOpt</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_ds</span><span>
</span><a name="line-279"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreTidy</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_simpl</span><span>
</span><a name="line-280"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CorePrep</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_prep</span><span>
</span><a name="line-281"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreOccurAnal</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_D_dump_occur_anal</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoPrintCore</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-284"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoreDoRuleCheck</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-285"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-identifier hs-var">CoreDoNothing</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-286"></a><span class="hs-identifier">coreDumpFlag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoreDoPasses</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                 Top-level interfaces
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-identifier">lintPassResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreToDo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreProgram</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-297"></a><a name="lintPassResult"><a href="CoreLint.html#lintPassResult"><span class="hs-identifier">lintPassResult</span></a></a><span> </span><a name="local-6989586621679330426"><a href="#local-6989586621679330426"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621679330427"><a href="#local-6989586621679330427"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621679330428"><a href="#local-6989586621679330428"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-298"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_DoCoreLinting</span><span> </span><a href="#local-6989586621679330429"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-301"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679330430"><a href="#local-6989586621679330430"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679330431"><a href="#local-6989586621679330431"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintCoreBindings"><span class="hs-identifier hs-var">lintCoreBindings</span></a><span> </span><a href="#local-6989586621679330429"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679330427"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#interactiveInScope"><span class="hs-identifier hs-var">interactiveInScope</span></a><span> </span><a href="#local-6989586621679330426"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679330428"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-302"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">Err.showPass</span><span> </span><a href="#local-6989586621679330429"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Core Linted result of &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showPpr</span><span> </span><a href="#local-6989586621679330429"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679330427"><span class="hs-identifier hs-var">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#displayLintResults"><span class="hs-identifier hs-var">displayLintResults</span></a><span> </span><a href="#local-6989586621679330429"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679330427"><span class="hs-identifier hs-var">pass</span></a><span> </span><a href="#local-6989586621679330430"><span class="hs-identifier hs-var">warns</span></a><span> </span><a href="#local-6989586621679330431"><span class="hs-identifier hs-var">errs</span></a><span> </span><a href="#local-6989586621679330428"><span class="hs-identifier hs-var">binds</span></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-304"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-305"></a><span>    </span><a name="local-6989586621679330429"><a href="#local-6989586621679330429"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621679330426"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-identifier">displayLintResults</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreToDo</span><span>
</span><a name="line-308"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">Err.MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">Err.MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreProgram</span><span>
</span><a name="line-309"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-310"></a><a name="displayLintResults"><a href="CoreLint.html#displayLintResults"><span class="hs-identifier">displayLintResults</span></a></a><span> </span><a name="local-6989586621679330432"><a href="#local-6989586621679330432"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679330433"><a href="#local-6989586621679330433"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621679330434"><a href="#local-6989586621679330434"><span class="hs-identifier">warns</span></a></a><span> </span><a name="local-6989586621679330435"><a href="#local-6989586621679330435"><span class="hs-identifier">errs</span></a></a><span> </span><a name="local-6989586621679330436"><a href="#local-6989586621679330436"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-311"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isEmptyBag</span><span> </span><a href="#local-6989586621679330435"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">putLogMsg</span><span> </span><a href="#local-6989586621679330432"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-identifier hs-var">NoReason</span><span> </span><span class="hs-identifier hs-var">Err.SevDump</span><span> </span><span class="hs-identifier hs-var">noSrcSpan</span><span>
</span><a name="line-313"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">defaultDumpStyle</span><span> </span><a href="#local-6989586621679330432"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><a href="CoreLint.html#lint_banner"><span class="hs-identifier hs-var">lint_banner</span></a><span> </span><span class="hs-string">&quot;errors&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679330433"><span class="hs-identifier hs-var">pass</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Err.pprMessageBag</span><span> </span><a href="#local-6989586621679330435"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-315"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;*** Offending Program ***&quot;</span><span>
</span><a name="line-316"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprCoreBindings</span><span> </span><a href="#local-6989586621679330436"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-317"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;*** End of Offense ***&quot;</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">Err.ghcExit</span><span> </span><a href="#local-6989586621679330432"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isEmptyBag</span><span> </span><a href="#local-6989586621679330434"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hasNoDebugOutput</span><span> </span><a href="#local-6989586621679330432"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="CoreLint.html#showLintWarnings"><span class="hs-identifier hs-var">showLintWarnings</span></a><span> </span><a href="#local-6989586621679330433"><span class="hs-identifier hs-var">pass</span></a><span>
</span><a name="line-323"></a><span>  </span><span class="hs-comment">-- If the Core linter encounters an error, output to stderr instead of</span><span>
</span><a name="line-324"></a><span>  </span><span class="hs-comment">-- stdout (#13342)</span><span>
</span><a name="line-325"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putLogMsg</span><span> </span><a href="#local-6989586621679330432"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-identifier hs-var">NoReason</span><span> </span><span class="hs-identifier hs-var">Err.SevInfo</span><span> </span><span class="hs-identifier hs-var">noSrcSpan</span><span>
</span><a name="line-326"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">defaultDumpStyle</span><span> </span><a href="#local-6989586621679330432"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>        </span><span class="hs-special">(</span><a href="CoreLint.html#lint_banner"><span class="hs-identifier hs-var">lint_banner</span></a><span> </span><span class="hs-string">&quot;warnings&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679330433"><span class="hs-identifier hs-var">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">Err.pprMessageBag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapBag</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">blankLine</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679330434"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-identifier">lint_banner</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-333"></a><a name="lint_banner"><a href="CoreLint.html#lint_banner"><span class="hs-identifier">lint_banner</span></a></a><span> </span><a name="local-6989586621679330437"><a href="#local-6989586621679330437"><span class="hs-identifier">string</span></a></a><span> </span><a name="local-6989586621679330438"><a href="#local-6989586621679330438"><span class="hs-identifier">pass</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;*** Core Lint&quot;</span><span>      </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621679330437"><span class="hs-identifier hs-var">string</span></a><span>
</span><a name="line-334"></a><span>                          </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;: in result of&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679330438"><span class="hs-identifier hs-var">pass</span></a><span>
</span><a name="line-335"></a><span>                          </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;***&quot;</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span class="hs-identifier">showLintWarnings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreToDo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- Disable Lint warnings on the first simplifier pass, because</span><span>
</span><a name="line-339"></a><span class="hs-comment">-- there may be some INLINE knots still tied, which is tiresomely noisy</span><span>
</span><a name="line-340"></a><a name="showLintWarnings"><a href="CoreLint.html#showLintWarnings"><span class="hs-identifier">showLintWarnings</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoreDoSimplify</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SimplMode</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sm_phase</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InitialPhase</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-341"></a><span class="hs-identifier">showLintWarnings</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-identifier">lintInteractiveExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-344"></a><a name="lintInteractiveExpr"><a href="CoreLint.html#lintInteractiveExpr"><span class="hs-identifier">lintInteractiveExpr</span></a></a><span> </span><a name="local-6989586621679330439"><a href="#local-6989586621679330439"><span class="hs-identifier">what</span></a></a><span> </span><a name="local-6989586621679330440"><a href="#local-6989586621679330440"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621679330441"><a href="#local-6989586621679330441"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-345"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_DoCoreLinting</span><span> </span><a href="#local-6989586621679330442"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-346"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679330445"><a href="#local-6989586621679330445"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintExpr"><span class="hs-identifier hs-var">lintExpr</span></a><span> </span><a href="#local-6989586621679330442"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#interactiveInScope"><span class="hs-identifier hs-var">interactiveInScope</span></a><span> </span><a href="#local-6989586621679330440"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679330441"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-348"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="#local-6989586621679330443"><span class="hs-identifier hs-var">display_lint_err</span></a><span> </span><a href="#local-6989586621679330445"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-349"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">Err.ghcExit</span><span> </span><a href="#local-6989586621679330442"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-350"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-351"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-353"></a><span>    </span><a name="local-6989586621679330442"><a href="#local-6989586621679330442"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621679330440"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span>    </span><a name="local-6989586621679330443"><a href="#local-6989586621679330443"><span class="hs-identifier">display_lint_err</span></a></a><span> </span><a name="local-6989586621679330444"><a href="#local-6989586621679330444"><span class="hs-identifier">err</span></a></a><span>
</span><a name="line-356"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">putLogMsg</span><span> </span><a href="#local-6989586621679330442"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-identifier hs-var">NoReason</span><span> </span><span class="hs-identifier hs-var">Err.SevDump</span><span>
</span><a name="line-357"></a><span>               </span><span class="hs-identifier hs-var">noSrcSpan</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">defaultDumpStyle</span><span> </span><a href="#local-6989586621679330442"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-358"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><a href="CoreLint.html#lint_banner"><span class="hs-identifier hs-var">lint_banner</span></a><span> </span><span class="hs-string">&quot;errors&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621679330439"><span class="hs-identifier hs-var">what</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679330444"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-360"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;*** Offending Program ***&quot;</span><span>
</span><a name="line-361"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprCoreExpr</span><span> </span><a href="#local-6989586621679330441"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-362"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;*** End of Offense ***&quot;</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-363"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">Err.ghcExit</span><span> </span><a href="#local-6989586621679330442"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-identifier">interactiveInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HscEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- In GHCi we may lint expressions, or bindings arising from 'deriving'</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- clauses, that mention variables bound in the interactive context.</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- These are Local things (see Note [Interactively-bound Ids in GHCi] in HscTypes).</span><span>
</span><a name="line-369"></a><span class="hs-comment">-- So we have to tell Lint about them, lest it reports them as out of scope.</span><span>
</span><a name="line-370"></a><span class="hs-comment">--</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- We do this by find local-named things that may appear free in interactive</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- context.  This function is pretty revolting and quite possibly not quite right.</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- When we are not in GHCi, the interactive context (hsc_IC hsc_env) is empty</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- so this is a (cheap) no-op.</span><span>
</span><a name="line-375"></a><span class="hs-comment">--</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- See Trac #8215 for an example</span><span>
</span><a name="line-377"></a><a name="interactiveInScope"><a href="CoreLint.html#interactiveInScope"><span class="hs-identifier">interactiveInScope</span></a></a><span> </span><a name="local-6989586621679330446"><a href="#local-6989586621679330446"><span class="hs-identifier">hsc_env</span></a></a><span>
</span><a name="line-378"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679330453"><span class="hs-identifier hs-var">tyvars</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679330452"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-379"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-380"></a><span>    </span><span class="hs-comment">-- C.f. TcRnDriver.setInteractiveContext, Desugar.deSugarExpr</span><span>
</span><a name="line-381"></a><span>    </span><a name="local-6989586621679330447"><a href="#local-6989586621679330447"><span class="hs-identifier">ictxt</span></a></a><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_IC</span><span> </span><a href="#local-6989586621679330446"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-382"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679330448"><a href="#local-6989586621679330448"><span class="hs-identifier">cls_insts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679330449"><a href="#local-6989586621679330449"><span class="hs-identifier">_fam_insts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_instances</span><span> </span><a href="#local-6989586621679330447"><span class="hs-identifier hs-var">ictxt</span></a><span>
</span><a name="line-383"></a><span>    </span><a name="local-6989586621679330450"><a href="#local-6989586621679330450"><span class="hs-identifier">te1</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTypeEnvWithImplicits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_tythings</span><span> </span><a href="#local-6989586621679330447"><span class="hs-identifier hs-var">ictxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-384"></a><span>    </span><a name="local-6989586621679330451"><a href="#local-6989586621679330451"><span class="hs-identifier">te</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">extendTypeEnvWithIds</span><span> </span><a href="#local-6989586621679330450"><span class="hs-identifier hs-var">te1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">instanceDFunId</span><span> </span><a href="#local-6989586621679330448"><span class="hs-identifier hs-var">cls_insts</span></a><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span>    </span><a name="local-6989586621679330452"><a href="#local-6989586621679330452"><span class="hs-identifier">ids</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeEnvIds</span><span> </span><a href="#local-6989586621679330451"><span class="hs-identifier hs-var">te</span></a><span>
</span><a name="line-386"></a><span>    </span><a name="local-6989586621679330453"><a href="#local-6989586621679330453"><span class="hs-identifier">tyvars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyCoVarsOfTypesList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679330452"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-387"></a><span>              </span><span class="hs-comment">-- Why the type variables?  How can the top level envt have free tyvars?</span><span>
</span><a name="line-388"></a><span>              </span><span class="hs-comment">-- I think it's because of the GHCi debugger, which can bind variables</span><span>
</span><a name="line-389"></a><span>              </span><span class="hs-comment">--   f :: [t] -&gt; [t]</span><span>
</span><a name="line-390"></a><span>              </span><span class="hs-comment">-- where t is a RuntimeUnk (see TcType)</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-identifier">lintCoreBindings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreToDo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreProgram</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span class="hs-special">)</span><span>
</span><a name="line-393"></a><span class="hs-comment">--   Returns (warnings, errors)</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-395"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-396"></a><a name="lintCoreBindings"><a href="CoreLint.html#lintCoreBindings"><span class="hs-identifier">lintCoreBindings</span></a></a><span> </span><a name="local-6989586621679330454"><a href="#local-6989586621679330454"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679330455"><a href="#local-6989586621679330455"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621679330456"><a href="#local-6989586621679330456"><span class="hs-identifier">local_in_scope</span></a></a><span> </span><a name="local-6989586621679330457"><a href="#local-6989586621679330457"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-397"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#initL"><span class="hs-identifier hs-var">initL</span></a><span> </span><a href="#local-6989586621679330454"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679330459"><span class="hs-identifier hs-var">flags</span></a><span> </span><a href="#local-6989586621679330458"><span class="hs-identifier hs-var">in_scope_set</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-398"></a><span>    </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><a href="CoreLint.html#TopLevelBindings"><span class="hs-identifier hs-var">TopLevelBindings</span></a><span>         </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-399"></a><span>    </span><a href="CoreLint.html#lintLetBndrs"><span class="hs-identifier hs-var">lintLetBndrs</span></a><span> </span><span class="hs-identifier hs-var">TopLevel</span><span> </span><a href="#local-6989586621679330463"><span class="hs-identifier hs-var">binders</span></a><span>   </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-400"></a><span>        </span><span class="hs-comment">-- Put all the top-level binders in scope at the start</span><span>
</span><a name="line-401"></a><span>        </span><span class="hs-comment">-- This is because transformation rules can bring something</span><span>
</span><a name="line-402"></a><span>        </span><span class="hs-comment">-- into use 'unexpectedly'</span><span>
</span><a name="line-403"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679330464"><span class="hs-identifier hs-var">dups</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#dupVars"><span class="hs-identifier hs-var">dupVars</span></a><span> </span><a href="#local-6989586621679330464"><span class="hs-identifier hs-var">dups</span></a><span class="hs-special">)</span><span>
</span><a name="line-404"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679330465"><span class="hs-identifier hs-var">ext_dups</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#dupExtVars"><span class="hs-identifier hs-var">dupExtVars</span></a><span> </span><a href="#local-6989586621679330465"><span class="hs-identifier hs-var">ext_dups</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679330467"><span class="hs-identifier hs-var">lint_bind</span></a><span> </span><a href="#local-6989586621679330457"><span class="hs-identifier hs-var">binds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-406"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-407"></a><span>    </span><a name="local-6989586621679330458"><a href="#local-6989586621679330458"><span class="hs-identifier">in_scope_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInScopeSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkVarSet</span><span> </span><a href="#local-6989586621679330456"><span class="hs-identifier hs-var">local_in_scope</span></a><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span>    </span><a name="local-6989586621679330459"><a href="#local-6989586621679330459"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#defaultLintFlags"><span class="hs-identifier hs-var">defaultLintFlags</span></a><span>
</span><a name="line-410"></a><span>               </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lf_check_global_ids</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679330460"><span class="hs-identifier hs-var">check_globals</span></a><span>
</span><a name="line-411"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lf_check_inline_loop_breakers</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679330461"><span class="hs-identifier hs-var">check_lbs</span></a><span>
</span><a name="line-412"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lf_check_static_ptrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679330462"><span class="hs-identifier hs-var">check_static_ptrs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span>    </span><span class="hs-comment">-- See Note [Checking for global Ids]</span><span>
</span><a name="line-415"></a><span>    </span><a name="local-6989586621679330460"><a href="#local-6989586621679330460"><span class="hs-identifier">check_globals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679330455"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-416"></a><span>                      </span><span class="hs-identifier hs-var">CoreTidy</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-417"></a><span>                      </span><span class="hs-identifier hs-var">CorePrep</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-418"></a><span>                      </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span>    </span><span class="hs-comment">-- See Note [Checking for INLINE loop breakers]</span><span>
</span><a name="line-421"></a><span>    </span><a name="local-6989586621679330461"><a href="#local-6989586621679330461"><span class="hs-identifier">check_lbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679330455"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-422"></a><span>                      </span><span class="hs-identifier hs-var">CoreDesugar</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-423"></a><span>                      </span><span class="hs-identifier hs-var">CoreDesugarOpt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-424"></a><span>                      </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span>    </span><span class="hs-comment">-- See Note [Checking StaticPtrs]</span><span>
</span><a name="line-427"></a><span>    </span><a name="local-6989586621679330462"><a href="#local-6989586621679330462"><span class="hs-identifier">check_static_ptrs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">xopt</span><span> </span><span class="hs-identifier hs-var">LangExt.StaticPointers</span><span> </span><a href="#local-6989586621679330454"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#AllowAnywhere"><span class="hs-identifier hs-var">AllowAnywhere</span></a><span>
</span><a name="line-428"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679330455"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-429"></a><span>                          </span><span class="hs-identifier hs-var">CoreDoFloatOutwards</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#AllowAtTopLevel"><span class="hs-identifier hs-var">AllowAtTopLevel</span></a><span>
</span><a name="line-430"></a><span>                          </span><span class="hs-identifier hs-var">CoreTidy</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#RejectEverywhere"><span class="hs-identifier hs-var">RejectEverywhere</span></a><span>
</span><a name="line-431"></a><span>                          </span><span class="hs-identifier hs-var">CorePrep</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#AllowAtTopLevel"><span class="hs-identifier hs-var">AllowAtTopLevel</span></a><span>
</span><a name="line-432"></a><span>                          </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#AllowAnywhere"><span class="hs-identifier hs-var">AllowAnywhere</span></a><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span>    </span><a name="local-6989586621679330463"><a href="#local-6989586621679330463"><span class="hs-identifier">binders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">bindersOfBinds</span><span> </span><a href="#local-6989586621679330457"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-435"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679330464"><a href="#local-6989586621679330464"><span class="hs-identifier">dups</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">removeDups</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621679330463"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span>    </span><span class="hs-comment">-- dups_ext checks for names with different uniques</span><span>
</span><a name="line-438"></a><span>    </span><span class="hs-comment">-- but but the same External name M.n.  We don't</span><span>
</span><a name="line-439"></a><span>    </span><span class="hs-comment">-- allow this at top level:</span><span>
</span><a name="line-440"></a><span>    </span><span class="hs-comment">--    M.n{r3}  = ...</span><span>
</span><a name="line-441"></a><span>    </span><span class="hs-comment">--    M.n{r29} = ...</span><span>
</span><a name="line-442"></a><span>    </span><span class="hs-comment">-- because they both get the same linker symbol</span><span>
</span><a name="line-443"></a><span>    </span><a name="local-6989586621679330465"><a href="#local-6989586621679330465"><span class="hs-identifier">ext_dups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">removeDups</span><span> </span><a href="#local-6989586621679330466"><span class="hs-identifier hs-var">ord_ext</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">Var.varName</span><span> </span><a href="#local-6989586621679330463"><span class="hs-identifier hs-var">binders</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>    </span><a name="local-6989586621679330466"><a href="#local-6989586621679330466"><span class="hs-identifier">ord_ext</span></a></a><span> </span><a name="local-6989586621679331227"><a href="#local-6989586621679331227"><span class="hs-identifier">n1</span></a></a><span> </span><a name="local-6989586621679331228"><a href="#local-6989586621679331228"><span class="hs-identifier">n2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331229"><a href="#local-6989586621679331229"><span class="hs-identifier">m1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">nameModule_maybe</span><span> </span><a href="#local-6989586621679331227"><span class="hs-identifier hs-var">n1</span></a><span>
</span><a name="line-445"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331230"><a href="#local-6989586621679331230"><span class="hs-identifier">m2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">nameModule_maybe</span><span> </span><a href="#local-6989586621679331228"><span class="hs-identifier hs-var">n2</span></a><span>
</span><a name="line-446"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331229"><span class="hs-identifier hs-var">m1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nameOccName</span><span> </span><a href="#local-6989586621679331227"><span class="hs-identifier hs-var">n1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331230"><span class="hs-identifier hs-var">m2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nameOccName</span><span> </span><a href="#local-6989586621679331228"><span class="hs-identifier hs-var">n2</span></a><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span>    </span><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-450"></a><span>    </span><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-451"></a><span>    </span><a name="local-6989586621679330467"><a href="#local-6989586621679330467"><span class="hs-identifier">lint_bind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Rec</span><span> </span><a name="local-6989586621679331231"><a href="#local-6989586621679331231"><span class="hs-identifier">prs</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#lintSingleBinding"><span class="hs-identifier hs-var">lintSingleBinding</span></a><span> </span><span class="hs-identifier hs-var">TopLevel</span><span> </span><span class="hs-identifier hs-var">Recursive</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331231"><span class="hs-identifier hs-var">prs</span></a><span>
</span><a name="line-452"></a><span>    </span><span class="hs-identifier">lint_bind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NonRec</span><span> </span><a name="local-6989586621679331232"><a href="#local-6989586621679331232"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679331233"><a href="#local-6989586621679331233"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintSingleBinding"><span class="hs-identifier hs-var">lintSingleBinding</span></a><span> </span><span class="hs-identifier hs-var">TopLevel</span><span> </span><span class="hs-identifier hs-var">NonRecursive</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331232"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><a href="#local-6989586621679331233"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[lintUnfolding]{lintUnfolding}
*                                                                      *
************************************************************************

Note [Linting Unfoldings from Interfaces]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

We use this to check all top-level unfoldings that come in from interfaces
(it is very painful to catch errors otherwise).

We do not need to call lintUnfolding on unfoldings that are nested within
top-level unfoldings; they are linted when we lint the top-level unfolding;
hence the `TopLevelFlag` on `tcPragExpr` in TcIface.

-}</span><span>
</span><a name="line-472"></a><span>
</span><a name="line-473"></a><span class="hs-identifier">lintUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-474"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcLoc</span><span>
</span><a name="line-475"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarSet</span><span>         </span><span class="hs-comment">-- Treat these as in scope</span><span>
</span><a name="line-476"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span>
</span><a name="line-477"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>   </span><span class="hs-comment">-- Nothing =&gt; OK</span><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><a name="lintUnfolding"><a href="CoreLint.html#lintUnfolding"><span class="hs-identifier">lintUnfolding</span></a></a><span> </span><a name="local-6989586621679331234"><a href="#local-6989586621679331234"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679331235"><a href="#local-6989586621679331235"><span class="hs-identifier">locn</span></a></a><span> </span><a name="local-6989586621679331236"><a href="#local-6989586621679331236"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679331237"><a href="#local-6989586621679331237"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-480"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isEmptyBag</span><span> </span><a href="#local-6989586621679331240"><span class="hs-identifier hs-var">errs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-481"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprMessageBag</span><span> </span><a href="#local-6989586621679331240"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-483"></a><span>    </span><a name="local-6989586621679331238"><a href="#local-6989586621679331238"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInScopeSet</span><span> </span><a href="#local-6989586621679331236"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-484"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679331239"><a href="#local-6989586621679331239"><span class="hs-identifier">_warns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331240"><a href="#local-6989586621679331240"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#initL"><span class="hs-identifier hs-var">initL</span></a><span> </span><a href="#local-6989586621679331234"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="CoreLint.html#defaultLintFlags"><span class="hs-identifier hs-var">defaultLintFlags</span></a><span> </span><a href="#local-6989586621679331238"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621679331241"><span class="hs-identifier hs-var">linter</span></a><span>
</span><a name="line-485"></a><span>    </span><a name="local-6989586621679331241"><a href="#local-6989586621679331241"><span class="hs-identifier">linter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#ImportedUnfolding"><span class="hs-identifier hs-var">ImportedUnfolding</span></a><span> </span><a href="#local-6989586621679331235"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-486"></a><span>             </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331237"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-identifier">lintExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-489"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Treat these as in scope</span><span>
</span><a name="line-490"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span>
</span><a name="line-491"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>        </span><span class="hs-comment">-- Nothing =&gt; OK</span><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><a name="lintExpr"><a href="CoreLint.html#lintExpr"><span class="hs-identifier">lintExpr</span></a></a><span> </span><a name="local-6989586621679331242"><a href="#local-6989586621679331242"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679331243"><a href="#local-6989586621679331243"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679331244"><a href="#local-6989586621679331244"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-494"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isEmptyBag</span><span> </span><a href="#local-6989586621679331247"><span class="hs-identifier hs-var">errs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-495"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprMessageBag</span><span> </span><a href="#local-6989586621679331247"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-497"></a><span>    </span><a name="local-6989586621679331245"><a href="#local-6989586621679331245"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInScopeSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkVarSet</span><span> </span><a href="#local-6989586621679331243"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679331246"><a href="#local-6989586621679331246"><span class="hs-identifier">_warns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331247"><a href="#local-6989586621679331247"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#initL"><span class="hs-identifier hs-var">initL</span></a><span> </span><a href="#local-6989586621679331242"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="CoreLint.html#defaultLintFlags"><span class="hs-identifier hs-var">defaultLintFlags</span></a><span> </span><a href="#local-6989586621679331245"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621679331248"><span class="hs-identifier hs-var">linter</span></a><span>
</span><a name="line-499"></a><span>    </span><a name="local-6989586621679331248"><a href="#local-6989586621679331248"><span class="hs-identifier">linter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><a href="CoreLint.html#TopLevelBindings"><span class="hs-identifier hs-var">TopLevelBindings</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-500"></a><span>             </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331244"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-501"></a><span>
</span><a name="line-502"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[lintCoreBinding]{lintCoreBinding}
*                                                                      *
************************************************************************

Check a core binding, returning the list of variables bound.
-}</span><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-identifier">lintSingleBinding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TopLevelFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RecFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-513"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-514"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-515"></a><a name="lintSingleBinding"><a href="CoreLint.html#lintSingleBinding"><span class="hs-identifier">lintSingleBinding</span></a></a><span> </span><a name="local-6989586621679331249"><a href="#local-6989586621679331249"><span class="hs-identifier">top_lvl_flag</span></a></a><span> </span><a name="local-6989586621679331250"><a href="#local-6989586621679331250"><span class="hs-identifier">rec_flag</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331251"><a href="#local-6989586621679331251"><span class="hs-identifier">binder</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331252"><a href="#local-6989586621679331252"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#RhsOf"><span class="hs-identifier hs-var">RhsOf</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-517"></a><span>         </span><span class="hs-comment">-- Check the rhs</span><span>
</span><a name="line-518"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331253"><a href="#local-6989586621679331253"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintRhs"><span class="hs-identifier hs-var">lintRhs</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><a href="#local-6989586621679331252"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-519"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331254"><a href="#local-6989586621679331254"><span class="hs-identifier">binder_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#applySubstTy"><span class="hs-identifier hs-var">applySubstTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-520"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331254"><span class="hs-identifier hs-var">binder_ty</span></a><span> </span><a href="#local-6989586621679331253"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkRhsMsg"><span class="hs-identifier hs-var">mkRhsMsg</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;RHS&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331253"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>
</span><a name="line-522"></a><span>       </span><span class="hs-comment">-- If the binding is for a CoVar, the RHS should be (Coercion co)</span><span>
</span><a name="line-523"></a><span>       </span><span class="hs-comment">-- See Note [CoreSyn type and coercion invariant] in CoreSyn</span><span>
</span><a name="line-524"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isCoVar</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">isCoArg</span><span> </span><a href="#local-6989586621679331252"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>                </span><span class="hs-special">(</span><a href="CoreLint.html#mkLetErr"><span class="hs-identifier hs-var">mkLetErr</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><a href="#local-6989586621679331252"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span>       </span><span class="hs-comment">-- Check that it's not levity-polymorphic</span><span>
</span><a name="line-528"></a><span>       </span><span class="hs-comment">-- Do this first, because otherwise isUnliftedType panics</span><span>
</span><a name="line-529"></a><span>       </span><span class="hs-comment">-- Annoyingly, this duplicates the test in lintIdBdr,</span><span>
</span><a name="line-530"></a><span>       </span><span class="hs-comment">-- because for non-rec lets we call lintSingleBinding first</span><span>
</span><a name="line-531"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJoinId</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isTypeLevPoly</span><span> </span><a href="#local-6989586621679331254"><span class="hs-identifier hs-var">binder_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>                </span><span class="hs-special">(</span><a href="CoreLint.html#badBndrTyMsg"><span class="hs-identifier hs-var">badBndrTyMsg</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;levity-polymorphic&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span>        </span><span class="hs-comment">-- Check the let/app invariant</span><span>
</span><a name="line-535"></a><span>        </span><span class="hs-comment">-- See Note [CoreSyn let/app invariant] in CoreSyn</span><span>
</span><a name="line-536"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">isJoinId</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span>
</span><a name="line-537"></a><span>               </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isUnliftedType</span><span> </span><a href="#local-6989586621679331254"><span class="hs-identifier hs-var">binder_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>               </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isNonRec</span><span> </span><a href="#local-6989586621679331250"><span class="hs-identifier hs-var">rec_flag</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">exprOkForSpeculation</span><span> </span><a href="#local-6989586621679331252"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>               </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">exprIsTickedString</span><span> </span><a href="#local-6989586621679331252"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-540"></a><span>           </span><span class="hs-special">(</span><a href="CoreLint.html#badBndrTyMsg"><span class="hs-identifier hs-var">badBndrTyMsg</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;unlifted&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span>        </span><span class="hs-comment">-- Check that if the binder is top-level or recursive, it's not</span><span>
</span><a name="line-543"></a><span>        </span><span class="hs-comment">-- demanded. Primitive string literals are exempt as there is no</span><span>
</span><a name="line-544"></a><span>        </span><span class="hs-comment">-- computation to perform, see Note [CoreSyn top-level string literals].</span><span>
</span><a name="line-545"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isStrictId</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-546"></a><span>            </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isNonRec</span><span> </span><a href="#local-6989586621679331250"><span class="hs-identifier hs-var">rec_flag</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isTopLevel</span><span> </span><a href="#local-6989586621679331249"><span class="hs-identifier hs-var">top_lvl_flag</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-547"></a><span>            </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">exprIsTickedString</span><span> </span><a href="#local-6989586621679331252"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-548"></a><span>           </span><span class="hs-special">(</span><a href="CoreLint.html#mkStrictMsg"><span class="hs-identifier hs-var">mkStrictMsg</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span>        </span><span class="hs-comment">-- Check that if the binder is at the top level and has type Addr#,</span><span>
</span><a name="line-551"></a><span>        </span><span class="hs-comment">-- that it is a string literal, see</span><span>
</span><a name="line-552"></a><span>        </span><span class="hs-comment">-- Note [CoreSyn top-level string literals].</span><span>
</span><a name="line-553"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isTopLevel</span><span> </span><a href="#local-6989586621679331249"><span class="hs-identifier hs-var">top_lvl_flag</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679331254"><span class="hs-identifier hs-var">binder_ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">addrPrimTy</span><span class="hs-special">)</span><span>
</span><a name="line-554"></a><span>                 </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">exprIsTickedString</span><span> </span><a href="#local-6989586621679331252"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-555"></a><span>           </span><span class="hs-special">(</span><a href="CoreLint.html#mkTopNonLitStrMsg"><span class="hs-identifier hs-var">mkTopNonLitStrMsg</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-556"></a><span>
</span><a name="line-557"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331255"><a href="#local-6989586621679331255"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getLintFlags"><span class="hs-identifier hs-var">getLintFlags</span></a><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span>         </span><span class="hs-comment">-- Check that a join-point binder has a valid type</span><span>
</span><a name="line-560"></a><span>         </span><span class="hs-comment">-- NB: lintIdBinder has checked that it is not top-level bound</span><span>
</span><a name="line-561"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">isJoinId_maybe</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-562"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331256"><a href="#local-6989586621679331256"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isValidJoinPointType</span><span> </span><a href="#local-6989586621679331256"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-6989586621679331254"><span class="hs-identifier hs-var">binder_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-564"></a><span>                                  </span><span class="hs-special">(</span><a href="CoreLint.html#mkInvalidJoinPointMsg"><span class="hs-identifier hs-var">mkInvalidJoinPointMsg</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><a href="#local-6989586621679331254"><span class="hs-identifier hs-var">binder_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">lf_check_inline_loop_breakers</span><span> </span><a href="#local-6989586621679331255"><span class="hs-identifier hs-var">flags</span></a><span>
</span><a name="line-567"></a><span>               </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isStableUnfolding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">realIdUnfolding</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-568"></a><span>               </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isStrongLoopBreaker</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idOccInfo</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-569"></a><span>               </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isInlinePragma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idInlinePragma</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-570"></a><span>              </span><span class="hs-special">(</span><a href="CoreLint.html#addWarnL"><span class="hs-identifier hs-var">addWarnL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;INLINE binder is (non-rule) loop breaker:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-571"></a><span>              </span><span class="hs-comment">-- Only non-rule loop breakers inhibit inlining</span><span>
</span><a name="line-572"></a><span>
</span><a name="line-573"></a><span>      </span><span class="hs-comment">-- Check whether arity and demand type are consistent (only if demand analysis</span><span>
</span><a name="line-574"></a><span>      </span><span class="hs-comment">-- already happened)</span><span>
</span><a name="line-575"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-576"></a><span>      </span><span class="hs-comment">-- Note (Apr 2014): this is actually ok.  See Note [Demand analysis for trivial right-hand sides]</span><span>
</span><a name="line-577"></a><span>      </span><span class="hs-comment">--                  in DmdAnal.  After eta-expansion in CorePrep the rhs is no longer trivial.</span><span>
</span><a name="line-578"></a><span>      </span><span class="hs-comment">--       ; let dmdTy = idStrictness binder</span><span>
</span><a name="line-579"></a><span>      </span><span class="hs-comment">--       ; checkL (case dmdTy of</span><span>
</span><a name="line-580"></a><span>      </span><span class="hs-comment">--                  StrictSig dmd_ty -&gt; idArity binder &gt;= dmdTypeDepth dmd_ty || exprIsTrivial rhs)</span><span>
</span><a name="line-581"></a><span>      </span><span class="hs-comment">--           (mkArityMsg binder)</span><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span>       </span><span class="hs-comment">-- Check that the binder's arity is within the bounds imposed by</span><span>
</span><a name="line-584"></a><span>       </span><span class="hs-comment">-- the type and the strictness signature. See Note [exprArity invariant]</span><span>
</span><a name="line-585"></a><span>       </span><span class="hs-comment">-- and Note [Trimming arity]</span><span>
</span><a name="line-586"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeArity</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthAtLeast</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">idArity</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-587"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;idArity&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idArity</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-588"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;exceeds typeArity&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-589"></a><span>           </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeArity</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-590"></a><span>           </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-591"></a><span>
</span><a name="line-592"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">splitStrictSig</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idStrictness</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-593"></a><span>           </span><span class="hs-special">(</span><a name="local-6989586621679331257"><a href="#local-6989586621679331257"><span class="hs-identifier">demands</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331258"><a href="#local-6989586621679331258"><span class="hs-identifier">result_info</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isBotRes</span><span> </span><a href="#local-6989586621679331258"><span class="hs-identifier hs-var">result_info</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-594"></a><span>             </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331257"><span class="hs-identifier hs-var">demands</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthAtLeast</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">idArity</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-595"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;idArity&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idArity</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-596"></a><span>               </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;exceeds arity imposed by the strictness signature&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-597"></a><span>               </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idStrictness</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-598"></a><span>               </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-599"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#lintCoreRule"><span class="hs-identifier hs-var">lintCoreRule</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><a href="#local-6989586621679331254"><span class="hs-identifier hs-var">binder_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idCoreRules</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span>
</span><a name="line-602"></a><span>
</span><a name="line-603"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#UnfoldingOf"><span class="hs-identifier hs-var">UnfoldingOf</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-604"></a><span>         </span><a href="CoreLint.html#lintIdUnfolding"><span class="hs-identifier hs-var">lintIdUnfolding</span></a><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span> </span><a href="#local-6989586621679331254"><span class="hs-identifier hs-var">binder_ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idUnfolding</span><span> </span><a href="#local-6989586621679331251"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span>        </span><span class="hs-comment">-- We should check the unfolding, if any, but this is tricky because</span><span>
</span><a name="line-607"></a><span>        </span><span class="hs-comment">-- the unfolding is a SimplifiableCoreExpr. Give up for now.</span><span>
</span><a name="line-608"></a><span>
</span><a name="line-609"></a><span class="hs-comment">-- | Checks the RHS of bindings. It only differs from 'lintCoreExpr'</span><span>
</span><a name="line-610"></a><span class="hs-comment">-- in that it doesn't reject occurrences of the function 'makeStatic' when they</span><span>
</span><a name="line-611"></a><span class="hs-comment">-- appear at the top level and @lf_check_static_ptrs == AllowAtTopLevel@, and</span><span>
</span><a name="line-612"></a><span class="hs-comment">-- for join points, it skips the outer lambdas that take arguments to the</span><span>
</span><a name="line-613"></a><span class="hs-comment">-- join point.</span><span>
</span><a name="line-614"></a><span class="hs-comment">--</span><span>
</span><a name="line-615"></a><span class="hs-comment">-- See Note [Checking StaticPtrs].</span><span>
</span><a name="line-616"></a><span class="hs-identifier">lintRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">OutType</span><span>
</span><a name="line-617"></a><a name="lintRhs"><a href="CoreLint.html#lintRhs"><span class="hs-identifier">lintRhs</span></a></a><span> </span><a name="local-6989586621679331259"><a href="#local-6989586621679331259"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679331260"><a href="#local-6989586621679331260"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-618"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331274"><a href="#local-6989586621679331274"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">isJoinId_maybe</span><span> </span><a href="#local-6989586621679331259"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-619"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331261"><span class="hs-identifier hs-var">lint_join_lams</span></a><span> </span><a href="#local-6989586621679331274"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-6989586621679331274"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679331260"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-620"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">AlwaysTailCalled</span><span> </span><a name="local-6989586621679331275"><a href="#local-6989586621679331275"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">tailCallInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idOccInfo</span><span> </span><a href="#local-6989586621679331259"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-621"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331261"><span class="hs-identifier hs-var">lint_join_lams</span></a><span> </span><a href="#local-6989586621679331275"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-6989586621679331275"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679331260"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-622"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-623"></a><span>    </span><a name="local-6989586621679331261"><a href="#local-6989586621679331261"><span class="hs-identifier">lint_join_lams</span></a></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679331262"><a href="#local-6989586621679331262"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-624"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331262"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-625"></a><span>
</span><a name="line-626"></a><span>    </span><span class="hs-identifier">lint_join_lams</span><span> </span><a name="local-6989586621679331263"><a href="#local-6989586621679331263"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679331264"><a href="#local-6989586621679331264"><span class="hs-identifier">tot</span></a></a><span> </span><a name="local-6989586621679331265"><a href="#local-6989586621679331265"><span class="hs-identifier">enforce</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lam</span><span> </span><a name="local-6989586621679331266"><a href="#local-6989586621679331266"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331267"><a href="#local-6989586621679331267"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LambdaBodyOf"><span class="hs-identifier hs-var">LambdaBodyOf</span></a><span> </span><a href="#local-6989586621679331266"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-628"></a><span>        </span><a href="CoreLint.html#lintBinder"><span class="hs-identifier hs-var">lintBinder</span></a><span> </span><span class="hs-identifier hs-var">LambdaBind</span><span> </span><a href="#local-6989586621679331266"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331268"><a href="#local-6989586621679331268"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-629"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331269"><a href="#local-6989586621679331269"><span class="hs-identifier">body_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331261"><span class="hs-identifier hs-var">lint_join_lams</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331263"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331264"><span class="hs-identifier hs-var">tot</span></a><span> </span><a href="#local-6989586621679331265"><span class="hs-identifier hs-var">enforce</span></a><span> </span><a href="#local-6989586621679331267"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-630"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkLamType</span><span> </span><a href="#local-6989586621679331268"><span class="hs-identifier hs-var">var'</span></a><span> </span><a href="#local-6989586621679331269"><span class="hs-identifier hs-var">body_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span>    </span><span class="hs-identifier">lint_join_lams</span><span> </span><a name="local-6989586621679331270"><a href="#local-6989586621679331270"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679331271"><a href="#local-6989586621679331271"><span class="hs-identifier">tot</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a name="local-6989586621679331272"><a href="#local-6989586621679331272"><span class="hs-identifier">_other</span></a></a><span>
</span><a name="line-633"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#mkBadJoinArityMsg"><span class="hs-identifier hs-var">mkBadJoinArityMsg</span></a><span> </span><a href="#local-6989586621679331259"><span class="hs-identifier hs-var">bndr</span></a><span> </span><a href="#local-6989586621679331271"><span class="hs-identifier hs-var">tot</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331271"><span class="hs-identifier hs-var">tot</span></a><span class="hs-glyph">-</span><a href="#local-6989586621679331270"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331260"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-634"></a><span>    </span><span class="hs-identifier">lint_join_lams</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621679331273"><a href="#local-6989586621679331273"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-635"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331273"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-636"></a><span>          </span><span class="hs-comment">-- Future join point, not yet eta-expanded</span><span>
</span><a name="line-637"></a><span>          </span><span class="hs-comment">-- Body is not a tail position</span><span>
</span><a name="line-638"></a><span>
</span><a name="line-639"></a><span class="hs-comment">-- Allow applications of the data constructor @StaticPtr@ at the top</span><span>
</span><a name="line-640"></a><span class="hs-comment">-- but produce errors otherwise.</span><span>
</span><a name="line-641"></a><span class="hs-identifier">lintRhs</span><span> </span><a name="local-6989586621679331276"><a href="#local-6989586621679331276"><span class="hs-identifier">_bndr</span></a></a><span> </span><a name="local-6989586621679331277"><a href="#local-6989586621679331277"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">lf_check_static_ptrs</span><span> </span><a href="CoreLint.html#getLintFlags"><span class="hs-identifier hs-var">getLintFlags</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679331278"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-642"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-643"></a><span>    </span><span class="hs-comment">-- Allow occurrences of 'makeStatic' at the top-level but produce errors</span><span>
</span><a name="line-644"></a><span>    </span><span class="hs-comment">-- otherwise.</span><span>
</span><a name="line-645"></a><span>    </span><a name="local-6989586621679331278"><a href="#local-6989586621679331278"><span class="hs-identifier">go</span></a></a><span> </span><a href="CoreLint.html#AllowAtTopLevel"><span class="hs-identifier hs-var">AllowAtTopLevel</span></a><span>
</span><a name="line-646"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331279"><a href="#local-6989586621679331279"><span class="hs-identifier">binders0</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331280"><a href="#local-6989586621679331280"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">collectTyBinders</span><span> </span><a href="#local-6989586621679331277"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-647"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331281"><a href="#local-6989586621679331281"><span class="hs-identifier">fun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331282"><a href="#local-6989586621679331282"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331283"><a href="#local-6989586621679331283"><span class="hs-identifier">info</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331284"><a href="#local-6989586621679331284"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">collectMakeStaticArgs</span><span> </span><a href="#local-6989586621679331280"><span class="hs-identifier hs-var">rhs'</span></a><span>
</span><a name="line-648"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-649"></a><span>        </span><span class="hs-identifier hs-var">foldr</span><span>
</span><a name="line-650"></a><span>        </span><span class="hs-comment">-- imitate @lintCoreExpr (Lam ...)@</span><span>
</span><a name="line-651"></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679331285"><a href="#local-6989586621679331285"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331286"><a href="#local-6989586621679331286"><span class="hs-identifier">loopBinders</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-652"></a><span>          </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LambdaBodyOf"><span class="hs-identifier hs-var">LambdaBodyOf</span></a><span> </span><a href="#local-6989586621679331285"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-653"></a><span>            </span><a href="CoreLint.html#lintBinder"><span class="hs-identifier hs-var">lintBinder</span></a><span> </span><span class="hs-identifier hs-var">LambdaBind</span><span> </span><a href="#local-6989586621679331285"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679331287"><a href="#local-6989586621679331287"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-654"></a><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331288"><a href="#local-6989586621679331288"><span class="hs-identifier">body_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331286"><span class="hs-identifier hs-var">loopBinders</span></a><span>
</span><a name="line-655"></a><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkLamType</span><span> </span><a href="#local-6989586621679331287"><span class="hs-identifier hs-var">var'</span></a><span> </span><a href="#local-6989586621679331288"><span class="hs-identifier hs-var">body_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-656"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-657"></a><span>        </span><span class="hs-comment">-- imitate @lintCoreExpr (App ...)@</span><span>
</span><a name="line-658"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679331289"><a href="#local-6989586621679331289"><span class="hs-identifier">fun_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331281"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-659"></a><span>            </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#AnExpr"><span class="hs-identifier hs-var">AnExpr</span></a><span> </span><a href="#local-6989586621679331280"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintCoreArgs"><span class="hs-identifier hs-var">lintCoreArgs</span></a><span> </span><a href="#local-6989586621679331289"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Type</span><span> </span><a href="#local-6989586621679331282"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331283"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331284"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">]</span><span>
</span><a name="line-660"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-661"></a><span>        </span><a href="#local-6989586621679331279"><span class="hs-identifier hs-var">binders0</span></a><span>
</span><a name="line-662"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331277"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-identifier">lintIdUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Unfolding</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-665"></a><a name="lintIdUnfolding"><a href="CoreLint.html#lintIdUnfolding"><span class="hs-identifier">lintIdUnfolding</span></a></a><span> </span><a name="local-6989586621679331290"><a href="#local-6989586621679331290"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679331291"><a href="#local-6989586621679331291"><span class="hs-identifier">bndr_ty</span></a></a><span> </span><a name="local-6989586621679331292"><a href="#local-6989586621679331292"><span class="hs-identifier">uf</span></a></a><span>
</span><a name="line-666"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isStableUnfolding</span><span> </span><a href="#local-6989586621679331292"><span class="hs-identifier hs-var">uf</span></a><span>
</span><a name="line-667"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331293"><a href="#local-6989586621679331293"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">maybeUnfoldingTemplate</span><span> </span><a href="#local-6989586621679331292"><span class="hs-identifier hs-var">uf</span></a><span>
</span><a name="line-668"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331294"><a href="#local-6989586621679331294"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintRhs"><span class="hs-identifier hs-var">lintRhs</span></a><span> </span><a href="#local-6989586621679331290"><span class="hs-identifier hs-var">bndr</span></a><span> </span><a href="#local-6989586621679331293"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-669"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331291"><span class="hs-identifier hs-var">bndr_ty</span></a><span> </span><a href="#local-6989586621679331294"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkRhsMsg"><span class="hs-identifier hs-var">mkRhsMsg</span></a><span> </span><a href="#local-6989586621679331290"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;unfolding&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331294"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-670"></a><span class="hs-identifier">lintIdUnfolding</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-671"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Do not Lint unstable unfoldings, because that leads</span><span>
</span><a name="line-672"></a><span>                    </span><span class="hs-comment">-- to exponential behaviour; c.f. CoreFVs.idUnfoldingVars</span><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span class="hs-comment">{-
Note [Checking for INLINE loop breakers]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's very suspicious if a strong loop breaker is marked INLINE.

However, the desugarer generates instance methods with INLINE pragmas
that form a mutually recursive group.  Only after a round of
simplification are they unravelled.  So we suppress the test for
the desugarer.

************************************************************************
*                                                                      *
\subsection[lintCoreExpr]{lintCoreExpr}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-690"></a><span>
</span><a name="line-691"></a><span class="hs-comment">-- For OutType, OutKind, the substitution has been applied,</span><span>
</span><a name="line-692"></a><span class="hs-comment">--                       but has not been linted yet</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-keyword">type</span><span> </span><a name="LintedType"><a href="CoreLint.html#LintedType"><span class="hs-identifier">LintedType</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-comment">-- Substitution applied, and type is linted</span><span>
</span><a name="line-695"></a><span class="hs-keyword">type</span><span> </span><a name="LintedKind"><a href="CoreLint.html#LintedKind"><span class="hs-identifier">LintedKind</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Kind</span><span>
</span><a name="line-696"></a><span>
</span><a name="line-697"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">OutType</span><span>
</span><a name="line-698"></a><span class="hs-comment">-- The returned type has the substitution from the monad</span><span>
</span><a name="line-699"></a><span class="hs-comment">-- already applied to it:</span><span>
</span><a name="line-700"></a><span class="hs-comment">--      lintCoreExpr e subst = exprType (subst e)</span><span>
</span><a name="line-701"></a><span class="hs-comment">--</span><span>
</span><a name="line-702"></a><span class="hs-comment">-- The returned &quot;type&quot; can be a kind, if the expression is (Type ty)</span><span>
</span><a name="line-703"></a><span>
</span><a name="line-704"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-705"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-706"></a><a name="lintCoreExpr"><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier">lintCoreExpr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><a name="local-6989586621679331295"><a href="#local-6989586621679331295"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-707"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintVarOcc"><span class="hs-identifier hs-var">lintVarOcc</span></a><span> </span><a href="#local-6989586621679331295"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><a name="local-6989586621679331296"><a href="#local-6989586621679331296"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">literalType</span><span> </span><a href="#local-6989586621679331296"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-711"></a><span>
</span><a name="line-712"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Cast</span><span> </span><a name="local-6989586621679331297"><a href="#local-6989586621679331297"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621679331298"><a href="#local-6989586621679331298"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331299"><a href="#local-6989586621679331299"><span class="hs-identifier">expr_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331297"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-714"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331300"><a href="#local-6989586621679331300"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#applySubstCo"><span class="hs-identifier hs-var">applySubstCo</span></a><span> </span><a href="#local-6989586621679331298"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-715"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331301"><a href="#local-6989586621679331301"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331302"><a href="#local-6989586621679331302"><span class="hs-identifier">from_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331303"><a href="#local-6989586621679331303"><span class="hs-identifier">to_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331304"><a href="#local-6989586621679331304"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331300"><span class="hs-identifier hs-var">co'</span></a><span>
</span><a name="line-716"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkValueKind"><span class="hs-identifier hs-var">checkValueKind</span></a><span> </span><a href="#local-6989586621679331301"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;target of cast&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331298"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331300"><span class="hs-identifier hs-var">co'</span></a><span> </span><span class="hs-identifier hs-var">Representational</span><span> </span><a href="#local-6989586621679331304"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-718"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331302"><span class="hs-identifier hs-var">from_ty</span></a><span> </span><a href="#local-6989586621679331299"><span class="hs-identifier hs-var">expr_ty</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkCastErr"><span class="hs-identifier hs-var">mkCastErr</span></a><span> </span><a href="#local-6989586621679331297"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621679331300"><span class="hs-identifier hs-var">co'</span></a><span> </span><a href="#local-6989586621679331302"><span class="hs-identifier hs-var">from_ty</span></a><span> </span><a href="#local-6989586621679331299"><span class="hs-identifier hs-var">expr_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-719"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679331303"><span class="hs-identifier hs-var">to_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-720"></a><span>
</span><a name="line-721"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Tick</span><span> </span><a name="local-6989586621679331305"><a href="#local-6989586621679331305"><span class="hs-identifier">tickish</span></a></a><span> </span><a name="local-6989586621679331306"><a href="#local-6989586621679331306"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-722"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679331305"><span class="hs-identifier hs-var">tickish</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-723"></a><span>         </span><span class="hs-identifier hs-var">Breakpoint</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679331308"><a href="#local-6989586621679331308"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621679331308"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679331309"><a href="#local-6989586621679331309"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-724"></a><span>                               </span><a href="CoreLint.html#checkDeadIdOcc"><span class="hs-identifier hs-var">checkDeadIdOcc</span></a><span> </span><a href="#local-6989586621679331309"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-725"></a><span>                               </span><a href="CoreLint.html#lookupIdInScope"><span class="hs-identifier hs-var">lookupIdInScope</span></a><span> </span><a href="#local-6989586621679331309"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-726"></a><span>         </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-727"></a><span>       </span><a href="CoreLint.html#markAllJoinsBadIf"><span class="hs-identifier hs-var">markAllJoinsBadIf</span></a><span> </span><a href="#local-6989586621679331307"><span class="hs-identifier hs-var">block_joins</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331306"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-728"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-729"></a><span>    </span><a name="local-6989586621679331307"><a href="#local-6989586621679331307"><span class="hs-identifier">block_joins</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331305"><span class="hs-identifier hs-var">tickish</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">tickishScopesLike</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">SoftScope</span><span class="hs-special">)</span><span>
</span><a name="line-730"></a><span>      </span><span class="hs-comment">-- TODO Consider whether this is the correct rule. It is consistent with</span><span>
</span><a name="line-731"></a><span>      </span><span class="hs-comment">-- the simplifier's behaviour - cost-centre-scoped ticks become part of</span><span>
</span><a name="line-732"></a><span>      </span><span class="hs-comment">-- the continuation, and thus they behave like part of an evaluation</span><span>
</span><a name="line-733"></a><span>      </span><span class="hs-comment">-- context, but soft-scoped and non-scoped ticks simply wrap the result</span><span>
</span><a name="line-734"></a><span>      </span><span class="hs-comment">-- (see Simplify.simplTick).</span><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NonRec</span><span> </span><a name="local-6989586621679331310"><a href="#local-6989586621679331310"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Type</span><span> </span><a name="local-6989586621679331311"><a href="#local-6989586621679331311"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679331312"><a href="#local-6989586621679331312"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-737"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTyVar</span><span> </span><a href="#local-6989586621679331310"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-738"></a><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- See Note [Linting type lets]</span><span>
</span><a name="line-739"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331313"><a href="#local-6989586621679331313"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#applySubstTy"><span class="hs-identifier hs-var">applySubstTy</span></a><span> </span><a href="#local-6989586621679331311"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-740"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintTyBndr"><span class="hs-identifier hs-var">lintTyBndr</span></a><span> </span><a href="#local-6989586621679331310"><span class="hs-identifier hs-var">tv</span></a><span>              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331314"><a href="#local-6989586621679331314"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-741"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#RhsOf"><span class="hs-identifier hs-var">RhsOf</span></a><span> </span><a href="#local-6989586621679331310"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintTyKind"><span class="hs-identifier hs-var">lintTyKind</span></a><span> </span><a href="#local-6989586621679331314"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621679331313"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-742"></a><span>                </span><span class="hs-comment">-- Now extend the substitution so we</span><span>
</span><a name="line-743"></a><span>                </span><span class="hs-comment">-- take advantage of it in the body</span><span>
</span><a name="line-744"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#extendSubstL"><span class="hs-identifier hs-var">extendSubstL</span></a><span> </span><a href="#local-6989586621679331310"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679331313"><span class="hs-identifier hs-var">ty'</span></a><span>        </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-745"></a><span>          </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#BodyOfLetRec"><span class="hs-identifier hs-var">BodyOfLetRec</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331310"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-746"></a><span>          </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331312"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-747"></a><span>
</span><a name="line-748"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NonRec</span><span> </span><a name="local-6989586621679331315"><a href="#local-6989586621679331315"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679331316"><a href="#local-6989586621679331316"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331317"><a href="#local-6989586621679331317"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-749"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isId</span><span> </span><a href="#local-6989586621679331315"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-750"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintSingleBinding"><span class="hs-identifier hs-var">lintSingleBinding</span></a><span> </span><span class="hs-identifier hs-var">NotTopLevel</span><span> </span><span class="hs-identifier hs-var">NonRecursive</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331315"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><a href="#local-6989586621679331316"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-751"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#BodyOfLetRec"><span class="hs-identifier hs-var">BodyOfLetRec</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331315"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-752"></a><span>                 </span><span class="hs-special">(</span><a href="CoreLint.html#lintBinder"><span class="hs-identifier hs-var">lintBinder</span></a><span> </span><span class="hs-identifier hs-var">LetBind</span><span> </span><a href="#local-6989586621679331315"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-753"></a><span>                  </span><a href="CoreLint.html#addGoodJoins"><span class="hs-identifier hs-var">addGoodJoins</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331315"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-754"></a><span>                  </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331317"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-757"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkLetErr"><span class="hs-identifier hs-var">mkLetErr</span></a><span> </span><a href="#local-6989586621679331315"><span class="hs-identifier hs-var">bndr</span></a><span> </span><a href="#local-6989586621679331316"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Not quite accurate</span><span>
</span><a name="line-758"></a><span>
</span><a name="line-759"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><a name="local-6989586621679331318"><a href="#local-6989586621679331318"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Rec</span><span> </span><a name="local-6989586621679331319"><a href="#local-6989586621679331319"><span class="hs-identifier">pairs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331320"><a href="#local-6989586621679331320"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintLetBndrs"><span class="hs-identifier hs-var">lintLetBndrs</span></a><span> </span><span class="hs-identifier hs-var">NotTopLevel</span><span> </span><a href="#local-6989586621679331321"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-761"></a><span>    </span><a href="CoreLint.html#addGoodJoins"><span class="hs-identifier hs-var">addGoodJoins</span></a><span> </span><a href="#local-6989586621679331321"><span class="hs-identifier hs-var">bndrs</span></a><span>             </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-762"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Check that the list of pairs is non-empty</span><span>
</span><a name="line-763"></a><span>          </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679331319"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#emptyRec"><span class="hs-identifier hs-var">emptyRec</span></a><span> </span><a href="#local-6989586621679331318"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span>          </span><span class="hs-comment">-- Check that there are no duplicated binders</span><span>
</span><a name="line-766"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679331322"><span class="hs-identifier hs-var">dups</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#dupVars"><span class="hs-identifier hs-var">dupVars</span></a><span> </span><a href="#local-6989586621679331322"><span class="hs-identifier hs-var">dups</span></a><span class="hs-special">)</span><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span>          </span><span class="hs-comment">-- Check that either all the binders are joins, or none</span><span>
</span><a name="line-769"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isJoinId</span><span> </span><a href="#local-6989586621679331321"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">isJoinId</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331321"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-770"></a><span>            </span><a href="CoreLint.html#mkInconsistentRecMsg"><span class="hs-identifier hs-var">mkInconsistentRecMsg</span></a><span> </span><a href="#local-6989586621679331321"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#lintSingleBinding"><span class="hs-identifier hs-var">lintSingleBinding</span></a><span> </span><span class="hs-identifier hs-var">NotTopLevel</span><span> </span><span class="hs-identifier hs-var">Recursive</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331319"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-773"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#BodyOfLetRec"><span class="hs-identifier hs-var">BodyOfLetRec</span></a><span> </span><a href="#local-6989586621679331321"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331320"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-774"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-775"></a><span>    </span><a name="local-6989586621679331321"><a href="#local-6989586621679331321"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679331319"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-776"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331322"><a href="#local-6989586621679331322"><span class="hs-identifier">dups</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">removeDups</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621679331321"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><a name="local-6989586621679331323"><a href="#local-6989586621679331323"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#AnExpr"><span class="hs-identifier hs-var">AnExpr</span></a><span> </span><a href="#local-6989586621679331323"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-780"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331326"><a href="#local-6989586621679331326"><span class="hs-identifier">fun_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoreFun"><span class="hs-identifier hs-var">lintCoreFun</span></a><span> </span><a href="#local-6989586621679331324"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679331325"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-781"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintCoreArgs"><span class="hs-identifier hs-var">lintCoreArgs</span></a><span> </span><a href="#local-6989586621679331326"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621679331325"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-782"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-783"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679331324"><a href="#local-6989586621679331324"><span class="hs-identifier">fun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331325"><a href="#local-6989586621679331325"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">collectArgs</span><span> </span><a href="#local-6989586621679331323"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-784"></a><span>
</span><a name="line-785"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lam</span><span> </span><a name="local-6989586621679331327"><a href="#local-6989586621679331327"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331328"><a href="#local-6989586621679331328"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-786"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LambdaBodyOf"><span class="hs-identifier hs-var">LambdaBodyOf</span></a><span> </span><a href="#local-6989586621679331327"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-787"></a><span>    </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-788"></a><span>    </span><a href="CoreLint.html#lintBinder"><span class="hs-identifier hs-var">lintBinder</span></a><span> </span><span class="hs-identifier hs-var">LambdaBind</span><span> </span><a href="#local-6989586621679331327"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331329"><a href="#local-6989586621679331329"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-789"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331330"><a href="#local-6989586621679331330"><span class="hs-identifier">body_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331328"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-790"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkLamType</span><span> </span><a href="#local-6989586621679331329"><span class="hs-identifier hs-var">var'</span></a><span> </span><a href="#local-6989586621679331330"><span class="hs-identifier hs-var">body_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-791"></a><span>
</span><a name="line-792"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><a name="local-6989586621679331331"><a href="#local-6989586621679331331"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Case</span><span> </span><a name="local-6989586621679331332"><a href="#local-6989586621679331332"><span class="hs-identifier">scrut</span></a></a><span> </span><a name="local-6989586621679331333"><a href="#local-6989586621679331333"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331334"><a href="#local-6989586621679331334"><span class="hs-identifier">alt_ty</span></a></a><span> </span><a name="local-6989586621679331335"><a href="#local-6989586621679331335"><span class="hs-identifier">alts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-793"></a><span>       </span><span class="hs-comment">-- Check the scrutinee</span><span>
</span><a name="line-794"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331336"><a href="#local-6989586621679331336"><span class="hs-identifier">scrut_diverges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">exprIsBottom</span><span> </span><a href="#local-6989586621679331332"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-795"></a><span>     </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331337"><a href="#local-6989586621679331337"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331332"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-796"></a><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331338"><a href="#local-6989586621679331338"><span class="hs-identifier">alt_ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintInTy"><span class="hs-identifier hs-var">lintInTy</span></a><span> </span><a href="#local-6989586621679331334"><span class="hs-identifier hs-var">alt_ty</span></a><span>
</span><a name="line-797"></a><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331339"><a href="#local-6989586621679331339"><span class="hs-identifier">var_ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintInTy"><span class="hs-identifier hs-var">lintInTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331333"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span>     </span><span class="hs-comment">-- We used to try to check whether a case expression with no</span><span>
</span><a name="line-800"></a><span>     </span><span class="hs-comment">-- alternatives was legitimate, but this didn't work.</span><span>
</span><a name="line-801"></a><span>     </span><span class="hs-comment">-- See Note [No alternatives lint check] for details.</span><span>
</span><a name="line-802"></a><span>
</span><a name="line-803"></a><span>     </span><span class="hs-comment">-- See Note [Rules for floating-point comparisons] in PrelRules</span><span>
</span><a name="line-804"></a><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331340"><a href="#local-6989586621679331340"><span class="hs-identifier">isLitPat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitAlt</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-805"></a><span>           </span><span class="hs-identifier">isLitPat</span><span> </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-806"></a><span>     </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">isFloatingTy</span><span> </span><a href="#local-6989586621679331337"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="#local-6989586621679331340"><span class="hs-identifier hs-var">isLitPat</span></a><span> </span><a href="#local-6989586621679331335"><span class="hs-identifier hs-var">alts</span></a><span class="hs-special">)</span><span>
</span><a name="line-807"></a><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Lint warning: Scrutinising floating-point &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-808"></a><span>                        </span><span class="hs-string">&quot;expression with literal pattern in case &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-809"></a><span>                        </span><span class="hs-string">&quot;analysis (see Trac #9238).&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>          </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;scrut&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331332"><span class="hs-identifier hs-var">scrut</span></a><span class="hs-special">)</span><span>
</span><a name="line-811"></a><span>
</span><a name="line-812"></a><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331333"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-813"></a><span>         </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331341"><a href="#local-6989586621679331341"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-814"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">debugIsOn</span><span>
</span><a name="line-815"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isAlgTyCon</span><span> </span><a href="#local-6989586621679331341"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-816"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isAbstractTyCon</span><span> </span><a href="#local-6989586621679331341"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-817"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621679331341"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-818"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679331336"><span class="hs-identifier hs-var">scrut_diverges</span></a><span>
</span><a name="line-819"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprTrace</span><span> </span><span class="hs-string">&quot;Lint warning: case binder's type has no constructors&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331333"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331333"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span>                        </span><span class="hs-comment">-- This can legitimately happen for type families</span><span>
</span><a name="line-821"></a><span>                      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span>         </span><a name="local-6989586621679331342"><a href="#local-6989586621679331342"><span class="hs-identifier">_otherwise</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-823"></a><span>
</span><a name="line-824"></a><span>        </span><span class="hs-comment">-- Don't use lintIdBndr on var, because unboxed tuple is legitimate</span><span>
</span><a name="line-825"></a><span>
</span><a name="line-826"></a><span>     </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331343"><a href="#local-6989586621679331343"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier hs-var">getTCvSubst</span></a><span>
</span><a name="line-827"></a><span>     </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331339"><span class="hs-identifier hs-var">var_ty</span></a><span> </span><a href="#local-6989586621679331337"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkScrutMsg"><span class="hs-identifier hs-var">mkScrutMsg</span></a><span> </span><a href="#local-6989586621679331333"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331339"><span class="hs-identifier hs-var">var_ty</span></a><span> </span><a href="#local-6989586621679331337"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><a href="#local-6989586621679331343"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span>
</span><a name="line-828"></a><span>
</span><a name="line-829"></a><span>     </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintBinder"><span class="hs-identifier hs-var">lintBinder</span></a><span> </span><span class="hs-identifier hs-var">CaseBind</span><span> </span><a href="#local-6989586621679331333"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-830"></a><span>       </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Check the alternatives</span><span>
</span><a name="line-831"></a><span>            </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#lintCoreAlt"><span class="hs-identifier hs-var">lintCoreAlt</span></a><span> </span><a href="#local-6989586621679331337"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><a href="#local-6989586621679331338"><span class="hs-identifier hs-var">alt_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331335"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-832"></a><span>          </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkCaseAlts"><span class="hs-identifier hs-var">checkCaseAlts</span></a><span> </span><a href="#local-6989586621679331331"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679331337"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><a href="#local-6989586621679331335"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-833"></a><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679331338"><span class="hs-identifier hs-var">alt_ty</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-834"></a><span>
</span><a name="line-835"></a><span class="hs-comment">-- This case can't happen; linting types in expressions gets routed through</span><span>
</span><a name="line-836"></a><span class="hs-comment">-- lintCoreArgs</span><span>
</span><a name="line-837"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Type</span><span> </span><a name="local-6989586621679331344"><a href="#local-6989586621679331344"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-838"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Type found as expression&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331344"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-839"></a><span>
</span><a name="line-840"></a><span class="hs-identifier">lintCoreExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Coercion</span><span> </span><a name="local-6989586621679331345"><a href="#local-6989586621679331345"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-841"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331346"><a href="#local-6989586621679331346"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331347"><a href="#local-6989586621679331347"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331348"><a href="#local-6989586621679331348"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331349"><a href="#local-6989586621679331349"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">role</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintInCo"><span class="hs-identifier hs-var">lintInCo</span></a><span> </span><a href="#local-6989586621679331345"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-842"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHeteroCoercionType</span><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679331346"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679331347"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679331348"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679331349"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-843"></a><span>
</span><a name="line-844"></a><span class="hs-comment">----------------------</span><span>
</span><a name="line-845"></a><span class="hs-identifier">lintVarOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- Number of arguments (type or value) being passed</span><span>
</span><a name="line-846"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-comment">-- returns type of the *variable*</span><span>
</span><a name="line-847"></a><a name="lintVarOcc"><a href="CoreLint.html#lintVarOcc"><span class="hs-identifier">lintVarOcc</span></a></a><span> </span><a name="local-6989586621679331351"><a href="#local-6989586621679331351"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331352"><a href="#local-6989586621679331352"><span class="hs-identifier">nargs</span></a></a><span>
</span><a name="line-848"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isNonCoVarId</span><span> </span><a href="#local-6989586621679331351"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-849"></a><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non term variable&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331351"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-850"></a><span>                 </span><span class="hs-comment">-- See CoreSyn Note [Variable occurrences in Core]</span><span>
</span><a name="line-851"></a><span>
</span><a name="line-852"></a><span>        </span><span class="hs-comment">-- Cneck that the type of the occurrence is the same</span><span>
</span><a name="line-853"></a><span>        </span><span class="hs-comment">-- as the type of the binding site</span><span>
</span><a name="line-854"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331353"><a href="#local-6989586621679331353"><span class="hs-identifier">ty</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#applySubstTy"><span class="hs-identifier hs-var">applySubstTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331351"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-855"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331354"><a href="#local-6989586621679331354"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lookupIdInScope"><span class="hs-identifier hs-var">lookupIdInScope</span></a><span> </span><a href="#local-6989586621679331351"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-856"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331355"><a href="#local-6989586621679331355"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331354"><span class="hs-identifier hs-var">var'</span></a><span>
</span><a name="line-857"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331353"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679331355"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#mkBndrOccTypeMismatchMsg"><span class="hs-identifier hs-var">mkBndrOccTypeMismatchMsg</span></a><span> </span><a href="#local-6989586621679331354"><span class="hs-identifier hs-var">var'</span></a><span> </span><a href="#local-6989586621679331351"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331355"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621679331353"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-858"></a><span>
</span><a name="line-859"></a><span>          </span><span class="hs-comment">-- Check for a nested occurrence of the StaticPtr constructor.</span><span>
</span><a name="line-860"></a><span>          </span><span class="hs-comment">-- See Note [Checking StaticPtrs].</span><span>
</span><a name="line-861"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331356"><a href="#local-6989586621679331356"><span class="hs-identifier">lf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getLintFlags"><span class="hs-identifier hs-var">getLintFlags</span></a><span>
</span><a name="line-862"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331352"><span class="hs-identifier hs-var">nargs</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">lf_check_static_ptrs</span><span> </span><a href="#local-6989586621679331356"><span class="hs-identifier hs-var">lf</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="CoreLint.html#AllowAnywhere"><span class="hs-identifier hs-var">AllowAnywhere</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-863"></a><span>            </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621679331351"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">makeStaticName</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-864"></a><span>              </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Found makeStatic nested in an expression&quot;</span><span>
</span><a name="line-865"></a><span>
</span><a name="line-866"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkDeadIdOcc"><span class="hs-identifier hs-var">checkDeadIdOcc</span></a><span> </span><a href="#local-6989586621679331351"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-867"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkJoinOcc"><span class="hs-identifier hs-var">checkJoinOcc</span></a><span> </span><a href="#local-6989586621679331351"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331352"><span class="hs-identifier hs-var">nargs</span></a><span>
</span><a name="line-868"></a><span>
</span><a name="line-869"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331354"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-870"></a><span>
</span><a name="line-871"></a><span class="hs-identifier">lintCoreFun</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span>
</span><a name="line-872"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>        </span><span class="hs-comment">-- Number of arguments (type or val) being passed</span><span>
</span><a name="line-873"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-comment">-- Returns type of the *function*</span><span>
</span><a name="line-874"></a><a name="lintCoreFun"><a href="CoreLint.html#lintCoreFun"><span class="hs-identifier">lintCoreFun</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><a name="local-6989586621679331357"><a href="#local-6989586621679331357"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331358"><a href="#local-6989586621679331358"><span class="hs-identifier">nargs</span></a></a><span>
</span><a name="line-875"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintVarOcc"><span class="hs-identifier hs-var">lintVarOcc</span></a><span> </span><a href="#local-6989586621679331357"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331358"><span class="hs-identifier hs-var">nargs</span></a><span>
</span><a name="line-876"></a><span>
</span><a name="line-877"></a><span class="hs-identifier">lintCoreFun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lam</span><span> </span><a name="local-6989586621679331359"><a href="#local-6989586621679331359"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331360"><a href="#local-6989586621679331360"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331361"><a href="#local-6989586621679331361"><span class="hs-identifier">nargs</span></a></a><span>
</span><a name="line-878"></a><span>  </span><span class="hs-comment">-- Act like lintCoreExpr of Lam, but *don't* call markAllJoinsBad; see</span><span>
</span><a name="line-879"></a><span>  </span><span class="hs-comment">-- Note [Beta redexes]</span><span>
</span><a name="line-880"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331361"><span class="hs-identifier hs-var">nargs</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-881"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LambdaBodyOf"><span class="hs-identifier hs-var">LambdaBodyOf</span></a><span> </span><a href="#local-6989586621679331359"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-882"></a><span>    </span><a href="CoreLint.html#lintBinder"><span class="hs-identifier hs-var">lintBinder</span></a><span> </span><span class="hs-identifier hs-var">LambdaBind</span><span> </span><a href="#local-6989586621679331359"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331362"><a href="#local-6989586621679331362"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-883"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331363"><a href="#local-6989586621679331363"><span class="hs-identifier">body_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoreFun"><span class="hs-identifier hs-var">lintCoreFun</span></a><span> </span><a href="#local-6989586621679331360"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331361"><span class="hs-identifier hs-var">nargs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-884"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkLamType</span><span> </span><a href="#local-6989586621679331362"><span class="hs-identifier hs-var">var'</span></a><span> </span><a href="#local-6989586621679331363"><span class="hs-identifier hs-var">body_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-885"></a><span>
</span><a name="line-886"></a><span class="hs-identifier">lintCoreFun</span><span> </span><a name="local-6989586621679331364"><a href="#local-6989586621679331364"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621679331365"><a href="#local-6989586621679331365"><span class="hs-identifier">nargs</span></a></a><span>
</span><a name="line-887"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#markAllJoinsBadIf"><span class="hs-identifier hs-var">markAllJoinsBadIf</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331365"><span class="hs-identifier hs-var">nargs</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-888"></a><span>    </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331364"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-889"></a><span>
</span><a name="line-890"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-891"></a><span class="hs-identifier">checkDeadIdOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-892"></a><span class="hs-comment">-- Occurrences of an Id should never be dead....</span><span>
</span><a name="line-893"></a><span class="hs-comment">-- except when we are checking a case pattern</span><span>
</span><a name="line-894"></a><a name="checkDeadIdOcc"><a href="CoreLint.html#checkDeadIdOcc"><span class="hs-identifier">checkDeadIdOcc</span></a></a><span> </span><a name="local-6989586621679331366"><a href="#local-6989586621679331366"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-895"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isDeadOcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idOccInfo</span><span> </span><a href="#local-6989586621679331366"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-896"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331367"><a href="#local-6989586621679331367"><span class="hs-identifier">in_case</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#inCasePat"><span class="hs-identifier hs-var">inCasePat</span></a><span>
</span><a name="line-897"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><a href="#local-6989586621679331367"><span class="hs-identifier hs-var">in_case</span></a><span>
</span><a name="line-898"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Occurrence of a dead Id&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331366"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-899"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-900"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-903"></a><span class="hs-identifier">checkJoinOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">JoinArity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-904"></a><span class="hs-comment">-- Check that if the occurrence is a JoinId, then so is the</span><span>
</span><a name="line-905"></a><span class="hs-comment">-- binding site, and it's a valid join Id</span><span>
</span><a name="line-906"></a><a name="checkJoinOcc"><a href="CoreLint.html#checkJoinOcc"><span class="hs-identifier">checkJoinOcc</span></a></a><span> </span><a name="local-6989586621679331368"><a href="#local-6989586621679331368"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331369"><a href="#local-6989586621679331369"><span class="hs-identifier">n_args</span></a></a><span>
</span><a name="line-907"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331370"><a href="#local-6989586621679331370"><span class="hs-identifier">join_arity_occ</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">isJoinId_maybe</span><span> </span><a href="#local-6989586621679331368"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-908"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331371"><a href="#local-6989586621679331371"><span class="hs-identifier">mb_join_arity_bndr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lookupJoinId"><span class="hs-identifier hs-var">lookupJoinId</span></a><span> </span><a href="#local-6989586621679331368"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-909"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679331371"><span class="hs-identifier hs-var">mb_join_arity_bndr</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-910"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Binder is not a join point</span><span>
</span><a name="line-911"></a><span>                      </span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#invalidJoinOcc"><span class="hs-identifier hs-var">invalidJoinOcc</span></a><span> </span><a href="#local-6989586621679331368"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-912"></a><span>
</span><a name="line-913"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331372"><a href="#local-6989586621679331372"><span class="hs-identifier">join_arity_bndr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-914"></a><span>
</span><a name="line-915"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331372"><span class="hs-identifier hs-var">join_arity_bndr</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679331370"><span class="hs-identifier hs-var">join_arity_occ</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-916"></a><span>           </span><span class="hs-comment">-- Arity differs at binding site and occurrence</span><span>
</span><a name="line-917"></a><span>         </span><a href="CoreLint.html#mkJoinBndrOccMismatchMsg"><span class="hs-identifier hs-var">mkJoinBndrOccMismatchMsg</span></a><span> </span><a href="#local-6989586621679331368"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331372"><span class="hs-identifier hs-var">join_arity_bndr</span></a><span> </span><a href="#local-6989586621679331370"><span class="hs-identifier hs-var">join_arity_occ</span></a><span>
</span><a name="line-918"></a><span>
</span><a name="line-919"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331369"><span class="hs-identifier hs-var">n_args</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679331370"><span class="hs-identifier hs-var">join_arity_occ</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-920"></a><span>           </span><span class="hs-comment">-- Arity doesn't match #args</span><span>
</span><a name="line-921"></a><span>         </span><a href="CoreLint.html#mkBadJumpMsg"><span class="hs-identifier hs-var">mkBadJumpMsg</span></a><span> </span><a href="#local-6989586621679331368"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331370"><span class="hs-identifier hs-var">join_arity_occ</span></a><span> </span><a href="#local-6989586621679331369"><span class="hs-identifier hs-var">n_args</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-922"></a><span>
</span><a name="line-923"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-924"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-925"></a><span>
</span><a name="line-926"></a><span class="hs-comment">{-
Note [No alternatives lint check]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Case expressions with no alternatives are odd beasts, and it would seem
like they would worth be looking at in the linter (cf Trac #10180). We
used to check two things:

* exprIsHNF is false: it would *seem* to be terribly wrong if
  the scrutinee was already in head normal form.

* exprIsBottom is true: we should be able to see why GHC believes the
  scrutinee is diverging for sure.

It was already known that the second test was not entirely reliable.
Unfortunately (Trac #13990), the first test turned out not to be reliable
either. Getting the checks right turns out to be somewhat complicated.

For example, suppose we have (comment 8)

  data T a where
    TInt :: T Int

  absurdTBool :: T Bool -&gt; a
  absurdTBool v = case v of

  data Foo = Foo !(T Bool)

  absurdFoo :: Foo -&gt; a
  absurdFoo (Foo x) = absurdTBool x

GHC initially accepts the empty case because of the GADT conditions. But then
we inline absurdTBool, getting

  absurdFoo (Foo x) = case x of

x is in normal form (because the Foo constructor is strict) but the
case is empty. To avoid this problem, GHC would have to recognize
that matching on Foo x is already absurd, which is not so easy.

More generally, we don't really know all the ways that GHC can
lose track of why an expression is bottom, so we shouldn't make too
much fuss when that happens.


Note [Beta redexes]
~~~~~~~~~~~~~~~~~~~
Consider:

  join j @x y z = ... in
  (\@x y z -&gt; jump j @x y z) @t e1 e2

This is clearly ill-typed, since the jump is inside both an application and a
lambda, either of which is enough to disqualify it as a tail call (see Note
[Invariants on join points] in CoreSyn). However, strictly from a
lambda-calculus perspective, the term doesn't go wrong---after the two beta
reductions, the jump *is* a tail call and everything is fine.

Why would we want to allow this when we have let? One reason is that a compound
beta redex (that is, one with more than one argument) has different scoping
rules: naively reducing the above example using lets will capture any free
occurrence of y in e2. More fundamentally, type lets are tricky; many passes,
such as Float Out, tacitly assume that the incoming program's type lets have
all been dealt with by the simplifier. Thus we don't want to let-bind any types
in, say, CoreSubst.simpleOptPgm, which in some circumstances can run immediately
before Float Out.

All that said, currently CoreSubst.simpleOptPgm is the only thing using this
loophole, doing so to avoid re-traversing large functions (beta-reducing a type
lambda without introducing a type let requires a substitution). TODO: Improve
simpleOptPgm so that we can forget all this ever happened.

************************************************************************
*                                                                      *
\subsection[lintCoreArgs]{lintCoreArgs}
*                                                                      *
************************************************************************

The basic version of these functions checks that the argument is a
subtype of the required type, as one would expect.
-}</span><span>
</span><a name="line-1006"></a><span>
</span><a name="line-1007"></a><span>
</span><a name="line-1008"></a><span class="hs-identifier">lintCoreArgs</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoreArg</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">OutType</span><span>
</span><a name="line-1009"></a><a name="lintCoreArgs"><a href="CoreLint.html#lintCoreArgs"><span class="hs-identifier">lintCoreArgs</span></a></a><span> </span><a name="local-6989586621679331373"><a href="#local-6989586621679331373"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621679331374"><a href="#local-6989586621679331374"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldM</span><span> </span><a href="CoreLint.html#lintCoreArg"><span class="hs-identifier hs-var">lintCoreArg</span></a><span> </span><a href="#local-6989586621679331373"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621679331374"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1010"></a><span>
</span><a name="line-1011"></a><span class="hs-identifier">lintCoreArg</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreArg</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">OutType</span><span>
</span><a name="line-1012"></a><a name="lintCoreArg"><a href="CoreLint.html#lintCoreArg"><span class="hs-identifier">lintCoreArg</span></a></a><span> </span><a name="local-6989586621679331375"><a href="#local-6989586621679331375"><span class="hs-identifier">fun_ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Type</span><span> </span><a name="local-6989586621679331376"><a href="#local-6989586621679331376"><span class="hs-identifier">arg_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1013"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isCoercionTy</span><span> </span><a href="#local-6989586621679331376"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1014"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Unnecessary coercion-to-type injection:&quot;</span><span>
</span><a name="line-1015"></a><span>                  </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331376"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1016"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331377"><a href="#local-6989586621679331377"><span class="hs-identifier">arg_ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#applySubstTy"><span class="hs-identifier hs-var">applySubstTy</span></a><span> </span><a href="#local-6989586621679331376"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1017"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintTyApp"><span class="hs-identifier hs-var">lintTyApp</span></a><span> </span><a href="#local-6989586621679331375"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621679331377"><span class="hs-identifier hs-var">arg_ty'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1018"></a><span>
</span><a name="line-1019"></a><span class="hs-identifier">lintCoreArg</span><span> </span><a name="local-6989586621679331378"><a href="#local-6989586621679331378"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621679331379"><a href="#local-6989586621679331379"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-1020"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331380"><a href="#local-6989586621679331380"><span class="hs-identifier">arg_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331379"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1021"></a><span>           </span><span class="hs-comment">-- See Note [Levity polymorphism invariants] in CoreSyn</span><span>
</span><a name="line-1022"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isTypeLevPoly</span><span> </span><a href="#local-6989586621679331380"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1023"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Levity-polymorphic argument:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-1024"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331379"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">parens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331380"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331380"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1025"></a><span>          </span><span class="hs-comment">-- check for levity polymorphism first, because otherwise isUnliftedType panics</span><span>
</span><a name="line-1026"></a><span>
</span><a name="line-1027"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isUnliftedType</span><span> </span><a href="#local-6989586621679331380"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">exprOkForSpeculation</span><span> </span><a href="#local-6989586621679331379"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1028"></a><span>                </span><span class="hs-special">(</span><a href="CoreLint.html#mkLetAppMsg"><span class="hs-identifier hs-var">mkLetAppMsg</span></a><span> </span><a href="#local-6989586621679331379"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1029"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintValApp"><span class="hs-identifier hs-var">lintValApp</span></a><span> </span><a href="#local-6989586621679331379"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679331378"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621679331380"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1030"></a><span>
</span><a name="line-1031"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1032"></a><span class="hs-identifier">lintAltBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutType</span><span>     </span><span class="hs-comment">-- Scrutinee type</span><span>
</span><a name="line-1033"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span>     </span><span class="hs-comment">-- Constructor type</span><span>
</span><a name="line-1034"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">OutVar</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Binders</span><span>
</span><a name="line-1035"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1036"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1037"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1038"></a><a name="lintAltBinders"><a href="CoreLint.html#lintAltBinders"><span class="hs-identifier">lintAltBinders</span></a></a><span> </span><a name="local-6989586621679331381"><a href="#local-6989586621679331381"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><a name="local-6989586621679331382"><a href="#local-6989586621679331382"><span class="hs-identifier">con_ty</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1039"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331382"><span class="hs-identifier hs-var">con_ty</span></a><span> </span><a href="#local-6989586621679331381"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkBadPatMsg"><span class="hs-identifier hs-var">mkBadPatMsg</span></a><span> </span><a href="#local-6989586621679331382"><span class="hs-identifier hs-var">con_ty</span></a><span> </span><a href="#local-6989586621679331381"><span class="hs-identifier hs-var">scrut_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1040"></a><span class="hs-identifier">lintAltBinders</span><span> </span><a name="local-6989586621679331383"><a href="#local-6989586621679331383"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><a name="local-6989586621679331384"><a href="#local-6989586621679331384"><span class="hs-identifier">con_ty</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331385"><a href="#local-6989586621679331385"><span class="hs-identifier">bndr</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679331386"><a href="#local-6989586621679331386"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1041"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTyVar</span><span> </span><a href="#local-6989586621679331385"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-1042"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331387"><a href="#local-6989586621679331387"><span class="hs-identifier">con_ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintTyApp"><span class="hs-identifier hs-var">lintTyApp</span></a><span> </span><a href="#local-6989586621679331384"><span class="hs-identifier hs-var">con_ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarTy</span><span> </span><a href="#local-6989586621679331385"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1043"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintAltBinders"><span class="hs-identifier hs-var">lintAltBinders</span></a><span> </span><a href="#local-6989586621679331383"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><a href="#local-6989586621679331387"><span class="hs-identifier hs-var">con_ty'</span></a><span> </span><a href="#local-6989586621679331386"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1044"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1045"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331388"><a href="#local-6989586621679331388"><span class="hs-identifier">con_ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintValApp"><span class="hs-identifier hs-var">lintValApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><a href="#local-6989586621679331385"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331384"><span class="hs-identifier hs-var">con_ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331385"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1046"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintAltBinders"><span class="hs-identifier hs-var">lintAltBinders</span></a><span> </span><a href="#local-6989586621679331383"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><a href="#local-6989586621679331388"><span class="hs-identifier hs-var">con_ty'</span></a><span> </span><a href="#local-6989586621679331386"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1047"></a><span>
</span><a name="line-1048"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1049"></a><span class="hs-identifier">lintTyApp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">OutType</span><span>
</span><a name="line-1050"></a><a name="lintTyApp"><a href="CoreLint.html#lintTyApp"><span class="hs-identifier">lintTyApp</span></a></a><span> </span><a name="local-6989586621679331389"><a href="#local-6989586621679331389"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621679331390"><a href="#local-6989586621679331390"><span class="hs-identifier">arg_ty</span></a></a><span>
</span><a name="line-1051"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331391"><a href="#local-6989586621679331391"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331392"><a href="#local-6989586621679331392"><span class="hs-identifier">body_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">splitForAllTy_maybe</span><span> </span><a href="#local-6989586621679331389"><span class="hs-identifier hs-var">fun_ty</span></a><span>
</span><a name="line-1052"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintTyKind"><span class="hs-identifier hs-var">lintTyKind</span></a><span> </span><a href="#local-6989586621679331391"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679331390"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1053"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331393"><a href="#local-6989586621679331393"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getInScope"><span class="hs-identifier hs-var">getInScope</span></a><span>
</span><a name="line-1054"></a><span>        </span><span class="hs-comment">-- substTy needs the set of tyvars in scope to avoid generating</span><span>
</span><a name="line-1055"></a><span>        </span><span class="hs-comment">-- uniques that are already in scope.</span><span>
</span><a name="line-1056"></a><span>        </span><span class="hs-comment">-- See Note [The substitution invariant] in TyCoRep</span><span>
</span><a name="line-1057"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">substTyWithInScope</span><span> </span><a href="#local-6989586621679331393"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331391"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331390"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679331392"><span class="hs-identifier hs-var">body_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1058"></a><span>
</span><a name="line-1059"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1060"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkTyAppMsg"><span class="hs-identifier hs-var">mkTyAppMsg</span></a><span> </span><a href="#local-6989586621679331389"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621679331390"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1061"></a><span>
</span><a name="line-1062"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1063"></a><span class="hs-identifier">lintValApp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">OutType</span><span>
</span><a name="line-1064"></a><a name="lintValApp"><a href="CoreLint.html#lintValApp"><span class="hs-identifier">lintValApp</span></a></a><span> </span><a name="local-6989586621679331394"><a href="#local-6989586621679331394"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679331395"><a href="#local-6989586621679331395"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621679331396"><a href="#local-6989586621679331396"><span class="hs-identifier">arg_ty</span></a></a><span>
</span><a name="line-1065"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331399"><a href="#local-6989586621679331399"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331400"><a href="#local-6989586621679331400"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">splitFunTy_maybe</span><span> </span><a href="#local-6989586621679331395"><span class="hs-identifier hs-var">fun_ty</span></a><span>
</span><a name="line-1066"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331399"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621679331396"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-6989586621679331397"><span class="hs-identifier hs-var">err1</span></a><span>
</span><a name="line-1067"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679331400"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1068"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1069"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><a href="#local-6989586621679331398"><span class="hs-identifier hs-var">err2</span></a><span>
</span><a name="line-1070"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1071"></a><span>    </span><a name="local-6989586621679331397"><a href="#local-6989586621679331397"><span class="hs-identifier">err1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#mkAppMsg"><span class="hs-identifier hs-var">mkAppMsg</span></a><span>       </span><a href="#local-6989586621679331395"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621679331396"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-6989586621679331394"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1072"></a><span>    </span><a name="local-6989586621679331398"><a href="#local-6989586621679331398"><span class="hs-identifier">err2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#mkNonFunAppMsg"><span class="hs-identifier hs-var">mkNonFunAppMsg</span></a><span> </span><a href="#local-6989586621679331395"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621679331396"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-6989586621679331394"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1073"></a><span>
</span><a name="line-1074"></a><span class="hs-identifier">lintTyKind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutTyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1075"></a><span class="hs-comment">-- Both args have had substitution applied</span><span>
</span><a name="line-1076"></a><span>
</span><a name="line-1077"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1078"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1079"></a><a name="lintTyKind"><a href="CoreLint.html#lintTyKind"><span class="hs-identifier">lintTyKind</span></a></a><span> </span><a name="local-6989586621679331401"><a href="#local-6989586621679331401"><span class="hs-identifier">tyvar</span></a></a><span> </span><a name="local-6989586621679331402"><a href="#local-6989586621679331402"><span class="hs-identifier">arg_ty</span></a></a><span>
</span><a name="line-1080"></a><span>        </span><span class="hs-comment">-- Arg type might be boxed for a function with an uncommitted</span><span>
</span><a name="line-1081"></a><span>        </span><span class="hs-comment">-- tyvar; notably this is used so that we can give</span><span>
</span><a name="line-1082"></a><span>        </span><span class="hs-comment">--      error :: forall a:*. String -&gt; a</span><span>
</span><a name="line-1083"></a><span>        </span><span class="hs-comment">-- and then apply it to both boxed and unboxed types.</span><span>
</span><a name="line-1084"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331404"><a href="#local-6989586621679331404"><span class="hs-identifier">arg_kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331402"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1085"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331404"><span class="hs-identifier hs-var">arg_kind</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331403"><span class="hs-identifier hs-var">tyvar_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1086"></a><span>                </span><span class="hs-special">(</span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkKindErrMsg"><span class="hs-identifier hs-var">mkKindErrMsg</span></a><span> </span><a href="#local-6989586621679331401"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="#local-6989586621679331402"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Linted Arg kind:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331404"><span class="hs-identifier hs-var">arg_kind</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1087"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1088"></a><span>    </span><a name="local-6989586621679331403"><a href="#local-6989586621679331403"><span class="hs-identifier">tyvar_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621679331401"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-1089"></a><span>
</span><a name="line-1090"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[lintCoreAlts]{lintCoreAlts}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1097"></a><span>
</span><a name="line-1098"></a><span class="hs-identifier">checkCaseAlts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoreAlt</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1099"></a><span class="hs-comment">-- a) Check that the alts are non-empty</span><span>
</span><a name="line-1100"></a><span class="hs-comment">-- b1) Check that the DEFAULT comes first, if it exists</span><span>
</span><a name="line-1101"></a><span class="hs-comment">-- b2) Check that the others are in increasing order</span><span>
</span><a name="line-1102"></a><span class="hs-comment">-- c) Check that there's a default for infinite types</span><span>
</span><a name="line-1103"></a><span class="hs-comment">-- NB: Algebraic cases are not necessarily exhaustive, because</span><span>
</span><a name="line-1104"></a><span class="hs-comment">--     the simplifier correctly eliminates case that can't</span><span>
</span><a name="line-1105"></a><span class="hs-comment">--     possibly match.</span><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><a name="checkCaseAlts"><a href="CoreLint.html#checkCaseAlts"><span class="hs-identifier">checkCaseAlts</span></a></a><span> </span><a name="local-6989586621679331405"><a href="#local-6989586621679331405"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679331406"><a href="#local-6989586621679331406"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679331407"><a href="#local-6989586621679331407"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1108"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">all</span><span> </span><a href="#local-6989586621679331411"><span class="hs-identifier hs-var">non_deflt</span></a><span> </span><a href="#local-6989586621679331408"><span class="hs-identifier hs-var">con_alts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkNonDefltMsg"><span class="hs-identifier hs-var">mkNonDefltMsg</span></a><span> </span><a href="#local-6989586621679331405"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1109"></a><span>     </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331410"><span class="hs-identifier hs-var">increasing_tag</span></a><span> </span><a href="#local-6989586621679331408"><span class="hs-identifier hs-var">con_alts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkNonIncreasingAltsMsg"><span class="hs-identifier hs-var">mkNonIncreasingAltsMsg</span></a><span> </span><a href="#local-6989586621679331405"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1110"></a><span>
</span><a name="line-1111"></a><span>          </span><span class="hs-comment">-- For types Int#, Word# with an infinite (well, large!) number of</span><span>
</span><a name="line-1112"></a><span>          </span><span class="hs-comment">-- possible values, there should usually be a DEFAULT case</span><span>
</span><a name="line-1113"></a><span>          </span><span class="hs-comment">-- But (see Note [Empty case alternatives] in CoreSyn) it's ok to</span><span>
</span><a name="line-1114"></a><span>          </span><span class="hs-comment">-- have *no* case alternatives.</span><span>
</span><a name="line-1115"></a><span>          </span><span class="hs-comment">-- In effect, this is a kind of partial test. I suppose it's possible</span><span>
</span><a name="line-1116"></a><span>          </span><span class="hs-comment">-- that we might *know* that 'x' was 1 or 2, in which case</span><span>
</span><a name="line-1117"></a><span>          </span><span class="hs-comment">--   case x of { 1 -&gt; e1; 2 -&gt; e2 }</span><span>
</span><a name="line-1118"></a><span>          </span><span class="hs-comment">-- would be fine.</span><span>
</span><a name="line-1119"></a><span>     </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJust</span><span> </span><a href="#local-6989586621679331409"><span class="hs-identifier hs-var">maybe_deflt</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679331412"><span class="hs-identifier hs-var">is_infinite_ty</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679331407"><span class="hs-identifier hs-var">alts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1120"></a><span>              </span><span class="hs-special">(</span><a href="CoreLint.html#nonExhaustiveAltsMsg"><span class="hs-identifier hs-var">nonExhaustiveAltsMsg</span></a><span> </span><a href="#local-6989586621679331405"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1121"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1122"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679331408"><a href="#local-6989586621679331408"><span class="hs-identifier">con_alts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331409"><a href="#local-6989586621679331409"><span class="hs-identifier">maybe_deflt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">findDefault</span><span> </span><a href="#local-6989586621679331407"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-1123"></a><span>
</span><a name="line-1124"></a><span>        </span><span class="hs-comment">-- Check that successive alternatives have strictly increasing tags</span><span>
</span><a name="line-1125"></a><span>    </span><a name="local-6989586621679331410"><a href="#local-6989586621679331410"><span class="hs-identifier">increasing_tag</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331413"><a href="#local-6989586621679331413"><span class="hs-identifier">alt1</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679331414"><a href="#local-6989586621679331414"><span class="hs-identifier">rest</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span> </span><a name="local-6989586621679331415"><a href="#local-6989586621679331415"><span class="hs-identifier">alt2</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331413"><span class="hs-identifier hs-var">alt1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">ltAlt</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331415"><span class="hs-identifier hs-var">alt2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679331410"><span class="hs-identifier hs-var">increasing_tag</span></a><span> </span><a href="#local-6989586621679331414"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-1126"></a><span>    </span><span class="hs-identifier">increasing_tag</span><span> </span><span class="hs-identifier">_</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1127"></a><span>
</span><a name="line-1128"></a><span>    </span><a name="local-6989586621679331411"><a href="#local-6989586621679331411"><span class="hs-identifier">non_deflt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DEFAULT</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1129"></a><span>    </span><span class="hs-identifier">non_deflt</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1130"></a><span>
</span><a name="line-1131"></a><span>    </span><a name="local-6989586621679331412"><a href="#local-6989586621679331412"><span class="hs-identifier">is_infinite_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span><span> </span><a href="#local-6989586621679331406"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1132"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1133"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331416"><a href="#local-6989586621679331416"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">isPrimTyCon</span><span> </span><a href="#local-6989586621679331416"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1134"></a><span>
</span><a name="line-1135"></a><span class="hs-identifier">lintAltExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1136"></a><a name="lintAltExpr"><a href="CoreLint.html#lintAltExpr"><span class="hs-identifier">lintAltExpr</span></a></a><span> </span><a name="local-6989586621679331417"><a href="#local-6989586621679331417"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621679331418"><a href="#local-6989586621679331418"><span class="hs-identifier">ann_ty</span></a></a><span>
</span><a name="line-1137"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331419"><a href="#local-6989586621679331419"><span class="hs-identifier">actual_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331417"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1138"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331419"><span class="hs-identifier hs-var">actual_ty</span></a><span> </span><a href="#local-6989586621679331418"><span class="hs-identifier hs-var">ann_ty</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkCaseAltMsg"><span class="hs-identifier hs-var">mkCaseAltMsg</span></a><span> </span><a href="#local-6989586621679331417"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621679331419"><span class="hs-identifier hs-var">actual_ty</span></a><span> </span><a href="#local-6989586621679331418"><span class="hs-identifier hs-var">ann_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1139"></a><span>
</span><a name="line-1140"></a><span class="hs-identifier">lintCoreAlt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutType</span><span>          </span><span class="hs-comment">-- Type of scrutinee</span><span>
</span><a name="line-1141"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span>          </span><span class="hs-comment">-- Type of the alternative</span><span>
</span><a name="line-1142"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreAlt</span><span>
</span><a name="line-1143"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1144"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1145"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1146"></a><a name="lintCoreAlt"><a href="CoreLint.html#lintCoreAlt"><span class="hs-identifier">lintCoreAlt</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679331420"><a href="#local-6989586621679331420"><span class="hs-identifier">alt_ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DEFAULT</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331421"><a href="#local-6989586621679331421"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331422"><a href="#local-6989586621679331422"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1147"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679331421"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkDefaultArgsMsg"><span class="hs-identifier hs-var">mkDefaultArgsMsg</span></a><span> </span><a href="#local-6989586621679331421"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1148"></a><span>     </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintAltExpr"><span class="hs-identifier hs-var">lintAltExpr</span></a><span> </span><a href="#local-6989586621679331422"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-6989586621679331420"><span class="hs-identifier hs-var">alt_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1149"></a><span>
</span><a name="line-1150"></a><span class="hs-identifier">lintCoreAlt</span><span> </span><a name="local-6989586621679331423"><a href="#local-6989586621679331423"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><a name="local-6989586621679331424"><a href="#local-6989586621679331424"><span class="hs-identifier">alt_ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitAlt</span><span> </span><a name="local-6989586621679331425"><a href="#local-6989586621679331425"><span class="hs-identifier">lit</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331426"><a href="#local-6989586621679331426"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331427"><a href="#local-6989586621679331427"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1151"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">litIsLifted</span><span> </span><a href="#local-6989586621679331425"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1152"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><a href="CoreLint.html#integerScrutinisedMsg"><span class="hs-identifier hs-var">integerScrutinisedMsg</span></a><span>
</span><a name="line-1153"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1154"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679331426"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkDefaultArgsMsg"><span class="hs-identifier hs-var">mkDefaultArgsMsg</span></a><span> </span><a href="#local-6989586621679331426"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1155"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331428"><span class="hs-identifier hs-var">lit_ty</span></a><span> </span><a href="#local-6989586621679331423"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkBadPatMsg"><span class="hs-identifier hs-var">mkBadPatMsg</span></a><span> </span><a href="#local-6989586621679331428"><span class="hs-identifier hs-var">lit_ty</span></a><span> </span><a href="#local-6989586621679331423"><span class="hs-identifier hs-var">scrut_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1156"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintAltExpr"><span class="hs-identifier hs-var">lintAltExpr</span></a><span> </span><a href="#local-6989586621679331427"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-6989586621679331424"><span class="hs-identifier hs-var">alt_ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1157"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1158"></a><span>    </span><a name="local-6989586621679331428"><a href="#local-6989586621679331428"><span class="hs-identifier">lit_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">literalType</span><span> </span><a href="#local-6989586621679331425"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1159"></a><span>
</span><a name="line-1160"></a><span class="hs-identifier">lintCoreAlt</span><span> </span><a name="local-6989586621679331429"><a href="#local-6989586621679331429"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><a name="local-6989586621679331430"><a href="#local-6989586621679331430"><span class="hs-identifier">alt_ty</span></a></a><span> </span><a name="local-6989586621679331431"><a href="#local-6989586621679331431"><span class="hs-identifier">alt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataAlt</span><span> </span><a name="local-6989586621679331432"><a href="#local-6989586621679331432"><span class="hs-identifier">con</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331433"><a href="#local-6989586621679331433"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331434"><a href="#local-6989586621679331434"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1161"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNewTyCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConTyCon</span><span> </span><a href="#local-6989586621679331432"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-1162"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkNewTyDataConAltMsg"><span class="hs-identifier hs-var">mkNewTyDataConAltMsg</span></a><span> </span><a href="#local-6989586621679331429"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><a href="#local-6989586621679331431"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1163"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331435"><a href="#local-6989586621679331435"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331436"><a href="#local-6989586621679331436"><span class="hs-identifier">tycon_arg_tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">splitTyConApp_maybe</span><span> </span><a href="#local-6989586621679331429"><span class="hs-identifier hs-var">scrut_ty</span></a><span>
</span><a name="line-1164"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a><span> </span><a href="#local-6989586621679331431"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>  </span><span class="hs-keyword">do</span><span>
</span><a name="line-1165"></a><span>    </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- First instantiate the universally quantified</span><span>
</span><a name="line-1166"></a><span>        </span><span class="hs-comment">-- type variables of the data constructor</span><span>
</span><a name="line-1167"></a><span>        </span><span class="hs-comment">-- We've already check</span><span>
</span><a name="line-1168"></a><span>      </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331435"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">dataConTyCon</span><span> </span><a href="#local-6989586621679331432"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkBadConMsg"><span class="hs-identifier hs-var">mkBadConMsg</span></a><span> </span><a href="#local-6989586621679331435"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621679331432"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-1169"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331437"><a href="#local-6989586621679331437"><span class="hs-identifier">con_payload_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">piResultTys</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConRepType</span><span> </span><a href="#local-6989586621679331432"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331436"><span class="hs-identifier hs-var">tycon_arg_tys</span></a><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span>        </span><span class="hs-comment">-- And now bring the new binders into scope</span><span>
</span><a name="line-1172"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintBinders"><span class="hs-identifier hs-var">lintBinders</span></a><span> </span><span class="hs-identifier hs-var">CasePatBind</span><span> </span><a href="#local-6989586621679331433"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331438"><a href="#local-6989586621679331438"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1173"></a><span>    </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#CasePat"><span class="hs-identifier hs-var">CasePat</span></a><span> </span><a href="#local-6989586621679331431"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#lintAltBinders"><span class="hs-identifier hs-var">lintAltBinders</span></a><span> </span><a href="#local-6989586621679331429"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><a href="#local-6989586621679331437"><span class="hs-identifier hs-var">con_payload_ty</span></a><span> </span><a href="#local-6989586621679331438"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1174"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintAltExpr"><span class="hs-identifier hs-var">lintAltExpr</span></a><span> </span><a href="#local-6989586621679331434"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-6989586621679331430"><span class="hs-identifier hs-var">alt_ty</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1175"></a><span>
</span><a name="line-1176"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-comment">-- Scrut-ty is wrong shape</span><span>
</span><a name="line-1177"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkBadAltMsg"><span class="hs-identifier hs-var">mkBadAltMsg</span></a><span> </span><a href="#local-6989586621679331429"><span class="hs-identifier hs-var">scrut_ty</span></a><span> </span><a href="#local-6989586621679331431"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1178"></a><span>
</span><a name="line-1179"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[lint-types]{Types}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1186"></a><span>
</span><a name="line-1187"></a><span class="hs-comment">-- When we lint binders, we (one at a time and in order):</span><span>
</span><a name="line-1188"></a><span class="hs-comment">--  1. Lint var types or kinds (possibly substituting)</span><span>
</span><a name="line-1189"></a><span class="hs-comment">--  2. Add the binder to the in scope set, and if its a coercion var,</span><span>
</span><a name="line-1190"></a><span class="hs-comment">--     we may extend the substitution to reflect its (possibly) new kind</span><span>
</span><a name="line-1191"></a><span class="hs-identifier">lintBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BindingSite</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330374"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330374"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1192"></a><a name="lintBinders"><a href="CoreLint.html#lintBinders"><span class="hs-identifier">lintBinders</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><a name="local-6989586621679331439"><a href="#local-6989586621679331439"><span class="hs-identifier">linterF</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331439"><span class="hs-identifier hs-var">linterF</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1193"></a><span class="hs-identifier">lintBinders</span><span> </span><a name="local-6989586621679331440"><a href="#local-6989586621679331440"><span class="hs-identifier">site</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331441"><a href="#local-6989586621679331441"><span class="hs-identifier">var</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679331442"><a href="#local-6989586621679331442"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331443"><a href="#local-6989586621679331443"><span class="hs-identifier">linterF</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintBinder"><span class="hs-identifier hs-var">lintBinder</span></a><span> </span><a href="#local-6989586621679331440"><span class="hs-identifier hs-var">site</span></a><span> </span><a href="#local-6989586621679331441"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679331444"><a href="#local-6989586621679331444"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1194"></a><span>                                      </span><a href="CoreLint.html#lintBinders"><span class="hs-identifier hs-var">lintBinders</span></a><span> </span><a href="#local-6989586621679331440"><span class="hs-identifier hs-var">site</span></a><span> </span><a href="#local-6989586621679331442"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331445"><a href="#local-6989586621679331445"><span class="hs-identifier">vars'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1195"></a><span>                                      </span><a href="#local-6989586621679331443"><span class="hs-identifier hs-var">linterF</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331444"><span class="hs-identifier hs-var">var'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679331445"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1196"></a><span>
</span><a name="line-1197"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1198"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1199"></a><span class="hs-identifier">lintBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BindingSite</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330373"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330373"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1200"></a><a name="lintBinder"><a href="CoreLint.html#lintBinder"><span class="hs-identifier">lintBinder</span></a></a><span> </span><a name="local-6989586621679331446"><a href="#local-6989586621679331446"><span class="hs-identifier">site</span></a></a><span> </span><a name="local-6989586621679331447"><a href="#local-6989586621679331447"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331448"><a href="#local-6989586621679331448"><span class="hs-identifier">linterF</span></a></a><span>
</span><a name="line-1201"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTyVar</span><span> </span><a href="#local-6989586621679331447"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintTyBndr"><span class="hs-identifier hs-var">lintTyBndr</span></a><span>                  </span><a href="#local-6989586621679331447"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331448"><span class="hs-identifier hs-var">linterF</span></a><span>
</span><a name="line-1202"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isCoVar</span><span> </span><a href="#local-6989586621679331447"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintCoBndr"><span class="hs-identifier hs-var">lintCoBndr</span></a><span>                  </span><a href="#local-6989586621679331447"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331448"><span class="hs-identifier hs-var">linterF</span></a><span>
</span><a name="line-1203"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintIdBndr"><span class="hs-identifier hs-var">lintIdBndr</span></a><span> </span><span class="hs-identifier hs-var">NotTopLevel</span><span> </span><a href="#local-6989586621679331446"><span class="hs-identifier hs-var">site</span></a><span> </span><a href="#local-6989586621679331447"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621679331448"><span class="hs-identifier hs-var">linterF</span></a><span>
</span><a name="line-1204"></a><span>
</span><a name="line-1205"></a><span class="hs-identifier">lintTyBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">InTyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OutTyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330372"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330372"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1206"></a><a name="lintTyBndr"><a href="CoreLint.html#lintTyBndr"><span class="hs-identifier">lintTyBndr</span></a></a><span> </span><a name="local-6989586621679331449"><a href="#local-6989586621679331449"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679331450"><a href="#local-6989586621679331450"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1207"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331451"><a href="#local-6989586621679331451"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier hs-var">getTCvSubst</span></a><span>
</span><a name="line-1208"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331452"><a href="#local-6989586621679331452"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331453"><a href="#local-6989586621679331453"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTyVarBndr</span><span> </span><a href="#local-6989586621679331451"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679331449"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1209"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintKind"><span class="hs-identifier hs-var">lintKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331453"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1210"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#updateTCvSubst"><span class="hs-identifier hs-var">updateTCvSubst</span></a><span> </span><a href="#local-6989586621679331452"><span class="hs-identifier hs-var">subst'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331450"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621679331453"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1211"></a><span>
</span><a name="line-1212"></a><span class="hs-identifier">lintCoBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">InCoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OutCoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330371"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330371"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1213"></a><a name="lintCoBndr"><a href="CoreLint.html#lintCoBndr"><span class="hs-identifier">lintCoBndr</span></a></a><span> </span><a name="local-6989586621679331454"><a href="#local-6989586621679331454"><span class="hs-identifier">cv</span></a></a><span> </span><a name="local-6989586621679331455"><a href="#local-6989586621679331455"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1214"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331456"><a href="#local-6989586621679331456"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier hs-var">getTCvSubst</span></a><span>
</span><a name="line-1215"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331457"><a href="#local-6989586621679331457"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331458"><a href="#local-6989586621679331458"><span class="hs-identifier">cv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substCoVarBndr</span><span> </span><a href="#local-6989586621679331456"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679331454"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-1216"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintKind"><span class="hs-identifier hs-var">lintKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331458"><span class="hs-identifier hs-var">cv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isCoVarType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331458"><span class="hs-identifier hs-var">cv'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1218"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;CoVar with non-coercion type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprTyVar</span><span> </span><a href="#local-6989586621679331454"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1219"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#updateTCvSubst"><span class="hs-identifier hs-var">updateTCvSubst</span></a><span> </span><a href="#local-6989586621679331457"><span class="hs-identifier hs-var">subst'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331455"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621679331458"><span class="hs-identifier hs-var">cv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1220"></a><span>
</span><a name="line-1221"></a><span class="hs-identifier">lintLetBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TopLevelFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330370"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330370"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1222"></a><a name="lintLetBndrs"><a href="CoreLint.html#lintLetBndrs"><span class="hs-identifier">lintLetBndrs</span></a></a><span> </span><a name="local-6989586621679331459"><a href="#local-6989586621679331459"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-6989586621679331460"><a href="#local-6989586621679331460"><span class="hs-identifier">ids</span></a></a><span> </span><a name="local-6989586621679331461"><a href="#local-6989586621679331461"><span class="hs-identifier">linterF</span></a></a><span>
</span><a name="line-1223"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331462"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679331460"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-1224"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1225"></a><span>    </span><a name="local-6989586621679331462"><a href="#local-6989586621679331462"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331461"><span class="hs-identifier hs-var">linterF</span></a><span>
</span><a name="line-1226"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331463"><a href="#local-6989586621679331463"><span class="hs-identifier">id</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679331464"><a href="#local-6989586621679331464"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintIdBndr"><span class="hs-identifier hs-var">lintIdBndr</span></a><span> </span><a href="#local-6989586621679331459"><span class="hs-identifier hs-var">top_lvl</span></a><span> </span><span class="hs-identifier hs-var">LetBind</span><span> </span><a href="#local-6989586621679331463"><span class="hs-identifier hs-var">id</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1227"></a><span>                  </span><a href="#local-6989586621679331462"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679331464"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-1228"></a><span>
</span><a name="line-1229"></a><span class="hs-identifier">lintIdBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TopLevelFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BindingSite</span><span>
</span><a name="line-1230"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">InVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OutVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330369"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330369"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1231"></a><span class="hs-comment">-- Do substitution on the type of a binder and add the var with this</span><span>
</span><a name="line-1232"></a><span class="hs-comment">-- new type to the in-scope set of the second argument</span><span>
</span><a name="line-1233"></a><span class="hs-comment">-- ToDo: lint its rules</span><span>
</span><a name="line-1234"></a><a name="lintIdBndr"><a href="CoreLint.html#lintIdBndr"><span class="hs-identifier">lintIdBndr</span></a></a><span> </span><a name="local-6989586621679331465"><a href="#local-6989586621679331465"><span class="hs-identifier">top_lvl</span></a></a><span> </span><a name="local-6989586621679331466"><a href="#local-6989586621679331466"><span class="hs-identifier">bind_site</span></a></a><span> </span><a name="local-6989586621679331467"><a href="#local-6989586621679331467"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621679331468"><a href="#local-6989586621679331468"><span class="hs-identifier">linterF</span></a></a><span>
</span><a name="line-1235"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isId</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1236"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331471"><a href="#local-6989586621679331471"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getLintFlags"><span class="hs-identifier hs-var">getLintFlags</span></a><span>
</span><a name="line-1237"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">lf_check_global_ids</span><span> </span><a href="#local-6989586621679331471"><span class="hs-identifier hs-var">flags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">isLocalId</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1238"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non-local Id binder&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1239"></a><span>                </span><span class="hs-comment">-- See Note [Checking for global Ids]</span><span>
</span><a name="line-1240"></a><span>
</span><a name="line-1241"></a><span>       </span><span class="hs-comment">-- Check that if the binder is nested, it is not marked as exported</span><span>
</span><a name="line-1242"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isExportedId</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679331469"><span class="hs-identifier hs-var">is_top_lvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1243"></a><span>           </span><span class="hs-special">(</span><a href="CoreLint.html#mkNonTopExportedMsg"><span class="hs-identifier hs-var">mkNonTopExportedMsg</span></a><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1244"></a><span>
</span><a name="line-1245"></a><span>       </span><span class="hs-comment">-- Check that if the binder is nested, it does not have an external name</span><span>
</span><a name="line-1246"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isExternalName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Var.varName</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679331469"><span class="hs-identifier hs-var">is_top_lvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1247"></a><span>           </span><span class="hs-special">(</span><a href="CoreLint.html#mkNonTopExternalNameMsg"><span class="hs-identifier hs-var">mkNonTopExternalNameMsg</span></a><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1248"></a><span>
</span><a name="line-1249"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331472"><a href="#local-6989586621679331472"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331473"><a href="#local-6989586621679331473"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintInTy"><span class="hs-identifier hs-var">lintInTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1250"></a><span>
</span><a name="line-1251"></a><span>          </span><span class="hs-comment">-- See Note [Levity polymorphism invariants] in CoreSyn</span><span>
</span><a name="line-1252"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJoinId</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isKindLevPoly</span><span> </span><a href="#local-6989586621679331473"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1253"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Levity-polymorphic binder:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-1254"></a><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">parens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331472"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331473"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1255"></a><span>
</span><a name="line-1256"></a><span>       </span><span class="hs-comment">-- Check that a join-id is a not-top-level let-binding</span><span>
</span><a name="line-1257"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJoinId</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1258"></a><span>         </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679331469"><span class="hs-identifier hs-var">is_top_lvl</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679331470"><span class="hs-identifier hs-var">is_let_bind</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1259"></a><span>         </span><a href="CoreLint.html#mkBadJoinBindMsg"><span class="hs-identifier hs-var">mkBadJoinBindMsg</span></a><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1260"></a><span>
</span><a name="line-1261"></a><span>       </span><span class="hs-comment">-- Check that the Id does not have type (t1 ~# t2) or (t1 ~R# t2);</span><span>
</span><a name="line-1262"></a><span>       </span><span class="hs-comment">-- if so, it should be a CoVar, and checked by lintCoVarBndr</span><span>
</span><a name="line-1263"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isCoVarType</span><span> </span><a href="#local-6989586621679331472"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1264"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non-CoVar has coercion type&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331472"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1265"></a><span>
</span><a name="line-1266"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331474"><a href="#local-6989586621679331474"><span class="hs-identifier">id'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">setIdType</span><span> </span><a href="#local-6989586621679331467"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621679331472"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1267"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#addInScopeVar"><span class="hs-identifier hs-var">addInScopeVar</span></a><span> </span><a href="#local-6989586621679331474"><span class="hs-identifier hs-var">id'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331468"><span class="hs-identifier hs-var">linterF</span></a><span> </span><a href="#local-6989586621679331474"><span class="hs-identifier hs-var">id'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1268"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1269"></a><span>    </span><a name="local-6989586621679331469"><a href="#local-6989586621679331469"><span class="hs-identifier">is_top_lvl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isTopLevel</span><span> </span><a href="#local-6989586621679331465"><span class="hs-identifier hs-var">top_lvl</span></a><span>
</span><a name="line-1270"></a><span>    </span><a name="local-6989586621679331470"><a href="#local-6989586621679331470"><span class="hs-identifier">is_let_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679331466"><span class="hs-identifier hs-var">bind_site</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1271"></a><span>                    </span><span class="hs-identifier hs-var">LetBind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1272"></a><span>                    </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1273"></a><span>
</span><a name="line-1274"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
             Types
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1281"></a><span>
</span><a name="line-1282"></a><span class="hs-identifier">lintTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-1283"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyCoVar</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Treat these as in scope</span><span>
</span><a name="line-1284"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-1285"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-comment">-- Nothing =&gt; OK</span><span>
</span><a name="line-1286"></a><a name="lintTypes"><a href="CoreLint.html#lintTypes"><span class="hs-identifier">lintTypes</span></a></a><span> </span><a name="local-6989586621679331475"><a href="#local-6989586621679331475"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679331476"><a href="#local-6989586621679331476"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679331477"><a href="#local-6989586621679331477"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1287"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isEmptyBag</span><span> </span><a href="#local-6989586621679331480"><span class="hs-identifier hs-var">errs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1288"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprMessageBag</span><span> </span><a href="#local-6989586621679331480"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1289"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1290"></a><span>    </span><a name="local-6989586621679331478"><a href="#local-6989586621679331478"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyInScopeSet</span><span>
</span><a name="line-1291"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679331479"><a href="#local-6989586621679331479"><span class="hs-identifier">_warns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331480"><a href="#local-6989586621679331480"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#initL"><span class="hs-identifier hs-var">initL</span></a><span> </span><a href="#local-6989586621679331475"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="CoreLint.html#defaultLintFlags"><span class="hs-identifier hs-var">defaultLintFlags</span></a><span> </span><a href="#local-6989586621679331478"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621679331481"><span class="hs-identifier hs-var">linter</span></a><span>
</span><a name="line-1292"></a><span>    </span><a name="local-6989586621679331481"><a href="#local-6989586621679331481"><span class="hs-identifier">linter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintBinders"><span class="hs-identifier hs-var">lintBinders</span></a><span> </span><span class="hs-identifier hs-var">LambdaBind</span><span> </span><a href="#local-6989586621679331476"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1293"></a><span>             </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="CoreLint.html#lintInTy"><span class="hs-identifier hs-var">lintInTy</span></a><span> </span><a href="#local-6989586621679331477"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1294"></a><span>
</span><a name="line-1295"></a><span class="hs-identifier">lintInTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">InType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1296"></a><span class="hs-comment">-- Types only, not kinds</span><span>
</span><a name="line-1297"></a><span class="hs-comment">-- Check the type, and apply the substitution to it</span><span>
</span><a name="line-1298"></a><span class="hs-comment">-- See Note [Linting type lets]</span><span>
</span><a name="line-1299"></a><a name="lintInTy"><a href="CoreLint.html#lintInTy"><span class="hs-identifier">lintInTy</span></a></a><span> </span><a name="local-6989586621679331482"><a href="#local-6989586621679331482"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1300"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#InType"><span class="hs-identifier hs-var">InType</span></a><span> </span><a href="#local-6989586621679331482"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1301"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331483"><a href="#local-6989586621679331483"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#applySubstTy"><span class="hs-identifier hs-var">applySubstTy</span></a><span> </span><a href="#local-6989586621679331482"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1302"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331484"><a href="#local-6989586621679331484"><span class="hs-identifier">k</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331483"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1303"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintKind"><span class="hs-identifier hs-var">lintKind</span></a><span> </span><a href="#local-6989586621679331484"><span class="hs-identifier hs-var">k</span></a><span>  </span><span class="hs-comment">-- The kind returned by lintType is already</span><span>
</span><a name="line-1304"></a><span>                      </span><span class="hs-comment">-- a LintedKind but we also want to check that</span><span>
</span><a name="line-1305"></a><span>                      </span><span class="hs-comment">-- k :: *, which lintKind does</span><span>
</span><a name="line-1306"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331483"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331484"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1307"></a><span>
</span><a name="line-1308"></a><span class="hs-identifier">checkTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1309"></a><a name="checkTyCon"><a href="CoreLint.html#checkTyCon"><span class="hs-identifier">checkTyCon</span></a></a><span> </span><a name="local-6989586621679331485"><a href="#local-6989586621679331485"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-1310"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isTcTyCon</span><span> </span><a href="#local-6989586621679331485"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Found TcTyCon:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331485"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1311"></a><span>
</span><a name="line-1312"></a><span class="hs-comment">-------------------</span><span>
</span><a name="line-1313"></a><span class="hs-identifier">lintType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span>
</span><a name="line-1314"></a><span class="hs-comment">-- The returned Kind has itself been linted</span><span>
</span><a name="line-1315"></a><span>
</span><a name="line-1316"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1317"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1318"></a><a name="lintType"><a href="CoreLint.html#lintType"><span class="hs-identifier">lintType</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyVarTy</span><span> </span><a name="local-6989586621679331486"><a href="#local-6989586621679331486"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1319"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isTyVar</span><span> </span><a href="#local-6989586621679331486"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkBadTyVarMsg"><span class="hs-identifier hs-var">mkBadTyVarMsg</span></a><span> </span><a href="#local-6989586621679331486"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1320"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintTyCoVarInScope"><span class="hs-identifier hs-var">lintTyCoVarInScope</span></a><span> </span><a href="#local-6989586621679331486"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1321"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621679331486"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1322"></a><span>         </span><span class="hs-comment">-- We checked its kind when we added it to the envt</span><span>
</span><a name="line-1323"></a><span>
</span><a name="line-1324"></a><span class="hs-identifier">lintType</span><span> </span><a name="local-6989586621679331487"><a href="#local-6989586621679331487"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppTy</span><span> </span><a name="local-6989586621679331488"><a href="#local-6989586621679331488"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679331489"><a href="#local-6989586621679331489"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1325"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">TyConApp</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331488"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1326"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;TyConApp to the left of AppTy:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331487"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1327"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1328"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331490"><a href="#local-6989586621679331490"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331488"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1329"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331491"><a href="#local-6989586621679331491"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331489"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1330"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lint_ty_app"><span class="hs-identifier hs-var">lint_ty_app</span></a><span> </span><a href="#local-6989586621679331487"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679331490"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679331489"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">,</span><a href="#local-6989586621679331491"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1331"></a><span>
</span><a name="line-1332"></a><span class="hs-identifier">lintType</span><span> </span><a name="local-6989586621679331492"><a href="#local-6989586621679331492"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyConApp</span><span> </span><a name="local-6989586621679331493"><a href="#local-6989586621679331493"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679331494"><a href="#local-6989586621679331494"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1333"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTypeSynonymTyCon</span><span> </span><a href="#local-6989586621679331493"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">isTypeFamilyTyCon</span><span> </span><a href="#local-6989586621679331493"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1334"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331495"><a href="#local-6989586621679331495"><span class="hs-identifier">report_unsat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">lf_report_unsat_syns</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="CoreLint.html#getLintFlags"><span class="hs-identifier hs-var">getLintFlags</span></a><span>
</span><a name="line-1335"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintTySynFamApp"><span class="hs-identifier hs-var">lintTySynFamApp</span></a><span> </span><a href="#local-6989586621679331495"><span class="hs-identifier hs-var">report_unsat</span></a><span> </span><a href="#local-6989586621679331492"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679331493"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679331494"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1336"></a><span>
</span><a name="line-1337"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFunTyCon</span><span> </span><a href="#local-6989586621679331493"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1338"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331494"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-1339"></a><span>    </span><span class="hs-comment">-- We should never see a saturated application of funTyCon; such</span><span>
</span><a name="line-1340"></a><span>    </span><span class="hs-comment">-- applications should be represented with the FunTy constructor.</span><span>
</span><a name="line-1341"></a><span>    </span><span class="hs-comment">-- See Note [Linting function types] and</span><span>
</span><a name="line-1342"></a><span>    </span><span class="hs-comment">-- Note [Representation of function types].</span><span>
</span><a name="line-1343"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Saturated application of (-&gt;)&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331492"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1344"></a><span>
</span><a name="line-1345"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-comment">-- Data types, data families, primitive types</span><span>
</span><a name="line-1346"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkTyCon"><span class="hs-identifier hs-var">checkTyCon</span></a><span> </span><a href="#local-6989586621679331493"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1347"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331496"><a href="#local-6989586621679331496"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331494"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1348"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lint_ty_app"><span class="hs-identifier hs-var">lint_ty_app</span></a><span> </span><a href="#local-6989586621679331492"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621679331493"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331494"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">zip</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331496"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span class="hs-comment">-- arrows can related *unlifted* kinds, so this has to be separate from</span><span>
</span><a name="line-1351"></a><span class="hs-comment">-- a dependent forall.</span><span>
</span><a name="line-1352"></a><span class="hs-identifier">lintType</span><span> </span><a name="local-6989586621679331497"><a href="#local-6989586621679331497"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunTy</span><span> </span><a name="local-6989586621679331498"><a href="#local-6989586621679331498"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679331499"><a href="#local-6989586621679331499"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1353"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331500"><a href="#local-6989586621679331500"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331498"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1354"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331501"><a href="#local-6989586621679331501"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331499"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1355"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintArrow"><span class="hs-identifier hs-var">lintArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;type or kind&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331497"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331500"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679331501"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1356"></a><span>
</span><a name="line-1357"></a><span class="hs-identifier">lintType</span><span> </span><a name="local-6989586621679331502"><a href="#local-6989586621679331502"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForAllTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><a name="local-6989586621679331503"><a href="#local-6989586621679331503"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679331504"><a href="#local-6989586621679331504"><span class="hs-identifier">_vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331505"><a href="#local-6989586621679331505"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1358"></a><span>  </span><span class="hs-comment">-- forall over types</span><span>
</span><a name="line-1359"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTyVar</span><span> </span><a href="#local-6989586621679331503"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1360"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintTyBndr"><span class="hs-identifier hs-var">lintTyBndr</span></a><span> </span><a href="#local-6989586621679331503"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679331506"><a href="#local-6989586621679331506"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1361"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331507"><a href="#local-6989586621679331507"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331505"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1362"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkValueKind"><span class="hs-identifier hs-var">checkValueKind</span></a><span> </span><a href="#local-6989586621679331507"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;the body of forall:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331502"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1363"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">occCheckExpand</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331506"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679331507"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- See Note [Stupid type synonyms]</span><span>
</span><a name="line-1364"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331508"><a href="#local-6989586621679331508"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679331508"><span class="hs-identifier hs-var">k'</span></a><span>
</span><a name="line-1365"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Variable escape in forall:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1366"></a><span>                                    </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331502"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1367"></a><span>                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;kind:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331507"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1368"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1369"></a><span>
</span><a name="line-1370"></a><span class="hs-identifier">lintType</span><span> </span><a name="local-6989586621679331509"><a href="#local-6989586621679331509"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForAllTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><a name="local-6989586621679331510"><a href="#local-6989586621679331510"><span class="hs-identifier">cv</span></a></a><span> </span><a name="local-6989586621679331511"><a href="#local-6989586621679331511"><span class="hs-identifier">_vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331512"><a href="#local-6989586621679331512"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1371"></a><span>  </span><span class="hs-comment">-- forall over coercions</span><span>
</span><a name="line-1372"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isCoVar</span><span> </span><a href="#local-6989586621679331510"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1373"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non-Tyvar or Non-Covar bound in type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331509"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1374"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331510"><span class="hs-identifier hs-var">cv</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elemVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">tyCoVarsOfType</span><span> </span><a href="#local-6989586621679331512"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1375"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Covar does not occur in the body:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331509"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1376"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintCoBndr"><span class="hs-identifier hs-var">lintCoBndr</span></a><span> </span><a href="#local-6989586621679331510"><span class="hs-identifier hs-var">cv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1377"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331513"><a href="#local-6989586621679331513"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331512"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1378"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkValueKind"><span class="hs-identifier hs-var">checkValueKind</span></a><span> </span><a href="#local-6989586621679331513"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;the body of forall:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331509"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">liftedTypeKind</span><span>
</span><a name="line-1380"></a><span>           </span><span class="hs-comment">-- We don't check variable escape here. Namely, k could refer to cv'</span><span>
</span><a name="line-1381"></a><span>           </span><span class="hs-comment">-- See Note [NthCo and newtypes] in TyCoRep</span><span>
</span><a name="line-1382"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1383"></a><span>
</span><a name="line-1384"></a><span class="hs-identifier">lintType</span><span> </span><a name="local-6989586621679331514"><a href="#local-6989586621679331514"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitTy</span><span> </span><a name="local-6989586621679331515"><a href="#local-6989586621679331515"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintTyLit"><span class="hs-identifier hs-var">lintTyLit</span></a><span> </span><a href="#local-6989586621679331515"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331514"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1385"></a><span>
</span><a name="line-1386"></a><span class="hs-identifier">lintType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CastTy</span><span> </span><a name="local-6989586621679331516"><a href="#local-6989586621679331516"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679331517"><a href="#local-6989586621679331517"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1387"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331518"><a href="#local-6989586621679331518"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331516"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1388"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331519"><a href="#local-6989586621679331519"><span class="hs-identifier">k1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331520"><a href="#local-6989586621679331520"><span class="hs-identifier">k2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintStarCoercion"><span class="hs-identifier hs-var">lintStarCoercion</span></a><span> </span><a href="#local-6989586621679331517"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1389"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331518"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679331519"><span class="hs-identifier hs-var">k1'</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkCastTyErr"><span class="hs-identifier hs-var">mkCastTyErr</span></a><span> </span><a href="#local-6989586621679331516"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679331517"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679331519"><span class="hs-identifier hs-var">k1'</span></a><span> </span><a href="#local-6989586621679331518"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1390"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679331520"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1391"></a><span>
</span><a name="line-1392"></a><span class="hs-identifier">lintType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoercionTy</span><span> </span><a name="local-6989586621679331521"><a href="#local-6989586621679331521"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1393"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331522"><a href="#local-6989586621679331522"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331523"><a href="#local-6989586621679331523"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331524"><a href="#local-6989586621679331524"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331525"><a href="#local-6989586621679331525"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331526"><a href="#local-6989586621679331526"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331521"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1394"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkHeteroCoercionType</span><span> </span><a href="#local-6989586621679331526"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679331522"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679331523"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679331524"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679331525"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1395"></a><span>
</span><a name="line-1396"></a><span class="hs-comment">{- Note [Stupid type synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (Trac #14939)
   type Alg cls ob = ob
   f :: forall (cls :: * -&gt; Constraint) (b :: Alg cls *). b

Here 'cls' appears free in b's kind, which would usually be illegal
(because in (forall a. ty), ty's kind should not mention 'a'). But
#in this case (Alg cls *) = *, so all is well.  Currently we allow
this, and make Lint expand synonyms where necessary to make it so.

c.f. TcUnify.occCheckExpand and CoreUtils.coreAltsType which deal
with the same problem. A single systematic solution eludes me.
-}</span><span>
</span><a name="line-1410"></a><span>
</span><a name="line-1411"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1412"></a><span class="hs-identifier">lintTySynFamApp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span>
</span><a name="line-1413"></a><span class="hs-comment">-- The TyCon is a type synonym or a type family (not a data family)</span><span>
</span><a name="line-1414"></a><span class="hs-comment">-- See Note [Linting type synonym applications]</span><span>
</span><a name="line-1415"></a><span class="hs-comment">-- c.f. TcValidity.check_syn_tc_app</span><span>
</span><a name="line-1416"></a><a name="lintTySynFamApp"><a href="CoreLint.html#lintTySynFamApp"><span class="hs-identifier">lintTySynFamApp</span></a></a><span> </span><a name="local-6989586621679331527"><a href="#local-6989586621679331527"><span class="hs-identifier">report_unsat</span></a></a><span> </span><a name="local-6989586621679331528"><a href="#local-6989586621679331528"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679331529"><a href="#local-6989586621679331529"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679331530"><a href="#local-6989586621679331530"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1417"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331527"><span class="hs-identifier hs-var">report_unsat</span></a><span>   </span><span class="hs-comment">-- Report unsaturated only if report_unsat is on</span><span>
</span><a name="line-1418"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331530"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthLessThan</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621679331529"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1419"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Un-saturated type application&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331528"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1420"></a><span>
</span><a name="line-1421"></a><span>  </span><span class="hs-comment">-- Deal with type synonyms</span><span>
</span><a name="line-1422"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331531"><a href="#local-6989586621679331531"><span class="hs-identifier">tenv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331532"><a href="#local-6989586621679331532"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331533"><a href="#local-6989586621679331533"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">expandSynTyCon_maybe</span><span> </span><a href="#local-6989586621679331529"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679331530"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1423"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331534"><a href="#local-6989586621679331534"><span class="hs-identifier">expanded_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkAppTys</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">substTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTvSubstPrs</span><span> </span><a href="#local-6989586621679331531"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331532"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331533"><span class="hs-identifier hs-var">tys'</span></a><span>
</span><a name="line-1424"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Kind-check the argument types, but without reporting</span><span>
</span><a name="line-1425"></a><span>         </span><span class="hs-comment">-- un-saturated type families/synonyms</span><span>
</span><a name="line-1426"></a><span>         </span><a name="local-6989586621679331535"><a href="#local-6989586621679331535"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#setReportUnsat"><span class="hs-identifier hs-var">setReportUnsat</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331530"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1427"></a><span>
</span><a name="line-1428"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679331527"><span class="hs-identifier hs-var">report_unsat</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1429"></a><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331534"><span class="hs-identifier hs-var">expanded_ty</span></a><span>
</span><a name="line-1430"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1431"></a><span>
</span><a name="line-1432"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lint_ty_app"><span class="hs-identifier hs-var">lint_ty_app</span></a><span> </span><a href="#local-6989586621679331528"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621679331529"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331530"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">zip</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331535"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1433"></a><span>
</span><a name="line-1434"></a><span>  </span><span class="hs-comment">-- Otherwise this must be a type family</span><span>
</span><a name="line-1435"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1436"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331536"><a href="#local-6989586621679331536"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331530"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1437"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lint_ty_app"><span class="hs-identifier hs-var">lint_ty_app</span></a><span> </span><a href="#local-6989586621679331528"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621679331529"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331530"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">zip</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331536"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1438"></a><span>
</span><a name="line-1439"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1440"></a><span class="hs-identifier">lintKind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutKind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1441"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1442"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1443"></a><a name="lintKind"><a href="CoreLint.html#lintKind"><span class="hs-identifier">lintKind</span></a></a><span> </span><a name="local-6989586621679331537"><a href="#local-6989586621679331537"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331538"><a href="#local-6989586621679331538"><span class="hs-identifier">sk</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331537"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1444"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">classifiesTypeWithValues</span><span> </span><a href="#local-6989586621679331538"><span class="hs-identifier hs-var">sk</span></a><span class="hs-special">)</span><span>
</span><a name="line-1445"></a><span>                         </span><span class="hs-special">(</span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Ill-kinded kind:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331537"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-1446"></a><span>                                      </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;has kind:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331538"><span class="hs-identifier hs-var">sk</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1447"></a><span>
</span><a name="line-1448"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1449"></a><span class="hs-comment">-- Confirms that a type is really *, #, Constraint etc</span><span>
</span><a name="line-1450"></a><span class="hs-identifier">checkValueKind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutKind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1451"></a><a name="checkValueKind"><a href="CoreLint.html#checkValueKind"><span class="hs-identifier">checkValueKind</span></a></a><span> </span><a name="local-6989586621679331539"><a href="#local-6989586621679331539"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679331540"><a href="#local-6989586621679331540"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-1452"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">classifiesTypeWithValues</span><span> </span><a href="#local-6989586621679331539"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-1453"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non-*-like kind when *-like expected:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331539"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$$</span><span>
</span><a name="line-1454"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;when checking&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679331540"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1455"></a><span>
</span><a name="line-1456"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1457"></a><span class="hs-identifier">lintArrow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span>
</span><a name="line-1458"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1459"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1460"></a><a name="lintArrow"><a href="CoreLint.html#lintArrow"><span class="hs-identifier">lintArrow</span></a></a><span> </span><a name="local-6989586621679331541"><a href="#local-6989586621679331541"><span class="hs-identifier">what</span></a></a><span> </span><a name="local-6989586621679331542"><a href="#local-6989586621679331542"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679331543"><a href="#local-6989586621679331543"><span class="hs-identifier">k2</span></a></a><span>   </span><span class="hs-comment">-- Eg lintArrow &quot;type or kind `blah'&quot; k1 k2</span><span>
</span><a name="line-1461"></a><span>                       </span><span class="hs-comment">-- or lintarrow &quot;coercion `blah'&quot; k1 k2</span><span>
</span><a name="line-1462"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">classifiesTypeWithValues</span><span> </span><a href="#local-6989586621679331542"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331544"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;argument&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331542"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1463"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">classifiesTypeWithValues</span><span> </span><a href="#local-6989586621679331543"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331544"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;result&quot;</span><span class="hs-special">)</span><span>   </span><a href="#local-6989586621679331543"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1464"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">liftedTypeKind</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1465"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1466"></a><span>    </span><a name="local-6989586621679331544"><a href="#local-6989586621679331544"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679331545"><a href="#local-6989586621679331545"><span class="hs-identifier">ar</span></a></a><span> </span><a name="local-6989586621679331546"><a href="#local-6989586621679331546"><span class="hs-identifier">k</span></a></a><span>
</span><a name="line-1467"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Ill-kinded&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679331545"><span class="hs-identifier hs-var">ar</span></a><span class="hs-special">)</span><span>
</span><a name="line-1468"></a><span>                  </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679331541"><span class="hs-identifier hs-var">what</span></a><span class="hs-special">)</span><span>
</span><a name="line-1469"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331541"><span class="hs-identifier hs-var">what</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;kind:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331546"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1470"></a><span>
</span><a name="line-1471"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1472"></a><span class="hs-identifier">lint_ty_app</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span>
</span><a name="line-1473"></a><a name="lint_ty_app"><a href="CoreLint.html#lint_ty_app"><span class="hs-identifier">lint_ty_app</span></a></a><span> </span><a name="local-6989586621679331547"><a href="#local-6989586621679331547"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679331548"><a href="#local-6989586621679331548"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679331549"><a href="#local-6989586621679331549"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1474"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lint_app"><span class="hs-identifier hs-var">lint_app</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;type&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331547"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331548"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679331549"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1475"></a><span>
</span><a name="line-1476"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-1477"></a><span class="hs-identifier">lint_co_app</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span>
</span><a name="line-1478"></a><a name="lint_co_app"><a href="CoreLint.html#lint_co_app"><span class="hs-identifier">lint_co_app</span></a></a><span> </span><a name="local-6989586621679331550"><a href="#local-6989586621679331550"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679331551"><a href="#local-6989586621679331551"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679331552"><a href="#local-6989586621679331552"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1479"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lint_app"><span class="hs-identifier hs-var">lint_app</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;coercion&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331550"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331551"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679331552"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1480"></a><span>
</span><a name="line-1481"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-1482"></a><span class="hs-identifier">lintTyLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyLit</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1483"></a><a name="lintTyLit"><a href="CoreLint.html#lintTyLit"><span class="hs-identifier">lintTyLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NumTyLit</span><span> </span><a name="local-6989586621679331553"><a href="#local-6989586621679331553"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1484"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331553"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1485"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><a href="#local-6989586621679331554"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-1486"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679331554"><a href="#local-6989586621679331554"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Negative type literal:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">integer</span><span> </span><a href="#local-6989586621679331553"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1487"></a><span class="hs-identifier">lintTyLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StrTyLit</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1488"></a><span>
</span><a name="line-1489"></a><span class="hs-identifier">lint_app</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">Kind</span><span>
</span><a name="line-1490"></a><span class="hs-comment">-- (lint_app d fun_kind arg_tys)</span><span>
</span><a name="line-1491"></a><span class="hs-comment">--    We have an application (f arg_ty1 .. arg_tyn),</span><span>
</span><a name="line-1492"></a><span class="hs-comment">--    where f :: fun_kind</span><span>
</span><a name="line-1493"></a><span class="hs-comment">-- Takes care of linting the OutTypes</span><span>
</span><a name="line-1494"></a><span>
</span><a name="line-1495"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1496"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1497"></a><a name="lint_app"><a href="CoreLint.html#lint_app"><span class="hs-identifier">lint_app</span></a></a><span> </span><a name="local-6989586621679331555"><a href="#local-6989586621679331555"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621679331556"><a href="#local-6989586621679331556"><span class="hs-identifier">kfn</span></a></a><span> </span><a name="local-6989586621679331557"><a href="#local-6989586621679331557"><span class="hs-identifier">kas</span></a></a><span>
</span><a name="line-1498"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331579"><a href="#local-6989586621679331579"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getInScope"><span class="hs-identifier hs-var">getInScope</span></a><span>
</span><a name="line-1499"></a><span>         </span><span class="hs-comment">-- We need the in_scope set to satisfy the invariant in</span><span>
</span><a name="line-1500"></a><span>         </span><span class="hs-comment">-- Note [The substitution invariant] in TyCoRep</span><span>
</span><a name="line-1501"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">foldlM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331559"><span class="hs-identifier hs-var">go_app</span></a><span> </span><a href="#local-6989586621679331579"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331556"><span class="hs-identifier hs-var">kfn</span></a><span> </span><a href="#local-6989586621679331557"><span class="hs-identifier hs-var">kas</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1502"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1503"></a><span>    </span><a name="local-6989586621679331558"><a href="#local-6989586621679331558"><span class="hs-identifier">fail_msg</span></a></a><span> </span><a name="local-6989586621679331560"><a href="#local-6989586621679331560"><span class="hs-identifier">extra</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Kind application error in&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679331555"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-1504"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Function kind =&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331556"><span class="hs-identifier hs-var">kfn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1505"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arg kinds =&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331557"><span class="hs-identifier hs-var">kas</span></a><span class="hs-special">)</span><span>
</span><a name="line-1506"></a><span>                          </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331560"><span class="hs-identifier hs-var">extra</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1507"></a><span>
</span><a name="line-1508"></a><span>    </span><a name="local-6989586621679331559"><a href="#local-6989586621679331559"><span class="hs-identifier">go_app</span></a></a><span> </span><a name="local-6989586621679331561"><a href="#local-6989586621679331561"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-6989586621679331562"><a href="#local-6989586621679331562"><span class="hs-identifier">kfn</span></a></a><span> </span><a name="local-6989586621679331563"><a href="#local-6989586621679331563"><span class="hs-identifier">tka</span></a></a><span>
</span><a name="line-1509"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331564"><a href="#local-6989586621679331564"><span class="hs-identifier">kfn'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">coreView</span><span> </span><a href="#local-6989586621679331562"><span class="hs-identifier hs-var">kfn</span></a><span>
</span><a name="line-1510"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331559"><span class="hs-identifier hs-var">go_app</span></a><span> </span><a href="#local-6989586621679331561"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621679331564"><span class="hs-identifier hs-var">kfn'</span></a><span> </span><a href="#local-6989586621679331563"><span class="hs-identifier hs-var">tka</span></a><span>
</span><a name="line-1511"></a><span>
</span><a name="line-1512"></a><span>    </span><span class="hs-identifier">go_app</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunTy</span><span> </span><a name="local-6989586621679331565"><a href="#local-6989586621679331565"><span class="hs-identifier">kfa</span></a></a><span> </span><a name="local-6989586621679331566"><a href="#local-6989586621679331566"><span class="hs-identifier">kfb</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331567"><a href="#local-6989586621679331567"><span class="hs-identifier">tka</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679331568"><a href="#local-6989586621679331568"><span class="hs-identifier">ka</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1513"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331568"><span class="hs-identifier hs-var">ka</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331565"><span class="hs-identifier hs-var">kfa</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1514"></a><span>             </span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331558"><span class="hs-identifier hs-var">fail_msg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Fun:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331565"><span class="hs-identifier hs-var">kfa</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331567"><span class="hs-identifier hs-var">tka</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1515"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679331566"><span class="hs-identifier hs-var">kfb</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1516"></a><span>
</span><a name="line-1517"></a><span>    </span><span class="hs-identifier">go_app</span><span> </span><a name="local-6989586621679331569"><a href="#local-6989586621679331569"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForAllTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><a name="local-6989586621679331570"><a href="#local-6989586621679331570"><span class="hs-identifier">kv</span></a></a><span> </span><a name="local-6989586621679331571"><a href="#local-6989586621679331571"><span class="hs-identifier">_vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331572"><a href="#local-6989586621679331572"><span class="hs-identifier">kfn</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679331573"><a href="#local-6989586621679331573"><span class="hs-identifier">tka</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679331574"><a href="#local-6989586621679331574"><span class="hs-identifier">ta</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331575"><a href="#local-6989586621679331575"><span class="hs-identifier">ka</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1518"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331576"><a href="#local-6989586621679331576"><span class="hs-identifier">kv_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331570"><span class="hs-identifier hs-var">kv</span></a><span>
</span><a name="line-1519"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331575"><span class="hs-identifier hs-var">ka</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331576"><span class="hs-identifier hs-var">kv_kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1520"></a><span>             </span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331558"><span class="hs-identifier hs-var">fail_msg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Forall:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331570"><span class="hs-identifier hs-var">kv</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331576"><span class="hs-identifier hs-var">kv_kind</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331573"><span class="hs-identifier hs-var">tka</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1521"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">substTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">extendTCvSubst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkEmptyTCvSubst</span><span> </span><a href="#local-6989586621679331569"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331570"><span class="hs-identifier hs-var">kv</span></a><span> </span><a href="#local-6989586621679331574"><span class="hs-identifier hs-var">ta</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331572"><span class="hs-identifier hs-var">kfn</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1522"></a><span>
</span><a name="line-1523"></a><span>    </span><span class="hs-identifier">go_app</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679331577"><a href="#local-6989586621679331577"><span class="hs-identifier">kfn</span></a></a><span> </span><a name="local-6989586621679331578"><a href="#local-6989586621679331578"><span class="hs-identifier">ka</span></a></a><span>
</span><a name="line-1524"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331558"><span class="hs-identifier hs-var">fail_msg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Not a fun:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331577"><span class="hs-identifier hs-var">kfn</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331578"><span class="hs-identifier hs-var">ka</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1525"></a><span>
</span><a name="line-1526"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
        Linting rules
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-1531"></a><span>
</span><a name="line-1532"></a><span class="hs-identifier">lintCoreRule</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreRule</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1533"></a><a name="lintCoreRule"><a href="CoreLint.html#lintCoreRule"><span class="hs-identifier">lintCoreRule</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BuiltinRule</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1534"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Don't bother</span><span>
</span><a name="line-1535"></a><span>
</span><a name="line-1536"></a><span class="hs-identifier">lintCoreRule</span><span> </span><a name="local-6989586621679331580"><a href="#local-6989586621679331580"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679331581"><a href="#local-6989586621679331581"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621679331582"><a href="#local-6989586621679331582"><span class="hs-identifier">rule</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Rule</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331583"><a href="#local-6989586621679331583"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331584"><a href="#local-6989586621679331584"><span class="hs-identifier">bndrs</span></a></a><span>
</span><a name="line-1537"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331585"><a href="#local-6989586621679331585"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331586"><a href="#local-6989586621679331586"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1538"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintBinders"><span class="hs-identifier hs-var">lintBinders</span></a><span> </span><span class="hs-identifier hs-var">LambdaBind</span><span> </span><a href="#local-6989586621679331584"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1539"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331592"><a href="#local-6989586621679331592"><span class="hs-identifier">lhs_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoreArgs"><span class="hs-identifier hs-var">lintCoreArgs</span></a><span> </span><a href="#local-6989586621679331581"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621679331585"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1540"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331594"><a href="#local-6989586621679331594"><span class="hs-identifier">rhs_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">isJoinId_maybe</span><span> </span><a href="#local-6989586621679331580"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1541"></a><span>                     </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331593"><a href="#local-6989586621679331593"><span class="hs-identifier">join_arity</span></a></a><span>
</span><a name="line-1542"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331585"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthIs</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331593"><span class="hs-identifier hs-var">join_arity</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1543"></a><span>                                </span><a href="CoreLint.html#mkBadJoinPointRuleMsg"><span class="hs-identifier hs-var">mkBadJoinPointRuleMsg</span></a><span> </span><a href="#local-6989586621679331580"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621679331593"><span class="hs-identifier hs-var">join_arity</span></a><span> </span><a href="#local-6989586621679331582"><span class="hs-identifier hs-var">rule</span></a><span>
</span><a name="line-1544"></a><span>                               </span><span class="hs-comment">-- See Note [Rules for join points]</span><span>
</span><a name="line-1545"></a><span>                             </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331586"><span class="hs-identifier hs-var">rhs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1546"></a><span>                     </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreLint.html#lintCoreExpr"><span class="hs-identifier hs-var">lintCoreExpr</span></a><span> </span><a href="#local-6989586621679331586"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1547"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331592"><span class="hs-identifier hs-var">lhs_ty</span></a><span> </span><a href="#local-6989586621679331594"><span class="hs-identifier hs-var">rhs_ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1548"></a><span>         </span><span class="hs-special">(</span><a href="#local-6989586621679331587"><span class="hs-identifier hs-var">rule_doc</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;lhs type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331592"><span class="hs-identifier hs-var">lhs_ty</span></a><span>
</span><a name="line-1549"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;rhs type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331594"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-1550"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;fun_ty:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331581"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1551"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331595"><a href="#local-6989586621679331595"><span class="hs-identifier">bad_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621679331590"><span class="hs-identifier hs-var">is_bad_bndr</span></a><span> </span><a href="#local-6989586621679331584"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-1552"></a><span>
</span><a name="line-1553"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679331595"><span class="hs-identifier hs-var">bad_bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1554"></a><span>                </span><span class="hs-special">(</span><a href="#local-6989586621679331587"><span class="hs-identifier hs-var">rule_doc</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;unbound&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331595"><span class="hs-identifier hs-var">bad_bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1555"></a><span>            </span><span class="hs-comment">-- See Note [Linting rules]</span><span>
</span><a name="line-1556"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1557"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1558"></a><span>    </span><a name="local-6989586621679331587"><a href="#local-6989586621679331587"><span class="hs-identifier">rule_doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Rule&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">doubleQuotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ftext</span><span> </span><a href="#local-6989586621679331583"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span>
</span><a name="line-1559"></a><span>
</span><a name="line-1560"></a><span>    </span><a name="local-6989586621679331588"><a href="#local-6989586621679331588"><span class="hs-identifier">lhs_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">exprsFreeVars</span><span> </span><a href="#local-6989586621679331585"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1561"></a><span>    </span><a name="local-6989586621679331589"><a href="#local-6989586621679331589"><span class="hs-identifier">rhs_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">exprFreeVars</span><span> </span><a href="#local-6989586621679331586"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1562"></a><span>
</span><a name="line-1563"></a><span>    </span><span class="hs-identifier">is_bad_bndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1564"></a><span>    </span><span class="hs-comment">-- See Note [Unbound RULE binders] in Rules</span><span>
</span><a name="line-1565"></a><span>    </span><a name="local-6989586621679331590"><a href="#local-6989586621679331590"><span class="hs-identifier">is_bad_bndr</span></a></a><span> </span><a name="local-6989586621679331591"><a href="#local-6989586621679331591"><span class="hs-identifier">bndr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331591"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elemVarSet</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331588"><span class="hs-identifier hs-var">lhs_fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span>                    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679331591"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elemVarSet</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331589"><span class="hs-identifier hs-var">rhs_fvs</span></a><span>
</span><a name="line-1567"></a><span>                    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isReflCoVar_maybe</span><span> </span><a href="#local-6989586621679331591"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1568"></a><span>
</span><a name="line-1569"></a><span>
</span><a name="line-1570"></a><span class="hs-comment">{- Note [Linting rules]
~~~~~~~~~~~~~~~~~~~~~~~
It's very bad if simplifying a rule means that one of the template
variables (ru_bndrs) that /is/ mentioned on the RHS becomes
not-mentioned in the LHS (ru_args).  How can that happen?  Well, in
Trac #10602, SpecConstr stupidly constructed a rule like

  forall x,c1,c2.
     f (x |&gt; c1 |&gt; c2) = ....

But simplExpr collapses those coercions into one.  (Indeed in
Trac #10602, it collapsed to the identity and was removed altogether.)

We don't have a great story for what to do here, but at least
this check will nail it.

NB (Trac #11643): it's possible that a variable listed in the
binders becomes not-mentioned on both LHS and RHS.  Here's a silly
example:
   RULE forall x y. f (g x y) = g (x+1) (y-1)
And suppose worker/wrapper decides that 'x' is Absent.  Then
we'll end up with
   RULE forall x y. f ($gw y) = $gw (x+1)
This seems sufficiently obscure that there isn't enough payoff to
try to trim the forall'd binder list.

Note [Rules for join points]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A join point cannot be partially applied. However, the left-hand side of a rule
for a join point is effectively a *pattern*, not a piece of code, so there's an
argument to be made for allowing a situation like this:

  join $sj :: Int -&gt; Int -&gt; String
       $sj n m = ...
       j :: forall a. Eq a =&gt; a -&gt; a -&gt; String
       {-# RULES &quot;SPEC j&quot; jump j @ Int $dEq = jump $sj #-}
       j @a $dEq x y = ...

Applying this rule can't turn a well-typed program into an ill-typed one, so
conceivably we could allow it. But we can always eta-expand such an
&quot;undersaturated&quot; rule (see 'CoreArity.etaExpandToJoinPointRule'), and in fact
the simplifier would have to in order to deal with the RHS. So we take a
conservative view and don't allow undersaturated rules for join points. See
Note [Rules and join points] in OccurAnal for further discussion.
-}</span><span>
</span><a name="line-1616"></a><span>
</span><a name="line-1617"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
         Linting coercions
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1624"></a><span>
</span><a name="line-1625"></a><span class="hs-identifier">lintInCo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">InCoercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Role</span><span class="hs-special">)</span><span>
</span><a name="line-1626"></a><span class="hs-comment">-- Check the coercion, and apply the substitution to it</span><span>
</span><a name="line-1627"></a><span class="hs-comment">-- See Note [Linting type lets]</span><span>
</span><a name="line-1628"></a><a name="lintInCo"><a href="CoreLint.html#lintInCo"><span class="hs-identifier">lintInCo</span></a></a><span> </span><a name="local-6989586621679331596"><a href="#local-6989586621679331596"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-1629"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addLoc"><span class="hs-identifier hs-var">addLoc</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#InCo"><span class="hs-identifier hs-var">InCo</span></a><span> </span><a href="#local-6989586621679331596"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1630"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331597"><a href="#local-6989586621679331597"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#applySubstCo"><span class="hs-identifier hs-var">applySubstCo</span></a><span> </span><a href="#local-6989586621679331596"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1631"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331597"><span class="hs-identifier hs-var">co'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1632"></a><span>
</span><a name="line-1633"></a><span class="hs-comment">-- lints a coercion, confirming that its lh kind and its rh kind are both *</span><span>
</span><a name="line-1634"></a><span class="hs-comment">-- also ensures that the role is Nominal</span><span>
</span><a name="line-1635"></a><span class="hs-identifier">lintStarCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutCoercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">)</span><span>
</span><a name="line-1636"></a><a name="lintStarCoercion"><a href="CoreLint.html#lintStarCoercion"><span class="hs-identifier">lintStarCoercion</span></a></a><span> </span><a name="local-6989586621679331598"><a href="#local-6989586621679331598"><span class="hs-identifier">g</span></a></a><span>
</span><a name="line-1637"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331599"><a href="#local-6989586621679331599"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331600"><a href="#local-6989586621679331600"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331601"><a href="#local-6989586621679331601"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331602"><a href="#local-6989586621679331602"><span class="hs-identifier">t2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331603"><a href="#local-6989586621679331603"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331598"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1638"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkValueKind"><span class="hs-identifier hs-var">checkValueKind</span></a><span> </span><a href="#local-6989586621679331599"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;the kind of the left type in&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331598"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-1639"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkValueKind"><span class="hs-identifier hs-var">checkValueKind</span></a><span> </span><a href="#local-6989586621679331600"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;the kind of the right type in&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331598"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-1640"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331598"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621679331603"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1641"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331601"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331602"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1642"></a><span>
</span><a name="line-1643"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutCoercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#LintedKind"><span class="hs-identifier hs-type">LintedKind</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#LintedType"><span class="hs-identifier hs-type">LintedType</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Role</span><span class="hs-special">)</span><span>
</span><a name="line-1644"></a><span class="hs-comment">-- Check the kind of a coercion term, returning the kind</span><span>
</span><a name="line-1645"></a><span class="hs-comment">-- Post-condition: the returned OutTypes are lint-free</span><span>
</span><a name="line-1646"></a><span class="hs-comment">--</span><span>
</span><a name="line-1647"></a><span class="hs-comment">-- If   lintCoercion co = (k1, k2, s1, s2, r)</span><span>
</span><a name="line-1648"></a><span class="hs-comment">-- then co :: s1 ~r s2</span><span>
</span><a name="line-1649"></a><span class="hs-comment">--      s1 :: k1</span><span>
</span><a name="line-1650"></a><span class="hs-comment">--      s2 :: k2</span><span>
</span><a name="line-1651"></a><span>
</span><a name="line-1652"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1653"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-1654"></a><a name="lintCoercion"><a href="CoreLint.html#lintCoercion"><span class="hs-identifier">lintCoercion</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Refl</span><span> </span><a name="local-6989586621679331604"><a href="#local-6989586621679331604"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1655"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331605"><a href="#local-6989586621679331605"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331604"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1656"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331605"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331605"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331604"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331604"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nominal</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1657"></a><span>
</span><a name="line-1658"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRefl</span><span> </span><a name="local-6989586621679331606"><a href="#local-6989586621679331606"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679331607"><a href="#local-6989586621679331607"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier hs-var">MRefl</span><span class="hs-special">)</span><span>
</span><a name="line-1659"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331608"><a href="#local-6989586621679331608"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331607"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1660"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331608"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331608"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331607"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331607"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331606"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1661"></a><span>
</span><a name="line-1662"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRefl</span><span> </span><a name="local-6989586621679331609"><a href="#local-6989586621679331609"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679331610"><a href="#local-6989586621679331610"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MCo</span><span> </span><a name="local-6989586621679331611"><a href="#local-6989586621679331611"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1663"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331612"><a href="#local-6989586621679331612"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331610"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1664"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331613"><a href="#local-6989586621679331613"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331614"><a href="#local-6989586621679331614"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331615"><a href="#local-6989586621679331615"><span class="hs-identifier">r'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331611"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1665"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331612"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679331613"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-1666"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;GRefl coercion kind mis-match:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331611"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1667"></a><span>                   </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331610"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331612"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331613"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1668"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331611"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621679331615"><span class="hs-identifier hs-var">r'</span></a><span>
</span><a name="line-1669"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331613"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331614"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331610"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkCastTy</span><span> </span><a href="#local-6989586621679331610"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621679331611"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331609"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1670"></a><span>
</span><a name="line-1671"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331616"><a href="#local-6989586621679331616"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyConAppCo</span><span> </span><a name="local-6989586621679331617"><a href="#local-6989586621679331617"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679331618"><a href="#local-6989586621679331618"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621679331619"><a href="#local-6989586621679331619"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1672"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331618"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">funTyConKey</span><span>
</span><a name="line-1673"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679331620"><a href="#local-6989586621679331620"><span class="hs-identifier">_rep1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331621"><a href="#local-6989586621679331621"><span class="hs-identifier">_rep2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331622"><a href="#local-6989586621679331622"><span class="hs-identifier">_co1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331623"><a href="#local-6989586621679331623"><span class="hs-identifier">_co2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331619"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1674"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Saturated TyConAppCo (-&gt;):&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331616"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1675"></a><span>       </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- All saturated TyConAppCos should be FunCos</span><span>
</span><a name="line-1676"></a><span>
</span><a name="line-1677"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">synTyConDefn_maybe</span><span> </span><a href="#local-6989586621679331618"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1678"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Synonym in TyConAppCo:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331616"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1679"></a><span>
</span><a name="line-1680"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1681"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkTyCon"><span class="hs-identifier hs-var">checkTyCon</span></a><span> </span><a href="#local-6989586621679331618"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1682"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331624"><a href="#local-6989586621679331624"><span class="hs-identifier">k's</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331625"><a href="#local-6989586621679331625"><span class="hs-identifier">ks</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331626"><a href="#local-6989586621679331626"><span class="hs-identifier">ss</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331627"><a href="#local-6989586621679331627"><span class="hs-identifier">ts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331628"><a href="#local-6989586621679331628"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAndUnzip5M</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331619"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1683"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331629"><a href="#local-6989586621679331629"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lint_co_app"><span class="hs-identifier hs-var">lint_co_app</span></a><span> </span><a href="#local-6989586621679331616"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621679331618"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331626"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">zip</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331624"><span class="hs-identifier hs-var">k's</span></a><span class="hs-special">)</span><span>
</span><a name="line-1684"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331630"><a href="#local-6989586621679331630"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lint_co_app"><span class="hs-identifier hs-var">lint_co_app</span></a><span> </span><a href="#local-6989586621679331616"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621679331618"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331627"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">zip</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331625"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span>
</span><a name="line-1685"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zipWith3M</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331619"><span class="hs-identifier hs-var">cos</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConRolesX</span><span> </span><a href="#local-6989586621679331617"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679331618"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331628"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-1686"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331629"><span class="hs-identifier hs-var">k'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331630"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621679331618"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679331626"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621679331618"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621679331627"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331617"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1687"></a><span>
</span><a name="line-1688"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331631"><a href="#local-6989586621679331631"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppCo</span><span> </span><a name="local-6989586621679331632"><a href="#local-6989586621679331632"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679331633"><a href="#local-6989586621679331633"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1689"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">TyConAppCo</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331632"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-1690"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;TyConAppCo to the left of AppCo:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331631"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1691"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyConApp</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">isReflCo_maybe</span><span> </span><a href="#local-6989586621679331632"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-1692"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Refl (TyConApp ...) to the left of AppCo:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331631"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1693"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1694"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331634"><a href="#local-6989586621679331634"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679331635"><a href="#local-6989586621679331635"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621679331636"><a href="#local-6989586621679331636"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331637"><a href="#local-6989586621679331637"><span class="hs-identifier">s2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331638"><a href="#local-6989586621679331638"><span class="hs-identifier">r1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331632"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-1695"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331639"><a href="#local-6989586621679331639"><span class="hs-identifier">k'1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331640"><a href="#local-6989586621679331640"><span class="hs-identifier">k'2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331641"><a href="#local-6989586621679331641"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331642"><a href="#local-6989586621679331642"><span class="hs-identifier">t2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331643"><a href="#local-6989586621679331643"><span class="hs-identifier">r2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331633"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1696"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331644"><a href="#local-6989586621679331644"><span class="hs-identifier">k3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lint_co_app"><span class="hs-identifier hs-var">lint_co_app</span></a><span> </span><a href="#local-6989586621679331631"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679331634"><span class="hs-identifier hs-var">k1</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679331641"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><a href="#local-6989586621679331639"><span class="hs-identifier hs-var">k'1</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1697"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331645"><a href="#local-6989586621679331645"><span class="hs-identifier">k4</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lint_co_app"><span class="hs-identifier hs-var">lint_co_app</span></a><span> </span><a href="#local-6989586621679331631"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679331635"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679331642"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">,</span><a href="#local-6989586621679331640"><span class="hs-identifier hs-var">k'2</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1698"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679331638"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Phantom</span><span>
</span><a name="line-1699"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331643"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Phantom</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679331643"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Nominal</span><span class="hs-special">)</span><span>
</span><a name="line-1700"></a><span>                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Second argument in AppCo cannot be R:&quot;</span><span> </span><span class="hs-operator hs-var">$$</span><span>
</span><a name="line-1701"></a><span>                      </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331631"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1702"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331631"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621679331643"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-1703"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331644"><span class="hs-identifier hs-var">k3</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331645"><span class="hs-identifier hs-var">k4</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkAppTy</span><span> </span><a href="#local-6989586621679331636"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679331641"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkAppTy</span><span> </span><a href="#local-6989586621679331637"><span class="hs-identifier hs-var">s2</span></a><span> </span><a href="#local-6989586621679331642"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331638"><span class="hs-identifier hs-var">r1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1704"></a><span>
</span><a name="line-1705"></a><span class="hs-comment">----------</span><span>
</span><a name="line-1706"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForAllCo</span><span> </span><a name="local-6989586621679331646"><a href="#local-6989586621679331646"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-6989586621679331647"><a href="#local-6989586621679331647"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-6989586621679331648"><a href="#local-6989586621679331648"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1707"></a><span>  </span><span class="hs-comment">-- forall over types</span><span>
</span><a name="line-1708"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTyVar</span><span> </span><a href="#local-6989586621679331646"><span class="hs-identifier hs-var">tv1</span></a><span>
</span><a name="line-1709"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331649"><a href="#local-6989586621679331649"><span class="hs-identifier">k2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintStarCoercion"><span class="hs-identifier hs-var">lintStarCoercion</span></a><span> </span><a href="#local-6989586621679331647"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-1710"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331650"><a href="#local-6989586621679331650"><span class="hs-identifier">tv2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">setTyVarKind</span><span> </span><a href="#local-6989586621679331646"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621679331649"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-1711"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#addInScopeVar"><span class="hs-identifier hs-var">addInScopeVar</span></a><span> </span><a href="#local-6989586621679331646"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1712"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1713"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331651"><a href="#local-6989586621679331651"><span class="hs-identifier">k3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331652"><a href="#local-6989586621679331652"><span class="hs-identifier">k4</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331653"><a href="#local-6989586621679331653"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331654"><a href="#local-6989586621679331654"><span class="hs-identifier">t2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331655"><a href="#local-6989586621679331655"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331648"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1714"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331656"><a href="#local-6989586621679331656"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getInScope"><span class="hs-identifier hs-var">getInScope</span></a><span>
</span><a name="line-1715"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331657"><a href="#local-6989586621679331657"><span class="hs-identifier">tyl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInvForAllTy</span><span> </span><a href="#local-6989586621679331646"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621679331653"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1716"></a><span>             </span><a name="local-6989586621679331658"><a href="#local-6989586621679331658"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTvSubst</span><span> </span><a href="#local-6989586621679331656"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1717"></a><span>                     </span><span class="hs-comment">-- We need both the free vars of the `t2` and the</span><span>
</span><a name="line-1718"></a><span>                     </span><span class="hs-comment">-- free vars of the range of the substitution in</span><span>
</span><a name="line-1719"></a><span>                     </span><span class="hs-comment">-- scope. All the free vars of `t2` and `kind_co` should</span><span>
</span><a name="line-1720"></a><span>                     </span><span class="hs-comment">-- already be in `in_scope`, because they've been</span><span>
</span><a name="line-1721"></a><span>                     </span><span class="hs-comment">-- linted and `tv2` has the same unique as `tv1`.</span><span>
</span><a name="line-1722"></a><span>                     </span><span class="hs-comment">-- See Note [The substitution invariant]</span><span>
</span><a name="line-1723"></a><span>                     </span><span class="hs-identifier hs-var">unitVarEnv</span><span> </span><a href="#local-6989586621679331646"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyVarTy</span><span> </span><a href="#local-6989586621679331650"><span class="hs-identifier hs-var">tv2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mkCastTy</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mkSymCo</span><span> </span><a href="#local-6989586621679331647"><span class="hs-identifier hs-var">kind_co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1724"></a><span>             </span><a name="local-6989586621679331659"><a href="#local-6989586621679331659"><span class="hs-identifier">tyr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInvForAllTy</span><span> </span><a href="#local-6989586621679331650"><span class="hs-identifier hs-var">tv2</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1725"></a><span>                   </span><span class="hs-identifier hs-var">substTy</span><span> </span><a href="#local-6989586621679331658"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679331654"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1726"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331651"><span class="hs-identifier hs-var">k3</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331652"><span class="hs-identifier hs-var">k4</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331657"><span class="hs-identifier hs-var">tyl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331659"><span class="hs-identifier hs-var">tyr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331655"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1727"></a><span>
</span><a name="line-1728"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForAllCo</span><span> </span><a name="local-6989586621679331660"><a href="#local-6989586621679331660"><span class="hs-identifier">cv1</span></a></a><span> </span><a name="local-6989586621679331661"><a href="#local-6989586621679331661"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-6989586621679331662"><a href="#local-6989586621679331662"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1729"></a><span>  </span><span class="hs-comment">-- forall over coercions</span><span>
</span><a name="line-1730"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier hs-var">cv1</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1731"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">almostDevoidCoVarOfCo</span><span> </span><a href="#local-6989586621679331660"><span class="hs-identifier hs-var">cv1</span></a><span> </span><a href="#local-6989586621679331662"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1732"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Covar can only appear in Refl and GRefl: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331662"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1733"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331663"><a href="#local-6989586621679331663"><span class="hs-identifier">k2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintStarCoercion"><span class="hs-identifier hs-var">lintStarCoercion</span></a><span> </span><a href="#local-6989586621679331661"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-1734"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331664"><a href="#local-6989586621679331664"><span class="hs-identifier">cv2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">setVarType</span><span> </span><a href="#local-6989586621679331660"><span class="hs-identifier hs-var">cv1</span></a><span> </span><a href="#local-6989586621679331663"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-1735"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#addInScopeVar"><span class="hs-identifier hs-var">addInScopeVar</span></a><span> </span><a href="#local-6989586621679331660"><span class="hs-identifier hs-var">cv1</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1736"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1737"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331665"><a href="#local-6989586621679331665"><span class="hs-identifier">k3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331666"><a href="#local-6989586621679331666"><span class="hs-identifier">k4</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331667"><a href="#local-6989586621679331667"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331668"><a href="#local-6989586621679331668"><span class="hs-identifier">t2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331669"><a href="#local-6989586621679331669"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331662"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1738"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkValueKind"><span class="hs-identifier hs-var">checkValueKind</span></a><span> </span><a href="#local-6989586621679331665"><span class="hs-identifier hs-var">k3</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;the body of a ForAllCo over covar:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331662"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1739"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkValueKind"><span class="hs-identifier hs-var">checkValueKind</span></a><span> </span><a href="#local-6989586621679331666"><span class="hs-identifier hs-var">k4</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;the body of a ForAllCo over covar:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331662"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1740"></a><span>           </span><span class="hs-comment">-- See Note [Weird typing rule for ForAllTy] in Type</span><span>
</span><a name="line-1741"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331670"><a href="#local-6989586621679331670"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getInScope"><span class="hs-identifier hs-var">getInScope</span></a><span>
</span><a name="line-1742"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331671"><a href="#local-6989586621679331671"><span class="hs-identifier">tyl</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTyCoInvForAllTy</span><span> </span><a href="#local-6989586621679331660"><span class="hs-identifier hs-var">cv1</span></a><span> </span><a href="#local-6989586621679331667"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1743"></a><span>             </span><a name="local-6989586621679331672"><a href="#local-6989586621679331672"><span class="hs-identifier">r2</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coVarRole</span><span> </span><a href="#local-6989586621679331660"><span class="hs-identifier hs-var">cv1</span></a><span>
</span><a name="line-1744"></a><span>             </span><a name="local-6989586621679331673"><a href="#local-6989586621679331673"><span class="hs-identifier">kind_co'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">downgradeRole</span><span> </span><a href="#local-6989586621679331672"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621679331661"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-1745"></a><span>             </span><a name="local-6989586621679331674"><a href="#local-6989586621679331674"><span class="hs-identifier">eta1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNthCo</span><span> </span><a href="#local-6989586621679331672"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621679331673"><span class="hs-identifier hs-var">kind_co'</span></a><span>
</span><a name="line-1746"></a><span>             </span><a name="local-6989586621679331675"><a href="#local-6989586621679331675"><span class="hs-identifier">eta2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNthCo</span><span> </span><a href="#local-6989586621679331672"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-number">3</span><span> </span><a href="#local-6989586621679331673"><span class="hs-identifier hs-var">kind_co'</span></a><span>
</span><a name="line-1747"></a><span>             </span><a name="local-6989586621679331676"><a href="#local-6989586621679331676"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkCvSubst</span><span> </span><a href="#local-6989586621679331670"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1748"></a><span>                     </span><span class="hs-comment">-- We need both the free vars of the `t2` and the</span><span>
</span><a name="line-1749"></a><span>                     </span><span class="hs-comment">-- free vars of the range of the substitution in</span><span>
</span><a name="line-1750"></a><span>                     </span><span class="hs-comment">-- scope. All the free vars of `t2` and `kind_co` should</span><span>
</span><a name="line-1751"></a><span>                     </span><span class="hs-comment">-- already be in `in_scope`, because they've been</span><span>
</span><a name="line-1752"></a><span>                     </span><span class="hs-comment">-- linted and `cv2` has the same unique as `cv1`.</span><span>
</span><a name="line-1753"></a><span>                     </span><span class="hs-comment">-- See Note [The substitution invariant]</span><span>
</span><a name="line-1754"></a><span>                     </span><span class="hs-identifier hs-var">unitVarEnv</span><span> </span><a href="#local-6989586621679331660"><span class="hs-identifier hs-var">cv1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331674"><span class="hs-identifier hs-var">eta1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mkTransCo</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCoVarCo</span><span> </span><a href="#local-6989586621679331664"><span class="hs-identifier hs-var">cv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1755"></a><span>                                          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mkTransCo</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkSymCo</span><span> </span><a href="#local-6989586621679331675"><span class="hs-identifier hs-var">eta2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1756"></a><span>             </span><a name="local-6989586621679331677"><a href="#local-6989586621679331677"><span class="hs-identifier">tyr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTyCoInvForAllTy</span><span> </span><a href="#local-6989586621679331664"><span class="hs-identifier hs-var">cv2</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1757"></a><span>                   </span><span class="hs-identifier hs-var">substTy</span><span> </span><a href="#local-6989586621679331676"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679331668"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1758"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftedTypeKind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">liftedTypeKind</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331671"><span class="hs-identifier hs-var">tyl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331677"><span class="hs-identifier hs-var">tyr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331669"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1759"></a><span>                   </span><span class="hs-comment">-- See Note [Weird typing rule for ForAllTy] in Type</span><span>
</span><a name="line-1760"></a><span>
</span><a name="line-1761"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331678"><a href="#local-6989586621679331678"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunCo</span><span> </span><a name="local-6989586621679331679"><a href="#local-6989586621679331679"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679331680"><a href="#local-6989586621679331680"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679331681"><a href="#local-6989586621679331681"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1762"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331682"><a href="#local-6989586621679331682"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331683"><a href="#local-6989586621679331683"><span class="hs-identifier">k'1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331684"><a href="#local-6989586621679331684"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331685"><a href="#local-6989586621679331685"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331686"><a href="#local-6989586621679331686"><span class="hs-identifier">r1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331680"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-1763"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331687"><a href="#local-6989586621679331687"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331688"><a href="#local-6989586621679331688"><span class="hs-identifier">k'2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331689"><a href="#local-6989586621679331689"><span class="hs-identifier">s2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331690"><a href="#local-6989586621679331690"><span class="hs-identifier">t2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331691"><a href="#local-6989586621679331691"><span class="hs-identifier">r2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331681"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1764"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331692"><a href="#local-6989586621679331692"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintArrow"><span class="hs-identifier hs-var">lintArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;coercion&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331678"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331682"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679331687"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-1765"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331693"><a href="#local-6989586621679331693"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintArrow"><span class="hs-identifier hs-var">lintArrow</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;coercion&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331678"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331683"><span class="hs-identifier hs-var">k'1</span></a><span> </span><a href="#local-6989586621679331688"><span class="hs-identifier hs-var">k'2</span></a><span>
</span><a name="line-1766"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331680"><span class="hs-identifier hs-var">co1</span></a><span> </span><a href="#local-6989586621679331679"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679331686"><span class="hs-identifier hs-var">r1</span></a><span>
</span><a name="line-1767"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331681"><span class="hs-identifier hs-var">co2</span></a><span> </span><a href="#local-6989586621679331679"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679331691"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-1768"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331692"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331693"><span class="hs-identifier hs-var">k'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkFunTy</span><span> </span><a href="#local-6989586621679331684"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621679331689"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkFunTy</span><span> </span><a href="#local-6989586621679331685"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679331690"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331679"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1769"></a><span>
</span><a name="line-1770"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoVarCo</span><span> </span><a name="local-6989586621679331694"><a href="#local-6989586621679331694"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1771"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isCoVar</span><span> </span><a href="#local-6989586621679331694"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1772"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Bad CoVarCo:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331694"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1773"></a><span>                  </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;With offending type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331694"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1774"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1775"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintTyCoVarInScope"><span class="hs-identifier hs-var">lintTyCoVarInScope</span></a><span> </span><a href="#local-6989586621679331694"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-1776"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331695"><a href="#local-6989586621679331695"><span class="hs-identifier">cv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lookupIdInScope"><span class="hs-identifier hs-var">lookupIdInScope</span></a><span> </span><a href="#local-6989586621679331694"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-1777"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintUnliftedCoVar"><span class="hs-identifier hs-var">lintUnliftedCoVar</span></a><span> </span><a href="#local-6989586621679331694"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-1778"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">coVarKindsTypesRole</span><span> </span><a href="#local-6989586621679331695"><span class="hs-identifier hs-var">cv'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1779"></a><span>
</span><a name="line-1780"></a><span class="hs-comment">-- See Note [Bad unsafe coercion]</span><span>
</span><a name="line-1781"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331696"><a href="#local-6989586621679331696"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">UnivCo</span><span> </span><a name="local-6989586621679331697"><a href="#local-6989586621679331697"><span class="hs-identifier">prov</span></a></a><span> </span><a name="local-6989586621679331698"><a href="#local-6989586621679331698"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679331699"><a href="#local-6989586621679331699"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679331700"><a href="#local-6989586621679331700"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1782"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331722"><a href="#local-6989586621679331722"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331699"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1783"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331723"><a href="#local-6989586621679331723"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintType"><span class="hs-identifier hs-var">lintType</span></a><span> </span><a href="#local-6989586621679331700"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1784"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679331697"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1785"></a><span>           </span><span class="hs-identifier hs-var">UnsafeCoerceProv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- no extra checks</span><span>
</span><a name="line-1786"></a><span>
</span><a name="line-1787"></a><span>           </span><span class="hs-identifier hs-var">PhantomProv</span><span> </span><a name="local-6989586621679331724"><a href="#local-6989586621679331724"><span class="hs-identifier">kco</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331696"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-identifier hs-var">Phantom</span><span> </span><a href="#local-6989586621679331698"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1788"></a><span>                                    </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621679331705"><span class="hs-identifier hs-var">check_kinds</span></a><span> </span><a href="#local-6989586621679331724"><span class="hs-identifier hs-var">kco</span></a><span> </span><a href="#local-6989586621679331722"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679331723"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1789"></a><span>
</span><a name="line-1790"></a><span>           </span><span class="hs-identifier hs-var">ProofIrrelProv</span><span> </span><a name="local-6989586621679331725"><a href="#local-6989586621679331725"><span class="hs-identifier">kco</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isCoercionTy</span><span> </span><a href="#local-6989586621679331699"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1791"></a><span>                                          </span><a href="CoreLint.html#mkBadProofIrrelMsg"><span class="hs-identifier hs-var">mkBadProofIrrelMsg</span></a><span> </span><a href="#local-6989586621679331699"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679331696"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1792"></a><span>                                    </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isCoercionTy</span><span> </span><a href="#local-6989586621679331700"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1793"></a><span>                                          </span><a href="CoreLint.html#mkBadProofIrrelMsg"><span class="hs-identifier hs-var">mkBadProofIrrelMsg</span></a><span> </span><a href="#local-6989586621679331700"><span class="hs-identifier hs-var">ty2</span></a><span> </span><a href="#local-6989586621679331696"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1794"></a><span>                                    </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621679331705"><span class="hs-identifier hs-var">check_kinds</span></a><span> </span><a href="#local-6989586621679331725"><span class="hs-identifier hs-var">kco</span></a><span> </span><a href="#local-6989586621679331722"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679331723"><span class="hs-identifier hs-var">k2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1795"></a><span>
</span><a name="line-1796"></a><span>           </span><span class="hs-identifier hs-var">PluginProv</span><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- no extra checks</span><span>
</span><a name="line-1797"></a><span>
</span><a name="line-1798"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331698"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">Phantom</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">classifiesTypeWithValues</span><span> </span><a href="#local-6989586621679331722"><span class="hs-identifier hs-var">k1</span></a><span>
</span><a name="line-1799"></a><span>                            </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">classifiesTypeWithValues</span><span> </span><a href="#local-6989586621679331723"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1800"></a><span>              </span><span class="hs-special">(</span><a href="#local-6989586621679331703"><span class="hs-identifier hs-var">checkTypes</span></a><span> </span><a href="#local-6989586621679331699"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621679331700"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1801"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331722"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331723"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331699"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331700"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331698"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1802"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1803"></a><span>     </span><a name="local-6989586621679331701"><a href="#local-6989586621679331701"><span class="hs-identifier">report</span></a></a><span> </span><a name="local-6989586621679331706"><a href="#local-6989586621679331706"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Unsafe coercion: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679331706"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1804"></a><span>                     </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;From:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331699"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1805"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;  To:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331700"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1806"></a><span>     </span><span class="hs-identifier">isUnBoxed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PrimRep</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1807"></a><span>     </span><a name="local-6989586621679331702"><a href="#local-6989586621679331702"><span class="hs-identifier">isUnBoxed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">isGcPtrRep</span><span>
</span><a name="line-1808"></a><span>
</span><a name="line-1809"></a><span>       </span><span class="hs-comment">-- see #9122 for discussion of these checks</span><span>
</span><a name="line-1810"></a><span>     </span><a name="local-6989586621679331703"><a href="#local-6989586621679331703"><span class="hs-identifier">checkTypes</span></a></a><span> </span><a name="local-6989586621679331707"><a href="#local-6989586621679331707"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679331708"><a href="#local-6989586621679331708"><span class="hs-identifier">t2</span></a></a><span>
</span><a name="line-1811"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkWarnL"><span class="hs-identifier hs-var">checkWarnL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679331709"><span class="hs-identifier hs-var">lev_poly1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1812"></a><span>                         </span><span class="hs-special">(</span><a href="#local-6989586621679331701"><span class="hs-identifier hs-var">report</span></a><span> </span><span class="hs-string">&quot;left-hand type is levity-polymorphic&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1813"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkWarnL"><span class="hs-identifier hs-var">checkWarnL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679331710"><span class="hs-identifier hs-var">lev_poly2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1814"></a><span>                         </span><span class="hs-special">(</span><a href="#local-6989586621679331701"><span class="hs-identifier hs-var">report</span></a><span> </span><span class="hs-string">&quot;right-hand type is levity-polymorphic&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1815"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331709"><span class="hs-identifier hs-var">lev_poly1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679331710"><span class="hs-identifier hs-var">lev_poly2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1816"></a><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkWarnL"><span class="hs-identifier hs-var">checkWarnL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331711"><span class="hs-identifier hs-var">reps1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">equalLength</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331712"><span class="hs-identifier hs-var">reps2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1817"></a><span>                              </span><span class="hs-special">(</span><a href="#local-6989586621679331701"><span class="hs-identifier hs-var">report</span></a><span> </span><span class="hs-string">&quot;between values with different # of reps&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1818"></a><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">zipWithM_</span><span> </span><a href="#local-6989586621679331704"><span class="hs-identifier hs-var">validateCoercion</span></a><span> </span><a href="#local-6989586621679331711"><span class="hs-identifier hs-var">reps1</span></a><span> </span><a href="#local-6989586621679331712"><span class="hs-identifier hs-var">reps2</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1819"></a><span>       </span><span class="hs-keyword">where</span><span>
</span><a name="line-1820"></a><span>         </span><a name="local-6989586621679331709"><a href="#local-6989586621679331709"><span class="hs-identifier">lev_poly1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isTypeLevPoly</span><span> </span><a href="#local-6989586621679331707"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1821"></a><span>         </span><a name="local-6989586621679331710"><a href="#local-6989586621679331710"><span class="hs-identifier">lev_poly2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isTypeLevPoly</span><span> </span><a href="#local-6989586621679331708"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1822"></a><span>
</span><a name="line-1823"></a><span>         </span><span class="hs-comment">-- don't look at these unless lev_poly1/2 are False</span><span>
</span><a name="line-1824"></a><span>         </span><span class="hs-comment">-- Otherwise, we get #13458</span><span>
</span><a name="line-1825"></a><span>         </span><a name="local-6989586621679331711"><a href="#local-6989586621679331711"><span class="hs-identifier">reps1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typePrimRep</span><span> </span><a href="#local-6989586621679331707"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1826"></a><span>         </span><a name="local-6989586621679331712"><a href="#local-6989586621679331712"><span class="hs-identifier">reps2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typePrimRep</span><span> </span><a href="#local-6989586621679331708"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1827"></a><span>
</span><a name="line-1828"></a><span>     </span><span class="hs-identifier">validateCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PrimRep</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PrimRep</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1829"></a><span>     </span><a name="local-6989586621679331704"><a href="#local-6989586621679331704"><span class="hs-identifier">validateCoercion</span></a></a><span> </span><a name="local-6989586621679331713"><a href="#local-6989586621679331713"><span class="hs-identifier">rep1</span></a></a><span> </span><a name="local-6989586621679331714"><a href="#local-6989586621679331714"><span class="hs-identifier">rep2</span></a></a><span>
</span><a name="line-1830"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331715"><a href="#local-6989586621679331715"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1831"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkWarnL"><span class="hs-identifier hs-var">checkWarnL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331702"><span class="hs-identifier hs-var">isUnBoxed</span></a><span> </span><a href="#local-6989586621679331713"><span class="hs-identifier hs-var">rep1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679331702"><span class="hs-identifier hs-var">isUnBoxed</span></a><span> </span><a href="#local-6989586621679331714"><span class="hs-identifier hs-var">rep2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1832"></a><span>                         </span><span class="hs-special">(</span><a href="#local-6989586621679331701"><span class="hs-identifier hs-var">report</span></a><span> </span><span class="hs-string">&quot;between unboxed and boxed value&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1833"></a><span>            </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#checkWarnL"><span class="hs-identifier hs-var">checkWarnL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyCon.primRepSizeB</span><span> </span><a href="#local-6989586621679331715"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679331713"><span class="hs-identifier hs-var">rep1</span></a><span>
</span><a name="line-1834"></a><span>                           </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">TyCon.primRepSizeB</span><span> </span><a href="#local-6989586621679331715"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621679331714"><span class="hs-identifier hs-var">rep2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1835"></a><span>                         </span><span class="hs-special">(</span><a href="#local-6989586621679331701"><span class="hs-identifier hs-var">report</span></a><span> </span><span class="hs-string">&quot;between unboxed values of different size&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1836"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331716"><a href="#local-6989586621679331716"><span class="hs-identifier">fl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyCon.primRepIsFloat</span><span> </span><a href="#local-6989586621679331713"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1837"></a><span>                                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyCon.primRepIsFloat</span><span> </span><a href="#local-6989586621679331714"><span class="hs-identifier hs-var">rep2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1838"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679331716"><span class="hs-identifier hs-var">fl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1839"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#addWarnL"><span class="hs-identifier hs-var">addWarnL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331701"><span class="hs-identifier hs-var">report</span></a><span> </span><span class="hs-string">&quot;between vector types&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1840"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#addWarnL"><span class="hs-identifier hs-var">addWarnL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331701"><span class="hs-identifier hs-var">report</span></a><span> </span><span class="hs-string">&quot;between float and integral values&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1841"></a><span>                </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1842"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-1843"></a><span>
</span><a name="line-1844"></a><span>     </span><a name="local-6989586621679331705"><a href="#local-6989586621679331705"><span class="hs-identifier">check_kinds</span></a></a><span> </span><a name="local-6989586621679331717"><a href="#local-6989586621679331717"><span class="hs-identifier">kco</span></a></a><span> </span><a name="local-6989586621679331718"><a href="#local-6989586621679331718"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621679331719"><a href="#local-6989586621679331719"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331720"><a href="#local-6989586621679331720"><span class="hs-identifier">k1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331721"><a href="#local-6989586621679331721"><span class="hs-identifier">k2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintStarCoercion"><span class="hs-identifier hs-var">lintStarCoercion</span></a><span> </span><a href="#local-6989586621679331717"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-1845"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331718"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621679331720"><span class="hs-identifier hs-var">k1'</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkBadUnivCoMsg"><span class="hs-identifier hs-var">mkBadUnivCoMsg</span></a><span> </span><span class="hs-identifier hs-var">CLeft</span><span>  </span><a href="#local-6989586621679331696"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1846"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331719"><span class="hs-identifier hs-var">k2</span></a><span> </span><a href="#local-6989586621679331721"><span class="hs-identifier hs-var">k2'</span></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#mkBadUnivCoMsg"><span class="hs-identifier hs-var">mkBadUnivCoMsg</span></a><span> </span><span class="hs-identifier hs-var">CRight</span><span> </span><a href="#local-6989586621679331696"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1847"></a><span>
</span><a name="line-1848"></a><span>
</span><a name="line-1849"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SymCo</span><span> </span><a name="local-6989586621679331726"><a href="#local-6989586621679331726"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1850"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331727"><a href="#local-6989586621679331727"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331728"><a href="#local-6989586621679331728"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331729"><a href="#local-6989586621679331729"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331730"><a href="#local-6989586621679331730"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331731"><a href="#local-6989586621679331731"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331726"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1851"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331728"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331727"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331730"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331729"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331731"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1852"></a><span>
</span><a name="line-1853"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331732"><a href="#local-6989586621679331732"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">TransCo</span><span> </span><a name="local-6989586621679331733"><a href="#local-6989586621679331733"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621679331734"><a href="#local-6989586621679331734"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1854"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331735"><a href="#local-6989586621679331735"><span class="hs-identifier">k1a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331736"><a href="#local-6989586621679331736"><span class="hs-identifier">_k1b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331737"><a href="#local-6989586621679331737"><span class="hs-identifier">ty1a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331738"><a href="#local-6989586621679331738"><span class="hs-identifier">ty1b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331739"><a href="#local-6989586621679331739"><span class="hs-identifier">r1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331733"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-1855"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331740"><a href="#local-6989586621679331740"><span class="hs-identifier">_k2a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331741"><a href="#local-6989586621679331741"><span class="hs-identifier">k2b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331742"><a href="#local-6989586621679331742"><span class="hs-identifier">ty2a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331743"><a href="#local-6989586621679331743"><span class="hs-identifier">ty2b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331744"><a href="#local-6989586621679331744"><span class="hs-identifier">r2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331734"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-1856"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier hs-var">ensureEqTys</span></a><span> </span><a href="#local-6989586621679331738"><span class="hs-identifier hs-var">ty1b</span></a><span> </span><a href="#local-6989586621679331742"><span class="hs-identifier hs-var">ty2a</span></a><span>
</span><a name="line-1857"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Trans coercion mis-match:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331732"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1858"></a><span>                   </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331737"><span class="hs-identifier hs-var">ty1a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331738"><span class="hs-identifier hs-var">ty1b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331742"><span class="hs-identifier hs-var">ty2a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331743"><span class="hs-identifier hs-var">ty2b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1859"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331732"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679331739"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621679331744"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-1860"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331735"><span class="hs-identifier hs-var">k1a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331741"><span class="hs-identifier hs-var">k2b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331737"><span class="hs-identifier hs-var">ty1a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331743"><span class="hs-identifier hs-var">ty2b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331739"><span class="hs-identifier hs-var">r1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1861"></a><span>
</span><a name="line-1862"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331745"><a href="#local-6989586621679331745"><span class="hs-identifier">the_co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">NthCo</span><span> </span><a name="local-6989586621679331746"><a href="#local-6989586621679331746"><span class="hs-identifier">r0</span></a></a><span> </span><a name="local-6989586621679331747"><a href="#local-6989586621679331747"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679331748"><a href="#local-6989586621679331748"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1863"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331749"><a href="#local-6989586621679331749"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331750"><a href="#local-6989586621679331750"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331751"><a href="#local-6989586621679331751"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331748"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1864"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitForAllTy_maybe</span><span> </span><a href="#local-6989586621679331749"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">splitForAllTy_maybe</span><span> </span><a href="#local-6989586621679331750"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1865"></a><span>         </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331752"><a href="#local-6989586621679331752"><span class="hs-identifier">tcv_s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331753"><a href="#local-6989586621679331753"><span class="hs-identifier">_ty_s</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331754"><a href="#local-6989586621679331754"><span class="hs-identifier">tcv_t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331755"><a href="#local-6989586621679331755"><span class="hs-identifier">_ty_t</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1866"></a><span>             </span><span class="hs-comment">-- works for both tyvar and covar</span><span>
</span><a name="line-1867"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331747"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1868"></a><span>             </span><span class="hs-special">,</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isForAllTy_ty</span><span> </span><a href="#local-6989586621679331749"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isForAllTy_ty</span><span> </span><a href="#local-6989586621679331750"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1869"></a><span>             </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isForAllTy_co</span><span> </span><a href="#local-6989586621679331749"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isForAllTy_co</span><span> </span><a href="#local-6989586621679331750"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1870"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331745"><span class="hs-identifier hs-var">the_co</span></a><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621679331746"><span class="hs-identifier hs-var">r0</span></a><span>
</span><a name="line-1871"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331758"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331759"><span class="hs-identifier hs-var">kt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331756"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331757"><span class="hs-identifier hs-var">tt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331746"><span class="hs-identifier hs-var">r0</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1872"></a><span>             </span><span class="hs-keyword">where</span><span>
</span><a name="line-1873"></a><span>               </span><a name="local-6989586621679331756"><a href="#local-6989586621679331756"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331752"><span class="hs-identifier hs-var">tcv_s</span></a><span>
</span><a name="line-1874"></a><span>               </span><a name="local-6989586621679331757"><a href="#local-6989586621679331757"><span class="hs-identifier">tt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331754"><span class="hs-identifier hs-var">tcv_t</span></a><span>
</span><a name="line-1875"></a><span>               </span><a name="local-6989586621679331758"><a href="#local-6989586621679331758"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331756"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-1876"></a><span>               </span><a name="local-6989586621679331759"><a href="#local-6989586621679331759"><span class="hs-identifier">kt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331757"><span class="hs-identifier hs-var">tt</span></a><span>
</span><a name="line-1877"></a><span>
</span><a name="line-1878"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitTyConApp_maybe</span><span> </span><a href="#local-6989586621679331749"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">splitTyConApp_maybe</span><span> </span><a href="#local-6989586621679331750"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1879"></a><span>         </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331760"><a href="#local-6989586621679331760"><span class="hs-identifier">tc_s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331761"><a href="#local-6989586621679331761"><span class="hs-identifier">tys_s</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331762"><a href="#local-6989586621679331762"><span class="hs-identifier">tc_t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331763"><a href="#local-6989586621679331763"><span class="hs-identifier">tys_t</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1880"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331760"><span class="hs-identifier hs-var">tc_s</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679331762"><span class="hs-identifier hs-var">tc_t</span></a><span>
</span><a name="line-1881"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isInjectiveTyCon</span><span> </span><a href="#local-6989586621679331760"><span class="hs-identifier hs-var">tc_s</span></a><span> </span><a href="#local-6989586621679331751"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1882"></a><span>                 </span><span class="hs-comment">-- see Note [NthCo and newtypes] in TyCoRep</span><span>
</span><a name="line-1883"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331761"><span class="hs-identifier hs-var">tys_s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">equalLength</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331763"><span class="hs-identifier hs-var">tys_t</span></a><span>
</span><a name="line-1884"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331761"><span class="hs-identifier hs-var">tys_s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthExceeds</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331747"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1885"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331745"><span class="hs-identifier hs-var">the_co</span></a><span> </span><a href="#local-6989586621679331766"><span class="hs-identifier hs-var">tr</span></a><span> </span><a href="#local-6989586621679331746"><span class="hs-identifier hs-var">r0</span></a><span>
</span><a name="line-1886"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331767"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331768"><span class="hs-identifier hs-var">kt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331764"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331765"><span class="hs-identifier hs-var">tt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331746"><span class="hs-identifier hs-var">r0</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1887"></a><span>             </span><span class="hs-keyword">where</span><span>
</span><a name="line-1888"></a><span>               </span><a name="local-6989586621679331764"><a href="#local-6989586621679331764"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getNth</span><span> </span><a href="#local-6989586621679331761"><span class="hs-identifier hs-var">tys_s</span></a><span> </span><a href="#local-6989586621679331747"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1889"></a><span>               </span><a name="local-6989586621679331765"><a href="#local-6989586621679331765"><span class="hs-identifier">tt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getNth</span><span> </span><a href="#local-6989586621679331763"><span class="hs-identifier hs-var">tys_t</span></a><span> </span><a href="#local-6989586621679331747"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1890"></a><span>               </span><a name="local-6989586621679331766"><a href="#local-6989586621679331766"><span class="hs-identifier">tr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nthRole</span><span> </span><a href="#local-6989586621679331751"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679331760"><span class="hs-identifier hs-var">tc_s</span></a><span> </span><a href="#local-6989586621679331747"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1891"></a><span>               </span><a name="local-6989586621679331767"><a href="#local-6989586621679331767"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331764"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-1892"></a><span>               </span><a name="local-6989586621679331768"><a href="#local-6989586621679331768"><span class="hs-identifier">kt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331765"><span class="hs-identifier hs-var">tt</span></a><span>
</span><a name="line-1893"></a><span>
</span><a name="line-1894"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Bad getNth:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1895"></a><span>                              </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331745"><span class="hs-identifier hs-var">the_co</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331749"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331750"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1896"></a><span>
</span><a name="line-1897"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331769"><a href="#local-6989586621679331769"><span class="hs-identifier">the_co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">LRCo</span><span> </span><a name="local-6989586621679331770"><a href="#local-6989586621679331770"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621679331771"><a href="#local-6989586621679331771"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1898"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679331772"><a href="#local-6989586621679331772"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331773"><a href="#local-6989586621679331773"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331774"><a href="#local-6989586621679331774"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331771"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1899"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331771"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621679331774"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1900"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitAppTy_maybe</span><span> </span><a href="#local-6989586621679331772"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">splitAppTy_maybe</span><span> </span><a href="#local-6989586621679331773"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1901"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331775"><a href="#local-6989586621679331775"><span class="hs-identifier">s_pr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331776"><a href="#local-6989586621679331776"><span class="hs-identifier">t_pr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1902"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331779"><span class="hs-identifier hs-var">ks_pick</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331780"><span class="hs-identifier hs-var">kt_pick</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331777"><span class="hs-identifier hs-var">s_pick</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331778"><span class="hs-identifier hs-var">t_pick</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nominal</span><span class="hs-special">)</span><span>
</span><a name="line-1903"></a><span>             </span><span class="hs-keyword">where</span><span>
</span><a name="line-1904"></a><span>               </span><a name="local-6989586621679331777"><a href="#local-6989586621679331777"><span class="hs-identifier">s_pick</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pickLR</span><span> </span><a href="#local-6989586621679331770"><span class="hs-identifier hs-var">lr</span></a><span> </span><a href="#local-6989586621679331775"><span class="hs-identifier hs-var">s_pr</span></a><span>
</span><a name="line-1905"></a><span>               </span><a name="local-6989586621679331778"><a href="#local-6989586621679331778"><span class="hs-identifier">t_pick</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pickLR</span><span> </span><a href="#local-6989586621679331770"><span class="hs-identifier hs-var">lr</span></a><span> </span><a href="#local-6989586621679331776"><span class="hs-identifier hs-var">t_pr</span></a><span>
</span><a name="line-1906"></a><span>               </span><a name="local-6989586621679331779"><a href="#local-6989586621679331779"><span class="hs-identifier">ks_pick</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331777"><span class="hs-identifier hs-var">s_pick</span></a><span>
</span><a name="line-1907"></a><span>               </span><a name="local-6989586621679331780"><a href="#local-6989586621679331780"><span class="hs-identifier">kt_pick</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331778"><span class="hs-identifier hs-var">t_pick</span></a><span>
</span><a name="line-1908"></a><span>
</span><a name="line-1909"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Bad LRCo:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1910"></a><span>                              </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331769"><span class="hs-identifier hs-var">the_co</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331772"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331773"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1911"></a><span>
</span><a name="line-1912"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InstCo</span><span> </span><a name="local-6989586621679331781"><a href="#local-6989586621679331781"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679331782"><a href="#local-6989586621679331782"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1913"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331783"><a href="#local-6989586621679331783"><span class="hs-identifier">k3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331784"><a href="#local-6989586621679331784"><span class="hs-identifier">k4</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331785"><a href="#local-6989586621679331785"><span class="hs-identifier">t1'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331786"><a href="#local-6989586621679331786"><span class="hs-identifier">t2'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331787"><a href="#local-6989586621679331787"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331781"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1914"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331788"><a href="#local-6989586621679331788"><span class="hs-identifier">k1'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331789"><a href="#local-6989586621679331789"><span class="hs-identifier">k2'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331790"><a href="#local-6989586621679331790"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331791"><a href="#local-6989586621679331791"><span class="hs-identifier">s2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331792"><a href="#local-6989586621679331792"><span class="hs-identifier">r'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331782"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1915"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331782"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621679331792"><span class="hs-identifier hs-var">r'</span></a><span>
</span><a name="line-1916"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331793"><a href="#local-6989586621679331793"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getInScope"><span class="hs-identifier hs-var">getInScope</span></a><span>
</span><a name="line-1917"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitForAllTy_ty_maybe</span><span> </span><a href="#local-6989586621679331785"><span class="hs-identifier hs-var">t1'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">splitForAllTy_ty_maybe</span><span> </span><a href="#local-6989586621679331786"><span class="hs-identifier hs-var">t2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1918"></a><span>         </span><span class="hs-comment">-- forall over tvar</span><span>
</span><a name="line-1919"></a><span>         </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331794"><a href="#local-6989586621679331794"><span class="hs-identifier">tv1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331795"><a href="#local-6989586621679331795"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331796"><a href="#local-6989586621679331796"><span class="hs-identifier">tv2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331797"><a href="#local-6989586621679331797"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1920"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331788"><span class="hs-identifier hs-var">k1'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621679331794"><span class="hs-identifier hs-var">tv1</span></a><span>
</span><a name="line-1921"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331789"><span class="hs-identifier hs-var">k2'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621679331796"><span class="hs-identifier hs-var">tv2</span></a><span>
</span><a name="line-1922"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331783"><span class="hs-identifier hs-var">k3</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331784"><span class="hs-identifier hs-var">k4</span></a><span class="hs-special">,</span><span>
</span><a name="line-1923"></a><span>                        </span><span class="hs-identifier hs-var">substTyWithInScope</span><span> </span><a href="#local-6989586621679331793"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331794"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331790"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679331795"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><span>
</span><a name="line-1924"></a><span>                        </span><span class="hs-identifier hs-var">substTyWithInScope</span><span> </span><a href="#local-6989586621679331793"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331796"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331791"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679331797"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331787"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1925"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1926"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Kind mis-match in inst coercion&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1927"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitForAllTy_co_maybe</span><span> </span><a href="#local-6989586621679331785"><span class="hs-identifier hs-var">t1'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">splitForAllTy_co_maybe</span><span> </span><a href="#local-6989586621679331786"><span class="hs-identifier hs-var">t2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1928"></a><span>         </span><span class="hs-comment">-- forall over covar</span><span>
</span><a name="line-1929"></a><span>         </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331798"><a href="#local-6989586621679331798"><span class="hs-identifier">cv1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331799"><a href="#local-6989586621679331799"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331800"><a href="#local-6989586621679331800"><span class="hs-identifier">cv2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331801"><a href="#local-6989586621679331801"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1930"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331788"><span class="hs-identifier hs-var">k1'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331798"><span class="hs-identifier hs-var">cv1</span></a><span>
</span><a name="line-1931"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331789"><span class="hs-identifier hs-var">k2'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679331800"><span class="hs-identifier hs-var">cv2</span></a><span>
</span><a name="line-1932"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">CoercionTy</span><span> </span><a name="local-6989586621679331802"><a href="#local-6989586621679331802"><span class="hs-identifier">s1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331790"><span class="hs-identifier hs-var">s1</span></a><span>
</span><a name="line-1933"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">CoercionTy</span><span> </span><a name="local-6989586621679331803"><a href="#local-6989586621679331803"><span class="hs-identifier">s2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331791"><span class="hs-identifier hs-var">s2</span></a><span>
</span><a name="line-1934"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1935"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftedTypeKind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">liftedTypeKind</span><span>
</span><a name="line-1936"></a><span>                          </span><span class="hs-comment">-- See Note [Weird typing rule for ForAllTy] in Type</span><span>
</span><a name="line-1937"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">substTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCvSubst</span><span> </span><a href="#local-6989586621679331793"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unitVarEnv</span><span> </span><a href="#local-6989586621679331798"><span class="hs-identifier hs-var">cv1</span></a><span> </span><a href="#local-6989586621679331802"><span class="hs-identifier hs-var">s1'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331799"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1938"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">substTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCvSubst</span><span> </span><a href="#local-6989586621679331793"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unitVarEnv</span><span> </span><a href="#local-6989586621679331800"><span class="hs-identifier hs-var">cv2</span></a><span> </span><a href="#local-6989586621679331803"><span class="hs-identifier hs-var">s2'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331801"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1939"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331787"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1940"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1941"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Kind mis-match in inst coercion&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1942"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Bad argument of inst&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1943"></a><span>
</span><a name="line-1944"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331804"><a href="#local-6989586621679331804"><span class="hs-identifier">co</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">AxiomInstCo</span><span> </span><a name="local-6989586621679331805"><a href="#local-6989586621679331805"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679331806"><a href="#local-6989586621679331806"><span class="hs-identifier">ind</span></a></a><span> </span><a name="local-6989586621679331807"><a href="#local-6989586621679331807"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1945"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679331806"><span class="hs-identifier hs-var">ind</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679331806"><span class="hs-identifier hs-var">ind</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier hs-var">numBranches</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coAxiomBranches</span><span> </span><a href="#local-6989586621679331805"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1946"></a><span>                </span><span class="hs-special">(</span><a href="#local-6989586621679331808"><span class="hs-identifier hs-var">bad_ax</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;index out of range&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1947"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">CoAxBranch</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cab_tvs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331823"><a href="#local-6989586621679331823"><span class="hs-identifier">ktvs</span></a></a><span>
</span><a name="line-1948"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_cvs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331824"><a href="#local-6989586621679331824"><span class="hs-identifier">cvs</span></a></a><span>
</span><a name="line-1949"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331825"><a href="#local-6989586621679331825"><span class="hs-identifier">roles</span></a></a><span>
</span><a name="line-1950"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_lhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331826"><a href="#local-6989586621679331826"><span class="hs-identifier">lhs</span></a></a><span>
</span><a name="line-1951"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_rhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679331827"><a href="#local-6989586621679331827"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coAxiomNthBranch</span><span> </span><a href="#local-6989586621679331805"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621679331806"><span class="hs-identifier hs-var">ind</span></a><span>
</span><a name="line-1952"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331807"><span class="hs-identifier hs-var">cos</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331823"><span class="hs-identifier hs-var">ktvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679331824"><span class="hs-identifier hs-var">cvs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1953"></a><span>           </span><a href="#local-6989586621679331808"><span class="hs-identifier hs-var">bad_ax</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;lengths&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1954"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679331828"><a href="#local-6989586621679331828"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier hs-var">getTCvSubst</span></a><span>
</span><a name="line-1955"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331829"><a href="#local-6989586621679331829"><span class="hs-identifier">empty_subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zapTCvSubst</span><span> </span><a href="#local-6989586621679331828"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-1956"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331830"><a href="#local-6989586621679331830"><span class="hs-identifier">subst_l</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331831"><a href="#local-6989586621679331831"><span class="hs-identifier">subst_r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">foldlM</span><span> </span><a href="#local-6989586621679331809"><span class="hs-identifier hs-var">check_ki</span></a><span>
</span><a name="line-1957"></a><span>                                      </span><span class="hs-special">(</span><a href="#local-6989586621679331829"><span class="hs-identifier hs-var">empty_subst</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331829"><span class="hs-identifier hs-var">empty_subst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1958"></a><span>                                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip3</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331823"><span class="hs-identifier hs-var">ktvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679331824"><span class="hs-identifier hs-var">cvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331825"><span class="hs-identifier hs-var">roles</span></a><span> </span><a href="#local-6989586621679331807"><span class="hs-identifier hs-var">cos</span></a><span class="hs-special">)</span><span>
</span><a name="line-1959"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331832"><a href="#local-6989586621679331832"><span class="hs-identifier">lhs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTys</span><span> </span><a href="#local-6989586621679331830"><span class="hs-identifier hs-var">subst_l</span></a><span> </span><a href="#local-6989586621679331826"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-1960"></a><span>             </span><a name="local-6989586621679331833"><a href="#local-6989586621679331833"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTy</span><span>  </span><a href="#local-6989586621679331831"><span class="hs-identifier hs-var">subst_r</span></a><span> </span><a href="#local-6989586621679331827"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1961"></a><span>             </span><a name="local-6989586621679331834"><a href="#local-6989586621679331834"><span class="hs-identifier">fam_tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coAxiomTyCon</span><span> </span><a href="#local-6989586621679331805"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-1962"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">checkAxInstCo</span><span> </span><a href="#local-6989586621679331804"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1963"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331835"><a href="#local-6989586621679331835"><span class="hs-identifier">bad_branch</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679331808"><span class="hs-identifier hs-var">bad_ax</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;inconsistent with&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-1964"></a><span>                                       </span><span class="hs-identifier hs-var">pprCoAxBranch</span><span> </span><a href="#local-6989586621679331834"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-6989586621679331835"><span class="hs-identifier hs-var">bad_branch</span></a><span>
</span><a name="line-1965"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1966"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331836"><a href="#local-6989586621679331836"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621679331834"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-6989586621679331832"><span class="hs-identifier hs-var">lhs'</span></a><span>
</span><a name="line-1967"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331836"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331833"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331836"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331833"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">coAxiomRole</span><span> </span><a href="#local-6989586621679331805"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1968"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1969"></a><span>    </span><a name="local-6989586621679331808"><a href="#local-6989586621679331808"><span class="hs-identifier">bad_ax</span></a></a><span> </span><a name="local-6989586621679331810"><a href="#local-6989586621679331810"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span>  </span><span class="hs-string">&quot;Bad axiom application&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">parens</span><span> </span><a href="#local-6989586621679331810"><span class="hs-identifier hs-var">what</span></a><span class="hs-special">)</span><span>
</span><a name="line-1970"></a><span>                        </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331804"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1971"></a><span>
</span><a name="line-1972"></a><span>    </span><a name="local-6989586621679331809"><a href="#local-6989586621679331809"><span class="hs-identifier">check_ki</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331811"><a href="#local-6989586621679331811"><span class="hs-identifier">subst_l</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331812"><a href="#local-6989586621679331812"><span class="hs-identifier">subst_r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331813"><a href="#local-6989586621679331813"><span class="hs-identifier">ktv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">role</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331815"><a href="#local-6989586621679331815"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1973"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331816"><a href="#local-6989586621679331816"><span class="hs-identifier">k'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331817"><a href="#local-6989586621679331817"><span class="hs-identifier">k''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331818"><a href="#local-6989586621679331818"><span class="hs-identifier">s'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331819"><a href="#local-6989586621679331819"><span class="hs-identifier">t'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331820"><a href="#local-6989586621679331820"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331815"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1974"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331815"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-keyword">role</span><span> </span><a href="#local-6989586621679331820"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1975"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331821"><a href="#local-6989586621679331821"><span class="hs-identifier">ktv_kind_l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTy</span><span> </span><a href="#local-6989586621679331811"><span class="hs-identifier hs-var">subst_l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621679331813"><span class="hs-identifier hs-var">ktv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1976"></a><span>                 </span><a name="local-6989586621679331822"><a href="#local-6989586621679331822"><span class="hs-identifier">ktv_kind_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTy</span><span> </span><a href="#local-6989586621679331812"><span class="hs-identifier hs-var">subst_r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621679331813"><span class="hs-identifier hs-var">ktv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1977"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331816"><span class="hs-identifier hs-var">k'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331821"><span class="hs-identifier hs-var">ktv_kind_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1978"></a><span>                    </span><span class="hs-special">(</span><a href="#local-6989586621679331808"><span class="hs-identifier hs-var">bad_ax</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;check_ki1&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331804"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331816"><span class="hs-identifier hs-var">k'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331813"><span class="hs-identifier hs-var">ktv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331821"><span class="hs-identifier hs-var">ktv_kind_l</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1979"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331817"><span class="hs-identifier hs-var">k''</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331822"><span class="hs-identifier hs-var">ktv_kind_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1980"></a><span>                    </span><span class="hs-special">(</span><a href="#local-6989586621679331808"><span class="hs-identifier hs-var">bad_ax</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;check_ki2&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331804"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331817"><span class="hs-identifier hs-var">k''</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331813"><span class="hs-identifier hs-var">ktv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331822"><span class="hs-identifier hs-var">ktv_kind_r</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1981"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">extendTCvSubst</span><span> </span><a href="#local-6989586621679331811"><span class="hs-identifier hs-var">subst_l</span></a><span> </span><a href="#local-6989586621679331813"><span class="hs-identifier hs-var">ktv</span></a><span> </span><a href="#local-6989586621679331818"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1982"></a><span>                     </span><span class="hs-identifier hs-var">extendTCvSubst</span><span> </span><a href="#local-6989586621679331812"><span class="hs-identifier hs-var">subst_r</span></a><span> </span><a href="#local-6989586621679331813"><span class="hs-identifier hs-var">ktv</span></a><span> </span><a href="#local-6989586621679331819"><span class="hs-identifier hs-var">t'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1983"></a><span>
</span><a name="line-1984"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KindCo</span><span> </span><a name="local-6989586621679331837"><a href="#local-6989586621679331837"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1985"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331838"><a href="#local-6989586621679331838"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331839"><a href="#local-6989586621679331839"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331837"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1986"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftedTypeKind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">liftedTypeKind</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331838"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331839"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nominal</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1987"></a><span>
</span><a name="line-1988"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SubCo</span><span> </span><a name="local-6989586621679331840"><a href="#local-6989586621679331840"><span class="hs-identifier">co'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1989"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679331841"><a href="#local-6989586621679331841"><span class="hs-identifier">k1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331842"><a href="#local-6989586621679331842"><span class="hs-identifier">k2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331843"><a href="#local-6989586621679331843"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331844"><a href="#local-6989586621679331844"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331845"><a href="#local-6989586621679331845"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331840"><span class="hs-identifier hs-var">co'</span></a><span>
</span><a name="line-1990"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintRole"><span class="hs-identifier hs-var">lintRole</span></a><span> </span><a href="#local-6989586621679331840"><span class="hs-identifier hs-var">co'</span></a><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621679331845"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1991"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331841"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><a href="#local-6989586621679331842"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><a href="#local-6989586621679331843"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><a href="#local-6989586621679331844"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">Representational</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1992"></a><span>
</span><a name="line-1993"></a><span class="hs-identifier">lintCoercion</span><span> </span><a name="local-6989586621679331846"><a href="#local-6989586621679331846"><span class="hs-identifier">this</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">AxiomRuleCo</span><span> </span><a name="local-6989586621679331847"><a href="#local-6989586621679331847"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679331848"><a href="#local-6989586621679331848"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1994"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331862"><a href="#local-6989586621679331862"><span class="hs-identifier">eqs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><a href="#local-6989586621679331848"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-1995"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621679331850"><span class="hs-identifier hs-var">lintRoles</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">coaxrAsmpRoles</span><span> </span><a href="#local-6989586621679331847"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331862"><span class="hs-identifier hs-var">eqs</span></a><span>
</span><a name="line-1996"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">coaxrProves</span><span> </span><a href="#local-6989586621679331847"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">Pair</span><span> </span><a href="#local-6989586621679331863"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679331864"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679331863"><a href="#local-6989586621679331863"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331864"><a href="#local-6989586621679331864"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331862"><span class="hs-identifier hs-var">eqs</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1997"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679331849"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-string">&quot;Malformed use of AxiomRuleCo&quot;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331846"><span class="hs-identifier hs-var">this</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1998"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Pair</span><span> </span><a name="local-6989586621679331865"><a href="#local-6989586621679331865"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679331866"><a href="#local-6989586621679331866"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1999"></a><span>             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331865"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679331866"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331865"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331866"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">coaxrRole</span><span> </span><a href="#local-6989586621679331847"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2000"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2001"></a><span>  </span><a name="local-6989586621679331849"><a href="#local-6989586621679331849"><span class="hs-identifier">err</span></a></a><span> </span><a name="local-6989586621679331851"><a href="#local-6989586621679331851"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679331852"><a href="#local-6989586621679331852"><span class="hs-identifier">xs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2002"></a><span>                </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621679331851"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Rule:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">coaxrName</span><span> </span><a href="#local-6989586621679331847"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679331852"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2003"></a><span>
</span><a name="line-2004"></a><span>  </span><a name="local-6989586621679331850"><a href="#local-6989586621679331850"><span class="hs-identifier">lintRoles</span></a></a><span> </span><a name="local-6989586621679331853"><a href="#local-6989586621679331853"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331854"><a href="#local-6989586621679331854"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679331855"><a href="#local-6989586621679331855"><span class="hs-identifier">es</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679331856"><a href="#local-6989586621679331856"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679331857"><a href="#local-6989586621679331857"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2005"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679331854"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679331856"><span class="hs-identifier hs-var">r</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331850"><span class="hs-identifier hs-var">lintRoles</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331853"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331855"><span class="hs-identifier hs-var">es</span></a><span> </span><a href="#local-6989586621679331857"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-2006"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331849"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-string">&quot;Argument roles mismatch&quot;</span><span>
</span><a name="line-2007"></a><span>                      </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In argument:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331853"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-2008"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Expected:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331854"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-2009"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Found:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331856"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2010"></a><span>  </span><span class="hs-identifier">lintRoles</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2011"></a><span>  </span><span class="hs-identifier">lintRoles</span><span> </span><a name="local-6989586621679331858"><a href="#local-6989586621679331858"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679331859"><a href="#local-6989586621679331859"><span class="hs-identifier">rs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331849"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-string">&quot;Too many coercion arguments&quot;</span><span>
</span><a name="line-2012"></a><span>                          </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Expected:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><a href="#local-6989586621679331858"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-2013"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Provided:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331858"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679331859"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2014"></a><span>
</span><a name="line-2015"></a><span>  </span><span class="hs-identifier">lintRoles</span><span> </span><a name="local-6989586621679331860"><a href="#local-6989586621679331860"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679331861"><a href="#local-6989586621679331861"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331849"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-string">&quot;Not enough coercion arguments&quot;</span><span>
</span><a name="line-2016"></a><span>                          </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Expected:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331860"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679331861"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">)</span><span>
</span><a name="line-2017"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Provided:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><a href="#local-6989586621679331860"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2018"></a><span>
</span><a name="line-2019"></a><span class="hs-identifier">lintCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HoleCo</span><span> </span><a name="local-6989586621679331867"><a href="#local-6989586621679331867"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2020"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#addErrL"><span class="hs-identifier hs-var">addErrL</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Unfilled coercion hole:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331867"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-2021"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintCoercion"><span class="hs-identifier hs-var">lintCoercion</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoVarCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coHoleCoVar</span><span> </span><a href="#local-6989586621679331867"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2022"></a><span>
</span><a name="line-2023"></a><span>
</span><a name="line-2024"></a><span class="hs-comment">----------</span><span>
</span><a name="line-2025"></a><span class="hs-identifier">lintUnliftedCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2026"></a><a name="lintUnliftedCoVar"><a href="CoreLint.html#lintUnliftedCoVar"><span class="hs-identifier">lintUnliftedCoVar</span></a></a><span> </span><a name="local-6989586621679331868"><a href="#local-6989586621679331868"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-2027"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isUnliftedType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coVarKind</span><span> </span><a href="#local-6989586621679331868"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2028"></a><span>    </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Bad lifted equality:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331868"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-2029"></a><span>                 </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coVarKind</span><span> </span><a href="#local-6989586621679331868"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2030"></a><span>
</span><a name="line-2031"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[lint-monad]{The Lint monad}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2038"></a><span>
</span><a name="line-2039"></a><span class="hs-comment">-- If you edit this type, you may need to update the GHC formalism</span><span>
</span><a name="line-2040"></a><span class="hs-comment">-- See Note [GHC Formalism]</span><span>
</span><a name="line-2041"></a><span class="hs-keyword">data</span><span> </span><a name="LintEnv"><a href="CoreLint.html#LintEnv"><span class="hs-identifier">LintEnv</span></a></a><span>
</span><a name="line-2042"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="LE"><a href="CoreLint.html#LE"><span class="hs-identifier">LE</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="le_flags"><a href="CoreLint.html#le_flags"><span class="hs-identifier">le_flags</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintFlags"><span class="hs-identifier hs-type">LintFlags</span></a><span>       </span><span class="hs-comment">-- Linting the result of this pass</span><span>
</span><a name="line-2043"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="le_loc"><a href="CoreLint.html#le_loc"><span class="hs-identifier">le_loc</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreLint.html#LintLocInfo"><span class="hs-identifier hs-type">LintLocInfo</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Locations</span><span>
</span><a name="line-2044"></a><span>
</span><a name="line-2045"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="le_subst"><a href="CoreLint.html#le_subst"><span class="hs-identifier">le_subst</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TCvSubst</span><span>  </span><span class="hs-comment">-- Current type substitution</span><span>
</span><a name="line-2046"></a><span>                               </span><span class="hs-comment">-- We also use le_subst to keep track of</span><span>
</span><a name="line-2047"></a><span>                               </span><span class="hs-comment">-- /all variables/ in scope, both Ids and TyVars</span><span>
</span><a name="line-2048"></a><span>
</span><a name="line-2049"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="le_joins"><a href="CoreLint.html#le_joins"><span class="hs-identifier">le_joins</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IdSet</span><span>     </span><span class="hs-comment">-- Join points in scope that are valid</span><span>
</span><a name="line-2050"></a><span>                               </span><span class="hs-comment">-- A subset of the InScopeSet in le_subst</span><span>
</span><a name="line-2051"></a><span>                               </span><span class="hs-comment">-- See Note [Join points]</span><span>
</span><a name="line-2052"></a><span>
</span><a name="line-2053"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="le_dynflags"><a href="CoreLint.html#le_dynflags"><span class="hs-identifier">le_dynflags</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>     </span><span class="hs-comment">-- DynamicFlags</span><span>
</span><a name="line-2054"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-2055"></a><span>
</span><a name="line-2056"></a><span class="hs-keyword">data</span><span> </span><a name="LintFlags"><a href="CoreLint.html#LintFlags"><span class="hs-identifier">LintFlags</span></a></a><span>
</span><a name="line-2057"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="LF"><a href="CoreLint.html#LF"><span class="hs-identifier">LF</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="lf_check_global_ids"><a href="CoreLint.html#lf_check_global_ids"><span class="hs-identifier">lf_check_global_ids</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- See Note [Checking for global Ids]</span><span>
</span><a name="line-2058"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="lf_check_inline_loop_breakers"><a href="CoreLint.html#lf_check_inline_loop_breakers"><span class="hs-identifier">lf_check_inline_loop_breakers</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- See Note [Checking for INLINE loop breakers]</span><span>
</span><a name="line-2059"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="lf_check_static_ptrs"><a href="CoreLint.html#lf_check_static_ptrs"><span class="hs-identifier">lf_check_static_ptrs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#StaticPtrCheck"><span class="hs-identifier hs-type">StaticPtrCheck</span></a><span> </span><span class="hs-comment">-- ^ See Note [Checking StaticPtrs]</span><span>
</span><a name="line-2060"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="lf_report_unsat_syns"><a href="CoreLint.html#lf_report_unsat_syns"><span class="hs-identifier">lf_report_unsat_syns</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- ^ See Note [Linting type synonym applications]</span><span>
</span><a name="line-2061"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-2062"></a><span>
</span><a name="line-2063"></a><span class="hs-comment">-- See Note [Checking StaticPtrs]</span><span>
</span><a name="line-2064"></a><span class="hs-keyword">data</span><span> </span><a name="StaticPtrCheck"><a href="CoreLint.html#StaticPtrCheck"><span class="hs-identifier">StaticPtrCheck</span></a></a><span>
</span><a name="line-2065"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="AllowAnywhere"><a href="CoreLint.html#AllowAnywhere"><span class="hs-identifier">AllowAnywhere</span></a></a><span>
</span><a name="line-2066"></a><span>        </span><span class="hs-comment">-- ^ Allow 'makeStatic' to occur anywhere.</span><span>
</span><a name="line-2067"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="AllowAtTopLevel"><a href="CoreLint.html#AllowAtTopLevel"><span class="hs-identifier">AllowAtTopLevel</span></a></a><span>
</span><a name="line-2068"></a><span>        </span><span class="hs-comment">-- ^ Allow 'makeStatic' calls at the top-level only.</span><span>
</span><a name="line-2069"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="RejectEverywhere"><a href="CoreLint.html#RejectEverywhere"><span class="hs-identifier">RejectEverywhere</span></a></a><span>
</span><a name="line-2070"></a><span>        </span><span class="hs-comment">-- ^ Reject any 'makeStatic' occurrence.</span><span>
</span><a name="line-2071"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-2072"></a><span>
</span><a name="line-2073"></a><span class="hs-identifier">defaultLintFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintFlags"><span class="hs-identifier hs-type">LintFlags</span></a><span>
</span><a name="line-2074"></a><a name="defaultLintFlags"><a href="CoreLint.html#defaultLintFlags"><span class="hs-identifier">defaultLintFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LF"><span class="hs-identifier hs-var">LF</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lf_check_global_ids</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2075"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lf_check_inline_loop_breakers</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2076"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lf_check_static_ptrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#AllowAnywhere"><span class="hs-identifier hs-var">AllowAnywhere</span></a><span>
</span><a name="line-2077"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lf_report_unsat_syns</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2078"></a><span>                      </span><span class="hs-special">}</span><span>
</span><a name="line-2079"></a><span>
</span><a name="line-2080"></a><span class="hs-keyword">newtype</span><span> </span><a name="LintM"><a href="CoreLint.html#LintM"><span class="hs-identifier">LintM</span></a></a><span> </span><a name="local-6989586621679330345"><a href="#local-6989586621679330345"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2081"></a><span>   </span><a name="LintM"><a href="CoreLint.html#LintM"><span class="hs-identifier">LintM</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unLintM"><a href="CoreLint.html#unLintM"><span class="hs-identifier">unLintM</span></a></a><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-2082"></a><span>            </span><a href="CoreLint.html#LintEnv"><span class="hs-identifier hs-type">LintEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2083"></a><span>            </span><a href="CoreLint.html#WarnsAndErrs"><span class="hs-identifier hs-type">WarnsAndErrs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>           </span><span class="hs-comment">-- Error and warning messages so far</span><span>
</span><a name="line-2084"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679330345"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#WarnsAndErrs"><span class="hs-identifier hs-type">WarnsAndErrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- Result and messages (if any)</span><span>
</span><a name="line-2085"></a><span>
</span><a name="line-2086"></a><span class="hs-keyword">type</span><span> </span><a name="WarnsAndErrs"><a href="CoreLint.html#WarnsAndErrs"><span class="hs-identifier">WarnsAndErrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span class="hs-special">)</span><span>
</span><a name="line-2087"></a><span>
</span><a name="line-2088"></a><span class="hs-comment">{- Note [Checking for global Ids]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Before CoreTidy, all locally-bound Ids must be LocalIds, even
top-level ones. See Note [Exported LocalIds] and Trac #9857.

Note [Checking StaticPtrs]
~~~~~~~~~~~~~~~~~~~~~~~~~~
See Note [Grand plan for static forms] in StaticPtrTable for an overview.

Every occurrence of the function 'makeStatic' should be moved to the
top level by the FloatOut pass.  It's vital that we don't have nested
'makeStatic' occurrences after CorePrep, because we populate the Static
Pointer Table from the top-level bindings. See SimplCore Note [Grand
plan for static forms].

The linter checks that no occurrence is left behind, nested within an
expression. The check is enabled only after the FloatOut, CorePrep,
and CoreTidy passes and only if the module uses the StaticPointers
language extension. Checking more often doesn't help since the condition
doesn't hold until after the first FloatOut pass.

Note [Type substitution]
~~~~~~~~~~~~~~~~~~~~~~~~
Why do we need a type substitution?  Consider
        /\(a:*). \(x:a). /\(a:*). id a x
This is ill typed, because (renaming variables) it is really
        /\(a:*). \(x:a). /\(b:*). id b x
Hence, when checking an application, we can't naively compare x's type
(at its binding site) with its expected type (at a use site).  So we
rename type binders as we go, maintaining a substitution.

The same substitution also supports let-type, current expressed as
        (/\(a:*). body) ty
Here we substitute 'ty' for 'a' in 'body', on the fly.

Note [Linting type synonym applications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When linting a type-synonym, or type-family, application
  S ty1 .. tyn
we behave as follows (Trac #15057, #T15664):

* If lf_report_unsat_syns = True, and S has arity &lt; n,
  complain about an unsaturated type synonym or type family

* Switch off lf_report_unsat_syns, and lint ty1 .. tyn.

  Reason: catch out of scope variables or other ill-kinded gubbins,
  even if S discards that argument entirely. E.g. (#15012):
     type FakeOut a = Int
     type family TF a
     type instance TF Int = FakeOut a
  Here 'a' is out of scope; but if we expand FakeOut, we conceal
  that out-of-scope error.

  Reason for switching off lf_report_unsat_syns: with
  LiberalTypeSynonyms, GHC allows unsaturated synonyms provided they
  are saturated when the type is expanded. Example
     type T f = f Int
     type S a = a -&gt; a
     type Z = T S
  In Z's RHS, S appears unsaturated, but it is saturated when T is expanded.

* If lf_report_unsat_syns is on, expand the synonym application and
  lint the result.  Reason: want to check that synonyms are saturated
  when the type is expanded.
-}</span><span>
</span><a name="line-2154"></a><span>
</span><a name="line-2155"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2156"></a><span>      </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-2157"></a><span>
</span><a name="line-2158"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2159"></a><span>      </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621679330356"><a href="#local-6989586621679330356"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679330357"><a href="#local-6989586621679330357"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679330356"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679330357"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2160"></a><span>      </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-2161"></a><span>
</span><a name="line-2162"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2163"></a><span class="hs-cpp">#if !MIN_VERSION_base(4,13,0)
</span><span>  </span><a name="local-3458764513820541098"><span class="hs-identifier">fail</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MonadFail.fail</span><span>
</span><a name="line-2165"></a><span class="hs-cpp">#endif
</span><span>  </span><a name="local-6989586621679330349"><a href="#local-6989586621679330349"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621679330350"><a href="#local-6989586621679330350"><span class="hs-identifier">k</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679330351"><a href="#local-6989586621679330351"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679330352"><a href="#local-6989586621679330352"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2167"></a><span>                       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679330353"><a href="#local-6989586621679330353"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679330354"><a href="#local-6989586621679330354"><span class="hs-identifier">errs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679330349"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679330351"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679330352"><span class="hs-identifier hs-var">errs</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-2168"></a><span>                         </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679330353"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2169"></a><span>                           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679330355"><a href="#local-6989586621679330355"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unLintM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679330350"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679330355"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679330351"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679330354"><span class="hs-identifier hs-var">errs'</span></a><span>
</span><a name="line-2170"></a><span>                           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679330354"><span class="hs-identifier hs-var">errs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2171"></a><span>
</span><a name="line-2172"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadFail.MonadFail</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2173"></a><span>    </span><a name="local-3458764513820541104"><span class="hs-identifier">fail</span></a><span> </span><a name="local-6989586621679330348"><a href="#local-6989586621679330348"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621679330348"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-2174"></a><span>
</span><a name="line-2175"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">HasDynFlags</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2176"></a><span>  </span><a name="local-8214565720323804398"><span class="hs-identifier">getDynFlags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679330346"><a href="#local-6989586621679330346"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679330347"><a href="#local-6989586621679330347"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">le_dynflags</span><span> </span><a href="#local-6989586621679330346"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679330347"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2177"></a><span>
</span><a name="line-2178"></a><span class="hs-keyword">data</span><span> </span><a name="LintLocInfo"><a href="CoreLint.html#LintLocInfo"><span class="hs-identifier">LintLocInfo</span></a></a><span>
</span><a name="line-2179"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="RhsOf"><a href="CoreLint.html#RhsOf"><span class="hs-identifier">RhsOf</span></a></a><span> </span><span class="hs-identifier hs-type">Id</span><span>            </span><span class="hs-comment">-- The variable bound</span><span>
</span><a name="line-2180"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LambdaBodyOf"><a href="CoreLint.html#LambdaBodyOf"><span class="hs-identifier">LambdaBodyOf</span></a></a><span> </span><span class="hs-identifier hs-type">Id</span><span>     </span><span class="hs-comment">-- The lambda-binder</span><span>
</span><a name="line-2181"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UnfoldingOf"><a href="CoreLint.html#UnfoldingOf"><span class="hs-identifier">UnfoldingOf</span></a></a><span> </span><span class="hs-identifier hs-type">Id</span><span>      </span><span class="hs-comment">-- Unfolding of a binder</span><span>
</span><a name="line-2182"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="BodyOfLetRec"><a href="CoreLint.html#BodyOfLetRec"><span class="hs-identifier">BodyOfLetRec</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- One of the binders</span><span>
</span><a name="line-2183"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseAlt"><a href="CoreLint.html#CaseAlt"><span class="hs-identifier">CaseAlt</span></a></a><span> </span><span class="hs-identifier hs-type">CoreAlt</span><span>     </span><span class="hs-comment">-- Case alternative</span><span>
</span><a name="line-2184"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CasePat"><a href="CoreLint.html#CasePat"><span class="hs-identifier">CasePat</span></a></a><span> </span><span class="hs-identifier hs-type">CoreAlt</span><span>     </span><span class="hs-comment">-- The *pattern* of the case alternative</span><span>
</span><a name="line-2185"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AnExpr"><a href="CoreLint.html#AnExpr"><span class="hs-identifier">AnExpr</span></a></a><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span>     </span><span class="hs-comment">-- Some expression</span><span>
</span><a name="line-2186"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImportedUnfolding"><a href="CoreLint.html#ImportedUnfolding"><span class="hs-identifier">ImportedUnfolding</span></a></a><span> </span><span class="hs-identifier hs-type">SrcLoc</span><span> </span><span class="hs-comment">-- Some imported unfolding (ToDo: say which)</span><span>
</span><a name="line-2187"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TopLevelBindings"><a href="CoreLint.html#TopLevelBindings"><span class="hs-identifier">TopLevelBindings</span></a></a><span>
</span><a name="line-2188"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InType"><a href="CoreLint.html#InType"><span class="hs-identifier">InType</span></a></a><span> </span><span class="hs-identifier hs-type">Type</span><span>         </span><span class="hs-comment">-- Inside a type</span><span>
</span><a name="line-2189"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InCo"><a href="CoreLint.html#InCo"><span class="hs-identifier">InCo</span></a></a><span>   </span><span class="hs-identifier hs-type">Coercion</span><span>     </span><span class="hs-comment">-- Inside a coercion</span><span>
</span><a name="line-2190"></a><span>
</span><a name="line-2191"></a><span class="hs-identifier">initL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintFlags"><span class="hs-identifier hs-type">LintFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">InScopeSet</span><span>
</span><a name="line-2192"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330368"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#WarnsAndErrs"><span class="hs-identifier hs-type">WarnsAndErrs</span></a><span>    </span><span class="hs-comment">-- Errors and warnings</span><span>
</span><a name="line-2193"></a><a name="initL"><a href="CoreLint.html#initL"><span class="hs-identifier">initL</span></a></a><span> </span><a name="local-6989586621679331869"><a href="#local-6989586621679331869"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621679331870"><a href="#local-6989586621679331870"><span class="hs-identifier">flags</span></a></a><span> </span><a name="local-6989586621679331871"><a href="#local-6989586621679331871"><span class="hs-identifier">in_scope</span></a></a><span> </span><a name="local-6989586621679331872"><a href="#local-6989586621679331872"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2194"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679331872"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679331873"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2195"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679331874"><a href="#local-6989586621679331874"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679331874"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-2196"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2197"></a><span>    </span><a name="local-6989586621679331873"><a href="#local-6989586621679331873"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LE"><span class="hs-identifier hs-var">LE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_flags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331870"><span class="hs-identifier hs-var">flags</span></a><span>
</span><a name="line-2198"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">le_subst</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkEmptyTCvSubst</span><span> </span><a href="#local-6989586621679331871"><span class="hs-identifier hs-var">in_scope</span></a><span>
</span><a name="line-2199"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">le_joins</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyVarSet</span><span>
</span><a name="line-2200"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">le_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2201"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">le_dynflags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331869"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2202"></a><span>
</span><a name="line-2203"></a><span class="hs-identifier">setReportUnsat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330367"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330367"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2204"></a><span class="hs-comment">-- Switch off lf_report_unsat_syns</span><span>
</span><a name="line-2205"></a><a name="setReportUnsat"><a href="CoreLint.html#setReportUnsat"><span class="hs-identifier">setReportUnsat</span></a></a><span> </span><a name="local-6989586621679331875"><a href="#local-6989586621679331875"><span class="hs-identifier">ru</span></a></a><span> </span><a name="local-6989586621679331876"><a href="#local-6989586621679331876"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-2206"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331877"><a href="#local-6989586621679331877"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331878"><a href="#local-6989586621679331878"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2207"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679331879"><a href="#local-6989586621679331879"><span class="hs-identifier">env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331877"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_flags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">le_flags</span><span> </span><a href="#local-6989586621679331877"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lf_report_unsat_syns</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331875"><span class="hs-identifier hs-var">ru</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2208"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679331876"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621679331879"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621679331878"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-2209"></a><span>
</span><a name="line-2210"></a><span class="hs-identifier">getLintFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="CoreLint.html#LintFlags"><span class="hs-identifier hs-type">LintFlags</span></a><span>
</span><a name="line-2211"></a><a name="getLintFlags"><a href="CoreLint.html#getLintFlags"><span class="hs-identifier">getLintFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331880"><a href="#local-6989586621679331880"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331881"><a href="#local-6989586621679331881"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">le_flags</span><span> </span><a href="#local-6989586621679331880"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331881"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2212"></a><span>
</span><a name="line-2213"></a><span class="hs-identifier">checkL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2214"></a><a name="checkL"><a href="CoreLint.html#checkL"><span class="hs-identifier">checkL</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2215"></a><span class="hs-identifier">checkL</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621679331882"><a href="#local-6989586621679331882"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#failWithL"><span class="hs-identifier hs-var">failWithL</span></a><span> </span><a href="#local-6989586621679331882"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-2216"></a><span>
</span><a name="line-2217"></a><span class="hs-comment">-- like checkL, but relevant to type checking</span><span>
</span><a name="line-2218"></a><span class="hs-identifier">lintL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2219"></a><a name="lintL"><a href="CoreLint.html#lintL"><span class="hs-identifier">lintL</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span>
</span><a name="line-2220"></a><span>
</span><a name="line-2221"></a><span class="hs-identifier">checkWarnL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2222"></a><a name="checkWarnL"><a href="CoreLint.html#checkWarnL"><span class="hs-identifier">checkWarnL</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2223"></a><span class="hs-identifier">checkWarnL</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621679331883"><a href="#local-6989586621679331883"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#addWarnL"><span class="hs-identifier hs-var">addWarnL</span></a><span> </span><a href="#local-6989586621679331883"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-2224"></a><span>
</span><a name="line-2225"></a><span class="hs-identifier">failWithL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330366"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2226"></a><a name="failWithL"><a href="CoreLint.html#failWithL"><span class="hs-identifier">failWithL</span></a></a><span> </span><a name="local-6989586621679331884"><a href="#local-6989586621679331884"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331885"><a href="#local-6989586621679331885"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331886"><a href="#local-6989586621679331886"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331887"><a href="#local-6989586621679331887"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2227"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331886"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#addMsg"><span class="hs-identifier hs-var">addMsg</span></a><span> </span><a href="#local-6989586621679331885"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679331887"><span class="hs-identifier hs-var">errs</span></a><span> </span><a href="#local-6989586621679331884"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2228"></a><span>
</span><a name="line-2229"></a><span class="hs-identifier">addErrL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2230"></a><a name="addErrL"><a href="CoreLint.html#addErrL"><span class="hs-identifier">addErrL</span></a></a><span> </span><a name="local-6989586621679331888"><a href="#local-6989586621679331888"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331889"><a href="#local-6989586621679331889"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331890"><a href="#local-6989586621679331890"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331891"><a href="#local-6989586621679331891"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2231"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331890"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">,</span><span> </span><a href="CoreLint.html#addMsg"><span class="hs-identifier hs-var">addMsg</span></a><span> </span><a href="#local-6989586621679331889"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679331891"><span class="hs-identifier hs-var">errs</span></a><span> </span><a href="#local-6989586621679331888"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2232"></a><span>
</span><a name="line-2233"></a><span class="hs-identifier">addWarnL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2234"></a><a name="addWarnL"><a href="CoreLint.html#addWarnL"><span class="hs-identifier">addWarnL</span></a></a><span> </span><a name="local-6989586621679331892"><a href="#local-6989586621679331892"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331893"><a href="#local-6989586621679331893"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331894"><a href="#local-6989586621679331894"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><a name="local-6989586621679331895"><a href="#local-6989586621679331895"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2235"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#addMsg"><span class="hs-identifier hs-var">addMsg</span></a><span> </span><a href="#local-6989586621679331893"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679331894"><span class="hs-identifier hs-var">warns</span></a><span> </span><a href="#local-6989586621679331892"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331895"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2236"></a><span>
</span><a name="line-2237"></a><span class="hs-identifier">addMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintEnv"><span class="hs-identifier hs-type">LintEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2238"></a><a name="addMsg"><a href="CoreLint.html#addMsg"><span class="hs-identifier">addMsg</span></a></a><span> </span><a name="local-6989586621679331896"><a href="#local-6989586621679331896"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331897"><a href="#local-6989586621679331897"><span class="hs-identifier">msgs</span></a></a><span> </span><a name="local-6989586621679331898"><a href="#local-6989586621679331898"><span class="hs-identifier">msg</span></a></a><span>
</span><a name="line-2239"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">notNull</span><span> </span><span class="hs-identifier">locs</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2240"></a><span>    </span><a href="#local-6989586621679331897"><span class="hs-identifier hs-var">msgs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocBag</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331904"><span class="hs-identifier hs-var">mk_msg</span></a><span> </span><a href="#local-6989586621679331898"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-2241"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2242"></a><span>   </span><a name="local-6989586621679331899"><a href="#local-6989586621679331899"><span class="hs-identifier">locs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">le_loc</span><span> </span><a href="#local-6989586621679331896"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-2243"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621679331900"><a href="#local-6989586621679331900"><span class="hs-identifier">loc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331901"><a href="#local-6989586621679331901"><span class="hs-identifier">cxt1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#dumpLoc"><span class="hs-identifier hs-var">dumpLoc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679331899"><span class="hs-identifier hs-var">locs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2244"></a><span>   </span><a name="local-6989586621679331902"><a href="#local-6989586621679331902"><span class="hs-identifier">cxts</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#dumpLoc"><span class="hs-identifier hs-var">dumpLoc</span></a><span> </span><a href="#local-6989586621679331905"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679331905"><a href="#local-6989586621679331905"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679331899"><span class="hs-identifier hs-var">locs</span></a><span class="hs-special">]</span><span>
</span><a name="line-2245"></a><span>   </span><a name="local-6989586621679331903"><a href="#local-6989586621679331903"><span class="hs-identifier">context</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ifPprDebug</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679331902"><span class="hs-identifier hs-var">cxts</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$$</span><span> </span><a href="#local-6989586621679331901"><span class="hs-identifier hs-var">cxt1</span></a><span> </span><span class="hs-operator hs-var">$$</span><span>
</span><a name="line-2246"></a><span>                             </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Substitution:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">le_subst</span><span> </span><a href="#local-6989586621679331896"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2247"></a><span>                            </span><a href="#local-6989586621679331901"><span class="hs-identifier hs-var">cxt1</span></a><span>
</span><a name="line-2248"></a><span>
</span><a name="line-2249"></a><span>   </span><a name="local-6989586621679331904"><a href="#local-6989586621679331904"><span class="hs-identifier">mk_msg</span></a></a><span> </span><a name="local-6989586621679331906"><a href="#local-6989586621679331906"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLocMessage</span><span> </span><span class="hs-identifier hs-var">SevWarning</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkSrcSpan</span><span> </span><a href="#local-6989586621679331900"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621679331900"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331903"><span class="hs-identifier hs-var">context</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><a href="#local-6989586621679331906"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2250"></a><span>
</span><a name="line-2251"></a><span class="hs-identifier">addLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintLocInfo"><span class="hs-identifier hs-type">LintLocInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330365"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330365"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2252"></a><a name="addLoc"><a href="CoreLint.html#addLoc"><span class="hs-identifier">addLoc</span></a></a><span> </span><a name="local-6989586621679331907"><a href="#local-6989586621679331907"><span class="hs-identifier">extra_loc</span></a></a><span> </span><a name="local-6989586621679331908"><a href="#local-6989586621679331908"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2253"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331909"><a href="#local-6989586621679331909"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331910"><a href="#local-6989586621679331910"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2254"></a><span>    </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679331908"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331909"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331907"><span class="hs-identifier hs-var">extra_loc</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">le_loc</span><span> </span><a href="#local-6989586621679331909"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331910"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-2255"></a><span>
</span><a name="line-2256"></a><span class="hs-identifier">inCasePat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>         </span><span class="hs-comment">-- A slight hack; see the unique call site</span><span>
</span><a name="line-2257"></a><a name="inCasePat"><a href="CoreLint.html#inCasePat"><span class="hs-identifier">inCasePat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331913"><a href="#local-6989586621679331913"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331914"><a href="#local-6989586621679331914"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331911"><span class="hs-identifier hs-var">is_case_pat</span></a><span> </span><a href="#local-6989586621679331913"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331914"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2258"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2259"></a><span>    </span><a name="local-6989586621679331911"><a href="#local-6989586621679331911"><span class="hs-identifier">is_case_pat</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LE"><span class="hs-identifier hs-var">LE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#CasePat"><span class="hs-identifier hs-var">CasePat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2260"></a><span>    </span><span class="hs-identifier">is_case_pat</span><span> </span><a name="local-6989586621679331912"><a href="#local-6989586621679331912"><span class="hs-identifier">_other</span></a></a><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2261"></a><span>
</span><a name="line-2262"></a><span class="hs-identifier">addInScopeVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330364"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330364"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2263"></a><a name="addInScopeVar"><a href="CoreLint.html#addInScopeVar"><span class="hs-identifier">addInScopeVar</span></a></a><span> </span><a name="local-6989586621679331915"><a href="#local-6989586621679331915"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331916"><a href="#local-6989586621679331916"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2264"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331917"><a href="#local-6989586621679331917"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331918"><a href="#local-6989586621679331918"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2265"></a><span>    </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679331916"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331917"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_subst</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">extendTCvInScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">le_subst</span><span> </span><a href="#local-6989586621679331917"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331915"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-2266"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">le_joins</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">delVarSet</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">le_joins</span><span> </span><a href="#local-6989586621679331917"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331915"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-2267"></a><span>               </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331918"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-2268"></a><span>
</span><a name="line-2269"></a><span class="hs-identifier">extendSubstL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330363"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330363"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2270"></a><a name="extendSubstL"><a href="CoreLint.html#extendSubstL"><span class="hs-identifier">extendSubstL</span></a></a><span> </span><a name="local-6989586621679331919"><a href="#local-6989586621679331919"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621679331920"><a href="#local-6989586621679331920"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679331921"><a href="#local-6989586621679331921"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2271"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331922"><a href="#local-6989586621679331922"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331923"><a href="#local-6989586621679331923"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2272"></a><span>    </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679331921"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331922"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_subst</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Type.extendTvSubst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">le_subst</span><span> </span><a href="#local-6989586621679331922"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331919"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621679331920"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331923"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-2273"></a><span>
</span><a name="line-2274"></a><span class="hs-identifier">updateTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330362"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330362"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2275"></a><a name="updateTCvSubst"><a href="CoreLint.html#updateTCvSubst"><span class="hs-identifier">updateTCvSubst</span></a></a><span> </span><a name="local-6989586621679331924"><a href="#local-6989586621679331924"><span class="hs-identifier">subst'</span></a></a><span> </span><a name="local-6989586621679331925"><a href="#local-6989586621679331925"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2276"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331926"><a href="#local-6989586621679331926"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331927"><a href="#local-6989586621679331927"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679331925"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331926"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_subst</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331924"><span class="hs-identifier hs-var">subst'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331927"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-2277"></a><span>
</span><a name="line-2278"></a><span class="hs-identifier">markAllJoinsBad</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330361"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330361"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2279"></a><a name="markAllJoinsBad"><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier">markAllJoinsBad</span></a></a><span> </span><a name="local-6989586621679331928"><a href="#local-6989586621679331928"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-2280"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331929"><a href="#local-6989586621679331929"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331930"><a href="#local-6989586621679331930"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679331928"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331929"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_joins</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyVarSet</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331930"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-2281"></a><span>
</span><a name="line-2282"></a><span class="hs-identifier">markAllJoinsBadIf</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330360"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330360"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2283"></a><a name="markAllJoinsBadIf"><a href="CoreLint.html#markAllJoinsBadIf"><span class="hs-identifier">markAllJoinsBadIf</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a name="local-6989586621679331931"><a href="#local-6989586621679331931"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#markAllJoinsBad"><span class="hs-identifier hs-var">markAllJoinsBad</span></a><span> </span><a href="#local-6989586621679331931"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-2284"></a><span class="hs-identifier">markAllJoinsBadIf</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621679331932"><a href="#local-6989586621679331932"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331932"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-2285"></a><span>
</span><a name="line-2286"></a><span class="hs-identifier">addGoodJoins</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330359"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><a href="#local-6989586621679330359"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2287"></a><a name="addGoodJoins"><a href="CoreLint.html#addGoodJoins"><span class="hs-identifier">addGoodJoins</span></a></a><span> </span><a name="local-6989586621679331933"><a href="#local-6989586621679331933"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621679331934"><a href="#local-6989586621679331934"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-2288"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679331936"><span class="hs-identifier hs-var">join_ids</span></a><span>
</span><a name="line-2289"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331934"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-2290"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2291"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331938"><a href="#local-6989586621679331938"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331939"><a href="#local-6989586621679331939"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unLintM</span><span> </span><a href="#local-6989586621679331934"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331935"><span class="hs-identifier hs-var">add_joins</span></a><span> </span><a href="#local-6989586621679331938"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331939"><span class="hs-identifier hs-var">errs</span></a><span>
</span><a name="line-2292"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2293"></a><span>    </span><a name="local-6989586621679331935"><a href="#local-6989586621679331935"><span class="hs-identifier">add_joins</span></a></a><span> </span><a name="local-6989586621679331937"><a href="#local-6989586621679331937"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679331937"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">le_joins</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">le_joins</span><span> </span><a href="#local-6989586621679331937"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">extendVarSetList</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331936"><span class="hs-identifier hs-var">join_ids</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2294"></a><span>    </span><a name="local-6989586621679331936"><a href="#local-6989586621679331936"><span class="hs-identifier">join_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-identifier hs-var">isJoinId</span><span> </span><a href="#local-6989586621679331933"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-2295"></a><span>
</span><a name="line-2296"></a><span class="hs-identifier">getValidJoins</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">IdSet</span><span>
</span><a name="line-2297"></a><a name="getValidJoins"><a href="CoreLint.html#getValidJoins"><span class="hs-identifier">getValidJoins</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331940"><a href="#local-6989586621679331940"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331941"><a href="#local-6989586621679331941"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">le_joins</span><span> </span><a href="#local-6989586621679331940"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331941"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2298"></a><span>
</span><a name="line-2299"></a><span class="hs-identifier">getTCvSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">TCvSubst</span><span>
</span><a name="line-2300"></a><a name="getTCvSubst"><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier">getTCvSubst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331942"><a href="#local-6989586621679331942"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331943"><a href="#local-6989586621679331943"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">le_subst</span><span> </span><a href="#local-6989586621679331942"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331943"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2301"></a><span>
</span><a name="line-2302"></a><span class="hs-identifier">getInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">InScopeSet</span><span>
</span><a name="line-2303"></a><a name="getInScope"><a href="CoreLint.html#getInScope"><span class="hs-identifier">getInScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-var">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679331944"><a href="#local-6989586621679331944"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621679331945"><a href="#local-6989586621679331945"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getTCvInScope</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">le_subst</span><span> </span><a href="#local-6989586621679331944"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679331945"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2304"></a><span>
</span><a name="line-2305"></a><span class="hs-identifier">applySubstTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">InType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">OutType</span><span>
</span><a name="line-2306"></a><a name="applySubstTy"><a href="CoreLint.html#applySubstTy"><span class="hs-identifier">applySubstTy</span></a></a><span> </span><a name="local-6989586621679331946"><a href="#local-6989586621679331946"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331947"><a href="#local-6989586621679331947"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier hs-var">getTCvSubst</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">substTy</span><span> </span><a href="#local-6989586621679331947"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679331946"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2307"></a><span>
</span><a name="line-2308"></a><span class="hs-identifier">applySubstCo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">InCoercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">OutCoercion</span><span>
</span><a name="line-2309"></a><a name="applySubstCo"><a href="CoreLint.html#applySubstCo"><span class="hs-identifier">applySubstCo</span></a></a><span> </span><a name="local-6989586621679331948"><a href="#local-6989586621679331948"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331949"><a href="#local-6989586621679331949"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier hs-var">getTCvSubst</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">substCo</span><span> </span><a href="#local-6989586621679331949"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621679331948"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2310"></a><span>
</span><a name="line-2311"></a><span class="hs-identifier">lookupIdInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-2312"></a><a name="lookupIdInScope"><a href="CoreLint.html#lookupIdInScope"><span class="hs-identifier">lookupIdInScope</span></a></a><span> </span><a name="local-6989586621679331950"><a href="#local-6989586621679331950"><span class="hs-identifier">id_occ</span></a></a><span>
</span><a name="line-2313"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331956"><a href="#local-6989586621679331956"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier hs-var">getTCvSubst</span></a><span>
</span><a name="line-2314"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupInScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getTCvInScope</span><span> </span><a href="#local-6989586621679331956"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331950"><span class="hs-identifier hs-var">id_occ</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2315"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331957"><a href="#local-6989586621679331957"><span class="hs-identifier">id_bnd</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331954"><span class="hs-identifier hs-var">bad_global</span></a><span> </span><a href="#local-6989586621679331957"><span class="hs-identifier hs-var">id_bnd</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331953"><span class="hs-identifier hs-var">global_in_scope</span></a><span>
</span><a name="line-2316"></a><span>                              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679331957"><span class="hs-identifier hs-var">id_bnd</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2317"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="CoreLint.html#checkL"><span class="hs-identifier hs-var">checkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679331951"><span class="hs-identifier hs-var">is_local</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331952"><span class="hs-identifier hs-var">local_out_of_scope</span></a><span>
</span><a name="line-2318"></a><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679331950"><span class="hs-identifier hs-var">id_occ</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2319"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2320"></a><span>    </span><a name="local-6989586621679331951"><a href="#local-6989586621679331951"><span class="hs-identifier">is_local</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mustHaveLocalBinding</span><span> </span><a href="#local-6989586621679331950"><span class="hs-identifier hs-var">id_occ</span></a><span>
</span><a name="line-2321"></a><span>    </span><a name="local-6989586621679331952"><a href="#local-6989586621679331952"><span class="hs-identifier">local_out_of_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Out of scope:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">LetBind</span><span> </span><a href="#local-6989586621679331950"><span class="hs-identifier hs-var">id_occ</span></a><span>
</span><a name="line-2322"></a><span>    </span><a name="local-6989586621679331953"><a href="#local-6989586621679331953"><span class="hs-identifier">global_in_scope</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Occurrence is GlobalId, but binding is LocalId&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2323"></a><span>                            </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">LetBind</span><span> </span><a href="#local-6989586621679331950"><span class="hs-identifier hs-var">id_occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-2324"></a><span>    </span><a name="local-6989586621679331954"><a href="#local-6989586621679331954"><span class="hs-identifier">bad_global</span></a></a><span> </span><a name="local-6989586621679331955"><a href="#local-6989586621679331955"><span class="hs-identifier">id_bnd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isGlobalId</span><span> </span><a href="#local-6989586621679331950"><span class="hs-identifier hs-var">id_occ</span></a><span>
</span><a name="line-2325"></a><span>                     </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isLocalId</span><span> </span><a href="#local-6989586621679331955"><span class="hs-identifier hs-var">id_bnd</span></a><span>
</span><a name="line-2326"></a><span>                     </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isWiredInName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621679331950"><span class="hs-identifier hs-var">id_occ</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2327"></a><span>       </span><span class="hs-comment">-- 'bad_global' checks for the case where an /occurrence/ is</span><span>
</span><a name="line-2328"></a><span>       </span><span class="hs-comment">-- a GlobalId, but there is an enclosing binding fora a LocalId.</span><span>
</span><a name="line-2329"></a><span>       </span><span class="hs-comment">-- NB: the in-scope variables are mostly LocalIds, checked by lintIdBndr,</span><span>
</span><a name="line-2330"></a><span>       </span><span class="hs-comment">--     but GHCi adds GlobalIds from the interactive context.  These</span><span>
</span><a name="line-2331"></a><span>       </span><span class="hs-comment">--     are fine; hence the test (isLocalId id == isLocalId v)</span><span>
</span><a name="line-2332"></a><span>       </span><span class="hs-comment">-- NB: when compiling Control.Exception.Base, things like absentError</span><span>
</span><a name="line-2333"></a><span>       </span><span class="hs-comment">--     are defined locally, but appear in expressions as (global)</span><span>
</span><a name="line-2334"></a><span>       </span><span class="hs-comment">--     wired-in Ids after worker/wrapper</span><span>
</span><a name="line-2335"></a><span>       </span><span class="hs-comment">--     So we simply disable the test in this case</span><span>
</span><a name="line-2336"></a><span>
</span><a name="line-2337"></a><span class="hs-identifier">lookupJoinId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">JoinArity</span><span class="hs-special">)</span><span>
</span><a name="line-2338"></a><span class="hs-comment">-- Look up an Id which should be a join point, valid here</span><span>
</span><a name="line-2339"></a><span class="hs-comment">-- If so, return its arity, if not return Nothing</span><span>
</span><a name="line-2340"></a><a name="lookupJoinId"><a href="CoreLint.html#lookupJoinId"><span class="hs-identifier">lookupJoinId</span></a></a><span> </span><a name="local-6989586621679331958"><a href="#local-6989586621679331958"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-2341"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331959"><a href="#local-6989586621679331959"><span class="hs-identifier">join_set</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getValidJoins"><span class="hs-identifier hs-var">getValidJoins</span></a><span>
</span><a name="line-2342"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupVarSet</span><span> </span><a href="#local-6989586621679331959"><span class="hs-identifier hs-var">join_set</span></a><span> </span><a href="#local-6989586621679331958"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2343"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679331960"><a href="#local-6989586621679331960"><span class="hs-identifier">id'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJoinId_maybe</span><span> </span><a href="#local-6989586621679331960"><span class="hs-identifier hs-var">id'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2344"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2345"></a><span>
</span><a name="line-2346"></a><span class="hs-identifier">lintTyCoVarInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyCoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2347"></a><a name="lintTyCoVarInScope"><a href="CoreLint.html#lintTyCoVarInScope"><span class="hs-identifier">lintTyCoVarInScope</span></a></a><span> </span><a name="local-6989586621679331961"><a href="#local-6989586621679331961"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-2348"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679331962"><a href="#local-6989586621679331962"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#getTCvSubst"><span class="hs-identifier hs-var">getTCvSubst</span></a><span>
</span><a name="line-2349"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331961"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isInScope</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331962"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2350"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">LetBind</span><span> </span><a href="#local-6989586621679331961"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;is out of scope&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2351"></a><span>
</span><a name="line-2352"></a><span class="hs-identifier">ensureEqTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2353"></a><span class="hs-comment">-- check ty2 is subtype of ty1 (ie, has same structure but usage</span><span>
</span><a name="line-2354"></a><span class="hs-comment">-- annotations need only be consistent, not equal)</span><span>
</span><a name="line-2355"></a><span class="hs-comment">-- Assumes ty1,ty2 are have already had the substitution applied</span><span>
</span><a name="line-2356"></a><a name="ensureEqTys"><a href="CoreLint.html#ensureEqTys"><span class="hs-identifier">ensureEqTys</span></a></a><span> </span><a name="local-6989586621679331963"><a href="#local-6989586621679331963"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679331964"><a href="#local-6989586621679331964"><span class="hs-identifier">ty2</span></a></a><span> </span><a name="local-6989586621679331965"><a href="#local-6989586621679331965"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331963"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679331964"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679331965"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-2357"></a><span>
</span><a name="line-2358"></a><span class="hs-identifier">lintRole</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="#local-6989586621679330358"><span class="hs-identifier hs-type">thing</span></a><span>
</span><a name="line-2359"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679330358"><span class="hs-identifier hs-type">thing</span></a><span>     </span><span class="hs-comment">-- where the role appeared</span><span>
</span><a name="line-2360"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Role</span><span>      </span><span class="hs-comment">-- expected</span><span>
</span><a name="line-2361"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Role</span><span>      </span><span class="hs-comment">-- actual</span><span>
</span><a name="line-2362"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreLint.html#LintM"><span class="hs-identifier hs-type">LintM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2363"></a><a name="lintRole"><a href="CoreLint.html#lintRole"><span class="hs-identifier">lintRole</span></a></a><span> </span><a name="local-6989586621679331966"><a href="#local-6989586621679331966"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679331967"><a href="#local-6989586621679331967"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679331968"><a href="#local-6989586621679331968"><span class="hs-identifier">r2</span></a></a><span>
</span><a name="line-2364"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#lintL"><span class="hs-identifier hs-var">lintL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331967"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679331968"><span class="hs-identifier hs-var">r2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2365"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Role incompatibility: expected&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331967"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">comma</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-2366"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;got&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331968"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-operator hs-var">$$</span><span>
</span><a name="line-2367"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331966"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-2368"></a><span>
</span><a name="line-2369"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Error messages}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2376"></a><span>
</span><a name="line-2377"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreLint.html#LintLocInfo"><span class="hs-identifier hs-type">LintLocInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SrcLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span class="hs-special">)</span><span>
</span><a name="line-2378"></a><span>
</span><a name="line-2379"></a><a name="dumpLoc"><a href="CoreLint.html#dumpLoc"><span class="hs-identifier">dumpLoc</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreLint.html#RhsOf"><span class="hs-identifier hs-var">RhsOf</span></a><span> </span><a name="local-6989586621679331969"><a href="#local-6989586621679331969"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2380"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getSrcLoc</span><span> </span><a href="#local-6989586621679331969"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;RHS of&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="CoreLint.html#pp_binders"><span class="hs-identifier hs-var">pp_binders</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679331969"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2381"></a><span>
</span><a name="line-2382"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#LambdaBodyOf"><span class="hs-identifier hs-var">LambdaBodyOf</span></a><span> </span><a name="local-6989586621679331970"><a href="#local-6989586621679331970"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2383"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getSrcLoc</span><span> </span><a href="#local-6989586621679331970"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in body of lambda with binder&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="CoreLint.html#pp_binder"><span class="hs-identifier hs-var">pp_binder</span></a><span> </span><a href="#local-6989586621679331970"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2384"></a><span>
</span><a name="line-2385"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#UnfoldingOf"><span class="hs-identifier hs-var">UnfoldingOf</span></a><span> </span><a name="local-6989586621679331971"><a href="#local-6989586621679331971"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2386"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getSrcLoc</span><span> </span><a href="#local-6989586621679331971"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in the unfolding of&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="CoreLint.html#pp_binder"><span class="hs-identifier hs-var">pp_binder</span></a><span> </span><a href="#local-6989586621679331971"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2387"></a><span>
</span><a name="line-2388"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#BodyOfLetRec"><span class="hs-identifier hs-var">BodyOfLetRec</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2389"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noSrcLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In body of a letrec with no binders&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2390"></a><span>
</span><a name="line-2391"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#BodyOfLetRec"><span class="hs-identifier hs-var">BodyOfLetRec</span></a><span> </span><a name="local-6989586621679331972"><a href="#local-6989586621679331972"><span class="hs-identifier">bs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2392"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">getSrcLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679331972"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in body of letrec with binders&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="CoreLint.html#pp_binders"><span class="hs-identifier hs-var">pp_binders</span></a><span> </span><a href="#local-6989586621679331972"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2393"></a><span>
</span><a name="line-2394"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#AnExpr"><span class="hs-identifier hs-var">AnExpr</span></a><span> </span><a name="local-6989586621679331973"><a href="#local-6989586621679331973"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2395"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noSrcLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In the expression:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331973"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-2396"></a><span>
</span><a name="line-2397"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331974"><a href="#local-6989586621679331974"><span class="hs-identifier">con</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331975"><a href="#local-6989586621679331975"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2398"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noSrcLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In a case alternative:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">parens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331974"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="CoreLint.html#pp_binders"><span class="hs-identifier hs-var">pp_binders</span></a><span> </span><a href="#local-6989586621679331975"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2399"></a><span>
</span><a name="line-2400"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#CasePat"><span class="hs-identifier hs-var">CasePat</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679331976"><a href="#local-6989586621679331976"><span class="hs-identifier">con</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679331977"><a href="#local-6989586621679331977"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2401"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noSrcLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In the pattern of a case alternative:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">parens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331976"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="CoreLint.html#pp_binders"><span class="hs-identifier hs-var">pp_binders</span></a><span> </span><a href="#local-6989586621679331977"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2402"></a><span>
</span><a name="line-2403"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#ImportedUnfolding"><span class="hs-identifier hs-var">ImportedUnfolding</span></a><span> </span><a name="local-6989586621679331978"><a href="#local-6989586621679331978"><span class="hs-identifier">locn</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2404"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679331978"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;in an imported unfolding&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2405"></a><span class="hs-identifier">dumpLoc</span><span> </span><a href="CoreLint.html#TopLevelBindings"><span class="hs-identifier hs-var">TopLevelBindings</span></a><span>
</span><a name="line-2406"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noSrcLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Outputable.empty</span><span class="hs-special">)</span><span>
</span><a name="line-2407"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#InType"><span class="hs-identifier hs-var">InType</span></a><span> </span><a name="local-6989586621679331979"><a href="#local-6989586621679331979"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2408"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noSrcLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In the type&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331979"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2409"></a><span class="hs-identifier">dumpLoc</span><span> </span><span class="hs-special">(</span><a href="CoreLint.html#InCo"><span class="hs-identifier hs-var">InCo</span></a><span> </span><a name="local-6989586621679331980"><a href="#local-6989586621679331980"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2410"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noSrcLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In the coercion&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331980"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2411"></a><span>
</span><a name="line-2412"></a><span class="hs-identifier">pp_binders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2413"></a><a name="pp_binders"><a href="CoreLint.html#pp_binders"><span class="hs-identifier">pp_binders</span></a></a><span> </span><a name="local-6989586621679331981"><a href="#local-6989586621679331981"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">punctuate</span><span> </span><span class="hs-identifier hs-var">comma</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="CoreLint.html#pp_binder"><span class="hs-identifier hs-var">pp_binder</span></a><span> </span><a href="#local-6989586621679331981"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2414"></a><span>
</span><a name="line-2415"></a><span class="hs-identifier">pp_binder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2416"></a><a name="pp_binder"><a href="CoreLint.html#pp_binder"><span class="hs-identifier">pp_binder</span></a></a><span> </span><a name="local-6989586621679331982"><a href="#local-6989586621679331982"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isId</span><span> </span><a href="#local-6989586621679331982"><span class="hs-identifier hs-var">b</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331982"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679331982"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2417"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331982"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621679331982"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2418"></a><span>
</span><a name="line-2419"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-2420"></a><span class="hs-comment">--      Messages for case expressions</span><span>
</span><a name="line-2421"></a><span>
</span><a name="line-2422"></a><span class="hs-identifier">mkDefaultArgsMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2423"></a><a name="mkDefaultArgsMsg"><a href="CoreLint.html#mkDefaultArgsMsg"><span class="hs-identifier">mkDefaultArgsMsg</span></a></a><span> </span><a name="local-6989586621679331983"><a href="#local-6989586621679331983"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-2424"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;DEFAULT case with binders&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2425"></a><span>         </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331983"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2426"></a><span>
</span><a name="line-2427"></a><span class="hs-identifier">mkCaseAltMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2428"></a><a name="mkCaseAltMsg"><a href="CoreLint.html#mkCaseAltMsg"><span class="hs-identifier">mkCaseAltMsg</span></a></a><span> </span><a name="local-6989586621679331984"><a href="#local-6989586621679331984"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679331985"><a href="#local-6989586621679331985"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621679331986"><a href="#local-6989586621679331986"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-2429"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Type of case alternatives not the same as the annotation on case:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2430"></a><span>         </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Actual type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331985"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span>
</span><a name="line-2431"></a><span>                   </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Annotation on case:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331986"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">,</span><span>
</span><a name="line-2432"></a><span>                   </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Alt Rhs:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331984"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2433"></a><span>
</span><a name="line-2434"></a><span class="hs-identifier">mkScrutMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TCvSubst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2435"></a><a name="mkScrutMsg"><a href="CoreLint.html#mkScrutMsg"><span class="hs-identifier">mkScrutMsg</span></a></a><span> </span><a name="local-6989586621679331987"><a href="#local-6989586621679331987"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679331988"><a href="#local-6989586621679331988"><span class="hs-identifier">var_ty</span></a></a><span> </span><a name="local-6989586621679331989"><a href="#local-6989586621679331989"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><a name="local-6989586621679331990"><a href="#local-6989586621679331990"><span class="hs-identifier">subst</span></a></a><span>
</span><a name="line-2436"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Result binder in case doesn't match scrutinee:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331987"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span>
</span><a name="line-2437"></a><span>          </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Result binder type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331988"><span class="hs-identifier hs-var">var_ty</span></a><span class="hs-special">,</span><span class="hs-comment">--(idType var),</span><span>
</span><a name="line-2438"></a><span>          </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Scrutinee type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331989"><span class="hs-identifier hs-var">scrut_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-2439"></a><span>     </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Current TCv subst&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331990"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-2440"></a><span>
</span><a name="line-2441"></a><span class="hs-identifier">mkNonDefltMsg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkNonIncreasingAltsMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2442"></a><a name="mkNonDefltMsg"><a href="CoreLint.html#mkNonDefltMsg"><span class="hs-identifier">mkNonDefltMsg</span></a></a><span> </span><a name="local-6989586621679331991"><a href="#local-6989586621679331991"><span class="hs-identifier">e</span></a></a><span>
</span><a name="line-2443"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Case expression with DEFAULT not at the beginning&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331991"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-2444"></a><a name="mkNonIncreasingAltsMsg"><a href="CoreLint.html#mkNonIncreasingAltsMsg"><span class="hs-identifier">mkNonIncreasingAltsMsg</span></a></a><span> </span><a name="local-6989586621679331992"><a href="#local-6989586621679331992"><span class="hs-identifier">e</span></a></a><span>
</span><a name="line-2445"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Case expression with badly-ordered alternatives&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331992"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-2446"></a><span>
</span><a name="line-2447"></a><span class="hs-identifier">nonExhaustiveAltsMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2448"></a><a name="nonExhaustiveAltsMsg"><a href="CoreLint.html#nonExhaustiveAltsMsg"><span class="hs-identifier">nonExhaustiveAltsMsg</span></a></a><span> </span><a name="local-6989586621679331993"><a href="#local-6989586621679331993"><span class="hs-identifier">e</span></a></a><span>
</span><a name="line-2449"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Case expression with non-exhaustive alternatives&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331993"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-2450"></a><span>
</span><a name="line-2451"></a><span class="hs-identifier">mkBadConMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2452"></a><a name="mkBadConMsg"><a href="CoreLint.html#mkBadConMsg"><span class="hs-identifier">mkBadConMsg</span></a></a><span> </span><a name="local-6989586621679331994"><a href="#local-6989586621679331994"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621679331995"><a href="#local-6989586621679331995"><span class="hs-identifier">datacon</span></a></a><span>
</span><a name="line-2453"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2454"></a><span>        </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In a case alternative, data constructor isn't in scrutinee type:&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2455"></a><span>        </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Scrutinee type constructor:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331994"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-2456"></a><span>        </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Data con:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331995"><span class="hs-identifier hs-var">datacon</span></a><span>
</span><a name="line-2457"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-2458"></a><span>
</span><a name="line-2459"></a><span class="hs-identifier">mkBadPatMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2460"></a><a name="mkBadPatMsg"><a href="CoreLint.html#mkBadPatMsg"><span class="hs-identifier">mkBadPatMsg</span></a></a><span> </span><a name="local-6989586621679331996"><a href="#local-6989586621679331996"><span class="hs-identifier">con_result_ty</span></a></a><span> </span><a name="local-6989586621679331997"><a href="#local-6989586621679331997"><span class="hs-identifier">scrut_ty</span></a></a><span>
</span><a name="line-2461"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2462"></a><span>        </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In a case alternative, pattern result type doesn't match scrutinee type:&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2463"></a><span>        </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Pattern result type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331996"><span class="hs-identifier hs-var">con_result_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-2464"></a><span>        </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Scrutinee type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331997"><span class="hs-identifier hs-var">scrut_ty</span></a><span>
</span><a name="line-2465"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-2466"></a><span>
</span><a name="line-2467"></a><span class="hs-identifier">integerScrutinisedMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2468"></a><a name="integerScrutinisedMsg"><a href="CoreLint.html#integerScrutinisedMsg"><span class="hs-identifier">integerScrutinisedMsg</span></a></a><span>
</span><a name="line-2469"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In a LitAlt, the literal is lifted (probably Integer)&quot;</span><span>
</span><a name="line-2470"></a><span>
</span><a name="line-2471"></a><span class="hs-identifier">mkBadAltMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreAlt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2472"></a><a name="mkBadAltMsg"><a href="CoreLint.html#mkBadAltMsg"><span class="hs-identifier">mkBadAltMsg</span></a></a><span> </span><a name="local-6989586621679331998"><a href="#local-6989586621679331998"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><a name="local-6989586621679331999"><a href="#local-6989586621679331999"><span class="hs-identifier">alt</span></a></a><span>
</span><a name="line-2473"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Data alternative when scrutinee is not a tycon application&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2474"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Scrutinee type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679331998"><span class="hs-identifier hs-var">scrut_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-2475"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Alternative:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprCoreAlt</span><span> </span><a href="#local-6989586621679331999"><span class="hs-identifier hs-var">alt</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2476"></a><span>
</span><a name="line-2477"></a><span class="hs-identifier">mkNewTyDataConAltMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreAlt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2478"></a><a name="mkNewTyDataConAltMsg"><a href="CoreLint.html#mkNewTyDataConAltMsg"><span class="hs-identifier">mkNewTyDataConAltMsg</span></a></a><span> </span><a name="local-6989586621679332000"><a href="#local-6989586621679332000"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><a name="local-6989586621679332001"><a href="#local-6989586621679332001"><span class="hs-identifier">alt</span></a></a><span>
</span><a name="line-2479"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Data alternative for newtype datacon&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2480"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Scrutinee type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332000"><span class="hs-identifier hs-var">scrut_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-2481"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Alternative:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprCoreAlt</span><span> </span><a href="#local-6989586621679332001"><span class="hs-identifier hs-var">alt</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2482"></a><span>
</span><a name="line-2483"></a><span>
</span><a name="line-2484"></a><span class="hs-comment">------------------------------------------------------</span><span>
</span><a name="line-2485"></a><span class="hs-comment">--      Other error messages</span><span>
</span><a name="line-2486"></a><span>
</span><a name="line-2487"></a><span class="hs-identifier">mkAppMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2488"></a><a name="mkAppMsg"><a href="CoreLint.html#mkAppMsg"><span class="hs-identifier">mkAppMsg</span></a></a><span> </span><a name="local-6989586621679332002"><a href="#local-6989586621679332002"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621679332003"><a href="#local-6989586621679332003"><span class="hs-identifier">arg_ty</span></a></a><span> </span><a name="local-6989586621679332004"><a href="#local-6989586621679332004"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-2489"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Argument value doesn't match argument type:&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2490"></a><span>              </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Fun type:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332002"><span class="hs-identifier hs-var">fun_ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2491"></a><span>              </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arg type:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332003"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2492"></a><span>              </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arg:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332004"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2493"></a><span>
</span><a name="line-2494"></a><span class="hs-identifier">mkNonFunAppMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2495"></a><a name="mkNonFunAppMsg"><a href="CoreLint.html#mkNonFunAppMsg"><span class="hs-identifier">mkNonFunAppMsg</span></a></a><span> </span><a name="local-6989586621679332005"><a href="#local-6989586621679332005"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621679332006"><a href="#local-6989586621679332006"><span class="hs-identifier">arg_ty</span></a></a><span> </span><a name="local-6989586621679332007"><a href="#local-6989586621679332007"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-2496"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non-function type in function position&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2497"></a><span>              </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Fun type:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332005"><span class="hs-identifier hs-var">fun_ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2498"></a><span>              </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arg type:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332006"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2499"></a><span>              </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arg:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332007"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2500"></a><span>
</span><a name="line-2501"></a><span class="hs-identifier">mkLetErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2502"></a><a name="mkLetErr"><a href="CoreLint.html#mkLetErr"><span class="hs-identifier">mkLetErr</span></a></a><span> </span><a name="local-6989586621679332008"><a href="#local-6989586621679332008"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679332009"><a href="#local-6989586621679332009"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-2503"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Bad `let' binding:&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2504"></a><span>          </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Variable:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2505"></a><span>                 </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332008"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679332008"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2506"></a><span>          </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Rhs:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2507"></a><span>                 </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332009"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2508"></a><span>
</span><a name="line-2509"></a><span class="hs-identifier">mkTyAppMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2510"></a><a name="mkTyAppMsg"><a href="CoreLint.html#mkTyAppMsg"><span class="hs-identifier">mkTyAppMsg</span></a></a><span> </span><a name="local-6989586621679332010"><a href="#local-6989586621679332010"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679332011"><a href="#local-6989586621679332011"><span class="hs-identifier">arg_ty</span></a></a><span>
</span><a name="line-2511"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal type application:&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2512"></a><span>              </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Exp type:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2513"></a><span>                 </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332010"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679332010"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2514"></a><span>              </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arg type:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2515"></a><span>                 </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332011"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679332011"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2516"></a><span>
</span><a name="line-2517"></a><span class="hs-identifier">emptyRec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2518"></a><a name="emptyRec"><a href="CoreLint.html#emptyRec"><span class="hs-identifier">emptyRec</span></a></a><span> </span><a name="local-6989586621679332012"><a href="#local-6989586621679332012"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Empty Rec binding:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332012"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-2519"></a><span>
</span><a name="line-2520"></a><span class="hs-identifier">mkRhsMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2521"></a><a name="mkRhsMsg"><a href="CoreLint.html#mkRhsMsg"><span class="hs-identifier">mkRhsMsg</span></a></a><span> </span><a name="local-6989586621679332013"><a href="#local-6989586621679332013"><span class="hs-identifier">binder</span></a></a><span> </span><a name="local-6989586621679332014"><a href="#local-6989586621679332014"><span class="hs-identifier">what</span></a></a><span> </span><a name="local-6989586621679332015"><a href="#local-6989586621679332015"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2522"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span>
</span><a name="line-2523"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;The type of this binder doesn't match the type of its&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679332014"><span class="hs-identifier hs-var">what</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span class="hs-special">,</span><span>
</span><a name="line-2524"></a><span>            </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332013"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-2525"></a><span>     </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Binder's type:&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679332013"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-2526"></a><span>     </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Rhs type:&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332015"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-2527"></a><span>
</span><a name="line-2528"></a><span class="hs-identifier">mkLetAppMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2529"></a><a name="mkLetAppMsg"><a href="CoreLint.html#mkLetAppMsg"><span class="hs-identifier">mkLetAppMsg</span></a></a><span> </span><a name="local-6989586621679332016"><a href="#local-6989586621679332016"><span class="hs-identifier">e</span></a></a><span>
</span><a name="line-2530"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;This argument does not satisfy the let/app invariant:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2531"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332016"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-2532"></a><span>
</span><a name="line-2533"></a><span class="hs-identifier">badBndrTyMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2534"></a><a name="badBndrTyMsg"><a href="CoreLint.html#badBndrTyMsg"><span class="hs-identifier">badBndrTyMsg</span></a></a><span> </span><a name="local-6989586621679332017"><a href="#local-6989586621679332017"><span class="hs-identifier">binder</span></a></a><span> </span><a name="local-6989586621679332018"><a href="#local-6989586621679332018"><span class="hs-identifier">what</span></a></a><span>
</span><a name="line-2535"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;The type of this binder is&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679332018"><span class="hs-identifier hs-var">what</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332017"><span class="hs-identifier hs-var">binder</span></a><span>
</span><a name="line-2536"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Binder's type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679332017"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2537"></a><span>
</span><a name="line-2538"></a><span class="hs-identifier">mkStrictMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2539"></a><a name="mkStrictMsg"><a href="CoreLint.html#mkStrictMsg"><span class="hs-identifier">mkStrictMsg</span></a></a><span> </span><a name="local-6989586621679332019"><a href="#local-6989586621679332019"><span class="hs-identifier">binder</span></a></a><span>
</span><a name="line-2540"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Recursive or top-level binder has strict demand info:&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2541"></a><span>                     </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332019"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-2542"></a><span>              </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Binder's demand info:&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idDemandInfo</span><span> </span><a href="#local-6989586621679332019"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2543"></a><span>             </span><span class="hs-special">]</span><span>
</span><a name="line-2544"></a><span>
</span><a name="line-2545"></a><span class="hs-identifier">mkNonTopExportedMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2546"></a><a name="mkNonTopExportedMsg"><a href="CoreLint.html#mkNonTopExportedMsg"><span class="hs-identifier">mkNonTopExportedMsg</span></a></a><span> </span><a name="local-6989586621679332020"><a href="#local-6989586621679332020"><span class="hs-identifier">binder</span></a></a><span>
</span><a name="line-2547"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non-top-level binder is marked as exported:&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332020"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">]</span><span>
</span><a name="line-2548"></a><span>
</span><a name="line-2549"></a><span class="hs-identifier">mkNonTopExternalNameMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2550"></a><a name="mkNonTopExternalNameMsg"><a href="CoreLint.html#mkNonTopExternalNameMsg"><span class="hs-identifier">mkNonTopExternalNameMsg</span></a></a><span> </span><a name="local-6989586621679332021"><a href="#local-6989586621679332021"><span class="hs-identifier">binder</span></a></a><span>
</span><a name="line-2551"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non-top-level binder has an external name:&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332021"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">]</span><span>
</span><a name="line-2552"></a><span>
</span><a name="line-2553"></a><span class="hs-identifier">mkTopNonLitStrMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2554"></a><a name="mkTopNonLitStrMsg"><a href="CoreLint.html#mkTopNonLitStrMsg"><span class="hs-identifier">mkTopNonLitStrMsg</span></a></a><span> </span><a name="local-6989586621679332022"><a href="#local-6989586621679332022"><span class="hs-identifier">binder</span></a></a><span>
</span><a name="line-2555"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Top-level Addr# binder has a non-literal rhs:&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332022"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">]</span><span>
</span><a name="line-2556"></a><span>
</span><a name="line-2557"></a><span class="hs-identifier">mkKindErrMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2558"></a><a name="mkKindErrMsg"><a href="CoreLint.html#mkKindErrMsg"><span class="hs-identifier">mkKindErrMsg</span></a></a><span> </span><a name="local-6989586621679332023"><a href="#local-6989586621679332023"><span class="hs-identifier">tyvar</span></a></a><span> </span><a name="local-6989586621679332024"><a href="#local-6989586621679332024"><span class="hs-identifier">arg_ty</span></a></a><span>
</span><a name="line-2559"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Kinds don't match in type application:&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2560"></a><span>          </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Type variable:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2561"></a><span>                 </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332023"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621679332023"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2562"></a><span>          </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arg type:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2563"></a><span>                 </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332024"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621679332024"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2564"></a><span>
</span><a name="line-2565"></a><span class="hs-comment">{- Not needed now
mkArityMsg :: Id -&gt; MsgDoc
mkArityMsg binder
  = vcat [hsep [text &quot;Demand type has&quot;,
                ppr (dmdTypeDepth dmd_ty),
                text &quot;arguments, rhs has&quot;,
                ppr (idArity binder),
                text &quot;arguments,&quot;,
                ppr binder],
              hsep [text &quot;Binder's strictness signature:&quot;, ppr dmd_ty]

         ]
           where (StrictSig dmd_ty) = idStrictness binder
-}</span><span>
</span><a name="line-2579"></a><span class="hs-identifier">mkCastErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2580"></a><a name="mkCastErr"><a href="CoreLint.html#mkCastErr"><span class="hs-identifier">mkCastErr</span></a></a><span> </span><a name="local-6989586621679332025"><a href="#local-6989586621679332025"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#mk_cast_err"><span class="hs-identifier hs-var">mk_cast_err</span></a><span> </span><span class="hs-string">&quot;expression&quot;</span><span> </span><span class="hs-string">&quot;type&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332025"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2581"></a><span>
</span><a name="line-2582"></a><span class="hs-identifier">mkCastTyErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2583"></a><a name="mkCastTyErr"><a href="CoreLint.html#mkCastTyErr"><span class="hs-identifier">mkCastTyErr</span></a></a><span> </span><a name="local-6989586621679332026"><a href="#local-6989586621679332026"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreLint.html#mk_cast_err"><span class="hs-identifier hs-var">mk_cast_err</span></a><span> </span><span class="hs-string">&quot;type&quot;</span><span> </span><span class="hs-string">&quot;kind&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332026"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2584"></a><span>
</span><a name="line-2585"></a><span class="hs-identifier">mk_cast_err</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ What sort of casted thing this is</span><span>
</span><a name="line-2586"></a><span>                      </span><span class="hs-comment">--   (\&quot;expression\&quot; or \&quot;type\&quot;).</span><span>
</span><a name="line-2587"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ What sort of coercion is being used</span><span>
</span><a name="line-2588"></a><span>                      </span><span class="hs-comment">--   (\&quot;type\&quot; or \&quot;kind\&quot;).</span><span>
</span><a name="line-2589"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>   </span><span class="hs-comment">-- ^ The thing being casted.</span><span>
</span><a name="line-2590"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2591"></a><a name="mk_cast_err"><a href="CoreLint.html#mk_cast_err"><span class="hs-identifier">mk_cast_err</span></a></a><span> </span><a name="local-6989586621679332027"><a href="#local-6989586621679332027"><span class="hs-identifier">thing_str</span></a></a><span> </span><a name="local-6989586621679332028"><a href="#local-6989586621679332028"><span class="hs-identifier">co_str</span></a></a><span> </span><a name="local-6989586621679332029"><a href="#local-6989586621679332029"><span class="hs-identifier">pp_thing</span></a></a><span> </span><a name="local-6989586621679332030"><a href="#local-6989586621679332030"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679332031"><a href="#local-6989586621679332031"><span class="hs-identifier">from_ty</span></a></a><span> </span><a name="local-6989586621679332032"><a href="#local-6989586621679332032"><span class="hs-identifier">thing_ty</span></a></a><span>
</span><a name="line-2592"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679332034"><span class="hs-identifier hs-var">from_msg</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;of Cast differs from&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679332033"><span class="hs-identifier hs-var">co_msg</span></a><span>
</span><a name="line-2593"></a><span>            </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;of&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679332035"><span class="hs-identifier hs-var">enclosed_msg</span></a><span class="hs-special">,</span><span>
</span><a name="line-2594"></a><span>          </span><a href="#local-6989586621679332034"><span class="hs-identifier hs-var">from_msg</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332031"><span class="hs-identifier hs-var">from_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-2595"></a><span>          </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">capitalise</span><span> </span><a href="#local-6989586621679332028"><span class="hs-identifier hs-var">co_str</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;of&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679332035"><span class="hs-identifier hs-var">enclosed_msg</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span>
</span><a name="line-2596"></a><span>            </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332032"><span class="hs-identifier hs-var">thing_ty</span></a><span class="hs-special">,</span><span>
</span><a name="line-2597"></a><span>          </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Actual&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679332035"><span class="hs-identifier hs-var">enclosed_msg</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621679332029"><span class="hs-identifier hs-var">pp_thing</span></a><span class="hs-special">,</span><span>
</span><a name="line-2598"></a><span>          </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Coercion used in cast:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332030"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2599"></a><span>         </span><span class="hs-special">]</span><span>
</span><a name="line-2600"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2601"></a><span>    </span><span class="hs-identifier">co_msg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">from_msg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">enclosed_msg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2602"></a><span>    </span><a name="local-6989586621679332033"><a href="#local-6989586621679332033"><span class="hs-identifier">co_msg</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621679332028"><span class="hs-identifier hs-var">co_str</span></a><span>
</span><a name="line-2603"></a><span>    </span><a name="local-6989586621679332034"><a href="#local-6989586621679332034"><span class="hs-identifier">from_msg</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;From-&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679332033"><span class="hs-identifier hs-var">co_msg</span></a><span>
</span><a name="line-2604"></a><span>    </span><a name="local-6989586621679332035"><a href="#local-6989586621679332035"><span class="hs-identifier">enclosed_msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;enclosed&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621679332027"><span class="hs-identifier hs-var">thing_str</span></a><span>
</span><a name="line-2605"></a><span>
</span><a name="line-2606"></a><span class="hs-identifier">mkBadUnivCoMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LeftOrRight</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2607"></a><a name="mkBadUnivCoMsg"><a href="CoreLint.html#mkBadUnivCoMsg"><span class="hs-identifier">mkBadUnivCoMsg</span></a></a><span> </span><a name="local-6989586621679332036"><a href="#local-6989586621679332036"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621679332037"><a href="#local-6989586621679332037"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-2608"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Kind mismatch on the&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="CoreLint.html#pprLeftOrRight"><span class="hs-identifier hs-var">pprLeftOrRight</span></a><span> </span><a href="#local-6989586621679332036"><span class="hs-identifier hs-var">lr</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-2609"></a><span>    </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;side of a UnivCo:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332037"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2610"></a><span>
</span><a name="line-2611"></a><span class="hs-identifier">mkBadProofIrrelMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2612"></a><a name="mkBadProofIrrelMsg"><a href="CoreLint.html#mkBadProofIrrelMsg"><span class="hs-identifier">mkBadProofIrrelMsg</span></a></a><span> </span><a name="local-6989586621679332038"><a href="#local-6989586621679332038"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621679332039"><a href="#local-6989586621679332039"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-2613"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Found a non-coercion in a proof-irrelevance UnivCo:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2614"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332038"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2615"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;co:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332039"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2616"></a><span>
</span><a name="line-2617"></a><span class="hs-identifier">mkBadTyVarMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2618"></a><a name="mkBadTyVarMsg"><a href="CoreLint.html#mkBadTyVarMsg"><span class="hs-identifier">mkBadTyVarMsg</span></a></a><span> </span><a name="local-6989586621679332040"><a href="#local-6989586621679332040"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-2619"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Non-tyvar used in TyVarTy:&quot;</span><span>
</span><a name="line-2620"></a><span>      </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332040"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621679332040"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2621"></a><span>
</span><a name="line-2622"></a><span class="hs-identifier">mkBadJoinBindMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2623"></a><a name="mkBadJoinBindMsg"><a href="CoreLint.html#mkBadJoinBindMsg"><span class="hs-identifier">mkBadJoinBindMsg</span></a></a><span> </span><a name="local-6989586621679332041"><a href="#local-6989586621679332041"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-2624"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Bad join point binding:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332041"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-2625"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join points can be bound only by a non-top-level let&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2626"></a><span>
</span><a name="line-2627"></a><span class="hs-identifier">mkInvalidJoinPointMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2628"></a><a name="mkInvalidJoinPointMsg"><a href="CoreLint.html#mkInvalidJoinPointMsg"><span class="hs-identifier">mkInvalidJoinPointMsg</span></a></a><span> </span><a name="local-6989586621679332042"><a href="#local-6989586621679332042"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679332043"><a href="#local-6989586621679332043"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2629"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join point has invalid type:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2630"></a><span>        </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332042"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332043"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2631"></a><span>
</span><a name="line-2632"></a><span class="hs-identifier">mkBadJoinArityMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2633"></a><a name="mkBadJoinArityMsg"><a href="CoreLint.html#mkBadJoinArityMsg"><span class="hs-identifier">mkBadJoinArityMsg</span></a></a><span> </span><a name="local-6989586621679332044"><a href="#local-6989586621679332044"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679332045"><a href="#local-6989586621679332045"><span class="hs-identifier">ar</span></a></a><span> </span><a name="local-6989586621679332046"><a href="#local-6989586621679332046"><span class="hs-identifier">nlams</span></a></a><span> </span><a name="local-6989586621679332047"><a href="#local-6989586621679332047"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-2634"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join point has too few lambdas&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2635"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join var:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332044"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span>
</span><a name="line-2636"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join arity:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332045"><span class="hs-identifier hs-var">ar</span></a><span class="hs-special">,</span><span>
</span><a name="line-2637"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Number of lambdas:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332046"><span class="hs-identifier hs-var">nlams</span></a><span class="hs-special">,</span><span>
</span><a name="line-2638"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Rhs = &quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332047"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-2639"></a><span>           </span><span class="hs-special">]</span><span>
</span><a name="line-2640"></a><span>
</span><a name="line-2641"></a><span class="hs-identifier">invalidJoinOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2642"></a><a name="invalidJoinOcc"><a href="CoreLint.html#invalidJoinOcc"><span class="hs-identifier">invalidJoinOcc</span></a></a><span> </span><a name="local-6989586621679332048"><a href="#local-6989586621679332048"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-2643"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Invalid occurrence of a join variable:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332048"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-2644"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;The binder is either not a join point, or not valid here&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2645"></a><span>
</span><a name="line-2646"></a><span class="hs-identifier">mkBadJumpMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2647"></a><a name="mkBadJumpMsg"><a href="CoreLint.html#mkBadJumpMsg"><span class="hs-identifier">mkBadJumpMsg</span></a></a><span> </span><a name="local-6989586621679332049"><a href="#local-6989586621679332049"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679332050"><a href="#local-6989586621679332050"><span class="hs-identifier">ar</span></a></a><span> </span><a name="local-6989586621679332051"><a href="#local-6989586621679332051"><span class="hs-identifier">nargs</span></a></a><span>
</span><a name="line-2648"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join point invoked with wrong number of arguments&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2649"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join var:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332049"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span>
</span><a name="line-2650"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join arity:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332050"><span class="hs-identifier hs-var">ar</span></a><span class="hs-special">,</span><span>
</span><a name="line-2651"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Number of arguments:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><a href="#local-6989586621679332051"><span class="hs-identifier hs-var">nargs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2652"></a><span>
</span><a name="line-2653"></a><span class="hs-identifier">mkInconsistentRecMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2654"></a><a name="mkInconsistentRecMsg"><a href="CoreLint.html#mkInconsistentRecMsg"><span class="hs-identifier">mkInconsistentRecMsg</span></a></a><span> </span><a name="local-6989586621679332052"><a href="#local-6989586621679332052"><span class="hs-identifier">bndrs</span></a></a><span>
</span><a name="line-2655"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Recursive let binders mix values and join points&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2656"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Binders:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679332053"><span class="hs-identifier hs-var">ppr_with_details</span></a><span> </span><a href="#local-6989586621679332052"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2657"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2658"></a><span>    </span><a name="local-6989586621679332053"><a href="#local-6989586621679332053"><span class="hs-identifier">ppr_with_details</span></a></a><span> </span><a name="local-6989586621679332054"><a href="#local-6989586621679332054"><span class="hs-identifier">bndr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332054"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idDetails</span><span> </span><a href="#local-6989586621679332054"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2659"></a><span>
</span><a name="line-2660"></a><span class="hs-identifier">mkJoinBndrOccMismatchMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">JoinArity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">JoinArity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2661"></a><a name="mkJoinBndrOccMismatchMsg"><a href="CoreLint.html#mkJoinBndrOccMismatchMsg"><span class="hs-identifier">mkJoinBndrOccMismatchMsg</span></a></a><span> </span><a name="local-6989586621679332055"><a href="#local-6989586621679332055"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679332056"><a href="#local-6989586621679332056"><span class="hs-identifier">join_arity_bndr</span></a></a><span> </span><a name="local-6989586621679332057"><a href="#local-6989586621679332057"><span class="hs-identifier">join_arity_occ</span></a></a><span>
</span><a name="line-2662"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Mismatch in join point arity between binder and occurrence&quot;</span><span>
</span><a name="line-2663"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Var:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332055"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-2664"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arity at binding site:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332056"><span class="hs-identifier hs-var">join_arity_bndr</span></a><span>
</span><a name="line-2665"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Arity at occurrence:  &quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332057"><span class="hs-identifier hs-var">join_arity_occ</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2666"></a><span>
</span><a name="line-2667"></a><span class="hs-identifier">mkBndrOccTypeMismatchMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2668"></a><a name="mkBndrOccTypeMismatchMsg"><a href="CoreLint.html#mkBndrOccTypeMismatchMsg"><span class="hs-identifier">mkBndrOccTypeMismatchMsg</span></a></a><span> </span><a name="local-6989586621679332058"><a href="#local-6989586621679332058"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679332059"><a href="#local-6989586621679332059"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621679332060"><a href="#local-6989586621679332060"><span class="hs-identifier">bndr_ty</span></a></a><span> </span><a name="local-6989586621679332061"><a href="#local-6989586621679332061"><span class="hs-identifier">var_ty</span></a></a><span>
</span><a name="line-2669"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Mismatch in type between binder and occurrence&quot;</span><span>
</span><a name="line-2670"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Var:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332058"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-2671"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Binder type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332060"><span class="hs-identifier hs-var">bndr_ty</span></a><span>
</span><a name="line-2672"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Occurrence type:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332061"><span class="hs-identifier hs-var">var_ty</span></a><span>
</span><a name="line-2673"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;  Before subst:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621679332059"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2674"></a><span>
</span><a name="line-2675"></a><span class="hs-identifier">mkBadJoinPointRuleMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">JoinId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">JoinArity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreRule</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2676"></a><a name="mkBadJoinPointRuleMsg"><a href="CoreLint.html#mkBadJoinPointRuleMsg"><span class="hs-identifier">mkBadJoinPointRuleMsg</span></a></a><span> </span><a name="local-6989586621679332062"><a href="#local-6989586621679332062"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679332063"><a href="#local-6989586621679332063"><span class="hs-identifier">join_arity</span></a></a><span> </span><a name="local-6989586621679332064"><a href="#local-6989586621679332064"><span class="hs-identifier">rule</span></a></a><span>
</span><a name="line-2677"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join point has rule with wrong number of arguments&quot;</span><span>
</span><a name="line-2678"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Var:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332062"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-2679"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Join arity:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332063"><span class="hs-identifier hs-var">join_arity</span></a><span>
</span><a name="line-2680"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Rule:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679332064"><span class="hs-identifier hs-var">rule</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2681"></a><span>
</span><a name="line-2682"></a><span class="hs-identifier">pprLeftOrRight</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LeftOrRight</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2683"></a><a name="pprLeftOrRight"><a href="CoreLint.html#pprLeftOrRight"><span class="hs-identifier">pprLeftOrRight</span></a></a><span> </span><span class="hs-identifier hs-var">CLeft</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;left&quot;</span><span>
</span><a name="line-2684"></a><span class="hs-identifier">pprLeftOrRight</span><span> </span><span class="hs-identifier hs-var">CRight</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;right&quot;</span><span>
</span><a name="line-2685"></a><span>
</span><a name="line-2686"></a><span class="hs-identifier">dupVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2687"></a><a name="dupVars"><a href="CoreLint.html#dupVars"><span class="hs-identifier">dupVars</span></a></a><span> </span><a name="local-6989586621679332065"><a href="#local-6989586621679332065"><span class="hs-identifier">vars</span></a></a><span>
</span><a name="line-2688"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Duplicate variables brought into scope&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2689"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679332065"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2690"></a><span>
</span><a name="line-2691"></a><span class="hs-identifier">dupExtVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MsgDoc</span><span>
</span><a name="line-2692"></a><a name="dupExtVars"><a href="CoreLint.html#dupExtVars"><span class="hs-identifier">dupExtVars</span></a></a><span> </span><a name="local-6989586621679332066"><a href="#local-6989586621679332066"><span class="hs-identifier">vars</span></a></a><span>
</span><a name="line-2693"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Duplicate top-level variables with the same qualified name&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2694"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679332066"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2695"></a><span>
</span><a name="line-2696"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Annotation Linting}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2703"></a><span>
</span><a name="line-2704"></a><span class="hs-comment">-- | This checks whether a pass correctly looks through debug</span><span>
</span><a name="line-2705"></a><span class="hs-comment">-- annotations (@SourceNote@). This works a bit different from other</span><span>
</span><a name="line-2706"></a><span class="hs-comment">-- consistency checks: We check this by running the given task twice,</span><span>
</span><a name="line-2707"></a><span class="hs-comment">-- noting all differences between the results.</span><span>
</span><a name="line-2708"></a><span class="hs-identifier">lintAnnots</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModGuts</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreM</span><span> </span><span class="hs-identifier hs-type">ModGuts</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ModGuts</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreM</span><span> </span><span class="hs-identifier hs-type">ModGuts</span><span>
</span><a name="line-2709"></a><a name="lintAnnots"><a href="CoreLint.html#lintAnnots"><span class="hs-identifier">lintAnnots</span></a></a><span> </span><a name="local-6989586621679332067"><a href="#local-6989586621679332067"><span class="hs-identifier">pname</span></a></a><span> </span><a name="local-6989586621679332068"><a href="#local-6989586621679332068"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621679332069"><a href="#local-6989586621679332069"><span class="hs-identifier">guts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2710"></a><span>  </span><span class="hs-comment">-- Run the pass as we normally would</span><span>
</span><a name="line-2711"></a><span>  </span><a name="local-6989586621679332070"><a href="#local-6989586621679332070"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2712"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_DoAnnotationLinting</span><span> </span><a href="#local-6989586621679332070"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2713"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Err.showPass</span><span> </span><a href="#local-6989586621679332070"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Annotation linting - first run&quot;</span><span>
</span><a name="line-2714"></a><span>  </span><a name="local-6989586621679332071"><a href="#local-6989586621679332071"><span class="hs-identifier">nguts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679332068"><span class="hs-identifier hs-var">pass</span></a><span> </span><a href="#local-6989586621679332069"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-2715"></a><span>  </span><span class="hs-comment">-- If appropriate re-run it without debug annotations to make sure</span><span>
</span><a name="line-2716"></a><span>  </span><span class="hs-comment">-- that they made no difference.</span><span>
</span><a name="line-2717"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_DoAnnotationLinting</span><span> </span><a href="#local-6989586621679332070"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2718"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Err.showPass</span><span> </span><a href="#local-6989586621679332070"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Annotation linting - second run&quot;</span><span>
</span><a name="line-2719"></a><span>    </span><a name="local-6989586621679332072"><a href="#local-6989586621679332072"><span class="hs-identifier">nguts'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreLint.html#withoutAnnots"><span class="hs-identifier hs-var">withoutAnnots</span></a><span> </span><a href="#local-6989586621679332068"><span class="hs-identifier hs-var">pass</span></a><span> </span><a href="#local-6989586621679332069"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-2720"></a><span>    </span><span class="hs-comment">-- Finally compare the resulting bindings</span><span>
</span><a name="line-2721"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Err.showPass</span><span> </span><a href="#local-6989586621679332070"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-string">&quot;Annotation linting - comparison&quot;</span><span>
</span><a name="line-2722"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679332073"><a href="#local-6989586621679332073"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flattenBinds</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">mg_binds</span><span> </span><a href="#local-6989586621679332071"><span class="hs-identifier hs-var">nguts</span></a><span>
</span><a name="line-2723"></a><span>        </span><a name="local-6989586621679332074"><a href="#local-6989586621679332074"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flattenBinds</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">mg_binds</span><span> </span><a href="#local-6989586621679332072"><span class="hs-identifier hs-var">nguts'</span></a><span>
</span><a name="line-2724"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679332075"><a href="#local-6989586621679332075"><span class="hs-identifier">diffs</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">diffBinds</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkRnEnv2</span><span> </span><span class="hs-identifier hs-var">emptyInScopeSet</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679332073"><span class="hs-identifier hs-var">binds</span></a><span> </span><a href="#local-6989586621679332074"><span class="hs-identifier hs-var">binds'</span></a><span>
</span><a name="line-2725"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679332075"><span class="hs-identifier hs-var">diffs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">CoreMonad.putMsg</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">vcat</span><span>
</span><a name="line-2726"></a><span>      </span><span class="hs-special">[</span><span> </span><a href="CoreLint.html#lint_banner"><span class="hs-identifier hs-var">lint_banner</span></a><span> </span><span class="hs-string">&quot;warning&quot;</span><span> </span><a href="#local-6989586621679332067"><span class="hs-identifier hs-var">pname</span></a><span>
</span><a name="line-2727"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Core changes with annotations:&quot;</span><span>
</span><a name="line-2728"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">withPprStyle</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">defaultDumpStyle</span><span> </span><a href="#local-6989586621679332070"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><a href="#local-6989586621679332075"><span class="hs-identifier hs-var">diffs</span></a><span>
</span><a name="line-2729"></a><span>      </span><span class="hs-special">]</span><span>
</span><a name="line-2730"></a><span>  </span><span class="hs-comment">-- Return actual new guts</span><span>
</span><a name="line-2731"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679332071"><span class="hs-identifier hs-var">nguts</span></a><span>
</span><a name="line-2732"></a><span>
</span><a name="line-2733"></a><span class="hs-comment">-- | Run the given pass without annotations. This means that we both</span><span>
</span><a name="line-2734"></a><span class="hs-comment">-- set the debugLevel setting to 0 in the environment as well as all</span><span>
</span><a name="line-2735"></a><span class="hs-comment">-- annotations from incoming modules.</span><span>
</span><a name="line-2736"></a><span class="hs-identifier">withoutAnnots</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ModGuts</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreM</span><span> </span><span class="hs-identifier hs-type">ModGuts</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ModGuts</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreM</span><span> </span><span class="hs-identifier hs-type">ModGuts</span><span>
</span><a name="line-2737"></a><a name="withoutAnnots"><a href="CoreLint.html#withoutAnnots"><span class="hs-identifier">withoutAnnots</span></a></a><span> </span><a name="local-6989586621679332076"><a href="#local-6989586621679332076"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621679332077"><a href="#local-6989586621679332077"><span class="hs-identifier">guts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2738"></a><span>  </span><span class="hs-comment">-- Remove debug flag from environment.</span><span>
</span><a name="line-2739"></a><span>  </span><a name="local-6989586621679332078"><a href="#local-6989586621679332078"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2740"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679332079"><a href="#local-6989586621679332079"><span class="hs-identifier">removeFlag</span></a></a><span> </span><a name="local-6989586621679332081"><a href="#local-6989586621679332081"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679332081"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679332078"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">debugLevel</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2741"></a><span>      </span><a name="local-6989586621679332080"><a href="#local-6989586621679332080"><span class="hs-identifier">withoutFlag</span></a></a><span> </span><a name="local-6989586621679332082"><a href="#local-6989586621679332082"><span class="hs-identifier">corem</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2742"></a><span>        </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-identifier hs-var">runCoreM</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679332079"><span class="hs-identifier hs-var">removeFlag</span></a><span> </span><span class="hs-identifier hs-var">getHscEnv</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">getRuleBase</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span>
</span><a name="line-2743"></a><span>                                </span><span class="hs-identifier hs-var">getUniqueSupplyM</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">getModule</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span>
</span><a name="line-2744"></a><span>                                </span><span class="hs-identifier hs-var">getVisibleOrphanMods</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span>
</span><a name="line-2745"></a><span>                                </span><span class="hs-identifier hs-var">getPrintUnqualified</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">getSrcSpanM</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span>
</span><a name="line-2746"></a><span>                                </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679332082"><span class="hs-identifier hs-var">corem</span></a><span>
</span><a name="line-2747"></a><span>  </span><span class="hs-comment">-- Nuke existing ticks in module.</span><span>
</span><a name="line-2748"></a><span>  </span><span class="hs-comment">-- TODO: Ticks in unfoldings. Maybe change unfolding so it removes</span><span>
</span><a name="line-2749"></a><span>  </span><span class="hs-comment">-- them in absence of debugLevel &gt; 0.</span><span>
</span><a name="line-2750"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679332083"><a href="#local-6989586621679332083"><span class="hs-identifier">nukeTicks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">stripTicksE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">tickishIsCode</span><span class="hs-special">)</span><span>
</span><a name="line-2751"></a><span>      </span><span class="hs-identifier">nukeAnnotsBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreBind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreBind</span><span>
</span><a name="line-2752"></a><span>      </span><a name="local-6989586621679332084"><a href="#local-6989586621679332084"><span class="hs-identifier">nukeAnnotsBind</span></a></a><span> </span><a name="local-6989586621679332086"><a href="#local-6989586621679332086"><span class="hs-identifier">bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679332086"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2753"></a><span>        </span><span class="hs-identifier hs-var">Rec</span><span> </span><a name="local-6989586621679332087"><a href="#local-6989586621679332087"><span class="hs-identifier">bs</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Rec</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679332088"><a href="#local-6989586621679332088"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-6989586621679332089"><a href="#local-6989586621679332089"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679332088"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679332083"><span class="hs-identifier hs-var">nukeTicks</span></a><span> </span><a href="#local-6989586621679332089"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679332087"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-2754"></a><span>        </span><span class="hs-identifier hs-var">NonRec</span><span> </span><a name="local-6989586621679332090"><a href="#local-6989586621679332090"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679332091"><a href="#local-6989586621679332091"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NonRec</span><span> </span><a href="#local-6989586621679332090"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679332083"><span class="hs-identifier hs-var">nukeTicks</span></a><span> </span><a href="#local-6989586621679332091"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-2755"></a><span>      </span><a name="local-6989586621679332085"><a href="#local-6989586621679332085"><span class="hs-identifier">nukeAnnotsMod</span></a></a><span> </span><a name="local-6989586621679332092"><a href="#local-6989586621679332092"><span class="hs-identifier">mg</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">ModGuts</span><span class="hs-special">{</span><span class="hs-identifier">mg_binds</span><span class="hs-glyph">=</span><a name="local-6989586621679332093"><a href="#local-6989586621679332093"><span class="hs-identifier">binds</span></a></a><span class="hs-special">}</span><span>
</span><a name="line-2756"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679332092"><span class="hs-identifier hs-var">mg</span></a><span class="hs-special">{</span><span class="hs-identifier">mg_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679332084"><span class="hs-identifier hs-var">nukeAnnotsBind</span></a><span> </span><a href="#local-6989586621679332093"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">}</span><span>
</span><a name="line-2757"></a><span>  </span><span class="hs-comment">-- Perform pass with all changes applied</span><span>
</span><a name="line-2758"></a><span>  </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679332080"><span class="hs-identifier hs-var">withoutFlag</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679332076"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679332085"><span class="hs-identifier hs-var">nukeAnnotsMod</span></a><span> </span><a href="#local-6989586621679332077"><span class="hs-identifier hs-var">guts</span></a><span class="hs-special">)</span><span>
</span><a name="line-2759"></a></pre></body></html>