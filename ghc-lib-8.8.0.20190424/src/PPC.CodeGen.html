<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, GADTs #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Generating machine code (instruction selection)</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- (c) The University of Glasgow 1996-2004</span><span>
</span><a name="line-8"></a><span class="hs-comment">--</span><span>
</span><a name="line-9"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-comment">-- This is a big module, but, if you pay attention to</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- (a) the sectioning, and (b) the type signatures,</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- the structure should not be too overwhelming.</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PPC.CodeGen</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-16"></a><span>        </span><a href="PPC.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier hs-var">cmmTopCodeGen</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="PPC.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier hs-var">generateJumpTableForInstr</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-19"></a><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">where</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
#include &quot;nativeGen/NCG.h&quot;
#include &quot;../includes/MachDeps.h&quot;
</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- NCG stuff:</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="CodeGen.Platform.html"><span class="hs-identifier">CodeGen.Platform</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="PPC.Instr.html"><span class="hs-identifier">PPC.Instr</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="PPC.Cond.html"><span class="hs-identifier">PPC.Cond</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="PPC.Regs.html"><span class="hs-identifier">PPC.Regs</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="CPrim.html"><span class="hs-identifier">CPrim</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="NCGMonad.html"><span class="hs-identifier">NCGMonad</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-36"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getPicBaseNat"><span class="hs-identifier hs-var">getPicBaseNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span>
</span><a name="line-37"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getPicBaseMaybeNat"><span class="hs-identifier hs-var">getPicBaseMaybeNat</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Instruction.html"><span class="hs-identifier">Instruction</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="PIC.html"><span class="hs-identifier">PIC</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Format.html"><span class="hs-identifier">Format</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="RegClass.html"><span class="hs-identifier">RegClass</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Reg.html"><span class="hs-identifier">Reg</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="TargetReg.html"><span class="hs-identifier">TargetReg</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-comment">-- Our intermediate code:</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="BlockId.html"><span class="hs-identifier">BlockId</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="PprCmm.html"><span class="hs-identifier">PprCmm</span></a><span>           </span><span class="hs-special">(</span><span> </span><a href="PprCmmExpr.html#pprExpr"><span class="hs-identifier hs-var">pprExpr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Cmm.html"><span class="hs-identifier">Cmm</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="CmmUtils.html"><span class="hs-identifier">CmmUtils</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="CmmSwitch.html"><span class="hs-identifier">CmmSwitch</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="CLabel.html"><span class="hs-identifier">CLabel</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Block.html"><span class="hs-identifier">Hoopl.Block</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Graph.html"><span class="hs-identifier">Hoopl.Graph</span></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- The rest:</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">OrdList</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">mapAndUnzipM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- Top-level of the instruction selector</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">-- | 'InstrBlock's are the insn sequences generated by the insn selectors.</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- They are really trees of insns to facilitate fast appending, where a</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- left-to-right traversal (pre-order?) yields the insns in the correct</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- order.</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-identifier">cmmTopCodeGen</span><span>
</span><a name="line-78"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a><span>
</span><a name="line-79"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><a name="cmmTopCodeGen"><a href="PPC.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier">cmmTopCodeGen</span></a></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a name="local-6989586621684791981"><a href="#local-6989586621684791981"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621684791982"><a href="#local-6989586621684791982"><span class="hs-identifier">lab</span></a></a><span> </span><a name="local-6989586621684791983"><a href="#local-6989586621684791983"><span class="hs-identifier">live</span></a></a><span> </span><a name="local-6989586621684791984"><a href="#local-6989586621684791984"><span class="hs-identifier">graph</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-82"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684791996"><a href="#local-6989586621684791996"><span class="hs-identifier">blocks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmUtils.html#toBlockListEntryFirst"><span class="hs-identifier hs-var">toBlockListEntryFirst</span></a><span> </span><a href="#local-6989586621684791984"><span class="hs-identifier hs-var">graph</span></a><span>
</span><a name="line-83"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684791997"><a href="#local-6989586621684791997"><span class="hs-identifier">nat_blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684791998"><a href="#local-6989586621684791998"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAndUnzipM</span><span> </span><a href="PPC.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier hs-var">basicBlockCodeGen</span></a><span> </span><a href="#local-6989586621684791996"><span class="hs-identifier hs-var">blocks</span></a><span>
</span><a name="line-84"></a><span>  </span><a name="local-6989586621684791999"><a href="#local-6989586621684791999"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792000"><a href="#local-6989586621684792000"><span class="hs-identifier">proc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a href="#local-6989586621684791981"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621684791982"><span class="hs-identifier hs-var">lab</span></a><span> </span><a href="#local-6989586621684791983"><span class="hs-identifier hs-var">live</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684791997"><span class="hs-identifier hs-var">nat_blocks</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>      </span><a name="local-6989586621684792001"><a href="#local-6989586621684792001"><span class="hs-identifier">tops</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792000"><span class="hs-identifier hs-var">proc</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684791998"><span class="hs-identifier hs-var">statics</span></a><span>
</span><a name="line-87"></a><span>      </span><a name="local-6989586621684792002"><a href="#local-6989586621684792002"><span class="hs-identifier">os</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684791999"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-88"></a><span>      </span><a name="local-6989586621684792003"><a href="#local-6989586621684792003"><span class="hs-identifier">arch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684791999"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-89"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792003"><span class="hs-identifier hs-var">arch</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-identifier hs-var">ArchPPC</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792002"><span class="hs-identifier hs-var">os</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSAIX</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684792001"><span class="hs-identifier hs-var">tops</span></a><span>
</span><a name="line-91"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-92"></a><span>      </span><a name="local-6989586621684792004"><a href="#local-6989586621684792004"><span class="hs-identifier">picBaseMb</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getPicBaseMaybeNat"><span class="hs-identifier hs-var">getPicBaseMaybeNat</span></a><span>
</span><a name="line-93"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792004"><span class="hs-identifier hs-var">picBaseMb</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-94"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792005"><a href="#local-6989586621684792005"><span class="hs-identifier">picBase</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PIC.html#initializePicBase_ppc"><span class="hs-identifier hs-var">initializePicBase_ppc</span></a><span> </span><a href="#local-6989586621684792003"><span class="hs-identifier hs-var">arch</span></a><span> </span><a href="#local-6989586621684792002"><span class="hs-identifier hs-var">os</span></a><span> </span><a href="#local-6989586621684792005"><span class="hs-identifier hs-var">picBase</span></a><span> </span><a href="#local-6989586621684792001"><span class="hs-identifier hs-var">tops</span></a><span>
</span><a name="line-95"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684792001"><span class="hs-identifier hs-var">tops</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier hs-var">ELF_V1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684791985"><span class="hs-identifier hs-var">fixup_entry</span></a><span> </span><a href="#local-6989586621684792001"><span class="hs-identifier hs-var">tops</span></a><span>
</span><a name="line-97"></a><span>                      </span><span class="hs-comment">-- generating function descriptor is handled in</span><span>
</span><a name="line-98"></a><span>                      </span><span class="hs-comment">-- pretty printer</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier hs-var">ELF_V2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684791985"><span class="hs-identifier hs-var">fixup_entry</span></a><span> </span><a href="#local-6989586621684792001"><span class="hs-identifier hs-var">tops</span></a><span>
</span><a name="line-100"></a><span>                      </span><span class="hs-comment">-- generating function prologue is handled in</span><span>
</span><a name="line-101"></a><span>                      </span><span class="hs-comment">-- pretty printer</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.cmmTopCodeGen: unknown arch&quot;</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-104"></a><span>      </span><a name="local-6989586621684791985"><a href="#local-6989586621684791985"><span class="hs-identifier">fixup_entry</span></a></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a name="local-6989586621684791986"><a href="#local-6989586621684791986"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621684791987"><a href="#local-6989586621684791987"><span class="hs-identifier">lab</span></a></a><span> </span><a name="local-6989586621684791988"><a href="#local-6989586621684791988"><span class="hs-identifier">live</span></a></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684791989"><a href="#local-6989586621684791989"><span class="hs-identifier">entry</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684791990"><a href="#local-6989586621684791990"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684791991"><a href="#local-6989586621684791991"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-106"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a name="local-6989586621684791992"><a href="#local-6989586621684791992"><span class="hs-identifier">bID</span></a></a><span> </span><a name="local-6989586621684791993"><a href="#local-6989586621684791993"><span class="hs-identifier">insns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684791989"><span class="hs-identifier hs-var">entry</span></a><span>
</span><a name="line-107"></a><span>        </span><a name="local-6989586621684791994"><a href="#local-6989586621684791994"><span class="hs-identifier">bID'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684791987"><span class="hs-identifier hs-var">lab</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><a href="BlockId.html#blockLbl"><span class="hs-identifier hs-var">blockLbl</span></a><span> </span><a href="#local-6989586621684791992"><span class="hs-identifier hs-var">bID</span></a><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="BlockId.html#newBlockId"><span class="hs-identifier hs-var">newBlockId</span></a><span>
</span><a name="line-109"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684791992"><span class="hs-identifier hs-var">bID</span></a><span>
</span><a name="line-110"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684791995"><a href="#local-6989586621684791995"><span class="hs-identifier">b'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621684791994"><span class="hs-identifier hs-var">bID'</span></a><span> </span><a href="#local-6989586621684791993"><span class="hs-identifier hs-var">insns</span></a><span>
</span><a name="line-111"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a href="#local-6989586621684791986"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621684791987"><span class="hs-identifier hs-var">lab</span></a><span> </span><a href="#local-6989586621684791988"><span class="hs-identifier hs-var">live</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684791995"><span class="hs-identifier hs-var">b'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684791990"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684791991"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>      </span><span class="hs-identifier">fixup_entry</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;cmmTopCodegen: Broken CmmProc&quot;</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-identifier">cmmTopCodeGen</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a name="local-6989586621684792006"><a href="#local-6989586621684792006"><span class="hs-identifier">sec</span></a></a><span> </span><a name="local-6989586621684792007"><a href="#local-6989586621684792007"><span class="hs-identifier">dat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-115"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a href="#local-6989586621684792006"><span class="hs-identifier hs-var">sec</span></a><span> </span><a href="#local-6989586621684792007"><span class="hs-identifier hs-var">dat</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- no translation, we just use CmmStatic</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-identifier">basicBlockCodeGen</span><span>
</span><a name="line-118"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Hoopl.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a><span> </span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="Hoopl.Block.html#C"><span class="hs-identifier hs-type">C</span></a><span> </span><a href="Hoopl.Block.html#C"><span class="hs-identifier hs-type">C</span></a><span>
</span><a name="line-119"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-120"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><a name="basicBlockCodeGen"><a href="PPC.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier">basicBlockCodeGen</span></a></a><span> </span><a name="local-6989586621684792008"><a href="#local-6989586621684792008"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-123"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684792009"><a href="#local-6989586621684792009"><span class="hs-identifier">nodes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792010"><a href="#local-6989586621684792010"><span class="hs-identifier">tail</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a><span> </span><a href="#local-6989586621684792008"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-124"></a><span>      </span><a name="local-6989586621684792011"><a href="#local-6989586621684792011"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a><span> </span><a href="#local-6989586621684792008"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-125"></a><span>      </span><a name="local-6989586621684792012"><a href="#local-6989586621684792012"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a><span> </span><a href="#local-6989586621684792009"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-126"></a><span>  </span><a name="local-6989586621684792013"><a href="#local-6989586621684792013"><span class="hs-identifier">mid_instrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#stmtsToInstrs"><span class="hs-identifier hs-var">stmtsToInstrs</span></a><span> </span><a href="#local-6989586621684792012"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-127"></a><span>  </span><a name="local-6989586621684792014"><a href="#local-6989586621684792014"><span class="hs-identifier">tail_instrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621684792010"><span class="hs-identifier hs-var">tail</span></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792015"><a href="#local-6989586621684792015"><span class="hs-identifier">instrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792013"><span class="hs-identifier hs-var">mid_instrs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792014"><span class="hs-identifier hs-var">tail_instrs</span></a><span>
</span><a name="line-129"></a><span>  </span><span class="hs-comment">-- code generation may introduce new basic block boundaries, which</span><span>
</span><a name="line-130"></a><span>  </span><span class="hs-comment">-- are indicated by the NEWBLOCK instruction.  We must split up the</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-comment">-- instruction stream into basic blocks again.  Also, we extract</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-comment">-- LDATAs here too.</span><span>
</span><a name="line-133"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-134"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792016"><a href="#local-6989586621684792016"><span class="hs-identifier">top</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792017"><a href="#local-6989586621684792017"><span class="hs-identifier">other_blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792018"><a href="#local-6989586621684792018"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldrOL</span><span> </span><a href="#local-6989586621684792019"><span class="hs-identifier hs-var">mkBlocks</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792015"><span class="hs-identifier hs-var">instrs</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>        </span><a name="local-6989586621684792019"><a href="#local-6989586621684792019"><span class="hs-identifier">mkBlocks</span></a></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a name="local-6989586621684792020"><a href="#local-6989586621684792020"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684792021"><a href="#local-6989586621684792021"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792022"><a href="#local-6989586621684792022"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792023"><a href="#local-6989586621684792023"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621684792020"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684792021"><span class="hs-identifier hs-var">instrs</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684792022"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792023"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>        </span><span class="hs-identifier">mkBlocks</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#LDATA"><span class="hs-identifier hs-var">LDATA</span></a><span> </span><a name="local-6989586621684792024"><a href="#local-6989586621684792024"><span class="hs-identifier">sec</span></a></a><span> </span><a name="local-6989586621684792025"><a href="#local-6989586621684792025"><span class="hs-identifier">dat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684792026"><a href="#local-6989586621684792026"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792027"><a href="#local-6989586621684792027"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792028"><a href="#local-6989586621684792028"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792026"><span class="hs-identifier hs-var">instrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792027"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a href="#local-6989586621684792024"><span class="hs-identifier hs-var">sec</span></a><span> </span><a href="#local-6989586621684792025"><span class="hs-identifier hs-var">dat</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684792028"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>        </span><span class="hs-identifier">mkBlocks</span><span> </span><a name="local-6989586621684792029"><a href="#local-6989586621684792029"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684792030"><a href="#local-6989586621684792030"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792031"><a href="#local-6989586621684792031"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792032"><a href="#local-6989586621684792032"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792029"><span class="hs-identifier hs-var">instr</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684792030"><span class="hs-identifier hs-var">instrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792031"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792032"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621684792011"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684792016"><span class="hs-identifier hs-var">top</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684792017"><span class="hs-identifier hs-var">other_blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792018"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-identifier">stmtsToInstrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="#local-6989586621684791979"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621684791980"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-145"></a><a name="stmtsToInstrs"><a href="PPC.CodeGen.html#stmtsToInstrs"><span class="hs-identifier">stmtsToInstrs</span></a></a><span> </span><a name="local-6989586621684792033"><a href="#local-6989586621684792033"><span class="hs-identifier">stmts</span></a></a><span>
</span><a name="line-146"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792034"><a href="#local-6989586621684792034"><span class="hs-identifier">instrss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="PPC.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621684792033"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-147"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621684792034"><span class="hs-identifier hs-var">instrss</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-identifier">stmtToInstrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="#local-6989586621684791977"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621684791978"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-150"></a><a name="stmtToInstrs"><a href="PPC.CodeGen.html#stmtToInstrs"><span class="hs-identifier">stmtToInstrs</span></a></a><span> </span><a name="local-6989586621684792035"><a href="#local-6989586621684792035"><span class="hs-identifier">stmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-151"></a><span>  </span><a name="local-6989586621684792036"><a href="#local-6989586621684792036"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-152"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792035"><span class="hs-identifier hs-var">stmt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-153"></a><span>    </span><a href="CmmNode.html#CmmComment"><span class="hs-identifier hs-var">CmmComment</span></a><span> </span><a name="local-6989586621684792037"><a href="#local-6989586621684792037"><span class="hs-identifier">s</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#COMMENT"><span class="hs-identifier hs-var">COMMENT</span></a><span> </span><a href="#local-6989586621684792037"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>    </span><a href="CmmNode.html#CmmTick"><span class="hs-identifier hs-var">CmmTick</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-155"></a><span>    </span><a href="CmmNode.html#CmmUnwind"><span class="hs-identifier hs-var">CmmUnwind</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>    </span><a href="CmmNode.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a><span> </span><a name="local-6989586621684792038"><a href="#local-6989586621684792038"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684792039"><a href="#local-6989586621684792039"><span class="hs-identifier">src</span></a></a><span>
</span><a name="line-158"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684792040"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#assignReg_FltCode"><span class="hs-identifier hs-var">assignReg_FltCode</span></a><span> </span><a href="#local-6989586621684792041"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792038"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792039"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-159"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792036"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-160"></a><span>        </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684792040"><span class="hs-identifier hs-var">ty</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#assignReg_I64Code"><span class="hs-identifier hs-var">assignReg_I64Code</span></a><span>      </span><a href="#local-6989586621684792038"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792039"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-161"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#assignReg_IntCode"><span class="hs-identifier hs-var">assignReg_IntCode</span></a><span> </span><a href="#local-6989586621684792041"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792038"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792039"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-162"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792040"><a href="#local-6989586621684792040"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621684792036"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792038"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-163"></a><span>              </span><a name="local-6989586621684792041"><a href="#local-6989586621684792041"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792040"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>    </span><a href="CmmNode.html#CmmStore"><span class="hs-identifier hs-var">CmmStore</span></a><span> </span><a name="local-6989586621684792042"><a href="#local-6989586621684792042"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792043"><a href="#local-6989586621684792043"><span class="hs-identifier">src</span></a></a><span>
</span><a name="line-166"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684792044"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#assignMem_FltCode"><span class="hs-identifier hs-var">assignMem_FltCode</span></a><span> </span><a href="#local-6989586621684792045"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792042"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684792043"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-167"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792036"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-168"></a><span>        </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684792044"><span class="hs-identifier hs-var">ty</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#assignMem_I64Code"><span class="hs-identifier hs-var">assignMem_I64Code</span></a><span>      </span><a href="#local-6989586621684792042"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684792043"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-169"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var">assignMem_IntCode</span></a><span> </span><a href="#local-6989586621684792045"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792042"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684792043"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-170"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792044"><a href="#local-6989586621684792044"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684792036"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792043"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-171"></a><span>              </span><a name="local-6989586621684792045"><a href="#local-6989586621684792045"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792044"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span>    </span><a href="CmmNode.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-var">CmmUnsafeForeignCall</span></a><span> </span><a name="local-6989586621684792046"><a href="#local-6989586621684792046"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684792047"><a href="#local-6989586621684792047"><span class="hs-identifier">result_regs</span></a></a><span> </span><a name="local-6989586621684792048"><a href="#local-6989586621684792048"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-174"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a><span> </span><a href="#local-6989586621684792046"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684792047"><span class="hs-identifier hs-var">result_regs</span></a><span> </span><a href="#local-6989586621684792048"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>    </span><a href="CmmNode.html#CmmBranch"><span class="hs-identifier hs-var">CmmBranch</span></a><span> </span><a name="local-6989586621684792049"><a href="#local-6989586621684792049"><span class="hs-identifier">id</span></a></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621684792049"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-177"></a><span>    </span><a href="CmmNode.html#CmmCondBranch"><span class="hs-identifier hs-var">CmmCondBranch</span></a><span> </span><a name="local-6989586621684792050"><a href="#local-6989586621684792050"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621684792051"><a href="#local-6989586621684792051"><span class="hs-identifier">true</span></a></a><span> </span><a name="local-6989586621684792052"><a href="#local-6989586621684792052"><span class="hs-identifier">false</span></a></a><span> </span><a name="local-6989586621684792053"><a href="#local-6989586621684792053"><span class="hs-identifier">prediction</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-178"></a><span>      </span><a name="local-6989586621684792054"><a href="#local-6989586621684792054"><span class="hs-identifier">b1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#genCondJump"><span class="hs-identifier hs-var">genCondJump</span></a><span> </span><a href="#local-6989586621684792051"><span class="hs-identifier hs-var">true</span></a><span> </span><a href="#local-6989586621684792050"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621684792053"><span class="hs-identifier hs-var">prediction</span></a><span>
</span><a name="line-179"></a><span>      </span><a name="local-6989586621684792055"><a href="#local-6989586621684792055"><span class="hs-identifier">b2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621684792052"><span class="hs-identifier hs-var">false</span></a><span>
</span><a name="line-180"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792054"><span class="hs-identifier hs-var">b1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792055"><span class="hs-identifier hs-var">b2</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>    </span><a href="CmmNode.html#CmmSwitch"><span class="hs-identifier hs-var">CmmSwitch</span></a><span> </span><a name="local-6989586621684792056"><a href="#local-6989586621684792056"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621684792057"><a href="#local-6989586621684792057"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792058"><a href="#local-6989586621684792058"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-182"></a><span>                            </span><a href="PPC.CodeGen.html#genSwitch"><span class="hs-identifier hs-var">genSwitch</span></a><span> </span><a href="#local-6989586621684792058"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792056"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621684792057"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-183"></a><span>    </span><a href="CmmNode.html#CmmCall"><span class="hs-identifier hs-var">CmmCall</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cml_target</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684792059"><a href="#local-6989586621684792059"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#genJump"><span class="hs-identifier hs-var">genJump</span></a><span> </span><a href="#local-6989586621684792059"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-184"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-185"></a><span>      </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;stmtToInstrs: statement should have been cps'd away&quot;</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- | 'InstrBlock's are the insn sequences generated by the insn selectors.</span><span>
</span><a name="line-190"></a><span class="hs-comment">--      They are really trees of insns to facilitate fast appending, where a</span><span>
</span><a name="line-191"></a><span class="hs-comment">--      left-to-right traversal yields the insns in the correct order.</span><span>
</span><a name="line-192"></a><span class="hs-comment">--</span><span>
</span><a name="line-193"></a><span class="hs-keyword">type</span><span> </span><a name="InstrBlock"><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier">InstrBlock</span></a></a><span>
</span><a name="line-194"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- | Register's passed up the tree.  If the stix code forces the register</span><span>
</span><a name="line-198"></a><span class="hs-comment">--      to live in a pre-decided machine register, it comes out as @Fixed@;</span><span>
</span><a name="line-199"></a><span class="hs-comment">--      otherwise, it comes out as @Any@, and the parent can decide which</span><span>
</span><a name="line-200"></a><span class="hs-comment">--      register to put it in.</span><span>
</span><a name="line-201"></a><span class="hs-comment">--</span><span>
</span><a name="line-202"></a><span class="hs-keyword">data</span><span> </span><a name="Register"><a href="PPC.CodeGen.html#Register"><span class="hs-identifier">Register</span></a></a><span>
</span><a name="line-203"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="Fixed"><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier">Fixed</span></a></a><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-204"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="Any"><a href="PPC.CodeGen.html#Any"><span class="hs-identifier">Any</span></a></a><span>   </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-identifier">swizzleRegisterRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-208"></a><a name="swizzleRegisterRep"><a href="PPC.CodeGen.html#swizzleRegisterRep"><span class="hs-identifier">swizzleRegisterRep</span></a></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792060"><a href="#local-6989586621684792060"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684792061"><a href="#local-6989586621684792061"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684792062"><a href="#local-6989586621684792062"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="#local-6989586621684792062"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792060"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792061"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-209"></a><span class="hs-identifier">swizzleRegisterRep</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792063"><a href="#local-6989586621684792063"><span class="hs-identifier">codefn</span></a></a><span class="hs-special">)</span><span>     </span><a name="local-6989586621684792064"><a href="#local-6989586621684792064"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span>   </span><a href="#local-6989586621684792064"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792063"><span class="hs-identifier hs-var">codefn</span></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- | Grab the Reg for a CmmReg</span><span>
</span><a name="line-213"></a><span class="hs-identifier">getRegisterReg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><a name="getRegisterReg"><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier">getRegisterReg</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621684792065"><a href="#local-6989586621684792065"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621684792066"><a href="#local-6989586621684792066"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegVirtual"><span class="hs-identifier hs-var">RegVirtual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Regs.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a><span> </span><a href="#local-6989586621684792065"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792066"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-identifier">getRegisterReg</span><span> </span><a name="local-6989586621684792067"><a href="#local-6989586621684792067"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621684792068"><a href="#local-6989586621684792068"><span class="hs-identifier">mid</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="CodeGen.Platform.html#globalRegMaybe"><span class="hs-identifier hs-var">globalRegMaybe</span></a><span> </span><a href="#local-6989586621684792067"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792068"><span class="hs-identifier hs-var">mid</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-220"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792069"><a href="#local-6989586621684792069"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><a href="#local-6989586621684792069"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-221"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;getRegisterReg-memory&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="#local-6989586621684792068"><span class="hs-identifier hs-var">mid</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>        </span><span class="hs-comment">-- By this stage, the only MagicIds remaining should be the</span><span>
</span><a name="line-223"></a><span>        </span><span class="hs-comment">-- ones which map to a real machine register on this</span><span>
</span><a name="line-224"></a><span>        </span><span class="hs-comment">-- platform.  Hence ...</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span class="hs-comment">-- | Convert a BlockId to some CmmStatic data</span><span>
</span><a name="line-227"></a><span class="hs-identifier">jumpTableEntry</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#CmmStatic"><span class="hs-identifier hs-type">CmmStatic</span></a><span>
</span><a name="line-228"></a><a name="jumpTableEntry"><a href="PPC.CodeGen.html#jumpTableEntry"><span class="hs-identifier">jumpTableEntry</span></a></a><span> </span><a name="local-6989586621684792070"><a href="#local-6989586621684792070"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684792070"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span class="hs-identifier">jumpTableEntry</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792071"><a href="#local-6989586621684792071"><span class="hs-identifier">blockid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a href="#local-6989586621684792072"><span class="hs-identifier hs-var">blockLabel</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792072"><a href="#local-6989586621684792072"><span class="hs-identifier">blockLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BlockId.html#blockLbl"><span class="hs-identifier hs-var">blockLbl</span></a><span> </span><a href="#local-6989586621684792071"><span class="hs-identifier hs-var">blockid</span></a><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- General things for putting together code sequences</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-comment">-- Expand CmmRegOff.  ToDo: should we do it this way around, or convert</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- CmmExprs into CmmRegOff?</span><span>
</span><a name="line-239"></a><span class="hs-identifier">mangleIndexTree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-240"></a><a name="mangleIndexTree"><a href="PPC.CodeGen.html#mangleIndexTree"><span class="hs-identifier">mangleIndexTree</span></a></a><span> </span><a name="local-6989586621684792073"><a href="#local-6989586621684792073"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><a name="local-6989586621684792074"><a href="#local-6989586621684792074"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684792075"><a href="#local-6989586621684792075"><span class="hs-identifier">off</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><a href="#local-6989586621684792076"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><a href="#local-6989586621684792074"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684792075"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792076"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-242"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792076"><a href="#local-6989586621684792076"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621684792073"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792074"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-identifier">mangleIndexTree</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-245"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.mangleIndexTree: no match&quot;</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-248"></a><span class="hs-comment">--  Code gen for 64-bit arithmetic on 32-bit platforms</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-comment">{-
Simple support for generating 64-bit code (ie, 64 bit values and 64
bit assignments) on 32-bit platforms.  Unlike the main code generator
we merely shoot for generating working code as simply as possible, and
pay little attention to code quality.  Specifically, there is no
attempt to deal cleverly with the fixed-vs-floating register
distinction; all values are generated into (pairs of) floating
registers, even if this would mean some redundant reg-reg moves as a
result.  Only one of the VRegUniques is returned, since it will be
of the VRegUniqueLo form, and the upper-half VReg can be determined
by applying getHiVRegFromLo to it.
-}</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-keyword">data</span><span> </span><a name="ChildCode64"><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier">ChildCode64</span></a></a><span>        </span><span class="hs-comment">-- a.k.a &quot;Register64&quot;</span><span>
</span><a name="line-264"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a name="ChildCode64"><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier">ChildCode64</span></a></a><span>
</span><a name="line-265"></a><span>           </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>   </span><span class="hs-comment">-- code</span><span>
</span><a name="line-266"></a><span>           </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>          </span><span class="hs-comment">-- the lower 32-bit temporary which contains the</span><span>
</span><a name="line-267"></a><span>                        </span><span class="hs-comment">-- result; use getHiVRegFromLo to find the other</span><span>
</span><a name="line-268"></a><span>                        </span><span class="hs-comment">-- VRegUnique.  Rules of this simplified insn</span><span>
</span><a name="line-269"></a><span>                        </span><span class="hs-comment">-- selection game are therefore that the returned</span><span>
</span><a name="line-270"></a><span>                        </span><span class="hs-comment">-- Reg may be modified</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-comment">-- | Compute an expression into a register, but</span><span>
</span><a name="line-274"></a><span class="hs-comment">--      we don't mind which one it is.</span><span>
</span><a name="line-275"></a><span class="hs-identifier">getSomeReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">,</span><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><a name="getSomeReg"><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier">getSomeReg</span></a></a><span> </span><a name="local-6989586621684792077"><a href="#local-6989586621684792077"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-277"></a><span>  </span><a name="local-6989586621684792078"><a href="#local-6989586621684792078"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684792077"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-278"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792078"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-279"></a><span>    </span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a name="local-6989586621684792079"><a href="#local-6989586621684792079"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684792080"><a href="#local-6989586621684792080"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-280"></a><span>        </span><a name="local-6989586621684792081"><a href="#local-6989586621684792081"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792079"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-281"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792081"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792080"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684792081"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>    </span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792082"><a href="#local-6989586621684792082"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684792083"><a href="#local-6989586621684792083"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792082"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792083"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-identifier">getI64Amodes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span class="hs-special">,</span><span> </span><a href="PPC.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span class="hs-special">,</span><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><a name="getI64Amodes"><a href="PPC.CodeGen.html#getI64Amodes"><span class="hs-identifier">getI64Amodes</span></a></a><span> </span><a name="local-6989586621684792084"><a href="#local-6989586621684792084"><span class="hs-identifier">addrTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-287"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792085"><a href="#local-6989586621684792085"><span class="hs-identifier">hi_addr</span></a></a><span> </span><a name="local-6989586621684792086"><a href="#local-6989586621684792086"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792084"><span class="hs-identifier hs-var">addrTree</span></a><span>
</span><a name="line-288"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="PPC.Regs.html#addrOffset"><span class="hs-identifier hs-var">addrOffset</span></a><span> </span><a href="#local-6989586621684792085"><span class="hs-identifier hs-var">hi_addr</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-289"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792087"><a href="#local-6989586621684792087"><span class="hs-identifier">lo_addr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792085"><span class="hs-identifier hs-var">hi_addr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792087"><span class="hs-identifier hs-var">lo_addr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792086"><span class="hs-identifier hs-var">addr_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684792088"><a href="#local-6989586621684792088"><span class="hs-identifier">hi_ptr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792089"><a href="#local-6989586621684792089"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792084"><span class="hs-identifier hs-var">addrTree</span></a><span>
</span><a name="line-291"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792088"><span class="hs-identifier hs-var">hi_ptr</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-292"></a><span>                                   </span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792088"><span class="hs-identifier hs-var">hi_ptr</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">4</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-293"></a><span>                                   </span><a href="#local-6989586621684792089"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-identifier">assignMem_I64Code</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-297"></a><a name="assignMem_I64Code"><a href="PPC.CodeGen.html#assignMem_I64Code"><span class="hs-identifier">assignMem_I64Code</span></a></a><span> </span><a name="local-6989586621684792090"><a href="#local-6989586621684792090"><span class="hs-identifier">addrTree</span></a></a><span> </span><a name="local-6989586621684792091"><a href="#local-6989586621684792091"><span class="hs-identifier">valueTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-298"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792092"><a href="#local-6989586621684792092"><span class="hs-identifier">hi_addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792093"><a href="#local-6989586621684792093"><span class="hs-identifier">lo_addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792094"><a href="#local-6989586621684792094"><span class="hs-identifier">addr_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getI64Amodes"><span class="hs-identifier hs-var">getI64Amodes</span></a><span> </span><a href="#local-6989586621684792090"><span class="hs-identifier hs-var">addrTree</span></a><span>
</span><a name="line-299"></a><span>        </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792095"><a href="#local-6989586621684792095"><span class="hs-identifier">vcode</span></a></a><span> </span><a name="local-6989586621684792096"><a href="#local-6989586621684792096"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792091"><span class="hs-identifier hs-var">valueTree</span></a><span>
</span><a name="line-300"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-301"></a><span>                </span><a name="local-6989586621684792097"><a href="#local-6989586621684792097"><span class="hs-identifier">rhi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792096"><span class="hs-identifier hs-var">rlo</span></a><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span>                </span><span class="hs-comment">-- Big-endian store</span><span>
</span><a name="line-304"></a><span>                </span><a name="local-6989586621684792098"><a href="#local-6989586621684792098"><span class="hs-identifier">mov_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792097"><span class="hs-identifier hs-var">rhi</span></a><span> </span><a href="#local-6989586621684792092"><span class="hs-identifier hs-var">hi_addr</span></a><span>
</span><a name="line-305"></a><span>                </span><a name="local-6989586621684792099"><a href="#local-6989586621684792099"><span class="hs-identifier">mov_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792096"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792093"><span class="hs-identifier hs-var">lo_addr</span></a><span>
</span><a name="line-306"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792095"><span class="hs-identifier hs-var">vcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792094"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792099"><span class="hs-identifier hs-var">mov_lo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792098"><span class="hs-identifier hs-var">mov_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-identifier">assignReg_I64Code</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-310"></a><a name="assignReg_I64Code"><a href="PPC.CodeGen.html#assignReg_I64Code"><span class="hs-identifier">assignReg_I64Code</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621684792100"><a href="#local-6989586621684792100"><span class="hs-identifier">u_dst</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684792101"><a href="#local-6989586621684792101"><span class="hs-identifier">valueTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-311"></a><span>   </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792102"><a href="#local-6989586621684792102"><span class="hs-identifier">vcode</span></a></a><span> </span><a name="local-6989586621684792103"><a href="#local-6989586621684792103"><span class="hs-identifier">r_src_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792101"><span class="hs-identifier hs-var">valueTree</span></a><span>
</span><a name="line-312"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-313"></a><span>         </span><a name="local-6989586621684792104"><a href="#local-6989586621684792104"><span class="hs-identifier">r_dst_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegVirtual"><span class="hs-identifier hs-var">RegVirtual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Regs.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a><span> </span><a href="#local-6989586621684792100"><span class="hs-identifier hs-var">u_dst</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-314"></a><span>         </span><a name="local-6989586621684792105"><a href="#local-6989586621684792105"><span class="hs-identifier">r_dst_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792104"><span class="hs-identifier hs-var">r_dst_lo</span></a><span>
</span><a name="line-315"></a><span>         </span><a name="local-6989586621684792106"><a href="#local-6989586621684792106"><span class="hs-identifier">r_src_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792103"><span class="hs-identifier hs-var">r_src_lo</span></a><span>
</span><a name="line-316"></a><span>         </span><a name="local-6989586621684792107"><a href="#local-6989586621684792107"><span class="hs-identifier">mov_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792104"><span class="hs-identifier hs-var">r_dst_lo</span></a><span> </span><a href="#local-6989586621684792103"><span class="hs-identifier hs-var">r_src_lo</span></a><span>
</span><a name="line-317"></a><span>         </span><a name="local-6989586621684792108"><a href="#local-6989586621684792108"><span class="hs-identifier">mov_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792105"><span class="hs-identifier hs-var">r_dst_hi</span></a><span> </span><a href="#local-6989586621684792106"><span class="hs-identifier hs-var">r_src_hi</span></a><span>
</span><a name="line-318"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-319"></a><span>        </span><a href="#local-6989586621684792102"><span class="hs-identifier hs-var">vcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792107"><span class="hs-identifier hs-var">mov_lo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792108"><span class="hs-identifier hs-var">mov_hi</span></a><span>
</span><a name="line-320"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-identifier">assignReg_I64Code</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-323"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;assignReg_I64Code(powerpc): invalid lvalue&quot;</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-identifier">iselExpr64</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-type">ChildCode64</span></a><span>
</span><a name="line-327"></a><a name="iselExpr64"><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier">iselExpr64</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792109"><a href="#local-6989586621684792109"><span class="hs-identifier">addrTree</span></a></a><span> </span><a name="local-6989586621684792110"><a href="#local-6989586621684792110"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684792110"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-328"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792111"><a href="#local-6989586621684792111"><span class="hs-identifier">hi_addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792112"><a href="#local-6989586621684792112"><span class="hs-identifier">lo_addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792113"><a href="#local-6989586621684792113"><span class="hs-identifier">addr_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getI64Amodes"><span class="hs-identifier hs-var">getI64Amodes</span></a><span> </span><a href="#local-6989586621684792109"><span class="hs-identifier hs-var">addrTree</span></a><span>
</span><a name="line-329"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792114"><a href="#local-6989586621684792114"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792115"><a href="#local-6989586621684792115"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-330"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792116"><a href="#local-6989586621684792116"><span class="hs-identifier">mov_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792115"><span class="hs-identifier hs-var">rhi</span></a><span> </span><a href="#local-6989586621684792111"><span class="hs-identifier hs-var">hi_addr</span></a><span>
</span><a name="line-331"></a><span>        </span><a name="local-6989586621684792117"><a href="#local-6989586621684792117"><span class="hs-identifier">mov_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792114"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792112"><span class="hs-identifier hs-var">lo_addr</span></a><span>
</span><a name="line-332"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792113"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792117"><span class="hs-identifier hs-var">mov_lo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792116"><span class="hs-identifier hs-var">mov_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-333"></a><span>                         </span><a href="#local-6989586621684792114"><span class="hs-identifier hs-var">rlo</span></a><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621684792118"><a href="#local-6989586621684792118"><span class="hs-identifier">vu</span></a></a><span> </span><a name="local-6989586621684792119"><a href="#local-6989586621684792119"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684792119"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-336"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><span class="hs-identifier hs-var">nilOL</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegVirtual"><span class="hs-identifier hs-var">RegVirtual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Regs.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a><span> </span><a href="#local-6989586621684792118"><span class="hs-identifier hs-var">vu</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792120"><a href="#local-6989586621684792120"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-339"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684792121"><a href="#local-6989586621684792121"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792122"><a href="#local-6989586621684792122"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-340"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-341"></a><span>        </span><a name="local-6989586621684792123"><a href="#local-6989586621684792123"><span class="hs-identifier">half0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684792120"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">)</span><span>
</span><a name="line-342"></a><span>        </span><a name="local-6989586621684792124"><a href="#local-6989586621684792124"><span class="hs-identifier">half1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792120"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">)</span><span>
</span><a name="line-343"></a><span>        </span><a name="local-6989586621684792125"><a href="#local-6989586621684792125"><span class="hs-identifier">half2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792120"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>        </span><a name="local-6989586621684792126"><a href="#local-6989586621684792126"><span class="hs-identifier">half3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792120"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">48</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span>        </span><a name="local-6989586621684792127"><a href="#local-6989586621684792127"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-347"></a><span>                </span><a href="PPC.Instr.html#LIS"><span class="hs-identifier hs-var">LIS</span></a><span> </span><a href="#local-6989586621684792121"><span class="hs-identifier hs-var">rlo</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792124"><span class="hs-identifier hs-var">half1</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-348"></a><span>                </span><a href="PPC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><a href="#local-6989586621684792121"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792121"><span class="hs-identifier hs-var">rlo</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792123"><span class="hs-identifier hs-var">half0</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-349"></a><span>                </span><a href="PPC.Instr.html#LIS"><span class="hs-identifier hs-var">LIS</span></a><span> </span><a href="#local-6989586621684792122"><span class="hs-identifier hs-var">rhi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792126"><span class="hs-identifier hs-var">half3</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-350"></a><span>                </span><a href="PPC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><a href="#local-6989586621684792122"><span class="hs-identifier hs-var">rhi</span></a><span> </span><a href="#local-6989586621684792122"><span class="hs-identifier hs-var">rhi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792125"><span class="hs-identifier hs-var">half2</span></a><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-352"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a href="#local-6989586621684792127"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684792121"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792128"><a href="#local-6989586621684792128"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792129"><a href="#local-6989586621684792129"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-355"></a><span>   </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792130"><a href="#local-6989586621684792130"><span class="hs-identifier">code1</span></a></a><span> </span><a name="local-6989586621684792131"><a href="#local-6989586621684792131"><span class="hs-identifier">r1lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792128"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-356"></a><span>   </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792132"><a href="#local-6989586621684792132"><span class="hs-identifier">code2</span></a></a><span> </span><a name="local-6989586621684792133"><a href="#local-6989586621684792133"><span class="hs-identifier">r2lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792129"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-357"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621684792134"><a href="#local-6989586621684792134"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792135"><a href="#local-6989586621684792135"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-358"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-359"></a><span>        </span><a name="local-6989586621684792136"><a href="#local-6989586621684792136"><span class="hs-identifier">r1hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792131"><span class="hs-identifier hs-var">r1lo</span></a><span>
</span><a name="line-360"></a><span>        </span><a name="local-6989586621684792137"><a href="#local-6989586621684792137"><span class="hs-identifier">r2hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792133"><span class="hs-identifier hs-var">r2lo</span></a><span>
</span><a name="line-361"></a><span>        </span><a name="local-6989586621684792138"><a href="#local-6989586621684792138"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621684792130"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-362"></a><span>                </span><a href="#local-6989586621684792132"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-363"></a><span>                </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#ADDC"><span class="hs-identifier hs-var">ADDC</span></a><span> </span><a href="#local-6989586621684792134"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792131"><span class="hs-identifier hs-var">r1lo</span></a><span> </span><a href="#local-6989586621684792133"><span class="hs-identifier hs-var">r2lo</span></a><span class="hs-special">,</span><span>
</span><a name="line-364"></a><span>                       </span><a href="PPC.Instr.html#ADDE"><span class="hs-identifier hs-var">ADDE</span></a><span> </span><a href="#local-6989586621684792135"><span class="hs-identifier hs-var">rhi</span></a><span> </span><a href="#local-6989586621684792136"><span class="hs-identifier hs-var">r1hi</span></a><span> </span><a href="#local-6989586621684792137"><span class="hs-identifier hs-var">r2hi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-365"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a href="#local-6989586621684792138"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684792134"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792139"><a href="#local-6989586621684792139"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792140"><a href="#local-6989586621684792140"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-368"></a><span>   </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792141"><a href="#local-6989586621684792141"><span class="hs-identifier">code1</span></a></a><span> </span><a name="local-6989586621684792142"><a href="#local-6989586621684792142"><span class="hs-identifier">r1lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792139"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-369"></a><span>   </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792143"><a href="#local-6989586621684792143"><span class="hs-identifier">code2</span></a></a><span> </span><a name="local-6989586621684792144"><a href="#local-6989586621684792144"><span class="hs-identifier">r2lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792140"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-370"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621684792145"><a href="#local-6989586621684792145"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792146"><a href="#local-6989586621684792146"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-371"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-372"></a><span>        </span><a name="local-6989586621684792147"><a href="#local-6989586621684792147"><span class="hs-identifier">r1hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792142"><span class="hs-identifier hs-var">r1lo</span></a><span>
</span><a name="line-373"></a><span>        </span><a name="local-6989586621684792148"><a href="#local-6989586621684792148"><span class="hs-identifier">r2hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792144"><span class="hs-identifier hs-var">r2lo</span></a><span>
</span><a name="line-374"></a><span>        </span><a name="local-6989586621684792149"><a href="#local-6989586621684792149"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621684792141"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-375"></a><span>                </span><a href="#local-6989586621684792143"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-376"></a><span>                </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#SUBFC"><span class="hs-identifier hs-var">SUBFC</span></a><span> </span><a href="#local-6989586621684792145"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792144"><span class="hs-identifier hs-var">r2lo</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792142"><span class="hs-identifier hs-var">r1lo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-377"></a><span>                       </span><a href="PPC.Instr.html#SUBFE"><span class="hs-identifier hs-var">SUBFE</span></a><span> </span><a href="#local-6989586621684792146"><span class="hs-identifier hs-var">rhi</span></a><span> </span><a href="#local-6989586621684792148"><span class="hs-identifier hs-var">r2hi</span></a><span> </span><a href="#local-6989586621684792147"><span class="hs-identifier hs-var">r1hi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-378"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a href="#local-6989586621684792149"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684792145"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>
</span><a name="line-380"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792150"><a href="#local-6989586621684792150"><span class="hs-identifier">expr</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-381"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792151"><a href="#local-6989586621684792151"><span class="hs-identifier">expr_reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792152"><a href="#local-6989586621684792152"><span class="hs-identifier">expr_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792150"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-382"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792153"><a href="#local-6989586621684792153"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792154"><a href="#local-6989586621684792154"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-383"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792155"><a href="#local-6989586621684792155"><span class="hs-identifier">mov_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#LI"><span class="hs-identifier hs-var">LI</span></a><span> </span><a href="#local-6989586621684792154"><span class="hs-identifier hs-var">rhi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-384"></a><span>        </span><a name="local-6989586621684792156"><a href="#local-6989586621684792156"><span class="hs-identifier">mov_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792153"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792151"><span class="hs-identifier hs-var">expr_reg</span></a><span>
</span><a name="line-385"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792152"><span class="hs-identifier hs-var">expr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792156"><span class="hs-identifier hs-var">mov_lo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792155"><span class="hs-identifier hs-var">mov_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>                         </span><a href="#local-6989586621684792153"><span class="hs-identifier hs-var">rlo</span></a><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792157"><a href="#local-6989586621684792157"><span class="hs-identifier">expr</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-389"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792158"><a href="#local-6989586621684792158"><span class="hs-identifier">expr_reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792159"><a href="#local-6989586621684792159"><span class="hs-identifier">expr_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792157"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-390"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792160"><a href="#local-6989586621684792160"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792161"><a href="#local-6989586621684792161"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-391"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792162"><a href="#local-6989586621684792162"><span class="hs-identifier">mov_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#SRA"><span class="hs-identifier hs-var">SRA</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792161"><span class="hs-identifier hs-var">rhi</span></a><span> </span><a href="#local-6989586621684792158"><span class="hs-identifier hs-var">expr_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">31</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>        </span><a name="local-6989586621684792163"><a href="#local-6989586621684792163"><span class="hs-identifier">mov_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792160"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792158"><span class="hs-identifier hs-var">expr_reg</span></a><span>
</span><a name="line-393"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792159"><span class="hs-identifier hs-var">expr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792163"><span class="hs-identifier hs-var">mov_lo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792162"><span class="hs-identifier hs-var">mov_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-394"></a><span>                         </span><a href="#local-6989586621684792160"><span class="hs-identifier hs-var">rlo</span></a><span>
</span><a name="line-395"></a><span class="hs-identifier">iselExpr64</span><span> </span><a name="local-6989586621684792164"><a href="#local-6989586621684792164"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-396"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;iselExpr64(powerpc)&quot;</span><span> </span><span class="hs-special">(</span><a href="PprCmmExpr.html#pprExpr"><span class="hs-identifier hs-var">pprExpr</span></a><span> </span><a href="#local-6989586621684792164"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-397"></a><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-identifier">getRegister</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-401"></a><a name="getRegister"><a href="PPC.CodeGen.html#getRegister"><span class="hs-identifier">getRegister</span></a></a><span> </span><a name="local-6989586621684792165"><a href="#local-6989586621684792165"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792166"><a href="#local-6989586621684792166"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-402"></a><span>                   </span><a href="PPC.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a><span> </span><a href="#local-6989586621684792166"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792165"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><a name="getRegister%27"><a href="PPC.CodeGen.html#getRegister%27"><span class="hs-identifier">getRegister'</span></a></a><span> </span><a name="local-6989586621684792167"><a href="#local-6989586621684792167"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="CmmExpr.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OSAIX</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792167"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-408"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792168"><a href="#local-6989586621684792168"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792170"><a href="#local-6989586621684792170"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792170"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792169"><span class="hs-identifier hs-var">tocAddr</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-409"></a><span>            </span><a name="local-6989586621684792169"><a href="#local-6989586621684792169"><span class="hs-identifier">tocAddr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmLit"><span class="hs-identifier hs-var">ImmLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ghc_toc_table[TC]&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792168"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792167"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-412"></a><span>      </span><a name="local-6989586621684792171"><a href="#local-6989586621684792171"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getPicBaseNat"><span class="hs-identifier hs-var">getPicBaseNat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792167"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-413"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792167"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-414"></a><span>                    </span><a href="#local-6989586621684792171"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792172"><a href="#local-6989586621684792172"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><a name="local-6989586621684792173"><a href="#local-6989586621684792173"><span class="hs-identifier">reg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621684792172"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792173"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-419"></a><span>                  </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792172"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792173"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792174"><a href="#local-6989586621684792174"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684792175"><a href="#local-6989586621684792175"><span class="hs-identifier">tree</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a><span> </span><a href="#local-6989586621684792174"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#mangleIndexTree"><span class="hs-identifier hs-var">mangleIndexTree</span></a><span> </span><a href="#local-6989586621684792174"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792175"><span class="hs-identifier hs-var">tree</span></a><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span>    </span><span class="hs-comment">-- for 32-bit architectuers, support some 64 -&gt; 32 bit conversions:</span><span>
</span><a name="line-425"></a><span>    </span><span class="hs-comment">-- TO_W_(x), TO_W_(x &gt;&gt; 32)</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792176"><a href="#local-6989586621684792176"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span>
</span><a name="line-428"></a><span>                     </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_Shr"><span class="hs-identifier hs-var">MO_U_Shr</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792177"><a href="#local-6989586621684792177"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">32</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792176"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-430"></a><span>  </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792178"><a href="#local-6989586621684792178"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792179"><a href="#local-6989586621684792179"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792177"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-431"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792179"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792178"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792180"><a href="#local-6989586621684792180"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span>
</span><a name="line-434"></a><span>                     </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_Shr"><span class="hs-identifier hs-var">MO_U_Shr</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792181"><a href="#local-6989586621684792181"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">32</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792180"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-436"></a><span>  </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792182"><a href="#local-6989586621684792182"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792183"><a href="#local-6989586621684792183"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792181"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-437"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792183"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792182"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792184"><a href="#local-6989586621684792184"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792185"><a href="#local-6989586621684792185"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-440"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792184"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-441"></a><span>  </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792186"><a href="#local-6989586621684792186"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792187"><a href="#local-6989586621684792187"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792185"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-442"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792187"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792186"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792188"><a href="#local-6989586621684792188"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792189"><a href="#local-6989586621684792189"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-445"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792188"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-446"></a><span>  </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792190"><a href="#local-6989586621684792190"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792191"><a href="#local-6989586621684792191"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792189"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-447"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792191"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684792190"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792192"><a href="#local-6989586621684792192"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792193"><a href="#local-6989586621684792193"><span class="hs-identifier">mem</span></a></a><span> </span><a name="local-6989586621684792194"><a href="#local-6989586621684792194"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684792194"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-451"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792196"><a href="#local-6989586621684792196"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792192"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-452"></a><span>        </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792197"><a href="#local-6989586621684792197"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792198"><a href="#local-6989586621684792198"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792193"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-453"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792199"><a href="#local-6989586621684792199"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792200"><a href="#local-6989586621684792200"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">targetClassOfReg</span><span> </span><a href="TargetReg.html#targetClassOfReg"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="TargetReg.html#targetClassOfReg"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">RcDouble</span><span class="hs-special">)</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">isFloatType</span><span> </span><span class="hs-identifier">pk</span><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>                       </span><a href="#local-6989586621684792198"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792195"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792200"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792197"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-455"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684792195"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792199"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792192"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-457"></a><span>        </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792201"><a href="#local-6989586621684792201"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792202"><a href="#local-6989586621684792202"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#DS"><span class="hs-identifier hs-var">DS</span></a><span> </span><a href="#local-6989586621684792193"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-458"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792203"><a href="#local-6989586621684792203"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792204"><a href="#local-6989586621684792204"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792202"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684792204"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792201"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-459"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684792203"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span>
</span><a name="line-461"></a><span>          </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792195"><a href="#local-6989586621684792195"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792194"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span class="hs-comment">-- catch simple cases of zero- or sign-extended load</span><span>
</span><a name="line-464"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792205"><a href="#local-6989586621684792205"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-465"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792206"><a href="#local-6989586621684792206"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792207"><a href="#local-6989586621684792207"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792205"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-466"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792208"><a href="#local-6989586621684792208"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792207"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><a href="#local-6989586621684792208"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792206"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792209"><a href="#local-6989586621684792209"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-469"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792210"><a href="#local-6989586621684792210"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792211"><a href="#local-6989586621684792211"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792209"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-470"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792212"><a href="#local-6989586621684792212"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792211"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><a href="#local-6989586621684792212"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792210"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-471"></a><span>
</span><a name="line-472"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792213"><a href="#local-6989586621684792213"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-473"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792214"><a href="#local-6989586621684792214"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792215"><a href="#local-6989586621684792215"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792213"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-474"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792216"><a href="#local-6989586621684792216"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792215"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><a href="#local-6989586621684792216"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792214"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span>
</span><a name="line-476"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792217"><a href="#local-6989586621684792217"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-477"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792218"><a href="#local-6989586621684792218"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792219"><a href="#local-6989586621684792219"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792217"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-478"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792220"><a href="#local-6989586621684792220"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792219"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><a href="#local-6989586621684792220"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792218"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span class="hs-comment">-- Note: there is no Load Byte Arithmetic instruction, so no signed case here</span><span>
</span><a name="line-481"></a><span>
</span><a name="line-482"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792221"><a href="#local-6989586621684792221"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-483"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792222"><a href="#local-6989586621684792222"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792223"><a href="#local-6989586621684792223"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792221"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-484"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792224"><a href="#local-6989586621684792224"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792223"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><a href="#local-6989586621684792224"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792222"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792225"><a href="#local-6989586621684792225"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-487"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792226"><a href="#local-6989586621684792226"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792227"><a href="#local-6989586621684792227"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792225"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-488"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792228"><a href="#local-6989586621684792228"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792227"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LA"><span class="hs-identifier hs-var">LA</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><a href="#local-6989586621684792228"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792226"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792229"><a href="#local-6989586621684792229"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-491"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792230"><a href="#local-6989586621684792230"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792231"><a href="#local-6989586621684792231"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792229"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-492"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792232"><a href="#local-6989586621684792232"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792231"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><a href="#local-6989586621684792232"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792230"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-493"></a><span>
</span><a name="line-494"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792233"><a href="#local-6989586621684792233"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-495"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792234"><a href="#local-6989586621684792234"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792235"><a href="#local-6989586621684792235"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792233"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-496"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792236"><a href="#local-6989586621684792236"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792235"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LA"><span class="hs-identifier hs-var">LA</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><a href="#local-6989586621684792236"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792234"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792237"><a href="#local-6989586621684792237"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-499"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792238"><a href="#local-6989586621684792238"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792239"><a href="#local-6989586621684792239"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792237"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-500"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792240"><a href="#local-6989586621684792240"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792239"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792240"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792238"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span>
</span><a name="line-502"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684792241"><a href="#local-6989586621684792241"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-503"></a><span>    </span><span class="hs-comment">-- lwa is DS-form. See Note [Power instruction format]</span><span>
</span><a name="line-504"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792242"><a href="#local-6989586621684792242"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792243"><a href="#local-6989586621684792243"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#DS"><span class="hs-identifier hs-var">DS</span></a><span> </span><a href="#local-6989586621684792241"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-505"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684792244"><a href="#local-6989586621684792244"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792243"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LA"><span class="hs-identifier hs-var">LA</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792244"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792242"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792245"><a href="#local-6989586621684792245"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684792246"><a href="#local-6989586621684792246"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792247"><a href="#local-6989586621684792247"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- unary MachOps</span><span>
</span><a name="line-508"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792246"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-509"></a><span>      </span><a href="CmmMachOp.html#MO_Not"><span class="hs-identifier hs-var">MO_Not</span></a><span> </span><a name="local-6989586621684792268"><a href="#local-6989586621684792268"><span class="hs-identifier">rep</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792248"><span class="hs-identifier hs-var">triv_ucode_int</span></a><span> </span><a href="#local-6989586621684792268"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="PPC.Instr.html#NOT"><span class="hs-identifier hs-var">NOT</span></a><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span>      </span><a href="CmmMachOp.html#MO_F_Neg"><span class="hs-identifier hs-var">MO_F_Neg</span></a><span> </span><a name="local-6989586621684792269"><a href="#local-6989586621684792269"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792249"><span class="hs-identifier hs-var">triv_ucode_float</span></a><span> </span><a href="#local-6989586621684792269"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="PPC.Instr.html#FNEG"><span class="hs-identifier hs-var">FNEG</span></a><span>
</span><a name="line-512"></a><span>      </span><a href="CmmMachOp.html#MO_S_Neg"><span class="hs-identifier hs-var">MO_S_Neg</span></a><span> </span><a name="local-6989586621684792270"><a href="#local-6989586621684792270"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792248"><span class="hs-identifier hs-var">triv_ucode_int</span></a><span>   </span><a href="#local-6989586621684792270"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="PPC.Instr.html#NEG"><span class="hs-identifier hs-var">NEG</span></a><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span>      </span><a href="CmmMachOp.html#MO_FF_Conv"><span class="hs-identifier hs-var">MO_FF_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialUCode"><span class="hs-identifier hs-var">trivialUCode</span></a><span>  </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><a href="PPC.Instr.html#FRSP"><span class="hs-identifier hs-var">FRSP</span></a><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-515"></a><span>      </span><a href="CmmMachOp.html#MO_FF_Conv"><span class="hs-identifier hs-var">MO_FF_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792250"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span>      </span><a href="CmmMachOp.html#MO_FS_Conv"><span class="hs-identifier hs-var">MO_FS_Conv</span></a><span> </span><a name="local-6989586621684792271"><a href="#local-6989586621684792271"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684792272"><a href="#local-6989586621684792272"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#coerceFP2Int"><span class="hs-identifier hs-var">coerceFP2Int</span></a><span> </span><a href="#local-6989586621684792271"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621684792272"><span class="hs-identifier hs-var">to</span></a><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-518"></a><span>      </span><a href="CmmMachOp.html#MO_SF_Conv"><span class="hs-identifier hs-var">MO_SF_Conv</span></a><span> </span><a name="local-6989586621684792273"><a href="#local-6989586621684792273"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684792274"><a href="#local-6989586621684792274"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#coerceInt2FP"><span class="hs-identifier hs-var">coerceInt2FP</span></a><span> </span><a href="#local-6989586621684792273"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621684792274"><span class="hs-identifier hs-var">to</span></a><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><a name="local-6989586621684792275"><a href="#local-6989586621684792275"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684792276"><a href="#local-6989586621684792276"><span class="hs-identifier">to</span></a></a><span>
</span><a name="line-521"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792275"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621684792276"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792250"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792276"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-522"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792248"><span class="hs-identifier hs-var">triv_ucode_int</span></a><span> </span><a href="#local-6989586621684792276"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#EXTS"><span class="hs-identifier hs-var">EXTS</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792275"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><a name="local-6989586621684792277"><a href="#local-6989586621684792277"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684792278"><a href="#local-6989586621684792278"><span class="hs-identifier">to</span></a></a><span>
</span><a name="line-525"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792277"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621684792278"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792250"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792278"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-526"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792251"><span class="hs-identifier hs-var">clearLeft</span></a><span> </span><a href="#local-6989586621684792277"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621684792278"><span class="hs-identifier hs-var">to</span></a><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792279"><a href="#local-6989586621684792279"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792250"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792279"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.getRegister: no match&quot;</span><span>
</span><a name="line-531"></a><span>
</span><a name="line-532"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-533"></a><span>        </span><a name="local-6989586621684792248"><a href="#local-6989586621684792248"><span class="hs-identifier">triv_ucode_int</span></a></a><span>   </span><a name="local-6989586621684792252"><a href="#local-6989586621684792252"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684792253"><a href="#local-6989586621684792253"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#trivialUCode"><span class="hs-identifier hs-var">trivialUCode</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span>    </span><a href="#local-6989586621684792252"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792253"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-534"></a><span>        </span><a name="local-6989586621684792249"><a href="#local-6989586621684792249"><span class="hs-identifier">triv_ucode_float</span></a></a><span> </span><a name="local-6989586621684792254"><a href="#local-6989586621684792254"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684792255"><a href="#local-6989586621684792255"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#trivialUCode"><span class="hs-identifier hs-var">trivialUCode</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span>  </span><a href="#local-6989586621684792254"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792255"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span>        </span><a name="local-6989586621684792250"><a href="#local-6989586621684792250"><span class="hs-identifier">conversionNop</span></a></a><span> </span><a name="local-6989586621684792256"><a href="#local-6989586621684792256"><span class="hs-identifier">new_format</span></a></a><span> </span><a name="local-6989586621684792257"><a href="#local-6989586621684792257"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-537"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792258"><a href="#local-6989586621684792258"><span class="hs-identifier">e_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a><span> </span><a href="#local-6989586621684792245"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792257"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-538"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#swizzleRegisterRep"><span class="hs-identifier hs-var">swizzleRegisterRep</span></a><span> </span><a href="#local-6989586621684792258"><span class="hs-identifier hs-var">e_code</span></a><span> </span><a href="#local-6989586621684792256"><span class="hs-identifier hs-var">new_format</span></a><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span>        </span><a name="local-6989586621684792251"><a href="#local-6989586621684792251"><span class="hs-identifier">clearLeft</span></a></a><span> </span><a name="local-6989586621684792259"><a href="#local-6989586621684792259"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684792260"><a href="#local-6989586621684792260"><span class="hs-identifier">to</span></a></a><span>
</span><a name="line-541"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684792261"><a href="#local-6989586621684792261"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792262"><a href="#local-6989586621684792262"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792247"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-542"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792263"><a href="#local-6989586621684792263"><span class="hs-identifier">arch_fmt</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684792245"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-543"></a><span>                     </span><a name="local-6989586621684792264"><a href="#local-6989586621684792264"><span class="hs-identifier">arch_bits</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684792245"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-544"></a><span>                     </span><a name="local-6989586621684792265"><a href="#local-6989586621684792265"><span class="hs-identifier">size</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621684792259"><span class="hs-identifier hs-var">from</span></a><span>
</span><a name="line-545"></a><span>                     </span><a name="local-6989586621684792266"><a href="#local-6989586621684792266"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792267"><a href="#local-6989586621684792267"><span class="hs-identifier">dst</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792262"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-546"></a><span>                                 </span><a href="PPC.Instr.html#CLRLI"><span class="hs-identifier hs-var">CLRLI</span></a><span> </span><a href="#local-6989586621684792263"><span class="hs-identifier hs-var">arch_fmt</span></a><span> </span><a href="#local-6989586621684792267"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792261"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792264"><span class="hs-identifier hs-var">arch_bits</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684792265"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">)</span><span>
</span><a name="line-547"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792260"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792266"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684792280"><a href="#local-6989586621684792280"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792281"><a href="#local-6989586621684792281"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792282"><a href="#local-6989586621684792282"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- dyadic PrimOps</span><span>
</span><a name="line-550"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792280"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-551"></a><span>      </span><a href="CmmMachOp.html#MO_F_Eq"><span class="hs-identifier hs-var">MO_F_Eq</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="PPC.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-552"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ne"><span class="hs-identifier hs-var">MO_F_Ne</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-553"></a><span>      </span><a href="CmmMachOp.html#MO_F_Gt"><span class="hs-identifier hs-var">MO_F_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="PPC.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-554"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ge"><span class="hs-identifier hs-var">MO_F_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="PPC.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-555"></a><span>      </span><a href="CmmMachOp.html#MO_F_Lt"><span class="hs-identifier hs-var">MO_F_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="PPC.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-556"></a><span>      </span><a href="CmmMachOp.html#MO_F_Le"><span class="hs-identifier hs-var">MO_F_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="PPC.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span>      </span><a href="CmmMachOp.html#MO_Eq"><span class="hs-identifier hs-var">MO_Eq</span></a><span> </span><a name="local-6989586621684792294"><a href="#local-6989586621684792294"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684792294"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-559"></a><span>      </span><a href="CmmMachOp.html#MO_Ne"><span class="hs-identifier hs-var">MO_Ne</span></a><span> </span><a name="local-6989586621684792295"><a href="#local-6989586621684792295"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684792295"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span>      </span><a href="CmmMachOp.html#MO_S_Gt"><span class="hs-identifier hs-var">MO_S_Gt</span></a><span> </span><a name="local-6989586621684792296"><a href="#local-6989586621684792296"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684792296"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-562"></a><span>      </span><a href="CmmMachOp.html#MO_S_Ge"><span class="hs-identifier hs-var">MO_S_Ge</span></a><span> </span><a name="local-6989586621684792297"><a href="#local-6989586621684792297"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684792297"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-563"></a><span>      </span><a href="CmmMachOp.html#MO_S_Lt"><span class="hs-identifier hs-var">MO_S_Lt</span></a><span> </span><a name="local-6989586621684792298"><a href="#local-6989586621684792298"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><a href="#local-6989586621684792298"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-564"></a><span>      </span><a href="CmmMachOp.html#MO_S_Le"><span class="hs-identifier hs-var">MO_S_Le</span></a><span> </span><a name="local-6989586621684792299"><a href="#local-6989586621684792299"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><a href="#local-6989586621684792299"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span>      </span><a href="CmmMachOp.html#MO_U_Gt"><span class="hs-identifier hs-var">MO_U_Gt</span></a><span> </span><a name="local-6989586621684792300"><a href="#local-6989586621684792300"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#GU"><span class="hs-identifier hs-var">GU</span></a><span>  </span><a href="#local-6989586621684792300"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-567"></a><span>      </span><a href="CmmMachOp.html#MO_U_Ge"><span class="hs-identifier hs-var">MO_U_Ge</span></a><span> </span><a name="local-6989586621684792301"><a href="#local-6989586621684792301"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span> </span><a href="#local-6989586621684792301"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-568"></a><span>      </span><a href="CmmMachOp.html#MO_U_Lt"><span class="hs-identifier hs-var">MO_U_Lt</span></a><span> </span><a name="local-6989586621684792302"><a href="#local-6989586621684792302"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#LU"><span class="hs-identifier hs-var">LU</span></a><span>  </span><a href="#local-6989586621684792302"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-569"></a><span>      </span><a href="CmmMachOp.html#MO_U_Le"><span class="hs-identifier hs-var">MO_U_Le</span></a><span> </span><a name="local-6989586621684792303"><a href="#local-6989586621684792303"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="PPC.Cond.html#LEU"><span class="hs-identifier hs-var">LEU</span></a><span> </span><a href="#local-6989586621684792303"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span>      </span><a href="CmmMachOp.html#MO_F_Add"><span class="hs-identifier hs-var">MO_F_Add</span></a><span> </span><a name="local-6989586621684792304"><a href="#local-6989586621684792304"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792283"><span class="hs-identifier hs-var">triv_float</span></a><span> </span><a href="#local-6989586621684792304"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="PPC.Instr.html#FADD"><span class="hs-identifier hs-var">FADD</span></a><span>
</span><a name="line-572"></a><span>      </span><a href="CmmMachOp.html#MO_F_Sub"><span class="hs-identifier hs-var">MO_F_Sub</span></a><span> </span><a name="local-6989586621684792305"><a href="#local-6989586621684792305"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792283"><span class="hs-identifier hs-var">triv_float</span></a><span> </span><a href="#local-6989586621684792305"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="PPC.Instr.html#FSUB"><span class="hs-identifier hs-var">FSUB</span></a><span>
</span><a name="line-573"></a><span>      </span><a href="CmmMachOp.html#MO_F_Mul"><span class="hs-identifier hs-var">MO_F_Mul</span></a><span> </span><a name="local-6989586621684792306"><a href="#local-6989586621684792306"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792283"><span class="hs-identifier hs-var">triv_float</span></a><span> </span><a href="#local-6989586621684792306"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="PPC.Instr.html#FMUL"><span class="hs-identifier hs-var">FMUL</span></a><span>
</span><a name="line-574"></a><span>      </span><a href="CmmMachOp.html#MO_F_Quot"><span class="hs-identifier hs-var">MO_F_Quot</span></a><span> </span><a name="local-6989586621684792307"><a href="#local-6989586621684792307"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792283"><span class="hs-identifier hs-var">triv_float</span></a><span> </span><a href="#local-6989586621684792307"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="PPC.Instr.html#FDIV"><span class="hs-identifier hs-var">FDIV</span></a><span>
</span><a name="line-575"></a><span>
</span><a name="line-576"></a><span>         </span><span class="hs-comment">-- optimize addition with 32-bit immediate</span><span>
</span><a name="line-577"></a><span>         </span><span class="hs-comment">-- (needed for PIC)</span><span>
</span><a name="line-578"></a><span>      </span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-579"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-580"></a><span>          </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792308"><a href="#local-6989586621684792308"><span class="hs-identifier">imm</span></a></a><span> </span><a name="local-6989586621684792309"><a href="#local-6989586621684792309"><span class="hs-identifier">immrep</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792308"><span class="hs-identifier hs-var">imm</span></a><span>
</span><a name="line-581"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a href="#local-6989586621684792308"><span class="hs-identifier hs-var">imm</span></a><span> </span><a href="#local-6989586621684792309"><span class="hs-identifier hs-var">immrep</span></a><span class="hs-special">)</span><span>
</span><a name="line-582"></a><span>          </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684792310"><a href="#local-6989586621684792310"><span class="hs-identifier">lit</span></a></a><span>
</span><a name="line-583"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-584"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621684792311"><a href="#local-6989586621684792311"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792312"><a href="#local-6989586621684792312"><span class="hs-identifier">srcCode</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-585"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792313"><a href="#local-6989586621684792313"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684792310"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-586"></a><span>                    </span><a name="local-6989586621684792314"><a href="#local-6989586621684792314"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792315"><a href="#local-6989586621684792315"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792312"><span class="hs-identifier hs-var">srcCode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-587"></a><span>                                    </span><a href="PPC.Instr.html#ADDIS"><span class="hs-identifier hs-var">ADDIS</span></a><span> </span><a href="#local-6989586621684792315"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792311"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#HA"><span class="hs-identifier hs-var">HA</span></a><span> </span><a href="#local-6989586621684792313"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-588"></a><span>                                    </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792315"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792315"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#LO"><span class="hs-identifier hs-var">LO</span></a><span> </span><a href="#local-6989586621684792313"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>                                </span><span class="hs-special">]</span><span>
</span><a name="line-590"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792314"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-591"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-592"></a><span>
</span><a name="line-593"></a><span>      </span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><a name="local-6989586621684792316"><a href="#local-6989586621684792316"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684792316"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-594"></a><span>      </span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><a name="local-6989586621684792317"><a href="#local-6989586621684792317"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-595"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-596"></a><span>          </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792318"><a href="#local-6989586621684792318"><span class="hs-identifier">imm</span></a></a><span> </span><a name="local-6989586621684792319"><a href="#local-6989586621684792319"><span class="hs-identifier">immrep</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684792317"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684792318"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span>
</span><a name="line-597"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684792317"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684792318"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792319"><span class="hs-identifier hs-var">immrep</span></a><span class="hs-special">)</span><span>
</span><a name="line-598"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-599"></a><span>                 </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792320"><a href="#local-6989586621684792320"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-600"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684792317"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792320"><span class="hs-identifier hs-var">imm</span></a><span>
</span><a name="line-601"></a><span>                   </span><span class="hs-comment">-- subfi ('substract from' with immediate) doesn't exist</span><span>
</span><a name="line-602"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684792317"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="PPC.Instr.html#SUBFC"><span class="hs-identifier hs-var">SUBFC</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-603"></a><span>                 </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCodeNoImm%27"><span class="hs-identifier hs-var">trivialCodeNoImm'</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792317"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span> </span><a href="PPC.Instr.html#SUBF"><span class="hs-identifier hs-var">SUBF</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-604"></a><span>
</span><a name="line-605"></a><span>      </span><a href="CmmMachOp.html#MO_Mul"><span class="hs-identifier hs-var">MO_Mul</span></a><span> </span><a name="local-6989586621684792321"><a href="#local-6989586621684792321"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#shiftMulCode"><span class="hs-identifier hs-var">shiftMulCode</span></a><span> </span><a href="#local-6989586621684792321"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-606"></a><span>      </span><a href="CmmMachOp.html#MO_S_MulMayOflo"><span class="hs-identifier hs-var">MO_S_MulMayOflo</span></a><span> </span><a name="local-6989586621684792322"><a href="#local-6989586621684792322"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-607"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792323"><a href="#local-6989586621684792323"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792324"><a href="#local-6989586621684792324"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-608"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792325"><a href="#local-6989586621684792325"><span class="hs-identifier">src2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792326"><a href="#local-6989586621684792326"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-609"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-610"></a><span>          </span><a name="local-6989586621684792327"><a href="#local-6989586621684792327"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792322"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-611"></a><span>          </span><a name="local-6989586621684792328"><a href="#local-6989586621684792328"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792329"><a href="#local-6989586621684792329"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792324"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792326"><span class="hs-identifier hs-var">code2</span></a><span>
</span><a name="line-612"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#MULLO"><span class="hs-identifier hs-var">MULLO</span></a><span> </span><a href="#local-6989586621684792327"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792329"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792323"><span class="hs-identifier hs-var">src1</span></a><span> </span><a href="#local-6989586621684792325"><span class="hs-identifier hs-var">src2</span></a><span>
</span><a name="line-613"></a><span>                                    </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MFOV"><span class="hs-identifier hs-var">MFOV</span></a><span>  </span><a href="#local-6989586621684792327"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792329"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-614"></a><span>                                    </span><span class="hs-special">]</span><span>
</span><a name="line-615"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684792327"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792328"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span>      </span><a href="CmmMachOp.html#MO_S_Quot"><span class="hs-identifier hs-var">MO_S_Quot</span></a><span> </span><a name="local-6989586621684792330"><a href="#local-6989586621684792330"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#divCode"><span class="hs-identifier hs-var">divCode</span></a><span> </span><a href="#local-6989586621684792330"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-618"></a><span>      </span><a href="CmmMachOp.html#MO_U_Quot"><span class="hs-identifier hs-var">MO_U_Quot</span></a><span> </span><a name="local-6989586621684792331"><a href="#local-6989586621684792331"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#divCode"><span class="hs-identifier hs-var">divCode</span></a><span> </span><a href="#local-6989586621684792331"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span>      </span><a href="CmmMachOp.html#MO_S_Rem"><span class="hs-identifier hs-var">MO_S_Rem</span></a><span> </span><a name="local-6989586621684792332"><a href="#local-6989586621684792332"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792284"><span class="hs-identifier hs-var">remainder</span></a><span> </span><a href="#local-6989586621684792332"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-621"></a><span>      </span><a href="CmmMachOp.html#MO_U_Rem"><span class="hs-identifier hs-var">MO_U_Rem</span></a><span> </span><a name="local-6989586621684792333"><a href="#local-6989586621684792333"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792284"><span class="hs-identifier hs-var">remainder</span></a><span> </span><a href="#local-6989586621684792333"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-622"></a><span>
</span><a name="line-623"></a><span>      </span><a href="CmmMachOp.html#MO_And"><span class="hs-identifier hs-var">MO_And</span></a><span> </span><a name="local-6989586621684792334"><a href="#local-6989586621684792334"><span class="hs-identifier">rep</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-624"></a><span>        </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792335"><a href="#local-6989586621684792335"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792335"><span class="hs-identifier hs-var">imm</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">8</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684792335"><span class="hs-identifier hs-var">imm</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">4</span><span>
</span><a name="line-625"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-626"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621684792336"><a href="#local-6989586621684792336"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792337"><a href="#local-6989586621684792337"><span class="hs-identifier">srcCode</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-627"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792338"><a href="#local-6989586621684792338"><span class="hs-identifier">clear_mask</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684792335"><span class="hs-identifier hs-var">imm</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">4</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-628"></a><span>                    </span><a name="local-6989586621684792339"><a href="#local-6989586621684792339"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792334"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-629"></a><span>                    </span><a name="local-6989586621684792340"><a href="#local-6989586621684792340"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792341"><a href="#local-6989586621684792341"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792337"><span class="hs-identifier hs-var">srcCode</span></a><span>
</span><a name="line-630"></a><span>                               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#CLRRI"><span class="hs-identifier hs-var">CLRRI</span></a><span> </span><a href="#local-6989586621684792339"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792341"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792336"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684792338"><span class="hs-identifier hs-var">clear_mask</span></a><span class="hs-special">)</span><span>
</span><a name="line-631"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684792339"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792340"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-632"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684792334"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="PPC.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-633"></a><span>      </span><a href="CmmMachOp.html#MO_Or"><span class="hs-identifier hs-var">MO_Or</span></a><span> </span><a name="local-6989586621684792342"><a href="#local-6989586621684792342"><span class="hs-identifier">rep</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684792342"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="PPC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-634"></a><span>      </span><a href="CmmMachOp.html#MO_Xor"><span class="hs-identifier hs-var">MO_Xor</span></a><span> </span><a name="local-6989586621684792343"><a href="#local-6989586621684792343"><span class="hs-identifier">rep</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684792343"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="PPC.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span>      </span><a href="CmmMachOp.html#MO_Shl"><span class="hs-identifier hs-var">MO_Shl</span></a><span> </span><a name="local-6989586621684792344"><a href="#local-6989586621684792344"><span class="hs-identifier">rep</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#shiftMulCode"><span class="hs-identifier hs-var">shiftMulCode</span></a><span> </span><a href="#local-6989586621684792344"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-637"></a><span>      </span><a href="CmmMachOp.html#MO_S_Shr"><span class="hs-identifier hs-var">MO_S_Shr</span></a><span> </span><a name="local-6989586621684792345"><a href="#local-6989586621684792345"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#srCode"><span class="hs-identifier hs-var">srCode</span></a><span> </span><a href="#local-6989586621684792345"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="PPC.Instr.html#SRA"><span class="hs-identifier hs-var">SRA</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-638"></a><span>      </span><a href="CmmMachOp.html#MO_U_Shr"><span class="hs-identifier hs-var">MO_U_Shr</span></a><span> </span><a name="local-6989586621684792346"><a href="#local-6989586621684792346"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#srCode"><span class="hs-identifier hs-var">srCode</span></a><span> </span><a href="#local-6989586621684792346"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="PPC.Instr.html#SR"><span class="hs-identifier hs-var">SR</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-639"></a><span>      </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.getRegister: no match&quot;</span><span>
</span><a name="line-640"></a><span>
</span><a name="line-641"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-642"></a><span>    </span><span class="hs-identifier">triv_float</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-643"></a><span>    </span><a name="local-6989586621684792283"><a href="#local-6989586621684792283"><span class="hs-identifier">triv_float</span></a></a><span> </span><a name="local-6989586621684792285"><a href="#local-6989586621684792285"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684792286"><a href="#local-6989586621684792286"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#trivialCodeNoImm"><span class="hs-identifier hs-var">trivialCodeNoImm</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684792285"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792286"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684792281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792282"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span>    </span><span class="hs-identifier">remainder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-646"></a><span>    </span><a name="local-6989586621684792284"><a href="#local-6989586621684792284"><span class="hs-identifier">remainder</span></a></a><span> </span><a name="local-6989586621684792287"><a href="#local-6989586621684792287"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684792288"><a href="#local-6989586621684792288"><span class="hs-identifier">sgn</span></a></a><span> </span><a name="local-6989586621684792289"><a href="#local-6989586621684792289"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684792290"><a href="#local-6989586621684792290"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-647"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792291"><a href="#local-6989586621684792291"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792287"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-648"></a><span>      </span><a name="local-6989586621684792292"><a href="#local-6989586621684792292"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792291"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-649"></a><span>      </span><a name="local-6989586621684792293"><a href="#local-6989586621684792293"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#remainderCode"><span class="hs-identifier hs-var">remainderCode</span></a><span> </span><a href="#local-6989586621684792287"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792288"><span class="hs-identifier hs-var">sgn</span></a><span> </span><a href="#local-6989586621684792292"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792289"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792290"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-650"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684792291"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792293"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792347"><a href="#local-6989586621684792347"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621684792348"><a href="#local-6989586621684792348"><span class="hs-identifier">rep</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-654"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792349"><a href="#local-6989586621684792349"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684792348"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792347"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-655"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-656"></a><span>        </span><a name="local-6989586621684792350"><a href="#local-6989586621684792350"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792351"><a href="#local-6989586621684792351"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#LI"><span class="hs-identifier hs-var">LI</span></a><span> </span><a href="#local-6989586621684792351"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792349"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span>
</span><a name="line-657"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-658"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792348"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792350"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><a name="local-6989586621684792352"><a href="#local-6989586621684792352"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621684792353"><a href="#local-6989586621684792353"><span class="hs-identifier">frep</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-661"></a><span>    </span><a name="local-6989586621684792354"><a href="#local-6989586621684792354"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-662"></a><span>    </span><a name="local-6989586621684792355"><a href="#local-6989586621684792355"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-663"></a><span>    </span><a name="local-6989586621684792356"><a href="#local-6989586621684792356"><span class="hs-identifier">dynRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684792355"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a><span> </span><a href="#local-6989586621684792354"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-664"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792357"><a href="#local-6989586621684792357"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792358"><a href="#local-6989586621684792358"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792356"><span class="hs-identifier hs-var">dynRef</span></a><span>
</span><a name="line-665"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792359"><a href="#local-6989586621684792359"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684792353"><span class="hs-identifier hs-var">frep</span></a><span>
</span><a name="line-666"></a><span>        </span><a name="local-6989586621684792360"><a href="#local-6989586621684792360"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792361"><a href="#local-6989586621684792361"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-667"></a><span>            </span><a href="PPC.Instr.html#LDATA"><span class="hs-identifier hs-var">LDATA</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><a href="#local-6989586621684792354"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-668"></a><span>                  </span><span class="hs-special">(</span><a href="Cmm.html#Statics"><span class="hs-identifier hs-var">Statics</span></a><span> </span><a href="#local-6989586621684792354"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><a href="#local-6989586621684792352"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684792353"><span class="hs-identifier hs-var">frep</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-669"></a><span>            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">consOL</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792358"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792359"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792361"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792357"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span>
</span><a name="line-670"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684792359"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792360"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684792362"><a href="#local-6989586621684792362"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684792363"><a href="#local-6989586621684792363"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-673"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792362"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-674"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792364"><a href="#local-6989586621684792364"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a><span> </span><a href="#local-6989586621684792362"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792363"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-675"></a><span>        </span><a name="local-6989586621684792365"><a href="#local-6989586621684792365"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684792363"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-676"></a><span>        </span><a name="local-6989586621684792366"><a href="#local-6989586621684792366"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792367"><a href="#local-6989586621684792367"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-677"></a><span>              </span><a href="PPC.Instr.html#LIS"><span class="hs-identifier hs-var">LIS</span></a><span> </span><a href="#local-6989586621684792367"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#HA"><span class="hs-identifier hs-var">HA</span></a><span> </span><a href="#local-6989586621684792365"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-678"></a><span>              </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792367"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792367"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#LO"><span class="hs-identifier hs-var">LO</span></a><span> </span><a href="#local-6989586621684792365"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-679"></a><span>          </span><span class="hs-special">]</span><span>
</span><a name="line-680"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792364"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792366"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-682"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792368"><a href="#local-6989586621684792368"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-683"></a><span>       </span><a name="local-6989586621684792369"><a href="#local-6989586621684792369"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-684"></a><span>       </span><a name="local-6989586621684792370"><a href="#local-6989586621684792370"><span class="hs-identifier">dynRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684792369"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a><span> </span><a href="#local-6989586621684792368"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-685"></a><span>       </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792371"><a href="#local-6989586621684792371"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792372"><a href="#local-6989586621684792372"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684792370"><span class="hs-identifier hs-var">dynRef</span></a><span>
</span><a name="line-686"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792373"><a href="#local-6989586621684792373"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a><span> </span><a href="#local-6989586621684792369"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792363"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-687"></a><span>           </span><a name="local-6989586621684792374"><a href="#local-6989586621684792374"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792373"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-688"></a><span>           </span><a name="local-6989586621684792375"><a href="#local-6989586621684792375"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792376"><a href="#local-6989586621684792376"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-689"></a><span>            </span><a href="PPC.Instr.html#LDATA"><span class="hs-identifier hs-var">LDATA</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><a href="#local-6989586621684792368"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#Statics"><span class="hs-identifier hs-var">Statics</span></a><span> </span><a href="#local-6989586621684792368"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><a href="#local-6989586621684792363"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-690"></a><span>            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">consOL</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792372"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792374"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792376"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792371"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span>
</span><a name="line-691"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684792374"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792375"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-692"></a><span>
</span><a name="line-693"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792377"><a href="#local-6989586621684792377"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;getRegister(ppc)&quot;</span><span> </span><span class="hs-special">(</span><a href="PprCmmExpr.html#pprExpr"><span class="hs-identifier hs-var">pprExpr</span></a><span> </span><a href="#local-6989586621684792377"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-694"></a><span>
</span><a name="line-695"></a><span>    </span><span class="hs-comment">-- extend?Rep: wrap integer expression of type `from`</span><span>
</span><a name="line-696"></a><span>    </span><span class="hs-comment">-- in a conversion to `to`</span><span>
</span><a name="line-697"></a><span class="hs-identifier">extendSExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-698"></a><a name="extendSExpr"><a href="PPC.CodeGen.html#extendSExpr"><span class="hs-identifier">extendSExpr</span></a></a><span> </span><a name="local-6989586621684792378"><a href="#local-6989586621684792378"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684792379"><a href="#local-6989586621684792379"><span class="hs-identifier">to</span></a></a><span> </span><a name="local-6989586621684792380"><a href="#local-6989586621684792380"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><a href="#local-6989586621684792378"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621684792379"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684792380"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-699"></a><span>
</span><a name="line-700"></a><span class="hs-identifier">extendUExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-701"></a><a name="extendUExpr"><a href="PPC.CodeGen.html#extendUExpr"><span class="hs-identifier">extendUExpr</span></a></a><span> </span><a name="local-6989586621684792381"><a href="#local-6989586621684792381"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684792382"><a href="#local-6989586621684792382"><span class="hs-identifier">to</span></a></a><span> </span><a name="local-6989586621684792383"><a href="#local-6989586621684792383"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><a href="#local-6989586621684792381"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621684792382"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684792383"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-702"></a><span>
</span><a name="line-703"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-704"></a><span class="hs-comment">--  The 'Amode' type: Memory addressing modes passed up the tree.</span><span>
</span><a name="line-705"></a><span>
</span><a name="line-706"></a><span class="hs-keyword">data</span><span> </span><a name="Amode"><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier">Amode</span></a></a><span>
</span><a name="line-707"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="Amode"><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier">Amode</span></a></a><span> </span><a href="PPC.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span class="hs-comment">{-
Now, given a tree (the argument to a CmmLoad) that references memory,
produce a suitable addressing mode.

A Rule of the Game (tm) for Amodes: use of the addr bit must
immediately follow use of the code part, since the code part puts
values in registers which the addr then refers to.  So you can't put
anything in between, lest it overwrite some of those registers.  If
you need to do some other computation between the code part and use of
the addr bit, first store the effective address from the amode in a
temporary, then do the other computation, and then use the temporary:

    code
    LEA amode, tmp
    ... other computation ...
    ... (tmp) ...
-}</span><span>
</span><a name="line-726"></a><span>
</span><a name="line-727"></a><span class="hs-comment">{- Note [Power instruction format]
In some instructions the 16 bit offset must be a multiple of 4, i.e.
the two least significant bits must be zero. The &quot;Power ISA&quot; specification
calls these instruction formats &quot;DS-FORM&quot; and the instructions with
arbitrary 16 bit offsets are &quot;D-FORM&quot;.

The Power ISA specification document can be obtained from www.power.org.
-}</span><span>
</span><a name="line-735"></a><span class="hs-keyword">data</span><span> </span><a name="InstrForm"><a href="PPC.CodeGen.html#InstrForm"><span class="hs-identifier">InstrForm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="D"><a href="PPC.CodeGen.html#D"><span class="hs-identifier">D</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="DS"><a href="PPC.CodeGen.html#DS"><span class="hs-identifier">DS</span></a></a><span>
</span><a name="line-736"></a><span>
</span><a name="line-737"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PPC.CodeGen.html#InstrForm"><span class="hs-identifier hs-type">InstrForm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a><span>
</span><a name="line-738"></a><a name="getAmode"><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier">getAmode</span></a></a><span> </span><a name="local-6989586621684792384"><a href="#local-6989586621684792384"><span class="hs-identifier">inf</span></a></a><span> </span><a name="local-6989586621684792385"><a href="#local-6989586621684792385"><span class="hs-identifier">tree</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792386"><a href="#local-6989586621684792386"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-740"></a><span>       </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684792384"><span class="hs-identifier hs-var">inf</span></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#mangleIndexTree"><span class="hs-identifier hs-var">mangleIndexTree</span></a><span> </span><a href="#local-6989586621684792386"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792385"><span class="hs-identifier hs-var">tree</span></a><span class="hs-special">)</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792387"><a href="#local-6989586621684792387"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792388"><a href="#local-6989586621684792388"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-743"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792389"><a href="#local-6989586621684792389"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684792388"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-744"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-745"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792390"><a href="#local-6989586621684792390"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792391"><a href="#local-6989586621684792391"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792387"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-746"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792390"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792389"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792391"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-747"></a><span>
</span><a name="line-748"></a><span>
</span><a name="line-749"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792392"><a href="#local-6989586621684792392"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792393"><a href="#local-6989586621684792393"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-750"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792394"><a href="#local-6989586621684792394"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792393"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-751"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-752"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792395"><a href="#local-6989586621684792395"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792396"><a href="#local-6989586621684792396"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792392"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-753"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792395"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792394"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792396"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-754"></a><span>
</span><a name="line-755"></a><span class="hs-identifier">getAmode</span><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792397"><a href="#local-6989586621684792397"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792398"><a href="#local-6989586621684792398"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-756"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792399"><a href="#local-6989586621684792399"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684792398"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-757"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-758"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792400"><a href="#local-6989586621684792400"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792401"><a href="#local-6989586621684792401"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792397"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-759"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792400"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792399"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792401"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-identifier">getAmode</span><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792402"><a href="#local-6989586621684792402"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792403"><a href="#local-6989586621684792403"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-763"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792404"><a href="#local-6989586621684792404"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792403"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-764"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-765"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792405"><a href="#local-6989586621684792405"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792406"><a href="#local-6989586621684792406"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792402"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-766"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792405"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792404"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792406"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span class="hs-identifier">getAmode</span><span> </span><a href="PPC.CodeGen.html#DS"><span class="hs-identifier hs-var">DS</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792407"><a href="#local-6989586621684792407"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792408"><a href="#local-6989586621684792408"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-769"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792409"><a href="#local-6989586621684792409"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684792408"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-771"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792410"><a href="#local-6989586621684792410"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792411"><a href="#local-6989586621684792411"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792407"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-772"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792413"><a href="#local-6989586621684792413"><span class="hs-identifier">reg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792414"><a href="#local-6989586621684792414"><span class="hs-identifier">off'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792415"><a href="#local-6989586621684792415"><span class="hs-identifier">code'</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-773"></a><span>                     </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684792408"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-774"></a><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792410"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792409"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792411"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-775"></a><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-776"></a><span>                           </span><a name="local-6989586621684792412"><a href="#local-6989586621684792412"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span>
</span><a name="line-777"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792412"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span> </span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span>
</span><a name="line-778"></a><span>                                  </span><a href="#local-6989586621684792411"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792412"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792410"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684792409"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792413"><span class="hs-identifier hs-var">reg'</span></a><span> </span><a href="#local-6989586621684792414"><span class="hs-identifier hs-var">off'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792415"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>
</span><a name="line-781"></a><span class="hs-identifier">getAmode</span><span> </span><a href="PPC.CodeGen.html#DS"><span class="hs-identifier hs-var">DS</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792416"><a href="#local-6989586621684792416"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792417"><a href="#local-6989586621684792417"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-782"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792418"><a href="#local-6989586621684792418"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792417"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-783"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-784"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792419"><a href="#local-6989586621684792419"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792420"><a href="#local-6989586621684792420"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792416"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-785"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792422"><a href="#local-6989586621684792422"><span class="hs-identifier">reg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792423"><a href="#local-6989586621684792423"><span class="hs-identifier">off'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792424"><a href="#local-6989586621684792424"><span class="hs-identifier">code'</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-786"></a><span>                     </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684792417"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-787"></a><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792419"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792418"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792420"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-788"></a><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-789"></a><span>                           </span><a name="local-6989586621684792421"><a href="#local-6989586621684792421"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span>
</span><a name="line-790"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792421"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span> </span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span>
</span><a name="line-791"></a><span>                                  </span><a href="#local-6989586621684792420"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792421"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792419"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684792418"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-792"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792422"><span class="hs-identifier hs-var">reg'</span></a><span> </span><a href="#local-6989586621684792423"><span class="hs-identifier hs-var">off'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792424"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span>   </span><span class="hs-comment">-- optimize addition with 32-bit immediate</span><span>
</span><a name="line-795"></a><span>   </span><span class="hs-comment">-- (needed for PIC)</span><span>
</span><a name="line-796"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792425"><a href="#local-6989586621684792425"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684792426"><a href="#local-6989586621684792426"><span class="hs-identifier">lit</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-797"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-798"></a><span>        </span><a name="local-6989586621684792428"><a href="#local-6989586621684792428"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-799"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792429"><a href="#local-6989586621684792429"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792430"><a href="#local-6989586621684792430"><span class="hs-identifier">srcCode</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792425"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-800"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792431"><a href="#local-6989586621684792431"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684792426"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-801"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-802"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OSAIX</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792428"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-803"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792427"><span class="hs-identifier hs-var">isCmmLabelType</span></a><span> </span><a href="#local-6989586621684792426"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-804"></a><span>                    </span><span class="hs-comment">-- HA16/LO16 relocations on labels not supported on AIX</span><span>
</span><a name="line-805"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792429"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684792431"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792430"><span class="hs-identifier hs-var">srcCode</span></a><span class="hs-special">)</span><span>
</span><a name="line-806"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-807"></a><span>                    </span><a name="local-6989586621684792432"><a href="#local-6989586621684792432"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-808"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792433"><a href="#local-6989586621684792433"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792430"><span class="hs-identifier hs-var">srcCode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ADDIS"><span class="hs-identifier hs-var">ADDIS</span></a><span> </span><a href="#local-6989586621684792432"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792429"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#HA"><span class="hs-identifier hs-var">HA</span></a><span> </span><a href="#local-6989586621684792431"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span>
</span><a name="line-809"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792432"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#LO"><span class="hs-identifier hs-var">LO</span></a><span> </span><a href="#local-6989586621684792431"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792433"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-811"></a><span>      </span><a name="local-6989586621684792427"><a href="#local-6989586621684792427"><span class="hs-identifier">isCmmLabelType</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-812"></a><span>      </span><span class="hs-identifier">isCmmLabelType</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabelOff"><span class="hs-identifier hs-var">CmmLabelOff</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-813"></a><span>      </span><span class="hs-identifier">isCmmLabelType</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabelDiffOff"><span class="hs-identifier hs-var">CmmLabelDiffOff</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-814"></a><span>      </span><span class="hs-identifier">isCmmLabelType</span><span> </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-815"></a><span>
</span><a name="line-816"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684792434"><a href="#local-6989586621684792434"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-817"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-818"></a><span>        </span><a name="local-6989586621684792435"><a href="#local-6989586621684792435"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-819"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792435"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-820"></a><span>             </span><span class="hs-identifier hs-var">ArchPPC</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-821"></a><span>                 </span><a name="local-6989586621684792436"><a href="#local-6989586621684792436"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-822"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792437"><a href="#local-6989586621684792437"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684792434"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-823"></a><span>                     </span><a name="local-6989586621684792438"><a href="#local-6989586621684792438"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#LIS"><span class="hs-identifier hs-var">LIS</span></a><span> </span><a href="#local-6989586621684792436"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#HA"><span class="hs-identifier hs-var">HA</span></a><span> </span><a href="#local-6989586621684792437"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-824"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792436"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#LO"><span class="hs-identifier hs-var">LO</span></a><span> </span><a href="#local-6989586621684792437"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792438"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-825"></a><span>             </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- TODO: Load from TOC,</span><span>
</span><a name="line-826"></a><span>                            </span><span class="hs-comment">-- see getRegister' _ (CmmLit lit)</span><span>
</span><a name="line-827"></a><span>                 </span><a name="local-6989586621684792439"><a href="#local-6989586621684792439"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span>
</span><a name="line-828"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792440"><a href="#local-6989586621684792440"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684792434"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-829"></a><span>                     </span><a name="local-6989586621684792441"><a href="#local-6989586621684792441"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-830"></a><span>                          </span><a href="PPC.Instr.html#LIS"><span class="hs-identifier hs-var">LIS</span></a><span> </span><a href="#local-6989586621684792439"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#HIGHESTA"><span class="hs-identifier hs-var">HIGHESTA</span></a><span> </span><a href="#local-6989586621684792440"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-831"></a><span>                          </span><a href="PPC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><a href="#local-6989586621684792439"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792439"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#HIGHERA"><span class="hs-identifier hs-var">HIGHERA</span></a><span> </span><a href="#local-6989586621684792440"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-832"></a><span>                          </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span>  </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684792439"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792439"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-833"></a><span>                          </span><a href="PPC.Instr.html#ORIS"><span class="hs-identifier hs-var">ORIS</span></a><span> </span><a href="#local-6989586621684792439"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792439"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#HA"><span class="hs-identifier hs-var">HA</span></a><span> </span><a href="#local-6989586621684792440"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span>
</span><a name="line-834"></a><span>                          </span><span class="hs-special">]</span><span>
</span><a name="line-835"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792439"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#LO"><span class="hs-identifier hs-var">LO</span></a><span> </span><a href="#local-6989586621684792440"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792441"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-836"></a><span>
</span><a name="line-837"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792442"><a href="#local-6989586621684792442"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792443"><a href="#local-6989586621684792443"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-838"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-839"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792444"><a href="#local-6989586621684792444"><span class="hs-identifier">regX</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792445"><a href="#local-6989586621684792445"><span class="hs-identifier">codeX</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792442"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-840"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792446"><a href="#local-6989586621684792446"><span class="hs-identifier">regY</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792447"><a href="#local-6989586621684792447"><span class="hs-identifier">codeY</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792443"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-841"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegReg"><span class="hs-identifier hs-var">AddrRegReg</span></a><span> </span><a href="#local-6989586621684792444"><span class="hs-identifier hs-var">regX</span></a><span> </span><a href="#local-6989586621684792446"><span class="hs-identifier hs-var">regY</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792445"><span class="hs-identifier hs-var">codeX</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792447"><span class="hs-identifier hs-var">codeY</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-842"></a><span>
</span><a name="line-843"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792448"><a href="#local-6989586621684792448"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792449"><a href="#local-6989586621684792449"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-844"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-845"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792450"><a href="#local-6989586621684792450"><span class="hs-identifier">regX</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792451"><a href="#local-6989586621684792451"><span class="hs-identifier">codeX</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792448"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-846"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792452"><a href="#local-6989586621684792452"><span class="hs-identifier">regY</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792453"><a href="#local-6989586621684792453"><span class="hs-identifier">codeY</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792449"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-847"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegReg"><span class="hs-identifier hs-var">AddrRegReg</span></a><span> </span><a href="#local-6989586621684792450"><span class="hs-identifier hs-var">regX</span></a><span> </span><a href="#local-6989586621684792452"><span class="hs-identifier hs-var">regY</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792451"><span class="hs-identifier hs-var">codeX</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792453"><span class="hs-identifier hs-var">codeY</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-848"></a><span>
</span><a name="line-849"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792454"><a href="#local-6989586621684792454"><span class="hs-identifier">other</span></a></a><span>
</span><a name="line-850"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-851"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792455"><a href="#local-6989586621684792455"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792456"><a href="#local-6989586621684792456"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792454"><span class="hs-identifier hs-var">other</span></a><span>
</span><a name="line-852"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-853"></a><span>            </span><a name="local-6989586621684792457"><a href="#local-6989586621684792457"><span class="hs-identifier">off</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-854"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792455"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792457"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792456"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-855"></a><span>
</span><a name="line-856"></a><span>
</span><a name="line-857"></a><span class="hs-comment">--  The 'CondCode' type:  Condition codes passed up the tree.</span><span>
</span><a name="line-858"></a><span class="hs-keyword">data</span><span> </span><a name="CondCode"><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier">CondCode</span></a></a><span>
</span><a name="line-859"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="CondCode"><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier">CondCode</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><a href="PPC.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-860"></a><span>
</span><a name="line-861"></a><span class="hs-comment">-- Set up a condition code for a conditional branch.</span><span>
</span><a name="line-862"></a><span>
</span><a name="line-863"></a><span class="hs-identifier">getCondCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span>
</span><a name="line-864"></a><span>
</span><a name="line-865"></a><span class="hs-comment">-- almost the same as everywhere else - but we need to</span><span>
</span><a name="line-866"></a><span class="hs-comment">-- extend small integers to 32 bit or 64 bit first</span><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><a name="getCondCode"><a href="PPC.CodeGen.html#getCondCode"><span class="hs-identifier">getCondCode</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684792458"><a href="#local-6989586621684792458"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792459"><a href="#local-6989586621684792459"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792460"><a href="#local-6989586621684792460"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-869"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-870"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792458"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-871"></a><span>      </span><a href="CmmMachOp.html#MO_F_Eq"><span class="hs-identifier hs-var">MO_F_Eq</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-872"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ne"><span class="hs-identifier hs-var">MO_F_Ne</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-873"></a><span>      </span><a href="CmmMachOp.html#MO_F_Gt"><span class="hs-identifier hs-var">MO_F_Gt</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-874"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ge"><span class="hs-identifier hs-var">MO_F_Ge</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-875"></a><span>      </span><a href="CmmMachOp.html#MO_F_Lt"><span class="hs-identifier hs-var">MO_F_Lt</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-876"></a><span>      </span><a href="CmmMachOp.html#MO_F_Le"><span class="hs-identifier hs-var">MO_F_Le</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-877"></a><span>
</span><a name="line-878"></a><span>      </span><a href="CmmMachOp.html#MO_F_Eq"><span class="hs-identifier hs-var">MO_F_Eq</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-879"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ne"><span class="hs-identifier hs-var">MO_F_Ne</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-880"></a><span>      </span><a href="CmmMachOp.html#MO_F_Gt"><span class="hs-identifier hs-var">MO_F_Gt</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-881"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ge"><span class="hs-identifier hs-var">MO_F_Ge</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-882"></a><span>      </span><a href="CmmMachOp.html#MO_F_Lt"><span class="hs-identifier hs-var">MO_F_Lt</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-883"></a><span>      </span><a href="CmmMachOp.html#MO_F_Le"><span class="hs-identifier hs-var">MO_F_Le</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="PPC.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-884"></a><span>
</span><a name="line-885"></a><span>      </span><a href="CmmMachOp.html#MO_Eq"><span class="hs-identifier hs-var">MO_Eq</span></a><span> </span><a name="local-6989586621684792461"><a href="#local-6989586621684792461"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684792461"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-886"></a><span>      </span><a href="CmmMachOp.html#MO_Ne"><span class="hs-identifier hs-var">MO_Ne</span></a><span> </span><a name="local-6989586621684792462"><a href="#local-6989586621684792462"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684792462"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-887"></a><span>
</span><a name="line-888"></a><span>      </span><a href="CmmMachOp.html#MO_S_Gt"><span class="hs-identifier hs-var">MO_S_Gt</span></a><span> </span><a name="local-6989586621684792463"><a href="#local-6989586621684792463"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684792463"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-889"></a><span>      </span><a href="CmmMachOp.html#MO_S_Ge"><span class="hs-identifier hs-var">MO_S_Ge</span></a><span> </span><a name="local-6989586621684792464"><a href="#local-6989586621684792464"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684792464"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-890"></a><span>      </span><a href="CmmMachOp.html#MO_S_Lt"><span class="hs-identifier hs-var">MO_S_Lt</span></a><span> </span><a name="local-6989586621684792465"><a href="#local-6989586621684792465"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><a href="#local-6989586621684792465"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-891"></a><span>      </span><a href="CmmMachOp.html#MO_S_Le"><span class="hs-identifier hs-var">MO_S_Le</span></a><span> </span><a name="local-6989586621684792466"><a href="#local-6989586621684792466"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><a href="#local-6989586621684792466"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-892"></a><span>
</span><a name="line-893"></a><span>      </span><a href="CmmMachOp.html#MO_U_Gt"><span class="hs-identifier hs-var">MO_U_Gt</span></a><span> </span><a name="local-6989586621684792467"><a href="#local-6989586621684792467"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#GU"><span class="hs-identifier hs-var">GU</span></a><span>  </span><a href="#local-6989586621684792467"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-894"></a><span>      </span><a href="CmmMachOp.html#MO_U_Ge"><span class="hs-identifier hs-var">MO_U_Ge</span></a><span> </span><a name="local-6989586621684792468"><a href="#local-6989586621684792468"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span> </span><a href="#local-6989586621684792468"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-895"></a><span>      </span><a href="CmmMachOp.html#MO_U_Lt"><span class="hs-identifier hs-var">MO_U_Lt</span></a><span> </span><a name="local-6989586621684792469"><a href="#local-6989586621684792469"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#LU"><span class="hs-identifier hs-var">LU</span></a><span>  </span><a href="#local-6989586621684792469"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-896"></a><span>      </span><a href="CmmMachOp.html#MO_U_Le"><span class="hs-identifier hs-var">MO_U_Le</span></a><span> </span><a name="local-6989586621684792470"><a href="#local-6989586621684792470"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="PPC.Cond.html#LEU"><span class="hs-identifier hs-var">LEU</span></a><span> </span><a href="#local-6989586621684792470"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792459"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792460"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-897"></a><span>
</span><a name="line-898"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;getCondCode(powerpc)&quot;</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#pprMachOp"><span class="hs-identifier hs-var">pprMachOp</span></a><span> </span><a href="#local-6989586621684792458"><span class="hs-identifier hs-var">mop</span></a><span class="hs-special">)</span><span>
</span><a name="line-899"></a><span>
</span><a name="line-900"></a><span class="hs-identifier">getCondCode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;getCondCode(2)(powerpc)&quot;</span><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span>
</span><a name="line-903"></a><span class="hs-comment">-- @cond(Int|Flt)Code@: Turn a boolean expression into a condition, to be</span><span>
</span><a name="line-904"></a><span class="hs-comment">-- passed back up the tree.</span><span>
</span><a name="line-905"></a><span>
</span><a name="line-906"></a><span class="hs-identifier">condIntCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PPC.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span>
</span><a name="line-907"></a><a name="condIntCode"><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier">condIntCode</span></a></a><span> </span><a name="local-6989586621684792471"><a href="#local-6989586621684792471"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684792472"><a href="#local-6989586621684792472"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684792473"><a href="#local-6989586621684792473"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684792474"><a href="#local-6989586621684792474"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-908"></a><span>  </span><a name="local-6989586621684792475"><a href="#local-6989586621684792475"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-909"></a><span>  </span><a href="PPC.CodeGen.html#condIntCode%27"><span class="hs-identifier hs-var">condIntCode'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792475"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792471"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792472"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792473"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792474"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-910"></a><span>
</span><a name="line-911"></a><span class="hs-identifier">condIntCode'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span>
</span><a name="line-912"></a><span>
</span><a name="line-913"></a><span class="hs-comment">-- simple code for 64-bit on 32-bit platforms</span><span>
</span><a name="line-914"></a><a name="condIntCode%27"><a href="PPC.CodeGen.html#condIntCode%27"><span class="hs-identifier">condIntCode'</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a name="local-6989586621684792476"><a href="#local-6989586621684792476"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a name="local-6989586621684792477"><a href="#local-6989586621684792477"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684792478"><a href="#local-6989586621684792478"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-915"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="PPC.Cond.html#condUnsigned"><span class="hs-identifier hs-var">condUnsigned</span></a><span> </span><a href="#local-6989586621684792476"><span class="hs-identifier hs-var">cond</span></a><span>
</span><a name="line-916"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-917"></a><span>      </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792479"><a href="#local-6989586621684792479"><span class="hs-identifier">code_x</span></a></a><span> </span><a name="local-6989586621684792480"><a href="#local-6989586621684792480"><span class="hs-identifier">x_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792477"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-918"></a><span>      </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792481"><a href="#local-6989586621684792481"><span class="hs-identifier">code_y</span></a></a><span> </span><a name="local-6989586621684792482"><a href="#local-6989586621684792482"><span class="hs-identifier">y_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792478"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-919"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792483"><a href="#local-6989586621684792483"><span class="hs-identifier">x_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792480"><span class="hs-identifier hs-var">x_lo</span></a><span>
</span><a name="line-920"></a><span>          </span><a name="local-6989586621684792484"><a href="#local-6989586621684792484"><span class="hs-identifier">y_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792482"><span class="hs-identifier hs-var">y_lo</span></a><span>
</span><a name="line-921"></a><span>      </span><a name="local-6989586621684792485"><a href="#local-6989586621684792485"><span class="hs-identifier">end_lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-922"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792486"><a href="#local-6989586621684792486"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792479"><span class="hs-identifier hs-var">code_x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792481"><span class="hs-identifier hs-var">code_y</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-923"></a><span>                 </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792483"><span class="hs-identifier hs-var">x_hi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792484"><span class="hs-identifier hs-var">y_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-924"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684792485"><span class="hs-identifier hs-var">end_lbl</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-925"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792480"><span class="hs-identifier hs-var">x_lo</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792482"><span class="hs-identifier hs-var">y_lo</span></a><span class="hs-special">)</span><span>
</span><a name="line-926"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792485"><span class="hs-identifier hs-var">end_lbl</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-927"></a><span>
</span><a name="line-928"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792485"><span class="hs-identifier hs-var">end_lbl</span></a><span>
</span><a name="line-929"></a><span>                 </span><span class="hs-special">]</span><span>
</span><a name="line-930"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792476"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792486"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-932"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-933"></a><span>      </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792487"><a href="#local-6989586621684792487"><span class="hs-identifier">code_x</span></a></a><span> </span><a name="local-6989586621684792488"><a href="#local-6989586621684792488"><span class="hs-identifier">x_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792477"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-934"></a><span>      </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792489"><a href="#local-6989586621684792489"><span class="hs-identifier">code_y</span></a></a><span> </span><a name="local-6989586621684792490"><a href="#local-6989586621684792490"><span class="hs-identifier">y_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792478"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-935"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792491"><a href="#local-6989586621684792491"><span class="hs-identifier">x_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792488"><span class="hs-identifier hs-var">x_lo</span></a><span>
</span><a name="line-936"></a><span>          </span><a name="local-6989586621684792492"><a href="#local-6989586621684792492"><span class="hs-identifier">y_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792490"><span class="hs-identifier hs-var">y_lo</span></a><span>
</span><a name="line-937"></a><span>      </span><a name="local-6989586621684792493"><a href="#local-6989586621684792493"><span class="hs-identifier">end_lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-938"></a><span>      </span><a name="local-6989586621684792494"><a href="#local-6989586621684792494"><span class="hs-identifier">cmp_lo</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-939"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792495"><a href="#local-6989586621684792495"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792487"><span class="hs-identifier hs-var">code_x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792489"><span class="hs-identifier hs-var">code_y</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-940"></a><span>                 </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792491"><span class="hs-identifier hs-var">x_hi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792492"><span class="hs-identifier hs-var">y_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-941"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684792493"><span class="hs-identifier hs-var">end_lbl</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-942"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792491"><span class="hs-identifier hs-var">x_hi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-943"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span> </span><a href="#local-6989586621684792494"><span class="hs-identifier hs-var">cmp_lo</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-944"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792488"><span class="hs-identifier hs-var">x_lo</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792490"><span class="hs-identifier hs-var">y_lo</span></a><span class="hs-special">)</span><span>
</span><a name="line-945"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792493"><span class="hs-identifier hs-var">end_lbl</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-946"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792490"><span class="hs-identifier hs-var">y_lo</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792488"><span class="hs-identifier hs-var">x_lo</span></a><span class="hs-special">)</span><span>
</span><a name="line-947"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792493"><span class="hs-identifier hs-var">end_lbl</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-948"></a><span>
</span><a name="line-949"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792493"><span class="hs-identifier hs-var">end_lbl</span></a><span>
</span><a name="line-950"></a><span>                 </span><span class="hs-special">]</span><span>
</span><a name="line-951"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792476"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792495"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-952"></a><span>
</span><a name="line-953"></a><span class="hs-comment">-- optimize pointer tag checks. Operation andi. sets condition register</span><span>
</span><a name="line-954"></a><span class="hs-comment">-- so cmpi ..., 0 is redundant.</span><span>
</span><a name="line-955"></a><span class="hs-identifier">condIntCode'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792496"><a href="#local-6989586621684792496"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_And"><span class="hs-identifier hs-var">MO_And</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792497"><a href="#local-6989586621684792497"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792498"><a href="#local-6989586621684792498"><span class="hs-identifier">imm</span></a></a><span> </span><a name="local-6989586621684792499"><a href="#local-6989586621684792499"><span class="hs-identifier">rep</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-956"></a><span>                 </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-957"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Cond.html#condUnsigned"><span class="hs-identifier hs-var">condUnsigned</span></a><span> </span><a href="#local-6989586621684792496"><span class="hs-identifier hs-var">cond</span></a><span class="hs-special">,</span><span>
</span><a name="line-958"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792500"><a href="#local-6989586621684792500"><span class="hs-identifier">src2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684792499"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792498"><span class="hs-identifier hs-var">imm</span></a><span>
</span><a name="line-959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-960"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684792501"><a href="#local-6989586621684792501"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792502"><a href="#local-6989586621684792502"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792497"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-961"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792503"><a href="#local-6989586621684792503"><span class="hs-identifier">code'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792502"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><a href="PPC.Regs.html#r0"><span class="hs-identifier hs-var">r0</span></a><span> </span><a href="#local-6989586621684792501"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684792500"><span class="hs-identifier hs-var">src2</span></a><span class="hs-special">)</span><span>
</span><a name="line-962"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792496"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792503"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span class="hs-identifier">condIntCode'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792504"><a href="#local-6989586621684792504"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684792505"><a href="#local-6989586621684792505"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684792506"><a href="#local-6989586621684792506"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792507"><a href="#local-6989586621684792507"><span class="hs-identifier">y</span></a></a><span> </span><a name="local-6989586621684792508"><a href="#local-6989586621684792508"><span class="hs-identifier">rep</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-965"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792509"><a href="#local-6989586621684792509"><span class="hs-identifier">src2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684792508"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Cond.html#condUnsigned"><span class="hs-identifier hs-var">condUnsigned</span></a><span> </span><a href="#local-6989586621684792504"><span class="hs-identifier hs-var">cond</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792507"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-966"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-967"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792510"><a href="#local-6989586621684792510"><span class="hs-identifier">op_len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684792505"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-968"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792511"><a href="#local-6989586621684792511"><span class="hs-identifier">extend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#extendSExpr"><span class="hs-identifier hs-var">extendSExpr</span></a><span> </span><a href="#local-6989586621684792505"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792510"><span class="hs-identifier hs-var">op_len</span></a><span>
</span><a name="line-969"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684792512"><a href="#local-6989586621684792512"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792513"><a href="#local-6989586621684792513"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792511"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684792506"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-970"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792514"><a href="#local-6989586621684792514"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792510"><span class="hs-identifier hs-var">op_len</span></a><span>
</span><a name="line-971"></a><span>          </span><a name="local-6989586621684792515"><a href="#local-6989586621684792515"><span class="hs-identifier">code'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792513"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-972"></a><span>            </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="PPC.Cond.html#condUnsigned"><span class="hs-identifier hs-var">condUnsigned</span></a><span> </span><a href="#local-6989586621684792504"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PPC.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792514"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792512"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684792509"><span class="hs-identifier hs-var">src2</span></a><span class="hs-special">)</span><span>
</span><a name="line-973"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792504"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792515"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-974"></a><span>
</span><a name="line-975"></a><span class="hs-identifier">condIntCode'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792516"><a href="#local-6989586621684792516"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684792517"><a href="#local-6989586621684792517"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684792518"><a href="#local-6989586621684792518"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684792519"><a href="#local-6989586621684792519"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-976"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792520"><a href="#local-6989586621684792520"><span class="hs-identifier">op_len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684792517"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-977"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792521"><a href="#local-6989586621684792521"><span class="hs-identifier">extend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="PPC.Cond.html#condUnsigned"><span class="hs-identifier hs-var">condUnsigned</span></a><span> </span><a href="#local-6989586621684792516"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PPC.CodeGen.html#extendUExpr"><span class="hs-identifier hs-var">extendUExpr</span></a><span> </span><a href="#local-6989586621684792517"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792520"><span class="hs-identifier hs-var">op_len</span></a><span>
</span><a name="line-978"></a><span>               </span><span class="hs-keyword">else</span><span> </span><a href="PPC.CodeGen.html#extendSExpr"><span class="hs-identifier hs-var">extendSExpr</span></a><span> </span><a href="#local-6989586621684792517"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792520"><span class="hs-identifier hs-var">op_len</span></a><span>
</span><a name="line-979"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684792522"><a href="#local-6989586621684792522"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792523"><a href="#local-6989586621684792523"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792521"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684792518"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-980"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684792524"><a href="#local-6989586621684792524"><span class="hs-identifier">src2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792525"><a href="#local-6989586621684792525"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792521"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684792519"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-981"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792526"><a href="#local-6989586621684792526"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792520"><span class="hs-identifier hs-var">op_len</span></a><span>
</span><a name="line-982"></a><span>      </span><a name="local-6989586621684792527"><a href="#local-6989586621684792527"><span class="hs-identifier">code'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792523"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792525"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-983"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="PPC.Cond.html#condUnsigned"><span class="hs-identifier hs-var">condUnsigned</span></a><span> </span><a href="#local-6989586621684792516"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PPC.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792526"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792522"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792524"><span class="hs-identifier hs-var">src2</span></a><span class="hs-special">)</span><span>
</span><a name="line-984"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792516"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792527"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-985"></a><span>
</span><a name="line-986"></a><span class="hs-identifier">condFltCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PPC.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span>
</span><a name="line-987"></a><a name="condFltCode"><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier">condFltCode</span></a></a><span> </span><a name="local-6989586621684792528"><a href="#local-6989586621684792528"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684792529"><a href="#local-6989586621684792529"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684792530"><a href="#local-6989586621684792530"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-988"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792531"><a href="#local-6989586621684792531"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792532"><a href="#local-6989586621684792532"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792529"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-989"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792533"><a href="#local-6989586621684792533"><span class="hs-identifier">src2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792534"><a href="#local-6989586621684792534"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792530"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-990"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-991"></a><span>        </span><a name="local-6989586621684792535"><a href="#local-6989586621684792535"><span class="hs-identifier">code'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792532"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792534"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#FCMP"><span class="hs-identifier hs-var">FCMP</span></a><span> </span><a href="#local-6989586621684792531"><span class="hs-identifier hs-var">src1</span></a><span> </span><a href="#local-6989586621684792533"><span class="hs-identifier hs-var">src2</span></a><span>
</span><a name="line-992"></a><span>        </span><a name="local-6989586621684792536"><a href="#local-6989586621684792536"><span class="hs-identifier">code''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792528"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- twiddle CR to handle unordered case</span><span>
</span><a name="line-993"></a><span>                    </span><a href="PPC.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792535"><span class="hs-identifier hs-var">code'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#CRNOR"><span class="hs-identifier hs-var">CRNOR</span></a><span> </span><a href="#local-6989586621684792537"><span class="hs-identifier hs-var">ltbit</span></a><span> </span><a href="#local-6989586621684792538"><span class="hs-identifier hs-var">eqbit</span></a><span> </span><a href="#local-6989586621684792539"><span class="hs-identifier hs-var">gtbit</span></a><span>
</span><a name="line-994"></a><span>                    </span><a href="PPC.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792535"><span class="hs-identifier hs-var">code'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#CRNOR"><span class="hs-identifier hs-var">CRNOR</span></a><span> </span><a href="#local-6989586621684792539"><span class="hs-identifier hs-var">gtbit</span></a><span> </span><a href="#local-6989586621684792538"><span class="hs-identifier hs-var">eqbit</span></a><span> </span><a href="#local-6989586621684792537"><span class="hs-identifier hs-var">ltbit</span></a><span>
</span><a name="line-995"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792535"><span class="hs-identifier hs-var">code'</span></a><span>
</span><a name="line-996"></a><span>                 </span><span class="hs-keyword">where</span><span>
</span><a name="line-997"></a><span>                    </span><a name="local-6989586621684792537"><a href="#local-6989586621684792537"><span class="hs-identifier">ltbit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621684792538"><a href="#local-6989586621684792538"><span class="hs-identifier">eqbit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621684792539"><a href="#local-6989586621684792539"><span class="hs-identifier">gtbit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-998"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792528"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792536"><span class="hs-identifier hs-var">code''</span></a><span class="hs-special">)</span><span>
</span><a name="line-999"></a><span>
</span><a name="line-1000"></a><span>
</span><a name="line-1001"></a><span>
</span><a name="line-1002"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1003"></a><span class="hs-comment">-- Generating assignments</span><span>
</span><a name="line-1004"></a><span>
</span><a name="line-1005"></a><span class="hs-comment">-- Assignments are really at the heart of the whole code generation</span><span>
</span><a name="line-1006"></a><span class="hs-comment">-- business.  Almost all top-level nodes of any real importance are</span><span>
</span><a name="line-1007"></a><span class="hs-comment">-- assignments, which correspond to loads, stores, or register</span><span>
</span><a name="line-1008"></a><span class="hs-comment">-- transfers.  If we're really lucky, some of the register transfers</span><span>
</span><a name="line-1009"></a><span class="hs-comment">-- will go away, because we can use the destination register to</span><span>
</span><a name="line-1010"></a><span class="hs-comment">-- complete the code generation for the right hand side.  This only</span><span>
</span><a name="line-1011"></a><span class="hs-comment">-- fails when the right hand side is forced into a fixed register</span><span>
</span><a name="line-1012"></a><span class="hs-comment">-- (e.g. the result of a call).</span><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span class="hs-identifier">assignMem_IntCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1015"></a><span class="hs-identifier">assignReg_IntCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1016"></a><span>
</span><a name="line-1017"></a><span class="hs-identifier">assignMem_FltCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1018"></a><span class="hs-identifier">assignReg_FltCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1019"></a><span>
</span><a name="line-1020"></a><a name="assignMem_IntCode"><a href="PPC.CodeGen.html#assignMem_IntCode"><span class="hs-identifier">assignMem_IntCode</span></a></a><span> </span><a name="local-6989586621684792540"><a href="#local-6989586621684792540"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684792541"><a href="#local-6989586621684792541"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684792542"><a href="#local-6989586621684792542"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1021"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792543"><a href="#local-6989586621684792543"><span class="hs-identifier">srcReg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792544"><a href="#local-6989586621684792544"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792542"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1022"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792545"><a href="#local-6989586621684792545"><span class="hs-identifier">dstAddr</span></a></a><span> </span><a name="local-6989586621684792546"><a href="#local-6989586621684792546"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792540"><span class="hs-identifier hs-var">pk</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1023"></a><span>                                </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#DS"><span class="hs-identifier hs-var">DS</span></a><span> </span><a href="#local-6989586621684792541"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1024"></a><span>                                </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span>  </span><a href="#local-6989586621684792541"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1025"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792544"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792546"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621684792540"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-6989586621684792543"><span class="hs-identifier hs-var">srcReg</span></a><span> </span><a href="#local-6989586621684792545"><span class="hs-identifier hs-var">dstAddr</span></a><span>
</span><a name="line-1026"></a><span>
</span><a name="line-1027"></a><span class="hs-comment">-- dst is a reg, but src could be anything</span><span>
</span><a name="line-1028"></a><a name="assignReg_IntCode"><a href="PPC.CodeGen.html#assignReg_IntCode"><span class="hs-identifier">assignReg_IntCode</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792547"><a href="#local-6989586621684792547"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684792548"><a href="#local-6989586621684792548"><span class="hs-identifier">src</span></a></a><span>
</span><a name="line-1029"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1030"></a><span>        </span><a name="local-6989586621684792549"><a href="#local-6989586621684792549"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1031"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792550"><a href="#local-6989586621684792550"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792549"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792547"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-1032"></a><span>        </span><a name="local-6989586621684792551"><a href="#local-6989586621684792551"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684792548"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1033"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792551"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1034"></a><span>            </span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792552"><a href="#local-6989586621684792552"><span class="hs-identifier">code</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792552"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684792550"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1035"></a><span>            </span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792553"><a href="#local-6989586621684792553"><span class="hs-identifier">freg</span></a></a><span> </span><a name="local-6989586621684792554"><a href="#local-6989586621684792554"><span class="hs-identifier">fcode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792554"><span class="hs-identifier hs-var">fcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792550"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792553"><span class="hs-identifier hs-var">freg</span></a><span>
</span><a name="line-1036"></a><span>
</span><a name="line-1037"></a><span>
</span><a name="line-1038"></a><span>
</span><a name="line-1039"></a><span class="hs-comment">-- Easy, isn't it?</span><span>
</span><a name="line-1040"></a><a name="assignMem_FltCode"><a href="PPC.CodeGen.html#assignMem_FltCode"><span class="hs-identifier">assignMem_FltCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var">assignMem_IntCode</span></a><span>
</span><a name="line-1041"></a><a name="assignReg_FltCode"><a href="PPC.CodeGen.html#assignReg_FltCode"><span class="hs-identifier">assignReg_FltCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#assignReg_IntCode"><span class="hs-identifier hs-var">assignReg_IntCode</span></a><span>
</span><a name="line-1042"></a><span>
</span><a name="line-1043"></a><span>
</span><a name="line-1044"></a><span>
</span><a name="line-1045"></a><span class="hs-identifier">genJump</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-comment">{-the branch target-}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1046"></a><span>
</span><a name="line-1047"></a><a name="genJump"><a href="PPC.CodeGen.html#genJump"><span class="hs-identifier">genJump</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684792555"><a href="#local-6989586621684792555"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1048"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a><span> </span><a href="#local-6989586621684792555"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1049"></a><span>
</span><a name="line-1050"></a><span class="hs-identifier">genJump</span><span> </span><a name="local-6989586621684792556"><a href="#local-6989586621684792556"><span class="hs-identifier">tree</span></a></a><span>
</span><a name="line-1051"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1052"></a><span>        </span><a name="local-6989586621684792557"><a href="#local-6989586621684792557"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1053"></a><span>        </span><a href="PPC.CodeGen.html#genJump%27"><span class="hs-identifier hs-var">genJump'</span></a><span> </span><a href="#local-6989586621684792556"><span class="hs-identifier hs-var">tree</span></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#platformToGCP"><span class="hs-identifier hs-var">platformToGCP</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792557"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1054"></a><span>
</span><a name="line-1055"></a><span class="hs-identifier">genJump'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#GenCCallPlatform"><span class="hs-identifier hs-type">GenCCallPlatform</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><a name="genJump%27"><a href="PPC.CodeGen.html#genJump%27"><span class="hs-identifier">genJump'</span></a></a><span> </span><a name="local-6989586621684792558"><a href="#local-6989586621684792558"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1058"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1059"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792559"><a href="#local-6989586621684792559"><span class="hs-identifier">target</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792560"><a href="#local-6989586621684792560"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792558"><span class="hs-identifier hs-var">tree</span></a><span>
</span><a name="line-1060"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792560"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1061"></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792559"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1062"></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792559"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1063"></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span>
</span><a name="line-1064"></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792559"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1065"></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BCTR"><span class="hs-identifier hs-var">BCTR</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1066"></a><span>
</span><a name="line-1067"></a><span class="hs-identifier">genJump'</span><span> </span><a name="local-6989586621684792561"><a href="#local-6989586621684792561"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-1068"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1069"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792562"><a href="#local-6989586621684792562"><span class="hs-identifier">target</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792563"><a href="#local-6989586621684792563"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792561"><span class="hs-identifier hs-var">tree</span></a><span>
</span><a name="line-1070"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792563"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1071"></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="PPC.Regs.html#r12"><span class="hs-identifier hs-var">r12</span></a><span> </span><a href="#local-6989586621684792562"><span class="hs-identifier hs-var">target</span></a><span>
</span><a name="line-1072"></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="PPC.Regs.html#r12"><span class="hs-identifier hs-var">r12</span></a><span>
</span><a name="line-1073"></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BCTR"><span class="hs-identifier hs-var">BCTR</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1074"></a><span>
</span><a name="line-1075"></a><span class="hs-identifier">genJump'</span><span> </span><a name="local-6989586621684792564"><a href="#local-6989586621684792564"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1076"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1077"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792565"><a href="#local-6989586621684792565"><span class="hs-identifier">target</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792566"><a href="#local-6989586621684792566"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792564"><span class="hs-identifier hs-var">tree</span></a><span>
</span><a name="line-1078"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792566"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="#local-6989586621684792565"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BCTR"><span class="hs-identifier hs-var">BCTR</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1079"></a><span>
</span><a name="line-1080"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1081"></a><span class="hs-comment">--  Unconditional branches</span><span>
</span><a name="line-1082"></a><span class="hs-identifier">genBranch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1083"></a><a name="genBranch"><a href="PPC.CodeGen.html#genBranch"><span class="hs-identifier">genBranch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Instruction.html#mkJumpInstr"><span class="hs-identifier hs-var">mkJumpInstr</span></a><span>
</span><a name="line-1084"></a><span>
</span><a name="line-1085"></a><span>
</span><a name="line-1086"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1087"></a><span class="hs-comment">--  Conditional jumps</span><span>
</span><a name="line-1088"></a><span>
</span><a name="line-1089"></a><span class="hs-comment">{-
Conditional jumps are always to local labels, so we can use branch
instructions.  We peek at the arguments to decide what kind of
comparison to do.
-}</span><span>
</span><a name="line-1094"></a><span>
</span><a name="line-1095"></a><span>
</span><a name="line-1096"></a><span class="hs-identifier">genCondJump</span><span>
</span><a name="line-1097"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span>      </span><span class="hs-comment">-- the branch target</span><span>
</span><a name="line-1098"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>      </span><span class="hs-comment">-- the condition on which to branch</span><span>
</span><a name="line-1099"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1100"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1101"></a><span>
</span><a name="line-1102"></a><a name="genCondJump"><a href="PPC.CodeGen.html#genCondJump"><span class="hs-identifier">genCondJump</span></a></a><span> </span><a name="local-6989586621684792567"><a href="#local-6989586621684792567"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621684792568"><a href="#local-6989586621684792568"><span class="hs-identifier">bool</span></a></a><span> </span><a name="local-6989586621684792569"><a href="#local-6989586621684792569"><span class="hs-identifier">prediction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1103"></a><span>  </span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792570"><a href="#local-6989586621684792570"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684792571"><a href="#local-6989586621684792571"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getCondCode"><span class="hs-identifier hs-var">getCondCode</span></a><span> </span><a href="#local-6989586621684792568"><span class="hs-identifier hs-var">bool</span></a><span>
</span><a name="line-1104"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792571"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="#local-6989586621684792570"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792567"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684792569"><span class="hs-identifier hs-var">prediction</span></a><span class="hs-special">)</span><span>
</span><a name="line-1105"></a><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><span>
</span><a name="line-1108"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1109"></a><span class="hs-comment">--  Generating C calls</span><span>
</span><a name="line-1110"></a><span>
</span><a name="line-1111"></a><span class="hs-comment">-- Now the biggest nightmare---calls.  Most of the nastiness is buried in</span><span>
</span><a name="line-1112"></a><span class="hs-comment">-- @get_arg@, which moves the arguments to the correct registers/stack</span><span>
</span><a name="line-1113"></a><span class="hs-comment">-- locations.  Apart from that, the code is easy.</span><span>
</span><a name="line-1114"></a><span>
</span><a name="line-1115"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>      </span><span class="hs-comment">-- function to call</span><span>
</span><a name="line-1116"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- where to put the result</span><span>
</span><a name="line-1117"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- arguments (of mixed type)</span><span>
</span><a name="line-1118"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1119"></a><a name="genCCall"><a href="PPC.CodeGen.html#genCCall"><span class="hs-identifier">genCCall</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_WriteBarrier"><span class="hs-identifier hs-var">MO_WriteBarrier</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1120"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="PPC.Instr.html#LWSYNC"><span class="hs-identifier hs-var">LWSYNC</span></a><span>
</span><a name="line-1121"></a><span>
</span><a name="line-1122"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_Touch"><span class="hs-identifier hs-var">MO_Touch</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1123"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1124"></a><span>
</span><a name="line-1125"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-var">MO_Prefetch_Data</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1126"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1127"></a><span>
</span><a name="line-1128"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-var">MO_AtomicRMW</span></a><span> </span><a name="local-6989586621684792572"><a href="#local-6989586621684792572"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684792573"><a href="#local-6989586621684792573"><span class="hs-identifier">amop</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792574"><a href="#local-6989586621684792574"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792575"><a href="#local-6989586621684792575"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792576"><a href="#local-6989586621684792576"><span class="hs-identifier">n</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1129"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792595"><a href="#local-6989586621684792595"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1130"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792596"><a href="#local-6989586621684792596"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792595"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1131"></a><span>          </span><a name="local-6989586621684792597"><a href="#local-6989586621684792597"><span class="hs-identifier">fmt</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792572"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1132"></a><span>          </span><a name="local-6989586621684792598"><a href="#local-6989586621684792598"><span class="hs-identifier">reg_dst</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792596"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792574"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1133"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684792605"><a href="#local-6989586621684792605"><span class="hs-identifier">instr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792606"><a href="#local-6989586621684792606"><span class="hs-identifier">n_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792573"><span class="hs-identifier hs-var">amop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1134"></a><span>            </span><a href="CmmMachOp.html#AMO_Add"><span class="hs-identifier hs-var">AMO_Add</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792578"><span class="hs-identifier hs-var">getSomeRegOrImm</span></a><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span>
</span><a name="line-1135"></a><span>            </span><a href="CmmMachOp.html#AMO_Sub"><span class="hs-identifier hs-var">AMO_Sub</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792576"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1136"></a><span>                </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792599"><a href="#local-6989586621684792599"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1137"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792600"><a href="#local-6989586621684792600"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684792572"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684792599"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-1138"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684792600"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1139"></a><span>                </span><span class="hs-identifier">_</span><span>
</span><a name="line-1140"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1141"></a><span>                         </span><span class="hs-special">(</span><a name="local-6989586621684792601"><a href="#local-6989586621684792601"><span class="hs-identifier">n_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792602"><a href="#local-6989586621684792602"><span class="hs-identifier">n_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792576"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1142"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span>  </span><span class="hs-special">(</span><a href="PPC.Instr.html#SUBF"><span class="hs-identifier hs-var">SUBF</span></a><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792601"><span class="hs-identifier hs-var">n_reg</span></a><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792602"><span class="hs-identifier hs-var">n_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1143"></a><span>            </span><a href="CmmMachOp.html#AMO_And"><span class="hs-identifier hs-var">AMO_And</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792578"><span class="hs-identifier hs-var">getSomeRegOrImm</span></a><span> </span><a href="PPC.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span>
</span><a name="line-1144"></a><span>            </span><a href="CmmMachOp.html#AMO_Nand"><span class="hs-identifier hs-var">AMO_Nand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684792603"><a href="#local-6989586621684792603"><span class="hs-identifier">n_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792604"><a href="#local-6989586621684792604"><span class="hs-identifier">n_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792576"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1145"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#NAND"><span class="hs-identifier hs-var">NAND</span></a><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792603"><span class="hs-identifier hs-var">n_reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792604"><span class="hs-identifier hs-var">n_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1146"></a><span>            </span><a href="CmmMachOp.html#AMO_Or"><span class="hs-identifier hs-var">AMO_Or</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792578"><span class="hs-identifier hs-var">getSomeRegOrImm</span></a><span> </span><a href="PPC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span>
</span><a name="line-1147"></a><span>            </span><a href="CmmMachOp.html#AMO_Xor"><span class="hs-identifier hs-var">AMO_Xor</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792578"><span class="hs-identifier hs-var">getSomeRegOrImm</span></a><span> </span><a href="PPC.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span>
</span><a name="line-1148"></a><span>      </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792607"><a href="#local-6989586621684792607"><span class="hs-identifier">addr_reg</span></a></a><span> </span><a name="local-6989586621684792608"><a href="#local-6989586621684792608"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684792577"><span class="hs-identifier hs-var">getAmodeIndex</span></a><span> </span><a href="#local-6989586621684792575"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1149"></a><span>      </span><a name="local-6989586621684792609"><a href="#local-6989586621684792609"><span class="hs-identifier">lbl_retry</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1150"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792606"><span class="hs-identifier hs-var">n_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792608"><span class="hs-identifier hs-var">addr_code</span></a><span>
</span><a name="line-1151"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#HWSYNC"><span class="hs-identifier hs-var">HWSYNC</span></a><span>
</span><a name="line-1152"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792609"><span class="hs-identifier hs-var">lbl_retry</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1153"></a><span>
</span><a name="line-1154"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792609"><span class="hs-identifier hs-var">lbl_retry</span></a><span>
</span><a name="line-1155"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#LDR"><span class="hs-identifier hs-var">LDR</span></a><span> </span><a href="#local-6989586621684792597"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792607"><span class="hs-identifier hs-var">addr_reg</span></a><span>
</span><a name="line-1156"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792605"><span class="hs-identifier hs-var">instr</span></a><span>
</span><a name="line-1157"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#STC"><span class="hs-identifier hs-var">STC</span></a><span> </span><a href="#local-6989586621684792597"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792598"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792607"><span class="hs-identifier hs-var">addr_reg</span></a><span>
</span><a name="line-1158"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684792609"><span class="hs-identifier hs-var">lbl_retry</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1159"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ISYNC"><span class="hs-identifier hs-var">ISYNC</span></a><span>
</span><a name="line-1160"></a><span>                     </span><span class="hs-special">]</span><span>
</span><a name="line-1161"></a><span>         </span><span class="hs-keyword">where</span><span>
</span><a name="line-1162"></a><span>           </span><a name="local-6989586621684792577"><a href="#local-6989586621684792577"><span class="hs-identifier">getAmodeIndex</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792579"><a href="#local-6989586621684792579"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792580"><a href="#local-6989586621684792580"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1163"></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1164"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621684792581"><a href="#local-6989586621684792581"><span class="hs-identifier">regX</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792582"><a href="#local-6989586621684792582"><span class="hs-identifier">codeX</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792579"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1165"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621684792583"><a href="#local-6989586621684792583"><span class="hs-identifier">regY</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792584"><a href="#local-6989586621684792584"><span class="hs-identifier">codeY</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792580"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1166"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegReg"><span class="hs-identifier hs-var">AddrRegReg</span></a><span> </span><a href="#local-6989586621684792581"><span class="hs-identifier hs-var">regX</span></a><span> </span><a href="#local-6989586621684792583"><span class="hs-identifier hs-var">regY</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792582"><span class="hs-identifier hs-var">codeX</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792584"><span class="hs-identifier hs-var">codeY</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1167"></a><span>           </span><span class="hs-identifier">getAmodeIndex</span><span> </span><a name="local-6989586621684792585"><a href="#local-6989586621684792585"><span class="hs-identifier">other</span></a></a><span>
</span><a name="line-1168"></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1169"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621684792586"><a href="#local-6989586621684792586"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792587"><a href="#local-6989586621684792587"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792585"><span class="hs-identifier hs-var">other</span></a><span>
</span><a name="line-1170"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegReg"><span class="hs-identifier hs-var">AddrRegReg</span></a><span> </span><a href="PPC.Regs.html#r0"><span class="hs-identifier hs-var">r0</span></a><span> </span><a href="#local-6989586621684792586"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792587"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NB: r0 is 0 here!</span><span>
</span><a name="line-1171"></a><span>           </span><a name="local-6989586621684792578"><a href="#local-6989586621684792578"><span class="hs-identifier">getSomeRegOrImm</span></a></a><span> </span><a name="local-6989586621684792588"><a href="#local-6989586621684792588"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684792589"><a href="#local-6989586621684792589"><span class="hs-identifier">sign</span></a></a><span> </span><a name="local-6989586621684792590"><a href="#local-6989586621684792590"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-1172"></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792576"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1173"></a><span>                 </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792591"><a href="#local-6989586621684792591"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792592"><a href="#local-6989586621684792592"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684792572"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792589"><span class="hs-identifier hs-var">sign</span></a><span> </span><a href="#local-6989586621684792591"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1174"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792588"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684792590"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792590"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684792592"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>                 </span><span class="hs-identifier">_</span><span>
</span><a name="line-1176"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1177"></a><span>                          </span><span class="hs-special">(</span><a name="local-6989586621684792593"><a href="#local-6989586621684792593"><span class="hs-identifier">n_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792594"><a href="#local-6989586621684792594"><span class="hs-identifier">n_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792576"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1178"></a><span>                          </span><span class="hs-identifier hs-var">return</span><span>  </span><span class="hs-special">(</span><a href="#local-6989586621684792588"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684792590"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792590"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792593"><span class="hs-identifier hs-var">n_reg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792594"><span class="hs-identifier hs-var">n_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1179"></a><span>
</span><a name="line-1180"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicRead"><span class="hs-identifier hs-var">MO_AtomicRead</span></a><span> </span><a name="local-6989586621684792610"><a href="#local-6989586621684792610"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792611"><a href="#local-6989586621684792611"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792612"><a href="#local-6989586621684792612"><span class="hs-identifier">addr</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1181"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792613"><a href="#local-6989586621684792613"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1182"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792614"><a href="#local-6989586621684792614"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792613"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1183"></a><span>          </span><a name="local-6989586621684792615"><a href="#local-6989586621684792615"><span class="hs-identifier">fmt</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792610"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1184"></a><span>          </span><a name="local-6989586621684792616"><a href="#local-6989586621684792616"><span class="hs-identifier">reg_dst</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792614"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792611"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1185"></a><span>          </span><a name="local-6989586621684792617"><a href="#local-6989586621684792617"><span class="hs-identifier">form</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621684792610"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">64</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="PPC.CodeGen.html#DS"><span class="hs-identifier hs-var">DS</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span>
</span><a name="line-1186"></a><span>      </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684792618"><a href="#local-6989586621684792618"><span class="hs-identifier">addr_reg</span></a></a><span> </span><a name="local-6989586621684792619"><a href="#local-6989586621684792619"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684792617"><span class="hs-identifier hs-var">form</span></a><span> </span><a href="#local-6989586621684792612"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1187"></a><span>      </span><a name="local-6989586621684792620"><a href="#local-6989586621684792620"><span class="hs-identifier">lbl_end</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1188"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792619"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#HWSYNC"><span class="hs-identifier hs-var">HWSYNC</span></a><span>
</span><a name="line-1189"></a><span>                                      </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792615"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792616"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792618"><span class="hs-identifier hs-var">addr_reg</span></a><span>
</span><a name="line-1190"></a><span>                                      </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><a href="#local-6989586621684792615"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792616"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792616"><span class="hs-identifier hs-var">reg_dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1191"></a><span>                                      </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684792620"><span class="hs-identifier hs-var">lbl_end</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1192"></a><span>                                      </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792620"><span class="hs-identifier hs-var">lbl_end</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1193"></a><span>                            </span><span class="hs-comment">-- See Note [Seemingly useless cmp and bne]</span><span>
</span><a name="line-1194"></a><span>                                      </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792620"><span class="hs-identifier hs-var">lbl_end</span></a><span>
</span><a name="line-1195"></a><span>                                      </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ISYNC"><span class="hs-identifier hs-var">ISYNC</span></a><span>
</span><a name="line-1196"></a><span>                                      </span><span class="hs-special">]</span><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span class="hs-comment">-- Note [Seemingly useless cmp and bne]</span><span>
</span><a name="line-1199"></a><span class="hs-comment">-- In Power ISA, Book II, Section 4.4.1, Instruction Synchronize Instruction</span><span>
</span><a name="line-1200"></a><span class="hs-comment">-- the second paragraph says that isync may complete before storage accesses</span><span>
</span><a name="line-1201"></a><span class="hs-comment">-- &quot;associated&quot; with a preceding instruction have been performed. The cmp</span><span>
</span><a name="line-1202"></a><span class="hs-comment">-- operation and the following bne introduce a data and control dependency</span><span>
</span><a name="line-1203"></a><span class="hs-comment">-- on the load instruction (See also Power ISA, Book II, Appendix B.2.3, Safe</span><span>
</span><a name="line-1204"></a><span class="hs-comment">-- Fetch).</span><span>
</span><a name="line-1205"></a><span class="hs-comment">-- This is also what gcc does.</span><span>
</span><a name="line-1206"></a><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-var">MO_AtomicWrite</span></a><span> </span><a name="local-6989586621684792621"><a href="#local-6989586621684792621"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792622"><a href="#local-6989586621684792622"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792623"><a href="#local-6989586621684792623"><span class="hs-identifier">val</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1209"></a><span>    </span><a name="local-6989586621684792624"><a href="#local-6989586621684792624"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var">assignMem_IntCode</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792621"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792622"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684792623"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-1210"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span class="hs-special">(</span><a href="PPC.Instr.html#HWSYNC"><span class="hs-identifier hs-var">HWSYNC</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792624"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1211"></a><span>
</span><a name="line-1212"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Clz"><span class="hs-identifier hs-var">MO_Clz</span></a><span> </span><a name="local-6989586621684792625"><a href="#local-6989586621684792625"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792626"><a href="#local-6989586621684792626"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792627"><a href="#local-6989586621684792627"><span class="hs-identifier">src</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1213"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792628"><a href="#local-6989586621684792628"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1214"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792629"><a href="#local-6989586621684792629"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792628"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1215"></a><span>          </span><a name="local-6989586621684792630"><a href="#local-6989586621684792630"><span class="hs-identifier">reg_dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792629"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792626"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1216"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684792629"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684792625"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W64</span><span>
</span><a name="line-1217"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1218"></a><span>          </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792631"><a href="#local-6989586621684792631"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792632"><a href="#local-6989586621684792632"><span class="hs-identifier">vr_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792627"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1219"></a><span>          </span><a name="local-6989586621684792633"><a href="#local-6989586621684792633"><span class="hs-identifier">lbl1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1220"></a><span>          </span><a name="local-6989586621684792634"><a href="#local-6989586621684792634"><span class="hs-identifier">lbl2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1221"></a><span>          </span><a name="local-6989586621684792635"><a href="#local-6989586621684792635"><span class="hs-identifier">lbl3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1222"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792636"><a href="#local-6989586621684792636"><span class="hs-identifier">vr_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792632"><span class="hs-identifier hs-var">vr_lo</span></a><span>
</span><a name="line-1223"></a><span>              </span><a name="local-6989586621684792637"><a href="#local-6989586621684792637"><span class="hs-identifier">cntlz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792636"><span class="hs-identifier hs-var">vr_hi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1224"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684792634"><span class="hs-identifier hs-var">lbl2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1225"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792633"><span class="hs-identifier hs-var">lbl1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1226"></a><span>
</span><a name="line-1227"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792633"><span class="hs-identifier hs-var">lbl1</span></a><span>
</span><a name="line-1228"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CNTLZ"><span class="hs-identifier hs-var">CNTLZ</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792632"><span class="hs-identifier hs-var">vr_lo</span></a><span>
</span><a name="line-1229"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1230"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792635"><span class="hs-identifier hs-var">lbl3</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1231"></a><span>
</span><a name="line-1232"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792634"><span class="hs-identifier hs-var">lbl2</span></a><span>
</span><a name="line-1233"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CNTLZ"><span class="hs-identifier hs-var">CNTLZ</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792636"><span class="hs-identifier hs-var">vr_hi</span></a><span>
</span><a name="line-1234"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792635"><span class="hs-identifier hs-var">lbl3</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1235"></a><span>
</span><a name="line-1236"></a><span>                           </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792635"><span class="hs-identifier hs-var">lbl3</span></a><span>
</span><a name="line-1237"></a><span>                           </span><span class="hs-special">]</span><span>
</span><a name="line-1238"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792631"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792637"><span class="hs-identifier hs-var">cntlz</span></a><span>
</span><a name="line-1239"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1240"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792638"><a href="#local-6989586621684792638"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684792625"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-1241"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621684792639"><a href="#local-6989586621684792639"><span class="hs-identifier">s_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792640"><a href="#local-6989586621684792640"><span class="hs-identifier">s_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792627"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1242"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621684792643"><a href="#local-6989586621684792643"><span class="hs-identifier">pre</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792644"><a href="#local-6989586621684792644"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-special">,</span><span> </span><a name="local-6989586621684792645"><a href="#local-6989586621684792645"><span class="hs-identifier">post</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1243"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792625"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1244"></a><span>              </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792639"><span class="hs-identifier hs-var">s_reg</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1245"></a><span>              </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792639"><span class="hs-identifier hs-var">s_reg</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1246"></a><span>              </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1247"></a><span>                </span><a name="local-6989586621684792641"><a href="#local-6989586621684792641"><span class="hs-identifier">reg_tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792638"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1248"></a><span>                </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-1249"></a><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><a href="#local-6989586621684792641"><span class="hs-identifier hs-var">reg_tmp</span></a><span> </span><a href="#local-6989586621684792639"><span class="hs-identifier hs-var">s_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">65535</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1250"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792641"><span class="hs-identifier hs-var">reg_tmp</span></a><span>
</span><a name="line-1251"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">16</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1252"></a><span>                  </span><span class="hs-special">)</span><span>
</span><a name="line-1253"></a><span>              </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1254"></a><span>                </span><a name="local-6989586621684792642"><a href="#local-6989586621684792642"><span class="hs-identifier">reg_tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792638"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1255"></a><span>                </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-1256"></a><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><a href="#local-6989586621684792642"><span class="hs-identifier hs-var">reg_tmp</span></a><span> </span><a href="#local-6989586621684792639"><span class="hs-identifier hs-var">s_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">255</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1257"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792642"><span class="hs-identifier hs-var">reg_tmp</span></a><span>
</span><a name="line-1258"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">24</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1259"></a><span>                  </span><span class="hs-special">)</span><span>
</span><a name="line-1260"></a><span>              </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCall: Clz wrong format&quot;</span><span>
</span><a name="line-1261"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792646"><a href="#local-6989586621684792646"><span class="hs-identifier">cntlz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#CNTLZ"><span class="hs-identifier hs-var">CNTLZ</span></a><span> </span><a href="#local-6989586621684792638"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792630"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792644"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1262"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792640"><span class="hs-identifier hs-var">s_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792643"><span class="hs-identifier hs-var">pre</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792646"><span class="hs-identifier hs-var">cntlz</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792645"><span class="hs-identifier hs-var">post</span></a><span>
</span><a name="line-1263"></a><span>
</span><a name="line-1264"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Ctz"><span class="hs-identifier hs-var">MO_Ctz</span></a><span> </span><a name="local-6989586621684792647"><a href="#local-6989586621684792647"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792648"><a href="#local-6989586621684792648"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792649"><a href="#local-6989586621684792649"><span class="hs-identifier">src</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1265"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792658"><a href="#local-6989586621684792658"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1266"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792659"><a href="#local-6989586621684792659"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792658"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1267"></a><span>          </span><a name="local-6989586621684792660"><a href="#local-6989586621684792660"><span class="hs-identifier">reg_dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792659"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792648"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1268"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684792659"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684792647"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W64</span><span>
</span><a name="line-1269"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1270"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792661"><a href="#local-6989586621684792661"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-1271"></a><span>          </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792662"><a href="#local-6989586621684792662"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792663"><a href="#local-6989586621684792663"><span class="hs-identifier">vr_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792649"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1272"></a><span>          </span><a name="local-6989586621684792664"><a href="#local-6989586621684792664"><span class="hs-identifier">lbl1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1273"></a><span>          </span><a name="local-6989586621684792665"><a href="#local-6989586621684792665"><span class="hs-identifier">lbl2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1274"></a><span>          </span><a name="local-6989586621684792666"><a href="#local-6989586621684792666"><span class="hs-identifier">lbl3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1275"></a><span>          </span><a name="local-6989586621684792667"><a href="#local-6989586621684792667"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792661"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1276"></a><span>          </span><a name="local-6989586621684792668"><a href="#local-6989586621684792668"><span class="hs-identifier">x''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792661"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1277"></a><span>          </span><a name="local-6989586621684792669"><a href="#local-6989586621684792669"><span class="hs-identifier">r'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792661"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1278"></a><span>          </span><a name="local-6989586621684792670"><a href="#local-6989586621684792670"><span class="hs-identifier">cnttzlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684792650"><span class="hs-identifier hs-var">cnttz</span></a><span> </span><a href="#local-6989586621684792661"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792660"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792663"><span class="hs-identifier hs-var">vr_lo</span></a><span>
</span><a name="line-1279"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792671"><a href="#local-6989586621684792671"><span class="hs-identifier">vr_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792663"><span class="hs-identifier hs-var">vr_lo</span></a><span>
</span><a name="line-1280"></a><span>              </span><a name="local-6989586621684792672"><a href="#local-6989586621684792672"><span class="hs-identifier">cnttz64</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="#local-6989586621684792661"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792663"><span class="hs-identifier hs-var">vr_lo</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1281"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684792665"><span class="hs-identifier hs-var">lbl2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1282"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792664"><span class="hs-identifier hs-var">lbl1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1283"></a><span>
</span><a name="line-1284"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792664"><span class="hs-identifier hs-var">lbl1</span></a><span>
</span><a name="line-1285"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792667"><span class="hs-identifier hs-var">x'</span></a><span> </span><a href="#local-6989586621684792671"><span class="hs-identifier hs-var">vr_hi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1286"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ANDC"><span class="hs-identifier hs-var">ANDC</span></a><span> </span><a href="#local-6989586621684792668"><span class="hs-identifier hs-var">x''</span></a><span> </span><a href="#local-6989586621684792667"><span class="hs-identifier hs-var">x'</span></a><span> </span><a href="#local-6989586621684792671"><span class="hs-identifier hs-var">vr_hi</span></a><span>
</span><a name="line-1287"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CNTLZ"><span class="hs-identifier hs-var">CNTLZ</span></a><span> </span><a href="#local-6989586621684792661"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792669"><span class="hs-identifier hs-var">r'</span></a><span> </span><a href="#local-6989586621684792668"><span class="hs-identifier hs-var">x''</span></a><span>
</span><a name="line-1288"></a><span>                               </span><span class="hs-comment">-- 32 + (32 - clz(x''))</span><span>
</span><a name="line-1289"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBFC"><span class="hs-identifier hs-var">SUBFC</span></a><span> </span><a href="#local-6989586621684792660"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792669"><span class="hs-identifier hs-var">r'</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">64</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1290"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792666"><span class="hs-identifier hs-var">lbl3</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1291"></a><span>
</span><a name="line-1292"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792665"><span class="hs-identifier hs-var">lbl2</span></a><span>
</span><a name="line-1293"></a><span>                             </span><span class="hs-special">]</span><span>
</span><a name="line-1294"></a><span>                        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792670"><span class="hs-identifier hs-var">cnttzlo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1295"></a><span>                        </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792666"><span class="hs-identifier hs-var">lbl3</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1296"></a><span>
</span><a name="line-1297"></a><span>                             </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792666"><span class="hs-identifier hs-var">lbl3</span></a><span>
</span><a name="line-1298"></a><span>                             </span><span class="hs-special">]</span><span>
</span><a name="line-1299"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792662"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792672"><span class="hs-identifier hs-var">cnttz64</span></a><span>
</span><a name="line-1300"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1301"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792673"><a href="#local-6989586621684792673"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684792647"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-1302"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621684792674"><a href="#local-6989586621684792674"><span class="hs-identifier">s_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792675"><a href="#local-6989586621684792675"><span class="hs-identifier">s_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792649"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1303"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621684792678"><a href="#local-6989586621684792678"><span class="hs-identifier">reg_ctz</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792679"><a href="#local-6989586621684792679"><span class="hs-identifier">pre_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1304"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792647"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1305"></a><span>              </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792674"><span class="hs-identifier hs-var">s_reg</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1306"></a><span>              </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792674"><span class="hs-identifier hs-var">s_reg</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1307"></a><span>              </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1308"></a><span>                </span><a name="local-6989586621684792676"><a href="#local-6989586621684792676"><span class="hs-identifier">reg_tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792673"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1309"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792676"><span class="hs-identifier hs-var">reg_tmp</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#ORIS"><span class="hs-identifier hs-var">ORIS</span></a><span> </span><a href="#local-6989586621684792676"><span class="hs-identifier hs-var">reg_tmp</span></a><span> </span><a href="#local-6989586621684792674"><span class="hs-identifier hs-var">s_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1310"></a><span>              </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1311"></a><span>                </span><a name="local-6989586621684792677"><a href="#local-6989586621684792677"><span class="hs-identifier">reg_tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792673"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1312"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792677"><span class="hs-identifier hs-var">reg_tmp</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><a href="#local-6989586621684792677"><span class="hs-identifier hs-var">reg_tmp</span></a><span> </span><a href="#local-6989586621684792674"><span class="hs-identifier hs-var">s_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">256</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1313"></a><span>              </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCall: Ctz wrong format&quot;</span><span>
</span><a name="line-1314"></a><span>          </span><a name="local-6989586621684792680"><a href="#local-6989586621684792680"><span class="hs-identifier">ctz_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684792650"><span class="hs-identifier hs-var">cnttz</span></a><span> </span><a href="#local-6989586621684792673"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792660"><span class="hs-identifier hs-var">reg_dst</span></a><span> </span><a href="#local-6989586621684792678"><span class="hs-identifier hs-var">reg_ctz</span></a><span>
</span><a name="line-1315"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792675"><span class="hs-identifier hs-var">s_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792679"><span class="hs-identifier hs-var">pre_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792680"><span class="hs-identifier hs-var">ctz_code</span></a><span>
</span><a name="line-1316"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-1317"></a><span>          </span><span class="hs-comment">-- cnttz(x) = sizeof(x) - cntlz(~x &amp; (x - 1))</span><span>
</span><a name="line-1318"></a><span>          </span><span class="hs-comment">-- see Henry S. Warren, Hacker's Delight, p 107</span><span>
</span><a name="line-1319"></a><span>          </span><a name="local-6989586621684792650"><a href="#local-6989586621684792650"><span class="hs-identifier">cnttz</span></a></a><span> </span><a name="local-6989586621684792651"><a href="#local-6989586621684792651"><span class="hs-identifier">format</span></a></a><span> </span><a name="local-6989586621684792652"><a href="#local-6989586621684792652"><span class="hs-identifier">dst</span></a></a><span> </span><a name="local-6989586621684792653"><a href="#local-6989586621684792653"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1320"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792654"><a href="#local-6989586621684792654"><span class="hs-identifier">format_bits</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="Format.html#formatInBytes"><span class="hs-identifier hs-var">formatInBytes</span></a><span> </span><a href="#local-6989586621684792651"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1321"></a><span>            </span><a name="local-6989586621684792655"><a href="#local-6989586621684792655"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792651"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1322"></a><span>            </span><a name="local-6989586621684792656"><a href="#local-6989586621684792656"><span class="hs-identifier">x''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792651"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1323"></a><span>            </span><a name="local-6989586621684792657"><a href="#local-6989586621684792657"><span class="hs-identifier">r'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792651"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1324"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792655"><span class="hs-identifier hs-var">x'</span></a><span> </span><a href="#local-6989586621684792653"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1325"></a><span>                          </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ANDC"><span class="hs-identifier hs-var">ANDC</span></a><span> </span><a href="#local-6989586621684792656"><span class="hs-identifier hs-var">x''</span></a><span> </span><a href="#local-6989586621684792655"><span class="hs-identifier hs-var">x'</span></a><span> </span><a href="#local-6989586621684792653"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1326"></a><span>                          </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CNTLZ"><span class="hs-identifier hs-var">CNTLZ</span></a><span> </span><a href="#local-6989586621684792651"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792657"><span class="hs-identifier hs-var">r'</span></a><span> </span><a href="#local-6989586621684792656"><span class="hs-identifier hs-var">x''</span></a><span>
</span><a name="line-1327"></a><span>                          </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBFC"><span class="hs-identifier hs-var">SUBFC</span></a><span> </span><a href="#local-6989586621684792652"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792657"><span class="hs-identifier hs-var">r'</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792654"><span class="hs-identifier hs-var">format_bits</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1328"></a><span>                          </span><span class="hs-special">]</span><span>
</span><a name="line-1329"></a><span>
</span><a name="line-1330"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684792681"><a href="#local-6989586621684792681"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684792682"><a href="#local-6989586621684792682"><span class="hs-identifier">dest_regs</span></a></a><span> </span><a name="local-6989586621684792683"><a href="#local-6989586621684792683"><span class="hs-identifier">argsAndHints</span></a></a><span>
</span><a name="line-1331"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684792800"><a href="#local-6989586621684792800"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1332"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792801"><a href="#local-6989586621684792801"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792800"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1333"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792681"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1334"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_S_QuotRem"><span class="hs-identifier hs-var">MO_S_QuotRem</span></a><span>  </span><a name="local-6989586621684792802"><a href="#local-6989586621684792802"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792684"><span class="hs-identifier hs-var">divOp1</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a href="#local-6989586621684792802"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1335"></a><span>                                                   </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1336"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_QuotRem"><span class="hs-identifier hs-var">MO_U_QuotRem</span></a><span>  </span><a name="local-6989586621684792803"><a href="#local-6989586621684792803"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792684"><span class="hs-identifier hs-var">divOp1</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792803"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1337"></a><span>                                                   </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1338"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_QuotRem2"><span class="hs-identifier hs-var">MO_U_QuotRem2</span></a><span> </span><a name="local-6989586621684792804"><a href="#local-6989586621684792804"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792685"><span class="hs-identifier hs-var">divOp2</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792804"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span>
</span><a name="line-1339"></a><span>                                                   </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1340"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_Mul2"><span class="hs-identifier hs-var">MO_U_Mul2</span></a><span> </span><a name="local-6989586621684792805"><a href="#local-6989586621684792805"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792686"><span class="hs-identifier hs-var">multOp2</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792805"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span>
</span><a name="line-1341"></a><span>                                                </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1342"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add2"><span class="hs-identifier hs-var">MO_Add2</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792687"><span class="hs-identifier hs-var">add2Op</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1343"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AddWordC"><span class="hs-identifier hs-var">MO_AddWordC</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792688"><span class="hs-identifier hs-var">addcOp</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1344"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SubWordC"><span class="hs-identifier hs-var">MO_SubWordC</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792689"><span class="hs-identifier hs-var">subcOp</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1345"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AddIntC"><span class="hs-identifier hs-var">MO_AddIntC</span></a><span> </span><a name="local-6989586621684792806"><a href="#local-6989586621684792806"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792690"><span class="hs-identifier hs-var">addSubCOp</span></a><span> </span><a href="PPC.Instr.html#ADDO"><span class="hs-identifier hs-var">ADDO</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792806"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1346"></a><span>                                                   </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1347"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SubIntC"><span class="hs-identifier hs-var">MO_SubIntC</span></a><span> </span><a name="local-6989586621684792807"><a href="#local-6989586621684792807"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792690"><span class="hs-identifier hs-var">addSubCOp</span></a><span> </span><a href="PPC.Instr.html#SUBFO"><span class="hs-identifier hs-var">SUBFO</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792807"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1348"></a><span>                                                   </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1349"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_F64_Fabs"><span class="hs-identifier hs-var">MO_F64_Fabs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792691"><span class="hs-identifier hs-var">fabs</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1350"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_F32_Fabs"><span class="hs-identifier hs-var">MO_F32_Fabs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792691"><span class="hs-identifier hs-var">fabs</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1351"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#genCCall%27"><span class="hs-identifier hs-var">genCCall'</span></a><span> </span><a href="#local-6989586621684792800"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#platformToGCP"><span class="hs-identifier hs-var">platformToGCP</span></a><span> </span><a href="#local-6989586621684792801"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-1352"></a><span>                       </span><a href="#local-6989586621684792681"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684792682"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684792683"><span class="hs-identifier hs-var">argsAndHints</span></a><span>
</span><a name="line-1353"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792684"><a href="#local-6989586621684792684"><span class="hs-identifier">divOp1</span></a></a><span> </span><a name="local-6989586621684792692"><a href="#local-6989586621684792692"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684792693"><a href="#local-6989586621684792693"><span class="hs-identifier">signed</span></a></a><span> </span><a name="local-6989586621684792694"><a href="#local-6989586621684792694"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792695"><a href="#local-6989586621684792695"><span class="hs-identifier">res_q</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792696"><a href="#local-6989586621684792696"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792697"><a href="#local-6989586621684792697"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792698"><a href="#local-6989586621684792698"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1354"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792699"><a href="#local-6989586621684792699"><span class="hs-identifier">reg_q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792692"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792695"><span class="hs-identifier hs-var">res_q</span></a><span class="hs-special">)</span><span>
</span><a name="line-1355"></a><span>                         </span><a name="local-6989586621684792700"><a href="#local-6989586621684792700"><span class="hs-identifier">reg_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792692"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792696"><span class="hs-identifier hs-var">res_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1356"></a><span>                     </span><a href="PPC.CodeGen.html#remainderCode"><span class="hs-identifier hs-var">remainderCode</span></a><span> </span><a href="#local-6989586621684792694"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792693"><span class="hs-identifier hs-var">signed</span></a><span> </span><a href="#local-6989586621684792699"><span class="hs-identifier hs-var">reg_q</span></a><span> </span><a href="#local-6989586621684792697"><span class="hs-identifier hs-var">arg_x</span></a><span> </span><a href="#local-6989586621684792698"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-1357"></a><span>                       </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621684792700"><span class="hs-identifier hs-var">reg_r</span></a><span>
</span><a name="line-1358"></a><span>
</span><a name="line-1359"></a><span>              </span><span class="hs-identifier">divOp1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1360"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments for divOp1&quot;</span><span>
</span><a name="line-1361"></a><span>              </span><a name="local-6989586621684792685"><a href="#local-6989586621684792685"><span class="hs-identifier">divOp2</span></a></a><span> </span><a name="local-6989586621684792701"><a href="#local-6989586621684792701"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684792702"><a href="#local-6989586621684792702"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792703"><a href="#local-6989586621684792703"><span class="hs-identifier">res_q</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792704"><a href="#local-6989586621684792704"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1362"></a><span>                                    </span><span class="hs-special">[</span><a name="local-6989586621684792705"><a href="#local-6989586621684792705"><span class="hs-identifier">arg_x_high</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792706"><a href="#local-6989586621684792706"><span class="hs-identifier">arg_x_low</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792707"><a href="#local-6989586621684792707"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1363"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792708"><a href="#local-6989586621684792708"><span class="hs-identifier">reg_q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792701"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792703"><span class="hs-identifier hs-var">res_q</span></a><span class="hs-special">)</span><span>
</span><a name="line-1364"></a><span>                         </span><a name="local-6989586621684792709"><a href="#local-6989586621684792709"><span class="hs-identifier">reg_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792701"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792704"><span class="hs-identifier hs-var">res_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1365"></a><span>                         </span><a name="local-6989586621684792710"><a href="#local-6989586621684792710"><span class="hs-identifier">fmt</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792702"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1366"></a><span>                         </span><a name="local-6989586621684792711"><a href="#local-6989586621684792711"><span class="hs-identifier">half</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="Format.html#formatInBytes"><span class="hs-identifier hs-var">formatInBytes</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1367"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792712"><a href="#local-6989586621684792712"><span class="hs-identifier">xh_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792713"><a href="#local-6989586621684792713"><span class="hs-identifier">xh_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792705"><span class="hs-identifier hs-var">arg_x_high</span></a><span>
</span><a name="line-1368"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792714"><a href="#local-6989586621684792714"><span class="hs-identifier">xl_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792715"><a href="#local-6989586621684792715"><span class="hs-identifier">xl_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792706"><span class="hs-identifier hs-var">arg_x_low</span></a><span>
</span><a name="line-1369"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792716"><a href="#local-6989586621684792716"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792717"><a href="#local-6989586621684792717"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792707"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-1370"></a><span>                     </span><a name="local-6989586621684792718"><a href="#local-6989586621684792718"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1371"></a><span>                     </span><a name="local-6989586621684792719"><a href="#local-6989586621684792719"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1372"></a><span>                     </span><a name="local-6989586621684792720"><a href="#local-6989586621684792720"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1373"></a><span>                     </span><a name="local-6989586621684792721"><a href="#local-6989586621684792721"><span class="hs-identifier">vn1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1374"></a><span>                     </span><a name="local-6989586621684792722"><a href="#local-6989586621684792722"><span class="hs-identifier">vn0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1375"></a><span>                     </span><a name="local-6989586621684792723"><a href="#local-6989586621684792723"><span class="hs-identifier">un32</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1376"></a><span>                     </span><a name="local-6989586621684792724"><a href="#local-6989586621684792724"><span class="hs-identifier">tmp</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1377"></a><span>                     </span><a name="local-6989586621684792725"><a href="#local-6989586621684792725"><span class="hs-identifier">un10</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1378"></a><span>                     </span><a name="local-6989586621684792726"><a href="#local-6989586621684792726"><span class="hs-identifier">un1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1379"></a><span>                     </span><a name="local-6989586621684792727"><a href="#local-6989586621684792727"><span class="hs-identifier">un0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1380"></a><span>                     </span><a name="local-6989586621684792728"><a href="#local-6989586621684792728"><span class="hs-identifier">q1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1381"></a><span>                     </span><a name="local-6989586621684792729"><a href="#local-6989586621684792729"><span class="hs-identifier">rhat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1382"></a><span>                     </span><a name="local-6989586621684792730"><a href="#local-6989586621684792730"><span class="hs-identifier">tmp1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1383"></a><span>                     </span><a name="local-6989586621684792731"><a href="#local-6989586621684792731"><span class="hs-identifier">q0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1384"></a><span>                     </span><a name="local-6989586621684792732"><a href="#local-6989586621684792732"><span class="hs-identifier">un21</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-1385"></a><span>                     </span><a name="local-6989586621684792733"><a href="#local-6989586621684792733"><span class="hs-identifier">again1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1386"></a><span>                     </span><a name="local-6989586621684792734"><a href="#local-6989586621684792734"><span class="hs-identifier">no1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1387"></a><span>                     </span><a name="local-6989586621684792735"><a href="#local-6989586621684792735"><span class="hs-identifier">then1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1388"></a><span>                     </span><a name="local-6989586621684792736"><a href="#local-6989586621684792736"><span class="hs-identifier">endif1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1389"></a><span>                     </span><a name="local-6989586621684792737"><a href="#local-6989586621684792737"><span class="hs-identifier">again2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1390"></a><span>                     </span><a name="local-6989586621684792738"><a href="#local-6989586621684792738"><span class="hs-identifier">no2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1391"></a><span>                     </span><a name="local-6989586621684792739"><a href="#local-6989586621684792739"><span class="hs-identifier">then2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1392"></a><span>                     </span><a name="local-6989586621684792740"><a href="#local-6989586621684792740"><span class="hs-identifier">endif2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-1393"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792717"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792715"><span class="hs-identifier hs-var">xl_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792713"><span class="hs-identifier hs-var">xh_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1394"></a><span>                              </span><span class="hs-comment">-- see Hacker's Delight p 196 Figure 9-3</span><span>
</span><a name="line-1395"></a><span>                              </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- b = 2 ^ (bits_in_word / 2)</span><span>
</span><a name="line-1396"></a><span>                                     </span><a href="PPC.Instr.html#LI"><span class="hs-identifier hs-var">LI</span></a><span> </span><a href="#local-6989586621684792719"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1397"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792719"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621684792719"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1398"></a><span>                                     </span><span class="hs-comment">-- s = clz(y)</span><span>
</span><a name="line-1399"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CNTLZ"><span class="hs-identifier hs-var">CNTLZ</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792718"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684792716"><span class="hs-identifier hs-var">y_reg</span></a><span>
</span><a name="line-1400"></a><span>                                     </span><span class="hs-comment">-- v = y &lt;&lt; s</span><span>
</span><a name="line-1401"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792720"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621684792716"><span class="hs-identifier hs-var">y_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792718"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1402"></a><span>                                     </span><span class="hs-comment">-- vn1 = upper half of v</span><span>
</span><a name="line-1403"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SR"><span class="hs-identifier hs-var">SR</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792721"><span class="hs-identifier hs-var">vn1</span></a><span> </span><a href="#local-6989586621684792720"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1404"></a><span>                                     </span><span class="hs-comment">-- vn0 = lower half of v</span><span>
</span><a name="line-1405"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CLRLI"><span class="hs-identifier hs-var">CLRLI</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792722"><span class="hs-identifier hs-var">vn0</span></a><span> </span><a href="#local-6989586621684792720"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span>
</span><a name="line-1406"></a><span>                                     </span><span class="hs-comment">-- un32 = (u1 &lt;&lt; s)</span><span>
</span><a name="line-1407"></a><span>                                     </span><span class="hs-comment">--      | (u0 &gt;&gt; (bits_in_word - s))</span><span>
</span><a name="line-1408"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792723"><span class="hs-identifier hs-var">un32</span></a><span> </span><a href="#local-6989586621684792712"><span class="hs-identifier hs-var">xh_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792718"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1409"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBFC"><span class="hs-identifier hs-var">SUBFC</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792718"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1410"></a><span>                                        </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">8</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="Format.html#formatInBytes"><span class="hs-identifier hs-var">formatInBytes</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1411"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SR"><span class="hs-identifier hs-var">SR</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792714"><span class="hs-identifier hs-var">xl_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1412"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><a href="#local-6989586621684792723"><span class="hs-identifier hs-var">un32</span></a><span> </span><a href="#local-6989586621684792723"><span class="hs-identifier hs-var">un32</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1413"></a><span>                                     </span><span class="hs-comment">-- un10 = u0 &lt;&lt; s</span><span>
</span><a name="line-1414"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792725"><span class="hs-identifier hs-var">un10</span></a><span> </span><a href="#local-6989586621684792714"><span class="hs-identifier hs-var">xl_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792718"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1415"></a><span>                                     </span><span class="hs-comment">-- un1 = upper half of un10</span><span>
</span><a name="line-1416"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SR"><span class="hs-identifier hs-var">SR</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792726"><span class="hs-identifier hs-var">un1</span></a><span> </span><a href="#local-6989586621684792725"><span class="hs-identifier hs-var">un10</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1417"></a><span>                                     </span><span class="hs-comment">-- un0 = lower half of un10</span><span>
</span><a name="line-1418"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CLRLI"><span class="hs-identifier hs-var">CLRLI</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792727"><span class="hs-identifier hs-var">un0</span></a><span> </span><a href="#local-6989586621684792725"><span class="hs-identifier hs-var">un10</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span>
</span><a name="line-1419"></a><span>                                     </span><span class="hs-comment">-- q1 = un32/vn1</span><span>
</span><a name="line-1420"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#DIV"><span class="hs-identifier hs-var">DIV</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792728"><span class="hs-identifier hs-var">q1</span></a><span> </span><a href="#local-6989586621684792723"><span class="hs-identifier hs-var">un32</span></a><span> </span><a href="#local-6989586621684792721"><span class="hs-identifier hs-var">vn1</span></a><span>
</span><a name="line-1421"></a><span>                                     </span><span class="hs-comment">-- rhat = un32 - q1*vn1</span><span>
</span><a name="line-1422"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792728"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792721"><span class="hs-identifier hs-var">vn1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1423"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBF"><span class="hs-identifier hs-var">SUBF</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792723"><span class="hs-identifier hs-var">un32</span></a><span>
</span><a name="line-1424"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792733"><span class="hs-identifier hs-var">again1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1425"></a><span>
</span><a name="line-1426"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792733"><span class="hs-identifier hs-var">again1</span></a><span>
</span><a name="line-1427"></a><span>                                     </span><span class="hs-comment">-- if (q1 &gt;= b || q1*vn0 &gt; b*rhat + un1)</span><span>
</span><a name="line-1428"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792728"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792719"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1429"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span> </span><a href="#local-6989586621684792735"><span class="hs-identifier hs-var">then1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1430"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792734"><span class="hs-identifier hs-var">no1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1431"></a><span>
</span><a name="line-1432"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792734"><span class="hs-identifier hs-var">no1</span></a><span>
</span><a name="line-1433"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792728"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792722"><span class="hs-identifier hs-var">vn0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1434"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792730"><span class="hs-identifier hs-var">tmp1</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1435"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792730"><span class="hs-identifier hs-var">tmp1</span></a><span> </span><a href="#local-6989586621684792730"><span class="hs-identifier hs-var">tmp1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792726"><span class="hs-identifier hs-var">un1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1436"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792730"><span class="hs-identifier hs-var">tmp1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1437"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#LEU"><span class="hs-identifier hs-var">LEU</span></a><span> </span><a href="#local-6989586621684792736"><span class="hs-identifier hs-var">endif1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1438"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792735"><span class="hs-identifier hs-var">then1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1439"></a><span>
</span><a name="line-1440"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792735"><span class="hs-identifier hs-var">then1</span></a><span>
</span><a name="line-1441"></a><span>                                     </span><span class="hs-comment">-- q1 = q1 - 1</span><span>
</span><a name="line-1442"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792728"><span class="hs-identifier hs-var">q1</span></a><span> </span><a href="#local-6989586621684792728"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1443"></a><span>                                     </span><span class="hs-comment">-- rhat = rhat + vn1</span><span>
</span><a name="line-1444"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792721"><span class="hs-identifier hs-var">vn1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1445"></a><span>                                     </span><span class="hs-comment">-- if (rhat &lt; b) goto again1</span><span>
</span><a name="line-1446"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792719"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1447"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><a href="#local-6989586621684792733"><span class="hs-identifier hs-var">again1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1448"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792736"><span class="hs-identifier hs-var">endif1</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1449"></a><span>
</span><a name="line-1450"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792736"><span class="hs-identifier hs-var">endif1</span></a><span>
</span><a name="line-1451"></a><span>                                     </span><span class="hs-comment">-- un21 = un32*b + un1 - q1*v</span><span>
</span><a name="line-1452"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792732"><span class="hs-identifier hs-var">un21</span></a><span> </span><a href="#local-6989586621684792723"><span class="hs-identifier hs-var">un32</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1453"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792732"><span class="hs-identifier hs-var">un21</span></a><span> </span><a href="#local-6989586621684792732"><span class="hs-identifier hs-var">un21</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792726"><span class="hs-identifier hs-var">un1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1454"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792728"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792720"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1455"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBF"><span class="hs-identifier hs-var">SUBF</span></a><span> </span><a href="#local-6989586621684792732"><span class="hs-identifier hs-var">un21</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792732"><span class="hs-identifier hs-var">un21</span></a><span>
</span><a name="line-1456"></a><span>                                     </span><span class="hs-comment">-- compute second quotient digit</span><span>
</span><a name="line-1457"></a><span>                                     </span><span class="hs-comment">-- q0 = un21/vn1</span><span>
</span><a name="line-1458"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#DIV"><span class="hs-identifier hs-var">DIV</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684792731"><span class="hs-identifier hs-var">q0</span></a><span> </span><a href="#local-6989586621684792732"><span class="hs-identifier hs-var">un21</span></a><span> </span><a href="#local-6989586621684792721"><span class="hs-identifier hs-var">vn1</span></a><span>
</span><a name="line-1459"></a><span>                                     </span><span class="hs-comment">-- rhat = un21- q0*vn1</span><span>
</span><a name="line-1460"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792731"><span class="hs-identifier hs-var">q0</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792721"><span class="hs-identifier hs-var">vn1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1461"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBF"><span class="hs-identifier hs-var">SUBF</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792732"><span class="hs-identifier hs-var">un21</span></a><span>
</span><a name="line-1462"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792737"><span class="hs-identifier hs-var">again2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1463"></a><span>
</span><a name="line-1464"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792737"><span class="hs-identifier hs-var">again2</span></a><span>
</span><a name="line-1465"></a><span>                                     </span><span class="hs-comment">-- if (q0&gt;b || q0*vn0 &gt; b*rhat + un0)</span><span>
</span><a name="line-1466"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792731"><span class="hs-identifier hs-var">q0</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792719"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1467"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span> </span><a href="#local-6989586621684792739"><span class="hs-identifier hs-var">then2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1468"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792738"><span class="hs-identifier hs-var">no2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1469"></a><span>
</span><a name="line-1470"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792738"><span class="hs-identifier hs-var">no2</span></a><span>
</span><a name="line-1471"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792731"><span class="hs-identifier hs-var">q0</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792722"><span class="hs-identifier hs-var">vn0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1472"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792730"><span class="hs-identifier hs-var">tmp1</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1473"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792730"><span class="hs-identifier hs-var">tmp1</span></a><span> </span><a href="#local-6989586621684792730"><span class="hs-identifier hs-var">tmp1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792727"><span class="hs-identifier hs-var">un0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1474"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792730"><span class="hs-identifier hs-var">tmp1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1475"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#LEU"><span class="hs-identifier hs-var">LEU</span></a><span> </span><a href="#local-6989586621684792740"><span class="hs-identifier hs-var">endif2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1476"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792739"><span class="hs-identifier hs-var">then2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1477"></a><span>
</span><a name="line-1478"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792739"><span class="hs-identifier hs-var">then2</span></a><span>
</span><a name="line-1479"></a><span>                                     </span><span class="hs-comment">-- q0 = q0 - 1</span><span>
</span><a name="line-1480"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792731"><span class="hs-identifier hs-var">q0</span></a><span> </span><a href="#local-6989586621684792731"><span class="hs-identifier hs-var">q0</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1481"></a><span>                                     </span><span class="hs-comment">-- rhat = rhat + vn1</span><span>
</span><a name="line-1482"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792721"><span class="hs-identifier hs-var">vn1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1483"></a><span>                                     </span><span class="hs-comment">-- if (rhat&lt;b) goto again2</span><span>
</span><a name="line-1484"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#CMPL"><span class="hs-identifier hs-var">CMPL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792729"><span class="hs-identifier hs-var">rhat</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792719"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1485"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><a href="#local-6989586621684792737"><span class="hs-identifier hs-var">again2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1486"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#BCC"><span class="hs-identifier hs-var">BCC</span></a><span> </span><a href="PPC.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684792740"><span class="hs-identifier hs-var">endif2</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1487"></a><span>
</span><a name="line-1488"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684792740"><span class="hs-identifier hs-var">endif2</span></a><span>
</span><a name="line-1489"></a><span>                                     </span><span class="hs-comment">-- compute remainder</span><span>
</span><a name="line-1490"></a><span>                                     </span><span class="hs-comment">-- r = (un21*b + un0 - q0*v) &gt;&gt; s</span><span>
</span><a name="line-1491"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792709"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684792732"><span class="hs-identifier hs-var">un21</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1492"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792709"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684792709"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792727"><span class="hs-identifier hs-var">un0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1493"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792731"><span class="hs-identifier hs-var">q0</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792720"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1494"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBF"><span class="hs-identifier hs-var">SUBF</span></a><span> </span><a href="#local-6989586621684792709"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684792724"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792709"><span class="hs-identifier hs-var">reg_r</span></a><span>
</span><a name="line-1495"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SR"><span class="hs-identifier hs-var">SR</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792709"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684792709"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792718"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1496"></a><span>                                     </span><span class="hs-comment">-- compute quotient</span><span>
</span><a name="line-1497"></a><span>                                     </span><span class="hs-comment">-- q = q1*b + q0</span><span>
</span><a name="line-1498"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792710"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792708"><span class="hs-identifier hs-var">reg_q</span></a><span> </span><a href="#local-6989586621684792728"><span class="hs-identifier hs-var">q1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792711"><span class="hs-identifier hs-var">half</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1499"></a><span>                                   </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792708"><span class="hs-identifier hs-var">reg_q</span></a><span> </span><a href="#local-6989586621684792708"><span class="hs-identifier hs-var">reg_q</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792731"><span class="hs-identifier hs-var">q0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1500"></a><span>                                   </span><span class="hs-special">]</span><span>
</span><a name="line-1501"></a><span>              </span><span class="hs-identifier">divOp2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1502"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments for divOp2&quot;</span><span>
</span><a name="line-1503"></a><span>              </span><a name="local-6989586621684792686"><a href="#local-6989586621684792686"><span class="hs-identifier">multOp2</span></a></a><span> </span><a name="local-6989586621684792741"><a href="#local-6989586621684792741"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684792742"><a href="#local-6989586621684792742"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792743"><a href="#local-6989586621684792743"><span class="hs-identifier">res_h</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792744"><a href="#local-6989586621684792744"><span class="hs-identifier">res_l</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792745"><a href="#local-6989586621684792745"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792746"><a href="#local-6989586621684792746"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1504"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792747"><a href="#local-6989586621684792747"><span class="hs-identifier">reg_h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792741"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792743"><span class="hs-identifier hs-var">res_h</span></a><span class="hs-special">)</span><span>
</span><a name="line-1505"></a><span>                         </span><a name="local-6989586621684792748"><a href="#local-6989586621684792748"><span class="hs-identifier">reg_l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792741"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792744"><span class="hs-identifier hs-var">res_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1506"></a><span>                         </span><a name="local-6989586621684792749"><a href="#local-6989586621684792749"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792742"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1507"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792750"><a href="#local-6989586621684792750"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792751"><a href="#local-6989586621684792751"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792745"><span class="hs-identifier hs-var">arg_x</span></a><span>
</span><a name="line-1508"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792752"><a href="#local-6989586621684792752"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792753"><a href="#local-6989586621684792753"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792746"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-1509"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792753"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792751"><span class="hs-identifier hs-var">x_code</span></a><span>
</span><a name="line-1510"></a><span>                            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684792749"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792748"><span class="hs-identifier hs-var">reg_l</span></a><span> </span><a href="#local-6989586621684792750"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792752"><span class="hs-identifier hs-var">y_reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1511"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MULHU"><span class="hs-identifier hs-var">MULHU</span></a><span> </span><a href="#local-6989586621684792749"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792747"><span class="hs-identifier hs-var">reg_h</span></a><span> </span><a href="#local-6989586621684792750"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684792752"><span class="hs-identifier hs-var">y_reg</span></a><span>
</span><a name="line-1512"></a><span>                                         </span><span class="hs-special">]</span><span>
</span><a name="line-1513"></a><span>              </span><span class="hs-identifier">multOp2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1514"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCall: Wrong number of arguments for multOp2&quot;</span><span>
</span><a name="line-1515"></a><span>              </span><a name="local-6989586621684792687"><a href="#local-6989586621684792687"><span class="hs-identifier">add2Op</span></a></a><span> </span><a name="local-6989586621684792754"><a href="#local-6989586621684792754"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792755"><a href="#local-6989586621684792755"><span class="hs-identifier">res_h</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792756"><a href="#local-6989586621684792756"><span class="hs-identifier">res_l</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792757"><a href="#local-6989586621684792757"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792758"><a href="#local-6989586621684792758"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1516"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792759"><a href="#local-6989586621684792759"><span class="hs-identifier">reg_h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792754"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792755"><span class="hs-identifier hs-var">res_h</span></a><span class="hs-special">)</span><span>
</span><a name="line-1517"></a><span>                         </span><a name="local-6989586621684792760"><a href="#local-6989586621684792760"><span class="hs-identifier">reg_l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792754"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792756"><span class="hs-identifier hs-var">res_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1518"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792761"><a href="#local-6989586621684792761"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792762"><a href="#local-6989586621684792762"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792757"><span class="hs-identifier hs-var">arg_x</span></a><span>
</span><a name="line-1519"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792763"><a href="#local-6989586621684792763"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792764"><a href="#local-6989586621684792764"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792758"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-1520"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792764"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792762"><span class="hs-identifier hs-var">x_code</span></a><span>
</span><a name="line-1521"></a><span>                            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#LI"><span class="hs-identifier hs-var">LI</span></a><span> </span><a href="#local-6989586621684792759"><span class="hs-identifier hs-var">reg_h</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADDC"><span class="hs-identifier hs-var">ADDC</span></a><span> </span><a href="#local-6989586621684792760"><span class="hs-identifier hs-var">reg_l</span></a><span> </span><a href="#local-6989586621684792761"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684792763"><span class="hs-identifier hs-var">y_reg</span></a><span>
</span><a name="line-1523"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADDZE"><span class="hs-identifier hs-var">ADDZE</span></a><span> </span><a href="#local-6989586621684792759"><span class="hs-identifier hs-var">reg_h</span></a><span> </span><a href="#local-6989586621684792759"><span class="hs-identifier hs-var">reg_h</span></a><span>
</span><a name="line-1524"></a><span>                                         </span><span class="hs-special">]</span><span>
</span><a name="line-1525"></a><span>              </span><span class="hs-identifier">add2Op</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1526"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments/results for add2&quot;</span><span>
</span><a name="line-1527"></a><span>
</span><a name="line-1528"></a><span>              </span><a name="local-6989586621684792688"><a href="#local-6989586621684792688"><span class="hs-identifier">addcOp</span></a></a><span> </span><a name="local-6989586621684792765"><a href="#local-6989586621684792765"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792766"><a href="#local-6989586621684792766"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792767"><a href="#local-6989586621684792767"><span class="hs-identifier">res_c</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792768"><a href="#local-6989586621684792768"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792769"><a href="#local-6989586621684792769"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1529"></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792687"><span class="hs-identifier hs-var">add2Op</span></a><span> </span><a href="#local-6989586621684792765"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684792767"><span class="hs-identifier hs-var">res_c</span></a><span> </span><span class="hs-comment">{-hi-}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792766"><span class="hs-identifier hs-var">res_r</span></a><span> </span><span class="hs-comment">{-lo-}</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684792768"><span class="hs-identifier hs-var">arg_x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792769"><span class="hs-identifier hs-var">arg_y</span></a><span class="hs-special">]</span><span>
</span><a name="line-1530"></a><span>              </span><span class="hs-identifier">addcOp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1531"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments/results for addc&quot;</span><span>
</span><a name="line-1532"></a><span>
</span><a name="line-1533"></a><span>              </span><span class="hs-comment">-- PowerPC subfc sets the carry for rT = ~(rA) + rB + 1,</span><span>
</span><a name="line-1534"></a><span>              </span><span class="hs-comment">-- which is 0 for borrow and 1 otherwise. We need 1 and 0</span><span>
</span><a name="line-1535"></a><span>              </span><span class="hs-comment">-- so xor with 1.</span><span>
</span><a name="line-1536"></a><span>              </span><a name="local-6989586621684792689"><a href="#local-6989586621684792689"><span class="hs-identifier">subcOp</span></a></a><span> </span><a name="local-6989586621684792770"><a href="#local-6989586621684792770"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792771"><a href="#local-6989586621684792771"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792772"><a href="#local-6989586621684792772"><span class="hs-identifier">res_c</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792773"><a href="#local-6989586621684792773"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792774"><a href="#local-6989586621684792774"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1537"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792775"><a href="#local-6989586621684792775"><span class="hs-identifier">reg_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792770"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792771"><span class="hs-identifier hs-var">res_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1538"></a><span>                         </span><a name="local-6989586621684792776"><a href="#local-6989586621684792776"><span class="hs-identifier">reg_c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792770"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792772"><span class="hs-identifier hs-var">res_c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1539"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792777"><a href="#local-6989586621684792777"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792778"><a href="#local-6989586621684792778"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792773"><span class="hs-identifier hs-var">arg_x</span></a><span>
</span><a name="line-1540"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792779"><a href="#local-6989586621684792779"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792780"><a href="#local-6989586621684792780"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792774"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-1541"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792780"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792778"><span class="hs-identifier hs-var">x_code</span></a><span>
</span><a name="line-1542"></a><span>                            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#LI"><span class="hs-identifier hs-var">LI</span></a><span> </span><a href="#local-6989586621684792776"><span class="hs-identifier hs-var">reg_c</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-1543"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBFC"><span class="hs-identifier hs-var">SUBFC</span></a><span> </span><a href="#local-6989586621684792775"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684792779"><span class="hs-identifier hs-var">y_reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792777"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1544"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#ADDZE"><span class="hs-identifier hs-var">ADDZE</span></a><span> </span><a href="#local-6989586621684792776"><span class="hs-identifier hs-var">reg_c</span></a><span> </span><a href="#local-6989586621684792776"><span class="hs-identifier hs-var">reg_c</span></a><span>
</span><a name="line-1545"></a><span>                                         </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><a href="#local-6989586621684792776"><span class="hs-identifier hs-var">reg_c</span></a><span> </span><a href="#local-6989586621684792776"><span class="hs-identifier hs-var">reg_c</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1546"></a><span>                                         </span><span class="hs-special">]</span><span>
</span><a name="line-1547"></a><span>              </span><span class="hs-identifier">subcOp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1548"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments/results for subc&quot;</span><span>
</span><a name="line-1549"></a><span>              </span><a name="local-6989586621684792690"><a href="#local-6989586621684792690"><span class="hs-identifier">addSubCOp</span></a></a><span> </span><a name="local-6989586621684792781"><a href="#local-6989586621684792781"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684792782"><a href="#local-6989586621684792782"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684792783"><a href="#local-6989586621684792783"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792784"><a href="#local-6989586621684792784"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792785"><a href="#local-6989586621684792785"><span class="hs-identifier">res_c</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792786"><a href="#local-6989586621684792786"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792787"><a href="#local-6989586621684792787"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1550"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792788"><a href="#local-6989586621684792788"><span class="hs-identifier">reg_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792782"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792784"><span class="hs-identifier hs-var">res_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1551"></a><span>                         </span><a name="local-6989586621684792789"><a href="#local-6989586621684792789"><span class="hs-identifier">reg_c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792782"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792785"><span class="hs-identifier hs-var">res_c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1552"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792790"><a href="#local-6989586621684792790"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792791"><a href="#local-6989586621684792791"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792786"><span class="hs-identifier hs-var">arg_x</span></a><span>
</span><a name="line-1553"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792792"><a href="#local-6989586621684792792"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792793"><a href="#local-6989586621684792793"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792787"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-1554"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792793"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792791"><span class="hs-identifier hs-var">x_code</span></a><span>
</span><a name="line-1555"></a><span>                            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621684792781"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684792788"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684792792"><span class="hs-identifier hs-var">y_reg</span></a><span> </span><a href="#local-6989586621684792790"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">,</span><span>
</span><a name="line-1556"></a><span>                                           </span><span class="hs-comment">-- SUBFO argument order reversed!</span><span>
</span><a name="line-1557"></a><span>                                           </span><a href="PPC.Instr.html#MFOV"><span class="hs-identifier hs-var">MFOV</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792783"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792789"><span class="hs-identifier hs-var">reg_c</span></a><span>
</span><a name="line-1558"></a><span>                                         </span><span class="hs-special">]</span><span>
</span><a name="line-1559"></a><span>              </span><span class="hs-identifier">addSubCOp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1560"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCall: Wrong number of arguments/results for addC&quot;</span><span>
</span><a name="line-1561"></a><span>              </span><a name="local-6989586621684792691"><a href="#local-6989586621684792691"><span class="hs-identifier">fabs</span></a></a><span> </span><a name="local-6989586621684792794"><a href="#local-6989586621684792794"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684792795"><a href="#local-6989586621684792795"><span class="hs-identifier">res</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684792796"><a href="#local-6989586621684792796"><span class="hs-identifier">arg</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1562"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792797"><a href="#local-6989586621684792797"><span class="hs-identifier">res_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792794"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792795"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1563"></a><span>                     </span><span class="hs-special">(</span><a name="local-6989586621684792798"><a href="#local-6989586621684792798"><span class="hs-identifier">arg_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792799"><a href="#local-6989586621684792799"><span class="hs-identifier">arg_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792796"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1564"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792799"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#FABS"><span class="hs-identifier hs-var">FABS</span></a><span> </span><a href="#local-6989586621684792797"><span class="hs-identifier hs-var">res_r</span></a><span> </span><a href="#local-6989586621684792798"><span class="hs-identifier hs-var">arg_reg</span></a><span>
</span><a name="line-1565"></a><span>              </span><span class="hs-identifier">fabs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1566"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCall: Wrong number of arguments/results for fabs&quot;</span><span>
</span><a name="line-1567"></a><span>
</span><a name="line-1568"></a><span class="hs-comment">-- TODO: replace 'Int' by an enum such as 'PPC_64ABI'</span><span>
</span><a name="line-1569"></a><span class="hs-keyword">data</span><span> </span><a name="GenCCallPlatform"><a href="PPC.CodeGen.html#GenCCallPlatform"><span class="hs-identifier">GenCCallPlatform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GCP32ELF"><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier">GCP32ELF</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="GCP64ELF"><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier">GCP64ELF</span></a></a><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="GCPAIX"><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier">GCPAIX</span></a></a><span>
</span><a name="line-1570"></a><span>
</span><a name="line-1571"></a><span class="hs-identifier">platformToGCP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#GenCCallPlatform"><span class="hs-identifier hs-type">GenCCallPlatform</span></a><span>
</span><a name="line-1572"></a><a name="platformToGCP"><a href="PPC.CodeGen.html#platformToGCP"><span class="hs-identifier">platformToGCP</span></a></a><span> </span><a name="local-6989586621684792808"><a href="#local-6989586621684792808"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-1573"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684792808"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1574"></a><span>      </span><span class="hs-identifier hs-var">OSAIX</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span>
</span><a name="line-1575"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-6989586621684792808"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1576"></a><span>             </span><span class="hs-identifier hs-var">ArchPPC</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier hs-var">GCP32ELF</span></a><span>
</span><a name="line-1577"></a><span>             </span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier hs-var">ELF_V1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1578"></a><span>             </span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier hs-var">ELF_V2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-1579"></a><span>             </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;platformToGCP: Not PowerPC&quot;</span><span>
</span><a name="line-1580"></a><span>
</span><a name="line-1581"></a><span>
</span><a name="line-1582"></a><span class="hs-identifier">genCCall'</span><span>
</span><a name="line-1583"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-1584"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#GenCCallPlatform"><span class="hs-identifier hs-type">GenCCallPlatform</span></a><span>
</span><a name="line-1585"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>            </span><span class="hs-comment">-- function to call</span><span>
</span><a name="line-1586"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- where to put the result</span><span>
</span><a name="line-1587"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- arguments (of mixed type)</span><span>
</span><a name="line-1588"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1589"></a><span>
</span><a name="line-1590"></a><span class="hs-comment">{- 
    PowerPC Linux uses the System V Release 4 Calling Convention
    for PowerPC. It is described in the
    &quot;System V Application Binary Interface PowerPC Processor Supplement&quot;.

    PowerPC 64 Linux uses the System V Release 4 Calling Convention for
    64-bit PowerPC. It is specified in
    &quot;64-bit PowerPC ELF Application Binary Interface Supplement 1.9&quot;
    (PPC64 ELF v1.9).

    PowerPC 64 Linux in little endian mode uses the &quot;Power Architecture 64-Bit
    ELF V2 ABI Specification -- OpenPOWER ABI for Linux Supplement&quot;
    (PPC64 ELF v2).

    AIX follows the &quot;PowerOpen ABI: Application Binary Interface Big-Endian
    32-Bit Hardware Implementation&quot;

    All four conventions are similar:
    Parameters may be passed in general-purpose registers starting at r3, in
    floating point registers starting at f1, or on the stack.

    But there are substantial differences:
    * The number of registers used for parameter passing and the exact set of
      nonvolatile registers differs (see MachRegs.hs).
    * On AIX and 64-bit ELF, stack space is always reserved for parameters,
      even if they are passed in registers. The called routine may choose to
      save parameters from registers to the corresponding space on the stack.
    * On AIX and 64-bit ELF, a corresponding amount of GPRs is skipped when
      a floating point parameter is passed in an FPR.
    * SysV insists on either passing I64 arguments on the stack, or in two GPRs,
      starting with an odd-numbered GPR. It may skip a GPR to achieve this.
      AIX just treats an I64 likt two separate I32s (high word first).
    * I64 and FF64 arguments are 8-byte aligned on the stack for SysV, but only
      4-byte aligned like everything else on AIX.
    * The SysV spec claims that FF32 is represented as FF64 on the stack. GCC on
      PowerPC Linux does not agree, so neither do we.

    According to all conventions, the parameter area should be part of the
    caller's stack frame, allocated in the caller's prologue code (large enough
    to hold the parameter lists for all called routines). The NCG already
    uses the stack for register spilling, leaving 64 bytes free at the top.
    If we need a larger parameter area than that, we increase the size
    of the stack frame just before ccalling.
-}</span><span>
</span><a name="line-1634"></a><span>
</span><a name="line-1635"></a><span>
</span><a name="line-1636"></a><a name="genCCall%27"><a href="PPC.CodeGen.html#genCCall%27"><span class="hs-identifier">genCCall'</span></a></a><span> </span><a name="local-6989586621684792809"><a href="#local-6989586621684792809"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684792810"><a href="#local-6989586621684792810"><span class="hs-identifier">gcp</span></a></a><span> </span><a name="local-6989586621684792811"><a href="#local-6989586621684792811"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684792812"><a href="#local-6989586621684792812"><span class="hs-identifier">dest_regs</span></a></a><span> </span><a name="local-6989586621684792813"><a href="#local-6989586621684792813"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-1637"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1638"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792912"><a href="#local-6989586621684792912"><span class="hs-identifier">finalStack</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792913"><a href="#local-6989586621684792913"><span class="hs-identifier">passArgumentsCode</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792914"><a href="#local-6989586621684792914"><span class="hs-identifier">usedRegs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684792825"><span class="hs-identifier hs-var">passArguments</span></a><span>
</span><a name="line-1639"></a><span>                                                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip3</span><span> </span><a href="#local-6989586621684792813"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684792818"><span class="hs-identifier hs-var">argReps</span></a><span> </span><a href="#local-6989586621684792819"><span class="hs-identifier hs-var">argHints</span></a><span class="hs-special">)</span><span>
</span><a name="line-1640"></a><span>                                                   </span><a href="PPC.Regs.html#allArgRegs"><span class="hs-identifier hs-var">allArgRegs</span></a><span>
</span><a name="line-1641"></a><span>                                                   </span><span class="hs-special">(</span><a href="PPC.Regs.html#allFPArgRegs"><span class="hs-identifier hs-var">allFPArgRegs</span></a><span> </span><a href="#local-6989586621684792814"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-1642"></a><span>                                                   </span><a href="#local-6989586621684792816"><span class="hs-identifier hs-var">initialStackOffset</span></a><span>
</span><a name="line-1643"></a><span>                                                   </span><span class="hs-identifier hs-var">nilOL</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1644"></a><span>
</span><a name="line-1645"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792918"><a href="#local-6989586621684792918"><span class="hs-identifier">labelOrExpr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792919"><a href="#local-6989586621684792919"><span class="hs-identifier">reduceToFF32</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792811"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1646"></a><span>            </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684792915"><a href="#local-6989586621684792915"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1647"></a><span>                </span><a href="#local-6989586621684792815"><span class="hs-identifier hs-var">uses_pic_base_implicitly</span></a><span>
</span><a name="line-1648"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621684792915"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1649"></a><span>            </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a name="local-6989586621684792916"><a href="#local-6989586621684792916"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1650"></a><span>                </span><a href="#local-6989586621684792815"><span class="hs-identifier hs-var">uses_pic_base_implicitly</span></a><span>
</span><a name="line-1651"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621684792916"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1652"></a><span>            </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621684792917"><a href="#local-6989586621684792917"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792827"><span class="hs-identifier hs-var">outOfLineMachOp</span></a><span> </span><a href="#local-6989586621684792917"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-1653"></a><span>
</span><a name="line-1654"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792920"><a href="#local-6989586621684792920"><span class="hs-identifier">codeBefore</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792822"><span class="hs-identifier hs-var">move_sp_down</span></a><span> </span><a href="#local-6989586621684792912"><span class="hs-identifier hs-var">finalStack</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792913"><span class="hs-identifier hs-var">passArgumentsCode</span></a><span>
</span><a name="line-1655"></a><span>            </span><a name="local-6989586621684792921"><a href="#local-6989586621684792921"><span class="hs-identifier">codeAfter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792823"><span class="hs-identifier hs-var">move_sp_up</span></a><span> </span><a href="#local-6989586621684792912"><span class="hs-identifier hs-var">finalStack</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792826"><span class="hs-identifier hs-var">moveResult</span></a><span> </span><a href="#local-6989586621684792919"><span class="hs-identifier hs-var">reduceToFF32</span></a><span>
</span><a name="line-1656"></a><span>
</span><a name="line-1657"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792918"><span class="hs-identifier hs-var">labelOrExpr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1658"></a><span>            </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621684792922"><a href="#local-6989586621684792922"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- the linker does all the work for us</span><span>
</span><a name="line-1659"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>         </span><a href="#local-6989586621684792920"><span class="hs-identifier hs-var">codeBefore</span></a><span>
</span><a name="line-1660"></a><span>                        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BL"><span class="hs-identifier hs-var">BL</span></a><span> </span><a href="#local-6989586621684792922"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621684792914"><span class="hs-identifier hs-var">usedRegs</span></a><span>
</span><a name="line-1661"></a><span>                        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792824"><span class="hs-identifier hs-var">maybeNOP</span></a><span> </span><span class="hs-comment">-- some ABI require a NOP after BL</span><span>
</span><a name="line-1662"></a><span>                        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792921"><span class="hs-identifier hs-var">codeAfter</span></a><span class="hs-special">)</span><span>
</span><a name="line-1663"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621684792923"><a href="#local-6989586621684792923"><span class="hs-identifier">dyn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- implement call through function pointer</span><span>
</span><a name="line-1664"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621684792924"><a href="#local-6989586621684792924"><span class="hs-identifier">dynReg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792925"><a href="#local-6989586621684792925"><span class="hs-identifier">dynCode</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792923"><span class="hs-identifier hs-var">dyn</span></a><span>
</span><a name="line-1665"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1666"></a><span>                     </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">1</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621684792925"><span class="hs-identifier hs-var">dynCode</span></a><span>
</span><a name="line-1667"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792920"><span class="hs-identifier hs-var">codeBefore</span></a><span>
</span><a name="line-1668"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621684792821"><span class="hs-identifier hs-var">spFormat</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">40</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1669"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792924"><span class="hs-identifier hs-var">dynReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1670"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792924"><span class="hs-identifier hs-var">dynReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1671"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span>
</span><a name="line-1672"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792924"><span class="hs-identifier hs-var">dynReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1673"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BCTRL"><span class="hs-identifier hs-var">BCTRL</span></a><span> </span><a href="#local-6989586621684792914"><span class="hs-identifier hs-var">usedRegs</span></a><span>
</span><a name="line-1674"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792821"><span class="hs-identifier hs-var">spFormat</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">40</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1675"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792921"><span class="hs-identifier hs-var">codeAfter</span></a><span class="hs-special">)</span><span>
</span><a name="line-1676"></a><span>                     </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">2</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621684792925"><span class="hs-identifier hs-var">dynCode</span></a><span>
</span><a name="line-1677"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792920"><span class="hs-identifier hs-var">codeBefore</span></a><span>
</span><a name="line-1678"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621684792821"><span class="hs-identifier hs-var">spFormat</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">24</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1679"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="PPC.Regs.html#r12"><span class="hs-identifier hs-var">r12</span></a><span> </span><a href="#local-6989586621684792924"><span class="hs-identifier hs-var">dynReg</span></a><span>
</span><a name="line-1680"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="PPC.Regs.html#r12"><span class="hs-identifier hs-var">r12</span></a><span>
</span><a name="line-1681"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BCTRL"><span class="hs-identifier hs-var">BCTRL</span></a><span> </span><a href="#local-6989586621684792914"><span class="hs-identifier hs-var">usedRegs</span></a><span>
</span><a name="line-1682"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792821"><span class="hs-identifier hs-var">spFormat</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">24</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1683"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792921"><span class="hs-identifier hs-var">codeAfter</span></a><span class="hs-special">)</span><span>
</span><a name="line-1684"></a><span>                     </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621684792925"><span class="hs-identifier hs-var">dynCode</span></a><span>
</span><a name="line-1685"></a><span>                       </span><span class="hs-comment">-- AIX/XCOFF follows the PowerOPEN ABI</span><span>
</span><a name="line-1686"></a><span>                       </span><span class="hs-comment">-- which is quite similiar to LinuxPPC64/ELFv1</span><span>
</span><a name="line-1687"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792920"><span class="hs-identifier hs-var">codeBefore</span></a><span>
</span><a name="line-1688"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621684792821"><span class="hs-identifier hs-var">spFormat</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">20</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1689"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792924"><span class="hs-identifier hs-var">dynReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1690"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792924"><span class="hs-identifier hs-var">dynReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">4</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1691"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span>
</span><a name="line-1692"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="PPC.Regs.html#r11"><span class="hs-identifier hs-var">r11</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792924"><span class="hs-identifier hs-var">dynReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1693"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BCTRL"><span class="hs-identifier hs-var">BCTRL</span></a><span> </span><a href="#local-6989586621684792914"><span class="hs-identifier hs-var">usedRegs</span></a><span>
</span><a name="line-1694"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792821"><span class="hs-identifier hs-var">spFormat</span></a><span> </span><a href="PPC.Regs.html#toc"><span class="hs-identifier hs-var">toc</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">20</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1695"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792921"><span class="hs-identifier hs-var">codeAfter</span></a><span class="hs-special">)</span><span>
</span><a name="line-1696"></a><span>                     </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621684792925"><span class="hs-identifier hs-var">dynCode</span></a><span>
</span><a name="line-1697"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="#local-6989586621684792924"><span class="hs-identifier hs-var">dynReg</span></a><span>
</span><a name="line-1698"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792920"><span class="hs-identifier hs-var">codeBefore</span></a><span>
</span><a name="line-1699"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#BCTRL"><span class="hs-identifier hs-var">BCTRL</span></a><span> </span><a href="#local-6989586621684792914"><span class="hs-identifier hs-var">usedRegs</span></a><span>
</span><a name="line-1700"></a><span>                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>  </span><a href="#local-6989586621684792921"><span class="hs-identifier hs-var">codeAfter</span></a><span class="hs-special">)</span><span>
</span><a name="line-1701"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1702"></a><span>        </span><a name="local-6989586621684792814"><a href="#local-6989586621684792814"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1703"></a><span>
</span><a name="line-1704"></a><span>        </span><a name="local-6989586621684792815"><a href="#local-6989586621684792815"><span class="hs-identifier">uses_pic_base_implicitly</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1705"></a><span>            </span><span class="hs-comment">-- See Note [implicit register in PPC PIC code]</span><span>
</span><a name="line-1706"></a><span>            </span><span class="hs-comment">-- on why we claim to use PIC register here</span><span>
</span><a name="line-1707"></a><span>            </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">positionIndependent</span><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684792814"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1708"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getPicBaseNat"><span class="hs-identifier hs-var">getPicBaseNat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1709"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1710"></a><span>
</span><a name="line-1711"></a><span>        </span><a name="local-6989586621684792816"><a href="#local-6989586621684792816"><span class="hs-identifier">initialStackOffset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1712"></a><span>                             </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">24</span><span>
</span><a name="line-1713"></a><span>                             </span><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier hs-var">GCP32ELF</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-1714"></a><span>                             </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">48</span><span>
</span><a name="line-1715"></a><span>                             </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">32</span><span>
</span><a name="line-1716"></a><span>                             </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCall': unknown calling convention&quot;</span><span>
</span><a name="line-1717"></a><span>            </span><span class="hs-comment">-- size of linkage area + size of arguments, in bytes</span><span>
</span><a name="line-1718"></a><span>        </span><a name="local-6989586621684792817"><a href="#local-6989586621684792817"><span class="hs-identifier">stackDelta</span></a></a><span> </span><a name="local-6989586621684792828"><a href="#local-6989586621684792828"><span class="hs-identifier">finalStack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1719"></a><span>                                </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1720"></a><span>                                    </span><a href="#local-6989586621684792820"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-number">24</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-number">32</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1721"></a><span>                                    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792818"><span class="hs-identifier hs-var">argReps</span></a><span>
</span><a name="line-1722"></a><span>                                </span><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier hs-var">GCP32ELF</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792820"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">16</span><span> </span><a href="#local-6989586621684792828"><span class="hs-identifier hs-var">finalStack</span></a><span>
</span><a name="line-1723"></a><span>                                </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1724"></a><span>                                    </span><a href="#local-6989586621684792820"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-number">48</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-number">64</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1725"></a><span>                                    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792820"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span class="hs-special">)</span><span>
</span><a name="line-1726"></a><span>                                        </span><a href="#local-6989586621684792818"><span class="hs-identifier hs-var">argReps</span></a><span>
</span><a name="line-1727"></a><span>                                </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1728"></a><span>                                    </span><a href="#local-6989586621684792820"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-number">32</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-number">64</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1729"></a><span>                                    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792820"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span class="hs-special">)</span><span>
</span><a name="line-1730"></a><span>                                        </span><a href="#local-6989586621684792818"><span class="hs-identifier hs-var">argReps</span></a><span>
</span><a name="line-1731"></a><span>                                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCall': unknown calling conv.&quot;</span><span>
</span><a name="line-1732"></a><span>
</span><a name="line-1733"></a><span>        </span><a name="local-6989586621684792818"><a href="#local-6989586621684792818"><span class="hs-identifier">argReps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792813"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1734"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792819"><a href="#local-6989586621684792819"><span class="hs-identifier">argHints</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#foreignTargetHints"><span class="hs-identifier hs-var">foreignTargetHints</span></a><span> </span><a href="#local-6989586621684792811"><span class="hs-identifier hs-var">target</span></a><span>
</span><a name="line-1735"></a><span>
</span><a name="line-1736"></a><span>        </span><a name="local-6989586621684792820"><a href="#local-6989586621684792820"><span class="hs-identifier">roundTo</span></a></a><span> </span><a name="local-6989586621684792829"><a href="#local-6989586621684792829"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684792830"><a href="#local-6989586621684792830"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792830"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792829"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792830"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1737"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792830"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684792829"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792830"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792829"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1738"></a><span>
</span><a name="line-1739"></a><span>        </span><a name="local-6989586621684792821"><a href="#local-6989586621684792821"><span class="hs-identifier">spFormat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><a href="#local-6989586621684792814"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span>
</span><a name="line-1740"></a><span>
</span><a name="line-1741"></a><span>        </span><span class="hs-comment">-- TODO: Do not create a new stack frame if delta is too large.</span><span>
</span><a name="line-1742"></a><span>        </span><a name="local-6989586621684792822"><a href="#local-6989586621684792822"><span class="hs-identifier">move_sp_down</span></a></a><span> </span><a name="local-6989586621684792831"><a href="#local-6989586621684792831"><span class="hs-identifier">finalStack</span></a></a><span>
</span><a name="line-1743"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792832"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="PPC.Instr.html#stackFrameHeaderSize"><span class="hs-identifier hs-var">stackFrameHeaderSize</span></a><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1744"></a><span>                        </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="PPC.Instr.html#STU"><span class="hs-identifier hs-var">STU</span></a><span> </span><a href="#local-6989586621684792821"><span class="hs-identifier hs-var">spFormat</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684792832"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1745"></a><span>                              </span><a href="PPC.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684792832"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1746"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1747"></a><span>               </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792832"><a href="#local-6989586621684792832"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792817"><span class="hs-identifier hs-var">stackDelta</span></a><span> </span><a href="#local-6989586621684792831"><span class="hs-identifier hs-var">finalStack</span></a><span>
</span><a name="line-1748"></a><span>        </span><a name="local-6989586621684792823"><a href="#local-6989586621684792823"><span class="hs-identifier">move_sp_up</span></a></a><span> </span><a name="local-6989586621684792833"><a href="#local-6989586621684792833"><span class="hs-identifier">finalStack</span></a></a><span>
</span><a name="line-1749"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792834"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="PPC.Instr.html#stackFrameHeaderSize"><span class="hs-identifier hs-var">stackFrameHeaderSize</span></a><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1750"></a><span>                        </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792834"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1751"></a><span>                              </span><a href="PPC.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">]</span><span>
</span><a name="line-1752"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1753"></a><span>               </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792834"><a href="#local-6989586621684792834"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792817"><span class="hs-identifier hs-var">stackDelta</span></a><span> </span><a href="#local-6989586621684792833"><span class="hs-identifier hs-var">finalStack</span></a><span>
</span><a name="line-1754"></a><span>
</span><a name="line-1755"></a><span>        </span><span class="hs-comment">-- A NOP instruction is required after a call (bl instruction)</span><span>
</span><a name="line-1756"></a><span>        </span><span class="hs-comment">-- on AIX and 64-Bit Linux.</span><span>
</span><a name="line-1757"></a><span>        </span><span class="hs-comment">-- If the call is to a function with a different TOC (r2) the</span><span>
</span><a name="line-1758"></a><span>        </span><span class="hs-comment">-- link editor replaces the NOP instruction with a load of the TOC</span><span>
</span><a name="line-1759"></a><span>        </span><span class="hs-comment">-- from the stack to restore the TOC.</span><span>
</span><a name="line-1760"></a><span>        </span><a name="local-6989586621684792824"><a href="#local-6989586621684792824"><span class="hs-identifier">maybeNOP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1761"></a><span>           </span><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier hs-var">GCP32ELF</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1762"></a><span>           </span><span class="hs-comment">-- See Section 3.9.4 of OpenPower ABI</span><span>
</span><a name="line-1763"></a><span>           </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="PPC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span>
</span><a name="line-1764"></a><span>           </span><span class="hs-comment">-- See Section 3.5.11 of PPC64 ELF v1.9</span><span>
</span><a name="line-1765"></a><span>           </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">1</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="PPC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span>
</span><a name="line-1766"></a><span>           </span><span class="hs-comment">-- See Section 2.3.6 of PPC64 ELF v2</span><span>
</span><a name="line-1767"></a><span>           </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">2</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="PPC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span>
</span><a name="line-1768"></a><span>           </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;maybeNOP: Unknown PowerPC 64-bit ABI&quot;</span><span>
</span><a name="line-1769"></a><span>
</span><a name="line-1770"></a><span>        </span><a name="local-6989586621684792825"><a href="#local-6989586621684792825"><span class="hs-identifier">passArguments</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792835"><a href="#local-6989586621684792835"><span class="hs-identifier">stackOffset</span></a></a><span> </span><a name="local-6989586621684792836"><a href="#local-6989586621684792836"><span class="hs-identifier">accumCode</span></a></a><span> </span><a name="local-6989586621684792837"><a href="#local-6989586621684792837"><span class="hs-identifier">accumUsed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792835"><span class="hs-identifier hs-var">stackOffset</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792836"><span class="hs-identifier hs-var">accumCode</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792837"><span class="hs-identifier hs-var">accumUsed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1771"></a><span>        </span><span class="hs-identifier">passArguments</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621684792838"><a href="#local-6989586621684792838"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792839"><a href="#local-6989586621684792839"><span class="hs-identifier">arg_ty</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621684792840"><a href="#local-6989586621684792840"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684792841"><a href="#local-6989586621684792841"><span class="hs-identifier">gprs</span></a></a><span> </span><a name="local-6989586621684792842"><a href="#local-6989586621684792842"><span class="hs-identifier">fprs</span></a></a><span> </span><a name="local-6989586621684792843"><a href="#local-6989586621684792843"><span class="hs-identifier">stackOffset</span></a></a><span>
</span><a name="line-1772"></a><span>               </span><a name="local-6989586621684792844"><a href="#local-6989586621684792844"><span class="hs-identifier">accumCode</span></a></a><span> </span><a name="local-6989586621684792845"><a href="#local-6989586621684792845"><span class="hs-identifier">accumUsed</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684792839"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1773"></a><span>                                     </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1774"></a><span>            </span><span class="hs-keyword">do</span><span>
</span><a name="line-1775"></a><span>                </span><a href="PPC.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684792846"><a href="#local-6989586621684792846"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792847"><a href="#local-6989586621684792847"><span class="hs-identifier">vr_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684792838"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1776"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792848"><a href="#local-6989586621684792848"><span class="hs-identifier">vr_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792847"><span class="hs-identifier hs-var">vr_lo</span></a><span>
</span><a name="line-1777"></a><span>
</span><a name="line-1778"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1779"></a><span>                    </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1780"></a><span>                        </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792849"><a href="#local-6989586621684792849"><span class="hs-identifier">storeWord</span></a></a><span> </span><a name="local-6989586621684792850"><a href="#local-6989586621684792850"><span class="hs-identifier">vr</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684792851"><a href="#local-6989586621684792851"><span class="hs-identifier">gpr</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792851"><span class="hs-identifier hs-var">gpr</span></a><span> </span><a href="#local-6989586621684792850"><span class="hs-identifier hs-var">vr</span></a><span>
</span><a name="line-1781"></a><span>                               </span><span class="hs-identifier">storeWord</span><span> </span><a name="local-6989586621684792852"><a href="#local-6989586621684792852"><span class="hs-identifier">vr</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621684792853"><a href="#local-6989586621684792853"><span class="hs-identifier">offset</span></a></a><span>
</span><a name="line-1782"></a><span>                                   </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792852"><span class="hs-identifier hs-var">vr</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792853"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1783"></a><span>                           </span><a href="#local-6989586621684792825"><span class="hs-identifier hs-var">passArguments</span></a><span> </span><a href="#local-6989586621684792840"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1784"></a><span>                                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621684792841"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1785"></a><span>                                         </span><a href="#local-6989586621684792842"><span class="hs-identifier hs-var">fprs</span></a><span>
</span><a name="line-1786"></a><span>                                         </span><span class="hs-special">(</span><a href="#local-6989586621684792843"><span class="hs-identifier hs-var">stackOffset</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-1787"></a><span>                                         </span><span class="hs-special">(</span><a href="#local-6989586621684792844"><span class="hs-identifier hs-var">accumCode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792846"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1788"></a><span>                                               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792849"><span class="hs-identifier hs-var">storeWord</span></a><span> </span><a href="#local-6989586621684792848"><span class="hs-identifier hs-var">vr_hi</span></a><span> </span><a href="#local-6989586621684792841"><span class="hs-identifier hs-var">gprs</span></a><span> </span><a href="#local-6989586621684792843"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1789"></a><span>                                               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792849"><span class="hs-identifier hs-var">storeWord</span></a><span> </span><a href="#local-6989586621684792847"><span class="hs-identifier hs-var">vr_lo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621684792841"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792843"><span class="hs-identifier hs-var">stackOffset</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">4</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1790"></a><span>                                         </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621684792841"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684792845"><span class="hs-identifier hs-var">accumUsed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1791"></a><span>                    </span><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier hs-var">GCP32ELF</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1792"></a><span>                        </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792854"><a href="#local-6989586621684792854"><span class="hs-identifier">stackOffset'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792820"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">8</span><span> </span><a href="#local-6989586621684792843"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1793"></a><span>                               </span><a name="local-6989586621684792855"><a href="#local-6989586621684792855"><span class="hs-identifier">stackCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792844"><span class="hs-identifier hs-var">accumCode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792846"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1794"></a><span>                                   </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792848"><span class="hs-identifier hs-var">vr_hi</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792854"><span class="hs-identifier hs-var">stackOffset'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1795"></a><span>                                   </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684792847"><span class="hs-identifier hs-var">vr_lo</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792854"><span class="hs-identifier hs-var">stackOffset'</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">4</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1796"></a><span>                               </span><a name="local-6989586621684792856"><a href="#local-6989586621684792856"><span class="hs-identifier">regCode</span></a></a><span> </span><a name="local-6989586621684792857"><a href="#local-6989586621684792857"><span class="hs-identifier">hireg</span></a></a><span> </span><a name="local-6989586621684792858"><a href="#local-6989586621684792858"><span class="hs-identifier">loreg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1797"></a><span>                                   </span><a href="#local-6989586621684792844"><span class="hs-identifier hs-var">accumCode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792846"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1798"></a><span>                                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792857"><span class="hs-identifier hs-var">hireg</span></a><span> </span><a href="#local-6989586621684792848"><span class="hs-identifier hs-var">vr_hi</span></a><span>
</span><a name="line-1799"></a><span>                                       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792858"><span class="hs-identifier hs-var">loreg</span></a><span> </span><a href="#local-6989586621684792847"><span class="hs-identifier hs-var">vr_lo</span></a><span>
</span><a name="line-1800"></a><span>
</span><a name="line-1801"></a><span>                           </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792841"><span class="hs-identifier hs-var">gprs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1802"></a><span>                               </span><a name="local-6989586621684792859"><a href="#local-6989586621684792859"><span class="hs-identifier">hireg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684792860"><a href="#local-6989586621684792860"><span class="hs-identifier">loreg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684792861"><a href="#local-6989586621684792861"><span class="hs-identifier">regs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">even</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684792841"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1803"></a><span>                                   </span><a href="#local-6989586621684792825"><span class="hs-identifier hs-var">passArguments</span></a><span> </span><a href="#local-6989586621684792840"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684792861"><span class="hs-identifier hs-var">regs</span></a><span> </span><a href="#local-6989586621684792842"><span class="hs-identifier hs-var">fprs</span></a><span> </span><a href="#local-6989586621684792843"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1804"></a><span>                                                 </span><span class="hs-special">(</span><a href="#local-6989586621684792856"><span class="hs-identifier hs-var">regCode</span></a><span> </span><a href="#local-6989586621684792859"><span class="hs-identifier hs-var">hireg</span></a><span> </span><a href="#local-6989586621684792860"><span class="hs-identifier hs-var">loreg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792859"><span class="hs-identifier hs-var">hireg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684792860"><span class="hs-identifier hs-var">loreg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684792845"><span class="hs-identifier hs-var">accumUsed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1805"></a><span>                               </span><a name="local-6989586621684792862"><a href="#local-6989586621684792862"><span class="hs-identifier">_skipped</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684792863"><a href="#local-6989586621684792863"><span class="hs-identifier">hireg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684792864"><a href="#local-6989586621684792864"><span class="hs-identifier">loreg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684792865"><a href="#local-6989586621684792865"><span class="hs-identifier">regs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1806"></a><span>                                   </span><a href="#local-6989586621684792825"><span class="hs-identifier hs-var">passArguments</span></a><span> </span><a href="#local-6989586621684792840"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684792865"><span class="hs-identifier hs-var">regs</span></a><span> </span><a href="#local-6989586621684792842"><span class="hs-identifier hs-var">fprs</span></a><span> </span><a href="#local-6989586621684792843"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1807"></a><span>                                                 </span><span class="hs-special">(</span><a href="#local-6989586621684792856"><span class="hs-identifier hs-var">regCode</span></a><span> </span><a href="#local-6989586621684792863"><span class="hs-identifier hs-var">hireg</span></a><span> </span><a href="#local-6989586621684792864"><span class="hs-identifier hs-var">loreg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792863"><span class="hs-identifier hs-var">hireg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684792864"><span class="hs-identifier hs-var">loreg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684792845"><span class="hs-identifier hs-var">accumUsed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1808"></a><span>                               </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- only one or no regs left</span><span>
</span><a name="line-1809"></a><span>                                   </span><a href="#local-6989586621684792825"><span class="hs-identifier hs-var">passArguments</span></a><span> </span><a href="#local-6989586621684792840"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621684792842"><span class="hs-identifier hs-var">fprs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792854"><span class="hs-identifier hs-var">stackOffset'</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-1810"></a><span>                                                 </span><a href="#local-6989586621684792855"><span class="hs-identifier hs-var">stackCode</span></a><span> </span><a href="#local-6989586621684792845"><span class="hs-identifier hs-var">accumUsed</span></a><span>
</span><a name="line-1811"></a><span>                    </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;passArguments: 32 bit code&quot;</span><span>
</span><a name="line-1812"></a><span>
</span><a name="line-1813"></a><span>        </span><span class="hs-identifier">passArguments</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621684792866"><a href="#local-6989586621684792866"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792867"><a href="#local-6989586621684792867"><span class="hs-identifier">rep</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792868"><a href="#local-6989586621684792868"><span class="hs-identifier">hint</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621684792869"><a href="#local-6989586621684792869"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684792870"><a href="#local-6989586621684792870"><span class="hs-identifier">gprs</span></a></a><span> </span><a name="local-6989586621684792871"><a href="#local-6989586621684792871"><span class="hs-identifier">fprs</span></a></a><span> </span><a name="local-6989586621684792872"><a href="#local-6989586621684792872"><span class="hs-identifier">stackOffset</span></a></a><span> </span><a name="local-6989586621684792873"><a href="#local-6989586621684792873"><span class="hs-identifier">accumCode</span></a></a><span> </span><a name="local-6989586621684792874"><a href="#local-6989586621684792874"><span class="hs-identifier">accumUsed</span></a></a><span>
</span><a name="line-1814"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621684792885"><a href="#local-6989586621684792885"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684792884"><span class="hs-identifier hs-var">regs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1815"></a><span>                </span><a name="local-6989586621684792886"><a href="#local-6989586621684792886"><span class="hs-identifier">register</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684792875"><span class="hs-identifier hs-var">arg_pro</span></a><span>
</span><a name="line-1816"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792887"><a href="#local-6989586621684792887"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792886"><span class="hs-identifier hs-var">register</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1817"></a><span>                            </span><a href="PPC.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792889"><a href="#local-6989586621684792889"><span class="hs-identifier">freg</span></a></a><span> </span><a name="local-6989586621684792890"><a href="#local-6989586621684792890"><span class="hs-identifier">fcode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792890"><span class="hs-identifier hs-var">fcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792885"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684792889"><span class="hs-identifier hs-var">freg</span></a><span>
</span><a name="line-1818"></a><span>                            </span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792891"><a href="#local-6989586621684792891"><span class="hs-identifier">acode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792891"><span class="hs-identifier hs-var">acode</span></a><span> </span><a href="#local-6989586621684792885"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-1819"></a><span>                    </span><a name="local-6989586621684792888"><a href="#local-6989586621684792888"><span class="hs-identifier">stackOffsetRes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1820"></a><span>                                     </span><span class="hs-comment">-- The PowerOpen ABI requires that we</span><span>
</span><a name="line-1821"></a><span>                                     </span><span class="hs-comment">-- reserve stack slots for register</span><span>
</span><a name="line-1822"></a><span>                                     </span><span class="hs-comment">-- parameters</span><span>
</span><a name="line-1823"></a><span>                                     </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792872"><span class="hs-identifier hs-var">stackOffset</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684792883"><span class="hs-identifier hs-var">stackBytes</span></a><span>
</span><a name="line-1824"></a><span>                                     </span><span class="hs-comment">-- ... the SysV ABI 32-bit doesn't.</span><span>
</span><a name="line-1825"></a><span>                                     </span><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier hs-var">GCP32ELF</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792872"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1826"></a><span>                                     </span><span class="hs-comment">-- ... but SysV ABI 64-bit does.</span><span>
</span><a name="line-1827"></a><span>                                     </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792872"><span class="hs-identifier hs-var">stackOffset</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684792883"><span class="hs-identifier hs-var">stackBytes</span></a><span>
</span><a name="line-1828"></a><span>                </span><a href="#local-6989586621684792825"><span class="hs-identifier hs-var">passArguments</span></a><span> </span><a href="#local-6989586621684792869"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1829"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621684792881"><span class="hs-identifier hs-var">nGprs</span></a><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1830"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621684792882"><span class="hs-identifier hs-var">nFprs</span></a><span> </span><a href="#local-6989586621684792871"><span class="hs-identifier hs-var">fprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1831"></a><span>                              </span><a href="#local-6989586621684792888"><span class="hs-identifier hs-var">stackOffsetRes</span></a><span>
</span><a name="line-1832"></a><span>                              </span><span class="hs-special">(</span><a href="#local-6989586621684792873"><span class="hs-identifier hs-var">accumCode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792887"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1833"></a><span>                              </span><span class="hs-special">(</span><a href="#local-6989586621684792885"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684792874"><span class="hs-identifier hs-var">accumUsed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1834"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1835"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621684792892"><a href="#local-6989586621684792892"><span class="hs-identifier">vr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792893"><a href="#local-6989586621684792893"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792875"><span class="hs-identifier hs-var">arg_pro</span></a><span>
</span><a name="line-1836"></a><span>                </span><a href="#local-6989586621684792825"><span class="hs-identifier hs-var">passArguments</span></a><span> </span><a href="#local-6989586621684792869"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1837"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621684792881"><span class="hs-identifier hs-var">nGprs</span></a><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1838"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621684792882"><span class="hs-identifier hs-var">nFprs</span></a><span> </span><a href="#local-6989586621684792871"><span class="hs-identifier hs-var">fprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1839"></a><span>                              </span><span class="hs-special">(</span><a href="#local-6989586621684792878"><span class="hs-identifier hs-var">stackOffset'</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684792883"><span class="hs-identifier hs-var">stackBytes</span></a><span class="hs-special">)</span><span>
</span><a name="line-1840"></a><span>                              </span><span class="hs-special">(</span><a href="#local-6989586621684792873"><span class="hs-identifier hs-var">accumCode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792893"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1841"></a><span>                                         </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621684792876"><span class="hs-identifier hs-var">format_pro</span></a><span> </span><a href="#local-6989586621684792892"><span class="hs-identifier hs-var">vr</span></a><span> </span><a href="#local-6989586621684792880"><span class="hs-identifier hs-var">stackSlot</span></a><span class="hs-special">)</span><span>
</span><a name="line-1842"></a><span>                              </span><a href="#local-6989586621684792874"><span class="hs-identifier hs-var">accumUsed</span></a><span>
</span><a name="line-1843"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-1844"></a><span>                </span><a name="local-6989586621684792875"><a href="#local-6989586621684792875"><span class="hs-identifier">arg_pro</span></a></a><span>
</span><a name="line-1845"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isBitsType</span><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792877"><span class="hs-identifier hs-var">conv_op</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684792866"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1846"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792866"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1847"></a><span>                </span><a name="local-6989586621684792876"><a href="#local-6989586621684792876"><span class="hs-identifier">format_pro</span></a></a><span>
</span><a name="line-1848"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isBitsType</span><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1849"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-1850"></a><span>                </span><a name="local-6989586621684792877"><a href="#local-6989586621684792877"><span class="hs-identifier">conv_op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792868"><span class="hs-identifier hs-var">hint</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1851"></a><span>                            </span><span class="hs-identifier hs-var">SignedHint</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span>
</span><a name="line-1852"></a><span>                            </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span>
</span><a name="line-1853"></a><span>
</span><a name="line-1854"></a><span>                </span><a name="local-6989586621684792878"><a href="#local-6989586621684792878"><span class="hs-identifier">stackOffset'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1855"></a><span>                               </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1856"></a><span>                                   </span><span class="hs-comment">-- The 32bit PowerOPEN ABI is happy with</span><span>
</span><a name="line-1857"></a><span>                                   </span><span class="hs-comment">-- 32bit-alignment ...</span><span>
</span><a name="line-1858"></a><span>                                   </span><a href="#local-6989586621684792872"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1859"></a><span>                               </span><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier hs-var">GCP32ELF</span></a><span>
</span><a name="line-1860"></a><span>                                   </span><span class="hs-comment">-- ... the SysV ABI requires 8-byte</span><span>
</span><a name="line-1861"></a><span>                                   </span><span class="hs-comment">-- alignment for doubles.</span><span>
</span><a name="line-1862"></a><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1863"></a><span>                                   </span><a href="#local-6989586621684792820"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">8</span><span> </span><a href="#local-6989586621684792872"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1864"></a><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1865"></a><span>                                   </span><a href="#local-6989586621684792872"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1866"></a><span>                               </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1867"></a><span>                                   </span><span class="hs-comment">-- Everything on the stack is mapped to</span><span>
</span><a name="line-1868"></a><span>                                   </span><span class="hs-comment">-- 8-byte aligned doublewords</span><span>
</span><a name="line-1869"></a><span>                                   </span><a href="#local-6989586621684792872"><span class="hs-identifier hs-var">stackOffset</span></a><span>
</span><a name="line-1870"></a><span>                </span><a name="local-6989586621684792879"><a href="#local-6989586621684792879"><span class="hs-identifier">stackOffset''</span></a></a><span>
</span><a name="line-1871"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1872"></a><span>                         </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1873"></a><span>                         </span><span class="hs-comment">-- The ELF v1 ABI Section 3.2.3 requires:</span><span>
</span><a name="line-1874"></a><span>                         </span><span class="hs-comment">-- &quot;Single precision floating point values</span><span>
</span><a name="line-1875"></a><span>                         </span><span class="hs-comment">-- are mapped to the second word in a single</span><span>
</span><a name="line-1876"></a><span>                         </span><span class="hs-comment">-- doubleword&quot;</span><span>
</span><a name="line-1877"></a><span>                         </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-number">1</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792878"><span class="hs-identifier hs-var">stackOffset'</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-1878"></a><span>                         </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792878"><span class="hs-identifier hs-var">stackOffset'</span></a><span>
</span><a name="line-1879"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792878"><span class="hs-identifier hs-var">stackOffset'</span></a><span>
</span><a name="line-1880"></a><span>
</span><a name="line-1881"></a><span>                </span><a name="local-6989586621684792880"><a href="#local-6989586621684792880"><span class="hs-identifier">stackSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="PPC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792879"><span class="hs-identifier hs-var">stackOffset''</span></a><span class="hs-special">)</span><span>
</span><a name="line-1882"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621684792881"><a href="#local-6989586621684792881"><span class="hs-identifier">nGprs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792882"><a href="#local-6989586621684792882"><span class="hs-identifier">nFprs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792883"><a href="#local-6989586621684792883"><span class="hs-identifier">stackBytes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792884"><a href="#local-6989586621684792884"><span class="hs-identifier">regs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1883"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792810"><span class="hs-identifier hs-var">gcp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1884"></a><span>                      </span><a href="PPC.CodeGen.html#GCPAIX"><span class="hs-identifier hs-var">GCPAIX</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1885"></a><span>                          </span><span class="hs-keyword">case</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1886"></a><span>                          </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1887"></a><span>                          </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1888"></a><span>                          </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1889"></a><span>                          </span><span class="hs-comment">-- The PowerOpen ABI requires that we skip a</span><span>
</span><a name="line-1890"></a><span>                          </span><span class="hs-comment">-- corresponding number of GPRs when we use</span><span>
</span><a name="line-1891"></a><span>                          </span><span class="hs-comment">-- the FPRs.</span><span>
</span><a name="line-1892"></a><span>                          </span><span class="hs-comment">--</span><span>
</span><a name="line-1893"></a><span>                          </span><span class="hs-comment">-- E.g. for a `double` two GPRs are skipped,</span><span>
</span><a name="line-1894"></a><span>                          </span><span class="hs-comment">-- whereas for a `float` one GPR is skipped</span><span>
</span><a name="line-1895"></a><span>                          </span><span class="hs-comment">-- when parameters are assigned to</span><span>
</span><a name="line-1896"></a><span>                          </span><span class="hs-comment">-- registers.</span><span>
</span><a name="line-1897"></a><span>                          </span><span class="hs-comment">--</span><span>
</span><a name="line-1898"></a><span>                          </span><span class="hs-comment">-- The PowerOpen ABI specification can be found at</span><span>
</span><a name="line-1899"></a><span>                          </span><span class="hs-comment">-- ftp://www.sourceware.org/pub/binutils/ppc-docs/ppc-poweropen/</span><span>
</span><a name="line-1900"></a><span>                          </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792871"><span class="hs-identifier hs-var">fprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1901"></a><span>                          </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792871"><span class="hs-identifier hs-var">fprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1902"></a><span>                          </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall' passArguments II64&quot;</span><span>
</span><a name="line-1903"></a><span>                          </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall' passArguments FF80&quot;</span><span>
</span><a name="line-1904"></a><span>                      </span><a href="PPC.CodeGen.html#GCP32ELF"><span class="hs-identifier hs-var">GCP32ELF</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1905"></a><span>                          </span><span class="hs-keyword">case</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1906"></a><span>                          </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1907"></a><span>                          </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1908"></a><span>                          </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1909"></a><span>                          </span><span class="hs-comment">-- ... the SysV ABI doesn't.</span><span>
</span><a name="line-1910"></a><span>                          </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792871"><span class="hs-identifier hs-var">fprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1911"></a><span>                          </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792871"><span class="hs-identifier hs-var">fprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1912"></a><span>                          </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall' passArguments II64&quot;</span><span>
</span><a name="line-1913"></a><span>                          </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall' passArguments FF80&quot;</span><span>
</span><a name="line-1914"></a><span>                      </span><a href="PPC.CodeGen.html#GCP64ELF"><span class="hs-identifier hs-var">GCP64ELF</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1915"></a><span>                          </span><span class="hs-keyword">case</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684792867"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1916"></a><span>                          </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1917"></a><span>                          </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1918"></a><span>                          </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1919"></a><span>                          </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792870"><span class="hs-identifier hs-var">gprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1920"></a><span>                          </span><span class="hs-comment">-- The ELFv1 ABI requires that we skip a</span><span>
</span><a name="line-1921"></a><span>                          </span><span class="hs-comment">-- corresponding number of GPRs when we use</span><span>
</span><a name="line-1922"></a><span>                          </span><span class="hs-comment">-- the FPRs.</span><span>
</span><a name="line-1923"></a><span>                          </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792871"><span class="hs-identifier hs-var">fprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1924"></a><span>                          </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792871"><span class="hs-identifier hs-var">fprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1925"></a><span>                          </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall' passArguments FF80&quot;</span><span>
</span><a name="line-1926"></a><span>
</span><a name="line-1927"></a><span>        </span><a name="local-6989586621684792826"><a href="#local-6989586621684792826"><span class="hs-identifier">moveResult</span></a></a><span> </span><a name="local-6989586621684792894"><a href="#local-6989586621684792894"><span class="hs-identifier">reduceToFF32</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1928"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792812"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1929"></a><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1930"></a><span>                </span><span class="hs-special">[</span><a name="local-6989586621684792895"><a href="#local-6989586621684792895"><span class="hs-identifier">dest</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1931"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792894"><span class="hs-identifier hs-var">reduceToFF32</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isFloat32</span><span> </span><a href="#local-6989586621684792896"><span class="hs-identifier hs-var">rep</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#FRSP"><span class="hs-identifier hs-var">FRSP</span></a><span> </span><a href="#local-6989586621684792897"><span class="hs-identifier hs-var">r_dest</span></a><span> </span><a href="PPC.Regs.html#f1"><span class="hs-identifier hs-var">f1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1932"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloat32</span><span> </span><a href="#local-6989586621684792896"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">isFloat64</span><span> </span><a href="#local-6989586621684792896"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792897"><span class="hs-identifier hs-var">r_dest</span></a><span> </span><a href="PPC.Regs.html#f1"><span class="hs-identifier hs-var">f1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1933"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684792896"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1934"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684792897"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">)</span><span> </span><a href="PPC.Regs.html#r3"><span class="hs-identifier hs-var">r3</span></a><span class="hs-special">,</span><span>
</span><a name="line-1935"></a><span>                                </span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792897"><span class="hs-identifier hs-var">r_dest</span></a><span> </span><a href="PPC.Regs.html#r4"><span class="hs-identifier hs-var">r4</span></a><span class="hs-special">]</span><span>
</span><a name="line-1936"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#MR"><span class="hs-identifier hs-var">MR</span></a><span> </span><a href="#local-6989586621684792897"><span class="hs-identifier hs-var">r_dest</span></a><span> </span><a href="PPC.Regs.html#r3"><span class="hs-identifier hs-var">r3</span></a><span class="hs-special">)</span><span>
</span><a name="line-1937"></a><span>                    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792896"><a href="#local-6989586621684792896"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621684792809"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792895"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span>
</span><a name="line-1938"></a><span>                          </span><a name="local-6989586621684792897"><a href="#local-6989586621684792897"><span class="hs-identifier">r_dest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684792814"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684792895"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span>
</span><a name="line-1939"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall' moveResult: Bad dest_regs&quot;</span><span>
</span><a name="line-1940"></a><span>
</span><a name="line-1941"></a><span>        </span><a name="local-6989586621684792827"><a href="#local-6989586621684792827"><span class="hs-identifier">outOfLineMachOp</span></a></a><span> </span><a name="local-6989586621684792898"><a href="#local-6989586621684792898"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1942"></a><span>            </span><span class="hs-keyword">do</span><span>
</span><a name="line-1943"></a><span>                </span><a name="local-6989586621684792908"><a href="#local-6989586621684792908"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1944"></a><span>                </span><a name="local-6989586621684792909"><a href="#local-6989586621684792909"><span class="hs-identifier">mopExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684792908"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1945"></a><span>                              </span><a href="CLabel.html#mkForeignLabel"><span class="hs-identifier hs-var">mkForeignLabel</span></a><span> </span><a href="#local-6989586621684792899"><span class="hs-identifier hs-var">functionName</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="CLabel.html#ForeignLabelInThisPackage"><span class="hs-identifier hs-var">ForeignLabelInThisPackage</span></a><span> </span><span class="hs-identifier hs-var">IsFunction</span><span>
</span><a name="line-1946"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792910"><a href="#local-6989586621684792910"><span class="hs-identifier">mopLabelOrExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792909"><span class="hs-identifier hs-var">mopExpr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1947"></a><span>                        </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684792911"><a href="#local-6989586621684792911"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621684792911"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-1948"></a><span>                        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621684792909"><span class="hs-identifier hs-var">mopExpr</span></a><span>
</span><a name="line-1949"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792910"><span class="hs-identifier hs-var">mopLabelOrExpr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684792900"><span class="hs-identifier hs-var">reduce</span></a><span class="hs-special">)</span><span>
</span><a name="line-1950"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-1951"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621684792899"><a href="#local-6989586621684792899"><span class="hs-identifier">functionName</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792900"><a href="#local-6989586621684792900"><span class="hs-identifier">reduce</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792898"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1952"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Exp"><span class="hs-identifier hs-var">MO_F32_Exp</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;exp&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1953"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Log"><span class="hs-identifier hs-var">MO_F32_Log</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;log&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1954"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Sqrt"><span class="hs-identifier hs-var">MO_F32_Sqrt</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sqrt&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1955"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Fabs"><span class="hs-identifier hs-var">MO_F32_Fabs</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-1956"></a><span>
</span><a name="line-1957"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Sin"><span class="hs-identifier hs-var">MO_F32_Sin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sin&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1958"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Cos"><span class="hs-identifier hs-var">MO_F32_Cos</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cos&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1959"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Tan"><span class="hs-identifier hs-var">MO_F32_Tan</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tan&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1960"></a><span>
</span><a name="line-1961"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Asin"><span class="hs-identifier hs-var">MO_F32_Asin</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asin&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1962"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Acos"><span class="hs-identifier hs-var">MO_F32_Acos</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acos&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1963"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Atan"><span class="hs-identifier hs-var">MO_F32_Atan</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atan&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1964"></a><span>
</span><a name="line-1965"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Sinh"><span class="hs-identifier hs-var">MO_F32_Sinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1966"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Cosh"><span class="hs-identifier hs-var">MO_F32_Cosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cosh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1967"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Tanh"><span class="hs-identifier hs-var">MO_F32_Tanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1968"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Pwr"><span class="hs-identifier hs-var">MO_F32_Pwr</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;pow&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1969"></a><span>
</span><a name="line-1970"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Asinh"><span class="hs-identifier hs-var">MO_F32_Asinh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1971"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Acosh"><span class="hs-identifier hs-var">MO_F32_Acosh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acosh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1972"></a><span>                    </span><a href="CmmMachOp.html#MO_F32_Atanh"><span class="hs-identifier hs-var">MO_F32_Atanh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1973"></a><span>
</span><a name="line-1974"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Exp"><span class="hs-identifier hs-var">MO_F64_Exp</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;exp&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1975"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Log"><span class="hs-identifier hs-var">MO_F64_Log</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;log&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1976"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Sqrt"><span class="hs-identifier hs-var">MO_F64_Sqrt</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sqrt&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1977"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Fabs"><span class="hs-identifier hs-var">MO_F64_Fabs</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-1978"></a><span>
</span><a name="line-1979"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Sin"><span class="hs-identifier hs-var">MO_F64_Sin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sin&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1980"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Cos"><span class="hs-identifier hs-var">MO_F64_Cos</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cos&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1981"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Tan"><span class="hs-identifier hs-var">MO_F64_Tan</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tan&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1982"></a><span>
</span><a name="line-1983"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Asin"><span class="hs-identifier hs-var">MO_F64_Asin</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asin&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1984"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Acos"><span class="hs-identifier hs-var">MO_F64_Acos</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acos&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1985"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Atan"><span class="hs-identifier hs-var">MO_F64_Atan</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atan&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1986"></a><span>
</span><a name="line-1987"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Sinh"><span class="hs-identifier hs-var">MO_F64_Sinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1988"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Cosh"><span class="hs-identifier hs-var">MO_F64_Cosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cosh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1989"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Tanh"><span class="hs-identifier hs-var">MO_F64_Tanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1990"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Pwr"><span class="hs-identifier hs-var">MO_F64_Pwr</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;pow&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1991"></a><span>
</span><a name="line-1992"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Asinh"><span class="hs-identifier hs-var">MO_F64_Asinh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1993"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Acosh"><span class="hs-identifier hs-var">MO_F64_Acosh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acosh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1994"></a><span>                    </span><a href="CmmMachOp.html#MO_F64_Atanh"><span class="hs-identifier hs-var">MO_F64_Atanh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanh&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1995"></a><span>
</span><a name="line-1996"></a><span>                    </span><a href="CmmMachOp.html#MO_UF_Conv"><span class="hs-identifier hs-var">MO_UF_Conv</span></a><span> </span><a name="local-6989586621684792902"><a href="#local-6989586621684792902"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#word2FloatLabel"><span class="hs-identifier hs-var">word2FloatLabel</span></a><span> </span><a href="#local-6989586621684792902"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1997"></a><span>
</span><a name="line-1998"></a><span>                    </span><a href="CmmMachOp.html#MO_Memcpy"><span class="hs-identifier hs-var">MO_Memcpy</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memcpy&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1999"></a><span>                    </span><a href="CmmMachOp.html#MO_Memset"><span class="hs-identifier hs-var">MO_Memset</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memset&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2000"></a><span>                    </span><a href="CmmMachOp.html#MO_Memmove"><span class="hs-identifier hs-var">MO_Memmove</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memmove&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2001"></a><span>                    </span><a href="CmmMachOp.html#MO_Memcmp"><span class="hs-identifier hs-var">MO_Memcmp</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memcmp&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2002"></a><span>
</span><a name="line-2003"></a><span>                    </span><a href="CmmMachOp.html#MO_BSwap"><span class="hs-identifier hs-var">MO_BSwap</span></a><span> </span><a name="local-6989586621684792903"><a href="#local-6989586621684792903"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#bSwapLabel"><span class="hs-identifier hs-var">bSwapLabel</span></a><span> </span><a href="#local-6989586621684792903"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2004"></a><span>                    </span><a href="CmmMachOp.html#MO_PopCnt"><span class="hs-identifier hs-var">MO_PopCnt</span></a><span> </span><a name="local-6989586621684792904"><a href="#local-6989586621684792904"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#popCntLabel"><span class="hs-identifier hs-var">popCntLabel</span></a><span> </span><a href="#local-6989586621684792904"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2005"></a><span>                    </span><a href="CmmMachOp.html#MO_Pdep"><span class="hs-identifier hs-var">MO_Pdep</span></a><span> </span><a name="local-6989586621684792905"><a href="#local-6989586621684792905"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#pdepLabel"><span class="hs-identifier hs-var">pdepLabel</span></a><span> </span><a href="#local-6989586621684792905"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2006"></a><span>                    </span><a href="CmmMachOp.html#MO_Pext"><span class="hs-identifier hs-var">MO_Pext</span></a><span> </span><a name="local-6989586621684792906"><a href="#local-6989586621684792906"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#pextLabel"><span class="hs-identifier hs-var">pextLabel</span></a><span> </span><a href="#local-6989586621684792906"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2007"></a><span>                    </span><a href="CmmMachOp.html#MO_Clz"><span class="hs-identifier hs-var">MO_Clz</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2008"></a><span>                    </span><a href="CmmMachOp.html#MO_Ctz"><span class="hs-identifier hs-var">MO_Ctz</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2009"></a><span>                    </span><a href="CmmMachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-var">MO_AtomicRMW</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2010"></a><span>                    </span><a href="CmmMachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-var">MO_Cmpxchg</span></a><span> </span><a name="local-6989586621684792907"><a href="#local-6989586621684792907"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#cmpxchgLabel"><span class="hs-identifier hs-var">cmpxchgLabel</span></a><span> </span><a href="#local-6989586621684792907"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2011"></a><span>                    </span><a href="CmmMachOp.html#MO_AtomicRead"><span class="hs-identifier hs-var">MO_AtomicRead</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2012"></a><span>                    </span><a href="CmmMachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-var">MO_AtomicWrite</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2013"></a><span>
</span><a name="line-2014"></a><span>                    </span><a href="CmmMachOp.html#MO_S_QuotRem"><span class="hs-identifier hs-var">MO_S_QuotRem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2015"></a><span>                    </span><a href="CmmMachOp.html#MO_U_QuotRem"><span class="hs-identifier hs-var">MO_U_QuotRem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2016"></a><span>                    </span><a href="CmmMachOp.html#MO_U_QuotRem2"><span class="hs-identifier hs-var">MO_U_QuotRem2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2017"></a><span>                    </span><a href="CmmMachOp.html#MO_Add2"><span class="hs-identifier hs-var">MO_Add2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2018"></a><span>                    </span><a href="CmmMachOp.html#MO_AddWordC"><span class="hs-identifier hs-var">MO_AddWordC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2019"></a><span>                    </span><a href="CmmMachOp.html#MO_SubWordC"><span class="hs-identifier hs-var">MO_SubWordC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2020"></a><span>                    </span><a href="CmmMachOp.html#MO_AddIntC"><span class="hs-identifier hs-var">MO_AddIntC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2021"></a><span>                    </span><a href="CmmMachOp.html#MO_SubIntC"><span class="hs-identifier hs-var">MO_SubIntC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2022"></a><span>                    </span><a href="CmmMachOp.html#MO_U_Mul2"><span class="hs-identifier hs-var">MO_U_Mul2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2023"></a><span>                    </span><a href="CmmMachOp.html#MO_WriteBarrier"><span class="hs-identifier hs-var">MO_WriteBarrier</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2024"></a><span>                    </span><a href="CmmMachOp.html#MO_Touch"><span class="hs-identifier hs-var">MO_Touch</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2025"></a><span>                    </span><a href="CmmMachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-var">MO_Prefetch_Data</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684792901"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2026"></a><span>                </span><a name="local-6989586621684792901"><a href="#local-6989586621684792901"><span class="hs-identifier">unsupported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;outOfLineCmmOp: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684792898"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-2027"></a><span>                                  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; not supported&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2028"></a><span>
</span><a name="line-2029"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-2030"></a><span class="hs-comment">-- Generating a table-branch</span><span>
</span><a name="line-2031"></a><span>
</span><a name="line-2032"></a><span class="hs-identifier">genSwitch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmSwitch.html#SwitchTargets"><span class="hs-identifier hs-type">SwitchTargets</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-2033"></a><a name="genSwitch"><a href="PPC.CodeGen.html#genSwitch"><span class="hs-identifier">genSwitch</span></a></a><span> </span><a name="local-6989586621684792926"><a href="#local-6989586621684792926"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684792927"><a href="#local-6989586621684792927"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621684792928"><a href="#local-6989586621684792928"><span class="hs-identifier">targets</span></a></a><span>
</span><a name="line-2034"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OSAIX</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2035"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2036"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792931"><a href="#local-6989586621684792931"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792932"><a href="#local-6989586621684792932"><span class="hs-identifier">e_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmUtils.html#cmmOffset"><span class="hs-identifier hs-var">cmmOffset</span></a><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792927"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621684792929"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-2037"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792933"><a href="#local-6989586621684792933"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2038"></a><span>            </span><a name="local-6989586621684792934"><a href="#local-6989586621684792934"><span class="hs-identifier">sha</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-2039"></a><span>        </span><a name="local-6989586621684792935"><a href="#local-6989586621684792935"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792933"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-2040"></a><span>        </span><a name="local-6989586621684792936"><a href="#local-6989586621684792936"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-2041"></a><span>        </span><a name="local-6989586621684792937"><a href="#local-6989586621684792937"><span class="hs-identifier">dynRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a><span> </span><a href="#local-6989586621684792936"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2042"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792938"><a href="#local-6989586621684792938"><span class="hs-identifier">tableReg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792939"><a href="#local-6989586621684792939"><span class="hs-identifier">t_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792937"><span class="hs-identifier hs-var">dynRef</span></a><span>
</span><a name="line-2043"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792940"><a href="#local-6989586621684792940"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792932"><span class="hs-identifier hs-var">e_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792939"><span class="hs-identifier hs-var">t_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2044"></a><span>                            </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792933"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792935"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792931"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792934"><span class="hs-identifier hs-var">sha</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2045"></a><span>                            </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792933"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792935"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegReg"><span class="hs-identifier hs-var">AddrRegReg</span></a><span> </span><a href="#local-6989586621684792938"><span class="hs-identifier hs-var">tableReg</span></a><span> </span><a href="#local-6989586621684792935"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2046"></a><span>                            </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="#local-6989586621684792935"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span>
</span><a name="line-2047"></a><span>                            </span><a href="PPC.Instr.html#BCTR"><span class="hs-identifier hs-var">BCTR</span></a><span> </span><a href="#local-6989586621684792930"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684792936"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-2048"></a><span>                    </span><span class="hs-special">]</span><span>
</span><a name="line-2049"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684792940"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2050"></a><span>
</span><a name="line-2051"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">positionIndependent</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2052"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2053"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792941"><a href="#local-6989586621684792941"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792942"><a href="#local-6989586621684792942"><span class="hs-identifier">e_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmUtils.html#cmmOffset"><span class="hs-identifier hs-var">cmmOffset</span></a><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792927"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621684792929"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-2054"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792943"><a href="#local-6989586621684792943"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2055"></a><span>            </span><a name="local-6989586621684792944"><a href="#local-6989586621684792944"><span class="hs-identifier">sha</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-2056"></a><span>        </span><a name="local-6989586621684792945"><a href="#local-6989586621684792945"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792943"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-2057"></a><span>        </span><a name="local-6989586621684792946"><a href="#local-6989586621684792946"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-2058"></a><span>        </span><a name="local-6989586621684792947"><a href="#local-6989586621684792947"><span class="hs-identifier">dynRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a><span> </span><a href="#local-6989586621684792946"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2059"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792948"><a href="#local-6989586621684792948"><span class="hs-identifier">tableReg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792949"><a href="#local-6989586621684792949"><span class="hs-identifier">t_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684792947"><span class="hs-identifier hs-var">dynRef</span></a><span>
</span><a name="line-2060"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792950"><a href="#local-6989586621684792950"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792942"><span class="hs-identifier hs-var">e_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792949"><span class="hs-identifier hs-var">t_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2061"></a><span>                            </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792943"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792945"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792941"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792944"><span class="hs-identifier hs-var">sha</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2062"></a><span>                            </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792943"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792945"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegReg"><span class="hs-identifier hs-var">AddrRegReg</span></a><span> </span><a href="#local-6989586621684792948"><span class="hs-identifier hs-var">tableReg</span></a><span> </span><a href="#local-6989586621684792945"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2063"></a><span>                            </span><a href="PPC.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684792945"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792945"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792948"><span class="hs-identifier hs-var">tableReg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2064"></a><span>                            </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="#local-6989586621684792945"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span>
</span><a name="line-2065"></a><span>                            </span><a href="PPC.Instr.html#BCTR"><span class="hs-identifier hs-var">BCTR</span></a><span> </span><a href="#local-6989586621684792930"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684792946"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-2066"></a><span>                    </span><span class="hs-special">]</span><span>
</span><a name="line-2067"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684792950"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2068"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2069"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2070"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792951"><a href="#local-6989586621684792951"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684792952"><a href="#local-6989586621684792952"><span class="hs-identifier">e_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmUtils.html#cmmOffset"><span class="hs-identifier hs-var">cmmOffset</span></a><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684792927"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621684792929"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-2071"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792953"><a href="#local-6989586621684792953"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2072"></a><span>            </span><a name="local-6989586621684792954"><a href="#local-6989586621684792954"><span class="hs-identifier">sha</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-2073"></a><span>        </span><a name="local-6989586621684792955"><a href="#local-6989586621684792955"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684792953"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-2074"></a><span>        </span><a name="local-6989586621684792956"><a href="#local-6989586621684792956"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-2075"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792957"><a href="#local-6989586621684792957"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792952"><span class="hs-identifier hs-var">e_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2076"></a><span>                            </span><a href="PPC.Instr.html#SL"><span class="hs-identifier hs-var">SL</span></a><span> </span><a href="#local-6989586621684792953"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792955"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792951"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684792954"><span class="hs-identifier hs-var">sha</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2077"></a><span>                            </span><a href="PPC.Instr.html#ADDIS"><span class="hs-identifier hs-var">ADDIS</span></a><span> </span><a href="#local-6989586621684792955"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684792955"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#HA"><span class="hs-identifier hs-var">HA</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684792956"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2078"></a><span>                            </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="#local-6989586621684792953"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684792955"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684792955"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#LO"><span class="hs-identifier hs-var">LO</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684792956"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2079"></a><span>                            </span><a href="PPC.Instr.html#MTCTR"><span class="hs-identifier hs-var">MTCTR</span></a><span> </span><a href="#local-6989586621684792955"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span>
</span><a name="line-2080"></a><span>                            </span><a href="PPC.Instr.html#BCTR"><span class="hs-identifier hs-var">BCTR</span></a><span> </span><a href="#local-6989586621684792930"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684792956"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-2081"></a><span>                    </span><span class="hs-special">]</span><span>
</span><a name="line-2082"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684792957"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2083"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684792929"><a href="#local-6989586621684792929"><span class="hs-identifier">offset</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792930"><a href="#local-6989586621684792930"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmSwitch.html#switchTargetsToTable"><span class="hs-identifier hs-var">switchTargetsToTable</span></a><span> </span><a href="#local-6989586621684792928"><span class="hs-identifier hs-var">targets</span></a><span>
</span><a name="line-2084"></a><span>
</span><a name="line-2085"></a><span class="hs-identifier">generateJumpTableForInstr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span>
</span><a name="line-2086"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2087"></a><a name="generateJumpTableForInstr"><a href="PPC.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier">generateJumpTableForInstr</span></a></a><span> </span><a name="local-6989586621684792958"><a href="#local-6989586621684792958"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#BCTR"><span class="hs-identifier hs-var">BCTR</span></a><span> </span><a name="local-6989586621684792959"><a href="#local-6989586621684792959"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792960"><a href="#local-6989586621684792960"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2088"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792961"><a href="#local-6989586621684792961"><span class="hs-identifier">jumpTable</span></a></a><span>
</span><a name="line-2089"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">positionIndependent</span><span> </span><a href="#local-6989586621684792958"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2090"></a><span>              </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792958"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2091"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684792962"><span class="hs-identifier hs-var">jumpTableEntryRel</span></a><span> </span><a href="#local-6989586621684792959"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-2092"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#jumpTableEntry"><span class="hs-identifier hs-var">jumpTableEntry</span></a><span> </span><a href="#local-6989586621684792958"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792959"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-2093"></a><span>                </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792962"><a href="#local-6989586621684792962"><span class="hs-identifier">jumpTableEntryRel</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2094"></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684792958"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2095"></a><span>                      </span><span class="hs-identifier">jumpTableEntryRel</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792963"><a href="#local-6989586621684792963"><span class="hs-identifier">blockid</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2096"></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabelDiffOff"><span class="hs-identifier hs-var">CmmLabelDiffOff</span></a><span> </span><a href="#local-6989586621684792964"><span class="hs-identifier hs-var">blockLabel</span></a><span> </span><a href="#local-6989586621684792960"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2097"></a><span>                                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684792958"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2098"></a><span>                            </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684792964"><a href="#local-6989586621684792964"><span class="hs-identifier">blockLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BlockId.html#blockLbl"><span class="hs-identifier hs-var">blockLbl</span></a><span> </span><a href="#local-6989586621684792963"><span class="hs-identifier hs-var">blockid</span></a><span>
</span><a name="line-2099"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><a href="#local-6989586621684792960"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#Statics"><span class="hs-identifier hs-var">Statics</span></a><span> </span><a href="#local-6989586621684792960"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621684792961"><span class="hs-identifier hs-var">jumpTable</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2100"></a><span class="hs-identifier">generateJumpTableForInstr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2101"></a><span>
</span><a name="line-2102"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-2103"></a><span class="hs-comment">-- 'condIntReg' and 'condFltReg': condition codes into registers</span><span>
</span><a name="line-2104"></a><span>
</span><a name="line-2105"></a><span class="hs-comment">-- Turn those condition codes into integers now (when they appear on</span><span>
</span><a name="line-2106"></a><span class="hs-comment">-- the right hand side of an assignment).</span><span>
</span><a name="line-2107"></a><span>
</span><a name="line-2108"></a><span>
</span><a name="line-2109"></a><span>
</span><a name="line-2110"></a><span class="hs-identifier">condReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2111"></a><a name="condReg"><a href="PPC.CodeGen.html#condReg"><span class="hs-identifier">condReg</span></a></a><span> </span><a name="local-6989586621684792965"><a href="#local-6989586621684792965"><span class="hs-identifier">getCond</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2112"></a><span>    </span><a href="PPC.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792966"><a href="#local-6989586621684792966"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684792967"><a href="#local-6989586621684792967"><span class="hs-identifier">cond_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684792965"><span class="hs-identifier hs-var">getCond</span></a><span>
</span><a name="line-2113"></a><span>    </span><a name="local-6989586621684792968"><a href="#local-6989586621684792968"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2114"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2115"></a><span>        </span><a name="local-6989586621684792969"><a href="#local-6989586621684792969"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792974"><a href="#local-6989586621684792974"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792967"><span class="hs-identifier hs-var">cond_code</span></a><span>
</span><a name="line-2116"></a><span>            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792970"><span class="hs-identifier hs-var">negate_code</span></a><span>
</span><a name="line-2117"></a><span>            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2118"></a><span>                </span><a href="PPC.Instr.html#MFCR"><span class="hs-identifier hs-var">MFCR</span></a><span> </span><a href="#local-6989586621684792974"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">,</span><span>
</span><a name="line-2119"></a><span>                </span><a href="PPC.Instr.html#RLWINM"><span class="hs-identifier hs-var">RLWINM</span></a><span> </span><a href="#local-6989586621684792974"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792974"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684792971"><span class="hs-identifier hs-var">bit</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-number">31</span><span> </span><span class="hs-number">31</span><span>
</span><a name="line-2120"></a><span>            </span><span class="hs-special">]</span><span>
</span><a name="line-2121"></a><span>
</span><a name="line-2122"></a><span>        </span><a name="local-6989586621684792970"><a href="#local-6989586621684792970"><span class="hs-identifier">negate_code</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684792972"><span class="hs-identifier hs-var">do_negate</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#CRNOR"><span class="hs-identifier hs-var">CRNOR</span></a><span> </span><a href="#local-6989586621684792971"><span class="hs-identifier hs-var">bit</span></a><span> </span><a href="#local-6989586621684792971"><span class="hs-identifier hs-var">bit</span></a><span> </span><a href="#local-6989586621684792971"><span class="hs-identifier hs-var">bit</span></a><span class="hs-special">)</span><span>
</span><a name="line-2123"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2124"></a><span>
</span><a name="line-2125"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792971"><a href="#local-6989586621684792971"><span class="hs-identifier">bit</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792972"><a href="#local-6989586621684792972"><span class="hs-identifier">do_negate</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684792966"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2126"></a><span>            </span><a href="PPC.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2127"></a><span>            </span><a href="PPC.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-2128"></a><span>            </span><a href="PPC.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2129"></a><span>            </span><a href="PPC.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-2130"></a><span>            </span><a href="PPC.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2131"></a><span>
</span><a name="line-2132"></a><span>            </span><a href="PPC.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-2133"></a><span>
</span><a name="line-2134"></a><span>            </span><a href="PPC.Cond.html#LU"><span class="hs-identifier hs-var">LU</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2135"></a><span>            </span><a href="PPC.Cond.html#LEU"><span class="hs-identifier hs-var">LEU</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-2136"></a><span>            </span><a href="PPC.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-2137"></a><span>            </span><a href="PPC.Cond.html#GU"><span class="hs-identifier hs-var">GU</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-2138"></a><span>            </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.codeReg: no match&quot;</span><span>
</span><a name="line-2139"></a><span>
</span><a name="line-2140"></a><span>        </span><a name="local-6989586621684792973"><a href="#local-6989586621684792973"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684792968"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2141"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684792973"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684792969"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2142"></a><span>
</span><a name="line-2143"></a><span class="hs-identifier">condIntReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PPC.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2144"></a><a name="condIntReg"><a href="PPC.CodeGen.html#condIntReg"><span class="hs-identifier">condIntReg</span></a></a><span> </span><a name="local-6989586621684792975"><a href="#local-6989586621684792975"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684792976"><a href="#local-6989586621684792976"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684792977"><a href="#local-6989586621684792977"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684792978"><a href="#local-6989586621684792978"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#condReg"><span class="hs-identifier hs-var">condReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="#local-6989586621684792975"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792976"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684792977"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792978"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-2145"></a><span class="hs-identifier">condFltReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PPC.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2146"></a><a name="condFltReg"><a href="PPC.CodeGen.html#condFltReg"><span class="hs-identifier">condFltReg</span></a></a><span> </span><a name="local-6989586621684792979"><a href="#local-6989586621684792979"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684792980"><a href="#local-6989586621684792980"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684792981"><a href="#local-6989586621684792981"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#condReg"><span class="hs-identifier hs-var">condReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="#local-6989586621684792979"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684792980"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684792981"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-2147"></a><span>
</span><a name="line-2148"></a><span>
</span><a name="line-2149"></a><span>
</span><a name="line-2150"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-2151"></a><span class="hs-comment">-- 'trivial*Code': deal with trivial instructions</span><span>
</span><a name="line-2152"></a><span>
</span><a name="line-2153"></a><span class="hs-comment">-- Trivial (dyadic: 'trivialCode', floating-point: 'trivialFCode',</span><span>
</span><a name="line-2154"></a><span class="hs-comment">-- unary: 'trivialUCode', unary fl-pt:'trivialUFCode') instructions.</span><span>
</span><a name="line-2155"></a><span class="hs-comment">-- Only look for constants on the right hand side, because that's</span><span>
</span><a name="line-2156"></a><span class="hs-comment">-- where the generic optimizer will have put them.</span><span>
</span><a name="line-2157"></a><span>
</span><a name="line-2158"></a><span class="hs-comment">-- Similarly, for unary instructions, we don't have to worry about</span><span>
</span><a name="line-2159"></a><span class="hs-comment">-- matching an StInt as the argument, because genericOpt will already</span><span>
</span><a name="line-2160"></a><span class="hs-comment">-- have handled the constant-folding.</span><span>
</span><a name="line-2161"></a><span>
</span><a name="line-2162"></a><span>
</span><a name="line-2163"></a><span>
</span><a name="line-2164"></a><span class="hs-comment">{-
Wolfgang's PowerPC version of The Rules:

A slightly modified version of The Rules to take advantage of the fact
that PowerPC instructions work on all registers and don't implicitly
clobber any fixed registers.

* The only expression for which getRegister returns Fixed is (CmmReg reg).

* If getRegister returns Any, then the code it generates may modify only:
        (a) fresh temporaries
        (b) the destination register
  It may *not* modify global registers, unless the global
  register happens to be the destination register.
  It may not clobber any other registers. In fact, only ccalls clobber any
  fixed registers.
  Also, it may not modify the counter register (used by genCCall).

  Corollary: If a getRegister for a subexpression returns Fixed, you need
  not move it to a fresh temporary before evaluating the next subexpression.
  The Fixed register won't be modified.
  Therefore, we don't need a counterpart for the x86's getStableReg on PPC.

* SDM's First Rule is valid for PowerPC, too: subexpressions can depend on
  the value of the destination register.
-}</span><span>
</span><a name="line-2190"></a><span>
</span><a name="line-2191"></a><span class="hs-identifier">trivialCode</span><span>
</span><a name="line-2192"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span>
</span><a name="line-2193"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2194"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#RI"><span class="hs-identifier hs-type">RI</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2195"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-2196"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-2197"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2198"></a><span>
</span><a name="line-2199"></a><a name="trivialCode"><a href="PPC.CodeGen.html#trivialCode"><span class="hs-identifier">trivialCode</span></a></a><span> </span><a name="local-6989586621684792982"><a href="#local-6989586621684792982"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684792983"><a href="#local-6989586621684792983"><span class="hs-identifier">signed</span></a></a><span> </span><a name="local-6989586621684792984"><a href="#local-6989586621684792984"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684792985"><a href="#local-6989586621684792985"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684792986"><a href="#local-6989586621684792986"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2200"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684792987"><a href="#local-6989586621684792987"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684792982"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684792983"><span class="hs-identifier hs-var">signed</span></a><span> </span><a href="#local-6989586621684792986"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-2201"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2202"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684792988"><a href="#local-6989586621684792988"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792989"><a href="#local-6989586621684792989"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792985"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2203"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684792990"><a href="#local-6989586621684792990"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684792991"><a href="#local-6989586621684792991"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792989"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792984"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684792991"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792988"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684792987"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span>
</span><a name="line-2204"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792982"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684792990"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2205"></a><span>
</span><a name="line-2206"></a><span class="hs-identifier">trivialCode</span><span> </span><a name="local-6989586621684792992"><a href="#local-6989586621684792992"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684792993"><a href="#local-6989586621684792993"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684792994"><a href="#local-6989586621684792994"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684792995"><a href="#local-6989586621684792995"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2207"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792996"><a href="#local-6989586621684792996"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792997"><a href="#local-6989586621684792997"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792994"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2208"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684792998"><a href="#local-6989586621684792998"><span class="hs-identifier">src2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684792999"><a href="#local-6989586621684792999"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684792995"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-2209"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793000"><a href="#local-6989586621684793000"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684793001"><a href="#local-6989586621684793001"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684792997"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792999"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684792993"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684793001"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684792996"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684792998"><span class="hs-identifier hs-var">src2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2210"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684792992"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793000"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2211"></a><span>
</span><a name="line-2212"></a><span class="hs-identifier">shiftMulCode</span><span>
</span><a name="line-2213"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span>
</span><a name="line-2214"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2215"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#RI"><span class="hs-identifier hs-type">RI</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2216"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-2217"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-2218"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2219"></a><a name="shiftMulCode"><a href="PPC.CodeGen.html#shiftMulCode"><span class="hs-identifier">shiftMulCode</span></a></a><span> </span><a name="local-6989586621684793002"><a href="#local-6989586621684793002"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684793003"><a href="#local-6989586621684793003"><span class="hs-identifier">sign</span></a></a><span> </span><a name="local-6989586621684793004"><a href="#local-6989586621684793004"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684793005"><a href="#local-6989586621684793005"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684793006"><a href="#local-6989586621684793006"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2220"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684793007"><a href="#local-6989586621684793007"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684793002"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684793003"><span class="hs-identifier hs-var">sign</span></a><span> </span><a href="#local-6989586621684793006"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-2221"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2222"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684793008"><a href="#local-6989586621684793008"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793009"><a href="#local-6989586621684793009"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793005"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2223"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793010"><a href="#local-6989586621684793010"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793002"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2224"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793011"><a href="#local-6989586621684793011"><span class="hs-identifier">ins_fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684793002"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span>
</span><a name="line-2225"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793012"><a href="#local-6989586621684793012"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684793013"><a href="#local-6989586621684793013"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793009"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793004"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684793011"><span class="hs-identifier hs-var">ins_fmt</span></a><span> </span><a href="#local-6989586621684793013"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793008"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684793007"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span>
</span><a name="line-2226"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684793010"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684793012"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2227"></a><span>
</span><a name="line-2228"></a><span class="hs-identifier">shiftMulCode</span><span> </span><a name="local-6989586621684793014"><a href="#local-6989586621684793014"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684793015"><a href="#local-6989586621684793015"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684793016"><a href="#local-6989586621684793016"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684793017"><a href="#local-6989586621684793017"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2229"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793018"><a href="#local-6989586621684793018"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793019"><a href="#local-6989586621684793019"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793016"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2230"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793020"><a href="#local-6989586621684793020"><span class="hs-identifier">src2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793021"><a href="#local-6989586621684793021"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793017"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-2231"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793022"><a href="#local-6989586621684793022"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793014"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2232"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793023"><a href="#local-6989586621684793023"><span class="hs-identifier">ins_fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684793014"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span>
</span><a name="line-2233"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793024"><a href="#local-6989586621684793024"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684793025"><a href="#local-6989586621684793025"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793019"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793021"><span class="hs-identifier hs-var">code2</span></a><span>
</span><a name="line-2234"></a><span>                   </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793015"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684793023"><span class="hs-identifier hs-var">ins_fmt</span></a><span> </span><a href="#local-6989586621684793025"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793018"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684793020"><span class="hs-identifier hs-var">src2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2235"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684793022"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684793024"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2236"></a><span>
</span><a name="line-2237"></a><span class="hs-identifier">trivialCodeNoImm'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2238"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2239"></a><a name="trivialCodeNoImm%27"><a href="PPC.CodeGen.html#trivialCodeNoImm%27"><span class="hs-identifier">trivialCodeNoImm'</span></a></a><span> </span><a name="local-6989586621684793026"><a href="#local-6989586621684793026"><span class="hs-identifier">format</span></a></a><span> </span><a name="local-6989586621684793027"><a href="#local-6989586621684793027"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684793028"><a href="#local-6989586621684793028"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684793029"><a href="#local-6989586621684793029"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2240"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793030"><a href="#local-6989586621684793030"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793031"><a href="#local-6989586621684793031"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793028"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2241"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793032"><a href="#local-6989586621684793032"><span class="hs-identifier">src2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793033"><a href="#local-6989586621684793033"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793029"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-2242"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793034"><a href="#local-6989586621684793034"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684793035"><a href="#local-6989586621684793035"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793031"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793033"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793027"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684793035"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793030"><span class="hs-identifier hs-var">src1</span></a><span> </span><a href="#local-6989586621684793032"><span class="hs-identifier hs-var">src2</span></a><span>
</span><a name="line-2243"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684793026"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684793034"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2244"></a><span>
</span><a name="line-2245"></a><span class="hs-identifier">trivialCodeNoImm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2246"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2247"></a><a name="trivialCodeNoImm"><a href="PPC.CodeGen.html#trivialCodeNoImm"><span class="hs-identifier">trivialCodeNoImm</span></a></a><span> </span><a name="local-6989586621684793036"><a href="#local-6989586621684793036"><span class="hs-identifier">format</span></a></a><span> </span><a name="local-6989586621684793037"><a href="#local-6989586621684793037"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684793038"><a href="#local-6989586621684793038"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684793039"><a href="#local-6989586621684793039"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-2248"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PPC.CodeGen.html#trivialCodeNoImm%27"><span class="hs-identifier hs-var">trivialCodeNoImm'</span></a><span> </span><a href="#local-6989586621684793036"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684793037"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684793036"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793038"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684793039"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-2249"></a><span>
</span><a name="line-2250"></a><span class="hs-identifier">srCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#RI"><span class="hs-identifier hs-type">RI</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2251"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2252"></a><a name="srCode"><a href="PPC.CodeGen.html#srCode"><span class="hs-identifier">srCode</span></a></a><span> </span><a name="local-6989586621684793040"><a href="#local-6989586621684793040"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684793041"><a href="#local-6989586621684793041"><span class="hs-identifier">sgn</span></a></a><span> </span><a name="local-6989586621684793042"><a href="#local-6989586621684793042"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684793043"><a href="#local-6989586621684793043"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684793044"><a href="#local-6989586621684793044"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2253"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684793045"><a href="#local-6989586621684793045"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.Regs.html#makeImmediate"><span class="hs-identifier hs-var">makeImmediate</span></a><span> </span><a href="#local-6989586621684793040"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684793041"><span class="hs-identifier hs-var">sgn</span></a><span> </span><a href="#local-6989586621684793044"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-2254"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2255"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793046"><a href="#local-6989586621684793046"><span class="hs-identifier">op_len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684793040"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2256"></a><span>            </span><a name="local-6989586621684793047"><a href="#local-6989586621684793047"><span class="hs-identifier">extend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684793041"><span class="hs-identifier hs-var">sgn</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PPC.CodeGen.html#extendSExpr"><span class="hs-identifier hs-var">extendSExpr</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PPC.CodeGen.html#extendUExpr"><span class="hs-identifier hs-var">extendUExpr</span></a><span>
</span><a name="line-2257"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684793048"><a href="#local-6989586621684793048"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793049"><a href="#local-6989586621684793049"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684793047"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684793040"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684793046"><span class="hs-identifier hs-var">op_len</span></a><span> </span><a href="#local-6989586621684793043"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-2258"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793050"><a href="#local-6989586621684793050"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684793051"><a href="#local-6989586621684793051"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793049"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2259"></a><span>                       </span><a href="#local-6989586621684793042"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793046"><span class="hs-identifier hs-var">op_len</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793051"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793048"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><a href="#local-6989586621684793045"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span>
</span><a name="line-2260"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793040"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793050"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2261"></a><span>
</span><a name="line-2262"></a><span class="hs-identifier">srCode</span><span> </span><a name="local-6989586621684793052"><a href="#local-6989586621684793052"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684793053"><a href="#local-6989586621684793053"><span class="hs-identifier">sgn</span></a></a><span> </span><a name="local-6989586621684793054"><a href="#local-6989586621684793054"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684793055"><a href="#local-6989586621684793055"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684793056"><a href="#local-6989586621684793056"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2263"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793057"><a href="#local-6989586621684793057"><span class="hs-identifier">op_len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684793052"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2264"></a><span>      </span><a name="local-6989586621684793058"><a href="#local-6989586621684793058"><span class="hs-identifier">extend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684793053"><span class="hs-identifier hs-var">sgn</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PPC.CodeGen.html#extendSExpr"><span class="hs-identifier hs-var">extendSExpr</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PPC.CodeGen.html#extendUExpr"><span class="hs-identifier hs-var">extendUExpr</span></a><span>
</span><a name="line-2265"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684793059"><a href="#local-6989586621684793059"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793060"><a href="#local-6989586621684793060"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684793058"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684793052"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684793057"><span class="hs-identifier hs-var">op_len</span></a><span> </span><a href="#local-6989586621684793055"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-2266"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684793061"><a href="#local-6989586621684793061"><span class="hs-identifier">src2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793062"><a href="#local-6989586621684793062"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#extendUExpr"><span class="hs-identifier hs-var">extendUExpr</span></a><span> </span><a href="#local-6989586621684793052"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684793057"><span class="hs-identifier hs-var">op_len</span></a><span> </span><a href="#local-6989586621684793056"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-2267"></a><span>  </span><span class="hs-comment">-- Note: Shift amount `y` is unsigned</span><span>
</span><a name="line-2268"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793063"><a href="#local-6989586621684793063"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684793064"><a href="#local-6989586621684793064"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793060"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793062"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2269"></a><span>                 </span><a href="#local-6989586621684793054"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793057"><span class="hs-identifier hs-var">op_len</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793064"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793059"><span class="hs-identifier hs-var">src1</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684793061"><span class="hs-identifier hs-var">src2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2270"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793052"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793063"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2271"></a><span>
</span><a name="line-2272"></a><span class="hs-identifier">divCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2273"></a><a name="divCode"><a href="PPC.CodeGen.html#divCode"><span class="hs-identifier">divCode</span></a></a><span> </span><a name="local-6989586621684793065"><a href="#local-6989586621684793065"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684793066"><a href="#local-6989586621684793066"><span class="hs-identifier">sgn</span></a></a><span> </span><a name="local-6989586621684793067"><a href="#local-6989586621684793067"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684793068"><a href="#local-6989586621684793068"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2274"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793069"><a href="#local-6989586621684793069"><span class="hs-identifier">op_len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684793065"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2275"></a><span>      </span><a name="local-6989586621684793070"><a href="#local-6989586621684793070"><span class="hs-identifier">extend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684793066"><span class="hs-identifier hs-var">sgn</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PPC.CodeGen.html#extendSExpr"><span class="hs-identifier hs-var">extendSExpr</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PPC.CodeGen.html#extendUExpr"><span class="hs-identifier hs-var">extendUExpr</span></a><span>
</span><a name="line-2276"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684793071"><a href="#local-6989586621684793071"><span class="hs-identifier">src1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793072"><a href="#local-6989586621684793072"><span class="hs-identifier">code1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684793070"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684793065"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684793069"><span class="hs-identifier hs-var">op_len</span></a><span> </span><a href="#local-6989586621684793067"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-2277"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684793073"><a href="#local-6989586621684793073"><span class="hs-identifier">src2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793074"><a href="#local-6989586621684793074"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684793070"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684793065"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684793069"><span class="hs-identifier hs-var">op_len</span></a><span> </span><a href="#local-6989586621684793068"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-2278"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793075"><a href="#local-6989586621684793075"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684793076"><a href="#local-6989586621684793076"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793072"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793074"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2279"></a><span>                 </span><a href="PPC.Instr.html#DIV"><span class="hs-identifier hs-var">DIV</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793069"><span class="hs-identifier hs-var">op_len</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793066"><span class="hs-identifier hs-var">sgn</span></a><span> </span><a href="#local-6989586621684793076"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793071"><span class="hs-identifier hs-var">src1</span></a><span> </span><a href="#local-6989586621684793073"><span class="hs-identifier hs-var">src2</span></a><span>
</span><a name="line-2280"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793065"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793075"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2281"></a><span>
</span><a name="line-2282"></a><span>
</span><a name="line-2283"></a><span class="hs-identifier">trivialUCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span>
</span><a name="line-2284"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2285"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-2286"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2287"></a><a name="trivialUCode"><a href="PPC.CodeGen.html#trivialUCode"><span class="hs-identifier">trivialUCode</span></a></a><span> </span><a name="local-6989586621684793077"><a href="#local-6989586621684793077"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684793078"><a href="#local-6989586621684793078"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684793079"><a href="#local-6989586621684793079"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2288"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793080"><a href="#local-6989586621684793080"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793081"><a href="#local-6989586621684793081"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793079"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2289"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793082"><a href="#local-6989586621684793082"><span class="hs-identifier">code'</span></a></a><span> </span><a name="local-6989586621684793083"><a href="#local-6989586621684793083"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793081"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793078"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684793083"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793080"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2290"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684793077"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684793082"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2291"></a><span>
</span><a name="line-2292"></a><span class="hs-comment">-- There is no &quot;remainder&quot; instruction on the PPC, so we have to do</span><span>
</span><a name="line-2293"></a><span class="hs-comment">-- it the hard way.</span><span>
</span><a name="line-2294"></a><span class="hs-comment">-- The &quot;sgn&quot; parameter is the signedness for the division instruction</span><span>
</span><a name="line-2295"></a><span>
</span><a name="line-2296"></a><span class="hs-identifier">remainderCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-2297"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PPC.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-2298"></a><a name="remainderCode"><a href="PPC.CodeGen.html#remainderCode"><span class="hs-identifier">remainderCode</span></a></a><span> </span><a name="local-6989586621684793084"><a href="#local-6989586621684793084"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684793085"><a href="#local-6989586621684793085"><span class="hs-identifier">sgn</span></a></a><span> </span><a name="local-6989586621684793086"><a href="#local-6989586621684793086"><span class="hs-identifier">reg_q</span></a></a><span> </span><a name="local-6989586621684793087"><a href="#local-6989586621684793087"><span class="hs-identifier">arg_x</span></a></a><span> </span><a name="local-6989586621684793088"><a href="#local-6989586621684793088"><span class="hs-identifier">arg_y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2299"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793089"><a href="#local-6989586621684793089"><span class="hs-identifier">op_len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684793084"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-2300"></a><span>      </span><a name="local-6989586621684793090"><a href="#local-6989586621684793090"><span class="hs-identifier">fmt</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793089"><span class="hs-identifier hs-var">op_len</span></a><span>
</span><a name="line-2301"></a><span>      </span><a name="local-6989586621684793091"><a href="#local-6989586621684793091"><span class="hs-identifier">extend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684793085"><span class="hs-identifier hs-var">sgn</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PPC.CodeGen.html#extendSExpr"><span class="hs-identifier hs-var">extendSExpr</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PPC.CodeGen.html#extendUExpr"><span class="hs-identifier hs-var">extendUExpr</span></a><span>
</span><a name="line-2302"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684793092"><a href="#local-6989586621684793092"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793093"><a href="#local-6989586621684793093"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684793091"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684793084"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684793089"><span class="hs-identifier hs-var">op_len</span></a><span> </span><a href="#local-6989586621684793087"><span class="hs-identifier hs-var">arg_x</span></a><span class="hs-special">)</span><span>
</span><a name="line-2303"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684793094"><a href="#local-6989586621684793094"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793095"><a href="#local-6989586621684793095"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684793091"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="#local-6989586621684793084"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684793089"><span class="hs-identifier hs-var">op_len</span></a><span> </span><a href="#local-6989586621684793088"><span class="hs-identifier hs-var">arg_y</span></a><span class="hs-special">)</span><span>
</span><a name="line-2304"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684793096"><a href="#local-6989586621684793096"><span class="hs-identifier">reg_r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684793095"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793093"><span class="hs-identifier hs-var">x_code</span></a><span>
</span><a name="line-2305"></a><span>                     </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="PPC.Instr.html#DIV"><span class="hs-identifier hs-var">DIV</span></a><span> </span><a href="#local-6989586621684793090"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684793085"><span class="hs-identifier hs-var">sgn</span></a><span> </span><a href="#local-6989586621684793086"><span class="hs-identifier hs-var">reg_q</span></a><span> </span><a href="#local-6989586621684793092"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684793094"><span class="hs-identifier hs-var">y_reg</span></a><span>
</span><a name="line-2306"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#MULL"><span class="hs-identifier hs-var">MULL</span></a><span> </span><a href="#local-6989586621684793090"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684793096"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684793086"><span class="hs-identifier hs-var">reg_q</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684793094"><span class="hs-identifier hs-var">y_reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2307"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="PPC.Instr.html#SUBF"><span class="hs-identifier hs-var">SUBF</span></a><span> </span><a href="#local-6989586621684793096"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684793096"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><a href="#local-6989586621684793092"><span class="hs-identifier hs-var">x_reg</span></a><span>
</span><a name="line-2308"></a><span>                                  </span><span class="hs-special">]</span><span>
</span><a name="line-2309"></a><span>
</span><a name="line-2310"></a><span>
</span><a name="line-2311"></a><span class="hs-identifier">coerceInt2FP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2312"></a><a name="coerceInt2FP"><a href="PPC.CodeGen.html#coerceInt2FP"><span class="hs-identifier">coerceInt2FP</span></a></a><span> </span><a name="local-6989586621684793097"><a href="#local-6989586621684793097"><span class="hs-identifier">fromRep</span></a></a><span> </span><a name="local-6989586621684793098"><a href="#local-6989586621684793098"><span class="hs-identifier">toRep</span></a></a><span> </span><a name="local-6989586621684793099"><a href="#local-6989586621684793099"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2313"></a><span>    </span><a name="local-6989586621684793100"><a href="#local-6989586621684793100"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2314"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793101"><a href="#local-6989586621684793101"><span class="hs-identifier">arch</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">platformArch</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684793100"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2315"></a><span>    </span><a href="PPC.CodeGen.html#coerceInt2FP%27"><span class="hs-identifier hs-var">coerceInt2FP'</span></a><span> </span><a href="#local-6989586621684793101"><span class="hs-identifier hs-var">arch</span></a><span> </span><a href="#local-6989586621684793097"><span class="hs-identifier hs-var">fromRep</span></a><span> </span><a href="#local-6989586621684793098"><span class="hs-identifier hs-var">toRep</span></a><span> </span><a href="#local-6989586621684793099"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2316"></a><span>
</span><a name="line-2317"></a><span class="hs-identifier">coerceInt2FP'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arch</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2318"></a><a name="coerceInt2FP%27"><a href="PPC.CodeGen.html#coerceInt2FP%27"><span class="hs-identifier">coerceInt2FP'</span></a></a><span> </span><span class="hs-identifier hs-var">ArchPPC</span><span> </span><a name="local-6989586621684793102"><a href="#local-6989586621684793102"><span class="hs-identifier">fromRep</span></a></a><span> </span><a name="local-6989586621684793103"><a href="#local-6989586621684793103"><span class="hs-identifier">toRep</span></a></a><span> </span><a name="local-6989586621684793104"><a href="#local-6989586621684793104"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2319"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793105"><a href="#local-6989586621684793105"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793106"><a href="#local-6989586621684793106"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793104"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2320"></a><span>    </span><a name="local-6989586621684793107"><a href="#local-6989586621684793107"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-2321"></a><span>    </span><a name="local-6989586621684793108"><a href="#local-6989586621684793108"><span class="hs-identifier">itmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-2322"></a><span>    </span><a name="local-6989586621684793109"><a href="#local-6989586621684793109"><span class="hs-identifier">ftmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span>
</span><a name="line-2323"></a><span>    </span><a name="local-6989586621684793110"><a href="#local-6989586621684793110"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2324"></a><span>    </span><a name="local-6989586621684793111"><a href="#local-6989586621684793111"><span class="hs-identifier">dynRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684793110"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a><span> </span><a href="#local-6989586621684793107"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2325"></a><span>    </span><a href="PPC.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684793112"><a href="#local-6989586621684793112"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684793113"><a href="#local-6989586621684793113"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="PPC.CodeGen.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><a href="#local-6989586621684793111"><span class="hs-identifier hs-var">dynRef</span></a><span>
</span><a name="line-2326"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2327"></a><span>        </span><a name="local-6989586621684793114"><a href="#local-6989586621684793114"><span class="hs-identifier">code'</span></a></a><span> </span><a name="local-6989586621684793117"><a href="#local-6989586621684793117"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793106"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793115"><span class="hs-identifier hs-var">maybe_exts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2328"></a><span>                </span><a href="PPC.Instr.html#LDATA"><span class="hs-identifier hs-var">LDATA</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><a href="#local-6989586621684793107"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cmm.html#Statics"><span class="hs-identifier hs-var">Statics</span></a><span> </span><a href="#local-6989586621684793107"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2329"></a><span>                                 </span><span class="hs-special">[</span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0x43300000</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2330"></a><span>                                  </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0x80000000</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-2331"></a><span>                </span><a href="PPC.Instr.html#XORIS"><span class="hs-identifier hs-var">XORIS</span></a><span> </span><a href="#local-6989586621684793108"><span class="hs-identifier hs-var">itmp</span></a><span> </span><a href="#local-6989586621684793105"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0x8000</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2332"></a><span>                </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684793108"><span class="hs-identifier hs-var">itmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793110"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2333"></a><span>                </span><a href="PPC.Instr.html#LIS"><span class="hs-identifier hs-var">LIS</span></a><span> </span><a href="#local-6989586621684793108"><span class="hs-identifier hs-var">itmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0x4330</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2334"></a><span>                </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684793108"><span class="hs-identifier hs-var">itmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793110"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2335"></a><span>                </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684793109"><span class="hs-identifier hs-var">ftmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793110"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-2336"></a><span>            </span><span class="hs-special">]</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793113"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2337"></a><span>                </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684793117"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793112"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">,</span><span>
</span><a name="line-2338"></a><span>                </span><a href="PPC.Instr.html#FSUB"><span class="hs-identifier hs-var">FSUB</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684793117"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793109"><span class="hs-identifier hs-var">ftmp</span></a><span> </span><a href="#local-6989586621684793117"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-2339"></a><span>            </span><span class="hs-special">]</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793116"><span class="hs-identifier hs-var">maybe_frsp</span></a><span> </span><a href="#local-6989586621684793117"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-2340"></a><span>
</span><a name="line-2341"></a><span>        </span><a name="local-6989586621684793115"><a href="#local-6989586621684793115"><span class="hs-identifier">maybe_exts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684793102"><span class="hs-identifier hs-var">fromRep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2342"></a><span>                        </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#EXTS"><span class="hs-identifier hs-var">EXTS</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><a href="#local-6989586621684793105"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684793105"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2343"></a><span>                        </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#EXTS"><span class="hs-identifier hs-var">EXTS</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><a href="#local-6989586621684793105"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684793105"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2344"></a><span>                        </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2345"></a><span>                        </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.coerceInt2FP: no match&quot;</span><span>
</span><a name="line-2346"></a><span>
</span><a name="line-2347"></a><span>        </span><a name="local-6989586621684793116"><a href="#local-6989586621684793116"><span class="hs-identifier">maybe_frsp</span></a></a><span> </span><a name="local-6989586621684793118"><a href="#local-6989586621684793118"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-2348"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684793103"><span class="hs-identifier hs-var">toRep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2349"></a><span>                        </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#FRSP"><span class="hs-identifier hs-var">FRSP</span></a><span> </span><a href="#local-6989586621684793118"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793118"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-2350"></a><span>                        </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2351"></a><span>                        </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.coerceInt2FP: no match&quot;</span><span>
</span><a name="line-2352"></a><span>
</span><a name="line-2353"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684793103"><span class="hs-identifier hs-var">toRep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793114"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2354"></a><span>
</span><a name="line-2355"></a><span class="hs-comment">-- On an ELF v1 Linux we use the compiler doubleword in the stack frame</span><span>
</span><a name="line-2356"></a><span class="hs-comment">-- this is the TOC pointer doubleword on ELF v2 Linux. The latter is only</span><span>
</span><a name="line-2357"></a><span class="hs-comment">-- set right before a call and restored right after return from the call.</span><span>
</span><a name="line-2358"></a><span class="hs-comment">-- So it is fine.</span><span>
</span><a name="line-2359"></a><span class="hs-identifier">coerceInt2FP'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684793119"><a href="#local-6989586621684793119"><span class="hs-identifier">fromRep</span></a></a><span> </span><a name="local-6989586621684793120"><a href="#local-6989586621684793120"><span class="hs-identifier">toRep</span></a></a><span> </span><a name="local-6989586621684793121"><a href="#local-6989586621684793121"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2360"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793122"><a href="#local-6989586621684793122"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793123"><a href="#local-6989586621684793123"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793121"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2361"></a><span>    </span><a name="local-6989586621684793124"><a href="#local-6989586621684793124"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2362"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2363"></a><span>        </span><a name="local-6989586621684793125"><a href="#local-6989586621684793125"><span class="hs-identifier">code'</span></a></a><span> </span><a name="local-6989586621684793128"><a href="#local-6989586621684793128"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793123"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793126"><span class="hs-identifier hs-var">maybe_exts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2364"></a><span>                </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684793122"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793124"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2365"></a><span>                </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684793128"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793124"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2366"></a><span>                </span><a href="PPC.Instr.html#FCFID"><span class="hs-identifier hs-var">FCFID</span></a><span> </span><a href="#local-6989586621684793128"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793128"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-2367"></a><span>            </span><span class="hs-special">]</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684793127"><span class="hs-identifier hs-var">maybe_frsp</span></a><span> </span><a href="#local-6989586621684793128"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-2368"></a><span>
</span><a name="line-2369"></a><span>        </span><a name="local-6989586621684793126"><a href="#local-6989586621684793126"><span class="hs-identifier">maybe_exts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684793119"><span class="hs-identifier hs-var">fromRep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2370"></a><span>                        </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#EXTS"><span class="hs-identifier hs-var">EXTS</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><a href="#local-6989586621684793122"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684793122"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2371"></a><span>                        </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#EXTS"><span class="hs-identifier hs-var">EXTS</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><a href="#local-6989586621684793122"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684793122"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2372"></a><span>                        </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#EXTS"><span class="hs-identifier hs-var">EXTS</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684793122"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684793122"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2373"></a><span>                        </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2374"></a><span>                        </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.coerceInt2FP: no match&quot;</span><span>
</span><a name="line-2375"></a><span>
</span><a name="line-2376"></a><span>        </span><a name="local-6989586621684793127"><a href="#local-6989586621684793127"><span class="hs-identifier">maybe_frsp</span></a></a><span> </span><a name="local-6989586621684793129"><a href="#local-6989586621684793129"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-2377"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684793120"><span class="hs-identifier hs-var">toRep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2378"></a><span>                        </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PPC.Instr.html#FRSP"><span class="hs-identifier hs-var">FRSP</span></a><span> </span><a href="#local-6989586621684793129"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684793129"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-2379"></a><span>                        </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2380"></a><span>                        </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.coerceInt2FP: no match&quot;</span><span>
</span><a name="line-2381"></a><span>
</span><a name="line-2382"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684793120"><span class="hs-identifier hs-var">toRep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793125"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2383"></a><span>
</span><a name="line-2384"></a><span class="hs-identifier">coerceInt2FP'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.coerceInt2FP: unknown arch&quot;</span><span>
</span><a name="line-2385"></a><span>
</span><a name="line-2386"></a><span>
</span><a name="line-2387"></a><span class="hs-identifier">coerceFP2Int</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2388"></a><a name="coerceFP2Int"><a href="PPC.CodeGen.html#coerceFP2Int"><span class="hs-identifier">coerceFP2Int</span></a></a><span> </span><a name="local-6989586621684793130"><a href="#local-6989586621684793130"><span class="hs-identifier">fromRep</span></a></a><span> </span><a name="local-6989586621684793131"><a href="#local-6989586621684793131"><span class="hs-identifier">toRep</span></a></a><span> </span><a name="local-6989586621684793132"><a href="#local-6989586621684793132"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2389"></a><span>    </span><a name="local-6989586621684793133"><a href="#local-6989586621684793133"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2390"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684793134"><a href="#local-6989586621684793134"><span class="hs-identifier">arch</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">platformArch</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684793133"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2391"></a><span>    </span><a href="PPC.CodeGen.html#coerceFP2Int%27"><span class="hs-identifier hs-var">coerceFP2Int'</span></a><span> </span><a href="#local-6989586621684793134"><span class="hs-identifier hs-var">arch</span></a><span> </span><a href="#local-6989586621684793130"><span class="hs-identifier hs-var">fromRep</span></a><span> </span><a href="#local-6989586621684793131"><span class="hs-identifier hs-var">toRep</span></a><span> </span><a href="#local-6989586621684793132"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2392"></a><span>
</span><a name="line-2393"></a><span class="hs-identifier">coerceFP2Int'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arch</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="PPC.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-2394"></a><a name="coerceFP2Int%27"><a href="PPC.CodeGen.html#coerceFP2Int%27"><span class="hs-identifier">coerceFP2Int'</span></a></a><span> </span><span class="hs-identifier hs-var">ArchPPC</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684793135"><a href="#local-6989586621684793135"><span class="hs-identifier">toRep</span></a></a><span> </span><a name="local-6989586621684793136"><a href="#local-6989586621684793136"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2395"></a><span>    </span><a name="local-6989586621684793137"><a href="#local-6989586621684793137"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2396"></a><span>    </span><span class="hs-comment">-- the reps don't really matter: F*-&gt;FF64 and II32-&gt;I* are no-ops</span><span>
</span><a name="line-2397"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793138"><a href="#local-6989586621684793138"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793139"><a href="#local-6989586621684793139"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793136"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2398"></a><span>    </span><a name="local-6989586621684793140"><a href="#local-6989586621684793140"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span>
</span><a name="line-2399"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2400"></a><span>        </span><a name="local-6989586621684793141"><a href="#local-6989586621684793141"><span class="hs-identifier">code'</span></a></a><span> </span><a name="local-6989586621684793142"><a href="#local-6989586621684793142"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793139"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2401"></a><span>                </span><span class="hs-comment">-- convert to int in FP reg</span><span>
</span><a name="line-2402"></a><span>            </span><a href="PPC.Instr.html#FCTIWZ"><span class="hs-identifier hs-var">FCTIWZ</span></a><span> </span><a href="#local-6989586621684793140"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684793138"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">,</span><span>
</span><a name="line-2403"></a><span>                </span><span class="hs-comment">-- store value (64bit) from FP to stack</span><span>
</span><a name="line-2404"></a><span>            </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684793140"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793137"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2405"></a><span>                </span><span class="hs-comment">-- read low word of value (high word is undefined)</span><span>
</span><a name="line-2406"></a><span>            </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684793142"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793137"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2407"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793135"><span class="hs-identifier hs-var">toRep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793141"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2408"></a><span>
</span><a name="line-2409"></a><span class="hs-identifier">coerceFP2Int'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684793143"><a href="#local-6989586621684793143"><span class="hs-identifier">toRep</span></a></a><span> </span><a name="local-6989586621684793144"><a href="#local-6989586621684793144"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2410"></a><span>    </span><a name="local-6989586621684793145"><a href="#local-6989586621684793145"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2411"></a><span>    </span><span class="hs-comment">-- the reps don't really matter: F*-&gt;FF64 and II64-&gt;I* are no-ops</span><span>
</span><a name="line-2412"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684793146"><a href="#local-6989586621684793146"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684793147"><a href="#local-6989586621684793147"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PPC.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684793144"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2413"></a><span>    </span><a name="local-6989586621684793148"><a href="#local-6989586621684793148"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span>
</span><a name="line-2414"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2415"></a><span>        </span><a name="local-6989586621684793149"><a href="#local-6989586621684793149"><span class="hs-identifier">code'</span></a></a><span> </span><a name="local-6989586621684793150"><a href="#local-6989586621684793150"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684793147"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2416"></a><span>                </span><span class="hs-comment">-- convert to int in FP reg</span><span>
</span><a name="line-2417"></a><span>            </span><a href="PPC.Instr.html#FCTIDZ"><span class="hs-identifier hs-var">FCTIDZ</span></a><span> </span><a href="#local-6989586621684793148"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684793146"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">,</span><span>
</span><a name="line-2418"></a><span>                </span><span class="hs-comment">-- store value (64bit) from FP to compiler word on stack</span><span>
</span><a name="line-2419"></a><span>            </span><a href="PPC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684793148"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793145"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2420"></a><span>            </span><a href="PPC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684793150"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="PPC.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684793145"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2421"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="PPC.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684793143"><span class="hs-identifier hs-var">toRep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684793149"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2422"></a><span>
</span><a name="line-2423"></a><span class="hs-identifier">coerceFP2Int'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;PPC.CodeGen.coerceFP2Int: unknown arch&quot;</span><span>
</span><a name="line-2424"></a><span>
</span><a name="line-2425"></a><span class="hs-comment">-- Note [.LCTOC1 in PPC PIC code]</span><span>
</span><a name="line-2426"></a><span class="hs-comment">-- The .LCTOC1 label is defined to point 32768 bytes into the GOT table</span><span>
</span><a name="line-2427"></a><span class="hs-comment">-- to make the most of the PPC's 16-bit displacements.</span><span>
</span><a name="line-2428"></a><span class="hs-comment">-- As 16-bit signed offset is used (usually via addi/lwz instructions)</span><span>
</span><a name="line-2429"></a><span class="hs-comment">-- first element will have '-32768' offset against .LCTOC1.</span><span>
</span><a name="line-2430"></a><span>
</span><a name="line-2431"></a><span class="hs-comment">-- Note [implicit register in PPC PIC code]</span><span>
</span><a name="line-2432"></a><span class="hs-comment">-- PPC generates calls by labels in assembly</span><span>
</span><a name="line-2433"></a><span class="hs-comment">-- in form of:</span><span>
</span><a name="line-2434"></a><span class="hs-comment">--     bl puts+32768@plt</span><span>
</span><a name="line-2435"></a><span class="hs-comment">-- in this form it's not seen directly (by GHC NCG)</span><span>
</span><a name="line-2436"></a><span class="hs-comment">-- that r30 (PicBaseReg) is used,</span><span>
</span><a name="line-2437"></a><span class="hs-comment">-- but r30 is a required part of PLT code setup:</span><span>
</span><a name="line-2438"></a><span class="hs-comment">--   puts+32768@plt:</span><span>
</span><a name="line-2439"></a><span class="hs-comment">--       lwz     r11,-30484(r30) ; offset in .LCTOC1</span><span>
</span><a name="line-2440"></a><span class="hs-comment">--       mtctr   r11</span><span>
</span><a name="line-2441"></a><span class="hs-comment">--       bctr</span><span>
</span><a name="line-2442"></a></pre></body></html>