<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- (c) The University of Glasgow 2006</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- (c) The GRASP/AQUA Project, Glasgow University, 1992-1998</span><span>
</span><a name="line-3"></a><span class="hs-comment">--</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Storage manager representation of closures</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE CPP,GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">SMRep</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-9"></a><span>        </span><span class="hs-comment">-- * Words and bytes</span><span>
</span><a name="line-10"></a><span>        </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="SMRep.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#bytesToWordsRoundUp"><span class="hs-identifier hs-var">bytesToWordsRoundUp</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="SMRep.html#roundUpToWords"><span class="hs-identifier hs-var">roundUpToWords</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#roundUpTo"><span class="hs-identifier hs-var">roundUpTo</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span>        </span><a href="SMRep.html#StgWord"><span class="hs-identifier hs-type">StgWord</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#fromStgWord"><span class="hs-identifier hs-var">fromStgWord</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#toStgWord"><span class="hs-identifier hs-var">toStgWord</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="SMRep.html#StgHalfWord"><span class="hs-identifier hs-type">StgHalfWord</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#fromStgHalfWord"><span class="hs-identifier hs-var">fromStgHalfWord</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#toStgHalfWord"><span class="hs-identifier hs-var">toStgHalfWord</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="SMRep.html#hALF_WORD_SIZE"><span class="hs-identifier hs-var">hALF_WORD_SIZE</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#hALF_WORD_SIZE_IN_BITS"><span class="hs-identifier hs-var">hALF_WORD_SIZE_IN_BITS</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span>        </span><span class="hs-comment">-- * Closure repesentation</span><span>
</span><a name="line-19"></a><span>        </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- CmmInfo sees the rep; no one else does</span><span>
</span><a name="line-20"></a><span>        </span><a href="SMRep.html#IsStatic"><span class="hs-identifier hs-type">IsStatic</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="SMRep.html#ClosureTypeInfo"><span class="hs-identifier hs-type">ClosureTypeInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="SMRep.html#ArgDescr"><span class="hs-identifier hs-type">ArgDescr</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="SMRep.html#Liveness"><span class="hs-identifier hs-type">Liveness</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="SMRep.html#ConstrDescription"><span class="hs-identifier hs-type">ConstrDescription</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>        </span><span class="hs-comment">-- ** Construction</span><span>
</span><a name="line-25"></a><span>        </span><a href="SMRep.html#mkHeapRep"><span class="hs-identifier hs-var">mkHeapRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#blackHoleRep"><span class="hs-identifier hs-var">blackHoleRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#indStaticRep"><span class="hs-identifier hs-var">indStaticRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#mkStackRep"><span class="hs-identifier hs-var">mkStackRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#mkRTSRep"><span class="hs-identifier hs-var">mkRTSRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#arrPtrsRep"><span class="hs-identifier hs-var">arrPtrsRep</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="SMRep.html#smallArrPtrsRep"><span class="hs-identifier hs-var">smallArrPtrsRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#arrWordsRep"><span class="hs-identifier hs-var">arrWordsRep</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>        </span><span class="hs-comment">-- ** Predicates</span><span>
</span><a name="line-29"></a><span>        </span><a href="SMRep.html#isStaticRep"><span class="hs-identifier hs-var">isStaticRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#isConRep"><span class="hs-identifier hs-var">isConRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#isThunkRep"><span class="hs-identifier hs-var">isThunkRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#isFunRep"><span class="hs-identifier hs-var">isFunRep</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#isStaticNoCafCon"><span class="hs-identifier hs-var">isStaticNoCafCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="SMRep.html#isStackRep"><span class="hs-identifier hs-var">isStackRep</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span>        </span><span class="hs-comment">-- ** Size-related things</span><span>
</span><a name="line-33"></a><span>        </span><a href="SMRep.html#heapClosureSizeW"><span class="hs-identifier hs-var">heapClosureSizeW</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#arrWordsHdrSize"><span class="hs-identifier hs-var">arrWordsHdrSize</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#arrWordsHdrSizeW"><span class="hs-identifier hs-var">arrWordsHdrSizeW</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#arrPtrsHdrSize"><span class="hs-identifier hs-var">arrPtrsHdrSize</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="SMRep.html#arrPtrsHdrSizeW"><span class="hs-identifier hs-var">arrPtrsHdrSizeW</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#profHdrSize"><span class="hs-identifier hs-var">profHdrSize</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#thunkHdrSize"><span class="hs-identifier hs-var">thunkHdrSize</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#nonHdrSize"><span class="hs-identifier hs-var">nonHdrSize</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#nonHdrSizeW"><span class="hs-identifier hs-var">nonHdrSizeW</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="SMRep.html#smallArrPtrsHdrSize"><span class="hs-identifier hs-var">smallArrPtrsHdrSize</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#smallArrPtrsHdrSizeW"><span class="hs-identifier hs-var">smallArrPtrsHdrSizeW</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#hdrSize"><span class="hs-identifier hs-var">hdrSize</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#hdrSizeW"><span class="hs-identifier hs-var">hdrSizeW</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="SMRep.html#fixedHdrSize"><span class="hs-identifier hs-var">fixedHdrSize</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>        </span><span class="hs-comment">-- ** RTS closure types</span><span>
</span><a name="line-40"></a><span>        </span><a href="SMRep.html#rtsClosureType"><span class="hs-identifier hs-var">rtsClosureType</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#rET_SMALL"><span class="hs-identifier hs-var">rET_SMALL</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#rET_BIG"><span class="hs-identifier hs-var">rET_BIG</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="SMRep.html#aRG_GEN"><span class="hs-identifier hs-var">aRG_GEN</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#aRG_GEN_BIG"><span class="hs-identifier hs-var">aRG_GEN_BIG</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>        </span><span class="hs-comment">-- ** Arrays</span><span>
</span><a name="line-44"></a><span>        </span><a href="SMRep.html#card"><span class="hs-identifier hs-var">card</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#cardRoundUp"><span class="hs-identifier hs-var">cardRoundUp</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#cardTableSizeB"><span class="hs-identifier hs-var">cardTableSizeB</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#cardTableSizeW"><span class="hs-identifier hs-var">cardTableSizeW</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>        </span><span class="hs-comment">-- * Operations over [Word8] strings that don't belong here</span><span>
</span><a name="line-47"></a><span>        </span><a href="SMRep.html#pprWord8String"><span class="hs-identifier hs-var">pprWord8String</span></a><span class="hs-special">,</span><span> </span><a href="SMRep.html#stringToWord8s"><span class="hs-identifier hs-var">stringToWord8s</span></a><span>
</span><a name="line-48"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ConTagZ</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Words and bytes
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-comment">-- | Word offset, or word count</span><span>
</span><a name="line-71"></a><span class="hs-keyword">type</span><span> </span><a name="WordOff"><a href="SMRep.html#WordOff"><span class="hs-identifier">WordOff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | Byte offset, or byte count</span><span>
</span><a name="line-74"></a><span class="hs-keyword">type</span><span> </span><a name="ByteOff"><a href="SMRep.html#ByteOff"><span class="hs-identifier">ByteOff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-comment">-- | Round up the given byte count to the next byte count that's a</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- multiple of the machine's word size.</span><span>
</span><a name="line-78"></a><span class="hs-identifier">roundUpToWords</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-79"></a><a name="roundUpToWords"><a href="SMRep.html#roundUpToWords"><span class="hs-identifier">roundUpToWords</span></a></a><span> </span><a name="local-6989586621680013317"><a href="#local-6989586621680013317"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013318"><a href="#local-6989586621680013318"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#roundUpTo"><span class="hs-identifier hs-var">roundUpTo</span></a><span> </span><a href="#local-6989586621680013318"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621680013317"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-comment">-- | Round up @base@ to a multiple of @size@.</span><span>
</span><a name="line-82"></a><span class="hs-identifier">roundUpTo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-83"></a><a name="roundUpTo"><a href="SMRep.html#roundUpTo"><span class="hs-identifier">roundUpTo</span></a></a><span> </span><a name="local-6989586621680013319"><a href="#local-6989586621680013319"><span class="hs-identifier">base</span></a></a><span> </span><a name="local-6989586621680013320"><a href="#local-6989586621680013320"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680013319"><span class="hs-identifier hs-var">base</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680013320"><span class="hs-identifier hs-var">size</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">complement</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680013320"><span class="hs-identifier hs-var">size</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">-- | Convert the given number of words to a number of bytes.</span><span>
</span><a name="line-86"></a><span class="hs-comment">--</span><span>
</span><a name="line-87"></a><span class="hs-comment">-- This function morally has type @WordOff -&gt; ByteOff@, but uses @Num</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- a@ to allow for overloading.</span><span>
</span><a name="line-89"></a><span class="hs-identifier">wordsToBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621680013316"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680013316"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680013316"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-90"></a><a name="wordsToBytes"><a href="SMRep.html#wordsToBytes"><span class="hs-identifier">wordsToBytes</span></a></a><span> </span><a name="local-6989586621680013321"><a href="#local-6989586621680013321"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013322"><a href="#local-6989586621680013322"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621680013321"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680013322"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-91"></a><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">wordsToBytes</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">DynFlags</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-92"></a><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">wordsToBytes</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">DynFlags</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Word</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Word</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-93"></a><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">wordsToBytes</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">DynFlags</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | First round the given byte count up to a multiple of the</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- machine's word size and then convert the result to words.</span><span>
</span><a name="line-97"></a><span class="hs-identifier">bytesToWordsRoundUp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-98"></a><a name="bytesToWordsRoundUp"><a href="SMRep.html#bytesToWordsRoundUp"><span class="hs-identifier">bytesToWordsRoundUp</span></a></a><span> </span><a name="local-6989586621680013323"><a href="#local-6989586621680013323"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013324"><a href="#local-6989586621680013324"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680013324"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013325"><span class="hs-identifier hs-var">word_size</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680013325"><span class="hs-identifier hs-var">word_size</span></a><span>
</span><a name="line-99"></a><span> </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680013325"><a href="#local-6989586621680013325"><span class="hs-identifier">word_size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621680013323"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-100"></a><span class="hs-comment">-- StgWord is a type representing an StgWord on the target platform.</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- A Word64 is large enough to hold a Word for either a 32bit or 64bit platform</span><span>
</span><a name="line-102"></a><span class="hs-keyword">newtype</span><span> </span><a name="StgWord"><a href="SMRep.html#StgWord"><span class="hs-identifier">StgWord</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="StgWord"><a href="SMRep.html#StgWord"><span class="hs-identifier">StgWord</span></a></a><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bits</span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-identifier">fromStgWord</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#StgWord"><span class="hs-identifier hs-type">StgWord</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-106"></a><a name="fromStgWord"><a href="SMRep.html#fromStgWord"><span class="hs-identifier">fromStgWord</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#StgWord"><span class="hs-identifier hs-var">StgWord</span></a><span> </span><a name="local-6989586621680013326"><a href="#local-6989586621680013326"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621680013326"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-identifier">toStgWord</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#StgWord"><span class="hs-identifier hs-type">StgWord</span></a><span>
</span><a name="line-109"></a><a name="toStgWord"><a href="SMRep.html#toStgWord"><span class="hs-identifier">toStgWord</span></a></a><span> </span><a name="local-6989586621680013327"><a href="#local-6989586621680013327"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013328"><a href="#local-6989586621680013328"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-110"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformWordSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680013327"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-111"></a><span>      </span><span class="hs-comment">-- These conversions mean that things like toStgWord (-1)</span><span>
</span><a name="line-112"></a><span>      </span><span class="hs-comment">-- do the right thing</span><span>
</span><a name="line-113"></a><span>      </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#StgWord"><span class="hs-identifier hs-var">StgWord</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680013328"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-114"></a><span>      </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#StgWord"><span class="hs-identifier hs-var">StgWord</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680013328"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>      </span><a name="local-6989586621680013329"><a href="#local-6989586621680013329"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;toStgWord: Unknown platformWordSize: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680013329"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="SMRep.html#StgWord"><span class="hs-identifier hs-type">StgWord</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>    </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#StgWord"><span class="hs-identifier hs-var">StgWord</span></a><span> </span><a name="local-6989586621680013315"><a href="#local-6989586621680013315"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">integer</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621680013315"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">--</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">-- A Word32 is large enough to hold half a Word for either a 32bit or</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- 64bit platform</span><span>
</span><a name="line-124"></a><span class="hs-keyword">newtype</span><span> </span><a name="StgHalfWord"><a href="SMRep.html#StgHalfWord"><span class="hs-identifier">StgHalfWord</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="StgHalfWord"><a href="SMRep.html#StgHalfWord"><span class="hs-identifier">StgHalfWord</span></a></a><span> </span><span class="hs-identifier hs-type">Word32</span><span>
</span><a name="line-125"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-identifier">fromStgHalfWord</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#StgHalfWord"><span class="hs-identifier hs-type">StgHalfWord</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-128"></a><a name="fromStgHalfWord"><a href="SMRep.html#fromStgHalfWord"><span class="hs-identifier">fromStgHalfWord</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#StgHalfWord"><span class="hs-identifier hs-var">StgHalfWord</span></a><span> </span><a name="local-6989586621680013330"><a href="#local-6989586621680013330"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621680013330"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-identifier">toStgHalfWord</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#StgHalfWord"><span class="hs-identifier hs-type">StgHalfWord</span></a><span>
</span><a name="line-131"></a><a name="toStgHalfWord"><a href="SMRep.html#toStgHalfWord"><span class="hs-identifier">toStgHalfWord</span></a></a><span> </span><a name="local-6989586621680013331"><a href="#local-6989586621680013331"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013332"><a href="#local-6989586621680013332"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-132"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformWordSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680013331"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-133"></a><span>      </span><span class="hs-comment">-- These conversions mean that things like toStgHalfWord (-1)</span><span>
</span><a name="line-134"></a><span>      </span><span class="hs-comment">-- do the right thing</span><span>
</span><a name="line-135"></a><span>      </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#StgHalfWord"><span class="hs-identifier hs-var">StgHalfWord</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680013332"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>      </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#StgHalfWord"><span class="hs-identifier hs-var">StgHalfWord</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680013332"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>      </span><a name="local-6989586621680013333"><a href="#local-6989586621680013333"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;toStgHalfWord: Unknown platformWordSize: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680013333"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="SMRep.html#StgHalfWord"><span class="hs-identifier hs-type">StgHalfWord</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-140"></a><span>    </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#StgHalfWord"><span class="hs-identifier hs-var">StgHalfWord</span></a><span> </span><a name="local-6989586621680013314"><a href="#local-6989586621680013314"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">integer</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621680013314"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-identifier">hALF_WORD_SIZE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-143"></a><a name="hALF_WORD_SIZE"><a href="SMRep.html#hALF_WORD_SIZE"><span class="hs-identifier">hALF_WORD_SIZE</span></a></a><span> </span><a name="local-6989586621680013334"><a href="#local-6989586621680013334"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformWordSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680013334"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-144"></a><span class="hs-identifier">hALF_WORD_SIZE_IN_BITS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-145"></a><a name="hALF_WORD_SIZE_IN_BITS"><a href="SMRep.html#hALF_WORD_SIZE_IN_BITS"><span class="hs-identifier">hALF_WORD_SIZE_IN_BITS</span></a></a><span> </span><a name="local-6989586621680013335"><a href="#local-6989586621680013335"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformWordSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680013335"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection[SMRep-datatype]{@SMRep@---storage manager representation}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- | A description of the layout of a closure.  Corresponds directly</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- to the closure types in includes/rts/storage/ClosureTypes.h.</span><span>
</span><a name="line-157"></a><span class="hs-keyword">data</span><span> </span><a name="SMRep"><a href="SMRep.html#SMRep"><span class="hs-identifier">SMRep</span></a></a><span>
</span><a name="line-158"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="HeapRep"><a href="SMRep.html#HeapRep"><span class="hs-identifier">HeapRep</span></a></a><span>              </span><span class="hs-comment">-- GC routines consult sizes in info tbl</span><span>
</span><a name="line-159"></a><span>        </span><a href="SMRep.html#IsStatic"><span class="hs-identifier hs-type">IsStatic</span></a><span>
</span><a name="line-160"></a><span>        </span><span class="hs-glyph">!</span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>         </span><span class="hs-comment">--  # ptr words</span><span>
</span><a name="line-161"></a><span>        </span><span class="hs-glyph">!</span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>         </span><span class="hs-comment">--  # non-ptr words INCLUDING SLOP (see mkHeapRep below)</span><span>
</span><a name="line-162"></a><span>        </span><a href="SMRep.html#ClosureTypeInfo"><span class="hs-identifier hs-type">ClosureTypeInfo</span></a><span>  </span><span class="hs-comment">-- type-specific info</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ArrayPtrsRep"><a href="SMRep.html#ArrayPtrsRep"><span class="hs-identifier">ArrayPtrsRep</span></a></a><span>
</span><a name="line-165"></a><span>        </span><span class="hs-glyph">!</span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>        </span><span class="hs-comment">-- # ptr words</span><span>
</span><a name="line-166"></a><span>        </span><span class="hs-glyph">!</span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>        </span><span class="hs-comment">-- # card table words</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SmallArrayPtrsRep"><a href="SMRep.html#SmallArrayPtrsRep"><span class="hs-identifier">SmallArrayPtrsRep</span></a></a><span>
</span><a name="line-169"></a><span>        </span><span class="hs-glyph">!</span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>        </span><span class="hs-comment">-- # ptr words</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ArrayWordsRep"><a href="SMRep.html#ArrayWordsRep"><span class="hs-identifier">ArrayWordsRep</span></a></a><span>
</span><a name="line-172"></a><span>        </span><span class="hs-glyph">!</span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>        </span><span class="hs-comment">-- # bytes expressed in words, rounded up</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StackRep"><a href="SMRep.html#StackRep"><span class="hs-identifier">StackRep</span></a></a><span>            </span><span class="hs-comment">-- Stack frame (RET_SMALL or RET_BIG)</span><span>
</span><a name="line-175"></a><span>        </span><a href="SMRep.html#Liveness"><span class="hs-identifier hs-type">Liveness</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RTSRep"><a href="SMRep.html#RTSRep"><span class="hs-identifier">RTSRep</span></a></a><span>              </span><span class="hs-comment">-- The RTS needs to declare info tables with specific</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-identifier hs-type">Int</span><span>             </span><span class="hs-comment">-- type tags, so this form lets us override the default</span><span>
</span><a name="line-179"></a><span>        </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>           </span><span class="hs-comment">-- tag for an SMRep.</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- | True &lt;=&gt; This is a static closure.  Affects how we garbage-collect it.</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- Static closure have an extra static link field at the end.</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- Constructors do not have a static variant; see Note [static constructors]</span><span>
</span><a name="line-184"></a><span class="hs-keyword">type</span><span> </span><a name="IsStatic"><a href="SMRep.html#IsStatic"><span class="hs-identifier">IsStatic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-comment">-- From an SMRep you can get to the closure type defined in</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- includes/rts/storage/ClosureTypes.h. Described by the function</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- rtsClosureType below.</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-keyword">data</span><span> </span><a name="ClosureTypeInfo"><a href="SMRep.html#ClosureTypeInfo"><span class="hs-identifier">ClosureTypeInfo</span></a></a><span>
</span><a name="line-191"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Constr"><a href="SMRep.html#Constr"><span class="hs-identifier">Constr</span></a></a><span>        </span><span class="hs-identifier hs-type">ConTagZ</span><span> </span><a href="SMRep.html#ConstrDescription"><span class="hs-identifier hs-type">ConstrDescription</span></a><span>
</span><a name="line-192"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Fun"><a href="SMRep.html#Fun"><span class="hs-identifier">Fun</span></a></a><span>           </span><a href="SMRep.html#FunArity"><span class="hs-identifier hs-type">FunArity</span></a><span> </span><a href="SMRep.html#ArgDescr"><span class="hs-identifier hs-type">ArgDescr</span></a><span>
</span><a name="line-193"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Thunk"><a href="SMRep.html#Thunk"><span class="hs-identifier">Thunk</span></a></a><span>
</span><a name="line-194"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ThunkSelector"><a href="SMRep.html#ThunkSelector"><span class="hs-identifier">ThunkSelector</span></a></a><span> </span><a href="SMRep.html#SelectorOffset"><span class="hs-identifier hs-type">SelectorOffset</span></a><span>
</span><a name="line-195"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="BlackHole"><a href="SMRep.html#BlackHole"><span class="hs-identifier">BlackHole</span></a></a><span>
</span><a name="line-196"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IndStatic"><a href="SMRep.html#IndStatic"><span class="hs-identifier">IndStatic</span></a></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-keyword">type</span><span> </span><a name="ConstrDescription"><a href="SMRep.html#ConstrDescription"><span class="hs-identifier">ConstrDescription</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- result of dataConIdentity</span><span>
</span><a name="line-199"></a><span class="hs-keyword">type</span><span> </span><a name="FunArity"><a href="SMRep.html#FunArity"><span class="hs-identifier">FunArity</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-200"></a><span class="hs-keyword">type</span><span> </span><a name="SelectorOffset"><a href="SMRep.html#SelectorOffset"><span class="hs-identifier">SelectorOffset</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span class="hs-comment">-------------------------</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- We represent liveness bitmaps as a Bitmap (whose internal</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- representation really is a bitmap).  These are pinned onto case return</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- vectors to indicate the state of the stack for the garbage collector.</span><span>
</span><a name="line-206"></a><span class="hs-comment">--</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- In the compiled program, liveness bitmaps that fit inside a single</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- word (StgWord) are stored as a single word, while larger bitmaps are</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- stored as a pointer to an array of words.</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-keyword">type</span><span> </span><a name="Liveness"><a href="SMRep.html#Liveness"><span class="hs-identifier">Liveness</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- One Bool per word; True  &lt;=&gt; non-ptr or dead</span><span>
</span><a name="line-212"></a><span>                         </span><span class="hs-comment">--                    False &lt;=&gt; ptr</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-comment">-------------------------</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- An ArgDescr describes the argument pattern of a function</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-keyword">data</span><span> </span><a name="ArgDescr"><a href="SMRep.html#ArgDescr"><span class="hs-identifier">ArgDescr</span></a></a><span>
</span><a name="line-218"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ArgSpec"><a href="SMRep.html#ArgSpec"><span class="hs-identifier">ArgSpec</span></a></a><span>             </span><span class="hs-comment">-- Fits one of the standard patterns</span><span>
</span><a name="line-219"></a><span>        </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>            </span><span class="hs-comment">-- RTS type identifier ARG_P, ARG_N, ...</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ArgGen"><a href="SMRep.html#ArgGen"><span class="hs-identifier">ArgGen</span></a></a><span>              </span><span class="hs-comment">-- General case</span><span>
</span><a name="line-222"></a><span>        </span><a href="SMRep.html#Liveness"><span class="hs-identifier hs-type">Liveness</span></a><span>        </span><span class="hs-comment">-- Details about the arguments</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- Construction</span><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-identifier">mkHeapRep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#IsStatic"><span class="hs-identifier hs-type">IsStatic</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ClosureTypeInfo"><span class="hs-identifier hs-type">ClosureTypeInfo</span></a><span>
</span><a name="line-229"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>
</span><a name="line-230"></a><a name="mkHeapRep"><a href="SMRep.html#mkHeapRep"><span class="hs-identifier">mkHeapRep</span></a></a><span> </span><a name="local-6989586621680013336"><a href="#local-6989586621680013336"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013337"><a href="#local-6989586621680013337"><span class="hs-identifier">is_static</span></a></a><span> </span><a name="local-6989586621680013338"><a href="#local-6989586621680013338"><span class="hs-identifier">ptr_wds</span></a></a><span> </span><a name="local-6989586621680013339"><a href="#local-6989586621680013339"><span class="hs-identifier">nonptr_wds</span></a></a><span> </span><a name="local-6989586621680013340"><a href="#local-6989586621680013340"><span class="hs-identifier">cl_type_info</span></a></a><span>
</span><a name="line-231"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><a href="#local-6989586621680013337"><span class="hs-identifier hs-var">is_static</span></a><span>
</span><a name="line-232"></a><span>            </span><a href="#local-6989586621680013338"><span class="hs-identifier hs-var">ptr_wds</span></a><span>
</span><a name="line-233"></a><span>            </span><span class="hs-special">(</span><a href="#local-6989586621680013339"><span class="hs-identifier hs-var">nonptr_wds</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013341"><span class="hs-identifier hs-var">slop_wds</span></a><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>            </span><a href="#local-6989586621680013340"><span class="hs-identifier hs-var">cl_type_info</span></a><span>
</span><a name="line-235"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-236"></a><span>     </span><a name="local-6989586621680013341"><a href="#local-6989586621680013341"><span class="hs-identifier">slop_wds</span></a></a><span>
</span><a name="line-237"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680013337"><span class="hs-identifier hs-var">is_static</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-238"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#minClosureSize"><span class="hs-identifier hs-var">minClosureSize</span></a><span> </span><a href="#local-6989586621680013336"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680013342"><span class="hs-identifier hs-var">hdr_size</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013343"><span class="hs-identifier hs-var">payload_size</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span>     </span><a name="local-6989586621680013342"><a href="#local-6989586621680013342"><span class="hs-identifier">hdr_size</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#closureTypeHdrSize"><span class="hs-identifier hs-var">closureTypeHdrSize</span></a><span> </span><a href="#local-6989586621680013336"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680013340"><span class="hs-identifier hs-var">cl_type_info</span></a><span>
</span><a name="line-241"></a><span>     </span><a name="local-6989586621680013343"><a href="#local-6989586621680013343"><span class="hs-identifier">payload_size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680013338"><span class="hs-identifier hs-var">ptr_wds</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013339"><span class="hs-identifier hs-var">nonptr_wds</span></a><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-identifier">mkRTSRep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>
</span><a name="line-244"></a><a name="mkRTSRep"><a href="SMRep.html#mkRTSRep"><span class="hs-identifier">mkRTSRep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#RTSRep"><span class="hs-identifier hs-var">RTSRep</span></a><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-identifier">mkStackRep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>
</span><a name="line-247"></a><a name="mkStackRep"><a href="SMRep.html#mkStackRep"><span class="hs-identifier">mkStackRep</span></a></a><span> </span><a name="local-6989586621680013344"><a href="#local-6989586621680013344"><span class="hs-identifier">liveness</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#StackRep"><span class="hs-identifier hs-var">StackRep</span></a><span> </span><a href="#local-6989586621680013344"><span class="hs-identifier hs-var">liveness</span></a><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-identifier">blackHoleRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>
</span><a name="line-250"></a><a name="blackHoleRep"><a href="SMRep.html#blackHoleRep"><span class="hs-identifier">blackHoleRep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><a href="SMRep.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-identifier">indStaticRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>
</span><a name="line-253"></a><a name="indStaticRep"><a href="SMRep.html#indStaticRep"><span class="hs-identifier">indStaticRep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><a href="SMRep.html#IndStatic"><span class="hs-identifier hs-var">IndStatic</span></a><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-identifier">arrPtrsRep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>
</span><a name="line-256"></a><a name="arrPtrsRep"><a href="SMRep.html#arrPtrsRep"><span class="hs-identifier">arrPtrsRep</span></a></a><span> </span><a name="local-6989586621680013345"><a href="#local-6989586621680013345"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013346"><a href="#local-6989586621680013346"><span class="hs-identifier">elems</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#ArrayPtrsRep"><span class="hs-identifier hs-var">ArrayPtrsRep</span></a><span> </span><a href="#local-6989586621680013346"><span class="hs-identifier hs-var">elems</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#cardTableSizeW"><span class="hs-identifier hs-var">cardTableSizeW</span></a><span> </span><a href="#local-6989586621680013345"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680013346"><span class="hs-identifier hs-var">elems</span></a><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-identifier">smallArrPtrsRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>
</span><a name="line-259"></a><a name="smallArrPtrsRep"><a href="SMRep.html#smallArrPtrsRep"><span class="hs-identifier">smallArrPtrsRep</span></a></a><span> </span><a name="local-6989586621680013347"><a href="#local-6989586621680013347"><span class="hs-identifier">elems</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#SmallArrayPtrsRep"><span class="hs-identifier hs-var">SmallArrayPtrsRep</span></a><span> </span><a href="#local-6989586621680013347"><span class="hs-identifier hs-var">elems</span></a><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-identifier">arrWordsRep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span>
</span><a name="line-262"></a><a name="arrWordsRep"><a href="SMRep.html#arrWordsRep"><span class="hs-identifier">arrWordsRep</span></a></a><span> </span><a name="local-6989586621680013348"><a href="#local-6989586621680013348"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013349"><a href="#local-6989586621680013349"><span class="hs-identifier">bytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#ArrayWordsRep"><span class="hs-identifier hs-var">ArrayWordsRep</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#bytesToWordsRoundUp"><span class="hs-identifier hs-var">bytesToWordsRoundUp</span></a><span> </span><a href="#local-6989586621680013348"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680013349"><span class="hs-identifier hs-var">bytes</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- Predicates</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-identifier">isStaticRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#IsStatic"><span class="hs-identifier hs-type">IsStatic</span></a><span>
</span><a name="line-268"></a><a name="isStaticRep"><a href="SMRep.html#isStaticRep"><span class="hs-identifier">isStaticRep</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><a name="local-6989586621680013350"><a href="#local-6989586621680013350"><span class="hs-identifier">is_static</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680013350"><span class="hs-identifier hs-var">is_static</span></a><span>
</span><a name="line-269"></a><span class="hs-identifier">isStaticRep</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#RTSRep"><span class="hs-identifier hs-var">RTSRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680013351"><a href="#local-6989586621680013351"><span class="hs-identifier">rep</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#isStaticRep"><span class="hs-identifier hs-var">isStaticRep</span></a><span> </span><a href="#local-6989586621680013351"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-270"></a><span class="hs-identifier">isStaticRep</span><span> </span><span class="hs-identifier">_</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-identifier">isStackRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-273"></a><a name="isStackRep"><a href="SMRep.html#isStackRep"><span class="hs-identifier">isStackRep</span></a></a><span> </span><a href="SMRep.html#StackRep"><span class="hs-identifier hs-var">StackRep</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-274"></a><span class="hs-identifier">isStackRep</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#RTSRep"><span class="hs-identifier hs-var">RTSRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680013352"><a href="#local-6989586621680013352"><span class="hs-identifier">rep</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#isStackRep"><span class="hs-identifier hs-var">isStackRep</span></a><span> </span><a href="#local-6989586621680013352"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-275"></a><span class="hs-identifier">isStackRep</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-identifier">isConRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-278"></a><a name="isConRep"><a href="SMRep.html#isConRep"><span class="hs-identifier">isConRep</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-279"></a><span class="hs-identifier">isConRep</span><span> </span><span class="hs-identifier">_</span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-identifier">isThunkRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-282"></a><a name="isThunkRep"><a href="SMRep.html#isThunkRep"><span class="hs-identifier">isThunkRep</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-283"></a><span class="hs-identifier">isThunkRep</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#ThunkSelector"><span class="hs-identifier hs-var">ThunkSelector</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-284"></a><span class="hs-identifier">isThunkRep</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-285"></a><span class="hs-identifier">isThunkRep</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#IndStatic"><span class="hs-identifier hs-var">IndStatic</span></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-286"></a><span class="hs-identifier">isThunkRep</span><span> </span><span class="hs-identifier">_</span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-identifier">isFunRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-289"></a><a name="isFunRep"><a href="SMRep.html#isFunRep"><span class="hs-identifier">isFunRep</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-290"></a><span class="hs-identifier">isFunRep</span><span> </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-identifier">isStaticNoCafCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-293"></a><span class="hs-comment">-- This should line up exactly with CONSTR_NOCAF below</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- See Note [Static NoCaf constructors]</span><span>
</span><a name="line-295"></a><a name="isStaticNoCafCon"><a href="SMRep.html#isStaticNoCafCon"><span class="hs-identifier">isStaticNoCafCon</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-296"></a><span class="hs-identifier">isStaticNoCafCon</span><span> </span><span class="hs-identifier">_</span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- Size-related things</span><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-identifier">fixedHdrSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-303"></a><a name="fixedHdrSize"><a href="SMRep.html#fixedHdrSize"><span class="hs-identifier">fixedHdrSize</span></a></a><span> </span><a name="local-6989586621680013353"><a href="#local-6989586621680013353"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a><span> </span><a href="#local-6989586621680013353"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621680013353"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">-- | Size of a closure header (StgHeader in includes/rts/storage/Closures.h)</span><span>
</span><a name="line-306"></a><span class="hs-identifier">fixedHdrSizeW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-307"></a><a name="fixedHdrSizeW"><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier">fixedHdrSizeW</span></a></a><span> </span><a name="local-6989586621680013354"><a href="#local-6989586621680013354"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sTD_HDR_SIZE</span><span> </span><a href="#local-6989586621680013354"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="SMRep.html#profHdrSize"><span class="hs-identifier hs-var">profHdrSize</span></a><span> </span><a href="#local-6989586621680013354"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- | Size of the profiling part of a closure header</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- (StgProfHeader in includes/rts/storage/Closures.h)</span><span>
</span><a name="line-311"></a><span class="hs-identifier">profHdrSize</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-312"></a><a name="profHdrSize"><a href="SMRep.html#profHdrSize"><span class="hs-identifier">profHdrSize</span></a></a><span> </span><a name="local-6989586621680013355"><a href="#local-6989586621680013355"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-313"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_SccProfilingOn</span><span> </span><a href="#local-6989586621680013355"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pROF_HDR_SIZE</span><span> </span><a href="#local-6989586621680013355"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-314"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-comment">-- | The garbage collector requires that every closure is at least as</span><span>
</span><a name="line-317"></a><span class="hs-comment">--   big as this.</span><span>
</span><a name="line-318"></a><span class="hs-identifier">minClosureSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-319"></a><a name="minClosureSize"><a href="SMRep.html#minClosureSize"><span class="hs-identifier">minClosureSize</span></a></a><span> </span><a name="local-6989586621680013356"><a href="#local-6989586621680013356"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621680013356"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">mIN_PAYLOAD_SIZE</span><span> </span><a href="#local-6989586621680013356"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-identifier">arrWordsHdrSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-322"></a><a name="arrWordsHdrSize"><a href="SMRep.html#arrWordsHdrSize"><span class="hs-identifier">arrWordsHdrSize</span></a></a><span> </span><a name="local-6989586621680013357"><a href="#local-6989586621680013357"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-323"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#fixedHdrSize"><span class="hs-identifier hs-var">fixedHdrSize</span></a><span> </span><a href="#local-6989586621680013357"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">sIZEOF_StgArrBytes_NoHdr</span><span> </span><a href="#local-6989586621680013357"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span class="hs-identifier">arrWordsHdrSizeW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-326"></a><a name="arrWordsHdrSizeW"><a href="SMRep.html#arrWordsHdrSizeW"><span class="hs-identifier">arrWordsHdrSizeW</span></a></a><span> </span><a name="local-6989586621680013358"><a href="#local-6989586621680013358"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-327"></a><span>    </span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621680013358"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span>
</span><a name="line-328"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sIZEOF_StgArrBytes_NoHdr</span><span> </span><a href="#local-6989586621680013358"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621680013358"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span class="hs-identifier">arrPtrsHdrSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-331"></a><a name="arrPtrsHdrSize"><a href="SMRep.html#arrPtrsHdrSize"><span class="hs-identifier">arrPtrsHdrSize</span></a></a><span> </span><a name="local-6989586621680013359"><a href="#local-6989586621680013359"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-332"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#fixedHdrSize"><span class="hs-identifier hs-var">fixedHdrSize</span></a><span> </span><a href="#local-6989586621680013359"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">sIZEOF_StgMutArrPtrs_NoHdr</span><span> </span><a href="#local-6989586621680013359"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-333"></a><span>
</span><a name="line-334"></a><span class="hs-identifier">arrPtrsHdrSizeW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-335"></a><a name="arrPtrsHdrSizeW"><a href="SMRep.html#arrPtrsHdrSizeW"><span class="hs-identifier">arrPtrsHdrSizeW</span></a></a><span> </span><a name="local-6989586621680013360"><a href="#local-6989586621680013360"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-336"></a><span>    </span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621680013360"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span>
</span><a name="line-337"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sIZEOF_StgMutArrPtrs_NoHdr</span><span> </span><a href="#local-6989586621680013360"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621680013360"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-identifier">smallArrPtrsHdrSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-340"></a><a name="smallArrPtrsHdrSize"><a href="SMRep.html#smallArrPtrsHdrSize"><span class="hs-identifier">smallArrPtrsHdrSize</span></a></a><span> </span><a name="local-6989586621680013361"><a href="#local-6989586621680013361"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-341"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#fixedHdrSize"><span class="hs-identifier hs-var">fixedHdrSize</span></a><span> </span><a href="#local-6989586621680013361"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">sIZEOF_StgSmallMutArrPtrs_NoHdr</span><span> </span><a href="#local-6989586621680013361"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-identifier">smallArrPtrsHdrSizeW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-344"></a><a name="smallArrPtrsHdrSizeW"><a href="SMRep.html#smallArrPtrsHdrSizeW"><span class="hs-identifier">smallArrPtrsHdrSizeW</span></a></a><span> </span><a name="local-6989586621680013362"><a href="#local-6989586621680013362"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-345"></a><span>    </span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621680013362"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sIZEOF_StgSmallMutArrPtrs_NoHdr</span><span> </span><a href="#local-6989586621680013362"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621680013362"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- Thunks have an extra header word on SMP, so the update doesn't</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- splat the payload.</span><span>
</span><a name="line-350"></a><span class="hs-identifier">thunkHdrSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-351"></a><a name="thunkHdrSize"><a href="SMRep.html#thunkHdrSize"><span class="hs-identifier">thunkHdrSize</span></a></a><span> </span><a name="local-6989586621680013363"><a href="#local-6989586621680013363"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621680013363"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013364"><span class="hs-identifier hs-var">smp_hdr</span></a><span>
</span><a name="line-352"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680013364"><a href="#local-6989586621680013364"><span class="hs-identifier">smp_hdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sIZEOF_StgSMPThunkHeader</span><span> </span><a href="#local-6989586621680013363"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">quot</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621680013363"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-identifier">hdrSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-355"></a><a name="hdrSize"><a href="SMRep.html#hdrSize"><span class="hs-identifier">hdrSize</span></a></a><span> </span><a name="local-6989586621680013365"><a href="#local-6989586621680013365"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013366"><a href="#local-6989586621680013366"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a><span> </span><a href="#local-6989586621680013365"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#hdrSizeW"><span class="hs-identifier hs-var">hdrSizeW</span></a><span> </span><a href="#local-6989586621680013365"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680013366"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span>
</span><a name="line-356"></a><span>
</span><a name="line-357"></a><span class="hs-identifier">hdrSizeW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-358"></a><a name="hdrSizeW"><a href="SMRep.html#hdrSizeW"><span class="hs-identifier">hdrSizeW</span></a></a><span> </span><a name="local-6989586621680013367"><a href="#local-6989586621680013367"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680013368"><a href="#local-6989586621680013368"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#closureTypeHdrSize"><span class="hs-identifier hs-var">closureTypeHdrSize</span></a><span> </span><a href="#local-6989586621680013367"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680013368"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-359"></a><span class="hs-identifier">hdrSizeW</span><span> </span><a name="local-6989586621680013369"><a href="#local-6989586621680013369"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArrayPtrsRep"><span class="hs-identifier hs-var">ArrayPtrsRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#arrPtrsHdrSizeW"><span class="hs-identifier hs-var">arrPtrsHdrSizeW</span></a><span> </span><a href="#local-6989586621680013369"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-360"></a><span class="hs-identifier">hdrSizeW</span><span> </span><a name="local-6989586621680013370"><a href="#local-6989586621680013370"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#SmallArrayPtrsRep"><span class="hs-identifier hs-var">SmallArrayPtrsRep</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#smallArrPtrsHdrSizeW"><span class="hs-identifier hs-var">smallArrPtrsHdrSizeW</span></a><span> </span><a href="#local-6989586621680013370"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-361"></a><span class="hs-identifier">hdrSizeW</span><span> </span><a name="local-6989586621680013371"><a href="#local-6989586621680013371"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArrayWordsRep"><span class="hs-identifier hs-var">ArrayWordsRep</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#arrWordsHdrSizeW"><span class="hs-identifier hs-var">arrWordsHdrSizeW</span></a><span> </span><a href="#local-6989586621680013371"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-362"></a><span class="hs-identifier">hdrSizeW</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;SMRep.hdrSizeW&quot;</span><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span class="hs-identifier">nonHdrSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-365"></a><a name="nonHdrSize"><a href="SMRep.html#nonHdrSize"><span class="hs-identifier">nonHdrSize</span></a></a><span> </span><a name="local-6989586621680013372"><a href="#local-6989586621680013372"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013373"><a href="#local-6989586621680013373"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#wordsToBytes"><span class="hs-identifier hs-var">wordsToBytes</span></a><span> </span><a href="#local-6989586621680013372"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#nonHdrSizeW"><span class="hs-identifier hs-var">nonHdrSizeW</span></a><span> </span><a href="#local-6989586621680013373"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span class="hs-identifier">nonHdrSizeW</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-368"></a><a name="nonHdrSizeW"><a href="SMRep.html#nonHdrSizeW"><span class="hs-identifier">nonHdrSizeW</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680013374"><a href="#local-6989586621680013374"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680013375"><a href="#local-6989586621680013375"><span class="hs-identifier">np</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680013374"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013375"><span class="hs-identifier hs-var">np</span></a><span>
</span><a name="line-369"></a><span class="hs-identifier">nonHdrSizeW</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArrayPtrsRep"><span class="hs-identifier hs-var">ArrayPtrsRep</span></a><span> </span><a name="local-6989586621680013376"><a href="#local-6989586621680013376"><span class="hs-identifier">elems</span></a></a><span> </span><a name="local-6989586621680013377"><a href="#local-6989586621680013377"><span class="hs-identifier">ct</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680013376"><span class="hs-identifier hs-var">elems</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013377"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-370"></a><span class="hs-identifier">nonHdrSizeW</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#SmallArrayPtrsRep"><span class="hs-identifier hs-var">SmallArrayPtrsRep</span></a><span> </span><a name="local-6989586621680013378"><a href="#local-6989586621680013378"><span class="hs-identifier">elems</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680013378"><span class="hs-identifier hs-var">elems</span></a><span>
</span><a name="line-371"></a><span class="hs-identifier">nonHdrSizeW</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArrayWordsRep"><span class="hs-identifier hs-var">ArrayWordsRep</span></a><span> </span><a name="local-6989586621680013379"><a href="#local-6989586621680013379"><span class="hs-identifier">words</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680013379"><span class="hs-identifier hs-var">words</span></a><span>
</span><a name="line-372"></a><span class="hs-identifier">nonHdrSizeW</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#StackRep"><span class="hs-identifier hs-var">StackRep</span></a><span> </span><a name="local-6989586621680013380"><a href="#local-6989586621680013380"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680013380"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-373"></a><span class="hs-identifier">nonHdrSizeW</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#RTSRep"><span class="hs-identifier hs-var">RTSRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680013381"><a href="#local-6989586621680013381"><span class="hs-identifier">rep</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#nonHdrSizeW"><span class="hs-identifier hs-var">nonHdrSizeW</span></a><span> </span><a href="#local-6989586621680013381"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-comment">-- | The total size of the closure, in words.</span><span>
</span><a name="line-376"></a><span class="hs-identifier">heapClosureSizeW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-377"></a><a name="heapClosureSizeW"><a href="SMRep.html#heapClosureSizeW"><span class="hs-identifier">heapClosureSizeW</span></a></a><span> </span><a name="local-6989586621680013382"><a href="#local-6989586621680013382"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680013383"><a href="#local-6989586621680013383"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680013384"><a href="#local-6989586621680013384"><span class="hs-identifier">np</span></a></a><span> </span><a name="local-6989586621680013385"><a href="#local-6989586621680013385"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#closureTypeHdrSize"><span class="hs-identifier hs-var">closureTypeHdrSize</span></a><span> </span><a href="#local-6989586621680013382"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680013385"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013383"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013384"><span class="hs-identifier hs-var">np</span></a><span>
</span><a name="line-379"></a><span class="hs-identifier">heapClosureSizeW</span><span> </span><a name="local-6989586621680013386"><a href="#local-6989586621680013386"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArrayPtrsRep"><span class="hs-identifier hs-var">ArrayPtrsRep</span></a><span> </span><a name="local-6989586621680013387"><a href="#local-6989586621680013387"><span class="hs-identifier">elems</span></a></a><span> </span><a name="local-6989586621680013388"><a href="#local-6989586621680013388"><span class="hs-identifier">ct</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#arrPtrsHdrSizeW"><span class="hs-identifier hs-var">arrPtrsHdrSizeW</span></a><span> </span><a href="#local-6989586621680013386"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013387"><span class="hs-identifier hs-var">elems</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013388"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-381"></a><span class="hs-identifier">heapClosureSizeW</span><span> </span><a name="local-6989586621680013389"><a href="#local-6989586621680013389"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#SmallArrayPtrsRep"><span class="hs-identifier hs-var">SmallArrayPtrsRep</span></a><span> </span><a name="local-6989586621680013390"><a href="#local-6989586621680013390"><span class="hs-identifier">elems</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#smallArrPtrsHdrSizeW"><span class="hs-identifier hs-var">smallArrPtrsHdrSizeW</span></a><span> </span><a href="#local-6989586621680013389"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013390"><span class="hs-identifier hs-var">elems</span></a><span>
</span><a name="line-383"></a><span class="hs-identifier">heapClosureSizeW</span><span> </span><a name="local-6989586621680013391"><a href="#local-6989586621680013391"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArrayWordsRep"><span class="hs-identifier hs-var">ArrayWordsRep</span></a><span> </span><a name="local-6989586621680013392"><a href="#local-6989586621680013392"><span class="hs-identifier">words</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-384"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#arrWordsHdrSizeW"><span class="hs-identifier hs-var">arrWordsHdrSizeW</span></a><span> </span><a href="#local-6989586621680013391"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680013392"><span class="hs-identifier hs-var">words</span></a><span>
</span><a name="line-385"></a><span class="hs-identifier">heapClosureSizeW</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;SMRep.heapClosureSize&quot;</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-identifier">closureTypeHdrSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ClosureTypeInfo"><span class="hs-identifier hs-type">ClosureTypeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-388"></a><a name="closureTypeHdrSize"><a href="SMRep.html#closureTypeHdrSize"><span class="hs-identifier">closureTypeHdrSize</span></a></a><span> </span><a name="local-6989586621680013393"><a href="#local-6989586621680013393"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013394"><a href="#local-6989586621680013394"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680013394"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-389"></a><span>                  </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#thunkHdrSize"><span class="hs-identifier hs-var">thunkHdrSize</span></a><span> </span><a href="#local-6989586621680013393"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-390"></a><span>                  </span><a href="SMRep.html#ThunkSelector"><span class="hs-identifier hs-var">ThunkSelector</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#thunkHdrSize"><span class="hs-identifier hs-var">thunkHdrSize</span></a><span> </span><a href="#local-6989586621680013393"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-391"></a><span>                  </span><a href="SMRep.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#thunkHdrSize"><span class="hs-identifier hs-var">thunkHdrSize</span></a><span> </span><a href="#local-6989586621680013393"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-392"></a><span>                  </span><a href="SMRep.html#IndStatic"><span class="hs-identifier hs-var">IndStatic</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#thunkHdrSize"><span class="hs-identifier hs-var">thunkHdrSize</span></a><span> </span><a href="#local-6989586621680013393"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-393"></a><span>                  </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621680013393"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-394"></a><span>        </span><span class="hs-comment">-- All thunks use thunkHdrSize, even if they are non-updatable.</span><span>
</span><a name="line-395"></a><span>        </span><span class="hs-comment">-- this is because we don't have separate closure types for</span><span>
</span><a name="line-396"></a><span>        </span><span class="hs-comment">-- updatable vs. non-updatable thunks, so the GC can't tell the</span><span>
</span><a name="line-397"></a><span>        </span><span class="hs-comment">-- difference.  If we ever have significant numbers of non-</span><span>
</span><a name="line-398"></a><span>        </span><span class="hs-comment">-- updatable thunks, it might be worth fixing this.</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-401"></a><span class="hs-comment">-- Arrays</span><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-comment">-- | The byte offset into the card table of the card for a given element</span><span>
</span><a name="line-404"></a><span class="hs-identifier">card</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-405"></a><a name="card"><a href="SMRep.html#card"><span class="hs-identifier">card</span></a></a><span> </span><a name="local-6989586621680013395"><a href="#local-6989586621680013395"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013396"><a href="#local-6989586621680013396"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680013396"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mUT_ARR_PTRS_CARD_BITS</span><span> </span><a href="#local-6989586621680013395"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span class="hs-comment">-- | Convert a number of elements to a number of cards, rounding up</span><span>
</span><a name="line-408"></a><span class="hs-identifier">cardRoundUp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-409"></a><a name="cardRoundUp"><a href="SMRep.html#cardRoundUp"><span class="hs-identifier">cardRoundUp</span></a></a><span> </span><a name="local-6989586621680013397"><a href="#local-6989586621680013397"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013398"><a href="#local-6989586621680013398"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-410"></a><span>  </span><a href="SMRep.html#card"><span class="hs-identifier hs-var">card</span></a><span> </span><a href="#local-6989586621680013397"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680013398"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">mUT_ARR_PTRS_CARD_BITS</span><span> </span><a href="#local-6989586621680013397"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span class="hs-comment">-- | The size of a card table, in bytes</span><span>
</span><a name="line-413"></a><span class="hs-identifier">cardTableSizeB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span>
</span><a name="line-414"></a><a name="cardTableSizeB"><a href="SMRep.html#cardTableSizeB"><span class="hs-identifier">cardTableSizeB</span></a></a><span> </span><a name="local-6989586621680013399"><a href="#local-6989586621680013399"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013400"><a href="#local-6989586621680013400"><span class="hs-identifier">elems</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#cardRoundUp"><span class="hs-identifier hs-var">cardRoundUp</span></a><span> </span><a href="#local-6989586621680013399"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680013400"><span class="hs-identifier hs-var">elems</span></a><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-comment">-- | The size of a card table, in words</span><span>
</span><a name="line-417"></a><span class="hs-identifier">cardTableSizeW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SMRep.html#WordOff"><span class="hs-identifier hs-type">WordOff</span></a><span>
</span><a name="line-418"></a><a name="cardTableSizeW"><a href="SMRep.html#cardTableSizeW"><span class="hs-identifier">cardTableSizeW</span></a></a><span> </span><a name="local-6989586621680013401"><a href="#local-6989586621680013401"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680013402"><a href="#local-6989586621680013402"><span class="hs-identifier">elems</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-419"></a><span>  </span><a href="SMRep.html#bytesToWordsRoundUp"><span class="hs-identifier hs-var">bytesToWordsRoundUp</span></a><span> </span><a href="#local-6989586621680013401"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#cardTableSizeB"><span class="hs-identifier hs-var">cardTableSizeB</span></a><span> </span><a href="#local-6989586621680013401"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680013402"><span class="hs-identifier hs-var">elems</span></a><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- deriving the RTS closure type from an SMRep</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-cpp">#include &quot;../includes/rts/storage/ClosureTypes.h&quot;
#include &quot;../includes/rts/storage/FunTypes.h&quot;
</span><span class="hs-comment">-- Defines CONSTR, CONSTR_1_0 etc</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-comment">-- | Derives the RTS closure type from an 'SMRep'</span><span>
</span><a name="line-429"></a><span class="hs-identifier">rtsClosureType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-430"></a><a name="rtsClosureType"><a href="SMRep.html#rtsClosureType"><span class="hs-identifier">rtsClosureType</span></a></a><span> </span><a name="local-6989586621680013403"><a href="#local-6989586621680013403"><span class="hs-identifier">rep</span></a></a><span>
</span><a name="line-431"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680013403"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-432"></a><span>      </span><a href="SMRep.html#RTSRep"><span class="hs-identifier hs-var">RTSRep</span></a><span> </span><a name="local-6989586621680013404"><a href="#local-6989586621680013404"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680013404"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span>      </span><span class="hs-comment">-- See Note [static constructors]</span><span>
</span><a name="line-435"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CONSTR_1_0</span><span>
</span><a name="line-436"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-number">0</span><span> </span><span class="hs-number">1</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CONSTR_0_1</span><span>
</span><a name="line-437"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-number">2</span><span> </span><span class="hs-number">0</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CONSTR_2_0</span><span>
</span><a name="line-438"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CONSTR_1_1</span><span>
</span><a name="line-439"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-number">0</span><span> </span><span class="hs-number">2</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CONSTR_0_2</span><span>
</span><a name="line-440"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CONSTR_NOCAF</span><span>
</span><a name="line-441"></a><span>           </span><span class="hs-comment">-- See Note [Static NoCaf constructors]</span><span>
</span><a name="line-442"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CONSTR</span><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FUN_1_0</span><span>
</span><a name="line-445"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">1</span><span> </span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FUN_0_1</span><span>
</span><a name="line-446"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-number">0</span><span> </span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FUN_2_0</span><span>
</span><a name="line-447"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FUN_1_1</span><span>
</span><a name="line-448"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">2</span><span> </span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FUN_0_2</span><span>
</span><a name="line-449"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FUN</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">THUNK_1_0</span><span>
</span><a name="line-452"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">1</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">THUNK_0_1</span><span>
</span><a name="line-453"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-number">0</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">THUNK_2_0</span><span>
</span><a name="line-454"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">THUNK_1_1</span><span>
</span><a name="line-455"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">2</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">THUNK_0_2</span><span>
</span><a name="line-456"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">THUNK</span><span>
</span><a name="line-457"></a><span>
</span><a name="line-458"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#ThunkSelector"><span class="hs-identifier hs-var">ThunkSelector</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier">THUNK_SELECTOR</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FUN_STATIC</span><span>
</span><a name="line-461"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">THUNK_STATIC</span><span>
</span><a name="line-462"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">BLACKHOLE</span><span>
</span><a name="line-463"></a><span>      </span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="SMRep.html#IndStatic"><span class="hs-identifier hs-var">IndStatic</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IND_STATIC</span><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rtsClosureType&quot;</span><span>
</span><a name="line-466"></a><span>
</span><a name="line-467"></a><span class="hs-comment">-- We export these ones</span><span>
</span><a name="line-468"></a><span class="hs-identifier">rET_SMALL</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rET_BIG</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">aRG_GEN</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">aRG_GEN_BIG</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-469"></a><a name="rET_SMALL"><a href="SMRep.html#rET_SMALL"><span class="hs-identifier">rET_SMALL</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">RET_SMALL</span><span>
</span><a name="line-470"></a><a name="rET_BIG"><a href="SMRep.html#rET_BIG"><span class="hs-identifier">rET_BIG</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">RET_BIG</span><span>
</span><a name="line-471"></a><a name="aRG_GEN"><a href="SMRep.html#aRG_GEN"><span class="hs-identifier">aRG_GEN</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ARG_GEN</span><span>
</span><a name="line-472"></a><a name="aRG_GEN_BIG"><a href="SMRep.html#aRG_GEN_BIG"><span class="hs-identifier">aRG_GEN_BIG</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ARG_GEN_BIG</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-comment">{-
Note [static constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~

We used to have a CONSTR_STATIC closure type, and each constructor had
two info tables: one with CONSTR (or CONSTR_1_0 etc.), and one with
CONSTR_STATIC.

This distinction was removed, because when copying a data structure
into a compact region, we must copy static constructors into the
compact region too.  If we didn't do this, we would need to track the
references from the compact region out to the static constructors,
because they might (indirectly) refer to CAFs.

Since static constructors will be copied to the heap, if we wanted to
use different info tables for static and dynamic constructors, we
would have to switch the info pointer when copying the constructor
into the compact region, which means we would need an extra field of
the static info table to point to the dynamic one.

However, since the distinction between static and dynamic closure
types is never actually needed (other than for assertions), we can
just drop the distinction and use the same info table for both.

The GC *does* need to distinguish between static and dynamic closures,
but it does this using the HEAP_ALLOCED() macro which checks whether
the address of the closure resides within the dynamic heap.
HEAP_ALLOCED() doesn't read the closure's info table.

Note [Static NoCaf constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If we know that a top-level binding 'x' is not Caffy (ie no CAFs are
reachable from 'x'), then a statically allocated constructor (Just x)
is also not Caffy, and the garbage collector need not follow its
argument fields.  Exploiting this would require two static info tables
for Just, for the two cases where the argument was Caffy or non-Caffy.

Currently we don't do this; instead we treat nullary constructors
as non-Caffy, and the others as potentially Caffy.


************************************************************************
*                                                                      *
             Pretty printing of SMRep and friends
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-521"></a><span>
</span><a name="line-522"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="SMRep.html#ClosureTypeInfo"><span class="hs-identifier hs-type">ClosureTypeInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-523"></a><span>   </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SMRep.html#pprTypeInfo"><span class="hs-identifier hs-var">pprTypeInfo</span></a><span>
</span><a name="line-524"></a><span>
</span><a name="line-525"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="SMRep.html#SMRep"><span class="hs-identifier hs-type">SMRep</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-526"></a><span>   </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#HeapRep"><span class="hs-identifier hs-var">HeapRep</span></a><span> </span><a name="local-6989586621680013300"><a href="#local-6989586621680013300"><span class="hs-identifier">static</span></a></a><span> </span><a name="local-6989586621680013301"><a href="#local-6989586621680013301"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621680013302"><a href="#local-6989586621680013302"><span class="hs-identifier">nps</span></a></a><span> </span><a name="local-6989586621680013303"><a href="#local-6989586621680013303"><span class="hs-identifier">tyinfo</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-527"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680013304"><span class="hs-identifier hs-var">header</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">lbrace</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013303"><span class="hs-identifier hs-var">tyinfo</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">rbrace</span><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span>     </span><span class="hs-keyword">where</span><span>
</span><a name="line-529"></a><span>       </span><a name="local-6989586621680013304"><a href="#local-6989586621680013304"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;HeapRep&quot;</span><span>
</span><a name="line-530"></a><span>                </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680013300"><span class="hs-identifier hs-var">static</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;static&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-531"></a><span>                </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621680013305"><span class="hs-identifier hs-var">pp_n</span></a><span> </span><span class="hs-string">&quot;ptrs&quot;</span><span> </span><a href="#local-6989586621680013301"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621680013305"><span class="hs-identifier hs-var">pp_n</span></a><span> </span><span class="hs-string">&quot;nonptrs&quot;</span><span> </span><a href="#local-6989586621680013302"><span class="hs-identifier hs-var">nps</span></a><span>
</span><a name="line-532"></a><span>       </span><span class="hs-identifier">pp_n</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-533"></a><span>       </span><a name="local-6989586621680013305"><a href="#local-6989586621680013305"><span class="hs-identifier">pp_n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-534"></a><span>       </span><span class="hs-identifier">pp_n</span><span> </span><a name="local-6989586621680013306"><a href="#local-6989586621680013306"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621680013307"><a href="#local-6989586621680013307"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">int</span><span> </span><a href="#local-6989586621680013307"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621680013306"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArrayPtrsRep"><span class="hs-identifier hs-var">ArrayPtrsRep</span></a><span> </span><a name="local-6989586621680013308"><a href="#local-6989586621680013308"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ArrayPtrsRep&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013308"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#SmallArrayPtrsRep"><span class="hs-identifier hs-var">SmallArrayPtrsRep</span></a><span> </span><a name="local-6989586621680013309"><a href="#local-6989586621680013309"><span class="hs-identifier">size</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;SmallArrayPtrsRep&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013309"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArrayWordsRep"><span class="hs-identifier hs-var">ArrayWordsRep</span></a><span> </span><a name="local-6989586621680013310"><a href="#local-6989586621680013310"><span class="hs-identifier">words</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ArrayWordsRep&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013310"><span class="hs-identifier hs-var">words</span></a><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#StackRep"><span class="hs-identifier hs-var">StackRep</span></a><span> </span><a name="local-6989586621680013311"><a href="#local-6989586621680013311"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;StackRep&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013311"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-543"></a><span>
</span><a name="line-544"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#RTSRep"><span class="hs-identifier hs-var">RTSRep</span></a><span> </span><a name="local-6989586621680013312"><a href="#local-6989586621680013312"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680013313"><a href="#local-6989586621680013313"><span class="hs-identifier">rep</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tag:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013312"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013313"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="SMRep.html#ArgDescr"><span class="hs-identifier hs-type">ArgDescr</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-547"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArgSpec"><span class="hs-identifier hs-var">ArgSpec</span></a><span> </span><a name="local-6989586621680013298"><a href="#local-6989586621680013298"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ArgSpec&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013298"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-548"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#ArgGen"><span class="hs-identifier hs-var">ArgGen</span></a><span> </span><a name="local-6989586621680013299"><a href="#local-6989586621680013299"><span class="hs-identifier">ls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ArgGen&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013299"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-identifier">pprTypeInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SMRep.html#ClosureTypeInfo"><span class="hs-identifier hs-type">ClosureTypeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-551"></a><a name="pprTypeInfo"><a href="SMRep.html#pprTypeInfo"><span class="hs-identifier">pprTypeInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="SMRep.html#Constr"><span class="hs-identifier hs-var">Constr</span></a><span> </span><a name="local-6989586621680013405"><a href="#local-6989586621680013405"><span class="hs-identifier">tag</span></a></a><span> </span><a name="local-6989586621680013406"><a href="#local-6989586621680013406"><span class="hs-identifier">descr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-552"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Con&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-553"></a><span>    </span><span class="hs-identifier hs-var">braces</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tag:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013405"><span class="hs-identifier hs-var">tag</span></a><span>
</span><a name="line-554"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;descr:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680013406"><span class="hs-identifier hs-var">descr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-555"></a><span>
</span><a name="line-556"></a><span class="hs-identifier">pprTypeInfo</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#Fun"><span class="hs-identifier hs-var">Fun</span></a><span> </span><a name="local-6989586621680013407"><a href="#local-6989586621680013407"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621680013408"><a href="#local-6989586621680013408"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-557"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Fun&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-558"></a><span>    </span><span class="hs-identifier hs-var">braces</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;arity:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013407"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-559"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;fun_type:&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013408"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span class="hs-identifier">pprTypeInfo</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#ThunkSelector"><span class="hs-identifier hs-var">ThunkSelector</span></a><span> </span><a name="local-6989586621680013409"><a href="#local-6989586621680013409"><span class="hs-identifier">offset</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-562"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ThunkSel&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680013409"><span class="hs-identifier hs-var">offset</span></a><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span class="hs-identifier">pprTypeInfo</span><span> </span><a href="SMRep.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Thunk&quot;</span><span>
</span><a name="line-565"></a><span class="hs-identifier">pprTypeInfo</span><span> </span><a href="SMRep.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;BlackHole&quot;</span><span>
</span><a name="line-566"></a><span class="hs-identifier">pprTypeInfo</span><span> </span><a href="SMRep.html#IndStatic"><span class="hs-identifier hs-var">IndStatic</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;IndStatic&quot;</span><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span class="hs-comment">-- XXX Does not belong here!!</span><span>
</span><a name="line-569"></a><span class="hs-identifier">stringToWord8s</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span>
</span><a name="line-570"></a><a name="stringToWord8s"><a href="SMRep.html#stringToWord8s"><span class="hs-identifier">stringToWord8s</span></a></a><span> </span><a name="local-6989586621680013410"><a href="#local-6989586621680013410"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ord</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680013410"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-571"></a><span>
</span><a name="line-572"></a><span class="hs-identifier">pprWord8String</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-573"></a><span class="hs-comment">-- Debug printing.  Not very clever right now.</span><span>
</span><a name="line-574"></a><a name="pprWord8String"><a href="SMRep.html#pprWord8String"><span class="hs-identifier">pprWord8String</span></a></a><span> </span><a name="local-6989586621680013411"><a href="#local-6989586621680013411"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680013411"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">)</span><span>
</span><a name="line-575"></a></pre></body></html>