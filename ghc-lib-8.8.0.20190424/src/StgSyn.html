<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[StgSyn]{Shared term graph (STG) syntax for spineless-tagless code generation}

This data type represents programs just before code generation (conversion to
@Cmm@): basically, what we have is a stylised form of @CoreSyntax@, the style
being one that happens to be ideally suited to spineless tagless code
generation.
-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-17"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-18"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><a name="line-19"></a><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">StgSyn</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-22"></a><span>        </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>        </span><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="StgSyn.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#AltType"><span class="hs-identifier hs-type">AltType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>        </span><a href="StgSyn.html#StgPass"><span class="hs-identifier hs-type">StgPass</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#XRhsClosure"><span class="hs-identifier hs-type">XRhsClosure</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#XLet"><span class="hs-identifier hs-type">XLet</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#XLetNoEscape"><span class="hs-identifier hs-type">XLetNoEscape</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-type">NoExtSilent</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#noExtSilent"><span class="hs-identifier hs-var">noExtSilent</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>        </span><a href="StgSyn.html#UpdateFlag"><span class="hs-identifier hs-type">UpdateFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="StgSyn.html#isUpdatable"><span class="hs-identifier hs-var">isUpdatable</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>        </span><span class="hs-comment">-- a set of synonyms for the vanilla parameterisation</span><span>
</span><a name="line-34"></a><span>        </span><a href="StgSyn.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#StgBinding"><span class="hs-identifier hs-type">StgBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#StgAlt"><span class="hs-identifier hs-type">StgAlt</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>        </span><span class="hs-comment">-- a set of synonyms for the code gen parameterisation</span><span>
</span><a name="line-37"></a><span>        </span><a href="StgSyn.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#CgStgBinding"><span class="hs-identifier hs-type">CgStgBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#CgStgExpr"><span class="hs-identifier hs-type">CgStgExpr</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#CgStgAlt"><span class="hs-identifier hs-type">CgStgAlt</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>        </span><span class="hs-comment">-- a set of synonyms for the lambda lifting parameterisation</span><span>
</span><a name="line-40"></a><span>        </span><a href="StgSyn.html#LlStgTopBinding"><span class="hs-identifier hs-type">LlStgTopBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#LlStgBinding"><span class="hs-identifier hs-type">LlStgBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#LlStgExpr"><span class="hs-identifier hs-type">LlStgExpr</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#LlStgRhs"><span class="hs-identifier hs-type">LlStgRhs</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#LlStgAlt"><span class="hs-identifier hs-type">LlStgAlt</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>        </span><span class="hs-comment">-- a set of synonyms to distinguish in- and out variants</span><span>
</span><a name="line-43"></a><span>        </span><a href="StgSyn.html#InStgArg"><span class="hs-identifier hs-type">InStgArg</span></a><span class="hs-special">,</span><span>  </span><a href="StgSyn.html#InStgTopBinding"><span class="hs-identifier hs-type">InStgTopBinding</span></a><span class="hs-special">,</span><span>  </span><a href="StgSyn.html#InStgBinding"><span class="hs-identifier hs-type">InStgBinding</span></a><span class="hs-special">,</span><span>  </span><a href="StgSyn.html#InStgExpr"><span class="hs-identifier hs-type">InStgExpr</span></a><span class="hs-special">,</span><span>  </span><a href="StgSyn.html#InStgRhs"><span class="hs-identifier hs-type">InStgRhs</span></a><span class="hs-special">,</span><span>  </span><a href="StgSyn.html#InStgAlt"><span class="hs-identifier hs-type">InStgAlt</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="StgSyn.html#OutStgArg"><span class="hs-identifier hs-type">OutStgArg</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#OutStgTopBinding"><span class="hs-identifier hs-type">OutStgTopBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#OutStgBinding"><span class="hs-identifier hs-type">OutStgBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#OutStgExpr"><span class="hs-identifier hs-type">OutStgExpr</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#OutStgRhs"><span class="hs-identifier hs-type">OutStgRhs</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#OutStgAlt"><span class="hs-identifier hs-type">OutStgAlt</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>        </span><span class="hs-comment">-- StgOp</span><span>
</span><a name="line-47"></a><span>        </span><a href="StgSyn.html#StgOp"><span class="hs-identifier hs-type">StgOp</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>        </span><span class="hs-comment">-- utils</span><span>
</span><a name="line-50"></a><span>        </span><a href="StgSyn.html#topStgBindHasCafRefs"><span class="hs-identifier hs-var">topStgBindHasCafRefs</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#stgArgHasCafRefs"><span class="hs-identifier hs-var">stgArgHasCafRefs</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#stgRhsArity"><span class="hs-identifier hs-var">stgRhsArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><a href="StgSyn.html#isDllConApp"><span class="hs-identifier hs-var">isDllConApp</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="StgSyn.html#stgArgType"><span class="hs-identifier hs-var">stgArgType</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="StgSyn.html#stripStgTicksTop"><span class="hs-identifier hs-var">stripStgTicksTop</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><a href="StgSyn.html#stgCaseBndrInScope"><span class="hs-identifier hs-var">stgCaseBndrInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>        </span><a href="StgSyn.html#pprStgBinding"><span class="hs-identifier hs-var">pprStgBinding</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#pprGenStgTopBindings"><span class="hs-identifier hs-var">pprGenStgTopBindings</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#pprStgTopBindings"><span class="hs-identifier hs-var">pprStgTopBindings</span></a><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreSyn</span><span>     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">AltCon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Tickish</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CostCentre</span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">CostCentreStack</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Data</span><span>   </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>   </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">intersperse</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ForeignCall</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ForeignCall</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Id</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">IdInfo</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">mayHaveCafRefs</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">VarSet</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Literal</span><span>     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Literal</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">literalType</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Module</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Module</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Packages</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">isDllName</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PprCore</span><span>     </span><span class="hs-special">(</span><span> </span><span class="hs-comment">{- instances -}</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrimOp</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">PrimOp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PrimCall</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCon</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">PrimRep</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">RepType</span><span>     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">typePrimRep1</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unique</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Unique</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{@GenStgBinding@}
*                                                                      *
************************************************************************

As usual, expressions are interesting; other things are boring. Here
are the boring things [except note the @GenStgRhs@], parameterised
with respect to binder and occurrence information (just as in
@CoreSyn@):
-}</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">-- | A top-level binding.</span><span>
</span><a name="line-104"></a><span class="hs-keyword">data</span><span> </span><a name="GenStgTopBinding"><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier">GenStgTopBinding</span></a></a><span> </span><a name="local-6989586621680630079"><a href="#local-6989586621680630079"><span class="hs-identifier">pass</span></a></a><span>
</span><a name="line-105"></a><span class="hs-comment">-- See Note [CoreSyn top-level string literals]</span><span>
</span><a name="line-106"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="StgTopLifted"><a href="StgSyn.html#StgTopLifted"><span class="hs-identifier">StgTopLifted</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span> </span><a href="#local-6989586621680630079"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgTopStringLit"><a href="StgSyn.html#StgTopStringLit"><span class="hs-identifier">StgTopStringLit</span></a></a><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-keyword">data</span><span> </span><a name="GenStgBinding"><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier">GenStgBinding</span></a></a><span> </span><a name="local-6989586621680630078"><a href="#local-6989586621680630078"><span class="hs-identifier">pass</span></a></a><span>
</span><a name="line-110"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="StgNonRec"><a href="StgSyn.html#StgNonRec"><span class="hs-identifier">StgNonRec</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><a href="#local-6989586621680630078"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span> </span><a href="#local-6989586621680630078"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgRec"><a href="StgSyn.html#StgRec"><span class="hs-identifier">StgRec</span></a></a><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><a href="#local-6989586621680630078"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span> </span><a href="#local-6989586621680630078"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{@StgArg@}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-keyword">data</span><span> </span><a name="StgArg"><a href="StgSyn.html#StgArg"><span class="hs-identifier">StgArg</span></a></a><span>
</span><a name="line-122"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="StgVarArg"><a href="StgSyn.html#StgVarArg"><span class="hs-identifier">StgVarArg</span></a></a><span>  </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-123"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgLitArg"><a href="StgSyn.html#StgLitArg"><span class="hs-identifier">StgLitArg</span></a></a><span>  </span><span class="hs-identifier hs-type">Literal</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-comment">-- | Does this constructor application refer to</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- anything in a different *Windows* DLL?</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- If so, we can't allocate it statically</span><span>
</span><a name="line-128"></a><span class="hs-identifier">isDllConApp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Module</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-129"></a><a name="isDllConApp"><a href="StgSyn.html#isDllConApp"><span class="hs-identifier">isDllConApp</span></a></a><span> </span><a name="local-6989586621680630102"><a href="#local-6989586621680630102"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680630103"><a href="#local-6989586621680630103"><span class="hs-identifier">this_mod</span></a></a><span> </span><a name="local-6989586621680630104"><a href="#local-6989586621680630104"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621680630105"><a href="#local-6989586621680630105"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-130"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621680630102"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isDllName</span><span> </span><a href="#local-6989586621680630102"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680630103"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConName</span><span> </span><a href="#local-6989586621680630104"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="#local-6989586621680630106"><span class="hs-identifier hs-var">is_dll_arg</span></a><span> </span><a href="#local-6989586621680630105"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-132"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-133"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-comment">-- NB: typePrimRep1 is legit because any free variables won't have</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-comment">-- unlifted type (there are no unlifted things at top level)</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-identifier">is_dll_arg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-137"></a><span>    </span><a name="local-6989586621680630106"><a href="#local-6989586621680630106"><span class="hs-identifier">is_dll_arg</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a><span> </span><a name="local-6989586621680630107"><a href="#local-6989586621680630107"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="StgSyn.html#isAddrRep"><span class="hs-identifier hs-var">isAddrRep</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typePrimRep1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621680630107"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>                             </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isDllName</span><span> </span><a href="#local-6989586621680630102"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680630103"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621680630107"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>    </span><span class="hs-identifier">is_dll_arg</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">-- True of machine addresses; these are the things that don't</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- work across DLLs. The key point here is that VoidRep comes</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- out False, so that a top level nullary GADT constructor is</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- False for isDllConApp</span><span>
</span><a name="line-145"></a><span class="hs-comment">--    data T a where</span><span>
</span><a name="line-146"></a><span class="hs-comment">--      T1 :: T Int</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- gives</span><span>
</span><a name="line-148"></a><span class="hs-comment">--    T1 :: forall a. (a~Int) -&gt; T a</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- and hence the top-level binding</span><span>
</span><a name="line-150"></a><span class="hs-comment">--    $WT1 :: T Int</span><span>
</span><a name="line-151"></a><span class="hs-comment">--    $WT1 = T1 Int (Coercion (Refl Int))</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- The coercion argument here gets VoidRep</span><span>
</span><a name="line-153"></a><span class="hs-identifier">isAddrRep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PrimRep</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-154"></a><a name="isAddrRep"><a href="StgSyn.html#isAddrRep"><span class="hs-identifier">isAddrRep</span></a></a><span> </span><span class="hs-identifier hs-var">AddrRep</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-155"></a><span class="hs-identifier">isAddrRep</span><span> </span><span class="hs-identifier hs-var">LiftedRep</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-156"></a><span class="hs-identifier">isAddrRep</span><span> </span><span class="hs-identifier hs-var">UnliftedRep</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-157"></a><span class="hs-identifier">isAddrRep</span><span> </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-- | Type of an @StgArg@</span><span>
</span><a name="line-160"></a><span class="hs-comment">--</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- Very half baked because we have lost the type arguments.</span><span>
</span><a name="line-162"></a><span class="hs-identifier">stgArgType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-163"></a><a name="stgArgType"><a href="StgSyn.html#stgArgType"><span class="hs-identifier">stgArgType</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a><span> </span><a name="local-6989586621680630108"><a href="#local-6989586621680630108"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621680630108"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-164"></a><span class="hs-identifier">stgArgType</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a><span> </span><a name="local-6989586621680630109"><a href="#local-6989586621680630109"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">literalType</span><span> </span><a href="#local-6989586621680630109"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">-- | Strip ticks of a given type from an STG expression</span><span>
</span><a name="line-168"></a><span class="hs-identifier">stripStgTicksTop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tickish</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630101"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Tickish</span><span> </span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630101"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-169"></a><a name="stripStgTicksTop"><a href="StgSyn.html#stripStgTicksTop"><span class="hs-identifier">stripStgTicksTop</span></a></a><span> </span><a name="local-6989586621680630110"><a href="#local-6989586621680630110"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680630111"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-170"></a><span>   </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680630111"><a href="#local-6989586621680630111"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621680630112"><a href="#local-6989586621680630112"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a><span> </span><a name="local-6989586621680630113"><a href="#local-6989586621680630113"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621680630114"><a href="#local-6989586621680630114"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680630110"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680630113"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680630111"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680630113"><span class="hs-identifier hs-var">t</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680630112"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680630114"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-171"></a><span>         </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680630115"><a href="#local-6989586621680630115"><span class="hs-identifier">ts</span></a></a><span> </span><a name="local-6989586621680630116"><a href="#local-6989586621680630116"><span class="hs-identifier">other</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680630115"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680630116"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- | Given an alt type and whether the program is unarised, return whether the</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- case binder is in scope.</span><span>
</span><a name="line-175"></a><span class="hs-comment">--</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- Case binders of unboxed tuple or unboxed sum type always dead after the</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- unariser has run. See Note [Post-unarisation invariants].</span><span>
</span><a name="line-178"></a><span class="hs-identifier">stgCaseBndrInScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#AltType"><span class="hs-identifier hs-type">AltType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">{- ^ unarised? -}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-179"></a><a name="stgCaseBndrInScope"><a href="StgSyn.html#stgCaseBndrInScope"><span class="hs-identifier">stgCaseBndrInScope</span></a></a><span> </span><a name="local-6989586621680630117"><a href="#local-6989586621680630117"><span class="hs-identifier">alt_ty</span></a></a><span> </span><a name="local-6989586621680630118"><a href="#local-6989586621680630118"><span class="hs-identifier">unarised</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-180"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680630117"><span class="hs-identifier hs-var">alt_ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-181"></a><span>      </span><a href="StgSyn.html#AlgAlt"><span class="hs-identifier hs-var">AlgAlt</span></a><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-182"></a><span>      </span><a href="StgSyn.html#PrimAlt"><span class="hs-identifier hs-var">PrimAlt</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-183"></a><span>      </span><a href="StgSyn.html#MultiValAlt"><span class="hs-identifier hs-var">MultiValAlt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621680630118"><span class="hs-identifier hs-var">unarised</span></a><span>
</span><a name="line-184"></a><span>      </span><a href="StgSyn.html#PolyAlt"><span class="hs-identifier hs-var">PolyAlt</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{STG expressions}
*                                                                      *
************************************************************************

The @GenStgExpr@ data type is parameterised on binder and occurrence
info, as before.

************************************************************************
*                                                                      *
\subsubsection{@GenStgExpr@ application}
*                                                                      *
************************************************************************

An application is of a function to a list of atoms [not expressions].
Operationally, we want to push the arguments on the stack and call the
function. (If the arguments were expressions, we would have to build
their closures first.)

There is no constructor for a lone variable; it would appear as
@StgApp var []@.
-}</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-keyword">data</span><span> </span><a name="GenStgExpr"><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier">GenStgExpr</span></a></a><span> </span><a name="local-6989586621680630077"><a href="#local-6989586621680630077"><span class="hs-identifier">pass</span></a></a><span>
</span><a name="line-212"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="StgApp"><a href="StgSyn.html#StgApp"><span class="hs-identifier">StgApp</span></a></a><span>
</span><a name="line-213"></a><span>        </span><span class="hs-identifier hs-type">Id</span><span>       </span><span class="hs-comment">-- function</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-special">[</span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- arguments; may be empty</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{@StgConApp@ and @StgPrimApp@---saturated applications}
*                                                                      *
************************************************************************

There are specialised forms of application, for constructors,
primitives, and literals.
-}</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgLit"><a href="StgSyn.html#StgLit"><span class="hs-identifier">StgLit</span></a></a><span>      </span><span class="hs-identifier hs-type">Literal</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span>        </span><span class="hs-comment">-- StgConApp is vital for returning unboxed tuples or sums</span><span>
</span><a name="line-230"></a><span>        </span><span class="hs-comment">-- which can't be let-bound first</span><span>
</span><a name="line-231"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgConApp"><a href="StgSyn.html#StgConApp"><span class="hs-identifier">StgConApp</span></a></a><span>   </span><span class="hs-identifier hs-type">DataCon</span><span>
</span><a name="line-232"></a><span>                </span><span class="hs-special">[</span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Saturated</span><span>
</span><a name="line-233"></a><span>                </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- See Note [Types in StgConApp] in UnariseStg</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgOpApp"><a href="StgSyn.html#StgOpApp"><span class="hs-identifier">StgOpApp</span></a></a><span>    </span><a href="StgSyn.html#StgOp"><span class="hs-identifier hs-type">StgOp</span></a><span>    </span><span class="hs-comment">-- Primitive op or foreign call</span><span>
</span><a name="line-236"></a><span>                </span><span class="hs-special">[</span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Saturated.</span><span>
</span><a name="line-237"></a><span>                </span><span class="hs-identifier hs-type">Type</span><span>     </span><span class="hs-comment">-- Result type</span><span>
</span><a name="line-238"></a><span>                         </span><span class="hs-comment">-- We need to know this so that we can</span><span>
</span><a name="line-239"></a><span>                         </span><span class="hs-comment">-- assign result registers</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{@StgLam@}
*                                                                      *
************************************************************************

StgLam is used *only* during CoreToStg's work. Before CoreToStg has
finished it encodes (\x -&gt; e) as (let f = \x -&gt; e in f)
TODO: Encode this via an extension to GenStgExpr &#224; la TTG.
-}</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgLam"><a href="StgSyn.html#StgLam"><span class="hs-identifier">StgLam</span></a></a><span>
</span><a name="line-254"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>        </span><a href="StgSyn.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a><span>    </span><span class="hs-comment">-- Body of lambda</span><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{@GenStgExpr@: case-expressions}
*                                                                      *
************************************************************************

This has the same boxed/unboxed business as Core case expressions.
-}</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgCase"><a href="StgSyn.html#StgCase"><span class="hs-identifier">StgCase</span></a></a><span>
</span><a name="line-268"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- the thing to examine</span><span>
</span><a name="line-269"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- binds the result of evaluating the scrutinee</span><span>
</span><a name="line-270"></a><span>        </span><a href="StgSyn.html#AltType"><span class="hs-identifier hs-type">AltType</span></a><span>
</span><a name="line-271"></a><span>        </span><span class="hs-special">[</span><a href="StgSyn.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">]</span><span>
</span><a name="line-272"></a><span>                    </span><span class="hs-comment">-- The DEFAULT case is always *first*</span><span>
</span><a name="line-273"></a><span>                    </span><span class="hs-comment">-- if it is there at all</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{@GenStgExpr@: @let(rec)@-expressions}
*                                                                      *
************************************************************************

The various forms of let(rec)-expression encode most of the
interesting things we want to do.
\begin{enumerate}
\item
\begin{verbatim}
let-closure x = [free-vars] [args] expr
in e
\end{verbatim}
is equivalent to
\begin{verbatim}
let x = (\free-vars -&gt; \args -&gt; expr) free-vars
\end{verbatim}
\tr{args} may be empty (and is for most closures).  It isn't under
circumstances like this:
\begin{verbatim}
let x = (\y -&gt; y+z)
\end{verbatim}
This gets mangled to
\begin{verbatim}
let-closure x = [z] [y] (y+z)
\end{verbatim}
The idea is that we compile code for @(y+z)@ in an environment in which
@z@ is bound to an offset from \tr{Node}, and @y@ is bound to an
offset from the stack pointer.

(A let-closure is an @StgLet@ with a @StgRhsClosure@ RHS.)

\item
\begin{verbatim}
let-constructor x = Constructor [args]
in e
\end{verbatim}

(A let-constructor is an @StgLet@ with a @StgRhsCon@ RHS.)

\item
Letrec-expressions are essentially the same deal as
let-closure/let-constructor, so we use a common structure and
distinguish between them with an @is_recursive@ boolean flag.

\item
\begin{verbatim}
let-unboxed u = an arbitrary arithmetic expression in unboxed values
in e
\end{verbatim}
All the stuff on the RHS must be fully evaluated.
No function calls either!

(We've backed away from this toward case-expressions with
suitably-magical alts ...)

\item
~[Advanced stuff here! Not to start with, but makes pattern matching
generate more efficient code.]

\begin{verbatim}
let-escapes-not fail = expr
in e'
\end{verbatim}
Here the idea is that @e'@ guarantees not to put @fail@ in a data structure,
or pass it to another function. All @e'@ will ever do is tail-call @fail@.
Rather than build a closure for @fail@, all we need do is to record the stack
level at the moment of the @let-escapes-not@; then entering @fail@ is just
a matter of adjusting the stack pointer back down to that point and entering
the code for it.

Another example:
\begin{verbatim}
f x y = let z = huge-expression in
        if y==1 then z else
        if y==2 then z else
        1
\end{verbatim}

(A let-escapes-not is an @StgLetNoEscape@.)

\item
We may eventually want:
\begin{verbatim}
let-literal x = Literal
in e
\end{verbatim}
\end{enumerate}

And so the code for let(rec)-things:
-}</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgLet"><a href="StgSyn.html#StgLet"><span class="hs-identifier">StgLet</span></a></a><span>
</span><a name="line-370"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#XLet"><span class="hs-identifier hs-type">XLet</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-371"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- right hand sides (see below)</span><span>
</span><a name="line-372"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- body</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgLetNoEscape"><a href="StgSyn.html#StgLetNoEscape"><span class="hs-identifier">StgLetNoEscape</span></a></a><span>
</span><a name="line-375"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#XLetNoEscape"><span class="hs-identifier hs-type">XLetNoEscape</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- right hand sides (see below)</span><span>
</span><a name="line-377"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- body</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
\subsubsection{@GenStgExpr@: @hpc@, @scc@ and other debug annotations}
%*                                                                      *
%************************************************************************

Finally for @hpc@ expressions we introduce a new STG construct.
-}</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgTick"><a href="StgSyn.html#StgTick"><span class="hs-identifier">StgTick</span></a></a><span>
</span><a name="line-390"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tickish</span><span> </span><span class="hs-identifier hs-type">Id</span><span class="hs-special">)</span><span>
</span><a name="line-391"></a><span>    </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630077"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- sub expression</span><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span class="hs-comment">-- END of GenStgExpr</span><span>
</span><a name="line-394"></a><span>
</span><a name="line-395"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{STG right-hand sides}
*                                                                      *
************************************************************************

Here's the rest of the interesting stuff for @StgLet@s; the first
flavour is for closures:
-}</span><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span class="hs-keyword">data</span><span> </span><a name="GenStgRhs"><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier">GenStgRhs</span></a></a><span> </span><a name="local-6989586621680630076"><a href="#local-6989586621680630076"><span class="hs-identifier">pass</span></a></a><span>
</span><a name="line-407"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="StgRhsClosure"><a href="StgSyn.html#StgRhsClosure"><span class="hs-identifier">StgRhsClosure</span></a></a><span>
</span><a name="line-408"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#XRhsClosure"><span class="hs-identifier hs-type">XRhsClosure</span></a><span> </span><a href="#local-6989586621680630076"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Extension point for non-global free var</span><span>
</span><a name="line-409"></a><span>                           </span><span class="hs-comment">--   list just before 'CodeGen'.</span><span>
</span><a name="line-410"></a><span>        </span><span class="hs-identifier hs-type">CostCentreStack</span><span>    </span><span class="hs-comment">-- ^ CCS to be attached (default is CurrentCCS)</span><span>
</span><a name="line-411"></a><span>        </span><span class="hs-glyph">!</span><a href="StgSyn.html#UpdateFlag"><span class="hs-identifier hs-type">UpdateFlag</span></a><span>        </span><span class="hs-comment">-- ^ 'ReEntrant' | 'Updatable' | 'SingleEntry'</span><span>
</span><a name="line-412"></a><span>        </span><span class="hs-special">[</span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><a href="#local-6989586621680630076"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- ^ arguments; if empty, then not a function;</span><span>
</span><a name="line-413"></a><span>                           </span><span class="hs-comment">--   as above, order is important.</span><span>
</span><a name="line-414"></a><span>        </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630076"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ body</span><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-comment">{-
An example may be in order.  Consider:
\begin{verbatim}
let t = \x -&gt; \y -&gt; ... x ... y ... p ... q in e
\end{verbatim}
Pulling out the free vars and stylising somewhat, we get the equivalent:
\begin{verbatim}
let t = (\[p,q] -&gt; \[x,y] -&gt; ... x ... y ... p ...q) p q
\end{verbatim}
Stg-operationally, the @[x,y]@ are on the stack, the @[p,q]@ are
offsets from @Node@ into the closure, and the code ptr for the closure
will be exactly that in parentheses above.

The second flavour of right-hand-side is for constructors (simple but important):
-}</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgRhsCon"><a href="StgSyn.html#StgRhsCon"><span class="hs-identifier">StgRhsCon</span></a></a><span>
</span><a name="line-433"></a><span>        </span><span class="hs-identifier hs-type">CostCentreStack</span><span> </span><span class="hs-comment">-- CCS to be attached (default is CurrentCCS).</span><span>
</span><a name="line-434"></a><span>                        </span><span class="hs-comment">-- Top-level (static) ones will end up with</span><span>
</span><a name="line-435"></a><span>                        </span><span class="hs-comment">-- DontCareCCS, because we don't count static</span><span>
</span><a name="line-436"></a><span>                        </span><span class="hs-comment">-- data in heap profiles, and we don't set CCCS</span><span>
</span><a name="line-437"></a><span>                        </span><span class="hs-comment">-- from static closure.</span><span>
</span><a name="line-438"></a><span>        </span><span class="hs-identifier hs-type">DataCon</span><span>         </span><span class="hs-comment">-- Constructor. Never an unboxed tuple or sum, as those</span><span>
</span><a name="line-439"></a><span>                        </span><span class="hs-comment">-- are not allocated.</span><span>
</span><a name="line-440"></a><span>        </span><span class="hs-special">[</span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Args</span><span>
</span><a name="line-441"></a><span>
</span><a name="line-442"></a><span class="hs-comment">-- | Used as a data type index for the stgSyn AST</span><span>
</span><a name="line-443"></a><span class="hs-keyword">data</span><span> </span><a name="StgPass"><a href="StgSyn.html#StgPass"><span class="hs-identifier">StgPass</span></a></a><span>
</span><a name="line-444"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Vanilla"><a href="StgSyn.html#Vanilla"><span class="hs-identifier">Vanilla</span></a></a><span>
</span><a name="line-445"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LiftLams"><a href="StgSyn.html#LiftLams"><span class="hs-identifier">LiftLams</span></a></a><span>
</span><a name="line-446"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CodeGen"><a href="StgSyn.html#CodeGen"><span class="hs-identifier">CodeGen</span></a></a><span>
</span><a name="line-447"></a><span>
</span><a name="line-448"></a><span class="hs-comment">-- | Like 'HsExpression.NoExt', but with an 'Outputable' instance that returns</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- 'empty'.</span><span>
</span><a name="line-450"></a><span class="hs-keyword">data</span><span> </span><a name="NoExtSilent"><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier">NoExtSilent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NoExtSilent"><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier">NoExtSilent</span></a></a><span>
</span><a name="line-451"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Data</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-type">NoExtSilent</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-454"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-455"></a><span>
</span><a name="line-456"></a><span class="hs-comment">-- | Used when constructing a term with an unused extension point that should</span><span>
</span><a name="line-457"></a><span class="hs-comment">-- not appear in pretty-printed output at all.</span><span>
</span><a name="line-458"></a><span class="hs-identifier">noExtSilent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-type">NoExtSilent</span></a><span>
</span><a name="line-459"></a><a name="noExtSilent"><a href="StgSyn.html#noExtSilent"><span class="hs-identifier">noExtSilent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-var">NoExtSilent</span></a><span>
</span><a name="line-460"></a><span class="hs-comment">-- TODO: Maybe move this to HsExtensions? I'm not sure about the implications</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- on build time...</span><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span class="hs-comment">-- TODO: Do we really want to the extension point type families to have a closed</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- domain?</span><span>
</span><a name="line-465"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="BinderP"><a href="StgSyn.html#BinderP"><span class="hs-identifier">BinderP</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680630075"><a href="#local-6989586621680630075"><span class="hs-identifier">pass</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgPass"><span class="hs-identifier hs-type">StgPass</span></a><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-467"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="XRhsClosure"><a href="StgSyn.html#XRhsClosure"><span class="hs-identifier">XRhsClosure</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680630074"><a href="#local-6989586621680630074"><span class="hs-identifier">pass</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgPass"><span class="hs-identifier hs-type">StgPass</span></a><span class="hs-special">)</span><span>
</span><a name="line-470"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#XRhsClosure"><span class="hs-identifier hs-type">XRhsClosure</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-type">NoExtSilent</span></a><span>
</span><a name="line-471"></a><span class="hs-comment">-- | Code gen needs to track non-global free vars</span><span>
</span><a name="line-472"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#XRhsClosure"><span class="hs-identifier hs-type">XRhsClosure</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">DIdSet</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="XLet"><a href="StgSyn.html#XLet"><span class="hs-identifier">XLet</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680630073"><a href="#local-6989586621680630073"><span class="hs-identifier">pass</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgPass"><span class="hs-identifier hs-type">StgPass</span></a><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#XLet"><span class="hs-identifier hs-type">XLet</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-type">NoExtSilent</span></a><span>
</span><a name="line-476"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#XLet"><span class="hs-identifier hs-type">XLet</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-type">NoExtSilent</span></a><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="XLetNoEscape"><a href="StgSyn.html#XLetNoEscape"><span class="hs-identifier">XLetNoEscape</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680630072"><a href="#local-6989586621680630072"><span class="hs-identifier">pass</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgPass"><span class="hs-identifier hs-type">StgPass</span></a><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#XLetNoEscape"><span class="hs-identifier hs-type">XLetNoEscape</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-type">NoExtSilent</span></a><span>
</span><a name="line-480"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#XLetNoEscape"><span class="hs-identifier hs-type">XLetNoEscape</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#NoExtSilent"><span class="hs-identifier hs-type">NoExtSilent</span></a><span>
</span><a name="line-481"></a><span>
</span><a name="line-482"></a><span class="hs-identifier">stgRhsArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-483"></a><a name="stgRhsArity"><a href="StgSyn.html#stgRhsArity"><span class="hs-identifier">stgRhsArity</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630119"><a href="#local-6989586621680630119"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-484"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier">isId</span><span> </span><span class="hs-identifier">bndrs</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">bndrs</span><span>
</span><a name="line-485"></a><span>  </span><span class="hs-comment">-- The arity never includes type parameters, but they should have gone by now</span><span>
</span><a name="line-486"></a><span class="hs-identifier">stgRhsArity</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-comment">-- Note [CAF consistency]</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-490"></a><span class="hs-comment">--</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- `topStgBindHasCafRefs` is only used by an assert (`consistentCafInfo` in</span><span>
</span><a name="line-492"></a><span class="hs-comment">-- `CoreToStg`) to make sure CAF-ness predicted by `TidyPgm` is consistent with</span><span>
</span><a name="line-493"></a><span class="hs-comment">-- reality.</span><span>
</span><a name="line-494"></a><span class="hs-comment">--</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- Specifically, if the RHS mentions any Id that itself is marked</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- `MayHaveCafRefs`; or if the binding is a top-level updateable thunk; then the</span><span>
</span><a name="line-497"></a><span class="hs-comment">-- `Id` for the binding should be marked `MayHaveCafRefs`. The potential trouble</span><span>
</span><a name="line-498"></a><span class="hs-comment">-- is that `TidyPgm` computed the CAF info on the `Id` but some transformations</span><span>
</span><a name="line-499"></a><span class="hs-comment">-- have taken place since then.</span><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span class="hs-identifier">topStgBindHasCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a><span> </span><a href="#local-6989586621680630100"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-502"></a><a name="topStgBindHasCafRefs"><a href="StgSyn.html#topStgBindHasCafRefs"><span class="hs-identifier">topStgBindHasCafRefs</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTopLifted"><span class="hs-identifier hs-var">StgTopLifted</span></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630120"><a href="#local-6989586621680630120"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#topRhsHasCafRefs"><span class="hs-identifier hs-var">topRhsHasCafRefs</span></a><span> </span><a href="#local-6989586621680630120"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-504"></a><span class="hs-identifier">topStgBindHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTopLifted"><span class="hs-identifier hs-var">StgTopLifted</span></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a><span> </span><a name="local-6989586621680630121"><a href="#local-6989586621680630121"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-505"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="StgSyn.html#topRhsHasCafRefs"><span class="hs-identifier hs-var">topRhsHasCafRefs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621680630121"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span class="hs-identifier">topStgBindHasCafRefs</span><span> </span><a href="StgSyn.html#StgTopStringLit"><span class="hs-identifier hs-var">StgTopStringLit</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-507"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span class="hs-identifier">topRhsHasCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span> </span><a href="#local-6989586621680630099"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-510"></a><a name="topRhsHasCafRefs"><a href="StgSyn.html#topRhsHasCafRefs"><span class="hs-identifier">topRhsHasCafRefs</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630122"><a href="#local-6989586621680630122"><span class="hs-identifier">upd</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630123"><a href="#local-6989586621680630123"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [CAF consistency]</span><span>
</span><a name="line-512"></a><span>    </span><a href="StgSyn.html#isUpdatable"><span class="hs-identifier hs-var">isUpdatable</span></a><span> </span><a href="#local-6989586621680630122"><span class="hs-identifier hs-var">upd</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier hs-var">exprHasCafRefs</span></a><span> </span><a href="#local-6989586621680630123"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-513"></a><span class="hs-identifier">topRhsHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630124"><a href="#local-6989586621680630124"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="StgSyn.html#stgArgHasCafRefs"><span class="hs-identifier hs-var">stgArgHasCafRefs</span></a><span> </span><a href="#local-6989586621680630124"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630098"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-517"></a><a name="exprHasCafRefs"><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier">exprHasCafRefs</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a><span> </span><a name="local-6989586621680630125"><a href="#local-6989586621680630125"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680630126"><a href="#local-6989586621680630126"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#stgIdHasCafRefs"><span class="hs-identifier hs-var">stgIdHasCafRefs</span></a><span> </span><a href="#local-6989586621680630125"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="StgSyn.html#stgArgHasCafRefs"><span class="hs-identifier hs-var">stgArgHasCafRefs</span></a><span> </span><a href="#local-6989586621680630126"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-519"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><a href="StgSyn.html#StgLit"><span class="hs-identifier hs-var">StgLit</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><a name="line-520"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-521"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630127"><a href="#local-6989586621680630127"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="StgSyn.html#stgArgHasCafRefs"><span class="hs-identifier hs-var">stgArgHasCafRefs</span></a><span> </span><a href="#local-6989586621680630127"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-523"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630128"><a href="#local-6989586621680630128"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-524"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="StgSyn.html#stgArgHasCafRefs"><span class="hs-identifier hs-var">stgArgHasCafRefs</span></a><span> </span><a href="#local-6989586621680630128"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-525"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLam"><span class="hs-identifier hs-var">StgLam</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630129"><a href="#local-6989586621680630129"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier hs-var">exprHasCafRefs</span></a><span> </span><a href="#local-6989586621680630129"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-527"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a><span> </span><a name="local-6989586621680630130"><a href="#local-6989586621680630130"><span class="hs-identifier">scrt</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630131"><a href="#local-6989586621680630131"><span class="hs-identifier">alts</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier hs-var">exprHasCafRefs</span></a><span> </span><a href="#local-6989586621680630130"><span class="hs-identifier hs-var">scrt</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="StgSyn.html#altHasCafRefs"><span class="hs-identifier hs-var">altHasCafRefs</span></a><span> </span><a href="#local-6989586621680630131"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-529"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630132"><a href="#local-6989586621680630132"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-6989586621680630133"><a href="#local-6989586621680630133"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-530"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#bindHasCafRefs"><span class="hs-identifier hs-var">bindHasCafRefs</span></a><span> </span><a href="#local-6989586621680630132"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier hs-var">exprHasCafRefs</span></a><span> </span><a href="#local-6989586621680630133"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-531"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLetNoEscape"><span class="hs-identifier hs-var">StgLetNoEscape</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630134"><a href="#local-6989586621680630134"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-6989586621680630135"><a href="#local-6989586621680630135"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#bindHasCafRefs"><span class="hs-identifier hs-var">bindHasCafRefs</span></a><span> </span><a href="#local-6989586621680630134"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier hs-var">exprHasCafRefs</span></a><span> </span><a href="#local-6989586621680630135"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-533"></a><span class="hs-identifier">exprHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630136"><a href="#local-6989586621680630136"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier hs-var">exprHasCafRefs</span></a><span> </span><a href="#local-6989586621680630136"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span class="hs-identifier">bindHasCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span> </span><a href="#local-6989586621680630097"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-537"></a><a name="bindHasCafRefs"><a href="StgSyn.html#bindHasCafRefs"><span class="hs-identifier">bindHasCafRefs</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630137"><a href="#local-6989586621680630137"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#rhsHasCafRefs"><span class="hs-identifier hs-var">rhsHasCafRefs</span></a><span> </span><a href="#local-6989586621680630137"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-539"></a><span class="hs-identifier">bindHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a><span> </span><a name="local-6989586621680630138"><a href="#local-6989586621680630138"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-540"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="StgSyn.html#rhsHasCafRefs"><span class="hs-identifier hs-var">rhsHasCafRefs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621680630138"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span class="hs-identifier">rhsHasCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span> </span><a href="#local-6989586621680630096"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-543"></a><a name="rhsHasCafRefs"><a href="StgSyn.html#rhsHasCafRefs"><span class="hs-identifier">rhsHasCafRefs</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630139"><a href="#local-6989586621680630139"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-544"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier hs-var">exprHasCafRefs</span></a><span> </span><a href="#local-6989586621680630139"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-545"></a><span class="hs-identifier">rhsHasCafRefs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680630140"><a href="#local-6989586621680630140"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-546"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="StgSyn.html#stgArgHasCafRefs"><span class="hs-identifier hs-var">stgArgHasCafRefs</span></a><span> </span><a href="#local-6989586621680630140"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-identifier">altHasCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a><span> </span><a href="#local-6989586621680630095"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-549"></a><a name="altHasCafRefs"><a href="StgSyn.html#altHasCafRefs"><span class="hs-identifier">altHasCafRefs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680630141"><a href="#local-6989586621680630141"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#exprHasCafRefs"><span class="hs-identifier hs-var">exprHasCafRefs</span></a><span> </span><a href="#local-6989586621680630141"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span class="hs-identifier">stgArgHasCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-552"></a><a name="stgArgHasCafRefs"><a href="StgSyn.html#stgArgHasCafRefs"><span class="hs-identifier">stgArgHasCafRefs</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a><span> </span><a name="local-6989586621680630142"><a href="#local-6989586621680630142"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#stgIdHasCafRefs"><span class="hs-identifier hs-var">stgIdHasCafRefs</span></a><span> </span><a href="#local-6989586621680630142"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-554"></a><span class="hs-identifier">stgArgHasCafRefs</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-555"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-556"></a><span>
</span><a name="line-557"></a><span class="hs-identifier">stgIdHasCafRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-558"></a><a name="stgIdHasCafRefs"><a href="StgSyn.html#stgIdHasCafRefs"><span class="hs-identifier">stgIdHasCafRefs</span></a></a><span> </span><a name="local-6989586621680630143"><a href="#local-6989586621680630143"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-559"></a><span>  </span><span class="hs-comment">-- We are looking for occurrences of an Id that is bound at top level, and may</span><span>
</span><a name="line-560"></a><span>  </span><span class="hs-comment">-- have CAF refs. At this point (after TidyPgm) top-level Ids (whether</span><span>
</span><a name="line-561"></a><span>  </span><span class="hs-comment">-- imported or defined in this module) are GlobalIds, so the test is easy.</span><span>
</span><a name="line-562"></a><span>  </span><span class="hs-identifier hs-var">isGlobalId</span><span> </span><a href="#local-6989586621680630143"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">mayHaveCafRefs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idCafInfo</span><span> </span><a href="#local-6989586621680630143"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Stg-case-alternatives]{STG case alternatives}
*                                                                      *
************************************************************************

Very like in @CoreSyntax@ (except no type-world stuff).

The type constructor is guaranteed not to be abstract; that is, we can
see its representation. This is important because the code generator
uses it to determine return conventions etc. But it's not trivial
where there's a module loop involved, because some versions of a type
constructor might not have all the constructors visible. So
mkStgAlgAlts (in CoreToStg) ensures that it gets the TyCon from the
constructors or literals (which are guaranteed to have the Real McCoy)
rather than from the scrutinee type.
-}</span><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span class="hs-keyword">type</span><span> </span><a name="GenStgAlt"><a href="StgSyn.html#GenStgAlt"><span class="hs-identifier">GenStgAlt</span></a></a><span> </span><a name="local-6989586621680630071"><a href="#local-6989586621680630071"><span class="hs-identifier">pass</span></a></a><span>
</span><a name="line-584"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AltCon</span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- alts: data constructor,</span><span>
</span><a name="line-585"></a><span>     </span><span class="hs-special">[</span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><a href="#local-6989586621680630071"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- constructor's parameters,</span><span>
</span><a name="line-586"></a><span>     </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630071"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ...right-hand side.</span><span>
</span><a name="line-587"></a><span>
</span><a name="line-588"></a><span class="hs-keyword">data</span><span> </span><a name="AltType"><a href="StgSyn.html#AltType"><span class="hs-identifier">AltType</span></a></a><span>
</span><a name="line-589"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="PolyAlt"><a href="StgSyn.html#PolyAlt"><span class="hs-identifier">PolyAlt</span></a></a><span>             </span><span class="hs-comment">-- Polymorphic (a lifted type variable)</span><span>
</span><a name="line-590"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MultiValAlt"><a href="StgSyn.html#MultiValAlt"><span class="hs-identifier">MultiValAlt</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span>     </span><span class="hs-comment">-- Multi value of this arity (unboxed tuple or sum)</span><span>
</span><a name="line-591"></a><span>                        </span><span class="hs-comment">-- the arity could indeed be 1 for unary unboxed tuple</span><span>
</span><a name="line-592"></a><span>                        </span><span class="hs-comment">-- or enum-like unboxed sums</span><span>
</span><a name="line-593"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AlgAlt"><a href="StgSyn.html#AlgAlt"><span class="hs-identifier">AlgAlt</span></a></a><span>      </span><span class="hs-identifier hs-type">TyCon</span><span>   </span><span class="hs-comment">-- Algebraic data type; the AltCons will be DataAlts</span><span>
</span><a name="line-594"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PrimAlt"><a href="StgSyn.html#PrimAlt"><span class="hs-identifier">PrimAlt</span></a></a><span>     </span><span class="hs-identifier hs-type">PrimRep</span><span> </span><span class="hs-comment">-- Primitive data type; the AltCons (if any) will be LitAlts</span><span>
</span><a name="line-595"></a><span>
</span><a name="line-596"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Stg]{The Plain STG parameterisation}
*                                                                      *
************************************************************************

This happens to be the only one we use at the moment.
-}</span><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span class="hs-keyword">type</span><span> </span><a name="StgTopBinding"><a href="StgSyn.html#StgTopBinding"><span class="hs-identifier">StgTopBinding</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span>
</span><a name="line-607"></a><span class="hs-keyword">type</span><span> </span><a name="StgBinding"><a href="StgSyn.html#StgBinding"><span class="hs-identifier">StgBinding</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span>    </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span>
</span><a name="line-608"></a><span class="hs-keyword">type</span><span> </span><a name="StgExpr"><a href="StgSyn.html#StgExpr"><span class="hs-identifier">StgExpr</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span>       </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span>
</span><a name="line-609"></a><span class="hs-keyword">type</span><span> </span><a name="StgRhs"><a href="StgSyn.html#StgRhs"><span class="hs-identifier">StgRhs</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span>        </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span>
</span><a name="line-610"></a><span class="hs-keyword">type</span><span> </span><a name="StgAlt"><a href="StgSyn.html#StgAlt"><span class="hs-identifier">StgAlt</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a><span>        </span><span class="hs-special">'</span><a href="StgSyn.html#Vanilla"><span class="hs-identifier hs-type">Vanilla</span></a><span>
</span><a name="line-611"></a><span>
</span><a name="line-612"></a><span class="hs-keyword">type</span><span> </span><a name="LlStgTopBinding"><a href="StgSyn.html#LlStgTopBinding"><span class="hs-identifier">LlStgTopBinding</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#LiftLams"><span class="hs-identifier hs-type">LiftLams</span></a><span>
</span><a name="line-613"></a><span class="hs-keyword">type</span><span> </span><a name="LlStgBinding"><a href="StgSyn.html#LlStgBinding"><span class="hs-identifier">LlStgBinding</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span>    </span><span class="hs-special">'</span><a href="StgSyn.html#LiftLams"><span class="hs-identifier hs-type">LiftLams</span></a><span>
</span><a name="line-614"></a><span class="hs-keyword">type</span><span> </span><a name="LlStgExpr"><a href="StgSyn.html#LlStgExpr"><span class="hs-identifier">LlStgExpr</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span>       </span><span class="hs-special">'</span><a href="StgSyn.html#LiftLams"><span class="hs-identifier hs-type">LiftLams</span></a><span>
</span><a name="line-615"></a><span class="hs-keyword">type</span><span> </span><a name="LlStgRhs"><a href="StgSyn.html#LlStgRhs"><span class="hs-identifier">LlStgRhs</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span>        </span><span class="hs-special">'</span><a href="StgSyn.html#LiftLams"><span class="hs-identifier hs-type">LiftLams</span></a><span>
</span><a name="line-616"></a><span class="hs-keyword">type</span><span> </span><a name="LlStgAlt"><a href="StgSyn.html#LlStgAlt"><span class="hs-identifier">LlStgAlt</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a><span>        </span><span class="hs-special">'</span><a href="StgSyn.html#LiftLams"><span class="hs-identifier hs-type">LiftLams</span></a><span>
</span><a name="line-617"></a><span>
</span><a name="line-618"></a><span class="hs-keyword">type</span><span> </span><a name="CgStgTopBinding"><a href="StgSyn.html#CgStgTopBinding"><span class="hs-identifier">CgStgTopBinding</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a><span> </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span>
</span><a name="line-619"></a><span class="hs-keyword">type</span><span> </span><a name="CgStgBinding"><a href="StgSyn.html#CgStgBinding"><span class="hs-identifier">CgStgBinding</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span>    </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span>
</span><a name="line-620"></a><span class="hs-keyword">type</span><span> </span><a name="CgStgExpr"><a href="StgSyn.html#CgStgExpr"><span class="hs-identifier">CgStgExpr</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span>       </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span>
</span><a name="line-621"></a><span class="hs-keyword">type</span><span> </span><a name="CgStgRhs"><a href="StgSyn.html#CgStgRhs"><span class="hs-identifier">CgStgRhs</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span>        </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span>
</span><a name="line-622"></a><span class="hs-keyword">type</span><span> </span><a name="CgStgAlt"><a href="StgSyn.html#CgStgAlt"><span class="hs-identifier">CgStgAlt</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a><span>        </span><span class="hs-special">'</span><a href="StgSyn.html#CodeGen"><span class="hs-identifier hs-type">CodeGen</span></a><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-comment">{- Many passes apply a substitution, and it's very handy to have type
   synonyms to remind us whether or not the substitution has been applied.
   See CoreSyn for precedence in Core land
-}</span><span>
</span><a name="line-628"></a><span>
</span><a name="line-629"></a><span class="hs-keyword">type</span><span> </span><a name="InStgTopBinding"><a href="StgSyn.html#InStgTopBinding"><span class="hs-identifier">InStgTopBinding</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a><span>
</span><a name="line-630"></a><span class="hs-keyword">type</span><span> </span><a name="InStgBinding"><a href="StgSyn.html#InStgBinding"><span class="hs-identifier">InStgBinding</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgBinding"><span class="hs-identifier hs-type">StgBinding</span></a><span>
</span><a name="line-631"></a><span class="hs-keyword">type</span><span> </span><a name="InStgArg"><a href="StgSyn.html#InStgArg"><span class="hs-identifier">InStgArg</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span>
</span><a name="line-632"></a><span class="hs-keyword">type</span><span> </span><a name="InStgExpr"><a href="StgSyn.html#InStgExpr"><span class="hs-identifier">InStgExpr</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a><span>
</span><a name="line-633"></a><span class="hs-keyword">type</span><span> </span><a name="InStgRhs"><a href="StgSyn.html#InStgRhs"><span class="hs-identifier">InStgRhs</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a><span>
</span><a name="line-634"></a><span class="hs-keyword">type</span><span> </span><a name="InStgAlt"><a href="StgSyn.html#InStgAlt"><span class="hs-identifier">InStgAlt</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgAlt"><span class="hs-identifier hs-type">StgAlt</span></a><span>
</span><a name="line-635"></a><span class="hs-keyword">type</span><span> </span><a name="OutStgTopBinding"><a href="StgSyn.html#OutStgTopBinding"><span class="hs-identifier">OutStgTopBinding</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a><span>
</span><a name="line-636"></a><span class="hs-keyword">type</span><span> </span><a name="OutStgBinding"><a href="StgSyn.html#OutStgBinding"><span class="hs-identifier">OutStgBinding</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgBinding"><span class="hs-identifier hs-type">StgBinding</span></a><span>
</span><a name="line-637"></a><span class="hs-keyword">type</span><span> </span><a name="OutStgArg"><a href="StgSyn.html#OutStgArg"><span class="hs-identifier">OutStgArg</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span>
</span><a name="line-638"></a><span class="hs-keyword">type</span><span> </span><a name="OutStgExpr"><a href="StgSyn.html#OutStgExpr"><span class="hs-identifier">OutStgExpr</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a><span>
</span><a name="line-639"></a><span class="hs-keyword">type</span><span> </span><a name="OutStgRhs"><a href="StgSyn.html#OutStgRhs"><span class="hs-identifier">OutStgRhs</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a><span>
</span><a name="line-640"></a><span class="hs-keyword">type</span><span> </span><a name="OutStgAlt"><a href="StgSyn.html#OutStgAlt"><span class="hs-identifier">OutStgAlt</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#StgAlt"><span class="hs-identifier hs-type">StgAlt</span></a><span>
</span><a name="line-641"></a><span>
</span><a name="line-642"></a><span class="hs-comment">{-

************************************************************************
*                                                                      *
\subsubsection[UpdateFlag-datatype]{@UpdateFlag@}
*                                                                      *
************************************************************************

This is also used in @LambdaFormInfo@ in the @ClosureInfo@ module.

A @ReEntrant@ closure may be entered multiple times, but should not be
updated or blackholed. An @Updatable@ closure should be updated after
evaluation (and may be blackholed during evaluation). A @SingleEntry@
closure will only be entered once, and so need not be updated but may
safely be blackholed.
-}</span><span>
</span><a name="line-658"></a><span>
</span><a name="line-659"></a><span class="hs-keyword">data</span><span> </span><a name="UpdateFlag"><a href="StgSyn.html#UpdateFlag"><span class="hs-identifier">UpdateFlag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ReEntrant"><a href="StgSyn.html#ReEntrant"><span class="hs-identifier">ReEntrant</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Updatable"><a href="StgSyn.html#Updatable"><span class="hs-identifier">Updatable</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="SingleEntry"><a href="StgSyn.html#SingleEntry"><span class="hs-identifier">SingleEntry</span></a></a><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="StgSyn.html#UpdateFlag"><span class="hs-identifier hs-type">UpdateFlag</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-662"></a><span>    </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><a name="local-6989586621680630088"><a href="#local-6989586621680630088"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680630088"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-663"></a><span>                       </span><a href="StgSyn.html#ReEntrant"><span class="hs-identifier hs-var">ReEntrant</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'r'</span><span>
</span><a name="line-664"></a><span>                       </span><a href="StgSyn.html#Updatable"><span class="hs-identifier hs-var">Updatable</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'u'</span><span>
</span><a name="line-665"></a><span>                       </span><a href="StgSyn.html#SingleEntry"><span class="hs-identifier hs-var">SingleEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'s'</span><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">isUpdatable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#UpdateFlag"><span class="hs-identifier hs-type">UpdateFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-668"></a><a name="isUpdatable"><a href="StgSyn.html#isUpdatable"><span class="hs-identifier">isUpdatable</span></a></a><span> </span><a href="StgSyn.html#ReEntrant"><span class="hs-identifier hs-var">ReEntrant</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-669"></a><span class="hs-identifier">isUpdatable</span><span> </span><a href="StgSyn.html#SingleEntry"><span class="hs-identifier hs-var">SingleEntry</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-670"></a><span class="hs-identifier">isUpdatable</span><span> </span><a href="StgSyn.html#Updatable"><span class="hs-identifier hs-var">Updatable</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{StgOp}
*                                                                      *
************************************************************************

An StgOp allows us to group together PrimOps and ForeignCalls.
It's quite useful to move these around together, notably
in StgOpApp and COpStmt.
-}</span><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span class="hs-keyword">data</span><span> </span><a name="StgOp"><a href="StgSyn.html#StgOp"><span class="hs-identifier">StgOp</span></a></a><span>
</span><a name="line-685"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="StgPrimOp"><a href="StgSyn.html#StgPrimOp"><span class="hs-identifier">StgPrimOp</span></a></a><span>  </span><span class="hs-identifier hs-type">PrimOp</span><span>
</span><a name="line-686"></a><span>
</span><a name="line-687"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgPrimCallOp"><a href="StgSyn.html#StgPrimCallOp"><span class="hs-identifier">StgPrimCallOp</span></a></a><span> </span><span class="hs-identifier hs-type">PrimCall</span><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StgFCallOp"><a href="StgSyn.html#StgFCallOp"><span class="hs-identifier">StgFCallOp</span></a></a><span> </span><span class="hs-identifier hs-type">ForeignCall</span><span> </span><span class="hs-identifier hs-type">Unique</span><span>
</span><a name="line-690"></a><span>        </span><span class="hs-comment">-- The Unique is occasionally needed by the C pretty-printer</span><span>
</span><a name="line-691"></a><span>        </span><span class="hs-comment">-- (which lacks a unique supply), notably when generating a</span><span>
</span><a name="line-692"></a><span>        </span><span class="hs-comment">-- typedef for foreign-export-dynamic</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Stg-pretty-printing]{Pretty-printing}
*                                                                      *
************************************************************************

Robin Popplestone asked for semi-colon separators on STG binds; here's
hoping he likes terminators instead...  Ditto for case alternatives.
-}</span><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span class="hs-keyword">type</span><span> </span><a name="OutputablePass"><a href="StgSyn.html#OutputablePass"><span class="hs-identifier">OutputablePass</span></a></a><span> </span><a name="local-6989586621680630070"><a href="#local-6989586621680630070"><span class="hs-identifier">pass</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-706"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#XLet"><span class="hs-identifier hs-type">XLet</span></a><span> </span><a href="#local-6989586621680630070"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-707"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#XLetNoEscape"><span class="hs-identifier hs-type">XLetNoEscape</span></a><span> </span><a href="#local-6989586621680630070"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#XRhsClosure"><span class="hs-identifier hs-type">XRhsClosure</span></a><span> </span><a href="#local-6989586621680630070"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-709"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">OutputableBndr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#BinderP"><span class="hs-identifier hs-type">BinderP</span></a><span> </span><a href="#local-6989586621680630070"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-711"></a><span>
</span><a name="line-712"></a><span class="hs-identifier">pprGenStgTopBinding</span><span>
</span><a name="line-713"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630094"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a><span> </span><a href="#local-6989586621680630094"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-714"></a><a name="pprGenStgTopBinding"><a href="StgSyn.html#pprGenStgTopBinding"><span class="hs-identifier">pprGenStgTopBinding</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTopStringLit"><span class="hs-identifier hs-var">StgTopStringLit</span></a><span> </span><a name="local-6989586621680630144"><a href="#local-6989586621680630144"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621680630145"><a href="#local-6989586621680630145"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-715"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">LetBind</span><span> </span><a href="#local-6989586621680630144"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">equals</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-716"></a><span>        </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprHsBytes</span><span> </span><a href="#local-6989586621680630145"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">semi</span><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span class="hs-identifier">pprGenStgTopBinding</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTopLifted"><span class="hs-identifier hs-var">StgTopLifted</span></a><span> </span><a name="local-6989586621680630146"><a href="#local-6989586621680630146"><span class="hs-identifier">bind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-718"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#pprGenStgBinding"><span class="hs-identifier hs-var">pprGenStgBinding</span></a><span> </span><a href="#local-6989586621680630146"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-719"></a><span>
</span><a name="line-720"></a><span class="hs-identifier">pprGenStgBinding</span><span>
</span><a name="line-721"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630093"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span> </span><a href="#local-6989586621680630093"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-722"></a><span>
</span><a name="line-723"></a><a name="pprGenStgBinding"><a href="StgSyn.html#pprGenStgBinding"><span class="hs-identifier">pprGenStgBinding</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a><span> </span><a name="local-6989586621680630147"><a href="#local-6989586621680630147"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621680630148"><a href="#local-6989586621680630148"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">LetBind</span><span> </span><a href="#local-6989586621680630147"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">equals</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-725"></a><span>        </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630148"><span class="hs-identifier hs-var">rhs</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">semi</span><span class="hs-special">)</span><span>
</span><a name="line-726"></a><span>
</span><a name="line-727"></a><span class="hs-identifier">pprGenStgBinding</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a><span> </span><a name="local-6989586621680630149"><a href="#local-6989586621680630149"><span class="hs-identifier">pairs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Rec {&quot;</span><span>
</span><a name="line-729"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621680630150"><span class="hs-identifier hs-var">ppr_bind</span></a><span> </span><a href="#local-6989586621680630149"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span>
</span><a name="line-730"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;end Rec }&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-731"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-732"></a><span>    </span><a name="local-6989586621680630150"><a href="#local-6989586621680630150"><span class="hs-identifier">ppr_bind</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680630151"><a href="#local-6989586621680630151"><span class="hs-identifier">bndr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680630152"><a href="#local-6989586621680630152"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-733"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">LetBind</span><span> </span><a href="#local-6989586621680630151"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">equals</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-734"></a><span>             </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630152"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">semi</span><span class="hs-special">)</span><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span class="hs-identifier">pprGenStgTopBindings</span><span>
</span><a name="line-737"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630092"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a><span> </span><a href="#local-6989586621680630092"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-738"></a><a name="pprGenStgTopBindings"><a href="StgSyn.html#pprGenStgTopBindings"><span class="hs-identifier">pprGenStgTopBindings</span></a></a><span> </span><a name="local-6989586621680630153"><a href="#local-6989586621680630153"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-739"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">intersperse</span><span> </span><span class="hs-identifier hs-var">blankLine</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="StgSyn.html#pprGenStgTopBinding"><span class="hs-identifier hs-var">pprGenStgTopBinding</span></a><span> </span><a href="#local-6989586621680630153"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-740"></a><span>
</span><a name="line-741"></a><span class="hs-identifier">pprStgBinding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgBinding"><span class="hs-identifier hs-type">StgBinding</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-742"></a><a name="pprStgBinding"><a href="StgSyn.html#pprStgBinding"><span class="hs-identifier">pprStgBinding</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#pprGenStgBinding"><span class="hs-identifier hs-var">pprGenStgBinding</span></a><span>
</span><a name="line-743"></a><span>
</span><a name="line-744"></a><span class="hs-identifier">pprStgTopBindings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="StgSyn.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-745"></a><a name="pprStgTopBindings"><a href="StgSyn.html#pprStgTopBindings"><span class="hs-identifier">pprStgTopBindings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#pprGenStgTopBindings"><span class="hs-identifier hs-var">pprGenStgTopBindings</span></a><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-748"></a><span>    </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#pprStgArg"><span class="hs-identifier hs-var">pprStgArg</span></a><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630087"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a><span> </span><a href="#local-6989586621680630087"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-751"></a><span>    </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#pprGenStgTopBinding"><span class="hs-identifier hs-var">pprGenStgTopBinding</span></a><span>
</span><a name="line-752"></a><span>
</span><a name="line-753"></a><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630086"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a><span> </span><a href="#local-6989586621680630086"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-754"></a><span>    </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#pprGenStgBinding"><span class="hs-identifier hs-var">pprGenStgBinding</span></a><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630085"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630085"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-757"></a><span>    </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a><span>
</span><a name="line-758"></a><span>
</span><a name="line-759"></a><span class="hs-keyword">instance</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630083"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span> </span><a href="#local-6989586621680630083"><span class="hs-identifier hs-type">pass</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-760"></a><span>    </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><a name="local-6989586621680630084"><a href="#local-6989586621680630084"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgSyn.html#pprStgRhs"><span class="hs-identifier hs-var">pprStgRhs</span></a><span> </span><a href="#local-6989586621680630084"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-identifier">pprStgArg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-763"></a><a name="pprStgArg"><a href="StgSyn.html#pprStgArg"><span class="hs-identifier">pprStgArg</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a><span> </span><a name="local-6989586621680630154"><a href="#local-6989586621680630154"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630154"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-764"></a><span class="hs-identifier">pprStgArg</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a><span> </span><a name="local-6989586621680630155"><a href="#local-6989586621680630155"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630155"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-765"></a><span>
</span><a name="line-766"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630091"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="StgSyn.html#GenStgExpr"><span class="hs-identifier hs-type">GenStgExpr</span></a><span> </span><a href="#local-6989586621680630091"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-767"></a><span class="hs-comment">-- special case</span><span>
</span><a name="line-768"></a><a name="pprStgExpr"><a href="StgSyn.html#pprStgExpr"><span class="hs-identifier">pprStgExpr</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLit"><span class="hs-identifier hs-var">StgLit</span></a><span> </span><a name="local-6989586621680630156"><a href="#local-6989586621680630156"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630156"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-769"></a><span>
</span><a name="line-770"></a><span class="hs-comment">-- general case</span><span>
</span><a name="line-771"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a><span> </span><a name="local-6989586621680630157"><a href="#local-6989586621680630157"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621680630158"><a href="#local-6989586621680630158"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-772"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630157"><span class="hs-identifier hs-var">func</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680630158"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a><span> </span><a name="local-6989586621680630159"><a href="#local-6989586621680630159"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621680630160"><a href="#local-6989586621680630160"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-775"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630159"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">interppSP</span><span> </span><a href="#local-6989586621680630160"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-776"></a><span>
</span><a name="line-777"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a><span> </span><a name="local-6989586621680630161"><a href="#local-6989586621680630161"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621680630162"><a href="#local-6989586621680630162"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-778"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span> </span><a href="StgSyn.html#pprStgOp"><span class="hs-identifier hs-var">pprStgOp</span></a><span> </span><a href="#local-6989586621680630161"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">interppSP</span><span> </span><a href="#local-6989586621680630162"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-779"></a><span>
</span><a name="line-780"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLam"><span class="hs-identifier hs-var">StgLam</span></a><span> </span><a name="local-6989586621680630163"><a href="#local-6989586621680630163"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-6989586621680630164"><a href="#local-6989586621680630164"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-781"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\\'</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621680630165"><span class="hs-identifier hs-var">ppr_list</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">LambdaBind</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621680630163"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-782"></a><span>            </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;-&gt;&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-783"></a><span>         </span><a href="StgSyn.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a><span> </span><a href="#local-6989586621680630164"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-784"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680630165"><a href="#local-6989586621680630165"><span class="hs-identifier">ppr_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fsep</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">punctuate</span><span> </span><span class="hs-identifier hs-var">comma</span><span>
</span><a name="line-785"></a><span>
</span><a name="line-786"></a><span class="hs-comment">-- special case: let v = &lt;very specific thing&gt;</span><span>
</span><a name="line-787"></a><span class="hs-comment">--               in</span><span>
</span><a name="line-788"></a><span class="hs-comment">--               let ...</span><span>
</span><a name="line-789"></a><span class="hs-comment">--               in</span><span>
</span><a name="line-790"></a><span class="hs-comment">--               ...</span><span>
</span><a name="line-791"></a><span class="hs-comment">--</span><span>
</span><a name="line-792"></a><span class="hs-comment">-- Very special!  Suspicious! (SLPJ)</span><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span class="hs-comment">{-
pprStgExpr (StgLet srt (StgNonRec bndr (StgRhsClosure cc bi free_vars upd_flag args rhs))
                        expr@(StgLet _ _))
  = ($$)
      (hang (hcat [text &quot;let { &quot;, ppr bndr, ptext (sLit &quot; = &quot;),
                          ppr cc,
                          pp_binder_info bi,
                          text &quot; [&quot;, whenPprDebug (interppSP free_vars), ptext (sLit &quot;] \\&quot;),
                          ppr upd_flag, text &quot; [&quot;,
                          interppSP args, char ']'])
            8 (sep [hsep [ppr rhs, text &quot;} in&quot;]]))
      (ppr expr)
-}</span><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span class="hs-comment">-- special case: let ... in let ...</span><span>
</span><a name="line-809"></a><span>
</span><a name="line-810"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a><span> </span><a name="local-6989586621680630166"><a href="#local-6989586621680630166"><span class="hs-identifier">ext</span></a></a><span> </span><a name="local-6989586621680630167"><a href="#local-6989586621680630167"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-6989586621680630168"><a href="#local-6989586621680630168"><span class="hs-identifier">expr</span></a></a><span class="hs-glyph">@</span><a href="StgSyn.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-811"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$$</span><span class="hs-special">)</span><span>
</span><a name="line-812"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;let&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630166"><span class="hs-identifier hs-var">ext</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;{&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-813"></a><span>                </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><a href="StgSyn.html#pprGenStgBinding"><span class="hs-identifier hs-var">pprGenStgBinding</span></a><span> </span><a href="#local-6989586621680630167"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;} in&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-814"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630168"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-815"></a><span>
</span><a name="line-816"></a><span class="hs-comment">-- general case</span><span>
</span><a name="line-817"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a><span> </span><a name="local-6989586621680630169"><a href="#local-6989586621680630169"><span class="hs-identifier">ext</span></a></a><span> </span><a name="local-6989586621680630170"><a href="#local-6989586621680630170"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-6989586621680630171"><a href="#local-6989586621680630171"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-818"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;let&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630169"><span class="hs-identifier hs-var">ext</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;{&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#pprGenStgBinding"><span class="hs-identifier hs-var">pprGenStgBinding</span></a><span> </span><a href="#local-6989586621680630170"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-819"></a><span>           </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;} in &quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630171"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-820"></a><span>
</span><a name="line-821"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLetNoEscape"><span class="hs-identifier hs-var">StgLetNoEscape</span></a><span> </span><a name="local-6989586621680630172"><a href="#local-6989586621680630172"><span class="hs-identifier">ext</span></a></a><span> </span><a name="local-6989586621680630173"><a href="#local-6989586621680630173"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-6989586621680630174"><a href="#local-6989586621680630174"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;let-no-escape&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630172"><span class="hs-identifier hs-var">ext</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;{&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-823"></a><span>                </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#pprGenStgBinding"><span class="hs-identifier hs-var">pprGenStgBinding</span></a><span> </span><a href="#local-6989586621680630173"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-824"></a><span>           </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;} in &quot;</span><span class="hs-special">)</span><span>
</span><a name="line-825"></a><span>                </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630174"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a><span> </span><a name="local-6989586621680630175"><a href="#local-6989586621680630175"><span class="hs-identifier">tickish</span></a></a><span> </span><a name="local-6989586621680630176"><a href="#local-6989586621680630176"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-828"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sdocWithDynFlags</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680630177"><a href="#local-6989586621680630177"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-829"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_SuppressTicks</span><span> </span><a href="#local-6989586621680630177"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-830"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="StgSyn.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a><span> </span><a href="#local-6989586621680630176"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-831"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630175"><span class="hs-identifier hs-var">tickish</span></a><span class="hs-special">,</span><span> </span><a href="StgSyn.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a><span> </span><a href="#local-6989586621680630176"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-832"></a><span>
</span><a name="line-833"></a><span>
</span><a name="line-834"></a><span class="hs-identifier">pprStgExpr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a><span> </span><a name="local-6989586621680630178"><a href="#local-6989586621680630178"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621680630179"><a href="#local-6989586621680630179"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621680630180"><a href="#local-6989586621680630180"><span class="hs-identifier">alt_type</span></a></a><span> </span><a name="local-6989586621680630181"><a href="#local-6989586621680630181"><span class="hs-identifier">alts</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-835"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;case&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-836"></a><span>           </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><a href="StgSyn.html#pprStgExpr"><span class="hs-identifier hs-var">pprStgExpr</span></a><span> </span><a href="#local-6989586621680630178"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">,</span><span>
</span><a name="line-837"></a><span>             </span><span class="hs-identifier hs-var">whenPprDebug</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630180"><span class="hs-identifier hs-var">alt_type</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-838"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;of&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">CaseBind</span><span> </span><a href="#local-6989586621680630179"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'{'</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-839"></a><span>           </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="StgSyn.html#pprStgAlt"><span class="hs-identifier hs-var">pprStgAlt</span></a><span> </span><a href="#local-6989586621680630181"><span class="hs-identifier hs-var">alts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-840"></a><span>           </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'}'</span><span class="hs-special">]</span><span>
</span><a name="line-841"></a><span>
</span><a name="line-842"></a><span class="hs-identifier">pprStgAlt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630090"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="StgSyn.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a><span> </span><a href="#local-6989586621680630090"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-843"></a><a name="pprStgAlt"><a href="StgSyn.html#pprStgAlt"><span class="hs-identifier">pprStgAlt</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680630182"><a href="#local-6989586621680630182"><span class="hs-identifier">con</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680630183"><a href="#local-6989586621680630183"><span class="hs-identifier">params</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680630184"><a href="#local-6989586621680630184"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-844"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630182"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprBndr</span><span> </span><span class="hs-identifier hs-var">CasePatBind</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680630183"><span class="hs-identifier hs-var">params</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;-&gt;&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-845"></a><span>         </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630184"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">semi</span><span class="hs-special">)</span><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span class="hs-identifier">pprStgOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#StgOp"><span class="hs-identifier hs-type">StgOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-848"></a><a name="pprStgOp"><a href="StgSyn.html#pprStgOp"><span class="hs-identifier">pprStgOp</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgPrimOp"><span class="hs-identifier hs-var">StgPrimOp</span></a><span>  </span><a name="local-6989586621680630185"><a href="#local-6989586621680630185"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630185"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-849"></a><span class="hs-identifier">pprStgOp</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgPrimCallOp"><span class="hs-identifier hs-var">StgPrimCallOp</span></a><span> </span><a name="local-6989586621680630186"><a href="#local-6989586621680630186"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630186"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-850"></a><span class="hs-identifier">pprStgOp</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgFCallOp"><span class="hs-identifier hs-var">StgFCallOp</span></a><span> </span><a name="local-6989586621680630187"><a href="#local-6989586621680630187"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630187"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-851"></a><span>
</span><a name="line-852"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="StgSyn.html#AltType"><span class="hs-identifier hs-type">AltType</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-853"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><a href="StgSyn.html#PolyAlt"><span class="hs-identifier hs-var">PolyAlt</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Polymorphic&quot;</span><span>
</span><a name="line-854"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#MultiValAlt"><span class="hs-identifier hs-var">MultiValAlt</span></a><span> </span><a name="local-6989586621680630080"><a href="#local-6989586621680630080"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;MultiAlt&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630080"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-855"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#AlgAlt"><span class="hs-identifier hs-var">AlgAlt</span></a><span> </span><a name="local-6989586621680630081"><a href="#local-6989586621680630081"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Alg&quot;</span><span>    </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630081"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-856"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#PrimAlt"><span class="hs-identifier hs-var">PrimAlt</span></a><span> </span><a name="local-6989586621680630082"><a href="#local-6989586621680630082"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Prim&quot;</span><span>   </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630082"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span class="hs-identifier">pprStgRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="StgSyn.html#OutputablePass"><span class="hs-identifier hs-type">OutputablePass</span></a><span> </span><a href="#local-6989586621680630089"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="StgSyn.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a><span> </span><a href="#local-6989586621680630089"><span class="hs-identifier hs-type">pass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-859"></a><span>
</span><a name="line-860"></a><span class="hs-comment">-- special case</span><span>
</span><a name="line-861"></a><a name="pprStgRhs"><a href="StgSyn.html#pprStgRhs"><span class="hs-identifier">pprStgRhs</span></a></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a><span> </span><a name="local-6989586621680630188"><a href="#local-6989586621680630188"><span class="hs-identifier">ext</span></a></a><span> </span><a name="local-6989586621680630189"><a href="#local-6989586621680630189"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621680630190"><a href="#local-6989586621680630190"><span class="hs-identifier">upd_flag</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-comment">{-no args-}</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a><span> </span><a name="local-6989586621680630191"><a href="#local-6989586621680630191"><span class="hs-identifier">func</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-862"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sdocWithDynFlags</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680630192"><a href="#local-6989586621680630192"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-863"></a><span>    </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630189"><span class="hs-identifier hs-var">cc</span></a><span class="hs-special">,</span><span>
</span><a name="line-864"></a><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_SuppressStgExts</span><span> </span><a href="#local-6989586621680630192"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-865"></a><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630188"><span class="hs-identifier hs-var">ext</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><span>
</span><a name="line-866"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot; \\&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630190"><span class="hs-identifier hs-var">upd_flag</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot; [] &quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630191"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><span class="hs-comment">-- general case</span><span>
</span><a name="line-869"></a><span class="hs-identifier">pprStgRhs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a><span> </span><a name="local-6989586621680630193"><a href="#local-6989586621680630193"><span class="hs-identifier">ext</span></a></a><span> </span><a name="local-6989586621680630194"><a href="#local-6989586621680630194"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621680630195"><a href="#local-6989586621680630195"><span class="hs-identifier">upd_flag</span></a></a><span> </span><a name="local-6989586621680630196"><a href="#local-6989586621680630196"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621680630197"><a href="#local-6989586621680630197"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-870"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sdocWithDynFlags</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680630198"><a href="#local-6989586621680630198"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-871"></a><span>    </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_SccProfilingOn</span><span> </span><a href="#local-6989586621680630198"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630194"><span class="hs-identifier hs-var">cc</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><span>
</span><a name="line-872"></a><span>                </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">gopt</span><span> </span><span class="hs-identifier hs-var">Opt_SuppressStgExts</span><span> </span><a href="#local-6989586621680630198"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-873"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630193"><span class="hs-identifier hs-var">ext</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><span>
</span><a name="line-874"></a><span>                </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\\'</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630195"><span class="hs-identifier hs-var">upd_flag</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">interppSP</span><span> </span><a href="#local-6989586621680630196"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-875"></a><span>         </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630197"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-876"></a><span>
</span><a name="line-877"></a><span class="hs-identifier">pprStgRhs</span><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a><span> </span><a name="local-6989586621680630199"><a href="#local-6989586621680630199"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621680630200"><a href="#local-6989586621680630200"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621680630201"><a href="#local-6989586621680630201"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-878"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630199"><span class="hs-identifier hs-var">cc</span></a><span class="hs-special">,</span><span>
</span><a name="line-879"></a><span>           </span><span class="hs-identifier hs-var">space</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680630200"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;! &quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">interppSP</span><span> </span><a href="#local-6989586621680630201"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-880"></a></pre></body></html>