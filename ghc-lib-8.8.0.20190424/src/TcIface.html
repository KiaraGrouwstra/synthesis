<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Type checking of type signatures in interface files
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcIface</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>        </span><a href="LoadIface.html#tcLookupImported_maybe"><span class="hs-identifier hs-var">tcLookupImported_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="LoadIface.html#importDecl"><span class="hs-identifier hs-var">importDecl</span></a><span class="hs-special">,</span><span> </span><a href="LoadIface.html#checkWiredInTyCon"><span class="hs-identifier hs-var">checkWiredInTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TcIface.html#tcHiBootIface"><span class="hs-identifier hs-var">tcHiBootIface</span></a><span class="hs-special">,</span><span> </span><a href="TcIface.html#typecheckIface"><span class="hs-identifier hs-var">typecheckIface</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="TcIface.html#typecheckIfacesForMerging"><span class="hs-identifier hs-var">typecheckIfacesForMerging</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="TcIface.html#typecheckIfaceForInstantiate"><span class="hs-identifier hs-var">typecheckIfaceForInstantiate</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="TcIface.html#tcIfaceDecl"><span class="hs-identifier hs-var">tcIfaceDecl</span></a><span class="hs-special">,</span><span> </span><a href="TcIface.html#tcIfaceInst"><span class="hs-identifier hs-var">tcIfaceInst</span></a><span class="hs-special">,</span><span> </span><a href="TcIface.html#tcIfaceFamInst"><span class="hs-identifier hs-var">tcIfaceFamInst</span></a><span class="hs-special">,</span><span> </span><a href="TcIface.html#tcIfaceRules"><span class="hs-identifier hs-var">tcIfaceRules</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="TcIface.html#tcIfaceAnnotations"><span class="hs-identifier hs-var">tcIfaceAnnotations</span></a><span class="hs-special">,</span><span> </span><a href="TcIface.html#tcIfaceCompleteSigs"><span class="hs-identifier hs-var">tcIfaceCompleteSigs</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Desired by HERMIT (Trac #7683)</span><span>
</span><a name="line-20"></a><span>        </span><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a><span>
</span><a name="line-21"></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="TcTypeNats.html"><span class="hs-identifier">TcTypeNats</span></a><span class="hs-special">(</span><a href="TcTypeNats.html#typeNatCoAxiomRules"><span class="hs-identifier hs-var">typeNatCoAxiomRules</span></a><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">IfaceSyn</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="LoadIface.html"><span class="hs-identifier">LoadIface</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="IfaceEnv.html"><span class="hs-identifier">IfaceEnv</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="BuildTyCl.html"><span class="hs-identifier">BuildTyCl</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcType</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Coercion</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoAxiom</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCoRep</span><span>    </span><span class="hs-comment">-- needs to build types &amp; coercions in a knot</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HscTypes</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Annotations</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">InstEnv</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FamInstEnv</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreSyn</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreUtils</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreUnfold</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="CoreLint.html"><span class="hs-identifier">CoreLint</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">MkCore</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Id</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">MkId</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">IdInfo</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Class</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCon</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ConLike</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrelNames</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysWiredIn</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Literal</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Var</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">VarSet</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">NameEnv</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">NameSet</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">OccurAnal</span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">occurAnalyseExpr</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Demand</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Module</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqFM</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqSupply</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Maybes</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">SuccessFlag</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ListSetOps</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Fingerprint</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">BooleanFormula</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BF</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-comment">{-
This module takes

        IfaceDecl -&gt; TyThing
        IfaceType -&gt; Type
        etc

An IfaceDecl is populated with RdrNames, and these are not renamed to
Names before typechecking, because there should be no scope errors etc.

        -- For (b) consider: f = \$(...h....)
        -- where h is imported, and calls f via an hi-boot file.
        -- This is bad!  But it is not seen as a staging error, because h
        -- is indeed imported.  We don't want the type-checker to black-hole
        -- when simplifying and compiling the splice!
        --
        -- Simple solution: discard any unfolding that mentions a variable
        -- bound in this module (and hence not yet processed).
        -- The discarding happens when forkM finds a type error.


************************************************************************
*                                                                      *
                Type-checking a complete interface
*                                                                      *
************************************************************************

Suppose we discover we don't need to recompile.  Then we must type
check the old interface file.  This is a bit different to the
incremental type checking we do as we suck in interface files.  Instead
we do things similarly as when we are typechecking source decls: we
bring into scope the type envt for the interface all at once, using a
knot.  Remember, the decls aren't necessarily in dependency order --
and even if they were, the type decls might be mutually recursive.

Note [Knot-tying typecheckIface]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we are typechecking an interface A.hi, and we come across
a Name for another entity defined in A.hi.  How do we get the
'TyCon', in this case?  There are three cases:

    1) tcHiBootIface in TcIface: We're typechecking an hi-boot file in
    preparation of checking if the hs file we're building
    is compatible.  In this case, we want all of the internal
    TyCons to MATCH the ones that we just constructed during
    typechecking: the knot is thus tied through if_rec_types.

    2) retypecheckLoop in GhcMake: We are retypechecking a
    mutually recursive cluster of hi files, in order to ensure
    that all of the references refer to each other correctly.
    In this case, the knot is tied through the HPT passed in,
    which contains all of the interfaces we are in the process
    of typechecking.

    3) genModDetails in HscMain: We are typechecking an
    old interface to generate the ModDetails.  In this case,
    we do the same thing as (2) and pass in an HPT with
    the HomeModInfo being generated to tie knots.

The upshot is that the CLIENT of this function is responsible
for making sure that the knot is tied correctly.  If you don't,
then you'll get a message saying that we couldn't load the
declaration you wanted.

BTW, in one-shot mode we never call typecheckIface; instead,
loadInterface handles type-checking interface.  In that case,
knots are tied through the EPS.  No problem!
-}</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-comment">-- Clients of this function be careful, see Note [Knot-tying typecheckIface]</span><span>
</span><a name="line-151"></a><span class="hs-identifier">typecheckIface</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ModIface</span><span>      </span><span class="hs-comment">-- Get the decls from here</span><span>
</span><a name="line-152"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfG</span><span> </span><span class="hs-identifier hs-type">ModDetails</span><span>
</span><a name="line-153"></a><a name="typecheckIface"><a href="TcIface.html#typecheckIface"><span class="hs-identifier">typecheckIface</span></a></a><span> </span><a name="local-6989586621681698745"><a href="#local-6989586621681698745"><span class="hs-identifier">iface</span></a></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#initIfaceLcl"><span class="hs-identifier hs-var">initIfaceLcl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mi_semantic_module</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;typecheckIface&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mi_boot</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-155"></a><span>        </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- Get the right set of decls and rules.  If we are compiling without -O</span><span>
</span><a name="line-156"></a><span>                </span><span class="hs-comment">-- we discard pragmas before typechecking, so that we don't &quot;see&quot;</span><span>
</span><a name="line-157"></a><span>                </span><span class="hs-comment">-- information that we shouldn't.  From a versioning point of view</span><span>
</span><a name="line-158"></a><span>                </span><span class="hs-comment">-- It's not actually *wrong* to do so, but in fact GHCi is unable</span><span>
</span><a name="line-159"></a><span>                </span><span class="hs-comment">-- to handle unboxed tuples, so it must not see unfoldings.</span><span>
</span><a name="line-160"></a><span>          </span><a name="local-6989586621681698746"><a href="#local-6989586621681698746"><span class="hs-identifier">ignore_prags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a><span> </span><span class="hs-identifier hs-var">Opt_IgnoreInterfacePragmas</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span>                </span><span class="hs-comment">-- Typecheck the decls.  This is done lazily, so that the knot-tying</span><span>
</span><a name="line-163"></a><span>                </span><span class="hs-comment">-- within this single module works out right.  It's the callers</span><span>
</span><a name="line-164"></a><span>                </span><span class="hs-comment">-- job to make sure the knot is tied.</span><span>
</span><a name="line-165"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698747"><a href="#local-6989586621681698747"><span class="hs-identifier">names_w_things</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#loadDecls"><span class="hs-identifier hs-var">loadDecls</span></a><span> </span><a href="#local-6989586621681698746"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_decls</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698748"><a href="#local-6989586621681698748"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNameEnv</span><span> </span><a href="#local-6989586621681698747"><span class="hs-identifier hs-var">names_w_things</span></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>                </span><span class="hs-comment">-- Now do those rules, instances and annotations</span><span>
</span><a name="line-169"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698749"><a href="#local-6989586621681698749"><span class="hs-identifier">insts</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceInst"><span class="hs-identifier hs-var">tcIfaceInst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_insts</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698750"><a href="#local-6989586621681698750"><span class="hs-identifier">fam_insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceFamInst"><span class="hs-identifier hs-var">tcIfaceFamInst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_fam_insts</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698751"><a href="#local-6989586621681698751"><span class="hs-identifier">rules</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceRules"><span class="hs-identifier hs-var">tcIfaceRules</span></a><span> </span><a href="#local-6989586621681698746"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_rules</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698752"><a href="#local-6989586621681698752"><span class="hs-identifier">anns</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceAnnotations"><span class="hs-identifier hs-var">tcIfaceAnnotations</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_anns</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span>                </span><span class="hs-comment">-- Exports</span><span>
</span><a name="line-175"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698753"><a href="#local-6989586621681698753"><span class="hs-identifier">exports</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#ifaceExportNames"><span class="hs-identifier hs-var">ifaceExportNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_exports</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>                </span><span class="hs-comment">-- Complete Sigs</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698754"><a href="#local-6989586621681698754"><span class="hs-identifier">complete_sigs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCompleteSigs"><span class="hs-identifier hs-var">tcIfaceCompleteSigs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_complete_sigs</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span>                </span><span class="hs-comment">-- Finished</span><span>
</span><a name="line-181"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Finished typechecking interface for&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_module</span><span> </span><a href="#local-6989586621681698745"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-182"></a><span>                         </span><span class="hs-comment">-- Careful! If we tug on the TyThing thunks too early</span><span>
</span><a name="line-183"></a><span>                         </span><span class="hs-comment">-- we'll infinite loop with hs-boot.  See #10083 for</span><span>
</span><a name="line-184"></a><span>                         </span><span class="hs-comment">-- an example where this would cause non-termination.</span><span>
</span><a name="line-185"></a><span>                         </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Type envt:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621681698747"><span class="hs-identifier hs-var">names_w_things</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ModDetails</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">md_types</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698748"><span class="hs-identifier hs-var">type_env</span></a><span>
</span><a name="line-187"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_insts</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698749"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-188"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698750"><span class="hs-identifier hs-var">fam_insts</span></a><span>
</span><a name="line-189"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_rules</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698751"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-190"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_anns</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698752"><span class="hs-identifier hs-var">anns</span></a><span>
</span><a name="line-191"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_exports</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698753"><span class="hs-identifier hs-var">exports</span></a><span>
</span><a name="line-192"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_complete_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698754"><span class="hs-identifier hs-var">complete_sigs</span></a><span>
</span><a name="line-193"></a><span>                              </span><span class="hs-special">}</span><span>
</span><a name="line-194"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Typechecking for merging
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-comment">-- | Returns true if an 'IfaceDecl' is for @data T@ (an abstract data type)</span><span>
</span><a name="line-205"></a><span class="hs-identifier">isAbstractIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-206"></a><a name="isAbstractIfaceDecl"><a href="TcIface.html#isAbstractIfaceDecl"><span class="hs-identifier">isAbstractIfaceDecl</span></a></a><span> </span><span class="hs-identifier hs-var">IfaceData</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifCons</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfAbstractTyCon</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-207"></a><span class="hs-identifier">isAbstractIfaceDecl</span><span> </span><span class="hs-identifier hs-var">IfaceClass</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifBody</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfAbstractClass</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-208"></a><span class="hs-identifier">isAbstractIfaceDecl</span><span> </span><span class="hs-identifier hs-var">IfaceFamily</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifFamFlav</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfaceAbstractClosedSynFamilyTyCon</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-209"></a><span class="hs-identifier">isAbstractIfaceDecl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-identifier">ifMaybeRoles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Role</span><span class="hs-special">]</span><span>
</span><a name="line-212"></a><a name="ifMaybeRoles"><a href="TcIface.html#ifMaybeRoles"><span class="hs-identifier">ifMaybeRoles</span></a></a><span> </span><span class="hs-identifier hs-var">IfaceData</span><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698755"><a href="#local-6989586621681698755"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681698755"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-213"></a><span class="hs-identifier">ifMaybeRoles</span><span> </span><span class="hs-identifier hs-var">IfaceSynonym</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698756"><a href="#local-6989586621681698756"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681698756"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-214"></a><span class="hs-identifier">ifMaybeRoles</span><span> </span><span class="hs-identifier hs-var">IfaceClass</span><span>   </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698757"><a href="#local-6989586621681698757"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681698757"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-215"></a><span class="hs-identifier">ifMaybeRoles</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-comment">-- | Merge two 'IfaceDecl's together, preferring a non-abstract one.  If</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- both are non-abstract we pick one arbitrarily (and check for consistency</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- later.)</span><span>
</span><a name="line-220"></a><span class="hs-identifier">mergeIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span>
</span><a name="line-221"></a><a name="mergeIfaceDecl"><a href="TcIface.html#mergeIfaceDecl"><span class="hs-identifier">mergeIfaceDecl</span></a></a><span> </span><a name="local-6989586621681698758"><a href="#local-6989586621681698758"><span class="hs-identifier">d1</span></a></a><span> </span><a name="local-6989586621681698759"><a href="#local-6989586621681698759"><span class="hs-identifier">d2</span></a></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="TcIface.html#isAbstractIfaceDecl"><span class="hs-identifier hs-var">isAbstractIfaceDecl</span></a><span> </span><a href="#local-6989586621681698758"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698759"><span class="hs-identifier hs-var">d2</span></a><span> </span><span class="hs-special">`</span><a href="TcIface.html#withRolesFrom"><span class="hs-identifier hs-var">withRolesFrom</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681698758"><span class="hs-identifier hs-var">d1</span></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="TcIface.html#isAbstractIfaceDecl"><span class="hs-identifier hs-var">isAbstractIfaceDecl</span></a><span> </span><a href="#local-6989586621681698759"><span class="hs-identifier hs-var">d2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698758"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-special">`</span><a href="TcIface.html#withRolesFrom"><span class="hs-identifier hs-var">withRolesFrom</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681698759"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">IfaceClass</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifBody</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfConcreteClass</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifSigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698760"><a href="#local-6989586621681698760"><span class="hs-identifier">ops1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifMinDef</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698761"><a href="#local-6989586621681698761"><span class="hs-identifier">bf1</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698758"><span class="hs-identifier hs-var">d1</span></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">IfaceClass</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifBody</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfConcreteClass</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifSigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698762"><a href="#local-6989586621681698762"><span class="hs-identifier">ops2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifMinDef</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698763"><a href="#local-6989586621681698763"><span class="hs-identifier">bf2</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698759"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-226"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698764"><a href="#local-6989586621681698764"><span class="hs-identifier">ops</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nameEnvElts</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-227"></a><span>                  </span><span class="hs-identifier hs-var">plusNameEnv_C</span><span> </span><a href="TcIface.html#mergeIfaceClassOp"><span class="hs-identifier hs-var">mergeIfaceClassOp</span></a><span>
</span><a name="line-228"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkNameEnv</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698766"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698765"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681698765"><a href="#local-6989586621681698765"><span class="hs-identifier">op</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceClassOp</span><span> </span><a name="local-6989586621681698766"><a href="#local-6989586621681698766"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698760"><span class="hs-identifier hs-var">ops1</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkNameEnv</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698768"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698767"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681698767"><a href="#local-6989586621681698767"><span class="hs-identifier">op</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceClassOp</span><span> </span><a name="local-6989586621681698768"><a href="#local-6989586621681698768"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698762"><span class="hs-identifier hs-var">ops2</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>      </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621681698758"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifBody</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ifBody</span><span> </span><a href="#local-6989586621681698758"><span class="hs-identifier hs-var">d1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-231"></a><span>                </span><span class="hs-identifier">ifSigs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698764"><span class="hs-identifier hs-var">ops</span></a><span class="hs-special">,</span><span>
</span><a name="line-232"></a><span>                </span><span class="hs-identifier">ifMinDef</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BF.mkOr</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">noLoc</span><span> </span><a href="#local-6989586621681698761"><span class="hs-identifier hs-var">bf1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">noLoc</span><span> </span><a href="#local-6989586621681698763"><span class="hs-identifier hs-var">bf2</span></a><span class="hs-special">]</span><span>
</span><a name="line-233"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-234"></a><span>            </span><span class="hs-special">}</span><span> </span><span class="hs-special">`</span><a href="TcIface.html#withRolesFrom"><span class="hs-identifier hs-var">withRolesFrom</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681698759"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-235"></a><span>    </span><span class="hs-comment">-- It doesn't matter; we'll check for consistency later when</span><span>
</span><a name="line-236"></a><span>    </span><span class="hs-comment">-- we merge, see 'mergeSignatures'</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698758"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-special">`</span><a href="TcIface.html#withRolesFrom"><span class="hs-identifier hs-var">withRolesFrom</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681698759"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-comment">-- Note [Role merging]</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- First, why might it be necessary to do a non-trivial role</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- merge?  It may rescue a merge that might otherwise fail:</span><span>
</span><a name="line-243"></a><span class="hs-comment">--</span><span>
</span><a name="line-244"></a><span class="hs-comment">--      signature A where</span><span>
</span><a name="line-245"></a><span class="hs-comment">--          type role T nominal representational</span><span>
</span><a name="line-246"></a><span class="hs-comment">--          data T a b</span><span>
</span><a name="line-247"></a><span class="hs-comment">--</span><span>
</span><a name="line-248"></a><span class="hs-comment">--      signature A where</span><span>
</span><a name="line-249"></a><span class="hs-comment">--          type role T representational nominal</span><span>
</span><a name="line-250"></a><span class="hs-comment">--          data T a b</span><span>
</span><a name="line-251"></a><span class="hs-comment">--</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- A module that defines T as representational in both arguments</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- would successfully fill both signatures, so it would be better</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- if we merged the roles of these types in some nontrivial</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- way.</span><span>
</span><a name="line-256"></a><span class="hs-comment">--</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- However, we have to be very careful about how we go about</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- doing this, because role subtyping is *conditional* on</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- the supertype being NOT representationally injective, e.g.,</span><span>
</span><a name="line-260"></a><span class="hs-comment">-- if we have instead:</span><span>
</span><a name="line-261"></a><span class="hs-comment">--</span><span>
</span><a name="line-262"></a><span class="hs-comment">--      signature A where</span><span>
</span><a name="line-263"></a><span class="hs-comment">--          type role T nominal representational</span><span>
</span><a name="line-264"></a><span class="hs-comment">--          data T a b = T a b</span><span>
</span><a name="line-265"></a><span class="hs-comment">--</span><span>
</span><a name="line-266"></a><span class="hs-comment">--      signature A where</span><span>
</span><a name="line-267"></a><span class="hs-comment">--          type role T representational nominal</span><span>
</span><a name="line-268"></a><span class="hs-comment">--          data T a b = T a b</span><span>
</span><a name="line-269"></a><span class="hs-comment">--</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- Should we merge the definitions of T so that the roles are R/R (or N/N)?</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- Absolutely not: neither resulting type is a subtype of the original</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- types (see Note [Role subtyping]), because data is not representationally</span><span>
</span><a name="line-273"></a><span class="hs-comment">-- injective.</span><span>
</span><a name="line-274"></a><span class="hs-comment">--</span><span>
</span><a name="line-275"></a><span class="hs-comment">-- Thus, merging only occurs when BOTH TyCons in question are</span><span>
</span><a name="line-276"></a><span class="hs-comment">-- representationally injective.  If they're not, no merge.</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-identifier">withRolesFrom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span>
</span><a name="line-279"></a><a name="local-6989586621681698769"><a href="#local-6989586621681698769"><span class="hs-identifier">d1</span></a></a><span> </span><span class="hs-special">`</span><a name="withRolesFrom"><a href="TcIface.html#withRolesFrom"><span class="hs-identifier">withRolesFrom</span></a></a><span class="hs-special">`</span><span> </span><a name="local-6989586621681698770"><a href="#local-6989586621681698770"><span class="hs-identifier">d2</span></a></a><span>
</span><a name="line-280"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681698774"><a href="#local-6989586621681698774"><span class="hs-identifier">roles1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#ifMaybeRoles"><span class="hs-identifier hs-var">ifMaybeRoles</span></a><span> </span><a href="#local-6989586621681698769"><span class="hs-identifier hs-var">d1</span></a><span>
</span><a name="line-281"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681698775"><a href="#local-6989586621681698775"><span class="hs-identifier">roles2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#ifMaybeRoles"><span class="hs-identifier hs-var">ifMaybeRoles</span></a><span> </span><a href="#local-6989586621681698770"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-282"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcIface.html#isRepInjectiveIfaceDecl"><span class="hs-identifier hs-var">isRepInjectiveIfaceDecl</span></a><span> </span><a href="#local-6989586621681698769"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="TcIface.html#isRepInjectiveIfaceDecl"><span class="hs-identifier hs-var">isRepInjectiveIfaceDecl</span></a><span> </span><a href="#local-6989586621681698770"><span class="hs-identifier hs-var">d2</span></a><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698769"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698771"><span class="hs-identifier hs-var">mergeRoles</span></a><span> </span><a href="#local-6989586621681698774"><span class="hs-identifier hs-var">roles1</span></a><span> </span><a href="#local-6989586621681698775"><span class="hs-identifier hs-var">roles2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-284"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698769"><span class="hs-identifier hs-var">d1</span></a><span>
</span><a name="line-285"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-286"></a><span>    </span><a name="local-6989586621681698771"><a href="#local-6989586621681698771"><span class="hs-identifier">mergeRoles</span></a></a><span> </span><a name="local-6989586621681698772"><a href="#local-6989586621681698772"><span class="hs-identifier">roles1</span></a></a><span> </span><a name="local-6989586621681698773"><a href="#local-6989586621681698773"><span class="hs-identifier">roles2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><a href="#local-6989586621681698772"><span class="hs-identifier hs-var">roles1</span></a><span> </span><a href="#local-6989586621681698773"><span class="hs-identifier hs-var">roles2</span></a><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-identifier">isRepInjectiveIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-289"></a><a name="isRepInjectiveIfaceDecl"><a href="TcIface.html#isRepInjectiveIfaceDecl"><span class="hs-identifier">isRepInjectiveIfaceDecl</span></a></a><span> </span><span class="hs-identifier hs-var">IfaceData</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifCons</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfDataTyCon</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-290"></a><span class="hs-identifier">isRepInjectiveIfaceDecl</span><span> </span><span class="hs-identifier hs-var">IfaceFamily</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifFamFlav</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfaceDataFamilyTyCon</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-291"></a><span class="hs-identifier">isRepInjectiveIfaceDecl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-identifier">mergeIfaceClassOp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceClassOp</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceClassOp</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceClassOp</span><span>
</span><a name="line-294"></a><a name="mergeIfaceClassOp"><a href="TcIface.html#mergeIfaceClassOp"><span class="hs-identifier">mergeIfaceClassOp</span></a></a><span> </span><a name="local-6989586621681698776"><a href="#local-6989586621681698776"><span class="hs-identifier">op1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceClassOp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698776"><span class="hs-identifier hs-var">op1</span></a><span>
</span><a name="line-295"></a><span class="hs-identifier">mergeIfaceClassOp</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681698777"><a href="#local-6989586621681698777"><span class="hs-identifier">op2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698777"><span class="hs-identifier hs-var">op2</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-comment">-- | Merge two 'OccEnv's of 'IfaceDecl's by 'OccName'.</span><span>
</span><a name="line-298"></a><span class="hs-identifier">mergeIfaceDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OccEnv</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OccEnv</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OccEnv</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span>
</span><a name="line-299"></a><a name="mergeIfaceDecls"><a href="TcIface.html#mergeIfaceDecls"><span class="hs-identifier">mergeIfaceDecls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">plusOccEnv_C</span><span> </span><a href="TcIface.html#mergeIfaceDecl"><span class="hs-identifier hs-var">mergeIfaceDecl</span></a><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- | This is a very interesting function.  Like typecheckIface, we want</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- to type check an interface file into a ModDetails.  However, the use-case</span><span>
</span><a name="line-303"></a><span class="hs-comment">-- for these ModDetails is different: we want to compare all of the</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- ModDetails to ensure they define compatible declarations, and then</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- merge them together.  So in particular, we have to take a different</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- strategy for knot-tying: we first speculatively merge the declarations</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- to get the &quot;base&quot; truth for what we believe the types will be</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- (this is &quot;type computation.&quot;)  Then we read everything in relative</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- to this truth and check for compatibility.</span><span>
</span><a name="line-310"></a><span class="hs-comment">--</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- During the merge process, we may need to nondeterministically</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- pick a particular declaration to use, if multiple signatures define</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- the declaration ('mergeIfaceDecl').  If, for all choices, there</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- are no type synonym cycles in the resulting merged graph, then</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- we can show that our choice cannot matter. Consider the</span><span>
</span><a name="line-316"></a><span class="hs-comment">-- set of entities which the declarations depend on: by assumption</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- of acyclicity, we can assume that these have already been shown to be equal</span><span>
</span><a name="line-318"></a><span class="hs-comment">-- to each other (otherwise merging will fail).  Then it must</span><span>
</span><a name="line-319"></a><span class="hs-comment">-- be the case that all candidate declarations here are type-equal</span><span>
</span><a name="line-320"></a><span class="hs-comment">-- (the choice doesn't matter) or there is an inequality (in which</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- case merging will fail.)</span><span>
</span><a name="line-322"></a><span class="hs-comment">--</span><span>
</span><a name="line-323"></a><span class="hs-comment">-- Unfortunately, the choice can matter if there is a cycle.  Consider the</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- following merge:</span><span>
</span><a name="line-325"></a><span class="hs-comment">--</span><span>
</span><a name="line-326"></a><span class="hs-comment">--      signature H where { type A = C;  type B = A; data C      }</span><span>
</span><a name="line-327"></a><span class="hs-comment">--      signature H where { type A = (); data B;     type C = B  }</span><span>
</span><a name="line-328"></a><span class="hs-comment">--</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- If we pick @type A = C@ as our representative, there will be</span><span>
</span><a name="line-330"></a><span class="hs-comment">-- a cycle and merging will fail. But if we pick @type A = ()@ as</span><span>
</span><a name="line-331"></a><span class="hs-comment">-- our representative, no cycle occurs, and we instead conclude</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- that all of the types are unit.  So it seems that we either</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- (a) need a stronger acyclicity check which considers *all*</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- possible choices from a merge, or (b) we must find a selection</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- of declarations which is acyclic, and show that this is always</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- the &quot;best&quot; choice we could have made (ezyang conjectures this</span><span>
</span><a name="line-337"></a><span class="hs-comment">-- is the case but does not have a proof).  For now this is</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- not implemented.</span><span>
</span><a name="line-339"></a><span class="hs-comment">--</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- It's worth noting that at the moment, a data constructor and a</span><span>
</span><a name="line-341"></a><span class="hs-comment">-- type synonym are never compatible.  Consider:</span><span>
</span><a name="line-342"></a><span class="hs-comment">--</span><span>
</span><a name="line-343"></a><span class="hs-comment">--      signature H where { type Int=C;         type B = Int; data C = Int}</span><span>
</span><a name="line-344"></a><span class="hs-comment">--      signature H where { export Prelude.Int; data B;       type C = B; }</span><span>
</span><a name="line-345"></a><span class="hs-comment">--</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- This will be rejected, because the reexported Int in the second</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- signature (a proper data type) is never considered equal to a</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- type synonym.  Perhaps this should be relaxed, where a type synonym</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- in a signature is considered implemented by a data type declaration</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- which matches the reference of the type synonym.</span><span>
</span><a name="line-351"></a><span class="hs-identifier">typecheckIfacesForMerging</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Module</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ModIface</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><span class="hs-identifier hs-type">TypeEnv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfM</span><span> </span><a href="#local-6989586621681698744"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TypeEnv</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ModDetails</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-352"></a><a name="typecheckIfacesForMerging"><a href="TcIface.html#typecheckIfacesForMerging"><span class="hs-identifier">typecheckIfacesForMerging</span></a></a><span> </span><a name="local-6989586621681698778"><a href="#local-6989586621681698778"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681698779"><a href="#local-6989586621681698779"><span class="hs-identifier">ifaces</span></a></a><span> </span><a name="local-6989586621681698780"><a href="#local-6989586621681698780"><span class="hs-identifier">tc_env_var</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-353"></a><span>  </span><span class="hs-comment">-- cannot be boot (False)</span><span>
</span><a name="line-354"></a><span>  </span><a href="TcRnMonad.html#initIfaceLcl"><span class="hs-identifier hs-var">initIfaceLcl</span></a><span> </span><a href="#local-6989586621681698778"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;typecheckIfacesForMerging&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-355"></a><span>    </span><a name="local-6989586621681698781"><a href="#local-6989586621681698781"><span class="hs-identifier">ignore_prags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a><span> </span><span class="hs-identifier hs-var">Opt_IgnoreInterfacePragmas</span><span>
</span><a name="line-356"></a><span>    </span><span class="hs-comment">-- Build the initial environment</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-comment">-- NB: Don't include dfuns here, because we don't want to</span><span>
</span><a name="line-358"></a><span>    </span><span class="hs-comment">-- serialize them out.  See Note [rnIfaceNeverExported] in RnModIface</span><span>
</span><a name="line-359"></a><span>    </span><span class="hs-comment">-- NB: But coercions are OK, because they will have the right OccName.</span><span>
</span><a name="line-360"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698782"><a href="#local-6989586621681698782"><span class="hs-identifier">mk_decl_env</span></a></a><span> </span><a name="local-6989586621681698785"><a href="#local-6989586621681698785"><span class="hs-identifier">decls</span></a></a><span>
</span><a name="line-361"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkOccEnv</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getOccName</span><span> </span><a href="#local-6989586621681698786"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698786"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-362"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681698786"><a href="#local-6989586621681698786"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698785"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-363"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681698786"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-364"></a><span>                            </span><span class="hs-identifier hs-var">IfaceId</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifIdDetails</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfDFunId</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- exclude DFuns</span><span>
</span><a name="line-365"></a><span>                            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-366"></a><span>        </span><a name="local-6989586621681698783"><a href="#local-6989586621681698783"><span class="hs-identifier">decl_envs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698782"><span class="hs-identifier hs-var">mk_decl_env</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">mi_decls</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698779"><span class="hs-identifier hs-var">ifaces</span></a><span>
</span><a name="line-367"></a><span>                        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">OccEnv</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span class="hs-special">]</span><span>
</span><a name="line-368"></a><span>        </span><a name="local-6989586621681698784"><a href="#local-6989586621681698784"><span class="hs-identifier">decl_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="TcIface.html#mergeIfaceDecls"><span class="hs-identifier hs-var">mergeIfaceDecls</span></a><span> </span><span class="hs-identifier hs-var">emptyOccEnv</span><span> </span><a href="#local-6989586621681698783"><span class="hs-identifier hs-var">decl_envs</span></a><span>
</span><a name="line-369"></a><span>                        </span><span class="hs-glyph">::</span><span>  </span><span class="hs-identifier hs-type">OccEnv</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span>
</span><a name="line-370"></a><span>    </span><span class="hs-comment">-- TODO: change loadDecls to accept w/o Fingerprint</span><span>
</span><a name="line-371"></a><span>    </span><a name="local-6989586621681698788"><a href="#local-6989586621681698788"><span class="hs-identifier">names_w_things</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#loadDecls"><span class="hs-identifier hs-var">loadDecls</span></a><span> </span><a href="#local-6989586621681698781"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621681698787"><a href="#local-6989586621681698787"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698787"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span>                                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">occEnvElts</span><span> </span><a href="#local-6989586621681698784"><span class="hs-identifier hs-var">decl_env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698789"><a href="#local-6989586621681698789"><span class="hs-identifier">global_type_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNameEnv</span><span> </span><a href="#local-6989586621681698788"><span class="hs-identifier hs-var">names_w_things</span></a><span>
</span><a name="line-374"></a><span>    </span><span class="hs-identifier hs-var">writeMutVar</span><span> </span><a href="#local-6989586621681698780"><span class="hs-identifier hs-var">tc_env_var</span></a><span> </span><a href="#local-6989586621681698789"><span class="hs-identifier hs-var">global_type_env</span></a><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span>    </span><span class="hs-comment">-- OK, now typecheck each ModIface using this environment</span><span>
</span><a name="line-377"></a><span>    </span><a name="local-6989586621681698800"><a href="#local-6989586621681698800"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forM</span><span> </span><a href="#local-6989586621681698779"><span class="hs-identifier hs-var">ifaces</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681698790"><a href="#local-6989586621681698790"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-378"></a><span>        </span><span class="hs-comment">-- See Note [Resolving never-exported Names in TcIface]</span><span>
</span><a name="line-379"></a><span>        </span><a name="local-6989586621681698793"><a href="#local-6989586621681698793"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fixM</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681698791"><a href="#local-6989586621681698791"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-380"></a><span>            </span><a href="TcRnMonad.html#setImplicitEnvM"><span class="hs-identifier hs-var">setImplicitEnvM</span></a><span> </span><a href="#local-6989586621681698791"><span class="hs-identifier hs-var">type_env</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-381"></a><span>                </span><a name="local-6989586621681698792"><a href="#local-6989586621681698792"><span class="hs-identifier">decls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#loadDecls"><span class="hs-identifier hs-var">loadDecls</span></a><span> </span><a href="#local-6989586621681698781"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_decls</span><span> </span><a href="#local-6989586621681698790"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkNameEnv</span><span> </span><a href="#local-6989586621681698792"><span class="hs-identifier hs-var">decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-383"></a><span>        </span><span class="hs-comment">-- But note that we use this type_env to typecheck references to DFun</span><span>
</span><a name="line-384"></a><span>        </span><span class="hs-comment">-- in 'IfaceInst'</span><span>
</span><a name="line-385"></a><span>        </span><a href="TcRnMonad.html#setImplicitEnvM"><span class="hs-identifier hs-var">setImplicitEnvM</span></a><span> </span><a href="#local-6989586621681698793"><span class="hs-identifier hs-var">type_env</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-386"></a><span>        </span><a name="local-6989586621681698794"><a href="#local-6989586621681698794"><span class="hs-identifier">insts</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceInst"><span class="hs-identifier hs-var">tcIfaceInst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_insts</span><span> </span><a href="#local-6989586621681698790"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>        </span><a name="local-6989586621681698795"><a href="#local-6989586621681698795"><span class="hs-identifier">fam_insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceFamInst"><span class="hs-identifier hs-var">tcIfaceFamInst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_fam_insts</span><span> </span><a href="#local-6989586621681698790"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span>        </span><a name="local-6989586621681698796"><a href="#local-6989586621681698796"><span class="hs-identifier">rules</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceRules"><span class="hs-identifier hs-var">tcIfaceRules</span></a><span> </span><a href="#local-6989586621681698781"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_rules</span><span> </span><a href="#local-6989586621681698790"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-389"></a><span>        </span><a name="local-6989586621681698797"><a href="#local-6989586621681698797"><span class="hs-identifier">anns</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceAnnotations"><span class="hs-identifier hs-var">tcIfaceAnnotations</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_anns</span><span> </span><a href="#local-6989586621681698790"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>        </span><a name="local-6989586621681698798"><a href="#local-6989586621681698798"><span class="hs-identifier">exports</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#ifaceExportNames"><span class="hs-identifier hs-var">ifaceExportNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_exports</span><span> </span><a href="#local-6989586621681698790"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-391"></a><span>        </span><a name="local-6989586621681698799"><a href="#local-6989586621681698799"><span class="hs-identifier">complete_sigs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCompleteSigs"><span class="hs-identifier hs-var">tcIfaceCompleteSigs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_complete_sigs</span><span> </span><a href="#local-6989586621681698790"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ModDetails</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">md_types</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698793"><span class="hs-identifier hs-var">type_env</span></a><span>
</span><a name="line-393"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_insts</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698794"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-394"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698795"><span class="hs-identifier hs-var">fam_insts</span></a><span>
</span><a name="line-395"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_rules</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698796"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-396"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_anns</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698797"><span class="hs-identifier hs-var">anns</span></a><span>
</span><a name="line-397"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_exports</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698798"><span class="hs-identifier hs-var">exports</span></a><span>
</span><a name="line-398"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_complete_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698799"><span class="hs-identifier hs-var">complete_sigs</span></a><span>
</span><a name="line-399"></a><span>                            </span><span class="hs-special">}</span><span>
</span><a name="line-400"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698789"><span class="hs-identifier hs-var">global_type_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698800"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span>
</span><a name="line-401"></a><span>
</span><a name="line-402"></a><span class="hs-comment">-- | Typecheck a signature 'ModIface' under the assumption that we have</span><span>
</span><a name="line-403"></a><span class="hs-comment">-- instantiated it under some implementation (recorded in 'mi_semantic_module')</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- and want to check if the implementation fills the signature.</span><span>
</span><a name="line-405"></a><span class="hs-comment">--</span><span>
</span><a name="line-406"></a><span class="hs-comment">-- This needs to operate slightly differently than 'typecheckIface'</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- because (1) we have a 'NameShape', from the exports of the</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- implementing module, which we will use to give our top-level</span><span>
</span><a name="line-409"></a><span class="hs-comment">-- declarations the correct 'Name's even when the implementor</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- provided them with a reexport, and (2) we have to deal with</span><span>
</span><a name="line-411"></a><span class="hs-comment">-- DFun silliness (see Note [rnIfaceNeverExported])</span><span>
</span><a name="line-412"></a><span class="hs-identifier">typecheckIfaceForInstantiate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NameShape</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ModIface</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfM</span><span> </span><a href="#local-6989586621681698743"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-identifier hs-type">ModDetails</span><span>
</span><a name="line-413"></a><a name="typecheckIfaceForInstantiate"><a href="TcIface.html#typecheckIfaceForInstantiate"><span class="hs-identifier">typecheckIfaceForInstantiate</span></a></a><span> </span><a name="local-6989586621681698801"><a href="#local-6989586621681698801"><span class="hs-identifier">nsubst</span></a></a><span> </span><a name="local-6989586621681698802"><a href="#local-6989586621681698802"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-414"></a><span>  </span><a href="TcRnMonad.html#initIfaceLclWithSubst"><span class="hs-identifier hs-var">initIfaceLclWithSubst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mi_semantic_module</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;typecheckIfaceForInstantiate&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-416"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mi_boot</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698801"><span class="hs-identifier hs-var">nsubst</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-417"></a><span>    </span><a name="local-6989586621681698803"><a href="#local-6989586621681698803"><span class="hs-identifier">ignore_prags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a><span> </span><span class="hs-identifier hs-var">Opt_IgnoreInterfacePragmas</span><span>
</span><a name="line-418"></a><span>    </span><span class="hs-comment">-- See Note [Resolving never-exported Names in TcIface]</span><span>
</span><a name="line-419"></a><span>    </span><a name="local-6989586621681698806"><a href="#local-6989586621681698806"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fixM</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681698804"><a href="#local-6989586621681698804"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-420"></a><span>        </span><a href="TcRnMonad.html#setImplicitEnvM"><span class="hs-identifier hs-var">setImplicitEnvM</span></a><span> </span><a href="#local-6989586621681698804"><span class="hs-identifier hs-var">type_env</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-421"></a><span>            </span><a name="local-6989586621681698805"><a href="#local-6989586621681698805"><span class="hs-identifier">decls</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#loadDecls"><span class="hs-identifier hs-var">loadDecls</span></a><span> </span><a href="#local-6989586621681698803"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_decls</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkNameEnv</span><span> </span><a href="#local-6989586621681698805"><span class="hs-identifier hs-var">decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>    </span><span class="hs-comment">-- See Note [rnIfaceNeverExported]</span><span>
</span><a name="line-424"></a><span>    </span><a href="TcRnMonad.html#setImplicitEnvM"><span class="hs-identifier hs-var">setImplicitEnvM</span></a><span> </span><a href="#local-6989586621681698806"><span class="hs-identifier hs-var">type_env</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-425"></a><span>    </span><a name="local-6989586621681698807"><a href="#local-6989586621681698807"><span class="hs-identifier">insts</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceInst"><span class="hs-identifier hs-var">tcIfaceInst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_insts</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>    </span><a name="local-6989586621681698808"><a href="#local-6989586621681698808"><span class="hs-identifier">fam_insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceFamInst"><span class="hs-identifier hs-var">tcIfaceFamInst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_fam_insts</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-427"></a><span>    </span><a name="local-6989586621681698809"><a href="#local-6989586621681698809"><span class="hs-identifier">rules</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceRules"><span class="hs-identifier hs-var">tcIfaceRules</span></a><span> </span><a href="#local-6989586621681698803"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_rules</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-428"></a><span>    </span><a name="local-6989586621681698810"><a href="#local-6989586621681698810"><span class="hs-identifier">anns</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceAnnotations"><span class="hs-identifier hs-var">tcIfaceAnnotations</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_anns</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span>    </span><a name="local-6989586621681698811"><a href="#local-6989586621681698811"><span class="hs-identifier">exports</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#ifaceExportNames"><span class="hs-identifier hs-var">ifaceExportNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_exports</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span>    </span><a name="local-6989586621681698812"><a href="#local-6989586621681698812"><span class="hs-identifier">complete_sigs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCompleteSigs"><span class="hs-identifier hs-var">tcIfaceCompleteSigs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_complete_sigs</span><span> </span><a href="#local-6989586621681698802"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ModDetails</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">md_types</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698806"><span class="hs-identifier hs-var">type_env</span></a><span>
</span><a name="line-432"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_insts</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698807"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-433"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698808"><span class="hs-identifier hs-var">fam_insts</span></a><span>
</span><a name="line-434"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_rules</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698809"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-435"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_anns</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698810"><span class="hs-identifier hs-var">anns</span></a><span>
</span><a name="line-436"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_exports</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698811"><span class="hs-identifier hs-var">exports</span></a><span>
</span><a name="line-437"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_complete_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698812"><span class="hs-identifier hs-var">complete_sigs</span></a><span>
</span><a name="line-438"></a><span>                        </span><span class="hs-special">}</span><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-comment">-- Note [Resolving never-exported Names in TcIface]</span><span>
</span><a name="line-441"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-442"></a><span class="hs-comment">-- For the high-level overview, see</span><span>
</span><a name="line-443"></a><span class="hs-comment">-- Note [Handling never-exported TyThings under Backpack]</span><span>
</span><a name="line-444"></a><span class="hs-comment">--</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- As described in 'typecheckIfacesForMerging', the splendid innovation</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- of signature merging is to rewrite all Names in each of the signatures</span><span>
</span><a name="line-447"></a><span class="hs-comment">-- we are merging together to a pre-merged structure; this is the key</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- ingredient that lets us solve some problems when merging type</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- synonyms.</span><span>
</span><a name="line-450"></a><span class="hs-comment">--</span><span>
</span><a name="line-451"></a><span class="hs-comment">-- However, when a 'Name' refers to a NON-exported entity, as is the</span><span>
</span><a name="line-452"></a><span class="hs-comment">-- case with the DFun of a ClsInst, or a CoAxiom of a type family,</span><span>
</span><a name="line-453"></a><span class="hs-comment">-- this strategy causes problems: if we pick one and rewrite all</span><span>
</span><a name="line-454"></a><span class="hs-comment">-- references to a shared 'Name', we will accidentally fail to check</span><span>
</span><a name="line-455"></a><span class="hs-comment">-- if the DFun or CoAxioms are compatible, as they will never be</span><span>
</span><a name="line-456"></a><span class="hs-comment">-- checked--only exported entities are checked for compatibility,</span><span>
</span><a name="line-457"></a><span class="hs-comment">-- and a non-exported TyThing is checked WHEN we are checking the</span><span>
</span><a name="line-458"></a><span class="hs-comment">-- ClsInst or type family for compatibility in checkBootDeclM.</span><span>
</span><a name="line-459"></a><span class="hs-comment">-- By virtue of the fact that everything's been pointed to the merged</span><span>
</span><a name="line-460"></a><span class="hs-comment">-- declaration, you'll never notice there's a difference even if there</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- is one.</span><span>
</span><a name="line-462"></a><span class="hs-comment">--</span><span>
</span><a name="line-463"></a><span class="hs-comment">-- Fortunately, there are only a few places in the interface declarations</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- where this can occur, so we replace those calls with 'tcIfaceImplicit',</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- which will consult a local TypeEnv that records any never-exported</span><span>
</span><a name="line-466"></a><span class="hs-comment">-- TyThings which we should wire up with.</span><span>
</span><a name="line-467"></a><span class="hs-comment">--</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- Note that we actually knot-tie this local TypeEnv (the 'fixM'), because a</span><span>
</span><a name="line-469"></a><span class="hs-comment">-- type family can refer to a coercion axiom, all of which are done in one go</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- when we typecheck 'mi_decls'.  An alternate strategy would be to typecheck</span><span>
</span><a name="line-471"></a><span class="hs-comment">-- coercions first before type families, but that seemed more fragile.</span><span>
</span><a name="line-472"></a><span class="hs-comment">--</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Type and class declarations
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-481"></a><span>
</span><a name="line-482"></a><span class="hs-identifier">tcHiBootIface</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HscSource</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Module</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcRn</span><span> </span><span class="hs-identifier hs-type">SelfBootInfo</span><span>
</span><a name="line-483"></a><span class="hs-comment">-- Load the hi-boot iface for the module being compiled,</span><span>
</span><a name="line-484"></a><span class="hs-comment">-- if it indeed exists in the transitive closure of imports</span><span>
</span><a name="line-485"></a><span class="hs-comment">-- Return the ModDetails; Nothing if no hi-boot iface</span><span>
</span><a name="line-486"></a><a name="tcHiBootIface"><a href="TcIface.html#tcHiBootIface"><span class="hs-identifier">tcHiBootIface</span></a></a><span> </span><a name="local-6989586621681698813"><a href="#local-6989586621681698813"><span class="hs-identifier">hsc_src</span></a></a><span> </span><a name="local-6989586621681698814"><a href="#local-6989586621681698814"><span class="hs-identifier">mod</span></a></a><span>
</span><a name="line-487"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">HsBootFile</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698813"><span class="hs-identifier hs-var">hsc_src</span></a><span>            </span><span class="hs-comment">-- Already compiling a hs-boot file</span><span>
</span><a name="line-488"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">NoSelfBoot</span><span>
</span><a name="line-489"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-490"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;loadHiBootInterface&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698814"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698819"><a href="#local-6989586621681698819"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGhcMode"><span class="hs-identifier hs-var">getGhcMode</span></a><span>
</span><a name="line-493"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isOneShot</span><span> </span><a href="#local-6989586621681698819"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span>
</span><a name="line-494"></a><span>                </span><span class="hs-comment">-- In --make and interactive mode, if this module has an hs-boot file</span><span>
</span><a name="line-495"></a><span>                </span><span class="hs-comment">-- we'll have compiled it already, and it'll be in the HPT</span><span>
</span><a name="line-496"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-497"></a><span>                </span><span class="hs-comment">-- We check wheher the interface is a *boot* interface.</span><span>
</span><a name="line-498"></a><span>                </span><span class="hs-comment">-- It can happen (when using GHC from Visual Studio) that we</span><span>
</span><a name="line-499"></a><span>                </span><span class="hs-comment">-- compile a module in TypecheckOnly mode, with a stable,</span><span>
</span><a name="line-500"></a><span>                </span><span class="hs-comment">-- fully-populated HPT.  In that case the boot interface isn't there</span><span>
</span><a name="line-501"></a><span>                </span><span class="hs-comment">-- (it's been replaced by the mother module) so we can't check it.</span><span>
</span><a name="line-502"></a><span>                </span><span class="hs-comment">-- And that's fine, because if M's ModInfo is in the HPT, then</span><span>
</span><a name="line-503"></a><span>                </span><span class="hs-comment">-- it's been compiled once, and we don't need to check the boot iface</span><span>
</span><a name="line-504"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698820"><a href="#local-6989586621681698820"><span class="hs-identifier">hpt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getHpt"><span class="hs-identifier hs-var">getHpt</span></a><span>
</span><a name="line-505"></a><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupHpt</span><span> </span><a href="#local-6989586621681698820"><span class="hs-identifier hs-var">hpt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621681698814"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-506"></a><span>                      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681698821"><a href="#local-6989586621681698821"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">mi_boot</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_iface</span><span> </span><a href="#local-6989586621681698821"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-507"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcIface.html#mkSelfBootInfo"><span class="hs-identifier hs-var">mkSelfBootInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_iface</span><span> </span><a href="#local-6989586621681698821"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_details</span><span> </span><a href="#local-6989586621681698821"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><span>                      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">NoSelfBoot</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-509"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span>        </span><span class="hs-comment">-- OK, so we're in one-shot mode.</span><span>
</span><a name="line-512"></a><span>        </span><span class="hs-comment">-- Re #9245, we always check if there is an hi-boot interface</span><span>
</span><a name="line-513"></a><span>        </span><span class="hs-comment">-- to check consistency against, rather than just when we notice</span><span>
</span><a name="line-514"></a><span>        </span><span class="hs-comment">-- that an hi-boot is necessary due to a circular import.</span><span>
</span><a name="line-515"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698822"><a href="#local-6989586621681698822"><span class="hs-identifier">read_result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#findAndReadIface"><span class="hs-identifier hs-var">findAndReadIface</span></a><span>
</span><a name="line-516"></a><span>                                </span><a href="#local-6989586621681698815"><span class="hs-identifier hs-var">need</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitModuleInsts</span><span> </span><a href="#local-6989586621681698814"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698814"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-517"></a><span>                                </span><span class="hs-identifier hs-var">True</span><span>    </span><span class="hs-comment">-- Hi-boot file</span><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681698822"><span class="hs-identifier hs-var">read_result</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-520"></a><span>            </span><span class="hs-identifier hs-var">Succeeded</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681698823"><a href="#local-6989586621681698823"><span class="hs-identifier">iface</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681698824"><a href="#local-6989586621681698824"><span class="hs-identifier">_path</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698825"><a href="#local-6989586621681698825"><span class="hs-identifier">tc_iface</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#initIfaceTcRn"><span class="hs-identifier hs-var">initIfaceTcRn</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcIface.html#typecheckIface"><span class="hs-identifier hs-var">typecheckIface</span></a><span> </span><a href="#local-6989586621681698823"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-521"></a><span>                                           </span><span class="hs-special">;</span><span> </span><a href="TcIface.html#mkSelfBootInfo"><span class="hs-identifier hs-var">mkSelfBootInfo</span></a><span> </span><a href="#local-6989586621681698823"><span class="hs-identifier hs-var">iface</span></a><span> </span><a href="#local-6989586621681698825"><span class="hs-identifier hs-var">tc_iface</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-522"></a><span>            </span><span class="hs-identifier hs-var">Failed</span><span> </span><a name="local-6989586621681698826"><a href="#local-6989586621681698826"><span class="hs-identifier">err</span></a></a><span>               </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span>        </span><span class="hs-comment">-- There was no hi-boot file. But if there is circularity in</span><span>
</span><a name="line-525"></a><span>        </span><span class="hs-comment">-- the module graph, there really should have been one.</span><span>
</span><a name="line-526"></a><span>        </span><span class="hs-comment">-- Since we've read all the direct imports by now,</span><span>
</span><a name="line-527"></a><span>        </span><span class="hs-comment">-- eps_is_boot will record if any of our imports mention the</span><span>
</span><a name="line-528"></a><span>        </span><span class="hs-comment">-- current module, which either means a module loop (not</span><span>
</span><a name="line-529"></a><span>        </span><span class="hs-comment">-- a SOURCE import) or that our hi-boot file has mysteriously</span><span>
</span><a name="line-530"></a><span>        </span><span class="hs-comment">-- disappeared.</span><span>
</span><a name="line-531"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698827"><a href="#local-6989586621681698827"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getEps"><span class="hs-identifier hs-var">getEps</span></a><span>
</span><a name="line-532"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupUFM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">eps_is_boot</span><span> </span><a href="#local-6989586621681698827"><span class="hs-identifier hs-var">eps</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621681698814"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-533"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">NoSelfBoot</span><span> </span><span class="hs-comment">-- The typical case</span><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><a href="#local-6989586621681698816"><span class="hs-identifier hs-var">moduleLoop</span></a><span>
</span><a name="line-536"></a><span>                </span><span class="hs-comment">-- Someone below us imported us!</span><span>
</span><a name="line-537"></a><span>                </span><span class="hs-comment">-- This is a loop with no hi-boot in the way</span><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681698828"><a href="#local-6989586621681698828"><span class="hs-identifier">_mod</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698817"><span class="hs-identifier hs-var">elaborate</span></a><span> </span><a href="#local-6989586621681698826"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-540"></a><span>                </span><span class="hs-comment">-- The hi-boot file has mysteriously disappeared.</span><span>
</span><a name="line-541"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-542"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-543"></a><span>    </span><a name="local-6989586621681698815"><a href="#local-6989586621681698815"><span class="hs-identifier">need</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Need the hi-boot interface for&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698814"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-544"></a><span>                 </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;to compare against the Real Thing&quot;</span><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span>    </span><a name="local-6989586621681698816"><a href="#local-6989586621681698816"><span class="hs-identifier">moduleLoop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Circular imports: module&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698814"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-547"></a><span>                     </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;depends on itself&quot;</span><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span>    </span><a name="local-6989586621681698817"><a href="#local-6989586621681698817"><span class="hs-identifier">elaborate</span></a></a><span> </span><a name="local-6989586621681698818"><a href="#local-6989586621681698818"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Could not find hi-boot interface for&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-550"></a><span>                          </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698814"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><a href="#local-6989586621681698818"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span>
</span><a name="line-553"></a><span class="hs-identifier">mkSelfBootInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ModIface</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ModDetails</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcRn</span><span> </span><span class="hs-identifier hs-type">SelfBootInfo</span><span>
</span><a name="line-554"></a><a name="mkSelfBootInfo"><a href="TcIface.html#mkSelfBootInfo"><span class="hs-identifier">mkSelfBootInfo</span></a></a><span> </span><a name="local-6989586621681698829"><a href="#local-6989586621681698829"><span class="hs-identifier">iface</span></a></a><span> </span><a name="local-6989586621681698830"><a href="#local-6989586621681698830"><span class="hs-identifier">mds</span></a></a><span>
</span><a name="line-555"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- NB: This is computed DIRECTLY from the ModIface rather</span><span>
</span><a name="line-556"></a><span>       </span><span class="hs-comment">-- than from the ModDetails, so that we can query 'sb_tcs'</span><span>
</span><a name="line-557"></a><span>       </span><span class="hs-comment">-- WITHOUT forcing the contents of the interface.</span><span>
</span><a name="line-558"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698832"><a href="#local-6989586621681698832"><span class="hs-identifier">tcs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">ifName</span><span>
</span><a name="line-559"></a><span>                 </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621681698831"><span class="hs-identifier hs-var">isIfaceTyCon</span></a><span>
</span><a name="line-560"></a><span>                 </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span>
</span><a name="line-561"></a><span>                 </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">mi_decls</span><span> </span><a href="#local-6989586621681698829"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-562"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">SelfBoot</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sb_mds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698830"><span class="hs-identifier hs-var">mds</span></a><span>
</span><a name="line-563"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sb_tcs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNameSet</span><span> </span><a href="#local-6989586621681698832"><span class="hs-identifier hs-var">tcs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-564"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-565"></a><span>    </span><span class="hs-comment">-- | Retuerns @True@ if, when you call 'tcIfaceDecl' on</span><span>
</span><a name="line-566"></a><span>    </span><span class="hs-comment">-- this 'IfaceDecl', an ATyCon would be returned.</span><span>
</span><a name="line-567"></a><span>    </span><span class="hs-comment">-- NB: This code assumes that a TyCon cannot be implicit.</span><span>
</span><a name="line-568"></a><span>    </span><a name="local-6989586621681698831"><a href="#local-6989586621681698831"><span class="hs-identifier">isIfaceTyCon</span></a></a><span> </span><span class="hs-identifier hs-var">IfaceId</span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-569"></a><span>    </span><span class="hs-identifier">isIfaceTyCon</span><span> </span><span class="hs-identifier hs-var">IfaceData</span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-570"></a><span>    </span><span class="hs-identifier">isIfaceTyCon</span><span> </span><span class="hs-identifier hs-var">IfaceSynonym</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-571"></a><span>    </span><span class="hs-identifier">isIfaceTyCon</span><span> </span><span class="hs-identifier hs-var">IfaceFamily</span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-572"></a><span>    </span><span class="hs-identifier">isIfaceTyCon</span><span> </span><span class="hs-identifier hs-var">IfaceClass</span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-573"></a><span>    </span><span class="hs-identifier">isIfaceTyCon</span><span> </span><span class="hs-identifier hs-var">IfaceAxiom</span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-574"></a><span>    </span><span class="hs-identifier">isIfaceTyCon</span><span> </span><span class="hs-identifier hs-var">IfacePatSyn</span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-575"></a><span>
</span><a name="line-576"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Type and class declarations
*                                                                      *
************************************************************************

When typechecking a data type decl, we *lazily* (via forkM) typecheck
the constructor argument types.  This is in the hope that we may never
poke on those argument types, and hence may never need to load the
interface files for types mentioned in the arg types.

E.g.
        data Foo.S = MkS Baz.T
Maybe we can get away without even loading the interface for Baz!

This is not just a performance thing.  Suppose we have
        data Foo.S = MkS Baz.T
        data Baz.T = MkT Foo.S
(in different interface files, of course).
Now, first we load and typecheck Foo.S, and add it to the type envt.
If we do explore MkS's argument, we'll load and typecheck Baz.T.
If we explore MkT's argument we'll find Foo.S already in the envt.

If we typechecked constructor args eagerly, when loading Foo.S we'd try to
typecheck the type Baz.T.  So we'd fault in Baz.T... and then need Foo.S...
which isn't done yet.

All very cunning. However, there is a rather subtle gotcha which bit
me when developing this stuff.  When we typecheck the decl for S, we
extend the type envt with S, MkS, and all its implicit Ids.  Suppose
(a bug, but it happened) that the list of implicit Ids depended in
turn on the constructor arg types.  Then the following sequence of
events takes place:
        * we build a thunk &lt;t&gt; for the constructor arg tys
        * we build a thunk for the extended type environment (depends on &lt;t&gt;)
        * we write the extended type envt into the global EPS mutvar

Now we look something up in the type envt
        * that pulls on &lt;t&gt;
        * which reads the global type envt out of the global EPS mutvar
        * but that depends in turn on &lt;t&gt;

It's subtle, because, it'd work fine if we typechecked the constructor args
eagerly -- they don't need the extended type envt.  They just get the extended
type envt by accident, because they look at it later.

What this means is that the implicitTyThings MUST NOT DEPEND on any of
the forkM stuff.
-}</span><span>
</span><a name="line-626"></a><span>
</span><a name="line-627"></a><span class="hs-identifier">tcIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- ^ True &lt;=&gt; discard IdInfo on IfaceId bindings</span><span>
</span><a name="line-628"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span>
</span><a name="line-629"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span>
</span><a name="line-630"></a><a name="tcIfaceDecl"><a href="TcIface.html#tcIfaceDecl"><span class="hs-identifier">tcIfaceDecl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#tc_iface_decl"><span class="hs-identifier hs-var">tc_iface_decl</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span class="hs-identifier">tc_iface_decl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Class</span><span>  </span><span class="hs-comment">-- ^ For associated type/data family declarations</span><span>
</span><a name="line-633"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>         </span><span class="hs-comment">-- ^ True &lt;=&gt; discard IdInfo on IfaceId bindings</span><span>
</span><a name="line-634"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceDecl</span><span>
</span><a name="line-635"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span>
</span><a name="line-636"></a><a name="tc_iface_decl"><a href="TcIface.html#tc_iface_decl"><span class="hs-identifier">tc_iface_decl</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681698833"><a href="#local-6989586621681698833"><span class="hs-identifier">ignore_prags</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceId</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ifName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698834"><a href="#local-6989586621681698834"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifType</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698835"><a href="#local-6989586621681698835"><span class="hs-identifier">iface_type</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-637"></a><span>                                       </span><span class="hs-identifier">ifIdDetails</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698836"><a href="#local-6989586621681698836"><span class="hs-identifier">details</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifIdInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698837"><a href="#local-6989586621681698837"><span class="hs-identifier">info</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-638"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698838"><a href="#local-6989586621681698838"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698835"><span class="hs-identifier hs-var">iface_type</span></a><span>
</span><a name="line-639"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698839"><a href="#local-6989586621681698839"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIdDetails"><span class="hs-identifier hs-var">tcIdDetails</span></a><span> </span><a href="#local-6989586621681698838"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681698836"><span class="hs-identifier hs-var">details</span></a><span>
</span><a name="line-640"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698840"><a href="#local-6989586621681698840"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIdInfo"><span class="hs-identifier hs-var">tcIdInfo</span></a><span> </span><a href="#local-6989586621681698833"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-identifier hs-var">TopLevel</span><span> </span><a href="#local-6989586621681698834"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681698838"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681698837"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-641"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AnId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkGlobalId</span><span> </span><a href="#local-6989586621681698839"><span class="hs-identifier hs-var">details</span></a><span> </span><a href="#local-6989586621681698834"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681698838"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681698840"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-642"></a><span>
</span><a name="line-643"></a><span class="hs-identifier">tc_iface_decl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceData</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ifName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698841"><a href="#local-6989586621681698841"><span class="hs-identifier">tc_name</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-644"></a><span>                          </span><span class="hs-identifier">ifCType</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698842"><a href="#local-6989586621681698842"><span class="hs-identifier">cType</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-645"></a><span>                          </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698843"><a href="#local-6989586621681698843"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-646"></a><span>                          </span><span class="hs-identifier">ifResKind</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698844"><a href="#local-6989586621681698844"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-647"></a><span>                          </span><span class="hs-identifier">ifRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698845"><a href="#local-6989586621681698845"><span class="hs-identifier">roles</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-648"></a><span>                          </span><span class="hs-identifier">ifCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698846"><a href="#local-6989586621681698846"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifGadtSyntax</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698847"><a href="#local-6989586621681698847"><span class="hs-identifier">gadt_syn</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-649"></a><span>                          </span><span class="hs-identifier">ifCons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698848"><a href="#local-6989586621681698848"><span class="hs-identifier">rdr_cons</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-650"></a><span>                          </span><span class="hs-identifier">ifParent</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698849"><a href="#local-6989586621681698849"><span class="hs-identifier">mb_parent</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyConBinders_AT"><span class="hs-identifier hs-var">bindIfaceTyConBinders_AT</span></a><span> </span><a href="#local-6989586621681698843"><span class="hs-identifier hs-var">binders</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698859"><a href="#local-6989586621681698859"><span class="hs-identifier">binders'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-652"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698860"><a href="#local-6989586621681698860"><span class="hs-identifier">res_kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698844"><span class="hs-identifier hs-var">res_kind</span></a><span>
</span><a name="line-653"></a><span>
</span><a name="line-654"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698865"><a href="#local-6989586621681698865"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fixM</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698861"><a href="#local-6989586621681698861"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-655"></a><span>            </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698862"><a href="#local-6989586621681698862"><span class="hs-identifier">stupid_theta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCtxt"><span class="hs-identifier hs-var">tcIfaceCtxt</span></a><span> </span><a href="#local-6989586621681698846"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-656"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698863"><a href="#local-6989586621681698863"><span class="hs-identifier">parent'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698850"><span class="hs-identifier hs-var">tc_parent</span></a><span> </span><a href="#local-6989586621681698841"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="#local-6989586621681698849"><span class="hs-identifier hs-var">mb_parent</span></a><span>
</span><a name="line-657"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698864"><a href="#local-6989586621681698864"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceDataCons"><span class="hs-identifier hs-var">tcIfaceDataCons</span></a><span> </span><a href="#local-6989586621681698841"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="#local-6989586621681698861"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621681698859"><span class="hs-identifier hs-var">binders'</span></a><span> </span><a href="#local-6989586621681698848"><span class="hs-identifier hs-var">rdr_cons</span></a><span>
</span><a name="line-658"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkAlgTyCon</span><span> </span><a href="#local-6989586621681698841"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="#local-6989586621681698859"><span class="hs-identifier hs-var">binders'</span></a><span> </span><a href="#local-6989586621681698860"><span class="hs-identifier hs-var">res_kind'</span></a><span>
</span><a name="line-659"></a><span>                                 </span><a href="#local-6989586621681698845"><span class="hs-identifier hs-var">roles</span></a><span> </span><a href="#local-6989586621681698842"><span class="hs-identifier hs-var">cType</span></a><span> </span><a href="#local-6989586621681698862"><span class="hs-identifier hs-var">stupid_theta</span></a><span>
</span><a name="line-660"></a><span>                                 </span><a href="#local-6989586621681698864"><span class="hs-identifier hs-var">cons</span></a><span> </span><a href="#local-6989586621681698863"><span class="hs-identifier hs-var">parent'</span></a><span> </span><a href="#local-6989586621681698847"><span class="hs-identifier hs-var">gadt_syn</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-661"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tcIfaceDecl4&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698865"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ATyCon</span><span> </span><a href="#local-6989586621681698865"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-663"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-664"></a><span>    </span><span class="hs-identifier">tc_parent</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceTyConParent</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">AlgTyConFlav</span><span>
</span><a name="line-665"></a><span>    </span><a name="local-6989586621681698850"><a href="#local-6989586621681698850"><span class="hs-identifier">tc_parent</span></a></a><span> </span><a name="local-6989586621681698851"><a href="#local-6989586621681698851"><span class="hs-identifier">tc_name</span></a></a><span> </span><span class="hs-identifier hs-var">IfNoParent</span><span>
</span><a name="line-666"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698852"><a href="#local-6989586621681698852"><span class="hs-identifier">tc_rep_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-6989586621681698851"><span class="hs-identifier hs-var">tc_name</span></a><span>
</span><a name="line-667"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VanillaAlgTyCon</span><span> </span><a href="#local-6989586621681698852"><span class="hs-identifier hs-var">tc_rep_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-668"></a><span>    </span><span class="hs-identifier">tc_parent</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfDataInstance</span><span> </span><a name="local-6989586621681698853"><a href="#local-6989586621681698853"><span class="hs-identifier">ax_name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681698854"><a href="#local-6989586621681698854"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-669"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698855"><a href="#local-6989586621681698855"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCoAxiom"><span class="hs-identifier hs-var">tcIfaceCoAxiom</span></a><span> </span><a href="#local-6989586621681698853"><span class="hs-identifier hs-var">ax_name</span></a><span>
</span><a name="line-670"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698856"><a href="#local-6989586621681698856"><span class="hs-identifier">fam_tc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coAxiomTyCon</span><span> </span><a href="#local-6989586621681698855"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-671"></a><span>                 </span><a name="local-6989586621681698857"><a href="#local-6989586621681698857"><span class="hs-identifier">ax_unbr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toUnbranchedAxiom</span><span> </span><a href="#local-6989586621681698855"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-672"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698858"><a href="#local-6989586621681698858"><span class="hs-identifier">lhs_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceAppArgs"><span class="hs-identifier hs-var">tcIfaceAppArgs</span></a><span> </span><a href="#local-6989586621681698854"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-673"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataFamInstTyCon</span><span> </span><a href="#local-6989586621681698857"><span class="hs-identifier hs-var">ax_unbr</span></a><span> </span><a href="#local-6989586621681698856"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-6989586621681698858"><span class="hs-identifier hs-var">lhs_tys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-674"></a><span>
</span><a name="line-675"></a><span class="hs-identifier">tc_iface_decl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceSynonym</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ifName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698866"><a href="#local-6989586621681698866"><span class="hs-identifier">tc_name</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-676"></a><span>                                      </span><span class="hs-identifier">ifRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698867"><a href="#local-6989586621681698867"><span class="hs-identifier">roles</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-677"></a><span>                                      </span><span class="hs-identifier">ifSynRhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698868"><a href="#local-6989586621681698868"><span class="hs-identifier">rhs_ty</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-678"></a><span>                                      </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698869"><a href="#local-6989586621681698869"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-679"></a><span>                                      </span><span class="hs-identifier">ifResKind</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698870"><a href="#local-6989586621681698870"><span class="hs-identifier">res_kind</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-680"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyConBinders_AT"><span class="hs-identifier hs-var">bindIfaceTyConBinders_AT</span></a><span> </span><a href="#local-6989586621681698869"><span class="hs-identifier hs-var">binders</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698873"><a href="#local-6989586621681698873"><span class="hs-identifier">binders'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-681"></a><span>     </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698874"><a href="#local-6989586621681698874"><span class="hs-identifier">res_kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698870"><span class="hs-identifier hs-var">res_kind</span></a><span>     </span><span class="hs-comment">-- Note [Synonym kind loop]</span><span>
</span><a name="line-682"></a><span>     </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698875"><a href="#local-6989586621681698875"><span class="hs-identifier">rhs</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698871"><span class="hs-identifier hs-var">mk_doc</span></a><span> </span><a href="#local-6989586621681698866"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-683"></a><span>                   </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698868"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-684"></a><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698876"><a href="#local-6989586621681698876"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">buildSynTyCon</span><span> </span><a href="#local-6989586621681698866"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="#local-6989586621681698873"><span class="hs-identifier hs-var">binders'</span></a><span> </span><a href="#local-6989586621681698874"><span class="hs-identifier hs-var">res_kind'</span></a><span> </span><a href="#local-6989586621681698867"><span class="hs-identifier hs-var">roles</span></a><span> </span><a href="#local-6989586621681698875"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-685"></a><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ATyCon</span><span> </span><a href="#local-6989586621681698876"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-686"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-687"></a><span>     </span><a name="local-6989586621681698871"><a href="#local-6989586621681698871"><span class="hs-identifier">mk_doc</span></a></a><span> </span><a name="local-6989586621681698872"><a href="#local-6989586621681698872"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Type synonym&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698872"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span class="hs-identifier">tc_iface_decl</span><span> </span><a name="local-6989586621681698877"><a href="#local-6989586621681698877"><span class="hs-identifier">parent</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceFamily</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ifName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698878"><a href="#local-6989586621681698878"><span class="hs-identifier">tc_name</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-690"></a><span>                                     </span><span class="hs-identifier">ifFamFlav</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698879"><a href="#local-6989586621681698879"><span class="hs-identifier">fam_flav</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-691"></a><span>                                     </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698880"><a href="#local-6989586621681698880"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-692"></a><span>                                     </span><span class="hs-identifier">ifResKind</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698881"><a href="#local-6989586621681698881"><span class="hs-identifier">res_kind</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-693"></a><span>                                     </span><span class="hs-identifier">ifResVar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698882"><a href="#local-6989586621681698882"><span class="hs-identifier">res</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifFamInj</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698883"><a href="#local-6989586621681698883"><span class="hs-identifier">inj</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-694"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyConBinders_AT"><span class="hs-identifier hs-var">bindIfaceTyConBinders_AT</span></a><span> </span><a href="#local-6989586621681698880"><span class="hs-identifier hs-var">binders</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698891"><a href="#local-6989586621681698891"><span class="hs-identifier">binders'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-695"></a><span>     </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698892"><a href="#local-6989586621681698892"><span class="hs-identifier">res_kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698881"><span class="hs-identifier hs-var">res_kind</span></a><span>    </span><span class="hs-comment">-- Note [Synonym kind loop]</span><span>
</span><a name="line-696"></a><span>     </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698893"><a href="#local-6989586621681698893"><span class="hs-identifier">rhs</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698884"><span class="hs-identifier hs-var">mk_doc</span></a><span> </span><a href="#local-6989586621681698878"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-697"></a><span>                   </span><a href="#local-6989586621681698885"><span class="hs-identifier hs-var">tc_fam_flav</span></a><span> </span><a href="#local-6989586621681698878"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="#local-6989586621681698879"><span class="hs-identifier hs-var">fam_flav</span></a><span>
</span><a name="line-698"></a><span>     </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698894"><a href="#local-6989586621681698894"><span class="hs-identifier">res_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-special">(</span><a href="IfaceEnv.html#newIfaceName"><span class="hs-identifier hs-var">newIfaceName</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mkTyVarOccFS</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698882"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-699"></a><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698895"><a href="#local-6989586621681698895"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkFamilyTyCon</span><span> </span><a href="#local-6989586621681698878"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="#local-6989586621681698891"><span class="hs-identifier hs-var">binders'</span></a><span> </span><a href="#local-6989586621681698892"><span class="hs-identifier hs-var">res_kind'</span></a><span> </span><a href="#local-6989586621681698894"><span class="hs-identifier hs-var">res_name</span></a><span> </span><a href="#local-6989586621681698893"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-6989586621681698877"><span class="hs-identifier hs-var">parent</span></a><span> </span><a href="#local-6989586621681698883"><span class="hs-identifier hs-var">inj</span></a><span>
</span><a name="line-700"></a><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ATyCon</span><span> </span><a href="#local-6989586621681698895"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-701"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-702"></a><span>     </span><a name="local-6989586621681698884"><a href="#local-6989586621681698884"><span class="hs-identifier">mk_doc</span></a></a><span> </span><a name="local-6989586621681698886"><a href="#local-6989586621681698886"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Type synonym&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698886"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-703"></a><span>
</span><a name="line-704"></a><span>     </span><span class="hs-identifier">tc_fam_flav</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceFamTyConFlav</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">FamTyConFlav</span><span>
</span><a name="line-705"></a><span>     </span><a name="local-6989586621681698885"><a href="#local-6989586621681698885"><span class="hs-identifier">tc_fam_flav</span></a></a><span> </span><a name="local-6989586621681698887"><a href="#local-6989586621681698887"><span class="hs-identifier">tc_name</span></a></a><span> </span><span class="hs-identifier hs-var">IfaceDataFamilyTyCon</span><span>
</span><a name="line-706"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698888"><a href="#local-6989586621681698888"><span class="hs-identifier">tc_rep_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-6989586621681698887"><span class="hs-identifier hs-var">tc_name</span></a><span>
</span><a name="line-707"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataFamilyTyCon</span><span> </span><a href="#local-6989586621681698888"><span class="hs-identifier hs-var">tc_rep_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-708"></a><span>     </span><span class="hs-identifier">tc_fam_flav</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">IfaceOpenSynFamilyTyCon</span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">OpenSynFamilyTyCon</span><span>
</span><a name="line-709"></a><span>     </span><span class="hs-identifier">tc_fam_flav</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceClosedSynFamilyTyCon</span><span> </span><a name="local-6989586621681698889"><a href="#local-6989586621681698889"><span class="hs-identifier">mb_ax_name_branches</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698890"><a href="#local-6989586621681698890"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-special">(</span><a href="TcIface.html#tcIfaceCoAxiom"><span class="hs-identifier hs-var">tcIfaceCoAxiom</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698889"><span class="hs-identifier hs-var">mb_ax_name_branches</span></a><span>
</span><a name="line-711"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClosedSynFamilyTyCon</span><span> </span><a href="#local-6989586621681698890"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-712"></a><span>     </span><span class="hs-identifier">tc_fam_flav</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">IfaceAbstractClosedSynFamilyTyCon</span><span>
</span><a name="line-713"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span><span>
</span><a name="line-714"></a><span>     </span><span class="hs-identifier">tc_fam_flav</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">IfaceBuiltInSynFamTyCon</span><span>
</span><a name="line-715"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tc_iface_decl&quot;</span><span>
</span><a name="line-716"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;IfaceBuiltInSynFamTyCon in interface file&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>
</span><a name="line-718"></a><span class="hs-identifier">tc_iface_decl</span><span> </span><a name="local-6989586621681698896"><a href="#local-6989586621681698896"><span class="hs-identifier">_parent</span></a></a><span> </span><a name="local-6989586621681698897"><a href="#local-6989586621681698897"><span class="hs-identifier">_ignore_prags</span></a></a><span>
</span><a name="line-719"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceClass</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ifName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698898"><a href="#local-6989586621681698898"><span class="hs-identifier">tc_name</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-720"></a><span>                         </span><span class="hs-identifier">ifRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698899"><a href="#local-6989586621681698899"><span class="hs-identifier">roles</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-721"></a><span>                         </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698900"><a href="#local-6989586621681698900"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-722"></a><span>                         </span><span class="hs-identifier">ifFDs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698901"><a href="#local-6989586621681698901"><span class="hs-identifier">rdr_fds</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-723"></a><span>                         </span><span class="hs-identifier">ifBody</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfAbstractClass</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyConBinders"><span class="hs-identifier hs-var">bindIfaceTyConBinders</span></a><span> </span><a href="#local-6989586621681698900"><span class="hs-identifier hs-var">binders</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698902"><a href="#local-6989586621681698902"><span class="hs-identifier">binders'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-725"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698903"><a href="#local-6989586621681698903"><span class="hs-identifier">fds</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tc_fd"><span class="hs-identifier hs-var">tc_fd</span></a><span> </span><a href="#local-6989586621681698901"><span class="hs-identifier hs-var">rdr_fds</span></a><span>
</span><a name="line-726"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698904"><a href="#local-6989586621681698904"><span class="hs-identifier">cls</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#buildClass"><span class="hs-identifier hs-var">buildClass</span></a><span> </span><a href="#local-6989586621681698898"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="#local-6989586621681698902"><span class="hs-identifier hs-var">binders'</span></a><span> </span><a href="#local-6989586621681698899"><span class="hs-identifier hs-var">roles</span></a><span> </span><a href="#local-6989586621681698903"><span class="hs-identifier hs-var">fds</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-727"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ATyCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621681698904"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-728"></a><span>
</span><a name="line-729"></a><span class="hs-identifier">tc_iface_decl</span><span> </span><a name="local-6989586621681698905"><a href="#local-6989586621681698905"><span class="hs-identifier">_parent</span></a></a><span> </span><a name="local-6989586621681698906"><a href="#local-6989586621681698906"><span class="hs-identifier">ignore_prags</span></a></a><span>
</span><a name="line-730"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceClass</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ifName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698907"><a href="#local-6989586621681698907"><span class="hs-identifier">tc_name</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-731"></a><span>                         </span><span class="hs-identifier">ifRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698908"><a href="#local-6989586621681698908"><span class="hs-identifier">roles</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-732"></a><span>                         </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698909"><a href="#local-6989586621681698909"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-733"></a><span>                         </span><span class="hs-identifier">ifFDs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698910"><a href="#local-6989586621681698910"><span class="hs-identifier">rdr_fds</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-734"></a><span>                         </span><span class="hs-identifier">ifBody</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IfConcreteClass</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-735"></a><span>                             </span><span class="hs-identifier">ifClassCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698911"><a href="#local-6989586621681698911"><span class="hs-identifier">rdr_ctxt</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-736"></a><span>                             </span><span class="hs-identifier">ifATs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698912"><a href="#local-6989586621681698912"><span class="hs-identifier">rdr_ats</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifSigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698913"><a href="#local-6989586621681698913"><span class="hs-identifier">rdr_sigs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-737"></a><span>                             </span><span class="hs-identifier">ifMinDef</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698914"><a href="#local-6989586621681698914"><span class="hs-identifier">mindef_occ</span></a></a><span>
</span><a name="line-738"></a><span>                         </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyConBinders"><span class="hs-identifier hs-var">bindIfaceTyConBinders</span></a><span> </span><a href="#local-6989586621681698909"><span class="hs-identifier hs-var">binders</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698943"><a href="#local-6989586621681698943"><span class="hs-identifier">binders'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-740"></a><span>    </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tc-iface-class1&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698907"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-741"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698944"><a href="#local-6989586621681698944"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681698915"><span class="hs-identifier hs-var">tc_sc</span></a><span> </span><a href="#local-6989586621681698911"><span class="hs-identifier hs-var">rdr_ctxt</span></a><span>
</span><a name="line-742"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tc-iface-class2&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698907"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-743"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698945"><a href="#local-6989586621681698945"><span class="hs-identifier">sigs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681698916"><span class="hs-identifier hs-var">tc_sig</span></a><span> </span><a href="#local-6989586621681698913"><span class="hs-identifier hs-var">rdr_sigs</span></a><span>
</span><a name="line-744"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698946"><a href="#local-6989586621681698946"><span class="hs-identifier">fds</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tc_fd"><span class="hs-identifier hs-var">tc_fd</span></a><span> </span><a href="#local-6989586621681698910"><span class="hs-identifier hs-var">rdr_fds</span></a><span>
</span><a name="line-745"></a><span>    </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tc-iface-class3&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698907"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-746"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698947"><a href="#local-6989586621681698947"><span class="hs-identifier">mindef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-special">(</span><a href="IfaceEnv.html#lookupIfaceTop"><span class="hs-identifier hs-var">lookupIfaceTop</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mkVarOccFS</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698914"><span class="hs-identifier hs-var">mindef_occ</span></a><span>
</span><a name="line-747"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698950"><a href="#local-6989586621681698950"><span class="hs-identifier">cls</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fixM</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698948"><a href="#local-6989586621681698948"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-748"></a><span>              </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698949"><a href="#local-6989586621681698949"><span class="hs-identifier">ats</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698918"><span class="hs-identifier hs-var">tc_at</span></a><span> </span><a href="#local-6989586621681698948"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698912"><span class="hs-identifier hs-var">rdr_ats</span></a><span>
</span><a name="line-749"></a><span>              </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tc-iface-class4&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698907"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-750"></a><span>              </span><span class="hs-special">;</span><span> </span><a href="BuildTyCl.html#buildClass"><span class="hs-identifier hs-var">buildClass</span></a><span> </span><a href="#local-6989586621681698907"><span class="hs-identifier hs-var">tc_name</span></a><span> </span><a href="#local-6989586621681698943"><span class="hs-identifier hs-var">binders'</span></a><span> </span><a href="#local-6989586621681698908"><span class="hs-identifier hs-var">roles</span></a><span> </span><a href="#local-6989586621681698946"><span class="hs-identifier hs-var">fds</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698944"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698949"><span class="hs-identifier hs-var">ats</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698945"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698947"><span class="hs-identifier hs-var">mindef</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-751"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ATyCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621681698950"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-752"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-753"></a><span>   </span><a name="local-6989586621681698915"><a href="#local-6989586621681698915"><span class="hs-identifier">tc_sc</span></a></a><span> </span><a name="local-6989586621681698922"><a href="#local-6989586621681698922"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698919"><span class="hs-identifier hs-var">mk_sc_doc</span></a><span> </span><a href="#local-6989586621681698922"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698922"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">)</span><span>
</span><a name="line-754"></a><span>        </span><span class="hs-comment">-- The *length* of the superclasses is used by buildClass, and hence must</span><span>
</span><a name="line-755"></a><span>        </span><span class="hs-comment">-- not be inside the thunk.  But the *content* maybe recursive and hence</span><span>
</span><a name="line-756"></a><span>        </span><span class="hs-comment">-- must be lazy (via forkM).  Example:</span><span>
</span><a name="line-757"></a><span>        </span><span class="hs-comment">--     class C (T a) =&gt; D a where</span><span>
</span><a name="line-758"></a><span>        </span><span class="hs-comment">--       data T a</span><span>
</span><a name="line-759"></a><span>        </span><span class="hs-comment">-- Here the associated type T is knot-tied with the class, and</span><span>
</span><a name="line-760"></a><span>        </span><span class="hs-comment">-- so we must not pull on T too eagerly.  See Trac #5970</span><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span>   </span><span class="hs-identifier">tc_sig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceClassOp</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span>
</span><a name="line-763"></a><span>   </span><a name="local-6989586621681698916"><a href="#local-6989586621681698916"><span class="hs-identifier">tc_sig</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceClassOp</span><span> </span><a name="local-6989586621681698923"><a href="#local-6989586621681698923"><span class="hs-identifier">op_name</span></a></a><span> </span><a name="local-6989586621681698924"><a href="#local-6989586621681698924"><span class="hs-identifier">rdr_ty</span></a></a><span> </span><a name="local-6989586621681698925"><a href="#local-6989586621681698925"><span class="hs-identifier">dm</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-764"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698926"><a href="#local-6989586621681698926"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698921"><span class="hs-identifier hs-var">mk_op_doc</span></a><span> </span><a href="#local-6989586621681698923"><span class="hs-identifier hs-var">op_name</span></a><span> </span><a href="#local-6989586621681698924"><span class="hs-identifier hs-var">rdr_ty</span></a><span>
</span><a name="line-765"></a><span>          </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698927"><a href="#local-6989586621681698927"><span class="hs-identifier">op_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698926"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ty&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698924"><span class="hs-identifier hs-var">rdr_ty</span></a><span>
</span><a name="line-766"></a><span>                </span><span class="hs-comment">-- Must be done lazily for just the same reason as the</span><span>
</span><a name="line-767"></a><span>                </span><span class="hs-comment">-- type of a data con; to avoid sucking in types that</span><span>
</span><a name="line-768"></a><span>                </span><span class="hs-comment">-- it mentions unless it's necessary to do so</span><span>
</span><a name="line-769"></a><span>          </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698928"><a href="#local-6989586621681698928"><span class="hs-identifier">dm'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698917"><span class="hs-identifier hs-var">tc_dm</span></a><span> </span><a href="#local-6989586621681698926"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621681698925"><span class="hs-identifier hs-var">dm</span></a><span>
</span><a name="line-770"></a><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698923"><span class="hs-identifier hs-var">op_name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698927"><span class="hs-identifier hs-var">op_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698928"><span class="hs-identifier hs-var">dm'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><span>   </span><span class="hs-identifier">tc_dm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-773"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DefMethSpec</span><span> </span><span class="hs-identifier hs-type">IfaceType</span><span class="hs-special">)</span><span>
</span><a name="line-774"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DefMethSpec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SrcSpan</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-775"></a><span>   </span><a name="local-6989586621681698917"><a href="#local-6989586621681698917"><span class="hs-identifier">tc_dm</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier hs-var">Nothing</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-776"></a><span>   </span><span class="hs-identifier">tc_dm</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">VanillaDM</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">VanillaDM</span><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>   </span><span class="hs-identifier">tc_dm</span><span> </span><a name="local-6989586621681698929"><a href="#local-6989586621681698929"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GenericDM</span><span> </span><a name="local-6989586621681698930"><a href="#local-6989586621681698930"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-778"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Must be done lazily to avoid sucking in types</span><span>
</span><a name="line-779"></a><span>             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698931"><a href="#local-6989586621681698931"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698929"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;dm&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698930"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-780"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GenericDM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noSrcSpan</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698931"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-781"></a><span>
</span><a name="line-782"></a><span>   </span><a name="local-6989586621681698918"><a href="#local-6989586621681698918"><span class="hs-identifier">tc_at</span></a></a><span> </span><a name="local-6989586621681698932"><a href="#local-6989586621681698932"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceAT</span><span> </span><a name="local-6989586621681698933"><a href="#local-6989586621681698933"><span class="hs-identifier">tc_decl</span></a></a><span> </span><a name="local-6989586621681698934"><a href="#local-6989586621681698934"><span class="hs-identifier">if_def</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">ATyCon</span><span> </span><a name="local-6989586621681698935"><a href="#local-6989586621681698935"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tc_iface_decl"><span class="hs-identifier hs-var">tc_iface_decl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681698932"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698906"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><a href="#local-6989586621681698933"><span class="hs-identifier hs-var">tc_decl</span></a><span>
</span><a name="line-784"></a><span>          </span><a name="local-6989586621681698938"><a href="#local-6989586621681698938"><span class="hs-identifier">mb_def</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681698934"><span class="hs-identifier hs-var">if_def</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-785"></a><span>                      </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-786"></a><span>                      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681698936"><a href="#local-6989586621681698936"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698920"><span class="hs-identifier hs-var">mk_at_doc</span></a><span> </span><a href="#local-6989586621681698935"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>                 </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-787"></a><span>                                  </span><a href="IfaceEnv.html#extendIfaceTyVarEnv"><span class="hs-identifier hs-var">extendIfaceTyVarEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621681698935"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-788"></a><span>                                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698937"><a href="#local-6989586621681698937"><span class="hs-identifier">tc_def</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698936"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-789"></a><span>                                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698937"><span class="hs-identifier hs-var">tc_def</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">noSrcSpan</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-790"></a><span>                  </span><span class="hs-comment">-- Must be done lazily in case the RHS of the defaults mention</span><span>
</span><a name="line-791"></a><span>                  </span><span class="hs-comment">-- the type constructor being defined here</span><span>
</span><a name="line-792"></a><span>                  </span><span class="hs-comment">-- e.g.   type AT a; type AT b = AT [b]   Trac #8002</span><span>
</span><a name="line-793"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ATI</span><span> </span><a href="#local-6989586621681698935"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681698938"><span class="hs-identifier hs-var">mb_def</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span>   </span><a name="local-6989586621681698919"><a href="#local-6989586621681698919"><span class="hs-identifier">mk_sc_doc</span></a></a><span> </span><a name="local-6989586621681698939"><a href="#local-6989586621681698939"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Superclass&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698939"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-796"></a><span>   </span><a name="local-6989586621681698920"><a href="#local-6989586621681698920"><span class="hs-identifier">mk_at_doc</span></a></a><span> </span><a name="local-6989586621681698940"><a href="#local-6989586621681698940"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Associated type&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698940"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-797"></a><span>   </span><a name="local-6989586621681698921"><a href="#local-6989586621681698921"><span class="hs-identifier">mk_op_doc</span></a></a><span> </span><a name="local-6989586621681698941"><a href="#local-6989586621681698941"><span class="hs-identifier">op_name</span></a></a><span> </span><a name="local-6989586621681698942"><a href="#local-6989586621681698942"><span class="hs-identifier">op_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Class op&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698941"><span class="hs-identifier hs-var">op_name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698942"><span class="hs-identifier hs-var">op_ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span class="hs-identifier">tc_iface_decl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceAxiom</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698951"><a href="#local-6989586621681698951"><span class="hs-identifier">tc_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifTyCon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698952"><a href="#local-6989586621681698952"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-800"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifAxBranches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698953"><a href="#local-6989586621681698953"><span class="hs-identifier">branches</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRole</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">role</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-801"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698955"><a href="#local-6989586621681698955"><span class="hs-identifier">tc_tycon</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceTyCon"><span class="hs-identifier hs-var">tcIfaceTyCon</span></a><span> </span><a href="#local-6989586621681698952"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-802"></a><span>       </span><span class="hs-comment">-- Must be done lazily, because axioms are forced when checking</span><span>
</span><a name="line-803"></a><span>       </span><span class="hs-comment">-- for family instance consistency, and the RHS may mention</span><span>
</span><a name="line-804"></a><span>       </span><span class="hs-comment">-- a hs-boot declared type constructor that is going to be</span><span>
</span><a name="line-805"></a><span>       </span><span class="hs-comment">-- defined by this module.</span><span>
</span><a name="line-806"></a><span>       </span><span class="hs-comment">-- e.g. type instance F Int = ToBeDefined</span><span>
</span><a name="line-807"></a><span>       </span><span class="hs-comment">-- See Trac #13803</span><span>
</span><a name="line-808"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698956"><a href="#local-6989586621681698956"><span class="hs-identifier">tc_branches</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Axiom branches&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698951"><span class="hs-identifier hs-var">tc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-809"></a><span>                      </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcIface.html#tc_ax_branches"><span class="hs-identifier hs-var">tc_ax_branches</span></a><span> </span><a href="#local-6989586621681698953"><span class="hs-identifier hs-var">branches</span></a><span>
</span><a name="line-810"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681698957"><a href="#local-6989586621681698957"><span class="hs-identifier">axiom</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CoAxiom</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">co_ax_unique</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nameUnique</span><span> </span><a href="#local-6989586621681698951"><span class="hs-identifier hs-var">tc_name</span></a><span>
</span><a name="line-811"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">co_ax_name</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698951"><span class="hs-identifier hs-var">tc_name</span></a><span>
</span><a name="line-812"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">co_ax_tc</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698955"><span class="hs-identifier hs-var">tc_tycon</span></a><span>
</span><a name="line-813"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">co_ax_role</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">role</span><span>
</span><a name="line-814"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">co_ax_branches</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">manyBranches</span><span> </span><a href="#local-6989586621681698956"><span class="hs-identifier hs-var">tc_branches</span></a><span>
</span><a name="line-815"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">co_ax_implicit</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-816"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ACoAxiom</span><span> </span><a href="#local-6989586621681698957"><span class="hs-identifier hs-var">axiom</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-817"></a><span>
</span><a name="line-818"></a><span class="hs-identifier">tc_iface_decl</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfacePatSyn</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698958"><a href="#local-6989586621681698958"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-819"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatMatcher</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698959"><a href="#local-6989586621681698959"><span class="hs-identifier">if_matcher</span></a></a><span>
</span><a name="line-820"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatBuilder</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698960"><a href="#local-6989586621681698960"><span class="hs-identifier">if_builder</span></a></a><span>
</span><a name="line-821"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatIsInfix</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698961"><a href="#local-6989586621681698961"><span class="hs-identifier">is_infix</span></a></a><span>
</span><a name="line-822"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatUnivBndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698962"><a href="#local-6989586621681698962"><span class="hs-identifier">univ_bndrs</span></a></a><span>
</span><a name="line-823"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatExBndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698963"><a href="#local-6989586621681698963"><span class="hs-identifier">ex_bndrs</span></a></a><span>
</span><a name="line-824"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatProvCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698964"><a href="#local-6989586621681698964"><span class="hs-identifier">prov_ctxt</span></a></a><span>
</span><a name="line-825"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatReqCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698965"><a href="#local-6989586621681698965"><span class="hs-identifier">req_ctxt</span></a></a><span>
</span><a name="line-826"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatArgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698966"><a href="#local-6989586621681698966"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-827"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatTy</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698967"><a href="#local-6989586621681698967"><span class="hs-identifier">pat_ty</span></a></a><span>
</span><a name="line-828"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifFieldLabels</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698968"><a href="#local-6989586621681698968"><span class="hs-identifier">field_labels</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-829"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;tc_iface_decl&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698958"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-830"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698975"><a href="#local-6989586621681698975"><span class="hs-identifier">matcher</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681698970"><span class="hs-identifier hs-var">tc_pr</span></a><span> </span><a href="#local-6989586621681698959"><span class="hs-identifier hs-var">if_matcher</span></a><span>
</span><a name="line-831"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698976"><a href="#local-6989586621681698976"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmapMaybeM</span><span> </span><a href="#local-6989586621681698970"><span class="hs-identifier hs-var">tc_pr</span></a><span> </span><a href="#local-6989586621681698960"><span class="hs-identifier hs-var">if_builder</span></a><span>
</span><a name="line-832"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcIface.html#bindIfaceForAllBndrs"><span class="hs-identifier hs-var">bindIfaceForAllBndrs</span></a><span> </span><a href="#local-6989586621681698962"><span class="hs-identifier hs-var">univ_bndrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681698977"><a href="#local-6989586621681698977"><span class="hs-identifier">univ_tvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-833"></a><span>       </span><span class="hs-special">{</span><span> </span><a href="TcIface.html#bindIfaceForAllBndrs"><span class="hs-identifier hs-var">bindIfaceForAllBndrs</span></a><span> </span><a href="#local-6989586621681698963"><span class="hs-identifier hs-var">ex_bndrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681698978"><a href="#local-6989586621681698978"><span class="hs-identifier">ex_tvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-834"></a><span>       </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698983"><a href="#local-6989586621681698983"><span class="hs-identifier">patsyn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698969"><span class="hs-identifier hs-var">mk_doc</span></a><span> </span><a href="#local-6989586621681698958"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-835"></a><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698979"><a href="#local-6989586621681698979"><span class="hs-identifier">prov_theta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCtxt"><span class="hs-identifier hs-var">tcIfaceCtxt</span></a><span> </span><a href="#local-6989586621681698964"><span class="hs-identifier hs-var">prov_ctxt</span></a><span>
</span><a name="line-836"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698980"><a href="#local-6989586621681698980"><span class="hs-identifier">req_theta</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCtxt"><span class="hs-identifier hs-var">tcIfaceCtxt</span></a><span> </span><a href="#local-6989586621681698965"><span class="hs-identifier hs-var">req_ctxt</span></a><span>
</span><a name="line-837"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698981"><a href="#local-6989586621681698981"><span class="hs-identifier">pat_ty</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698967"><span class="hs-identifier hs-var">pat_ty</span></a><span>
</span><a name="line-838"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698982"><a href="#local-6989586621681698982"><span class="hs-identifier">arg_tys</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698966"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-839"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="BuildTyCl.html#buildPatSyn"><span class="hs-identifier hs-var">buildPatSyn</span></a><span> </span><a href="#local-6989586621681698958"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681698961"><span class="hs-identifier hs-var">is_infix</span></a><span> </span><a href="#local-6989586621681698975"><span class="hs-identifier hs-var">matcher</span></a><span> </span><a href="#local-6989586621681698976"><span class="hs-identifier hs-var">builder</span></a><span>
</span><a name="line-840"></a><span>                                       </span><span class="hs-special">(</span><a href="#local-6989586621681698977"><span class="hs-identifier hs-var">univ_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698980"><span class="hs-identifier hs-var">req_theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-841"></a><span>                                       </span><span class="hs-special">(</span><a href="#local-6989586621681698978"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698979"><span class="hs-identifier hs-var">prov_theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-842"></a><span>                                       </span><a href="#local-6989586621681698982"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-6989586621681698981"><span class="hs-identifier hs-var">pat_ty</span></a><span> </span><a href="#local-6989586621681698968"><span class="hs-identifier hs-var">field_labels</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-843"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">AConLike</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">PatSynCon</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621681698983"><span class="hs-identifier hs-var">patsyn</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-844"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-845"></a><span>     </span><a name="local-6989586621681698969"><a href="#local-6989586621681698969"><span class="hs-identifier">mk_doc</span></a></a><span> </span><a name="local-6989586621681698971"><a href="#local-6989586621681698971"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Pattern synonym&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698971"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-846"></a><span>     </span><span class="hs-identifier">tc_pr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IfExtName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-847"></a><span>     </span><a name="local-6989586621681698970"><a href="#local-6989586621681698970"><span class="hs-identifier">tc_pr</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681698972"><a href="#local-6989586621681698972"><span class="hs-identifier">nm</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681698973"><a href="#local-6989586621681698973"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698974"><a href="#local-6989586621681698974"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681698972"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcIface.html#tcIfaceExtId"><span class="hs-identifier hs-var">tcIfaceExtId</span></a><span> </span><a href="#local-6989586621681698972"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">)</span><span>
</span><a name="line-848"></a><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698974"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698973"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-849"></a><span>
</span><a name="line-850"></a><span class="hs-identifier">tc_fd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FunDep</span><span> </span><span class="hs-identifier hs-type">IfLclName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FunDep</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">)</span><span>
</span><a name="line-851"></a><a name="tc_fd"><a href="TcIface.html#tc_fd"><span class="hs-identifier">tc_fd</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681698984"><a href="#local-6989586621681698984"><span class="hs-identifier">tvs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681698985"><a href="#local-6989586621681698985"><span class="hs-identifier">tvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681698986"><a href="#local-6989586621681698986"><span class="hs-identifier">tvs1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="IfaceEnv.html#tcIfaceTyVar"><span class="hs-identifier hs-var">tcIfaceTyVar</span></a><span> </span><a href="#local-6989586621681698984"><span class="hs-identifier hs-var">tvs1</span></a><span>
</span><a name="line-852"></a><span>                        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681698987"><a href="#local-6989586621681698987"><span class="hs-identifier">tvs2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="IfaceEnv.html#tcIfaceTyVar"><span class="hs-identifier hs-var">tcIfaceTyVar</span></a><span> </span><a href="#local-6989586621681698985"><span class="hs-identifier hs-var">tvs2</span></a><span>
</span><a name="line-853"></a><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698986"><span class="hs-identifier hs-var">tvs1'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681698987"><span class="hs-identifier hs-var">tvs2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-854"></a><span>
</span><a name="line-855"></a><span class="hs-identifier">tc_ax_branches</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceAxBranch</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoAxBranch</span><span class="hs-special">]</span><span>
</span><a name="line-856"></a><a name="tc_ax_branches"><a href="TcIface.html#tc_ax_branches"><span class="hs-identifier">tc_ax_branches</span></a></a><span> </span><a name="local-6989586621681698988"><a href="#local-6989586621681698988"><span class="hs-identifier">if_branches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldlM</span><span> </span><a href="TcIface.html#tc_ax_branch"><span class="hs-identifier hs-var">tc_ax_branch</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621681698988"><span class="hs-identifier hs-var">if_branches</span></a><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span class="hs-identifier">tc_ax_branch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoAxBranch</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceAxBranch</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoAxBranch</span><span class="hs-special">]</span><span>
</span><a name="line-859"></a><a name="tc_ax_branch"><a href="TcIface.html#tc_ax_branch"><span class="hs-identifier">tc_ax_branch</span></a></a><span> </span><a name="local-6989586621681698989"><a href="#local-6989586621681698989"><span class="hs-identifier">prev_branches</span></a></a><span>
</span><a name="line-860"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceAxBranch</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifaxbTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698990"><a href="#local-6989586621681698990"><span class="hs-identifier">tv_bndrs</span></a></a><span>
</span><a name="line-861"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbEtaTyVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698991"><a href="#local-6989586621681698991"><span class="hs-identifier">eta_tv_bndrs</span></a></a><span>
</span><a name="line-862"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbCoVars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698992"><a href="#local-6989586621681698992"><span class="hs-identifier">cv_bndrs</span></a></a><span>
</span><a name="line-863"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbLHS</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698993"><a href="#local-6989586621681698993"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbRHS</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698994"><a href="#local-6989586621681698994"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-864"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbRoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698995"><a href="#local-6989586621681698995"><span class="hs-identifier">roles</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbIncomps</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681698996"><a href="#local-6989586621681698996"><span class="hs-identifier">incomps</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-865"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyConBinders_AT"><span class="hs-identifier hs-var">bindIfaceTyConBinders_AT</span></a><span>
</span><a name="line-866"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621681698997"><a href="#local-6989586621681698997"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Bndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTvBndr</span><span> </span><a href="#local-6989586621681698997"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NamedTCB</span><span> </span><span class="hs-identifier hs-var">Inferred</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698990"><span class="hs-identifier hs-var">tv_bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698998"><a href="#local-6989586621681698998"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-867"></a><span>         </span><span class="hs-comment">-- The _AT variant is needed here; see Note [CoAxBranch type variables] in CoAxiom</span><span>
</span><a name="line-868"></a><span>    </span><a href="TcIface.html#bindIfaceIds"><span class="hs-identifier hs-var">bindIfaceIds</span></a><span> </span><a href="#local-6989586621681698992"><span class="hs-identifier hs-var">cv_bndrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681698999"><a href="#local-6989586621681698999"><span class="hs-identifier">cvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-869"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699000"><a href="#local-6989586621681699000"><span class="hs-identifier">tc_lhs</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceAppArgs"><span class="hs-identifier hs-var">tcIfaceAppArgs</span></a><span> </span><a href="#local-6989586621681698993"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-870"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699001"><a href="#local-6989586621681699001"><span class="hs-identifier">tc_rhs</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681698994"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-871"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699002"><a href="#local-6989586621681699002"><span class="hs-identifier">eta_tvs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#bindIfaceTyVars"><span class="hs-identifier hs-var">bindIfaceTyVars</span></a><span> </span><a href="#local-6989586621681698991"><span class="hs-identifier hs-var">eta_tv_bndrs</span></a><span> </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-872"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699003"><a href="#local-6989586621681699003"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getIfModule"><span class="hs-identifier hs-var">getIfModule</span></a><span>
</span><a name="line-873"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699004"><a href="#local-6989586621681699004"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkGeneralSrcSpan</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;module &quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appendFS</span><span class="hs-special">`</span><span>
</span><a name="line-874"></a><span>                                  </span><span class="hs-identifier hs-var">moduleNameFS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621681699003"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-875"></a><span>          </span><a name="local-6989586621681699005"><a href="#local-6989586621681699005"><span class="hs-identifier">br</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CoAxBranch</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cab_loc</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699004"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-876"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_tvs</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">binderVars</span><span> </span><a href="#local-6989586621681698998"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-877"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_eta_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699002"><span class="hs-identifier hs-var">eta_tvs</span></a><span>
</span><a name="line-878"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_cvs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698999"><span class="hs-identifier hs-var">cvs</span></a><span>
</span><a name="line-879"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_lhs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699000"><span class="hs-identifier hs-var">tc_lhs</span></a><span>
</span><a name="line-880"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_roles</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681698995"><span class="hs-identifier hs-var">roles</span></a><span>
</span><a name="line-881"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_rhs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699001"><span class="hs-identifier hs-var">tc_rhs</span></a><span>
</span><a name="line-882"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_incomps</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698989"><span class="hs-identifier hs-var">prev_branches</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">getNth</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681698996"><span class="hs-identifier hs-var">incomps</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-883"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681698989"><span class="hs-identifier hs-var">prev_branches</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681699005"><span class="hs-identifier hs-var">br</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-884"></a><span>
</span><a name="line-885"></a><span class="hs-identifier">tcIfaceDataCons</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyConBinder</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceConDecls</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">AlgTyConRhs</span><span>
</span><a name="line-886"></a><a name="tcIfaceDataCons"><a href="TcIface.html#tcIfaceDataCons"><span class="hs-identifier">tcIfaceDataCons</span></a></a><span> </span><a name="local-6989586621681699006"><a href="#local-6989586621681699006"><span class="hs-identifier">tycon_name</span></a></a><span> </span><a name="local-6989586621681699007"><a href="#local-6989586621681699007"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621681699008"><a href="#local-6989586621681699008"><span class="hs-identifier">tc_tybinders</span></a></a><span> </span><a name="local-6989586621681699009"><a href="#local-6989586621681699009"><span class="hs-identifier">if_cons</span></a></a><span>
</span><a name="line-887"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699009"><span class="hs-identifier hs-var">if_cons</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-888"></a><span>        </span><span class="hs-identifier hs-var">IfAbstractTyCon</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">AbstractTyCon</span><span>
</span><a name="line-889"></a><span>        </span><span class="hs-identifier hs-var">IfDataTyCon</span><span> </span><a name="local-6989586621681699048"><a href="#local-6989586621681699048"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699049"><a href="#local-6989586621681699049"><span class="hs-identifier">data_cons</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681699012"><span class="hs-identifier hs-var">tc_con_decl</span></a><span> </span><a href="#local-6989586621681699048"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-890"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkDataTyConRhs</span><span> </span><a href="#local-6989586621681699049"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-891"></a><span>        </span><span class="hs-identifier hs-var">IfNewTyCon</span><span>  </span><a name="local-6989586621681699050"><a href="#local-6989586621681699050"><span class="hs-identifier">con</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699051"><a href="#local-6989586621681699051"><span class="hs-identifier">data_con</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681699012"><span class="hs-identifier hs-var">tc_con_decl</span></a><span> </span><a href="#local-6989586621681699050"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-892"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="BuildTyCl.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a><span> </span><a href="#local-6989586621681699006"><span class="hs-identifier hs-var">tycon_name</span></a><span> </span><a href="#local-6989586621681699007"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621681699051"><span class="hs-identifier hs-var">data_con</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-893"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-894"></a><span>    </span><span class="hs-identifier">univ_tvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span>
</span><a name="line-895"></a><span>    </span><a name="local-6989586621681699010"><a href="#local-6989586621681699010"><span class="hs-identifier">univ_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">binderVars</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConTyVarBinders</span><span> </span><a href="#local-6989586621681699008"><span class="hs-identifier hs-var">tc_tybinders</span></a><span class="hs-special">)</span><span>
</span><a name="line-896"></a><span>
</span><a name="line-897"></a><span>    </span><span class="hs-identifier">tag_map</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NameEnv</span><span> </span><span class="hs-identifier hs-type">ConTag</span><span>
</span><a name="line-898"></a><span>    </span><a name="local-6989586621681699011"><a href="#local-6989586621681699011"><span class="hs-identifier">tag_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTyConTagMap</span><span> </span><a href="#local-6989586621681699007"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-899"></a><span>
</span><a name="line-900"></a><span>    </span><a name="local-6989586621681699012"><a href="#local-6989586621681699012"><span class="hs-identifier">tc_con_decl</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfCon</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifConInfix</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699016"><a href="#local-6989586621681699016"><span class="hs-identifier">is_infix</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-901"></a><span>                         </span><span class="hs-identifier">ifConExTCvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699017"><a href="#local-6989586621681699017"><span class="hs-identifier">ex_bndrs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-902"></a><span>                         </span><span class="hs-identifier">ifConUserTvBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699018"><a href="#local-6989586621681699018"><span class="hs-identifier">user_bndrs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-903"></a><span>                         </span><span class="hs-identifier">ifConName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699019"><a href="#local-6989586621681699019"><span class="hs-identifier">dc_name</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-904"></a><span>                         </span><span class="hs-identifier">ifConCtxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699020"><a href="#local-6989586621681699020"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifConEqSpec</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699021"><a href="#local-6989586621681699021"><span class="hs-identifier">spec</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-905"></a><span>                         </span><span class="hs-identifier">ifConArgTys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699022"><a href="#local-6989586621681699022"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifConFields</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699023"><a href="#local-6989586621681699023"><span class="hs-identifier">lbl_names</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-906"></a><span>                         </span><span class="hs-identifier">ifConStricts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699024"><a href="#local-6989586621681699024"><span class="hs-identifier">if_stricts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-907"></a><span>                         </span><span class="hs-identifier">ifConSrcStricts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699025"><a href="#local-6989586621681699025"><span class="hs-identifier">if_src_stricts</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-908"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Universally-quantified tyvars are shared with</span><span>
</span><a name="line-909"></a><span>       </span><span class="hs-comment">-- parent TyCon, and are already in scope</span><span>
</span><a name="line-910"></a><span>       </span><a href="TcIface.html#bindIfaceBndrs"><span class="hs-identifier hs-var">bindIfaceBndrs</span></a><span> </span><a href="#local-6989586621681699017"><span class="hs-identifier hs-var">ex_bndrs</span></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699026"><a href="#local-6989586621681699026"><span class="hs-identifier">ex_tvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-911"></a><span>        </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Start interface-file tc_con_decl&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699019"><span class="hs-identifier hs-var">dc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-912"></a><span>
</span><a name="line-913"></a><span>          </span><span class="hs-comment">-- By this point, we have bound every universal and existential</span><span>
</span><a name="line-914"></a><span>          </span><span class="hs-comment">-- tyvar. Because of the dcUserTyVarBinders invariant</span><span>
</span><a name="line-915"></a><span>          </span><span class="hs-comment">-- (see Note [DataCon user type variable binders]), *every* tyvar in</span><span>
</span><a name="line-916"></a><span>          </span><span class="hs-comment">-- ifConUserTvBinders has a matching counterpart somewhere in the</span><span>
</span><a name="line-917"></a><span>          </span><span class="hs-comment">-- bound universals/existentials. As a result, calling tcIfaceTyVar</span><span>
</span><a name="line-918"></a><span>          </span><span class="hs-comment">-- below is always guaranteed to succeed.</span><span>
</span><a name="line-919"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699031"><a href="#local-6989586621681699031"><span class="hs-identifier">user_tv_bndrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><a name="local-6989586621681699027"><a href="#local-6989586621681699027"><span class="hs-identifier">bd</span></a></a><span> </span><a name="local-6989586621681699028"><a href="#local-6989586621681699028"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-920"></a><span>                                   </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699027"><span class="hs-identifier hs-var">bd</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-921"></a><span>                                     </span><span class="hs-identifier hs-var">IfaceIdBndr</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699029"><a href="#local-6989586621681699029"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-922"></a><span>                                       </span><span class="hs-identifier hs-var">Bndr</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="IfaceEnv.html#tcIfaceLclId"><span class="hs-identifier hs-var">tcIfaceLclId</span></a><span> </span><a href="#local-6989586621681699029"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621681699028"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-923"></a><span>                                     </span><span class="hs-identifier hs-var">IfaceTvBndr</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699030"><a href="#local-6989586621681699030"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-924"></a><span>                                       </span><span class="hs-identifier hs-var">Bndr</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="IfaceEnv.html#tcIfaceTyVar"><span class="hs-identifier hs-var">tcIfaceTyVar</span></a><span> </span><a href="#local-6989586621681699030"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621681699028"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span>
</span><a name="line-925"></a><span>                                </span><a href="#local-6989586621681699018"><span class="hs-identifier hs-var">user_bndrs</span></a><span>
</span><a name="line-926"></a><span>
</span><a name="line-927"></a><span>        </span><span class="hs-comment">-- Read the context and argument types, but lazily for two reasons</span><span>
</span><a name="line-928"></a><span>        </span><span class="hs-comment">-- (a) to avoid looking tugging on a recursive use of</span><span>
</span><a name="line-929"></a><span>        </span><span class="hs-comment">--     the type itself, which is knot-tied</span><span>
</span><a name="line-930"></a><span>        </span><span class="hs-comment">-- (b) to avoid faulting in the component types unless</span><span>
</span><a name="line-931"></a><span>        </span><span class="hs-comment">--     they are really needed</span><span>
</span><a name="line-932"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621681699036"><a href="#local-6989586621681699036"><span class="hs-identifier">eq_spec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699037"><a href="#local-6989586621681699037"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699038"><a href="#local-6989586621681699038"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699039"><a href="#local-6989586621681699039"><span class="hs-identifier">stricts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699013"><span class="hs-identifier hs-var">mk_doc</span></a><span> </span><a href="#local-6989586621681699019"><span class="hs-identifier hs-var">dc_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-933"></a><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699032"><a href="#local-6989586621681699032"><span class="hs-identifier">eq_spec</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceEqSpec"><span class="hs-identifier hs-var">tcIfaceEqSpec</span></a><span> </span><a href="#local-6989586621681699021"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-934"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699033"><a href="#local-6989586621681699033"><span class="hs-identifier">theta</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCtxt"><span class="hs-identifier hs-var">tcIfaceCtxt</span></a><span> </span><a href="#local-6989586621681699020"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-935"></a><span>                </span><span class="hs-comment">-- This fixes #13710.  The enclosing lazy thunk gets</span><span>
</span><a name="line-936"></a><span>                </span><span class="hs-comment">-- forced when typechecking record wildcard pattern</span><span>
</span><a name="line-937"></a><span>                </span><span class="hs-comment">-- matching (it's not completely clear why this</span><span>
</span><a name="line-938"></a><span>                </span><span class="hs-comment">-- tuple is needed), which causes trouble if one of</span><span>
</span><a name="line-939"></a><span>                </span><span class="hs-comment">-- the argument types was recursively defined.</span><span>
</span><a name="line-940"></a><span>                </span><span class="hs-comment">-- See also Note [Tying the knot]</span><span>
</span><a name="line-941"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699034"><a href="#local-6989586621681699034"><span class="hs-identifier">arg_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699013"><span class="hs-identifier hs-var">mk_doc</span></a><span> </span><a href="#local-6989586621681699019"><span class="hs-identifier hs-var">dc_name</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;arg_tys&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-942"></a><span>                           </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699022"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-943"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699035"><a href="#local-6989586621681699035"><span class="hs-identifier">stricts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681699014"><span class="hs-identifier hs-var">tc_strict</span></a><span> </span><a href="#local-6989586621681699024"><span class="hs-identifier hs-var">if_stricts</span></a><span>
</span><a name="line-944"></a><span>                        </span><span class="hs-comment">-- The IfBang field can mention</span><span>
</span><a name="line-945"></a><span>                        </span><span class="hs-comment">-- the type itself; hence inside forkM</span><span>
</span><a name="line-946"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699032"><span class="hs-identifier hs-var">eq_spec</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699033"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699034"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699035"><span class="hs-identifier hs-var">stricts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span>        </span><span class="hs-comment">-- Remember, tycon is the representation tycon</span><span>
</span><a name="line-949"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699040"><a href="#local-6989586621681699040"><span class="hs-identifier">orig_res_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkFamilyTyConApp</span><span> </span><a href="#local-6989586621681699007"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-950"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">substTyCoVars</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTvSubstPrs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">eqSpecPair</span><span> </span><a href="#local-6989586621681699036"><span class="hs-identifier hs-var">eq_spec</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-951"></a><span>                                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">binderVars</span><span> </span><a href="#local-6989586621681699008"><span class="hs-identifier hs-var">tc_tybinders</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-952"></a><span>
</span><a name="line-953"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699041"><a href="#local-6989586621681699041"><span class="hs-identifier">prom_rep_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a><span> </span><a href="#local-6989586621681699019"><span class="hs-identifier hs-var">dc_name</span></a><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699042"><a href="#local-6989586621681699042"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BuildTyCl.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tcIfaceDataCons: FamInstEnvs&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699019"><span class="hs-identifier hs-var">dc_name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-956"></a><span>                       </span><a href="#local-6989586621681699019"><span class="hs-identifier hs-var">dc_name</span></a><span> </span><a href="#local-6989586621681699016"><span class="hs-identifier hs-var">is_infix</span></a><span> </span><a href="#local-6989586621681699041"><span class="hs-identifier hs-var">prom_rep_name</span></a><span>
</span><a name="line-957"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681699015"><span class="hs-identifier hs-var">src_strict</span></a><span> </span><a href="#local-6989586621681699025"><span class="hs-identifier hs-var">if_src_stricts</span></a><span class="hs-special">)</span><span>
</span><a name="line-958"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681699039"><span class="hs-identifier hs-var">stricts</span></a><span class="hs-special">)</span><span>
</span><a name="line-959"></a><span>                       </span><span class="hs-comment">-- Pass the HsImplBangs (i.e. final</span><span>
</span><a name="line-960"></a><span>                       </span><span class="hs-comment">-- decisions) to buildDataCon; it'll use</span><span>
</span><a name="line-961"></a><span>                       </span><span class="hs-comment">-- these to guide the construction of a</span><span>
</span><a name="line-962"></a><span>                       </span><span class="hs-comment">-- worker.</span><span>
</span><a name="line-963"></a><span>                       </span><span class="hs-comment">-- See Note [Bangs on imported data constructors] in MkId</span><span>
</span><a name="line-964"></a><span>                       </span><a href="#local-6989586621681699023"><span class="hs-identifier hs-var">lbl_names</span></a><span>
</span><a name="line-965"></a><span>                       </span><a href="#local-6989586621681699010"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="#local-6989586621681699026"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><a href="#local-6989586621681699031"><span class="hs-identifier hs-var">user_tv_bndrs</span></a><span>
</span><a name="line-966"></a><span>                       </span><a href="#local-6989586621681699036"><span class="hs-identifier hs-var">eq_spec</span></a><span> </span><a href="#local-6989586621681699037"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-967"></a><span>                       </span><a href="#local-6989586621681699038"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-6989586621681699040"><span class="hs-identifier hs-var">orig_res_ty</span></a><span> </span><a href="#local-6989586621681699007"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621681699011"><span class="hs-identifier hs-var">tag_map</span></a><span>
</span><a name="line-968"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Done interface-file tc_con_decl&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699019"><span class="hs-identifier hs-var">dc_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-969"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699042"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-970"></a><span>    </span><a name="local-6989586621681699013"><a href="#local-6989586621681699013"><span class="hs-identifier">mk_doc</span></a></a><span> </span><a name="local-6989586621681699043"><a href="#local-6989586621681699043"><span class="hs-identifier">con_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Constructor&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699043"><span class="hs-identifier hs-var">con_name</span></a><span>
</span><a name="line-971"></a><span>
</span><a name="line-972"></a><span>    </span><span class="hs-identifier">tc_strict</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceBang</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">HsImplBang</span><span>
</span><a name="line-973"></a><span>    </span><a name="local-6989586621681699014"><a href="#local-6989586621681699014"><span class="hs-identifier">tc_strict</span></a></a><span> </span><span class="hs-identifier hs-var">IfNoBang</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLazy</span><span class="hs-special">)</span><span>
</span><a name="line-974"></a><span>    </span><span class="hs-identifier">tc_strict</span><span> </span><span class="hs-identifier hs-var">IfStrict</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsStrict</span><span class="hs-special">)</span><span>
</span><a name="line-975"></a><span>    </span><span class="hs-identifier">tc_strict</span><span> </span><span class="hs-identifier hs-var">IfUnpack</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsUnpack</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-976"></a><span>    </span><span class="hs-identifier">tc_strict</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfUnpackCo</span><span> </span><a name="local-6989586621681699044"><a href="#local-6989586621681699044"><span class="hs-identifier">if_co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699045"><a href="#local-6989586621681699045"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceCo"><span class="hs-identifier hs-var">tcIfaceCo</span></a><span> </span><a href="#local-6989586621681699044"><span class="hs-identifier hs-var">if_co</span></a><span>
</span><a name="line-977"></a><span>                                      </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsUnpack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681699045"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span>    </span><span class="hs-identifier">src_strict</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceSrcBang</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsSrcBang</span><span>
</span><a name="line-980"></a><span>    </span><a name="local-6989586621681699015"><a href="#local-6989586621681699015"><span class="hs-identifier">src_strict</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfSrcBang</span><span> </span><a name="local-6989586621681699046"><a href="#local-6989586621681699046"><span class="hs-identifier">unpk</span></a></a><span> </span><a name="local-6989586621681699047"><a href="#local-6989586621681699047"><span class="hs-identifier">bang</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsSrcBang</span><span> </span><span class="hs-identifier hs-var">NoSourceText</span><span> </span><a href="#local-6989586621681699046"><span class="hs-identifier hs-var">unpk</span></a><span> </span><a href="#local-6989586621681699047"><span class="hs-identifier hs-var">bang</span></a><span>
</span><a name="line-981"></a><span>
</span><a name="line-982"></a><span class="hs-identifier">tcIfaceEqSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceEqSpec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">EqSpec</span><span class="hs-special">]</span><span>
</span><a name="line-983"></a><a name="tcIfaceEqSpec"><a href="TcIface.html#tcIfaceEqSpec"><span class="hs-identifier">tcIfaceEqSpec</span></a></a><span> </span><a name="local-6989586621681699052"><a href="#local-6989586621681699052"><span class="hs-identifier">spec</span></a></a><span>
</span><a name="line-984"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681699053"><span class="hs-identifier hs-var">do_item</span></a><span> </span><a href="#local-6989586621681699052"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-985"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-986"></a><span>    </span><a name="local-6989586621681699053"><a href="#local-6989586621681699053"><span class="hs-identifier">do_item</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681699054"><a href="#local-6989586621681699054"><span class="hs-identifier">occ</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699055"><a href="#local-6989586621681699055"><span class="hs-identifier">if_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699056"><a href="#local-6989586621681699056"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#tcIfaceTyVar"><span class="hs-identifier hs-var">tcIfaceTyVar</span></a><span> </span><a href="#local-6989586621681699054"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-987"></a><span>                              </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699057"><a href="#local-6989586621681699057"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699055"><span class="hs-identifier hs-var">if_ty</span></a><span>
</span><a name="line-988"></a><span>                              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkEqSpec</span><span> </span><a href="#local-6989586621681699056"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681699057"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-989"></a><span>
</span><a name="line-990"></a><span class="hs-comment">{-
Note [Synonym kind loop]
~~~~~~~~~~~~~~~~~~~~~~~~
Notice that we eagerly grab the *kind* from the interface file, but
build a forkM thunk for the *rhs* (and family stuff).  To see why,
consider this (Trac #2412)

M.hs:       module M where { import X; data T = MkT S }
X.hs:       module X where { import {-# SOURCE #-} M; type S = T }
M.hs-boot:  module M where { data T }

When kind-checking M.hs we need S's kind.  But we do not want to
find S's kind from (typeKind S-rhs), because we don't want to look at
S-rhs yet!  Since S is imported from X.hi, S gets just one chance to
be defined, and we must not do that until we've finished with M.T.

Solution: record S's kind in the interface file; now we can safely
look at it.

************************************************************************
*                                                                      *
                Instances
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1015"></a><span>
</span><a name="line-1016"></a><span class="hs-identifier">tcIfaceInst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceClsInst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">ClsInst</span><span>
</span><a name="line-1017"></a><a name="tcIfaceInst"><a href="TcIface.html#tcIfaceInst"><span class="hs-identifier">tcIfaceInst</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceClsInst</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifDFun</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699058"><a href="#local-6989586621681699058"><span class="hs-identifier">dfun_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifOFlag</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699059"><a href="#local-6989586621681699059"><span class="hs-identifier">oflag</span></a></a><span>
</span><a name="line-1018"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifInstCls</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699060"><a href="#local-6989586621681699060"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifInstTys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699061"><a href="#local-6989586621681699061"><span class="hs-identifier">mb_tcs</span></a></a><span>
</span><a name="line-1019"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifInstOrph</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699062"><a href="#local-6989586621681699062"><span class="hs-identifier">orph</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1020"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699063"><a href="#local-6989586621681699063"><span class="hs-identifier">dfun</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Dict fun&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699058"><span class="hs-identifier hs-var">dfun_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1021"></a><span>                    </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">tyThingId</span><span> </span><span class="hs-special">(</span><a href="TcIface.html#tcIfaceImplicit"><span class="hs-identifier hs-var">tcIfaceImplicit</span></a><span> </span><a href="#local-6989586621681699058"><span class="hs-identifier hs-var">dfun_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1022"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699064"><a href="#local-6989586621681699064"><span class="hs-identifier">mb_tcs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">ifaceTyConName</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699061"><span class="hs-identifier hs-var">mb_tcs</span></a><span>
</span><a name="line-1023"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkImportedInstance</span><span> </span><a href="#local-6989586621681699060"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621681699064"><span class="hs-identifier hs-var">mb_tcs'</span></a><span> </span><a href="#local-6989586621681699058"><span class="hs-identifier hs-var">dfun_name</span></a><span> </span><a href="#local-6989586621681699063"><span class="hs-identifier hs-var">dfun</span></a><span> </span><a href="#local-6989586621681699059"><span class="hs-identifier hs-var">oflag</span></a><span> </span><a href="#local-6989586621681699062"><span class="hs-identifier hs-var">orph</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1024"></a><span>
</span><a name="line-1025"></a><span class="hs-identifier">tcIfaceFamInst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceFamInst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">FamInst</span><span>
</span><a name="line-1026"></a><a name="tcIfaceFamInst"><a href="TcIface.html#tcIfaceFamInst"><span class="hs-identifier">tcIfaceFamInst</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceFamInst</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifFamInstFam</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699065"><a href="#local-6989586621681699065"><span class="hs-identifier">fam</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifFamInstTys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699066"><a href="#local-6989586621681699066"><span class="hs-identifier">mb_tcs</span></a></a><span>
</span><a name="line-1027"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifFamInstAxiom</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699067"><a href="#local-6989586621681699067"><span class="hs-identifier">axiom_name</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1028"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699068"><a href="#local-6989586621681699068"><span class="hs-identifier">axiom'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Axiom&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699067"><span class="hs-identifier hs-var">axiom_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1029"></a><span>                     </span><a href="TcIface.html#tcIfaceCoAxiom"><span class="hs-identifier hs-var">tcIfaceCoAxiom</span></a><span> </span><a href="#local-6989586621681699067"><span class="hs-identifier hs-var">axiom_name</span></a><span>
</span><a name="line-1030"></a><span>             </span><span class="hs-comment">-- will panic if branched, but that's OK</span><span>
</span><a name="line-1031"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699069"><a href="#local-6989586621681699069"><span class="hs-identifier">axiom''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toUnbranchedAxiom</span><span> </span><a href="#local-6989586621681699068"><span class="hs-identifier hs-var">axiom'</span></a><span>
</span><a name="line-1032"></a><span>               </span><a name="local-6989586621681699070"><a href="#local-6989586621681699070"><span class="hs-identifier">mb_tcs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">ifaceTyConName</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699066"><span class="hs-identifier hs-var">mb_tcs</span></a><span>
</span><a name="line-1033"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkImportedFamInst</span><span> </span><a href="#local-6989586621681699065"><span class="hs-identifier hs-var">fam</span></a><span> </span><a href="#local-6989586621681699070"><span class="hs-identifier hs-var">mb_tcs'</span></a><span> </span><a href="#local-6989586621681699069"><span class="hs-identifier hs-var">axiom''</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1034"></a><span>
</span><a name="line-1035"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Rules
*                                                                      *
************************************************************************

We move a IfaceRule from eps_rules to eps_rule_base when all its LHS free vars
are in the type environment.  However, remember that typechecking a Rule may
(as a side effect) augment the type envt, and so we may need to iterate the process.
-}</span><span>
</span><a name="line-1046"></a><span>
</span><a name="line-1047"></a><span class="hs-identifier">tcIfaceRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>            </span><span class="hs-comment">-- True &lt;=&gt; ignore rules</span><span>
</span><a name="line-1048"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceRule</span><span class="hs-special">]</span><span>
</span><a name="line-1049"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoreRule</span><span class="hs-special">]</span><span>
</span><a name="line-1050"></a><a name="tcIfaceRules"><a href="TcIface.html#tcIfaceRules"><span class="hs-identifier">tcIfaceRules</span></a></a><span> </span><a name="local-6989586621681699071"><a href="#local-6989586621681699071"><span class="hs-identifier">ignore_prags</span></a></a><span> </span><a name="local-6989586621681699072"><a href="#local-6989586621681699072"><span class="hs-identifier">if_rules</span></a></a><span>
</span><a name="line-1051"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681699071"><span class="hs-identifier hs-var">ignore_prags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1052"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceRule"><span class="hs-identifier hs-var">tcIfaceRule</span></a><span> </span><a href="#local-6989586621681699072"><span class="hs-identifier hs-var">if_rules</span></a><span>
</span><a name="line-1053"></a><span>
</span><a name="line-1054"></a><span class="hs-identifier">tcIfaceRule</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceRule</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">CoreRule</span><span>
</span><a name="line-1055"></a><a name="tcIfaceRule"><a href="TcIface.html#tcIfaceRule"><span class="hs-identifier">tcIfaceRule</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceRule</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ifRuleName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699073"><a href="#local-6989586621681699073"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifActivation</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699074"><a href="#local-6989586621681699074"><span class="hs-identifier">act</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRuleBndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699075"><a href="#local-6989586621681699075"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1056"></a><span>                        </span><span class="hs-identifier">ifRuleHead</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699076"><a href="#local-6989586621681699076"><span class="hs-identifier">fn</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRuleArgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699077"><a href="#local-6989586621681699077"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRuleRhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699078"><a href="#local-6989586621681699078"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1057"></a><span>                        </span><span class="hs-identifier">ifRuleAuto</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699079"><a href="#local-6989586621681699079"><span class="hs-identifier">auto</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRuleOrph</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681699080"><a href="#local-6989586621681699080"><span class="hs-identifier">orph</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1058"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621681699090"><a href="#local-6989586621681699090"><span class="hs-identifier">bndrs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699091"><a href="#local-6989586621681699091"><span class="hs-identifier">args'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699092"><a href="#local-6989586621681699092"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1059"></a><span>                </span><span class="hs-comment">-- Typecheck the payload lazily, in the hope it'll never be looked at</span><span>
</span><a name="line-1060"></a><span>                </span><a href="TcRnMonad.html#forkM"><span class="hs-identifier hs-var">forkM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Rule&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprRuleName</span><span> </span><a href="#local-6989586621681699073"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1061"></a><span>                </span><a href="TcIface.html#bindIfaceBndrs"><span class="hs-identifier hs-var">bindIfaceBndrs</span></a><span> </span><a href="#local-6989586621681699075"><span class="hs-identifier hs-var">bndrs</span></a><span>                      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699087"><a href="#local-6989586621681699087"><span class="hs-identifier">bndrs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1062"></a><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699088"><a href="#local-6989586621681699088"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699077"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1063"></a><span>                   </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699089"><a href="#local-6989586621681699089"><span class="hs-identifier">rhs'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699078"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1064"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699087"><span class="hs-identifier hs-var">bndrs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699088"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699089"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1065"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699093"><a href="#local-6989586621681699093"><span class="hs-identifier">mb_tcs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681699081"><span class="hs-identifier hs-var">ifTopFreeName</span></a><span> </span><a href="#local-6989586621681699077"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1066"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699094"><a href="#local-6989586621681699094"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getIfModule"><span class="hs-identifier hs-var">getIfModule</span></a><span>
</span><a name="line-1067"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Rule</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699073"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699076"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_act</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699074"><span class="hs-identifier hs-var">act</span></a><span class="hs-special">,</span><span>
</span><a name="line-1068"></a><span>                          </span><span class="hs-identifier">ru_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699090"><span class="hs-identifier hs-var">bndrs'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699091"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1069"></a><span>                          </span><span class="hs-identifier">ru_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">occurAnalyseExpr</span><span> </span><a href="#local-6989586621681699092"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1070"></a><span>                          </span><span class="hs-identifier">ru_rough</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699093"><span class="hs-identifier hs-var">mb_tcs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1071"></a><span>                          </span><span class="hs-identifier">ru_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699094"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">,</span><span>
</span><a name="line-1072"></a><span>                          </span><span class="hs-identifier">ru_orphan</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699080"><span class="hs-identifier hs-var">orph</span></a><span class="hs-special">,</span><span>
</span><a name="line-1073"></a><span>                          </span><span class="hs-identifier">ru_auto</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699079"><span class="hs-identifier hs-var">auto</span></a><span class="hs-special">,</span><span>
</span><a name="line-1074"></a><span>                          </span><span class="hs-identifier">ru_local</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- An imported RULE is never for a local Id</span><span>
</span><a name="line-1075"></a><span>                                                </span><span class="hs-comment">-- or, even if it is (module loop, perhaps)</span><span>
</span><a name="line-1076"></a><span>                                                </span><span class="hs-comment">-- we'll just leave it in the non-local set</span><span>
</span><a name="line-1077"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1078"></a><span>        </span><span class="hs-comment">-- This function *must* mirror exactly what Rules.roughTopNames does</span><span>
</span><a name="line-1079"></a><span>        </span><span class="hs-comment">-- We could have stored the ru_rough field in the iface file</span><span>
</span><a name="line-1080"></a><span>        </span><span class="hs-comment">-- but that would be redundant, I think.</span><span>
</span><a name="line-1081"></a><span>        </span><span class="hs-comment">-- The only wrinkle is that we must not be deceived by</span><span>
</span><a name="line-1082"></a><span>        </span><span class="hs-comment">-- type synonyms at the top of a type arg.  Since</span><span>
</span><a name="line-1083"></a><span>        </span><span class="hs-comment">-- we can't tell at this point, we are careful not</span><span>
</span><a name="line-1084"></a><span>        </span><span class="hs-comment">-- to write them out in coreRuleToIfaceRule</span><span>
</span><a name="line-1085"></a><span>    </span><span class="hs-identifier">ifTopFreeName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1086"></a><span>    </span><a name="local-6989586621681699081"><a href="#local-6989586621681699081"><span class="hs-identifier">ifTopFreeName</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTyConApp</span><span> </span><a name="local-6989586621681699082"><a href="#local-6989586621681699082"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ifaceTyConName</span><span> </span><a href="#local-6989586621681699082"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1087"></a><span>    </span><span class="hs-identifier">ifTopFreeName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTupleTy</span><span> </span><a name="local-6989586621681699083"><a href="#local-6989586621681699083"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681699084"><a href="#local-6989586621681699084"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleTyConName</span><span> </span><a href="#local-6989586621681699083"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">appArgsIfaceTypes</span><span> </span><a href="#local-6989586621681699084"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1088"></a><span>    </span><span class="hs-identifier">ifTopFreeName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceApp</span><span> </span><a name="local-6989586621681699085"><a href="#local-6989586621681699085"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699081"><span class="hs-identifier hs-var">ifTopFreeName</span></a><span> </span><a href="#local-6989586621681699085"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-1089"></a><span>    </span><span class="hs-identifier">ifTopFreeName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceExt</span><span> </span><a name="local-6989586621681699086"><a href="#local-6989586621681699086"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681699086"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1090"></a><span>    </span><span class="hs-identifier">ifTopFreeName</span><span> </span><span class="hs-identifier">_</span><span>                                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1091"></a><span>
</span><a name="line-1092"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Annotations
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1099"></a><span>
</span><a name="line-1100"></a><span class="hs-identifier">tcIfaceAnnotations</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceAnnotation</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Annotation</span><span class="hs-special">]</span><span>
</span><a name="line-1101"></a><a name="tcIfaceAnnotations"><a href="TcIface.html#tcIfaceAnnotations"><span class="hs-identifier">tcIfaceAnnotations</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceAnnotation"><span class="hs-identifier hs-var">tcIfaceAnnotation</span></a><span>
</span><a name="line-1102"></a><span>
</span><a name="line-1103"></a><span class="hs-identifier">tcIfaceAnnotation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceAnnotation</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">Annotation</span><span>
</span><a name="line-1104"></a><a name="tcIfaceAnnotation"><a href="TcIface.html#tcIfaceAnnotation"><span class="hs-identifier">tcIfaceAnnotation</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceAnnotation</span><span> </span><a name="local-6989586621681699095"><a href="#local-6989586621681699095"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621681699096"><a href="#local-6989586621681699096"><span class="hs-identifier">serialized</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1105"></a><span>    </span><a name="local-6989586621681699097"><a href="#local-6989586621681699097"><span class="hs-identifier">target'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceAnnTarget"><span class="hs-identifier hs-var">tcIfaceAnnTarget</span></a><span> </span><a href="#local-6989586621681699095"><span class="hs-identifier hs-var">target</span></a><span>
</span><a name="line-1106"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Annotation</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1107"></a><span>        </span><span class="hs-identifier">ann_target</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699097"><span class="hs-identifier hs-var">target'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1108"></a><span>        </span><span class="hs-identifier">ann_value</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699096"><span class="hs-identifier hs-var">serialized</span></a><span>
</span><a name="line-1109"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1110"></a><span>
</span><a name="line-1111"></a><span class="hs-identifier">tcIfaceAnnTarget</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceAnnTarget</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AnnTarget</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-1112"></a><a name="tcIfaceAnnTarget"><a href="TcIface.html#tcIfaceAnnTarget"><span class="hs-identifier">tcIfaceAnnTarget</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NamedTarget</span><span> </span><a name="local-6989586621681699098"><a href="#local-6989586621681699098"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1113"></a><span>    </span><a name="local-6989586621681699099"><a href="#local-6989586621681699099"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#lookupIfaceTop"><span class="hs-identifier hs-var">lookupIfaceTop</span></a><span> </span><a href="#local-6989586621681699098"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-1114"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">NamedTarget</span><span> </span><a href="#local-6989586621681699099"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1115"></a><span class="hs-identifier">tcIfaceAnnTarget</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ModuleTarget</span><span> </span><a name="local-6989586621681699100"><a href="#local-6989586621681699100"><span class="hs-identifier">mod</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1116"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ModuleTarget</span><span> </span><a href="#local-6989586621681699100"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-1117"></a><span>
</span><a name="line-1118"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Complete Match Pragmas
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1125"></a><span>
</span><a name="line-1126"></a><span class="hs-identifier">tcIfaceCompleteSigs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceCompleteMatch</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">CompleteMatch</span><span class="hs-special">]</span><span>
</span><a name="line-1127"></a><a name="tcIfaceCompleteSigs"><a href="TcIface.html#tcIfaceCompleteSigs"><span class="hs-identifier">tcIfaceCompleteSigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceCompleteSig"><span class="hs-identifier hs-var">tcIfaceCompleteSig</span></a><span>
</span><a name="line-1128"></a><span>
</span><a name="line-1129"></a><span class="hs-identifier">tcIfaceCompleteSig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceCompleteMatch</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">CompleteMatch</span><span>
</span><a name="line-1130"></a><a name="tcIfaceCompleteSig"><a href="TcIface.html#tcIfaceCompleteSig"><span class="hs-identifier">tcIfaceCompleteSig</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceCompleteMatch</span><span> </span><a name="local-6989586621681699101"><a href="#local-6989586621681699101"><span class="hs-identifier">ms</span></a></a><span> </span><a name="local-6989586621681699102"><a href="#local-6989586621681699102"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CompleteMatch</span><span> </span><a href="#local-6989586621681699101"><span class="hs-identifier hs-var">ms</span></a><span> </span><a href="#local-6989586621681699102"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1131"></a><span>
</span><a name="line-1132"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        Types
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1139"></a><span>
</span><a name="line-1140"></a><span class="hs-identifier">tcIfaceType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-1141"></a><a name="tcIfaceType"><a href="TcIface.html#tcIfaceType"><span class="hs-identifier">tcIfaceType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-1142"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1143"></a><span>    </span><a name="local-6989586621681699103"><a href="#local-6989586621681699103"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTyVar</span><span> </span><a name="local-6989586621681699104"><a href="#local-6989586621681699104"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TyVarTy</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="IfaceEnv.html#tcIfaceTyVar"><span class="hs-identifier hs-var">tcIfaceTyVar</span></a><span> </span><a href="#local-6989586621681699104"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1144"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceFreeTyVar</span><span> </span><a name="local-6989586621681699105"><a href="#local-6989586621681699105"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tcIfaceType:IfaceFreeTyVar&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699105"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1145"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceLitTy</span><span> </span><a name="local-6989586621681699106"><a href="#local-6989586621681699106"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LitTy</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceTyLit"><span class="hs-identifier hs-var">tcIfaceTyLit</span></a><span> </span><a href="#local-6989586621681699106"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1146"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceFunTy</span><span> </span><a name="local-6989586621681699107"><a href="#local-6989586621681699107"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681699108"><a href="#local-6989586621681699108"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">FunTy</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699107"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699108"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1147"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceDFunTy</span><span> </span><a name="local-6989586621681699109"><a href="#local-6989586621681699109"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681699110"><a href="#local-6989586621681699110"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">FunTy</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699109"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699110"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1148"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTupleTy</span><span> </span><a name="local-6989586621681699111"><a href="#local-6989586621681699111"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621681699112"><a href="#local-6989586621681699112"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621681699113"><a href="#local-6989586621681699113"><span class="hs-identifier">tks</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#tcIfaceTupleTy"><span class="hs-identifier hs-var">tcIfaceTupleTy</span></a><span> </span><a href="#local-6989586621681699111"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621681699112"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681699113"><span class="hs-identifier hs-var">tks</span></a><span>
</span><a name="line-1149"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceAppTy</span><span> </span><a name="local-6989586621681699114"><a href="#local-6989586621681699114"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621681699115"><a href="#local-6989586621681699115"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1150"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699116"><a href="#local-6989586621681699116"><span class="hs-identifier">t'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699114"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1151"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699117"><a href="#local-6989586621681699117"><span class="hs-identifier">ts'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">appArgsIfaceTypes</span><span> </span><a href="#local-6989586621681699115"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-identifier hs-var">AppTy</span><span> </span><a href="#local-6989586621681699116"><span class="hs-identifier hs-var">t'</span></a><span> </span><a href="#local-6989586621681699117"><span class="hs-identifier hs-var">ts'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1153"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTyConApp</span><span> </span><a name="local-6989586621681699118"><a href="#local-6989586621681699118"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681699119"><a href="#local-6989586621681699119"><span class="hs-identifier">tks</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1154"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699120"><a href="#local-6989586621681699120"><span class="hs-identifier">tc'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceTyCon"><span class="hs-identifier hs-var">tcIfaceTyCon</span></a><span> </span><a href="#local-6989586621681699118"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1155"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699121"><a href="#local-6989586621681699121"><span class="hs-identifier">tks'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">appArgsIfaceTypes</span><span> </span><a href="#local-6989586621681699119"><span class="hs-identifier hs-var">tks</span></a><span class="hs-special">)</span><span>
</span><a name="line-1156"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621681699120"><span class="hs-identifier hs-var">tc'</span></a><span> </span><a href="#local-6989586621681699121"><span class="hs-identifier hs-var">tks'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1157"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceForAllTy</span><span> </span><a name="local-6989586621681699122"><a href="#local-6989586621681699122"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621681699123"><a href="#local-6989586621681699123"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1158"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceForAllBndr"><span class="hs-identifier hs-var">bindIfaceForAllBndr</span></a><span> </span><a href="#local-6989586621681699122"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699124"><a href="#local-6989586621681699124"><span class="hs-identifier">tv'</span></a></a><span> </span><a name="local-6989586621681699125"><a href="#local-6989586621681699125"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1159"></a><span>        </span><span class="hs-identifier hs-var">ForAllTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><a href="#local-6989586621681699124"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681699125"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699123"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1160"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceCastTy</span><span> </span><a name="local-6989586621681699126"><a href="#local-6989586621681699126"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681699127"><a href="#local-6989586621681699127"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CastTy</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699103"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699126"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcIface.html#tcIfaceCo"><span class="hs-identifier hs-var">tcIfaceCo</span></a><span> </span><a href="#local-6989586621681699127"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1161"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceCoercionTy</span><span> </span><a name="local-6989586621681699128"><a href="#local-6989586621681699128"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CoercionTy</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceCo"><span class="hs-identifier hs-var">tcIfaceCo</span></a><span> </span><a href="#local-6989586621681699128"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1162"></a><span>
</span><a name="line-1163"></a><span class="hs-identifier">tcIfaceTupleTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TupleSort</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PromotionFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceAppArgs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-1164"></a><a name="tcIfaceTupleTy"><a href="TcIface.html#tcIfaceTupleTy"><span class="hs-identifier">tcIfaceTupleTy</span></a></a><span> </span><a name="local-6989586621681699129"><a href="#local-6989586621681699129"><span class="hs-identifier">sort</span></a></a><span> </span><a name="local-6989586621681699130"><a href="#local-6989586621681699130"><span class="hs-identifier">is_promoted</span></a></a><span> </span><a name="local-6989586621681699131"><a href="#local-6989586621681699131"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-1165"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699132"><a href="#local-6989586621681699132"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceAppArgs"><span class="hs-identifier hs-var">tcIfaceAppArgs</span></a><span> </span><a href="#local-6989586621681699131"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1166"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699133"><a href="#local-6989586621681699133"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621681699132"><span class="hs-identifier hs-var">args'</span></a><span>
</span><a name="line-1167"></a><span>      </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699134"><a href="#local-6989586621681699134"><span class="hs-identifier">base_tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcTupleTyCon"><span class="hs-identifier hs-var">tcTupleTyCon</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621681699129"><span class="hs-identifier hs-var">sort</span></a><span> </span><a href="#local-6989586621681699133"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-1168"></a><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699130"><span class="hs-identifier hs-var">is_promoted</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1169"></a><span>          </span><span class="hs-identifier hs-var">NotPromoted</span><span>
</span><a name="line-1170"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621681699134"><span class="hs-identifier hs-var">base_tc</span></a><span> </span><a href="#local-6989586621681699132"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1171"></a><span>
</span><a name="line-1172"></a><span>          </span><span class="hs-identifier hs-var">IsPromoted</span><span>
</span><a name="line-1173"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699135"><a href="#local-6989586621681699135"><span class="hs-identifier">tc</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">promoteDataCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConSingleDataCon</span><span> </span><a href="#local-6989586621681699134"><span class="hs-identifier hs-var">base_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1174"></a><span>                        </span><a name="local-6989586621681699136"><a href="#local-6989586621681699136"><span class="hs-identifier">kind_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">typeKind</span><span> </span><a href="#local-6989586621681699132"><span class="hs-identifier hs-var">args'</span></a><span>
</span><a name="line-1175"></a><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621681699135"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699136"><span class="hs-identifier hs-var">kind_args</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681699132"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1176"></a><span>
</span><a name="line-1177"></a><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in TyCon</span><span>
</span><a name="line-1178"></a><span class="hs-identifier">tcTupleTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>    </span><span class="hs-comment">-- True &lt;=&gt; typechecking a *type* (vs. an expr)</span><span>
</span><a name="line-1179"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TupleSort</span><span>
</span><a name="line-1180"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Arity</span><span>   </span><span class="hs-comment">-- the number of args. *not* the tuple arity.</span><span>
</span><a name="line-1181"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span>
</span><a name="line-1182"></a><a name="tcTupleTyCon"><a href="TcIface.html#tcTupleTyCon"><span class="hs-identifier">tcTupleTyCon</span></a></a><span> </span><a name="local-6989586621681699137"><a href="#local-6989586621681699137"><span class="hs-identifier">in_type</span></a></a><span> </span><a name="local-6989586621681699138"><a href="#local-6989586621681699138"><span class="hs-identifier">sort</span></a></a><span> </span><a name="local-6989586621681699139"><a href="#local-6989586621681699139"><span class="hs-identifier">arity</span></a></a><span>
</span><a name="line-1183"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699138"><span class="hs-identifier hs-var">sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1184"></a><span>      </span><span class="hs-identifier hs-var">ConstraintTuple</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699140"><a href="#local-6989586621681699140"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cTupleTyConName</span><span> </span><a href="#local-6989586621681699139"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-1185"></a><span>                            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyThingTyCon</span><span> </span><a href="#local-6989586621681699140"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1186"></a><span>      </span><span class="hs-identifier hs-var">BoxedTuple</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleTyCon</span><span> </span><span class="hs-identifier hs-var">Boxed</span><span>   </span><a href="#local-6989586621681699139"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-1187"></a><span>      </span><span class="hs-identifier hs-var">UnboxedTuple</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleTyCon</span><span> </span><span class="hs-identifier hs-var">Unboxed</span><span> </span><a href="#local-6989586621681699141"><span class="hs-identifier hs-var">arity'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1188"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681699141"><a href="#local-6989586621681699141"><span class="hs-identifier">arity'</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681699137"><span class="hs-identifier hs-var">in_type</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699139"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-1189"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699139"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-1190"></a><span>                      </span><span class="hs-comment">-- in expressions, we only have term args</span><span>
</span><a name="line-1191"></a><span>
</span><a name="line-1192"></a><span class="hs-identifier">tcIfaceAppArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceAppArgs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-1193"></a><a name="tcIfaceAppArgs"><a href="TcIface.html#tcIfaceAppArgs"><span class="hs-identifier">tcIfaceAppArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">appArgsIfaceTypes</span><span>
</span><a name="line-1194"></a><span>
</span><a name="line-1195"></a><span class="hs-comment">-----------------------------------------</span><span>
</span><a name="line-1196"></a><span class="hs-identifier">tcIfaceCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceContext</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">ThetaType</span><span>
</span><a name="line-1197"></a><a name="tcIfaceCtxt"><a href="TcIface.html#tcIfaceCtxt"><span class="hs-identifier">tcIfaceCtxt</span></a></a><span> </span><a name="local-6989586621681699142"><a href="#local-6989586621681699142"><span class="hs-identifier">sts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699142"><span class="hs-identifier hs-var">sts</span></a><span>
</span><a name="line-1198"></a><span>
</span><a name="line-1199"></a><span class="hs-comment">-----------------------------------------</span><span>
</span><a name="line-1200"></a><span class="hs-identifier">tcIfaceTyLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceTyLit</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyLit</span><span>
</span><a name="line-1201"></a><a name="tcIfaceTyLit"><a href="TcIface.html#tcIfaceTyLit"><span class="hs-identifier">tcIfaceTyLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceNumTyLit</span><span> </span><a name="local-6989586621681699143"><a href="#local-6989586621681699143"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NumTyLit</span><span> </span><a href="#local-6989586621681699143"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1202"></a><span class="hs-identifier">tcIfaceTyLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceStrTyLit</span><span> </span><a name="local-6989586621681699144"><a href="#local-6989586621681699144"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StrTyLit</span><span> </span><a href="#local-6989586621681699144"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1203"></a><span>
</span><a name="line-1204"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                        Coercions
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1211"></a><span>
</span><a name="line-1212"></a><span class="hs-identifier">tcIfaceCo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceCoercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span>
</span><a name="line-1213"></a><a name="tcIfaceCo"><a href="TcIface.html#tcIfaceCo"><span class="hs-identifier">tcIfaceCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-1214"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1215"></a><span>    </span><a name="local-6989586621681699145"><a href="#local-6989586621681699145"><span class="hs-identifier">go_mco</span></a></a><span> </span><span class="hs-identifier hs-var">IfaceMRefl</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">MRefl</span><span>
</span><a name="line-1216"></a><span>    </span><span class="hs-identifier">go_mco</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceMCo</span><span> </span><a name="local-6989586621681699148"><a href="#local-6989586621681699148"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MCo</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699148"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>
</span><a name="line-1218"></a><span>    </span><a name="local-6989586621681699146"><a href="#local-6989586621681699146"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceReflCo</span><span> </span><a name="local-6989586621681699149"><a href="#local-6989586621681699149"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Refl</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699149"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1219"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceGReflCo</span><span> </span><a name="local-6989586621681699150"><a href="#local-6989586621681699150"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681699151"><a href="#local-6989586621681699151"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621681699152"><a href="#local-6989586621681699152"><span class="hs-identifier">mco</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GRefl</span><span> </span><a href="#local-6989586621681699150"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699151"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681699145"><span class="hs-identifier hs-var">go_mco</span></a><span> </span><a href="#local-6989586621681699152"><span class="hs-identifier hs-var">mco</span></a><span>
</span><a name="line-1220"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceFunCo</span><span> </span><a name="local-6989586621681699153"><a href="#local-6989586621681699153"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681699154"><a href="#local-6989586621681699154"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681699155"><a href="#local-6989586621681699155"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkFunCo</span><span> </span><a href="#local-6989586621681699153"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699154"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699155"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-1221"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTyConAppCo</span><span> </span><a name="local-6989586621681699156"><a href="#local-6989586621681699156"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681699157"><a href="#local-6989586621681699157"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681699158"><a href="#local-6989586621681699158"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1222"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TyConAppCo</span><span> </span><a href="#local-6989586621681699156"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceTyCon"><span class="hs-identifier hs-var">tcIfaceTyCon</span></a><span> </span><a href="#local-6989586621681699157"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699158"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-1223"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceAppCo</span><span> </span><a name="local-6989586621681699159"><a href="#local-6989586621681699159"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681699160"><a href="#local-6989586621681699160"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AppCo</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699159"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699160"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-1224"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceForAllCo</span><span> </span><a name="local-6989586621681699161"><a href="#local-6989586621681699161"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681699162"><a href="#local-6989586621681699162"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621681699163"><a href="#local-6989586621681699163"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699164"><a href="#local-6989586621681699164"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699162"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1225"></a><span>                                      </span><span class="hs-special">;</span><span> </span><a href="TcIface.html#bindIfaceBndr"><span class="hs-identifier hs-var">bindIfaceBndr</span></a><span> </span><a href="#local-6989586621681699161"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699165"><a href="#local-6989586621681699165"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1226"></a><span>                                        </span><span class="hs-identifier hs-var">ForAllCo</span><span> </span><a href="#local-6989586621681699165"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681699164"><span class="hs-identifier hs-var">k'</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699163"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1227"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceCoVarCo</span><span> </span><a name="local-6989586621681699166"><a href="#local-6989586621681699166"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CoVarCo</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699147"><span class="hs-identifier hs-var">go_var</span></a><span> </span><a href="#local-6989586621681699166"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1228"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceAxiomInstCo</span><span> </span><a name="local-6989586621681699167"><a href="#local-6989586621681699167"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681699168"><a href="#local-6989586621681699168"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621681699169"><a href="#local-6989586621681699169"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AxiomInstCo</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceCoAxiom"><span class="hs-identifier hs-var">tcIfaceCoAxiom</span></a><span> </span><a href="#local-6989586621681699167"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621681699168"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699169"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-1229"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceUnivCo</span><span> </span><a name="local-6989586621681699170"><a href="#local-6989586621681699170"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621681699171"><a href="#local-6989586621681699171"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681699172"><a href="#local-6989586621681699172"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681699173"><a href="#local-6989586621681699173"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">UnivCo</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceUnivCoProv"><span class="hs-identifier hs-var">tcIfaceUnivCoProv</span></a><span> </span><a href="#local-6989586621681699170"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621681699171"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1230"></a><span>                                          </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699172"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699173"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1231"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceSymCo</span><span> </span><a name="local-6989586621681699174"><a href="#local-6989586621681699174"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SymCo</span><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699174"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1232"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTransCo</span><span> </span><a name="local-6989586621681699175"><a href="#local-6989586621681699175"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681699176"><a href="#local-6989586621681699176"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TransCo</span><span>  </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699175"><span class="hs-identifier hs-var">c1</span></a><span>
</span><a name="line-1233"></a><span>                                            </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699176"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-1234"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceInstCo</span><span> </span><a name="local-6989586621681699177"><a href="#local-6989586621681699177"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681699178"><a href="#local-6989586621681699178"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InstCo</span><span>   </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699177"><span class="hs-identifier hs-var">c1</span></a><span>
</span><a name="line-1235"></a><span>                                            </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699178"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1236"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceNthCo</span><span> </span><a name="local-6989586621681699179"><a href="#local-6989586621681699179"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621681699180"><a href="#local-6989586621681699180"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699181"><a href="#local-6989586621681699181"><span class="hs-identifier">c'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699180"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1237"></a><span>                                      </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkNthCo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nthCoRole</span><span> </span><a href="#local-6989586621681699179"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-6989586621681699181"><span class="hs-identifier hs-var">c'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699179"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-6989586621681699181"><span class="hs-identifier hs-var">c'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1238"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceLRCo</span><span> </span><a name="local-6989586621681699182"><a href="#local-6989586621681699182"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621681699183"><a href="#local-6989586621681699183"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LRCo</span><span> </span><a href="#local-6989586621681699182"><span class="hs-identifier hs-var">lr</span></a><span>  </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699183"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1239"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceKindCo</span><span> </span><a name="local-6989586621681699184"><a href="#local-6989586621681699184"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">KindCo</span><span>   </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699184"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1240"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceSubCo</span><span> </span><a name="local-6989586621681699185"><a href="#local-6989586621681699185"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SubCo</span><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699185"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1241"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceAxiomRuleCo</span><span> </span><a name="local-6989586621681699186"><a href="#local-6989586621681699186"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621681699187"><a href="#local-6989586621681699187"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AxiomRuleCo</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceCoAxiomRule"><span class="hs-identifier hs-var">tcIfaceCoAxiomRule</span></a><span> </span><a href="#local-6989586621681699186"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-1242"></a><span>                                               </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681699146"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681699187"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-1243"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceFreeCoVar</span><span> </span><a name="local-6989586621681699188"><a href="#local-6989586621681699188"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tcIfaceCo:IfaceFreeCoVar&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699188"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1244"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceHoleCo</span><span> </span><a name="local-6989586621681699189"><a href="#local-6989586621681699189"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tcIfaceCo:IfaceHoleCo&quot;</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699189"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1245"></a><span>
</span><a name="line-1246"></a><span>    </span><span class="hs-identifier">go_var</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FastString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">CoVar</span><span>
</span><a name="line-1247"></a><span>    </span><a name="local-6989586621681699147"><a href="#local-6989586621681699147"><span class="hs-identifier">go_var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceEnv.html#tcIfaceLclId"><span class="hs-identifier hs-var">tcIfaceLclId</span></a><span>
</span><a name="line-1248"></a><span>
</span><a name="line-1249"></a><span class="hs-identifier">tcIfaceUnivCoProv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceUnivCoProv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">UnivCoProvenance</span><span>
</span><a name="line-1250"></a><a name="tcIfaceUnivCoProv"><a href="TcIface.html#tcIfaceUnivCoProv"><span class="hs-identifier">tcIfaceUnivCoProv</span></a></a><span> </span><span class="hs-identifier hs-var">IfaceUnsafeCoerceProv</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">UnsafeCoerceProv</span><span>
</span><a name="line-1251"></a><span class="hs-identifier">tcIfaceUnivCoProv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfacePhantomProv</span><span> </span><a name="local-6989586621681699190"><a href="#local-6989586621681699190"><span class="hs-identifier">kco</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PhantomProv</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceCo"><span class="hs-identifier hs-var">tcIfaceCo</span></a><span> </span><a href="#local-6989586621681699190"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-1252"></a><span class="hs-identifier">tcIfaceUnivCoProv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceProofIrrelProv</span><span> </span><a name="local-6989586621681699191"><a href="#local-6989586621681699191"><span class="hs-identifier">kco</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ProofIrrelProv</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceCo"><span class="hs-identifier hs-var">tcIfaceCo</span></a><span> </span><a href="#local-6989586621681699191"><span class="hs-identifier hs-var">kco</span></a><span>
</span><a name="line-1253"></a><span class="hs-identifier">tcIfaceUnivCoProv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfacePluginProv</span><span> </span><a name="local-6989586621681699192"><a href="#local-6989586621681699192"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PluginProv</span><span> </span><a href="#local-6989586621681699192"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-1254"></a><span>
</span><a name="line-1255"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        Core
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1262"></a><span>
</span><a name="line-1263"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span>
</span><a name="line-1264"></a><a name="tcIfaceExpr"><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier">tcIfaceExpr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceType</span><span> </span><a name="local-6989586621681699193"><a href="#local-6989586621681699193"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1265"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Type</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699193"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1266"></a><span>
</span><a name="line-1267"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceCo</span><span> </span><a name="local-6989586621681699194"><a href="#local-6989586621681699194"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1268"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Coercion</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceCo"><span class="hs-identifier hs-var">tcIfaceCo</span></a><span> </span><a href="#local-6989586621681699194"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1269"></a><span>
</span><a name="line-1270"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceCast</span><span> </span><a name="local-6989586621681699195"><a href="#local-6989586621681699195"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621681699196"><a href="#local-6989586621681699196"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1271"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Cast</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699195"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcIface.html#tcIfaceCo"><span class="hs-identifier hs-var">tcIfaceCo</span></a><span> </span><a href="#local-6989586621681699196"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1272"></a><span>
</span><a name="line-1273"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceLcl</span><span> </span><a name="local-6989586621681699197"><a href="#local-6989586621681699197"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1274"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Var</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="IfaceEnv.html#tcIfaceLclId"><span class="hs-identifier hs-var">tcIfaceLclId</span></a><span> </span><a href="#local-6989586621681699197"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1275"></a><span>
</span><a name="line-1276"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceExt</span><span> </span><a name="local-6989586621681699198"><a href="#local-6989586621681699198"><span class="hs-identifier">gbl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Var</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceExtId"><span class="hs-identifier hs-var">tcIfaceExtId</span></a><span> </span><a href="#local-6989586621681699198"><span class="hs-identifier hs-var">gbl</span></a><span>
</span><a name="line-1278"></a><span>
</span><a name="line-1279"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceLit</span><span> </span><a name="local-6989586621681699199"><a href="#local-6989586621681699199"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1280"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681699200"><a href="#local-6989586621681699200"><span class="hs-identifier">lit'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceLit"><span class="hs-identifier hs-var">tcIfaceLit</span></a><span> </span><a href="#local-6989586621681699199"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1281"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><a href="#local-6989586621681699200"><span class="hs-identifier hs-var">lit'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1282"></a><span>
</span><a name="line-1283"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceFCall</span><span> </span><a name="local-6989586621681699201"><a href="#local-6989586621681699201"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621681699202"><a href="#local-6989586621681699202"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1284"></a><span>    </span><a name="local-6989586621681699203"><a href="#local-6989586621681699203"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699202"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1285"></a><span>    </span><a name="local-6989586621681699204"><a href="#local-6989586621681699204"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a><span>
</span><a name="line-1286"></a><span>    </span><a name="local-6989586621681699205"><a href="#local-6989586621681699205"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1287"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkFCallId</span><span> </span><a href="#local-6989586621681699205"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681699204"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621681699201"><span class="hs-identifier hs-var">cc</span></a><span> </span><a href="#local-6989586621681699203"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1288"></a><span>
</span><a name="line-1289"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTuple</span><span> </span><a name="local-6989586621681699206"><a href="#local-6989586621681699206"><span class="hs-identifier">sort</span></a></a><span> </span><a name="local-6989586621681699207"><a href="#local-6989586621681699207"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1290"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699209"><a href="#local-6989586621681699209"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699207"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1291"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699210"><a href="#local-6989586621681699210"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcTupleTyCon"><span class="hs-identifier hs-var">tcTupleTyCon</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621681699206"><span class="hs-identifier hs-var">sort</span></a><span> </span><a href="#local-6989586621681699208"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-1292"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699211"><a href="#local-6989586621681699211"><span class="hs-identifier">con_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">exprType</span><span> </span><a href="#local-6989586621681699209"><span class="hs-identifier hs-var">args'</span></a><span>
</span><a name="line-1293"></a><span>             </span><a name="local-6989586621681699212"><a href="#local-6989586621681699212"><span class="hs-identifier">some_con_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">Type</span><span> </span><a href="#local-6989586621681699211"><span class="hs-identifier hs-var">con_tys</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681699209"><span class="hs-identifier hs-var">args'</span></a><span>
</span><a name="line-1294"></a><span>             </span><a name="local-6989586621681699213"><a href="#local-6989586621681699213"><span class="hs-identifier">con_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699206"><span class="hs-identifier hs-var">sort</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1295"></a><span>               </span><span class="hs-identifier hs-var">UnboxedTuple</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Type</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">getRuntimeRep</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699211"><span class="hs-identifier hs-var">con_tys</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681699212"><span class="hs-identifier hs-var">some_con_args</span></a><span>
</span><a name="line-1296"></a><span>               </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681699212"><span class="hs-identifier hs-var">some_con_args</span></a><span>
</span><a name="line-1297"></a><span>                        </span><span class="hs-comment">-- Put the missing type arguments back in</span><span>
</span><a name="line-1298"></a><span>             </span><a name="local-6989586621681699214"><a href="#local-6989586621681699214"><span class="hs-identifier">con_id</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConWorkId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConSingleDataCon</span><span> </span><a href="#local-6989586621681699210"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1299"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkApps</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><a href="#local-6989586621681699214"><span class="hs-identifier hs-var">con_id</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699213"><span class="hs-identifier hs-var">con_args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1300"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1301"></a><span>    </span><a name="local-6989586621681699208"><a href="#local-6989586621681699208"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621681699207"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1302"></a><span>
</span><a name="line-1303"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceLam</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699215"><a href="#local-6989586621681699215"><span class="hs-identifier">bndr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699216"><a href="#local-6989586621681699216"><span class="hs-identifier">os</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699217"><a href="#local-6989586621681699217"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1304"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceBndr"><span class="hs-identifier hs-var">bindIfaceBndr</span></a><span> </span><a href="#local-6989586621681699215"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699221"><a href="#local-6989586621681699221"><span class="hs-identifier">bndr'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1305"></a><span>    </span><span class="hs-identifier hs-var">Lam</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699218"><span class="hs-identifier hs-var">tcIfaceOneShot</span></a><span> </span><a href="#local-6989586621681699216"><span class="hs-identifier hs-var">os</span></a><span> </span><a href="#local-6989586621681699221"><span class="hs-identifier hs-var">bndr'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699217"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1306"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1307"></a><span>    </span><a name="local-6989586621681699218"><a href="#local-6989586621681699218"><span class="hs-identifier">tcIfaceOneShot</span></a></a><span> </span><span class="hs-identifier hs-var">IfaceOneShot</span><span> </span><a name="local-6989586621681699219"><a href="#local-6989586621681699219"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">setOneShotLambda</span><span> </span><a href="#local-6989586621681699219"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1308"></a><span>    </span><span class="hs-identifier">tcIfaceOneShot</span><span> </span><span class="hs-identifier">_</span><span>            </span><a name="local-6989586621681699220"><a href="#local-6989586621681699220"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699220"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1309"></a><span>
</span><a name="line-1310"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceApp</span><span> </span><a name="local-6989586621681699222"><a href="#local-6989586621681699222"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621681699223"><a href="#local-6989586621681699223"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1311"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699222"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699223"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1312"></a><span>
</span><a name="line-1313"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceECase</span><span> </span><a name="local-6989586621681699224"><a href="#local-6989586621681699224"><span class="hs-identifier">scrut</span></a></a><span> </span><a name="local-6989586621681699225"><a href="#local-6989586621681699225"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1314"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699226"><a href="#local-6989586621681699226"><span class="hs-identifier">scrut'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699224"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-1315"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699227"><a href="#local-6989586621681699227"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699225"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1316"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castBottomExpr</span><span> </span><a href="#local-6989586621681699226"><span class="hs-identifier hs-var">scrut'</span></a><span> </span><a href="#local-6989586621681699227"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceCase</span><span> </span><a name="local-6989586621681699228"><a href="#local-6989586621681699228"><span class="hs-identifier">scrut</span></a></a><span> </span><a name="local-6989586621681699229"><a href="#local-6989586621681699229"><span class="hs-identifier">case_bndr</span></a></a><span> </span><a name="local-6989586621681699230"><a href="#local-6989586621681699230"><span class="hs-identifier">alts</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1319"></a><span>    </span><a name="local-6989586621681699231"><a href="#local-6989586621681699231"><span class="hs-identifier">scrut'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699228"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-1320"></a><span>    </span><a name="local-6989586621681699232"><a href="#local-6989586621681699232"><span class="hs-identifier">case_bndr_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#newIfaceName"><span class="hs-identifier hs-var">newIfaceName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkVarOccFS</span><span> </span><a href="#local-6989586621681699229"><span class="hs-identifier hs-var">case_bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1321"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1322"></a><span>        </span><a name="local-6989586621681699233"><a href="#local-6989586621681699233"><span class="hs-identifier">scrut_ty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">exprType</span><span> </span><a href="#local-6989586621681699231"><span class="hs-identifier hs-var">scrut'</span></a><span>
</span><a name="line-1323"></a><span>        </span><a name="local-6989586621681699234"><a href="#local-6989586621681699234"><span class="hs-identifier">case_bndr'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span><span> </span><a href="#local-6989586621681699232"><span class="hs-identifier hs-var">case_bndr_name</span></a><span> </span><a href="#local-6989586621681699233"><span class="hs-identifier hs-var">scrut_ty</span></a><span>
</span><a name="line-1324"></a><span>        </span><a name="local-6989586621681699235"><a href="#local-6989586621681699235"><span class="hs-identifier">tc_app</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitTyConApp</span><span> </span><a href="#local-6989586621681699233"><span class="hs-identifier hs-var">scrut_ty</span></a><span>
</span><a name="line-1325"></a><span>                </span><span class="hs-comment">-- NB: Won't always succeed (polymorphic case)</span><span>
</span><a name="line-1326"></a><span>                </span><span class="hs-comment">--     but won't be demanded in those cases</span><span>
</span><a name="line-1327"></a><span>                </span><span class="hs-comment">-- NB: not tcSplitTyConApp; we are looking at Core here</span><span>
</span><a name="line-1328"></a><span>                </span><span class="hs-comment">--     look through non-rec newtypes to find the tycon that</span><span>
</span><a name="line-1329"></a><span>                </span><span class="hs-comment">--     corresponds to the datacon in this case alternative</span><span>
</span><a name="line-1330"></a><span>
</span><a name="line-1331"></a><span>    </span><a href="IfaceEnv.html#extendIfaceIdEnv"><span class="hs-identifier hs-var">extendIfaceIdEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681699234"><span class="hs-identifier hs-var">case_bndr'</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1332"></a><span>     </span><a name="local-6989586621681699236"><a href="#local-6989586621681699236"><span class="hs-identifier">alts'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcIface.html#tcIfaceAlt"><span class="hs-identifier hs-var">tcIfaceAlt</span></a><span> </span><a href="#local-6989586621681699231"><span class="hs-identifier hs-var">scrut'</span></a><span> </span><a href="#local-6989586621681699235"><span class="hs-identifier hs-var">tc_app</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699230"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-1333"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Case</span><span> </span><a href="#local-6989586621681699231"><span class="hs-identifier hs-var">scrut'</span></a><span> </span><a href="#local-6989586621681699234"><span class="hs-identifier hs-var">case_bndr'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coreAltsType</span><span> </span><a href="#local-6989586621681699236"><span class="hs-identifier hs-var">alts'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699236"><span class="hs-identifier hs-var">alts'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1334"></a><span>
</span><a name="line-1335"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceLet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceNonRec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfLetBndr</span><span> </span><a name="local-6989586621681699237"><a href="#local-6989586621681699237"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621681699238"><a href="#local-6989586621681699238"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681699239"><a href="#local-6989586621681699239"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621681699240"><a href="#local-6989586621681699240"><span class="hs-identifier">ji</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699241"><a href="#local-6989586621681699241"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699242"><a href="#local-6989586621681699242"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1336"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699243"><a href="#local-6989586621681699243"><span class="hs-identifier">name</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#newIfaceName"><span class="hs-identifier hs-var">newIfaceName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkVarOccFS</span><span> </span><a href="#local-6989586621681699237"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1337"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699244"><a href="#local-6989586621681699244"><span class="hs-identifier">ty'</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699238"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1338"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699245"><a href="#local-6989586621681699245"><span class="hs-identifier">id_info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIdInfo"><span class="hs-identifier hs-var">tcIdInfo</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">{- Don't ignore prags; we are inside one! -}</span><span>
</span><a name="line-1339"></a><span>                              </span><span class="hs-identifier hs-var">NotTopLevel</span><span> </span><a href="#local-6989586621681699243"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699244"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681699239"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1340"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699246"><a href="#local-6989586621681699246"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLocalIdOrCoVarWithInfo</span><span> </span><a href="#local-6989586621681699243"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699244"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681699245"><span class="hs-identifier hs-var">id_info</span></a><span>
</span><a name="line-1341"></a><span>                     </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asJoinId_maybe</span><span class="hs-special">`</span><span> </span><a href="TcIface.html#tcJoinInfo"><span class="hs-identifier hs-var">tcJoinInfo</span></a><span> </span><a href="#local-6989586621681699240"><span class="hs-identifier hs-var">ji</span></a><span>
</span><a name="line-1342"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699247"><a href="#local-6989586621681699247"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699241"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1343"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699248"><a href="#local-6989586621681699248"><span class="hs-identifier">body'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#extendIfaceIdEnv"><span class="hs-identifier hs-var">extendIfaceIdEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681699246"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699242"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-1344"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NonRec</span><span> </span><a href="#local-6989586621681699246"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621681699247"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699248"><span class="hs-identifier hs-var">body'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1345"></a><span>
</span><a name="line-1346"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceLet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceRec</span><span> </span><a name="local-6989586621681699249"><a href="#local-6989586621681699249"><span class="hs-identifier">pairs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699250"><a href="#local-6989586621681699250"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1347"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699263"><a href="#local-6989586621681699263"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681699251"><span class="hs-identifier hs-var">tc_rec_bndr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621681699249"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1348"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="IfaceEnv.html#extendIfaceIdEnv"><span class="hs-identifier hs-var">extendIfaceIdEnv</span></a><span> </span><a href="#local-6989586621681699263"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1349"></a><span>       </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699264"><a href="#local-6989586621681699264"><span class="hs-identifier">pairs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zipWithM</span><span> </span><a href="#local-6989586621681699252"><span class="hs-identifier hs-var">tc_pair</span></a><span> </span><a href="#local-6989586621681699249"><span class="hs-identifier hs-var">pairs</span></a><span> </span><a href="#local-6989586621681699263"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-1350"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699265"><a href="#local-6989586621681699265"><span class="hs-identifier">body'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699250"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1351"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Rec</span><span> </span><a href="#local-6989586621681699264"><span class="hs-identifier hs-var">pairs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699265"><span class="hs-identifier hs-var">body'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1352"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1353"></a><span>   </span><a name="local-6989586621681699251"><a href="#local-6989586621681699251"><span class="hs-identifier">tc_rec_bndr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfLetBndr</span><span> </span><a name="local-6989586621681699253"><a href="#local-6989586621681699253"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621681699254"><a href="#local-6989586621681699254"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681699255"><a href="#local-6989586621681699255"><span class="hs-identifier">ji</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1354"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699256"><a href="#local-6989586621681699256"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#newIfaceName"><span class="hs-identifier hs-var">newIfaceName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkVarOccFS</span><span> </span><a href="#local-6989586621681699253"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1355"></a><span>          </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699257"><a href="#local-6989586621681699257"><span class="hs-identifier">ty'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699254"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1356"></a><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span><span> </span><a href="#local-6989586621681699256"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699257"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asJoinId_maybe</span><span class="hs-special">`</span><span> </span><a href="TcIface.html#tcJoinInfo"><span class="hs-identifier hs-var">tcJoinInfo</span></a><span> </span><a href="#local-6989586621681699255"><span class="hs-identifier hs-var">ji</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1357"></a><span>   </span><a name="local-6989586621681699252"><a href="#local-6989586621681699252"><span class="hs-identifier">tc_pair</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfLetBndr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681699258"><a href="#local-6989586621681699258"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681699259"><a href="#local-6989586621681699259"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699260"><a href="#local-6989586621681699260"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-1358"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699261"><a href="#local-6989586621681699261"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699259"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1359"></a><span>          </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699262"><a href="#local-6989586621681699262"><span class="hs-identifier">id_info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIdInfo"><span class="hs-identifier hs-var">tcIdInfo</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">{- Don't ignore prags; we are inside one! -}</span><span>
</span><a name="line-1360"></a><span>                                </span><span class="hs-identifier hs-var">NotTopLevel</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621681699260"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621681699260"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699258"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1361"></a><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">setIdInfo</span><span> </span><a href="#local-6989586621681699260"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621681699262"><span class="hs-identifier hs-var">id_info</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699261"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1362"></a><span>
</span><a name="line-1363"></a><span class="hs-identifier">tcIfaceExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTick</span><span> </span><a name="local-6989586621681699266"><a href="#local-6989586621681699266"><span class="hs-identifier">tickish</span></a></a><span> </span><a name="local-6989586621681699267"><a href="#local-6989586621681699267"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1364"></a><span>    </span><a name="local-6989586621681699268"><a href="#local-6989586621681699268"><span class="hs-identifier">expr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699267"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1365"></a><span>    </span><span class="hs-comment">-- If debug flag is not set: Ignore source notes</span><span>
</span><a name="line-1366"></a><span>    </span><a name="local-6989586621681699269"><a href="#local-6989586621681699269"><span class="hs-identifier">dbgLvl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">debugLevel</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1367"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699266"><span class="hs-identifier hs-var">tickish</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1368"></a><span>      </span><span class="hs-identifier hs-var">IfaceSource</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681699269"><span class="hs-identifier hs-var">dbgLvl</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1369"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699268"><span class="hs-identifier hs-var">expr'</span></a><span>
</span><a name="line-1370"></a><span>      </span><a name="local-6989586621681699270"><a href="#local-6989586621681699270"><span class="hs-identifier">_otherwise</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1371"></a><span>        </span><a name="local-6989586621681699271"><a href="#local-6989586621681699271"><span class="hs-identifier">tickish'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceTickish"><span class="hs-identifier hs-var">tcIfaceTickish</span></a><span> </span><a href="#local-6989586621681699266"><span class="hs-identifier hs-var">tickish</span></a><span>
</span><a name="line-1372"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Tick</span><span> </span><a href="#local-6989586621681699271"><span class="hs-identifier hs-var">tickish'</span></a><span> </span><a href="#local-6989586621681699268"><span class="hs-identifier hs-var">expr'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1373"></a><span>
</span><a name="line-1374"></a><span class="hs-comment">-------------------------</span><span>
</span><a name="line-1375"></a><span class="hs-identifier">tcIfaceTickish</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceTickish</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfM</span><span> </span><a href="#local-6989586621681698742"><span class="hs-identifier hs-type">lcl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tickish</span><span> </span><span class="hs-identifier hs-type">Id</span><span class="hs-special">)</span><span>
</span><a name="line-1376"></a><a name="tcIfaceTickish"><a href="TcIface.html#tcIfaceTickish"><span class="hs-identifier">tcIfaceTickish</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceHpcTick</span><span> </span><a name="local-6989586621681699272"><a href="#local-6989586621681699272"><span class="hs-identifier">modl</span></a></a><span> </span><a name="local-6989586621681699273"><a href="#local-6989586621681699273"><span class="hs-identifier">ix</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HpcTick</span><span> </span><a href="#local-6989586621681699272"><span class="hs-identifier hs-var">modl</span></a><span> </span><a href="#local-6989586621681699273"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">)</span><span>
</span><a name="line-1377"></a><span class="hs-identifier">tcIfaceTickish</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceSCC</span><span>  </span><a name="local-6989586621681699274"><a href="#local-6989586621681699274"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621681699275"><a href="#local-6989586621681699275"><span class="hs-identifier">tick</span></a></a><span> </span><a name="local-6989586621681699276"><a href="#local-6989586621681699276"><span class="hs-identifier">push</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ProfNote</span><span> </span><a href="#local-6989586621681699274"><span class="hs-identifier hs-var">cc</span></a><span> </span><a href="#local-6989586621681699275"><span class="hs-identifier hs-var">tick</span></a><span> </span><a href="#local-6989586621681699276"><span class="hs-identifier hs-var">push</span></a><span class="hs-special">)</span><span>
</span><a name="line-1378"></a><span class="hs-identifier">tcIfaceTickish</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceSource</span><span> </span><a name="local-6989586621681699277"><a href="#local-6989586621681699277"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621681699278"><a href="#local-6989586621681699278"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SourceNote</span><span> </span><a href="#local-6989586621681699277"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681699278"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><span>
</span><a name="line-1380"></a><span class="hs-comment">-------------------------</span><span>
</span><a name="line-1381"></a><span class="hs-identifier">tcIfaceLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Literal</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">Literal</span><span>
</span><a name="line-1382"></a><span class="hs-comment">-- Integer literals deserialise to (LitInteger i &lt;error thunk&gt;)</span><span>
</span><a name="line-1383"></a><span class="hs-comment">-- so tcIfaceLit just fills in the type.</span><span>
</span><a name="line-1384"></a><span class="hs-comment">-- See Note [Integer literals] in Literal</span><span>
</span><a name="line-1385"></a><a name="tcIfaceLit"><a href="TcIface.html#tcIfaceLit"><span class="hs-identifier">tcIfaceLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitNumber</span><span> </span><span class="hs-identifier hs-var">LitNumInteger</span><span> </span><a name="local-6989586621681699279"><a href="#local-6989586621681699279"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1386"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681699280"><a href="#local-6989586621681699280"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceTyConByName"><span class="hs-identifier hs-var">tcIfaceTyConByName</span></a><span> </span><span class="hs-identifier hs-var">integerTyConName</span><span>
</span><a name="line-1387"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLitInteger</span><span> </span><a href="#local-6989586621681699279"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyConTy</span><span> </span><a href="#local-6989586621681699280"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1388"></a><span class="hs-comment">-- Natural literals deserialise to (LitNatural i &lt;error thunk&gt;)</span><span>
</span><a name="line-1389"></a><span class="hs-comment">-- so tcIfaceLit just fills in the type.</span><span>
</span><a name="line-1390"></a><span class="hs-comment">-- See Note [Natural literals] in Literal</span><span>
</span><a name="line-1391"></a><span class="hs-identifier">tcIfaceLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitNumber</span><span> </span><span class="hs-identifier hs-var">LitNumNatural</span><span> </span><a name="local-6989586621681699281"><a href="#local-6989586621681699281"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1392"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681699282"><a href="#local-6989586621681699282"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceTyConByName"><span class="hs-identifier hs-var">tcIfaceTyConByName</span></a><span> </span><span class="hs-identifier hs-var">naturalTyConName</span><span>
</span><a name="line-1393"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLitNatural</span><span> </span><a href="#local-6989586621681699281"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyConTy</span><span> </span><a href="#local-6989586621681699282"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1394"></a><span class="hs-identifier">tcIfaceLit</span><span> </span><a name="local-6989586621681699283"><a href="#local-6989586621681699283"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699283"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1395"></a><span>
</span><a name="line-1396"></a><span class="hs-comment">-------------------------</span><span>
</span><a name="line-1397"></a><span class="hs-identifier">tcIfaceAlt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TyCon</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1398"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IfaceConAlt</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FastString</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IfaceExpr</span><span class="hs-special">)</span><span>
</span><a name="line-1399"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AltCon</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span class="hs-special">)</span><span>
</span><a name="line-1400"></a><a name="tcIfaceAlt"><a href="TcIface.html#tcIfaceAlt"><span class="hs-identifier">tcIfaceAlt</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceDefault</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681699284"><a href="#local-6989586621681699284"><span class="hs-identifier">names</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699285"><a href="#local-6989586621681699285"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1401"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-identifier">names</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1402"></a><span>    </span><a name="local-6989586621681699286"><a href="#local-6989586621681699286"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699285"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1403"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DEFAULT</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699286"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1404"></a><span>
</span><a name="line-1405"></a><span class="hs-identifier">tcIfaceAlt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceLitAlt</span><span> </span><a name="local-6989586621681699287"><a href="#local-6989586621681699287"><span class="hs-identifier">lit</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699288"><a href="#local-6989586621681699288"><span class="hs-identifier">names</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699289"><a href="#local-6989586621681699289"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1406"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-identifier">names</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1407"></a><span>    </span><a name="local-6989586621681699290"><a href="#local-6989586621681699290"><span class="hs-identifier">lit'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceLit"><span class="hs-identifier hs-var">tcIfaceLit</span></a><span> </span><a href="#local-6989586621681699287"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1408"></a><span>    </span><a name="local-6989586621681699291"><a href="#local-6989586621681699291"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699289"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1409"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitAlt</span><span> </span><a href="#local-6989586621681699290"><span class="hs-identifier hs-var">lit'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699291"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1410"></a><span>
</span><a name="line-1411"></a><span class="hs-comment">-- A case alternative is made quite a bit more complicated</span><span>
</span><a name="line-1412"></a><span class="hs-comment">-- by the fact that we omit type annotations because we can</span><span>
</span><a name="line-1413"></a><span class="hs-comment">-- work them out.  True enough, but its not that easy!</span><span>
</span><a name="line-1414"></a><span class="hs-identifier">tcIfaceAlt</span><span> </span><a name="local-6989586621681699292"><a href="#local-6989586621681699292"><span class="hs-identifier">scrut</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681699293"><a href="#local-6989586621681699293"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699294"><a href="#local-6989586621681699294"><span class="hs-identifier">inst_tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceDataAlt</span><span> </span><a name="local-6989586621681699295"><a href="#local-6989586621681699295"><span class="hs-identifier">data_occ</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699296"><a href="#local-6989586621681699296"><span class="hs-identifier">arg_strs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699297"><a href="#local-6989586621681699297"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1415"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699298"><a href="#local-6989586621681699298"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceDataCon"><span class="hs-identifier hs-var">tcIfaceDataCon</span></a><span> </span><a href="#local-6989586621681699295"><span class="hs-identifier hs-var">data_occ</span></a><span>
</span><a name="line-1416"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">debugIsOn</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699298"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621681699293"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1417"></a><span>               </span><span class="hs-special">(</span><a href="TcRnMonad.html#failIfM"><span class="hs-identifier hs-var">failIfM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699292"><span class="hs-identifier hs-var">scrut</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699298"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699293"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621681699293"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1418"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcIface.html#tcIfaceDataAlt"><span class="hs-identifier hs-var">tcIfaceDataAlt</span></a><span> </span><a href="#local-6989586621681699298"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621681699294"><span class="hs-identifier hs-var">inst_tys</span></a><span> </span><a href="#local-6989586621681699296"><span class="hs-identifier hs-var">arg_strs</span></a><span> </span><a href="#local-6989586621681699297"><span class="hs-identifier hs-var">rhs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1419"></a><span>
</span><a name="line-1420"></a><span class="hs-identifier">tcIfaceDataAlt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FastString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceExpr</span><span>
</span><a name="line-1421"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AltCon</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span class="hs-special">)</span><span>
</span><a name="line-1422"></a><a name="tcIfaceDataAlt"><a href="TcIface.html#tcIfaceDataAlt"><span class="hs-identifier">tcIfaceDataAlt</span></a></a><span> </span><a name="local-6989586621681699299"><a href="#local-6989586621681699299"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621681699300"><a href="#local-6989586621681699300"><span class="hs-identifier">inst_tys</span></a></a><span> </span><a name="local-6989586621681699301"><a href="#local-6989586621681699301"><span class="hs-identifier">arg_strs</span></a></a><span> </span><a name="local-6989586621681699302"><a href="#local-6989586621681699302"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-1423"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699303"><a href="#local-6989586621681699303"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a><span>
</span><a name="line-1424"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699304"><a href="#local-6989586621681699304"><span class="hs-identifier">uniqs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">uniqsFromSupply</span><span> </span><a href="#local-6989586621681699303"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-1425"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699305"><a href="#local-6989586621681699305"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699306"><a href="#local-6989586621681699306"><span class="hs-identifier">arg_ids</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1426"></a><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConRepFSInstPat</span><span> </span><a href="#local-6989586621681699301"><span class="hs-identifier hs-var">arg_strs</span></a><span> </span><a href="#local-6989586621681699304"><span class="hs-identifier hs-var">uniqs</span></a><span> </span><a href="#local-6989586621681699299"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621681699300"><span class="hs-identifier hs-var">inst_tys</span></a><span>
</span><a name="line-1427"></a><span>
</span><a name="line-1428"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699307"><a href="#local-6989586621681699307"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#extendIfaceEnvs"><span class="hs-identifier hs-var">extendIfaceEnvs</span></a><span>  </span><a href="#local-6989586621681699305"><span class="hs-identifier hs-var">ex_tvs</span></a><span>       </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1429"></a><span>                  </span><a href="IfaceEnv.html#extendIfaceIdEnv"><span class="hs-identifier hs-var">extendIfaceIdEnv</span></a><span> </span><a href="#local-6989586621681699306"><span class="hs-identifier hs-var">arg_ids</span></a><span>      </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1430"></a><span>                  </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699302"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1431"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataAlt</span><span> </span><a href="#local-6989586621681699299"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699305"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681699306"><span class="hs-identifier hs-var">arg_ids</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681699307"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1432"></a><span>
</span><a name="line-1433"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                IdInfo
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1440"></a><span>
</span><a name="line-1441"></a><span class="hs-identifier">tcIdDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceIdDetails</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">IdDetails</span><span>
</span><a name="line-1442"></a><a name="tcIdDetails"><a href="TcIface.html#tcIdDetails"><span class="hs-identifier">tcIdDetails</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier hs-var">IfVanillaId</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">VanillaId</span><span>
</span><a name="line-1443"></a><span class="hs-identifier">tcIdDetails</span><span> </span><a name="local-6989586621681699308"><a href="#local-6989586621681699308"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier hs-var">IfDFunId</span><span>
</span><a name="line-1444"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DFunId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isNewTyCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621681699309"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1445"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1446"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681699309"><a href="#local-6989586621681699309"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tcSplitDFunTy</span><span> </span><a href="#local-6989586621681699308"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1447"></a><span>
</span><a name="line-1448"></a><span class="hs-identifier">tcIdDetails</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfRecSelId</span><span> </span><a name="local-6989586621681699310"><a href="#local-6989586621681699310"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681699311"><a href="#local-6989586621681699311"><span class="hs-identifier">naughty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1449"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699314"><a href="#local-6989586621681699314"><span class="hs-identifier">tc'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">RecSelData</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcIface.html#tcIfaceTyCon"><span class="hs-identifier hs-var">tcIfaceTyCon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1450"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecSelPatSyn</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621681699312"><span class="hs-identifier hs-var">tyThingPatSyn</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcIface.html#tcIfaceDecl"><span class="hs-identifier hs-var">tcIfaceDecl</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-1451"></a><span>                       </span><a href="#local-6989586621681699310"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1452"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecSelId</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sel_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699314"><span class="hs-identifier hs-var">tc'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sel_naughty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699311"><span class="hs-identifier hs-var">naughty</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1453"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1454"></a><span>    </span><a name="local-6989586621681699312"><a href="#local-6989586621681699312"><span class="hs-identifier">tyThingPatSyn</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AConLike</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynCon</span><span> </span><a name="local-6989586621681699313"><a href="#local-6989586621681699313"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699313"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1455"></a><span>    </span><span class="hs-identifier">tyThingPatSyn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;tcIdDetails: expecting patsyn&quot;</span><span>
</span><a name="line-1456"></a><span>
</span><a name="line-1457"></a><span class="hs-identifier">tcIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TopLevelFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceIdInfo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">IdInfo</span><span>
</span><a name="line-1458"></a><a name="tcIdInfo"><a href="TcIface.html#tcIdInfo"><span class="hs-identifier">tcIdInfo</span></a></a><span> </span><a name="local-6989586621681699315"><a href="#local-6989586621681699315"><span class="hs-identifier">ignore_prags</span></a></a><span> </span><a name="local-6989586621681699316"><a href="#local-6989586621681699316"><span class="hs-identifier">toplvl</span></a></a><span> </span><a name="local-6989586621681699317"><a href="#local-6989586621681699317"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621681699318"><a href="#local-6989586621681699318"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681699319"><a href="#local-6989586621681699319"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1459"></a><span>    </span><a name="local-6989586621681699334"><a href="#local-6989586621681699334"><span class="hs-identifier">lcl_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span>
</span><a name="line-1460"></a><span>    </span><span class="hs-comment">-- Set the CgInfo to something sensible but uninformative before</span><span>
</span><a name="line-1461"></a><span>    </span><span class="hs-comment">-- we start; default assumption is that it has CAFs</span><span>
</span><a name="line-1462"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699335"><a href="#local-6989586621681699335"><span class="hs-identifier">init_info</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">if_boot</span><span> </span><a href="#local-6989586621681699334"><span class="hs-identifier hs-var">lcl_env</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vanillaIdInfo</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">setUnfoldingInfo</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">BootUnfolding</span><span>
</span><a name="line-1463"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vanillaIdInfo</span><span>
</span><a name="line-1464"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681699315"><span class="hs-identifier hs-var">ignore_prags</span></a><span>
</span><a name="line-1465"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699335"><span class="hs-identifier hs-var">init_info</span></a><span>
</span><a name="line-1466"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699319"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1467"></a><span>                </span><span class="hs-identifier hs-var">NoInfo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699335"><span class="hs-identifier hs-var">init_info</span></a><span>
</span><a name="line-1468"></a><span>                </span><span class="hs-identifier hs-var">HasInfo</span><span> </span><a name="local-6989586621681699336"><a href="#local-6989586621681699336"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldlM</span><span> </span><a href="#local-6989586621681699320"><span class="hs-identifier hs-var">tcPrag</span></a><span> </span><a href="#local-6989586621681699335"><span class="hs-identifier hs-var">init_info</span></a><span> </span><a href="#local-6989586621681699336"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1469"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1470"></a><span>    </span><span class="hs-identifier">tcPrag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IdInfo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceInfoItem</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">IdInfo</span><span>
</span><a name="line-1471"></a><span>    </span><a name="local-6989586621681699320"><a href="#local-6989586621681699320"><span class="hs-identifier">tcPrag</span></a></a><span> </span><a name="local-6989586621681699321"><a href="#local-6989586621681699321"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-identifier hs-var">HsNoCafRefs</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699321"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">setCafInfo</span><span class="hs-special">`</span><span>   </span><span class="hs-identifier hs-var">NoCafRefs</span><span class="hs-special">)</span><span>
</span><a name="line-1472"></a><span>    </span><span class="hs-identifier">tcPrag</span><span> </span><a name="local-6989586621681699322"><a href="#local-6989586621681699322"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsArity</span><span> </span><a name="local-6989586621681699323"><a href="#local-6989586621681699323"><span class="hs-identifier">arity</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699322"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">setArityInfo</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681699323"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-1473"></a><span>    </span><span class="hs-identifier">tcPrag</span><span> </span><a name="local-6989586621681699324"><a href="#local-6989586621681699324"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsStrictness</span><span> </span><a name="local-6989586621681699325"><a href="#local-6989586621681699325"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699324"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">setStrictnessInfo</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681699325"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-1474"></a><span>    </span><span class="hs-identifier">tcPrag</span><span> </span><a name="local-6989586621681699326"><a href="#local-6989586621681699326"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInline</span><span> </span><a name="local-6989586621681699327"><a href="#local-6989586621681699327"><span class="hs-identifier">prag</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699326"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">setInlinePragInfo</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681699327"><span class="hs-identifier hs-var">prag</span></a><span class="hs-special">)</span><span>
</span><a name="line-1475"></a><span>    </span><span class="hs-identifier">tcPrag</span><span> </span><a name="local-6989586621681699328"><a href="#local-6989586621681699328"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-identifier hs-var">HsLevity</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699328"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">setNeverLevPoly</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681699318"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1476"></a><span>
</span><a name="line-1477"></a><span>        </span><span class="hs-comment">-- The next two are lazy, so they don't transitively suck stuff in</span><span>
</span><a name="line-1478"></a><span>    </span><span class="hs-identifier">tcPrag</span><span> </span><a name="local-6989586621681699329"><a href="#local-6989586621681699329"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsUnfold</span><span> </span><a name="local-6989586621681699330"><a href="#local-6989586621681699330"><span class="hs-identifier">lb</span></a></a><span> </span><a name="local-6989586621681699331"><a href="#local-6989586621681699331"><span class="hs-identifier">if_unf</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1479"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699332"><a href="#local-6989586621681699332"><span class="hs-identifier">unf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcUnfolding"><span class="hs-identifier hs-var">tcUnfolding</span></a><span> </span><a href="#local-6989586621681699316"><span class="hs-identifier hs-var">toplvl</span></a><span> </span><a href="#local-6989586621681699317"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699318"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681699329"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621681699331"><span class="hs-identifier hs-var">if_unf</span></a><span>
</span><a name="line-1480"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699333"><a href="#local-6989586621681699333"><span class="hs-identifier">info1</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681699330"><span class="hs-identifier hs-var">lb</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699329"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">setOccInfo</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">strongLoopBreaker</span><span>
</span><a name="line-1481"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699329"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1482"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699333"><span class="hs-identifier hs-var">info1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">setUnfoldingInfo</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681699332"><span class="hs-identifier hs-var">unf</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1483"></a><span>
</span><a name="line-1484"></a><span class="hs-identifier">tcJoinInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceJoinInfo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">JoinArity</span><span>
</span><a name="line-1485"></a><a name="tcJoinInfo"><a href="TcIface.html#tcJoinInfo"><span class="hs-identifier">tcJoinInfo</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceJoinPoint</span><span> </span><a name="local-6989586621681699337"><a href="#local-6989586621681699337"><span class="hs-identifier">ar</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681699337"><span class="hs-identifier hs-var">ar</span></a><span>
</span><a name="line-1486"></a><span class="hs-identifier">tcJoinInfo</span><span> </span><span class="hs-identifier hs-var">IfaceNotJoinPoint</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1487"></a><span>
</span><a name="line-1488"></a><span class="hs-identifier">tcUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TopLevelFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IdInfo</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceUnfolding</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">Unfolding</span><span>
</span><a name="line-1489"></a><a name="tcUnfolding"><a href="TcIface.html#tcUnfolding"><span class="hs-identifier">tcUnfolding</span></a></a><span> </span><a name="local-6989586621681699338"><a href="#local-6989586621681699338"><span class="hs-identifier">toplvl</span></a></a><span> </span><a name="local-6989586621681699339"><a href="#local-6989586621681699339"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681699340"><a href="#local-6989586621681699340"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfCoreUnfold</span><span> </span><a name="local-6989586621681699341"><a href="#local-6989586621681699341"><span class="hs-identifier">stable</span></a></a><span> </span><a name="local-6989586621681699342"><a href="#local-6989586621681699342"><span class="hs-identifier">if_expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699344"><a href="#local-6989586621681699344"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1491"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699345"><a href="#local-6989586621681699345"><span class="hs-identifier">mb_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcPragExpr"><span class="hs-identifier hs-var">tcPragExpr</span></a><span> </span><a href="#local-6989586621681699338"><span class="hs-identifier hs-var">toplvl</span></a><span> </span><a href="#local-6989586621681699339"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699342"><span class="hs-identifier hs-var">if_expr</span></a><span>
</span><a name="line-1492"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699346"><a href="#local-6989586621681699346"><span class="hs-identifier">unf_src</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681699341"><span class="hs-identifier hs-var">stable</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InlineStable</span><span>
</span><a name="line-1493"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InlineRhs</span><span>
</span><a name="line-1494"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699345"><span class="hs-identifier hs-var">mb_expr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1495"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NoUnfolding</span><span>
</span><a name="line-1496"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699347"><a href="#local-6989586621681699347"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkUnfolding</span><span> </span><a href="#local-6989586621681699344"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681699346"><span class="hs-identifier hs-var">unf_src</span></a><span>
</span><a name="line-1497"></a><span>                           </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-comment">{- Top level -}</span><span>
</span><a name="line-1498"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isBottomingSig</span><span> </span><a href="#local-6989586621681699343"><span class="hs-identifier hs-var">strict_sig</span></a><span class="hs-special">)</span><span>
</span><a name="line-1499"></a><span>                           </span><a href="#local-6989586621681699347"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1500"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-1501"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1502"></a><span>     </span><span class="hs-comment">-- Strictness should occur before unfolding!</span><span>
</span><a name="line-1503"></a><span>    </span><a name="local-6989586621681699343"><a href="#local-6989586621681699343"><span class="hs-identifier">strict_sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictnessInfo</span><span> </span><a href="#local-6989586621681699340"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-1504"></a><span class="hs-identifier">tcUnfolding</span><span> </span><a name="local-6989586621681699348"><a href="#local-6989586621681699348"><span class="hs-identifier">toplvl</span></a></a><span> </span><a name="local-6989586621681699349"><a href="#local-6989586621681699349"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfCompulsory</span><span> </span><a name="local-6989586621681699350"><a href="#local-6989586621681699350"><span class="hs-identifier">if_expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1505"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699351"><a href="#local-6989586621681699351"><span class="hs-identifier">mb_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcPragExpr"><span class="hs-identifier hs-var">tcPragExpr</span></a><span> </span><a href="#local-6989586621681699348"><span class="hs-identifier hs-var">toplvl</span></a><span> </span><a href="#local-6989586621681699349"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699350"><span class="hs-identifier hs-var">if_expr</span></a><span>
</span><a name="line-1506"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699351"><span class="hs-identifier hs-var">mb_expr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1507"></a><span>                    </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NoUnfolding</span><span>
</span><a name="line-1508"></a><span>                    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699352"><a href="#local-6989586621681699352"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkCompulsoryUnfolding</span><span> </span><a href="#local-6989586621681699352"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1509"></a><span>
</span><a name="line-1510"></a><span class="hs-identifier">tcUnfolding</span><span> </span><a name="local-6989586621681699353"><a href="#local-6989586621681699353"><span class="hs-identifier">toplvl</span></a></a><span> </span><a name="local-6989586621681699354"><a href="#local-6989586621681699354"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfInlineRule</span><span> </span><a name="local-6989586621681699355"><a href="#local-6989586621681699355"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621681699356"><a href="#local-6989586621681699356"><span class="hs-identifier">unsat_ok</span></a></a><span> </span><a name="local-6989586621681699357"><a href="#local-6989586621681699357"><span class="hs-identifier">boring_ok</span></a></a><span> </span><a name="local-6989586621681699358"><a href="#local-6989586621681699358"><span class="hs-identifier">if_expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1511"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699360"><a href="#local-6989586621681699360"><span class="hs-identifier">mb_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcPragExpr"><span class="hs-identifier hs-var">tcPragExpr</span></a><span> </span><a href="#local-6989586621681699353"><span class="hs-identifier hs-var">toplvl</span></a><span> </span><a href="#local-6989586621681699354"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699358"><span class="hs-identifier hs-var">if_expr</span></a><span>
</span><a name="line-1512"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699360"><span class="hs-identifier hs-var">mb_expr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1513"></a><span>                    </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NoUnfolding</span><span>
</span><a name="line-1514"></a><span>                    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699361"><a href="#local-6989586621681699361"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkCoreUnfolding</span><span> </span><span class="hs-identifier hs-var">InlineStable</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621681699361"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621681699359"><span class="hs-identifier hs-var">guidance</span></a><span> </span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-1515"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1516"></a><span>    </span><a name="local-6989586621681699359"><a href="#local-6989586621681699359"><span class="hs-identifier">guidance</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">UnfWhen</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ug_arity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699355"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ug_unsat_ok</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699356"><span class="hs-identifier hs-var">unsat_ok</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ug_boring_ok</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699357"><span class="hs-identifier hs-var">boring_ok</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1517"></a><span>
</span><a name="line-1518"></a><span class="hs-identifier">tcUnfolding</span><span> </span><a name="local-6989586621681699362"><a href="#local-6989586621681699362"><span class="hs-identifier">_toplvl</span></a></a><span> </span><a name="local-6989586621681699363"><a href="#local-6989586621681699363"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621681699364"><a href="#local-6989586621681699364"><span class="hs-identifier">dfun_ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfDFunUnfold</span><span> </span><a name="local-6989586621681699365"><a href="#local-6989586621681699365"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-6989586621681699366"><a href="#local-6989586621681699366"><span class="hs-identifier">ops</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1519"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceBndrs"><span class="hs-identifier hs-var">bindIfaceBndrs</span></a><span> </span><a href="#local-6989586621681699365"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699369"><a href="#local-6989586621681699369"><span class="hs-identifier">bs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1520"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699370"><a href="#local-6989586621681699370"><span class="hs-identifier">mb_ops1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#forkM_maybe"><span class="hs-identifier hs-var">forkM_maybe</span></a><span> </span><a href="#local-6989586621681699367"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699366"><span class="hs-identifier hs-var">ops</span></a><span>
</span><a name="line-1521"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699370"><span class="hs-identifier hs-var">mb_ops1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1522"></a><span>                    </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">noUnfolding</span><span>
</span><a name="line-1523"></a><span>                    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699371"><a href="#local-6989586621681699371"><span class="hs-identifier">ops1</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkDFunUnfolding</span><span> </span><a href="#local-6989586621681699369"><span class="hs-identifier hs-var">bs'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">classDataCon</span><span> </span><a href="#local-6989586621681699368"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699371"><span class="hs-identifier hs-var">ops1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1524"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1525"></a><span>    </span><a name="local-6989586621681699367"><a href="#local-6989586621681699367"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Class ops for dfun&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699363"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1526"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681699368"><a href="#local-6989586621681699368"><span class="hs-identifier">cls</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tcSplitDFunTy</span><span> </span><a href="#local-6989586621681699364"><span class="hs-identifier hs-var">dfun_ty</span></a><span>
</span><a name="line-1527"></a><span>
</span><a name="line-1528"></a><span class="hs-comment">{-
For unfoldings we try to do the job lazily, so that we never type check
an unfolding that isn't going to be looked at.
-}</span><span>
</span><a name="line-1532"></a><span>
</span><a name="line-1533"></a><span class="hs-identifier">tcPragExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TopLevelFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span class="hs-special">)</span><span>
</span><a name="line-1534"></a><a name="tcPragExpr"><a href="TcIface.html#tcPragExpr"><span class="hs-identifier">tcPragExpr</span></a></a><span> </span><a name="local-6989586621681699372"><a href="#local-6989586621681699372"><span class="hs-identifier">toplvl</span></a></a><span> </span><a name="local-6989586621681699373"><a href="#local-6989586621681699373"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621681699374"><a href="#local-6989586621681699374"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-1535"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#forkM_maybe"><span class="hs-identifier hs-var">forkM_maybe</span></a><span> </span><a href="#local-6989586621681699375"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1536"></a><span>    </span><a name="local-6989586621681699384"><a href="#local-6989586621681699384"><span class="hs-identifier">core_expr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceExpr"><span class="hs-identifier hs-var">tcIfaceExpr</span></a><span> </span><a href="#local-6989586621681699374"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1537"></a><span>
</span><a name="line-1538"></a><span>    </span><span class="hs-comment">-- Check for type consistency in the unfolding</span><span>
</span><a name="line-1539"></a><span>    </span><span class="hs-comment">-- See Note [Linting Unfoldings from Interfaces]</span><span>
</span><a name="line-1540"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isTopLevel</span><span> </span><a href="#local-6989586621681699372"><span class="hs-identifier hs-var">toplvl</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcRnMonad.html#whenGOptM"><span class="hs-identifier hs-var">whenGOptM</span></a><span> </span><span class="hs-identifier hs-var">Opt_DoCoreLinting</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1541"></a><span>        </span><a name="local-6989586621681699385"><a href="#local-6989586621681699385"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681699376"><span class="hs-identifier hs-var">get_in_scope</span></a><span>
</span><a name="line-1542"></a><span>        </span><a name="local-6989586621681699386"><a href="#local-6989586621681699386"><span class="hs-identifier">dflags</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1543"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="CoreLint.html#lintUnfolding"><span class="hs-identifier hs-var">lintUnfolding</span></a><span> </span><a href="#local-6989586621681699386"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-identifier hs-var">noSrcLoc</span><span> </span><a href="#local-6989586621681699385"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621681699384"><span class="hs-identifier hs-var">core_expr'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1544"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1545"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699387"><a href="#local-6989586621681699387"><span class="hs-identifier">fail_msg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699388"><a href="#local-6989586621681699388"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getIfModule"><span class="hs-identifier hs-var">getIfModule</span></a><span>
</span><a name="line-1546"></a><span>                              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;Iface Lint failure&quot;</span><span>
</span><a name="line-1547"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In interface for&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699388"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-1548"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><a href="#local-6989586621681699375"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621681699387"><span class="hs-identifier hs-var">fail_msg</span></a><span>
</span><a name="line-1549"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699373"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">equals</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699384"><span class="hs-identifier hs-var">core_expr'</span></a><span>
</span><a name="line-1550"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Iface expr =&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699374"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1551"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699384"><span class="hs-identifier hs-var">core_expr'</span></a><span>
</span><a name="line-1552"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1553"></a><span>    </span><a name="local-6989586621681699375"><a href="#local-6989586621681699375"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Unfolding of&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699373"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1554"></a><span>
</span><a name="line-1555"></a><span>    </span><span class="hs-identifier">get_in_scope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">VarSet</span><span> </span><span class="hs-comment">-- Totally disgusting; but just for linting</span><span>
</span><a name="line-1556"></a><span>    </span><a name="local-6989586621681699376"><a href="#local-6989586621681699376"><span class="hs-identifier">get_in_scope</span></a></a><span>
</span><a name="line-1557"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699378"><a href="#local-6989586621681699378"><span class="hs-identifier">gbl_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699379"><a href="#local-6989586621681699379"><span class="hs-identifier">lcl_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a><span>
</span><a name="line-1558"></a><span>             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699382"><a href="#local-6989586621681699382"><span class="hs-identifier">rec_ids</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">if_rec_types</span><span> </span><a href="#local-6989586621681699378"><span class="hs-identifier hs-var">gbl_env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1559"></a><span>                            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1560"></a><span>                            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681699380"><a href="#local-6989586621681699380"><span class="hs-identifier">get_env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1561"></a><span>                               </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699381"><a href="#local-6989586621681699381"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699380"><span class="hs-identifier hs-var">get_env</span></a><span>
</span><a name="line-1562"></a><span>                               </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeEnvIds</span><span> </span><a href="#local-6989586621681699381"><span class="hs-identifier hs-var">type_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1563"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699377"><span class="hs-identifier hs-var">bindingsVars</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">if_tv_env</span><span> </span><a href="#local-6989586621681699379"><span class="hs-identifier hs-var">lcl_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unionVarSet</span><span class="hs-special">`</span><span>
</span><a name="line-1564"></a><span>                       </span><a href="#local-6989586621681699377"><span class="hs-identifier hs-var">bindingsVars</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">if_id_env</span><span> </span><a href="#local-6989586621681699379"><span class="hs-identifier hs-var">lcl_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unionVarSet</span><span class="hs-special">`</span><span>
</span><a name="line-1565"></a><span>                       </span><span class="hs-identifier hs-var">mkVarSet</span><span> </span><a href="#local-6989586621681699382"><span class="hs-identifier hs-var">rec_ids</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1566"></a><span>
</span><a name="line-1567"></a><span>    </span><span class="hs-identifier">bindingsVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FastStringEnv</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarSet</span><span>
</span><a name="line-1568"></a><span>    </span><a name="local-6989586621681699377"><a href="#local-6989586621681699377"><span class="hs-identifier">bindingsVars</span></a></a><span> </span><a name="local-6989586621681699383"><a href="#local-6989586621681699383"><span class="hs-identifier">ufm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarSet</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nonDetEltsUFM</span><span> </span><a href="#local-6989586621681699383"><span class="hs-identifier hs-var">ufm</span></a><span>
</span><a name="line-1569"></a><span>      </span><span class="hs-comment">-- It's OK to use nonDetEltsUFM here because we immediately forget</span><span>
</span><a name="line-1570"></a><span>      </span><span class="hs-comment">-- the ordering by creating a set</span><span>
</span><a name="line-1571"></a><span>
</span><a name="line-1572"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Getting from Names to TyThings
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1579"></a><span>
</span><a name="line-1580"></a><span class="hs-identifier">tcIfaceGlobal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span>
</span><a name="line-1581"></a><a name="tcIfaceGlobal"><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier">tcIfaceGlobal</span></a></a><span> </span><a name="local-6989586621681699389"><a href="#local-6989586621681699389"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1582"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699397"><a href="#local-6989586621681699397"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">wiredInNameTyThing_maybe</span><span> </span><a href="#local-6989586621681699389"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1583"></a><span>        </span><span class="hs-comment">-- Wired-in things include TyCons, DataCons, and Ids</span><span>
</span><a name="line-1584"></a><span>        </span><span class="hs-comment">-- Even though we are in an interface file, we want to make</span><span>
</span><a name="line-1585"></a><span>        </span><span class="hs-comment">-- sure the instances and RULES of this thing (particularly TyCon) are loaded</span><span>
</span><a name="line-1586"></a><span>        </span><span class="hs-comment">-- Imagine: f :: Double -&gt; Double</span><span>
</span><a name="line-1587"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="LoadIface.html#ifCheckWiredInThing"><span class="hs-identifier hs-var">ifCheckWiredInThing</span></a><span> </span><a href="#local-6989586621681699397"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699397"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1588"></a><span>
</span><a name="line-1589"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1590"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699398"><a href="#local-6989586621681699398"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-1591"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">if_rec_types</span><span> </span><a href="#local-6989586621681699398"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>    </span><span class="hs-comment">-- Note [Tying the knot]</span><span>
</span><a name="line-1592"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699399"><a href="#local-6989586621681699399"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699400"><a href="#local-6989586621681699400"><span class="hs-identifier">get_type_env</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1593"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">nameIsLocalOrFrom</span><span> </span><a href="#local-6989586621681699399"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621681699389"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1594"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>           </span><span class="hs-comment">-- It's defined in the module being compiled</span><span>
</span><a name="line-1595"></a><span>                </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699401"><a href="#local-6989586621681699401"><span class="hs-identifier">type_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681699400"><span class="hs-identifier hs-var">get_type_env</span></a><span>         </span><span class="hs-comment">-- yuk</span><span>
</span><a name="line-1596"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupNameEnv</span><span> </span><a href="#local-6989586621681699401"><span class="hs-identifier hs-var">type_env</span></a><span> </span><a href="#local-6989586621681699389"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1597"></a><span>                    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699402"><a href="#local-6989586621681699402"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699402"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1598"></a><span>                    </span><span class="hs-comment">-- See Note [Knot-tying fallback on boot]</span><span>
</span><a name="line-1599"></a><span>                    </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681699390"><span class="hs-identifier hs-var">via_external</span></a><span>
</span><a name="line-1600"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-1601"></a><span>
</span><a name="line-1602"></a><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681699390"><span class="hs-identifier hs-var">via_external</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1603"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1604"></a><span>    </span><a name="local-6989586621681699390"><a href="#local-6989586621681699390"><span class="hs-identifier">via_external</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span>
</span><a name="line-1605"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699391"><a href="#local-6989586621681699391"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a><span>
</span><a name="line-1606"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699392"><a href="#local-6989586621681699392"><span class="hs-identifier">mb_thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookupTypeHscEnv</span><span> </span><a href="#local-6989586621681699391"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621681699389"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1607"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699392"><span class="hs-identifier hs-var">mb_thing</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1608"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699393"><a href="#local-6989586621681699393"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699393"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1609"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1610"></a><span>
</span><a name="line-1611"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699394"><a href="#local-6989586621681699394"><span class="hs-identifier">mb_thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#importDecl"><span class="hs-identifier hs-var">importDecl</span></a><span> </span><a href="#local-6989586621681699389"><span class="hs-identifier hs-var">name</span></a><span>   </span><span class="hs-comment">-- It's imported; go get it</span><span>
</span><a name="line-1612"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699394"><span class="hs-identifier hs-var">mb_thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1613"></a><span>            </span><span class="hs-identifier hs-var">Failed</span><span> </span><a name="local-6989586621681699395"><a href="#local-6989586621681699395"><span class="hs-identifier">err</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnMonad.html#failIfM"><span class="hs-identifier hs-var">failIfM</span></a><span> </span><a href="#local-6989586621681699395"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-1614"></a><span>            </span><span class="hs-identifier hs-var">Succeeded</span><span> </span><a name="local-6989586621681699396"><a href="#local-6989586621681699396"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699396"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1615"></a><span>        </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1616"></a><span>
</span><a name="line-1617"></a><span class="hs-comment">-- Note [Tying the knot]</span><span>
</span><a name="line-1618"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-1619"></a><span class="hs-comment">-- The if_rec_types field is used when we are compiling M.hs, which indirectly</span><span>
</span><a name="line-1620"></a><span class="hs-comment">-- imports Foo.hi, which mentions M.T Then we look up M.T in M's type</span><span>
</span><a name="line-1621"></a><span class="hs-comment">-- environment, which is splatted into if_rec_types after we've built M's type</span><span>
</span><a name="line-1622"></a><span class="hs-comment">-- envt.</span><span>
</span><a name="line-1623"></a><span class="hs-comment">--</span><span>
</span><a name="line-1624"></a><span class="hs-comment">-- This is a dark and complicated part of GHC type checking, with a lot</span><span>
</span><a name="line-1625"></a><span class="hs-comment">-- of moving parts.  Interested readers should also look at:</span><span>
</span><a name="line-1626"></a><span class="hs-comment">--</span><span>
</span><a name="line-1627"></a><span class="hs-comment">--      * Note [Knot-tying typecheckIface]</span><span>
</span><a name="line-1628"></a><span class="hs-comment">--      * Note [DFun knot-tying]</span><span>
</span><a name="line-1629"></a><span class="hs-comment">--      * Note [hsc_type_env_var hack]</span><span>
</span><a name="line-1630"></a><span class="hs-comment">--      * Note [Knot-tying fallback on boot]</span><span>
</span><a name="line-1631"></a><span class="hs-comment">--</span><span>
</span><a name="line-1632"></a><span class="hs-comment">-- There is also a wiki page on the subject, see:</span><span>
</span><a name="line-1633"></a><span class="hs-comment">--</span><span>
</span><a name="line-1634"></a><span class="hs-comment">--      https://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/TyingTheKnot</span><span>
</span><a name="line-1635"></a><span>
</span><a name="line-1636"></a><span class="hs-comment">-- Note [Knot-tying fallback on boot]</span><span>
</span><a name="line-1637"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-1638"></a><span class="hs-comment">-- Suppose that you are typechecking A.hs, which transitively imports,</span><span>
</span><a name="line-1639"></a><span class="hs-comment">-- via B.hs, A.hs-boot. When we poke on B.hs and discover that it</span><span>
</span><a name="line-1640"></a><span class="hs-comment">-- has a reference to a type T from A, what TyThing should we wire</span><span>
</span><a name="line-1641"></a><span class="hs-comment">-- it up with? Clearly, if we have already typechecked T and</span><span>
</span><a name="line-1642"></a><span class="hs-comment">-- added it into the type environment, we should go ahead and use that</span><span>
</span><a name="line-1643"></a><span class="hs-comment">-- type. But what if we haven't typechecked it yet?</span><span>
</span><a name="line-1644"></a><span class="hs-comment">--</span><span>
</span><a name="line-1645"></a><span class="hs-comment">-- For the longest time, GHC adopted the policy that this was</span><span>
</span><a name="line-1646"></a><span class="hs-comment">-- *an error condition*; that you MUST NEVER poke on B.hs's reference</span><span>
</span><a name="line-1647"></a><span class="hs-comment">-- to a T defined in A.hs until A.hs has gotten around to kind-checking</span><span>
</span><a name="line-1648"></a><span class="hs-comment">-- T and adding it to the env. However, actually ensuring this is the</span><span>
</span><a name="line-1649"></a><span class="hs-comment">-- case has proven to be a bug farm, because it's really difficult to</span><span>
</span><a name="line-1650"></a><span class="hs-comment">-- actually ensure this never happens. The problem was especially poignant</span><span>
</span><a name="line-1651"></a><span class="hs-comment">-- with type family consistency checks, which eagerly happen before any</span><span>
</span><a name="line-1652"></a><span class="hs-comment">-- typechecking takes place.</span><span>
</span><a name="line-1653"></a><span class="hs-comment">--</span><span>
</span><a name="line-1654"></a><span class="hs-comment">-- Today, we take a different strategy: if we ever try to access</span><span>
</span><a name="line-1655"></a><span class="hs-comment">-- an entity from A which doesn't exist, we just fall back on the</span><span>
</span><a name="line-1656"></a><span class="hs-comment">-- definition of A from the hs-boot file. This is complicated in</span><span>
</span><a name="line-1657"></a><span class="hs-comment">-- its own way: it means that you may end up with a mix of A.hs and</span><span>
</span><a name="line-1658"></a><span class="hs-comment">-- A.hs-boot TyThings during the course of typechecking.  We don't</span><span>
</span><a name="line-1659"></a><span class="hs-comment">-- think (and have not observed) any cases where this would cause</span><span>
</span><a name="line-1660"></a><span class="hs-comment">-- problems, but the hypothetical situation one might worry about</span><span>
</span><a name="line-1661"></a><span class="hs-comment">-- is something along these lines in Core:</span><span>
</span><a name="line-1662"></a><span class="hs-comment">--</span><span>
</span><a name="line-1663"></a><span class="hs-comment">--    case x of</span><span>
</span><a name="line-1664"></a><span class="hs-comment">--        A -&gt; e1</span><span>
</span><a name="line-1665"></a><span class="hs-comment">--        B -&gt; e2</span><span>
</span><a name="line-1666"></a><span class="hs-comment">--</span><span>
</span><a name="line-1667"></a><span class="hs-comment">-- If, when typechecking this, we find x :: T, and the T we are hooked</span><span>
</span><a name="line-1668"></a><span class="hs-comment">-- up with is the abstract one from the hs-boot file, rather than the</span><span>
</span><a name="line-1669"></a><span class="hs-comment">-- one defined in this module with constructors A and B.  But it's hard</span><span>
</span><a name="line-1670"></a><span class="hs-comment">-- to see how this could happen, especially because the reference to</span><span>
</span><a name="line-1671"></a><span class="hs-comment">-- the constructor (A and B) means that GHC will always typecheck</span><span>
</span><a name="line-1672"></a><span class="hs-comment">-- this expression *after* typechecking T.</span><span>
</span><a name="line-1673"></a><span>
</span><a name="line-1674"></a><span class="hs-identifier">tcIfaceTyConByName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfExtName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span>
</span><a name="line-1675"></a><a name="tcIfaceTyConByName"><a href="TcIface.html#tcIfaceTyConByName"><span class="hs-identifier">tcIfaceTyConByName</span></a></a><span> </span><a name="local-6989586621681699403"><a href="#local-6989586621681699403"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1676"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699404"><a href="#local-6989586621681699404"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a><span> </span><a href="#local-6989586621681699403"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1677"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyThingTyCon</span><span> </span><a href="#local-6989586621681699404"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1678"></a><span>
</span><a name="line-1679"></a><span class="hs-identifier">tcIfaceTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceTyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span>
</span><a name="line-1680"></a><a name="tcIfaceTyCon"><a href="TcIface.html#tcIfaceTyCon"><span class="hs-identifier">tcIfaceTyCon</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTyCon</span><span> </span><a name="local-6989586621681699405"><a href="#local-6989586621681699405"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621681699406"><a href="#local-6989586621681699406"><span class="hs-identifier">info</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1681"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699407"><a href="#local-6989586621681699407"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a><span> </span><a href="#local-6989586621681699405"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1682"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">ifaceTyConIsPromoted</span><span> </span><a href="#local-6989586621681699406"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1683"></a><span>           </span><span class="hs-identifier hs-var">NotPromoted</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">tyThingTyCon</span><span> </span><a href="#local-6989586621681699407"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1684"></a><span>           </span><span class="hs-identifier hs-var">IsPromoted</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">promoteDataCon</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tyThingDataCon</span><span> </span><a href="#local-6989586621681699407"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1685"></a><span>
</span><a name="line-1686"></a><span class="hs-identifier">tcIfaceCoAxiom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CoAxiom</span><span> </span><span class="hs-identifier hs-type">Branched</span><span class="hs-special">)</span><span>
</span><a name="line-1687"></a><a name="tcIfaceCoAxiom"><a href="TcIface.html#tcIfaceCoAxiom"><span class="hs-identifier">tcIfaceCoAxiom</span></a></a><span> </span><a name="local-6989586621681699408"><a href="#local-6989586621681699408"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699409"><a href="#local-6989586621681699409"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceImplicit"><span class="hs-identifier hs-var">tcIfaceImplicit</span></a><span> </span><a href="#local-6989586621681699408"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1688"></a><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyThingCoAxiom</span><span> </span><a href="#local-6989586621681699409"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1689"></a><span>
</span><a name="line-1690"></a><span>
</span><a name="line-1691"></a><span class="hs-identifier">tcIfaceCoAxiomRule</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfLclName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">CoAxiomRule</span><span>
</span><a name="line-1692"></a><span class="hs-comment">-- Unlike CoAxioms, which arise form user 'type instance' declarations,</span><span>
</span><a name="line-1693"></a><span class="hs-comment">-- there are a fixed set of CoAxiomRules,</span><span>
</span><a name="line-1694"></a><span class="hs-comment">-- currently enumerated in typeNatCoAxiomRules</span><span>
</span><a name="line-1695"></a><a name="tcIfaceCoAxiomRule"><a href="TcIface.html#tcIfaceCoAxiomRule"><span class="hs-identifier">tcIfaceCoAxiomRule</span></a></a><span> </span><a name="local-6989586621681699410"><a href="#local-6989586621681699410"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1696"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621681699410"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="TcTypeNats.html#typeNatCoAxiomRules"><span class="hs-identifier hs-var">typeNatCoAxiomRules</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1697"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699411"><a href="#local-6989586621681699411"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699411"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-1698"></a><span>        </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tcIfaceCoAxiomRule&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699410"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1699"></a><span>
</span><a name="line-1700"></a><span class="hs-identifier">tcIfaceDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span>
</span><a name="line-1701"></a><a name="tcIfaceDataCon"><a href="TcIface.html#tcIfaceDataCon"><span class="hs-identifier">tcIfaceDataCon</span></a></a><span> </span><a name="local-6989586621681699412"><a href="#local-6989586621681699412"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699413"><a href="#local-6989586621681699413"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a><span> </span><a href="#local-6989586621681699412"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1702"></a><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699413"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1703"></a><span>                                </span><span class="hs-identifier hs-var">AConLike</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><a name="local-6989586621681699414"><a href="#local-6989586621681699414"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699414"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-1704"></a><span>                                </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tcIfaceExtDC&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699412"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699413"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1705"></a><span>
</span><a name="line-1706"></a><span class="hs-identifier">tcIfaceExtId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-1707"></a><a name="tcIfaceExtId"><a href="TcIface.html#tcIfaceExtId"><span class="hs-identifier">tcIfaceExtId</span></a></a><span> </span><a name="local-6989586621681699415"><a href="#local-6989586621681699415"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699416"><a href="#local-6989586621681699416"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a><span> </span><a href="#local-6989586621681699415"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1708"></a><span>                       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699416"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1709"></a><span>                          </span><span class="hs-identifier hs-var">AnId</span><span> </span><a name="local-6989586621681699417"><a href="#local-6989586621681699417"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699417"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1710"></a><span>                          </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tcIfaceExtId&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699415"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699416"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1711"></a><span>
</span><a name="line-1712"></a><span class="hs-comment">-- See Note [Resolving never-exported Names in TcIface]</span><span>
</span><a name="line-1713"></a><span class="hs-identifier">tcIfaceImplicit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span>
</span><a name="line-1714"></a><a name="tcIfaceImplicit"><a href="TcIface.html#tcIfaceImplicit"><span class="hs-identifier">tcIfaceImplicit</span></a></a><span> </span><a name="local-6989586621681699418"><a href="#local-6989586621681699418"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1715"></a><span>    </span><a name="local-6989586621681699419"><a href="#local-6989586621681699419"><span class="hs-identifier">lcl_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a><span>
</span><a name="line-1716"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">if_implicits_env</span><span> </span><a href="#local-6989586621681699419"><span class="hs-identifier hs-var">lcl_env</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1717"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcIface.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a><span> </span><a href="#local-6989586621681699418"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1718"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699420"><a href="#local-6989586621681699420"><span class="hs-identifier">tenv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1719"></a><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupTypeEnv</span><span> </span><a href="#local-6989586621681699420"><span class="hs-identifier hs-var">tenv</span></a><span> </span><a href="#local-6989586621681699418"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1720"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tcIfaceInst&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699418"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681699420"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1721"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699421"><a href="#local-6989586621681699421"><span class="hs-identifier">tything</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681699421"><span class="hs-identifier hs-var">tything</span></a><span>
</span><a name="line-1722"></a><span>
</span><a name="line-1723"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Bindings
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1730"></a><span>
</span><a name="line-1731"></a><span class="hs-identifier">bindIfaceId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceIdBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698741"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698741"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1732"></a><a name="bindIfaceId"><a href="TcIface.html#bindIfaceId"><span class="hs-identifier">bindIfaceId</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681699422"><a href="#local-6989586621681699422"><span class="hs-identifier">fs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681699423"><a href="#local-6989586621681699423"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699424"><a href="#local-6989586621681699424"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1733"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699425"><a href="#local-6989586621681699425"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#newIfaceName"><span class="hs-identifier hs-var">newIfaceName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkVarOccFS</span><span> </span><a href="#local-6989586621681699422"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1734"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699426"><a href="#local-6989586621681699426"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699423"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1735"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681699427"><a href="#local-6989586621681699427"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span><span> </span><a href="#local-6989586621681699425"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699426"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1736"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="IfaceEnv.html#extendIfaceIdEnv"><span class="hs-identifier hs-var">extendIfaceIdEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681699427"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699424"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621681699427"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1737"></a><span>
</span><a name="line-1738"></a><span class="hs-identifier">bindIfaceIds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceIdBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698740"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698740"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1739"></a><a name="bindIfaceIds"><a href="TcIface.html#bindIfaceIds"><span class="hs-identifier">bindIfaceIds</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621681699428"><a href="#local-6989586621681699428"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699428"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1740"></a><span class="hs-identifier">bindIfaceIds</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699429"><a href="#local-6989586621681699429"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681699430"><a href="#local-6989586621681699430"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699431"><a href="#local-6989586621681699431"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1741"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceId"><span class="hs-identifier hs-var">bindIfaceId</span></a><span> </span><a href="#local-6989586621681699429"><span class="hs-identifier hs-var">b</span></a><span>   </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699432"><a href="#local-6989586621681699432"><span class="hs-identifier">b'</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1742"></a><span>    </span><a href="TcIface.html#bindIfaceIds"><span class="hs-identifier hs-var">bindIfaceIds</span></a><span> </span><a href="#local-6989586621681699430"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699433"><a href="#local-6989586621681699433"><span class="hs-identifier">bs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1743"></a><span>    </span><a href="#local-6989586621681699431"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699432"><span class="hs-identifier hs-var">b'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681699433"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1744"></a><span>
</span><a name="line-1745"></a><span class="hs-identifier">bindIfaceBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CoreBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698739"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698739"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1746"></a><a name="bindIfaceBndr"><a href="TcIface.html#bindIfaceBndr"><span class="hs-identifier">bindIfaceBndr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceIdBndr</span><span> </span><a name="local-6989586621681699434"><a href="#local-6989586621681699434"><span class="hs-identifier">bndr</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699435"><a href="#local-6989586621681699435"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1747"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceId"><span class="hs-identifier hs-var">bindIfaceId</span></a><span> </span><a href="#local-6989586621681699434"><span class="hs-identifier hs-var">bndr</span></a><span> </span><a href="#local-6989586621681699435"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1748"></a><span class="hs-identifier">bindIfaceBndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTvBndr</span><span> </span><a name="local-6989586621681699436"><a href="#local-6989586621681699436"><span class="hs-identifier">bndr</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699437"><a href="#local-6989586621681699437"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1749"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyVar"><span class="hs-identifier hs-var">bindIfaceTyVar</span></a><span> </span><a href="#local-6989586621681699436"><span class="hs-identifier hs-var">bndr</span></a><span> </span><a href="#local-6989586621681699437"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-1750"></a><span>
</span><a name="line-1751"></a><span class="hs-identifier">bindIfaceBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">CoreBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698738"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698738"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1752"></a><a name="bindIfaceBndrs"><a href="TcIface.html#bindIfaceBndrs"><span class="hs-identifier">bindIfaceBndrs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><a name="local-6989586621681699438"><a href="#local-6989586621681699438"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699438"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1753"></a><span class="hs-identifier">bindIfaceBndrs</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699439"><a href="#local-6989586621681699439"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681699440"><a href="#local-6989586621681699440"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699441"><a href="#local-6989586621681699441"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1754"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceBndr"><span class="hs-identifier hs-var">bindIfaceBndr</span></a><span> </span><a href="#local-6989586621681699439"><span class="hs-identifier hs-var">b</span></a><span>     </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699442"><a href="#local-6989586621681699442"><span class="hs-identifier">b'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1755"></a><span>    </span><a href="TcIface.html#bindIfaceBndrs"><span class="hs-identifier hs-var">bindIfaceBndrs</span></a><span> </span><a href="#local-6989586621681699440"><span class="hs-identifier hs-var">bs</span></a><span>   </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699443"><a href="#local-6989586621681699443"><span class="hs-identifier">bs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1756"></a><span>    </span><a href="#local-6989586621681699441"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699442"><span class="hs-identifier hs-var">b'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681699443"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1757"></a><span>
</span><a name="line-1758"></a><span class="hs-comment">-----------------------</span><span>
</span><a name="line-1759"></a><span class="hs-identifier">bindIfaceForAllBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceForAllBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyCoVarBinder</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698737"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698737"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1760"></a><a name="bindIfaceForAllBndrs"><a href="TcIface.html#bindIfaceForAllBndrs"><span class="hs-identifier">bindIfaceForAllBndrs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621681699444"><a href="#local-6989586621681699444"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699444"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1761"></a><span class="hs-identifier">bindIfaceForAllBndrs</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699445"><a href="#local-6989586621681699445"><span class="hs-identifier">bndr</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681699446"><a href="#local-6989586621681699446"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699447"><a href="#local-6989586621681699447"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1762"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceForAllBndr"><span class="hs-identifier hs-var">bindIfaceForAllBndr</span></a><span> </span><a href="#local-6989586621681699445"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699448"><a href="#local-6989586621681699448"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681699449"><a href="#local-6989586621681699449"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1763"></a><span>    </span><a href="TcIface.html#bindIfaceForAllBndrs"><span class="hs-identifier hs-var">bindIfaceForAllBndrs</span></a><span> </span><a href="#local-6989586621681699446"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699450"><a href="#local-6989586621681699450"><span class="hs-identifier">bndrs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1764"></a><span>    </span><a href="#local-6989586621681699447"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyCoVarBinder</span><span> </span><a href="#local-6989586621681699449"><span class="hs-identifier hs-var">vis</span></a><span> </span><a href="#local-6989586621681699448"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681699450"><span class="hs-identifier hs-var">bndrs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1765"></a><span>
</span><a name="line-1766"></a><span class="hs-identifier">bindIfaceForAllBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceForAllBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TyCoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ArgFlag</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698736"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698736"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1767"></a><a name="bindIfaceForAllBndr"><a href="TcIface.html#bindIfaceForAllBndr"><span class="hs-identifier">bindIfaceForAllBndr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceTvBndr</span><span> </span><a name="local-6989586621681699451"><a href="#local-6989586621681699451"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699452"><a href="#local-6989586621681699452"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699453"><a href="#local-6989586621681699453"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1768"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyVar"><span class="hs-identifier hs-var">bindIfaceTyVar</span></a><span> </span><a href="#local-6989586621681699451"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699454"><a href="#local-6989586621681699454"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681699453"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621681699454"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681699452"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-1769"></a><span class="hs-identifier">bindIfaceForAllBndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IfaceIdBndr</span><span> </span><a name="local-6989586621681699455"><a href="#local-6989586621681699455"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699456"><a href="#local-6989586621681699456"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699457"><a href="#local-6989586621681699457"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1770"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceId"><span class="hs-identifier hs-var">bindIfaceId</span></a><span> </span><a href="#local-6989586621681699455"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699458"><a href="#local-6989586621681699458"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681699457"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621681699458"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681699456"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-1771"></a><span>
</span><a name="line-1772"></a><span class="hs-identifier">bindIfaceTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IfaceTvBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698735"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698735"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1773"></a><a name="bindIfaceTyVar"><a href="TcIface.html#bindIfaceTyVar"><span class="hs-identifier">bindIfaceTyVar</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681699459"><a href="#local-6989586621681699459"><span class="hs-identifier">occ</span></a></a><span class="hs-special">,</span><a name="local-6989586621681699460"><a href="#local-6989586621681699460"><span class="hs-identifier">kind</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699461"><a href="#local-6989586621681699461"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1774"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699462"><a href="#local-6989586621681699462"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#newIfaceName"><span class="hs-identifier hs-var">newIfaceName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarOccFS</span><span> </span><a href="#local-6989586621681699459"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-1775"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681699463"><a href="#local-6989586621681699463"><span class="hs-identifier">tyvar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#mk_iface_tyvar"><span class="hs-identifier hs-var">mk_iface_tyvar</span></a><span> </span><a href="#local-6989586621681699462"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699460"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1776"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="IfaceEnv.html#extendIfaceTyVarEnv"><span class="hs-identifier hs-var">extendIfaceTyVarEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681699463"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699461"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621681699463"><span class="hs-identifier hs-var">tyvar</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1777"></a><span>
</span><a name="line-1778"></a><span class="hs-identifier">bindIfaceTyVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceTvBndr</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698734"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698734"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1779"></a><a name="bindIfaceTyVars"><a href="TcIface.html#bindIfaceTyVars"><span class="hs-identifier">bindIfaceTyVars</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621681699464"><a href="#local-6989586621681699464"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699464"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1780"></a><span class="hs-identifier">bindIfaceTyVars</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699465"><a href="#local-6989586621681699465"><span class="hs-identifier">bndr</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681699466"><a href="#local-6989586621681699466"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699467"><a href="#local-6989586621681699467"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1781"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyVar"><span class="hs-identifier hs-var">bindIfaceTyVar</span></a><span> </span><a href="#local-6989586621681699465"><span class="hs-identifier hs-var">bndr</span></a><span>   </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699468"><a href="#local-6989586621681699468"><span class="hs-identifier">tv</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1782"></a><span>    </span><a href="TcIface.html#bindIfaceTyVars"><span class="hs-identifier hs-var">bindIfaceTyVars</span></a><span> </span><a href="#local-6989586621681699466"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699469"><a href="#local-6989586621681699469"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1783"></a><span>    </span><a href="#local-6989586621681699467"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699468"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681699469"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1784"></a><span>
</span><a name="line-1785"></a><span class="hs-identifier">mk_iface_tyvar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceKind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span>
</span><a name="line-1786"></a><a name="mk_iface_tyvar"><a href="TcIface.html#mk_iface_tyvar"><span class="hs-identifier">mk_iface_tyvar</span></a></a><span> </span><a name="local-6989586621681699470"><a href="#local-6989586621681699470"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621681699471"><a href="#local-6989586621681699471"><span class="hs-identifier">ifKind</span></a></a><span>
</span><a name="line-1787"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699472"><a href="#local-6989586621681699472"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcIface.html#tcIfaceType"><span class="hs-identifier hs-var">tcIfaceType</span></a><span> </span><a href="#local-6989586621681699471"><span class="hs-identifier hs-var">ifKind</span></a><span>
</span><a name="line-1788"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var.mkTyVar</span><span> </span><a href="#local-6989586621681699470"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681699472"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1789"></a><span>
</span><a name="line-1790"></a><span class="hs-identifier">bindIfaceTyConBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceTyConBinder</span><span class="hs-special">]</span><span>
</span><a name="line-1791"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyConBinder</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698733"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698733"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1792"></a><a name="bindIfaceTyConBinders"><a href="TcIface.html#bindIfaceTyConBinders"><span class="hs-identifier">bindIfaceTyConBinders</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621681699473"><a href="#local-6989586621681699473"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699473"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1793"></a><span class="hs-identifier">bindIfaceTyConBinders</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699474"><a href="#local-6989586621681699474"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681699475"><a href="#local-6989586621681699475"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699476"><a href="#local-6989586621681699476"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1794"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyConBinderX"><span class="hs-identifier hs-var">bindIfaceTyConBinderX</span></a><span> </span><a href="TcIface.html#bindIfaceBndr"><span class="hs-identifier hs-var">bindIfaceBndr</span></a><span> </span><a href="#local-6989586621681699474"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699477"><a href="#local-6989586621681699477"><span class="hs-identifier">b'</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1795"></a><span>    </span><a href="TcIface.html#bindIfaceTyConBinders"><span class="hs-identifier hs-var">bindIfaceTyConBinders</span></a><span> </span><a href="#local-6989586621681699475"><span class="hs-identifier hs-var">bs</span></a><span>              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621681699478"><a href="#local-6989586621681699478"><span class="hs-identifier">bs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1796"></a><span>    </span><a href="#local-6989586621681699476"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699477"><span class="hs-identifier hs-var">b'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681699478"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1797"></a><span>
</span><a name="line-1798"></a><span class="hs-identifier">bindIfaceTyConBinders_AT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">IfaceTyConBinder</span><span class="hs-special">]</span><span>
</span><a name="line-1799"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyConBinder</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698732"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698732"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1800"></a><span class="hs-comment">-- Used for type variable in nested associated data/type declarations</span><span>
</span><a name="line-1801"></a><span class="hs-comment">-- where some of the type variables are already in scope</span><span>
</span><a name="line-1802"></a><span class="hs-comment">--    class C a where { data T a b }</span><span>
</span><a name="line-1803"></a><span class="hs-comment">-- Here 'a' is in scope when we look at the 'data T'</span><span>
</span><a name="line-1804"></a><a name="bindIfaceTyConBinders_AT"><a href="TcIface.html#bindIfaceTyConBinders_AT"><span class="hs-identifier">bindIfaceTyConBinders_AT</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621681699479"><a href="#local-6989586621681699479"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1805"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699479"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1806"></a><span class="hs-identifier">bindIfaceTyConBinders_AT</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681699480"><a href="#local-6989586621681699480"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621681699481"><a href="#local-6989586621681699481"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699482"><a href="#local-6989586621681699482"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1807"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcIface.html#bindIfaceTyConBinderX"><span class="hs-identifier hs-var">bindIfaceTyConBinderX</span></a><span> </span><a href="#local-6989586621681699483"><span class="hs-identifier hs-var">bind_tv</span></a><span> </span><a href="#local-6989586621681699480"><span class="hs-identifier hs-var">b</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699488"><a href="#local-6989586621681699488"><span class="hs-identifier">b'</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1808"></a><span>    </span><a href="TcIface.html#bindIfaceTyConBinders_AT"><span class="hs-identifier hs-var">bindIfaceTyConBinders_AT</span></a><span>      </span><a href="#local-6989586621681699481"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699489"><a href="#local-6989586621681699489"><span class="hs-identifier">bs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1809"></a><span>    </span><a href="#local-6989586621681699482"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681699488"><span class="hs-identifier hs-var">b'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681699489"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1810"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1811"></a><span>    </span><a name="local-6989586621681699483"><a href="#local-6989586621681699483"><span class="hs-identifier">bind_tv</span></a></a><span> </span><a name="local-6989586621681699484"><a href="#local-6989586621681699484"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681699485"><a href="#local-6989586621681699485"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-1812"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681699486"><a href="#local-6989586621681699486"><span class="hs-identifier">mb_tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceEnv.html#lookupIfaceVar"><span class="hs-identifier hs-var">lookupIfaceVar</span></a><span> </span><a href="#local-6989586621681699484"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1813"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681699486"><span class="hs-identifier hs-var">mb_tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1814"></a><span>               </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681699487"><a href="#local-6989586621681699487"><span class="hs-identifier">b'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681699485"><span class="hs-identifier hs-var">thing</span></a><span> </span><a href="#local-6989586621681699487"><span class="hs-identifier hs-var">b'</span></a><span>
</span><a name="line-1815"></a><span>               </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcIface.html#bindIfaceBndr"><span class="hs-identifier hs-var">bindIfaceBndr</span></a><span> </span><a href="#local-6989586621681699484"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681699485"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1816"></a><span>
</span><a name="line-1817"></a><span class="hs-identifier">bindIfaceTyConBinderX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IfaceBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TyCoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698731"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698731"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1818"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfaceTyConBinder</span><span>
</span><a name="line-1819"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TyConBinder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698731"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IfL</span><span> </span><a href="#local-6989586621681698731"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1820"></a><a name="bindIfaceTyConBinderX"><a href="TcIface.html#bindIfaceTyConBinderX"><span class="hs-identifier">bindIfaceTyConBinderX</span></a></a><span> </span><a name="local-6989586621681699490"><a href="#local-6989586621681699490"><span class="hs-identifier">bind_tv</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><a name="local-6989586621681699491"><a href="#local-6989586621681699491"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681699492"><a href="#local-6989586621681699492"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681699493"><a href="#local-6989586621681699493"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-1821"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681699490"><span class="hs-identifier hs-var">bind_tv</span></a><span> </span><a href="#local-6989586621681699491"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681699494"><a href="#local-6989586621681699494"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1822"></a><span>    </span><a href="#local-6989586621681699493"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><a href="#local-6989586621681699494"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681699492"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span>
</span><a name="line-1823"></a></pre></body></html>