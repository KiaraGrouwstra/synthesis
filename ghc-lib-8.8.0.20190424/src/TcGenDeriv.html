<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
    %
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


TcGenDeriv: Generating derived instance declarations

This module is nominally ``subordinate'' to @TcDeriv@, which is the
``official'' interface to deriving-related things.

This is where we do all the grimy bindings' generation.
-}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables #-}</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-17"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcGenDeriv</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-20"></a><span>        </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#DerivStuff"><span class="hs-identifier hs-type">DerivStuff</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>        </span><a href="TcGenDeriv.html#gen_Eq_binds"><span class="hs-identifier hs-var">gen_Eq_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="TcGenDeriv.html#gen_Ord_binds"><span class="hs-identifier hs-var">gen_Ord_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="TcGenDeriv.html#gen_Enum_binds"><span class="hs-identifier hs-var">gen_Enum_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="TcGenDeriv.html#gen_Bounded_binds"><span class="hs-identifier hs-var">gen_Bounded_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="TcGenDeriv.html#gen_Ix_binds"><span class="hs-identifier hs-var">gen_Ix_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="TcGenDeriv.html#gen_Show_binds"><span class="hs-identifier hs-var">gen_Show_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="TcGenDeriv.html#gen_Read_binds"><span class="hs-identifier hs-var">gen_Read_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="TcGenDeriv.html#gen_Data_binds"><span class="hs-identifier hs-var">gen_Data_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="TcGenDeriv.html#gen_Lift_binds"><span class="hs-identifier hs-var">gen_Lift_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="TcGenDeriv.html#gen_Newtype_binds"><span class="hs-identifier hs-var">gen_Newtype_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="TcGenDeriv.html#mkCoerceClassMethEqn"><span class="hs-identifier hs-var">mkCoerceClassMethEqn</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="TcGenDeriv.html#genAuxBinds"><span class="hs-identifier hs-var">genAuxBinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="TcGenDeriv.html#ordOpTbl"><span class="hs-identifier hs-var">ordOpTbl</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#boxConTbl"><span class="hs-identifier hs-var">boxConTbl</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#litConTbl"><span class="hs-identifier hs-var">litConTbl</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="TcGenDeriv.html#mkRdrFunBind"><span class="hs-identifier hs-var">mkRdrFunBind</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#mkRdrFunBindEC"><span class="hs-identifier hs-var">mkRdrFunBindEC</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#mkRdrFunBindSE"><span class="hs-identifier hs-var">mkRdrFunBindSE</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#error_Expr"><span class="hs-identifier hs-var">error_Expr</span></a><span>
</span><a name="line-36"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsSyn</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">RdrName</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fingerprint</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Encoding</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="PrelInfo.html"><span class="hs-identifier">PrelInfo</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="FamInst.html"><span class="hs-identifier">FamInst</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FamInstEnv</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrelNames</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="THNames.html"><span class="hs-identifier">THNames</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Module</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">moduleName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">moduleNameString</span><span>
</span><a name="line-58"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">moduleUnitId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitIdString</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">MkId</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">coerceId</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrimOp</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCon</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcType</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="TcValidity.html"><span class="hs-identifier">TcValidity</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcValidity.html#checkValidCoAxBranch"><span class="hs-identifier hs-var">checkValidCoAxBranch</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoAxiom</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">coAxiomSingleBranch</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysPrim</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysWiredIn</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Class</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">VarSet</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">VarEnv</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Var</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Lexeme</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Pair</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Bag</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">find</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">partition</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">intersperse</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">type</span><span> </span><a name="BagDerivStuff"><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier">BagDerivStuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><a href="TcGenDeriv.html#DerivStuff"><span class="hs-identifier hs-type">DerivStuff</span></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-keyword">data</span><span> </span><a name="AuxBindSpec"><a href="TcGenDeriv.html#AuxBindSpec"><span class="hs-identifier">AuxBindSpec</span></a></a><span>
</span><a name="line-86"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="DerivCon2Tag"><a href="TcGenDeriv.html#DerivCon2Tag"><span class="hs-identifier">DerivCon2Tag</span></a></a><span> </span><span class="hs-identifier hs-type">TyCon</span><span>  </span><span class="hs-comment">-- The con2Tag for given TyCon</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivTag2Con"><a href="TcGenDeriv.html#DerivTag2Con"><span class="hs-identifier">DerivTag2Con</span></a></a><span> </span><span class="hs-identifier hs-type">TyCon</span><span>  </span><span class="hs-comment">-- ...ditto tag2Con</span><span>
</span><a name="line-88"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivMaxTag"><a href="TcGenDeriv.html#DerivMaxTag"><span class="hs-identifier">DerivMaxTag</span></a></a><span>  </span><span class="hs-identifier hs-type">TyCon</span><span>  </span><span class="hs-comment">-- ...and maxTag</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>  </span><span class="hs-comment">-- All these generate ZERO-BASED tag operations</span><span>
</span><a name="line-91"></a><span>  </span><span class="hs-comment">-- I.e first constructor has tag 0</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-keyword">data</span><span> </span><a name="DerivStuff"><a href="TcGenDeriv.html#DerivStuff"><span class="hs-identifier">DerivStuff</span></a></a><span>     </span><span class="hs-comment">-- Please add this auxiliary stuff</span><span>
</span><a name="line-94"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="DerivAuxBind"><a href="TcGenDeriv.html#DerivAuxBind"><span class="hs-identifier">DerivAuxBind</span></a></a><span> </span><a href="TcGenDeriv.html#AuxBindSpec"><span class="hs-identifier hs-type">AuxBindSpec</span></a><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>  </span><span class="hs-comment">-- Generics and DeriveAnyClass</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivFamInst"><a href="TcGenDeriv.html#DerivFamInst"><span class="hs-identifier">DerivFamInst</span></a></a><span> </span><span class="hs-identifier hs-type">FamInst</span><span>               </span><span class="hs-comment">-- New type family instances</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span>  </span><span class="hs-comment">-- New top-level auxiliary bindings</span><span>
</span><a name="line-100"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivHsBind"><a href="TcGenDeriv.html#DerivHsBind"><span class="hs-identifier">DerivHsBind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Also used for SYB</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Eq instances
*                                                                      *
************************************************************************

Here are the heuristics for the code we generate for @Eq@. Let's
assume we have a data type with some (possibly zero) nullary data
constructors and some ordinary, non-nullary ones (the rest, also
possibly zero of them).  Here's an example, with both \tr{N}ullary and
\tr{O}rdinary data cons.

  data Foo ... = N1 | N2 ... | Nn | O1 a b | O2 Int | O3 Double b b | ...

* For the ordinary constructors (if any), we emit clauses to do The
  Usual Thing, e.g.,:

    (==) (O1 a1 b1)    (O1 a2 b2)    = a1 == a2 &amp;&amp; b1 == b2
    (==) (O2 a1)       (O2 a2)       = a1 == a2
    (==) (O3 a1 b1 c1) (O3 a2 b2 c2) = a1 == a2 &amp;&amp; b1 == b2 &amp;&amp; c1 == c2

  Note: if we're comparing unlifted things, e.g., if 'a1' and
  'a2' are Float#s, then we have to generate
       case (a1 `eqFloat#` a2) of r -&gt; r
  for that particular test.

* If there are a lot of (more than ten) nullary constructors, we emit a
  catch-all clause of the form:

      (==) a b  = case (con2tag_Foo a) of { a# -&gt;
                  case (con2tag_Foo b) of { b# -&gt;
                  case (a# ==# b#)     of {
                    r -&gt; r }}}

  If con2tag gets inlined this leads to join point stuff, so
  it's better to use regular pattern matching if there aren't too
  many nullary constructors.  &quot;Ten&quot; is arbitrary, of course

* If there aren't any nullary constructors, we emit a simpler
  catch-all:

     (==) a b  = False

* For the @(/=)@ method, we normally just use the default method.
  If the type is an enumeration type, we could/may/should? generate
  special code that calls @con2tag_Foo@, much like for @(==)@ shown
  above.

We thought about doing this: If we're also deriving 'Ord' for this
tycon, we generate:
  instance ... Eq (Foo ...) where
    (==) a b  = case (compare a b) of { _LT -&gt; False; _EQ -&gt; True ; _GT -&gt; False}
    (/=) a b  = case (compare a b) of { _LT -&gt; True ; _EQ -&gt; False; _GT -&gt; True }
However, that requires that (Ord &lt;whatever&gt;) was put in the context
for the instance decl, which it probably wasn't, so the decls
produced don't get through the typechecker.
-}</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span class="hs-identifier">gen_Eq_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><a name="gen_Eq_binds"><a href="TcGenDeriv.html#gen_Eq_binds"><span class="hs-identifier">gen_Eq_binds</span></a></a><span> </span><a name="local-6989586621683241547"><a href="#local-6989586621683241547"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241548"><a href="#local-6989586621683241548"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-164"></a><span>    </span><a name="local-6989586621683241579"><a href="#local-6989586621683241579"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-165"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241557"><span class="hs-identifier hs-var">method_binds</span></a><span> </span><a href="#local-6989586621683241579"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241556"><span class="hs-identifier hs-var">aux_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-167"></a><span>    </span><a name="local-6989586621683241549"><a href="#local-6989586621683241549"><span class="hs-identifier">all_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683241548"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-168"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683241550"><a href="#local-6989586621683241550"><span class="hs-identifier">nullary_cons</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241551"><a href="#local-6989586621683241551"><span class="hs-identifier">non_nullary_cons</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-identifier hs-var">isNullarySrcDataCon</span><span> </span><a href="#local-6989586621683241549"><span class="hs-identifier hs-var">all_cons</span></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span>    </span><span class="hs-comment">-- If there are ten or more (arbitrary number) nullary constructors,</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-comment">-- use the con2tag stuff.  For small types it's better to use</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-comment">-- ordinary pattern matching.</span><span>
</span><a name="line-173"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683241552"><a href="#local-6989586621683241552"><span class="hs-identifier">tag_match_cons</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241553"><a href="#local-6989586621683241553"><span class="hs-identifier">pat_match_cons</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241550"><span class="hs-identifier hs-var">nullary_cons</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthExceeds</span><span class="hs-special">`</span><span> </span><span class="hs-number">10</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241550"><span class="hs-identifier hs-var">nullary_cons</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241551"><span class="hs-identifier hs-var">non_nullary_cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>           </span><a href="#local-6989586621683241549"><span class="hs-identifier hs-var">all_cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>    </span><a name="local-6989586621683241554"><a href="#local-6989586621683241554"><span class="hs-identifier">no_tag_match_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683241552"><span class="hs-identifier hs-var">tag_match_cons</span></a><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span>    </span><a name="local-6989586621683241555"><a href="#local-6989586621683241555"><span class="hs-identifier">fall_through_eqn</span></a></a><span> </span><a name="local-6989586621683241560"><a href="#local-6989586621683241560"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-180"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241554"><span class="hs-identifier hs-var">no_tag_match_cons</span></a><span>   </span><span class="hs-comment">-- All constructors have arguments</span><span>
</span><a name="line-181"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683241553"><span class="hs-identifier hs-var">pat_match_cons</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-182"></a><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- No constructors; no fall-though case</span><span>
</span><a name="line-183"></a><span>          </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- One constructor; no fall-though case</span><span>
</span><a name="line-184"></a><span>          </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span>      </span><span class="hs-comment">-- Two or more constructors; add fall-through of</span><span>
</span><a name="line-185"></a><span>                      </span><span class="hs-comment">--       (==) _ _ = False</span><span>
</span><a name="line-186"></a><span>                 </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlWildPat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#false_Expr"><span class="hs-identifier hs-var">false_Expr</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-comment">-- One or more tag_match cons; add fall-through of</span><span>
</span><a name="line-189"></a><span>                  </span><span class="hs-comment">-- extract tags compare for equality</span><span>
</span><a name="line-190"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier hs-var">b_Pat</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-191"></a><span>         </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241560"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241548"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">,</span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-192"></a><span>                    </span><span class="hs-special">(</span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#eqInt_RDR"><span class="hs-identifier hs-var">eqInt_RDR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span>    </span><a name="local-6989586621683241556"><a href="#local-6989586621683241556"><span class="hs-identifier">aux_binds</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241554"><span class="hs-identifier hs-var">no_tag_match_cons</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span>
</span><a name="line-195"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcGenDeriv.html#DerivAuxBind"><span class="hs-identifier hs-var">DerivAuxBind</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcGenDeriv.html#DerivCon2Tag"><span class="hs-identifier hs-var">DerivCon2Tag</span></a><span> </span><a href="#local-6989586621683241548"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>    </span><a name="local-6989586621683241557"><a href="#local-6989586621683241557"><span class="hs-identifier">method_binds</span></a></a><span> </span><a name="local-6989586621683241561"><a href="#local-6989586621683241561"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241558"><span class="hs-identifier hs-var">eq_bind</span></a><span> </span><a href="#local-6989586621683241561"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>    </span><a name="local-6989586621683241558"><a href="#local-6989586621683241558"><span class="hs-identifier">eq_bind</span></a></a><span> </span><a name="local-6989586621683241562"><a href="#local-6989586621683241562"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkFunBindEC"><span class="hs-identifier hs-var">mkFunBindEC</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621683241547"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">eq_RDR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683241559"><span class="hs-identifier hs-var">pats_etc</span></a><span> </span><a href="#local-6989586621683241553"><span class="hs-identifier hs-var">pat_match_cons</span></a><span>
</span><a name="line-200"></a><span>                                   </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683241555"><span class="hs-identifier hs-var">fall_through_eqn</span></a><span> </span><a href="#local-6989586621683241562"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>    </span><span class="hs-comment">------------------------------------------------------------------</span><span>
</span><a name="line-203"></a><span>    </span><a name="local-6989586621683241559"><a href="#local-6989586621683241559"><span class="hs-identifier">pats_etc</span></a></a><span> </span><a name="local-6989586621683241563"><a href="#local-6989586621683241563"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-204"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-205"></a><span>            </span><a name="local-6989586621683241572"><a href="#local-6989586621683241572"><span class="hs-identifier">con1_pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlParPat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><a href="#local-6989586621683241574"><span class="hs-identifier hs-var">data_con_RDR</span></a><span> </span><a href="#local-6989586621683241576"><span class="hs-identifier hs-var">as_needed</span></a><span>
</span><a name="line-206"></a><span>            </span><a name="local-6989586621683241573"><a href="#local-6989586621683241573"><span class="hs-identifier">con2_pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlParPat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><a href="#local-6989586621683241574"><span class="hs-identifier hs-var">data_con_RDR</span></a><span> </span><a href="#local-6989586621683241577"><span class="hs-identifier hs-var">bs_needed</span></a><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>            </span><a name="local-6989586621683241574"><a href="#local-6989586621683241574"><span class="hs-identifier">data_con_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241563"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-209"></a><span>            </span><a name="local-6989586621683241575"><a href="#local-6989586621683241575"><span class="hs-identifier">con_arity</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621683241578"><span class="hs-identifier hs-var">tys_needed</span></a><span>
</span><a name="line-210"></a><span>            </span><a name="local-6989586621683241576"><a href="#local-6989586621683241576"><span class="hs-identifier">as_needed</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683241575"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><a href="TcGenDeriv.html#as_RDRs"><span class="hs-identifier hs-var">as_RDRs</span></a><span>
</span><a name="line-211"></a><span>            </span><a name="local-6989586621683241577"><a href="#local-6989586621683241577"><span class="hs-identifier">bs_needed</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683241575"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><a href="TcGenDeriv.html#bs_RDRs"><span class="hs-identifier hs-var">bs_RDRs</span></a><span>
</span><a name="line-212"></a><span>            </span><a name="local-6989586621683241578"><a href="#local-6989586621683241578"><span class="hs-identifier">tys_needed</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConOrigArgTys</span><span> </span><a href="#local-6989586621683241563"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-213"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621683241572"><span class="hs-identifier hs-var">con1_pat</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241573"><span class="hs-identifier hs-var">con2_pat</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241564"><span class="hs-identifier hs-var">nested_eq_expr</span></a><span> </span><a href="#local-6989586621683241578"><span class="hs-identifier hs-var">tys_needed</span></a><span> </span><a href="#local-6989586621683241576"><span class="hs-identifier hs-var">as_needed</span></a><span> </span><a href="#local-6989586621683241577"><span class="hs-identifier hs-var">bs_needed</span></a><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-216"></a><span>        </span><a name="local-6989586621683241564"><a href="#local-6989586621683241564"><span class="hs-identifier">nested_eq_expr</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span>
</span><a name="line-217"></a><span>        </span><span class="hs-identifier">nested_eq_expr</span><span> </span><a name="local-6989586621683241565"><a href="#local-6989586621683241565"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-6989586621683241567"><a href="#local-6989586621683241567"><span class="hs-identifier">bs</span></a></a><span>
</span><a name="line-218"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr1</span><span> </span><a href="TcGenDeriv.html#and_Expr"><span class="hs-identifier hs-var">and_Expr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith3Equal</span><span> </span><span class="hs-string">&quot;nested_eq&quot;</span><span> </span><a href="#local-6989586621683241568"><span class="hs-identifier hs-var">nested_eq</span></a><span> </span><a href="#local-6989586621683241565"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621683241567"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>          </span><span class="hs-comment">-- Using 'foldr1' here ensures that the derived code is correctly</span><span>
</span><a name="line-220"></a><span>          </span><span class="hs-comment">-- associated. See Trac #10859.</span><span>
</span><a name="line-221"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-222"></a><span>            </span><a name="local-6989586621683241568"><a href="#local-6989586621683241568"><span class="hs-identifier">nested_eq</span></a></a><span> </span><a name="local-6989586621683241569"><a href="#local-6989586621683241569"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621683241570"><a href="#local-6989586621683241570"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683241571"><a href="#local-6989586621683241571"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#eq_Expr"><span class="hs-identifier hs-var">eq_Expr</span></a><span> </span><a href="#local-6989586621683241569"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241570"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241571"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Ord instances
*                                                                      *
************************************************************************

Note [Generating Ord instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose constructors are K1..Kn, and some are nullary.
The general form we generate is:

* Do case on first argument
        case a of
          K1 ... -&gt; rhs_1
          K2 ... -&gt; rhs_2
          ...
          Kn ... -&gt; rhs_n
          _ -&gt; nullary_rhs

* To make rhs_i
     If i = 1, 2, n-1, n, generate a single case.
        rhs_2    case b of
                   K1 {}  -&gt; LT
                   K2 ... -&gt; ...eq_rhs(K2)...
                   _      -&gt; GT

     Otherwise do a tag compare against the bigger range
     (because this is the one most likely to succeed)
        rhs_3    case tag b of tb -&gt;
                 if 3 &lt;# tg then GT
                 else case b of
                         K3 ... -&gt; ...eq_rhs(K3)....
                         _      -&gt; LT

* To make eq_rhs(K), which knows that
    a = K a1 .. av
    b = K b1 .. bv
  we just want to compare (a1,b1) then (a2,b2) etc.
  Take care on the last field to tail-call into comparing av,bv

* To make nullary_rhs generate this
     case con2tag a of a# -&gt;
     case con2tag b of -&gt;
     a# `compare` b#

Several special cases:

* Two or fewer nullary constructors: don't generate nullary_rhs

* Be careful about unlifted comparisons.  When comparing unboxed
  values we can't call the overloaded functions.
  See function unliftedOrdOp

Note [Game plan for deriving Ord]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's a bad idea to define only 'compare', and build the other binary
comparisons on top of it; see Trac #2130, #4019.  Reason: we don't
want to laboriously make a three-way comparison, only to extract a
binary result, something like this:
     (&gt;) (I# x) (I# y) = case &lt;# x y of
                            True -&gt; False
                            False -&gt; case ==# x y of
                                       True  -&gt; False
                                       False -&gt; True

This being said, we can get away with generating full code only for
'compare' and '&lt;' thus saving us generation of other three operators.
Other operators can be cheaply expressed through '&lt;':
a &lt;= b = not $ b &lt; a
a &gt; b = b &lt; a
a &gt;= b = not $ a &lt; b

So for sufficiently small types (few constructors, or all nullary)
we generate all methods; for large ones we just use 'compare'.

-}</span><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-keyword">data</span><span> </span><a name="OrdOp"><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier">OrdOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="OrdCompare"><a href="TcGenDeriv.html#OrdCompare"><span class="hs-identifier">OrdCompare</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="OrdLT"><a href="TcGenDeriv.html#OrdLT"><span class="hs-identifier">OrdLT</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="OrdLE"><a href="TcGenDeriv.html#OrdLE"><span class="hs-identifier">OrdLE</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="OrdGE"><a href="TcGenDeriv.html#OrdGE"><span class="hs-identifier">OrdGE</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="OrdGT"><a href="TcGenDeriv.html#OrdGT"><span class="hs-identifier">OrdGT</span></a></a><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">------------</span><span>
</span><a name="line-305"></a><span class="hs-identifier">ordMethRdr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-306"></a><a name="ordMethRdr"><a href="TcGenDeriv.html#ordMethRdr"><span class="hs-identifier">ordMethRdr</span></a></a><span> </span><a name="local-6989586621683241580"><a href="#local-6989586621683241580"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-307"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683241580"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-308"></a><span>       </span><a href="TcGenDeriv.html#OrdCompare"><span class="hs-identifier hs-var">OrdCompare</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">compare_RDR</span><span>
</span><a name="line-309"></a><span>       </span><a href="TcGenDeriv.html#OrdLT"><span class="hs-identifier hs-var">OrdLT</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">lt_RDR</span><span>
</span><a name="line-310"></a><span>       </span><a href="TcGenDeriv.html#OrdLE"><span class="hs-identifier hs-var">OrdLE</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">le_RDR</span><span>
</span><a name="line-311"></a><span>       </span><a href="TcGenDeriv.html#OrdGE"><span class="hs-identifier hs-var">OrdGE</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">ge_RDR</span><span>
</span><a name="line-312"></a><span>       </span><a href="TcGenDeriv.html#OrdGT"><span class="hs-identifier hs-var">OrdGT</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">gt_RDR</span><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">------------</span><span>
</span><a name="line-315"></a><span class="hs-identifier">ltResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-316"></a><span class="hs-comment">-- Knowing a&lt;b, what is the result for a `op` b?</span><span>
</span><a name="line-317"></a><a name="ltResult"><a href="TcGenDeriv.html#ltResult"><span class="hs-identifier">ltResult</span></a></a><span> </span><a href="TcGenDeriv.html#OrdCompare"><span class="hs-identifier hs-var">OrdCompare</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#ltTag_Expr"><span class="hs-identifier hs-var">ltTag_Expr</span></a><span>
</span><a name="line-318"></a><span class="hs-identifier">ltResult</span><span> </span><a href="TcGenDeriv.html#OrdLT"><span class="hs-identifier hs-var">OrdLT</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span>
</span><a name="line-319"></a><span class="hs-identifier">ltResult</span><span> </span><a href="TcGenDeriv.html#OrdLE"><span class="hs-identifier hs-var">OrdLE</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span>
</span><a name="line-320"></a><span class="hs-identifier">ltResult</span><span> </span><a href="TcGenDeriv.html#OrdGE"><span class="hs-identifier hs-var">OrdGE</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#false_Expr"><span class="hs-identifier hs-var">false_Expr</span></a><span>
</span><a name="line-321"></a><span class="hs-identifier">ltResult</span><span> </span><a href="TcGenDeriv.html#OrdGT"><span class="hs-identifier hs-var">OrdGT</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#false_Expr"><span class="hs-identifier hs-var">false_Expr</span></a><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span class="hs-comment">------------</span><span>
</span><a name="line-324"></a><span class="hs-identifier">eqResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-325"></a><span class="hs-comment">-- Knowing a=b, what is the result for a `op` b?</span><span>
</span><a name="line-326"></a><a name="eqResult"><a href="TcGenDeriv.html#eqResult"><span class="hs-identifier">eqResult</span></a></a><span> </span><a href="TcGenDeriv.html#OrdCompare"><span class="hs-identifier hs-var">OrdCompare</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#eqTag_Expr"><span class="hs-identifier hs-var">eqTag_Expr</span></a><span>
</span><a name="line-327"></a><span class="hs-identifier">eqResult</span><span> </span><a href="TcGenDeriv.html#OrdLT"><span class="hs-identifier hs-var">OrdLT</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#false_Expr"><span class="hs-identifier hs-var">false_Expr</span></a><span>
</span><a name="line-328"></a><span class="hs-identifier">eqResult</span><span> </span><a href="TcGenDeriv.html#OrdLE"><span class="hs-identifier hs-var">OrdLE</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span>
</span><a name="line-329"></a><span class="hs-identifier">eqResult</span><span> </span><a href="TcGenDeriv.html#OrdGE"><span class="hs-identifier hs-var">OrdGE</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span>
</span><a name="line-330"></a><span class="hs-identifier">eqResult</span><span> </span><a href="TcGenDeriv.html#OrdGT"><span class="hs-identifier hs-var">OrdGT</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#false_Expr"><span class="hs-identifier hs-var">false_Expr</span></a><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">------------</span><span>
</span><a name="line-333"></a><span class="hs-identifier">gtResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- Knowing a&gt;b, what is the result for a `op` b?</span><span>
</span><a name="line-335"></a><a name="gtResult"><a href="TcGenDeriv.html#gtResult"><span class="hs-identifier">gtResult</span></a></a><span> </span><a href="TcGenDeriv.html#OrdCompare"><span class="hs-identifier hs-var">OrdCompare</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#gtTag_Expr"><span class="hs-identifier hs-var">gtTag_Expr</span></a><span>
</span><a name="line-336"></a><span class="hs-identifier">gtResult</span><span> </span><a href="TcGenDeriv.html#OrdLT"><span class="hs-identifier hs-var">OrdLT</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#false_Expr"><span class="hs-identifier hs-var">false_Expr</span></a><span>
</span><a name="line-337"></a><span class="hs-identifier">gtResult</span><span> </span><a href="TcGenDeriv.html#OrdLE"><span class="hs-identifier hs-var">OrdLE</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#false_Expr"><span class="hs-identifier hs-var">false_Expr</span></a><span>
</span><a name="line-338"></a><span class="hs-identifier">gtResult</span><span> </span><a href="TcGenDeriv.html#OrdGE"><span class="hs-identifier hs-var">OrdGE</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span>
</span><a name="line-339"></a><span class="hs-identifier">gtResult</span><span> </span><a href="TcGenDeriv.html#OrdGT"><span class="hs-identifier hs-var">OrdGT</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-comment">------------</span><span>
</span><a name="line-342"></a><span class="hs-identifier">gen_Ord_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-343"></a><a name="gen_Ord_binds"><a href="TcGenDeriv.html#gen_Ord_binds"><span class="hs-identifier">gen_Ord_binds</span></a></a><span> </span><a name="local-6989586621683241581"><a href="#local-6989586621683241581"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241582"><a href="#local-6989586621683241582"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-344"></a><span>    </span><a name="local-6989586621683241626"><a href="#local-6989586621683241626"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-345"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683241590"><span class="hs-identifier hs-var">tycon_data_cons</span></a><span> </span><span class="hs-comment">-- No data-cons =&gt; invoke bale-out case</span><span>
</span><a name="line-346"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcGenDeriv.html#mkFunBindEC"><span class="hs-identifier hs-var">mkFunBindEC</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621683241581"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">compare_RDR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="TcGenDeriv.html#eqTag_Expr"><span class="hs-identifier hs-var">eqTag_Expr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-347"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241598"><span class="hs-identifier hs-var">mkOrdOp</span></a><span> </span><a href="#local-6989586621683241626"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="TcGenDeriv.html#OrdCompare"><span class="hs-identifier hs-var">OrdCompare</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unionBags</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683241584"><span class="hs-identifier hs-var">other_ops</span></a><span> </span><a href="#local-6989586621683241626"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-349"></a><span>           </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241583"><span class="hs-identifier hs-var">aux_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-350"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-351"></a><span>    </span><a name="local-6989586621683241583"><a href="#local-6989586621683241583"><span class="hs-identifier">aux_binds</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241591"><span class="hs-identifier hs-var">single_con_type</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span>
</span><a name="line-352"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcGenDeriv.html#DerivAuxBind"><span class="hs-identifier hs-var">DerivAuxBind</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcGenDeriv.html#DerivCon2Tag"><span class="hs-identifier hs-var">DerivCon2Tag</span></a><span> </span><a href="#local-6989586621683241582"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span>        </span><span class="hs-comment">-- Note [Game plan for deriving Ord]</span><span>
</span><a name="line-355"></a><span>    </span><a name="local-6989586621683241584"><a href="#local-6989586621683241584"><span class="hs-identifier">other_ops</span></a></a><span> </span><a name="local-6989586621683241604"><a href="#local-6989586621683241604"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-356"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241595"><span class="hs-identifier hs-var">last_tag</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621683241594"><span class="hs-identifier hs-var">first_tag</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">2</span><span>     </span><span class="hs-comment">-- 1-3 constructors</span><span>
</span><a name="line-357"></a><span>        </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683241597"><span class="hs-identifier hs-var">non_nullary_cons</span></a><span>        </span><span class="hs-comment">-- Or it's an enumeration</span><span>
</span><a name="line-358"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241598"><span class="hs-identifier hs-var">mkOrdOp</span></a><span> </span><a href="#local-6989586621683241604"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="TcGenDeriv.html#OrdLT"><span class="hs-identifier hs-var">OrdLT</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241586"><span class="hs-identifier hs-var">lE</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241587"><span class="hs-identifier hs-var">gT</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241588"><span class="hs-identifier hs-var">gE</span></a><span class="hs-special">]</span><span>
</span><a name="line-359"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-360"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span>    </span><a name="local-6989586621683241585"><a href="#local-6989586621683241585"><span class="hs-identifier">negate_expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">not_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-363"></a><span>    </span><a name="local-6989586621683241586"><a href="#local-6989586621683241586"><span class="hs-identifier">lE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241581"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">le_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier hs-var">b_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-364"></a><span>        </span><a href="#local-6989586621683241585"><span class="hs-identifier hs-var">negate_expr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">lt_RDR</span><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#b_Expr"><span class="hs-identifier hs-var">b_Expr</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#a_Expr"><span class="hs-identifier hs-var">a_Expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-365"></a><span>    </span><a name="local-6989586621683241587"><a href="#local-6989586621683241587"><span class="hs-identifier">gT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241581"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">gt_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier hs-var">b_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-366"></a><span>        </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">lt_RDR</span><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#b_Expr"><span class="hs-identifier hs-var">b_Expr</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#a_Expr"><span class="hs-identifier hs-var">a_Expr</span></a><span>
</span><a name="line-367"></a><span>    </span><a name="local-6989586621683241588"><a href="#local-6989586621683241588"><span class="hs-identifier">gE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241581"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">ge_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier hs-var">b_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-368"></a><span>        </span><a href="#local-6989586621683241585"><span class="hs-identifier hs-var">negate_expr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">lt_RDR</span><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#a_Expr"><span class="hs-identifier hs-var">a_Expr</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#b_Expr"><span class="hs-identifier hs-var">b_Expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span>    </span><a name="local-6989586621683241589"><a href="#local-6989586621683241589"><span class="hs-identifier">get_tag</span></a></a><span> </span><a name="local-6989586621683241605"><a href="#local-6989586621683241605"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConTag</span><span> </span><a href="#local-6989586621683241605"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">fIRST_TAG</span><span>
</span><a name="line-371"></a><span>        </span><span class="hs-comment">-- We want *zero-based* tags, because that's what</span><span>
</span><a name="line-372"></a><span>        </span><span class="hs-comment">-- con2Tag returns (generated by untag_Expr)!</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span>    </span><a name="local-6989586621683241590"><a href="#local-6989586621683241590"><span class="hs-identifier">tycon_data_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683241582"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-375"></a><span>    </span><a name="local-6989586621683241591"><a href="#local-6989586621683241591"><span class="hs-identifier">single_con_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isSingleton</span><span> </span><a href="#local-6989586621683241590"><span class="hs-identifier hs-var">tycon_data_cons</span></a><span>
</span><a name="line-376"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683241592"><a href="#local-6989586621683241592"><span class="hs-identifier">first_con</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241590"><span class="hs-identifier hs-var">tycon_data_cons</span></a><span>
</span><a name="line-377"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683241593"><a href="#local-6989586621683241593"><span class="hs-identifier">last_con</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621683241590"><span class="hs-identifier hs-var">tycon_data_cons</span></a><span>
</span><a name="line-378"></a><span>    </span><a name="local-6989586621683241594"><a href="#local-6989586621683241594"><span class="hs-identifier">first_tag</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241589"><span class="hs-identifier hs-var">get_tag</span></a><span> </span><a href="#local-6989586621683241592"><span class="hs-identifier hs-var">first_con</span></a><span>
</span><a name="line-379"></a><span>    </span><a name="local-6989586621683241595"><a href="#local-6989586621683241595"><span class="hs-identifier">last_tag</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241589"><span class="hs-identifier hs-var">get_tag</span></a><span> </span><a href="#local-6989586621683241593"><span class="hs-identifier hs-var">last_con</span></a><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683241596"><a href="#local-6989586621683241596"><span class="hs-identifier">nullary_cons</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241597"><a href="#local-6989586621683241597"><span class="hs-identifier">non_nullary_cons</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-identifier hs-var">isNullarySrcDataCon</span><span> </span><a href="#local-6989586621683241590"><span class="hs-identifier hs-var">tycon_data_cons</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span>    </span><span class="hs-identifier">mkOrdOp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-385"></a><span>    </span><span class="hs-comment">-- Returns a binding   op a b = ... compares a and b according to op ....</span><span>
</span><a name="line-386"></a><span>    </span><a name="local-6989586621683241598"><a href="#local-6989586621683241598"><span class="hs-identifier">mkOrdOp</span></a></a><span> </span><a name="local-6989586621683241606"><a href="#local-6989586621683241606"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683241607"><a href="#local-6989586621683241607"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241581"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ordMethRdr"><span class="hs-identifier hs-var">ordMethRdr</span></a><span> </span><a href="#local-6989586621683241607"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier hs-var">b_Pat</span></a><span class="hs-special">]</span><span>
</span><a name="line-387"></a><span>                                        </span><span class="hs-special">(</span><a href="#local-6989586621683241599"><span class="hs-identifier hs-var">mkOrdOpRhs</span></a><span> </span><a href="#local-6989586621683241606"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241607"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span>    </span><span class="hs-identifier">mkOrdOpRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-390"></a><span>    </span><a name="local-6989586621683241599"><a href="#local-6989586621683241599"><span class="hs-identifier">mkOrdOpRhs</span></a></a><span> </span><a name="local-6989586621683241608"><a href="#local-6989586621683241608"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683241609"><a href="#local-6989586621683241609"><span class="hs-identifier">op</span></a></a><span>       </span><span class="hs-comment">-- RHS for comparing 'a' and 'b' according to op</span><span>
</span><a name="line-391"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241596"><span class="hs-identifier hs-var">nullary_cons</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthAtMost</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-comment">-- Two nullary or fewer, so use cases</span><span>
</span><a name="line-392"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-393"></a><span>        </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241600"><span class="hs-identifier hs-var">mkOrdOpAlt</span></a><span> </span><a href="#local-6989586621683241608"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241609"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241590"><span class="hs-identifier hs-var">tycon_data_cons</span></a><span>
</span><a name="line-394"></a><span>        </span><span class="hs-comment">-- i.e.  case a of { C1 x y -&gt; case b of C1 x y -&gt; ....compare x,y...</span><span>
</span><a name="line-395"></a><span>        </span><span class="hs-comment">--                   C2 x   -&gt; case b of C2 x -&gt; ....comopare x.... }</span><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683241597"><span class="hs-identifier hs-var">non_nullary_cons</span></a><span>    </span><span class="hs-comment">-- All nullary, so go straight to comparing tags</span><span>
</span><a name="line-398"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241603"><span class="hs-identifier hs-var">mkTagCmp</span></a><span> </span><a href="#local-6989586621683241608"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241609"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                </span><span class="hs-comment">-- Mixed nullary and non-nullary</span><span>
</span><a name="line-401"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-402"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241600"><span class="hs-identifier hs-var">mkOrdOpAlt</span></a><span> </span><a href="#local-6989586621683241608"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241609"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241597"><span class="hs-identifier hs-var">non_nullary_cons</span></a><span>
</span><a name="line-403"></a><span>         </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241603"><span class="hs-identifier hs-var">mkTagCmp</span></a><span> </span><a href="#local-6989586621683241608"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241609"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span>    </span><span class="hs-identifier">mkOrdOpAlt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span>
</span><a name="line-407"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>    </span><span class="hs-comment">-- Make the alternative  (Ki a1 a2 .. av -&gt;</span><span>
</span><a name="line-409"></a><span>    </span><a name="local-6989586621683241600"><a href="#local-6989586621683241600"><span class="hs-identifier">mkOrdOpAlt</span></a></a><span> </span><a name="local-6989586621683241610"><a href="#local-6989586621683241610"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683241611"><a href="#local-6989586621683241611"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621683241612"><a href="#local-6989586621683241612"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-410"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><a href="#local-6989586621683241614"><span class="hs-identifier hs-var">data_con_RDR</span></a><span> </span><a href="#local-6989586621683241613"><span class="hs-identifier hs-var">as_needed</span></a><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span>                    </span><span class="hs-special">(</span><a href="#local-6989586621683241601"><span class="hs-identifier hs-var">mkInnerRhs</span></a><span> </span><a href="#local-6989586621683241610"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241611"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241612"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-412"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-413"></a><span>        </span><a name="local-6989586621683241613"><a href="#local-6989586621683241613"><span class="hs-identifier">as_needed</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241612"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#as_RDRs"><span class="hs-identifier hs-var">as_RDRs</span></a><span>
</span><a name="line-414"></a><span>        </span><a name="local-6989586621683241614"><a href="#local-6989586621683241614"><span class="hs-identifier">data_con_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241612"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span>    </span><a name="local-6989586621683241601"><a href="#local-6989586621683241601"><span class="hs-identifier">mkInnerRhs</span></a></a><span> </span><a name="local-6989586621683241615"><a href="#local-6989586621683241615"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683241616"><a href="#local-6989586621683241616"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621683241617"><a href="#local-6989586621683241617"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-417"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241591"><span class="hs-identifier hs-var">single_con_type</span></a><span>
</span><a name="line-418"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241602"><span class="hs-identifier hs-var">mkInnerEqAlt</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241617"><span class="hs-identifier hs-var">data_con</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241618"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621683241594"><span class="hs-identifier hs-var">first_tag</span></a><span>
</span><a name="line-421"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241602"><span class="hs-identifier hs-var">mkInnerEqAlt</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241617"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-422"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltResult"><span class="hs-identifier hs-var">ltResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-423"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241618"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621683241595"><span class="hs-identifier hs-var">last_tag</span></a><span>
</span><a name="line-424"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241602"><span class="hs-identifier hs-var">mkInnerEqAlt</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241617"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-425"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#gtResult"><span class="hs-identifier hs-var">gtResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241618"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621683241594"><span class="hs-identifier hs-var">first_tag</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-428"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#nlConWildPat"><span class="hs-identifier hs-var">nlConWildPat</span></a><span> </span><a href="#local-6989586621683241592"><span class="hs-identifier hs-var">first_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span>                                             </span><span class="hs-special">(</span><a href="TcGenDeriv.html#gtResult"><span class="hs-identifier hs-var">gtResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span>                                 </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241602"><span class="hs-identifier hs-var">mkInnerEqAlt</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241617"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-431"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltResult"><span class="hs-identifier hs-var">ltResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-432"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241618"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621683241595"><span class="hs-identifier hs-var">last_tag</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-433"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#nlConWildPat"><span class="hs-identifier hs-var">nlConWildPat</span></a><span> </span><a href="#local-6989586621683241593"><span class="hs-identifier hs-var">last_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-434"></a><span>                                             </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltResult"><span class="hs-identifier hs-var">ltResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>                                 </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241602"><span class="hs-identifier hs-var">mkInnerEqAlt</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241617"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-436"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#gtResult"><span class="hs-identifier hs-var">gtResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241618"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621683241595"><span class="hs-identifier hs-var">last_tag</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span>  </span><span class="hs-comment">-- lower range is larger</span><span>
</span><a name="line-439"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241615"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241582"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-440"></a><span>        </span><span class="hs-identifier hs-var">nlHsIf</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#ltInt_RDR"><span class="hs-identifier hs-var">ltInt_RDR</span></a><span> </span><a href="#local-6989586621683241619"><span class="hs-identifier hs-var">tag_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>               </span><span class="hs-special">(</span><a href="TcGenDeriv.html#gtResult"><span class="hs-identifier hs-var">gtResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>  </span><span class="hs-comment">-- Definitely GT</span><span>
</span><a name="line-442"></a><span>        </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241602"><span class="hs-identifier hs-var">mkInnerEqAlt</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241617"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-443"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltResult"><span class="hs-identifier hs-var">ltResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>               </span><span class="hs-comment">-- upper range is larger</span><span>
</span><a name="line-446"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241615"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241582"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-447"></a><span>        </span><span class="hs-identifier hs-var">nlHsIf</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#gtInt_RDR"><span class="hs-identifier hs-var">gtInt_RDR</span></a><span> </span><a href="#local-6989586621683241619"><span class="hs-identifier hs-var">tag_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>               </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltResult"><span class="hs-identifier hs-var">ltResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>  </span><span class="hs-comment">-- Definitely LT</span><span>
</span><a name="line-449"></a><span>        </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241602"><span class="hs-identifier hs-var">mkInnerEqAlt</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241617"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-450"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#gtResult"><span class="hs-identifier hs-var">gtResult</span></a><span> </span><a href="#local-6989586621683241616"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-451"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-452"></a><span>        </span><a name="local-6989586621683241618"><a href="#local-6989586621683241618"><span class="hs-identifier">tag</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241589"><span class="hs-identifier hs-var">get_tag</span></a><span> </span><a href="#local-6989586621683241617"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-453"></a><span>        </span><a name="local-6989586621683241619"><a href="#local-6989586621683241619"><span class="hs-identifier">tag_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntPrim</span><span> </span><span class="hs-identifier hs-var">NoSourceText</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621683241618"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a><span>    </span><span class="hs-identifier">mkInnerEqAlt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span>    </span><span class="hs-comment">-- First argument 'a' known to be built with K</span><span>
</span><a name="line-457"></a><span>    </span><span class="hs-comment">-- Returns a case alternative  Ki b1 b2 ... bv -&gt; compare (a1,a2,...) with (b1,b2,...)</span><span>
</span><a name="line-458"></a><span>    </span><a name="local-6989586621683241602"><a href="#local-6989586621683241602"><span class="hs-identifier">mkInnerEqAlt</span></a></a><span> </span><a name="local-6989586621683241620"><a href="#local-6989586621683241620"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621683241621"><a href="#local-6989586621683241621"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-459"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><a href="#local-6989586621683241622"><span class="hs-identifier hs-var">data_con_RDR</span></a><span> </span><a href="#local-6989586621683241623"><span class="hs-identifier hs-var">bs_needed</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-460"></a><span>        </span><a href="TcGenDeriv.html#mkCompareFields"><span class="hs-identifier hs-var">mkCompareFields</span></a><span> </span><a href="#local-6989586621683241620"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConOrigArgTys</span><span> </span><a href="#local-6989586621683241621"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-462"></a><span>        </span><a name="local-6989586621683241622"><a href="#local-6989586621683241622"><span class="hs-identifier">data_con_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241621"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-463"></a><span>        </span><a name="local-6989586621683241623"><a href="#local-6989586621683241623"><span class="hs-identifier">bs_needed</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241621"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#bs_RDRs"><span class="hs-identifier hs-var">bs_RDRs</span></a><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span>    </span><span class="hs-identifier">mkTagCmp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-466"></a><span>    </span><span class="hs-comment">-- Both constructors known to be nullary</span><span>
</span><a name="line-467"></a><span>    </span><span class="hs-comment">-- generates (case data2Tag a of a# -&gt; case data2Tag b of b# -&gt; a# `op` b#</span><span>
</span><a name="line-468"></a><span>    </span><a name="local-6989586621683241603"><a href="#local-6989586621683241603"><span class="hs-identifier">mkTagCmp</span></a></a><span> </span><a name="local-6989586621683241624"><a href="#local-6989586621683241624"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683241625"><a href="#local-6989586621683241625"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-469"></a><span>      </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241624"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241582"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-470"></a><span>        </span><a href="TcGenDeriv.html#unliftedOrdOp"><span class="hs-identifier hs-var">unliftedOrdOp</span></a><span> </span><span class="hs-identifier hs-var">intPrimTy</span><span> </span><a href="#local-6989586621683241625"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span>
</span><a name="line-471"></a><span>
</span><a name="line-472"></a><span class="hs-identifier">mkCompareFields</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- Generates nested comparisons for (a1,a2...) against (b1,b2,...)</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- where the ai,bi have the given types</span><span>
</span><a name="line-475"></a><a name="mkCompareFields"><a href="TcGenDeriv.html#mkCompareFields"><span class="hs-identifier">mkCompareFields</span></a></a><span> </span><a name="local-6989586621683241627"><a href="#local-6989586621683241627"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621683241628"><a href="#local-6989586621683241628"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-476"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241629"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621683241628"><span class="hs-identifier hs-var">tys</span></a><span> </span><a href="TcGenDeriv.html#as_RDRs"><span class="hs-identifier hs-var">as_RDRs</span></a><span> </span><a href="TcGenDeriv.html#bs_RDRs"><span class="hs-identifier hs-var">bs_RDRs</span></a><span>
</span><a name="line-477"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-478"></a><span>    </span><a name="local-6989586621683241629"><a href="#local-6989586621683241629"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#eqResult"><span class="hs-identifier hs-var">eqResult</span></a><span> </span><a href="#local-6989586621683241627"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-479"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">[</span><a name="local-6989586621683241631"><a href="#local-6989586621683241631"><span class="hs-identifier">ty</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241632"><a href="#local-6989586621683241632"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a name="local-6989586621683241633"><a href="#local-6989586621683241633"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-480"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isUnliftedType</span><span> </span><a href="#local-6989586621683241631"><span class="hs-identifier hs-var">ty</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#unliftedOrdOp"><span class="hs-identifier hs-var">unliftedOrdOp</span></a><span> </span><a href="#local-6989586621683241631"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621683241627"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683241632"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621683241633"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-481"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier hs-var">genOpApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241632"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ordMethRdr"><span class="hs-identifier hs-var">ordMethRdr</span></a><span> </span><a href="#local-6989586621683241627"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241633"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241634"><a href="#local-6989586621683241634"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683241635"><a href="#local-6989586621683241635"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241636"><a href="#local-6989586621683241636"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241638"><a href="#local-6989586621683241638"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683241639"><a href="#local-6989586621683241639"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241630"><span class="hs-identifier hs-var">mk_compare</span></a><span> </span><a href="#local-6989586621683241634"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621683241636"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621683241638"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-483"></a><span>                                  </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltResult"><span class="hs-identifier hs-var">ltResult</span></a><span> </span><a href="#local-6989586621683241627"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-484"></a><span>                                  </span><span class="hs-special">(</span><a href="#local-6989586621683241629"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621683241635"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621683241639"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-485"></a><span>                                  </span><span class="hs-special">(</span><a href="TcGenDeriv.html#gtResult"><span class="hs-identifier hs-var">gtResult</span></a><span> </span><a href="#local-6989586621683241627"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-486"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;mkCompareFields&quot;</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span>    </span><span class="hs-comment">-- (mk_compare ty a b) generates</span><span>
</span><a name="line-489"></a><span>    </span><span class="hs-comment">--    (case (compare a b) of { LT -&gt; &lt;lt&gt;; EQ -&gt; &lt;eq&gt;; GT -&gt; &lt;bt&gt; })</span><span>
</span><a name="line-490"></a><span>    </span><span class="hs-comment">-- but with suitable special cases for</span><span>
</span><a name="line-491"></a><span>    </span><a name="local-6989586621683241630"><a href="#local-6989586621683241630"><span class="hs-identifier">mk_compare</span></a></a><span> </span><a name="local-6989586621683241640"><a href="#local-6989586621683241640"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621683241641"><a href="#local-6989586621683241641"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683241642"><a href="#local-6989586621683241642"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621683241643"><a href="#local-6989586621683241643"><span class="hs-identifier">lt</span></a></a><span> </span><a name="local-6989586621683241644"><a href="#local-6989586621683241644"><span class="hs-identifier">eq</span></a></a><span> </span><a name="local-6989586621683241645"><a href="#local-6989586621683241645"><span class="hs-identifier">gt</span></a></a><span>
</span><a name="line-492"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isUnliftedType</span><span> </span><a href="#local-6989586621683241640"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-493"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#unliftedCompare"><span class="hs-identifier hs-var">unliftedCompare</span></a><span> </span><a href="#local-6989586621683241648"><span class="hs-identifier hs-var">lt_op</span></a><span> </span><a href="#local-6989586621683241649"><span class="hs-identifier hs-var">eq_op</span></a><span> </span><a href="#local-6989586621683241646"><span class="hs-identifier hs-var">a_expr</span></a><span> </span><a href="#local-6989586621683241647"><span class="hs-identifier hs-var">b_expr</span></a><span> </span><a href="#local-6989586621683241643"><span class="hs-identifier hs-var">lt</span></a><span> </span><a href="#local-6989586621683241644"><span class="hs-identifier hs-var">eq</span></a><span> </span><a href="#local-6989586621683241645"><span class="hs-identifier hs-var">gt</span></a><span>
</span><a name="line-494"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-495"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">compare_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241646"><span class="hs-identifier hs-var">a_expr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241647"><span class="hs-identifier hs-var">b_expr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>          </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlNullaryConPat</span><span> </span><span class="hs-identifier hs-var">ltTag_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241643"><span class="hs-identifier hs-var">lt</span></a><span class="hs-special">,</span><span>
</span><a name="line-497"></a><span>           </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlNullaryConPat</span><span> </span><span class="hs-identifier hs-var">eqTag_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241644"><span class="hs-identifier hs-var">eq</span></a><span class="hs-special">,</span><span>
</span><a name="line-498"></a><span>           </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlNullaryConPat</span><span> </span><span class="hs-identifier hs-var">gtTag_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241645"><span class="hs-identifier hs-var">gt</span></a><span class="hs-special">]</span><span>
</span><a name="line-499"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-500"></a><span>        </span><a name="local-6989586621683241646"><a href="#local-6989586621683241646"><span class="hs-identifier">a_expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241641"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-501"></a><span>        </span><a name="local-6989586621683241647"><a href="#local-6989586621683241647"><span class="hs-identifier">b_expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241642"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-502"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621683241648"><a href="#local-6989586621683241648"><span class="hs-identifier">lt_op</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683241649"><a href="#local-6989586621683241649"><span class="hs-identifier">eq_op</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#primOrdOps"><span class="hs-identifier hs-var">primOrdOps</span></a><span> </span><span class="hs-string">&quot;Ord&quot;</span><span> </span><a href="#local-6989586621683241640"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-503"></a><span>
</span><a name="line-504"></a><span class="hs-identifier">unliftedOrdOp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#OrdOp"><span class="hs-identifier hs-type">OrdOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-505"></a><a name="unliftedOrdOp"><a href="TcGenDeriv.html#unliftedOrdOp"><span class="hs-identifier">unliftedOrdOp</span></a></a><span> </span><a name="local-6989586621683241650"><a href="#local-6989586621683241650"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621683241651"><a href="#local-6989586621683241651"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621683241652"><a href="#local-6989586621683241652"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683241653"><a href="#local-6989586621683241653"><span class="hs-identifier">b</span></a></a><span>
</span><a name="line-506"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683241651"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-507"></a><span>       </span><a href="TcGenDeriv.html#OrdCompare"><span class="hs-identifier hs-var">OrdCompare</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#unliftedCompare"><span class="hs-identifier hs-var">unliftedCompare</span></a><span> </span><a href="#local-6989586621683241654"><span class="hs-identifier hs-var">lt_op</span></a><span> </span><a href="#local-6989586621683241656"><span class="hs-identifier hs-var">eq_op</span></a><span> </span><a href="#local-6989586621683241660"><span class="hs-identifier hs-var">a_expr</span></a><span> </span><a href="#local-6989586621683241661"><span class="hs-identifier hs-var">b_expr</span></a><span>
</span><a name="line-508"></a><span>                                     </span><a href="TcGenDeriv.html#ltTag_Expr"><span class="hs-identifier hs-var">ltTag_Expr</span></a><span> </span><a href="TcGenDeriv.html#eqTag_Expr"><span class="hs-identifier hs-var">eqTag_Expr</span></a><span> </span><a href="TcGenDeriv.html#gtTag_Expr"><span class="hs-identifier hs-var">gtTag_Expr</span></a><span>
</span><a name="line-509"></a><span>       </span><a href="TcGenDeriv.html#OrdLT"><span class="hs-identifier hs-var">OrdLT</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683241659"><span class="hs-identifier hs-var">wrap</span></a><span> </span><a href="#local-6989586621683241654"><span class="hs-identifier hs-var">lt_op</span></a><span>
</span><a name="line-510"></a><span>       </span><a href="TcGenDeriv.html#OrdLE"><span class="hs-identifier hs-var">OrdLE</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683241659"><span class="hs-identifier hs-var">wrap</span></a><span> </span><a href="#local-6989586621683241655"><span class="hs-identifier hs-var">le_op</span></a><span>
</span><a name="line-511"></a><span>       </span><a href="TcGenDeriv.html#OrdGE"><span class="hs-identifier hs-var">OrdGE</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683241659"><span class="hs-identifier hs-var">wrap</span></a><span> </span><a href="#local-6989586621683241657"><span class="hs-identifier hs-var">ge_op</span></a><span>
</span><a name="line-512"></a><span>       </span><a href="TcGenDeriv.html#OrdGT"><span class="hs-identifier hs-var">OrdGT</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683241659"><span class="hs-identifier hs-var">wrap</span></a><span> </span><a href="#local-6989586621683241658"><span class="hs-identifier hs-var">gt_op</span></a><span>
</span><a name="line-513"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-514"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621683241654"><a href="#local-6989586621683241654"><span class="hs-identifier">lt_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241655"><a href="#local-6989586621683241655"><span class="hs-identifier">le_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241656"><a href="#local-6989586621683241656"><span class="hs-identifier">eq_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241657"><a href="#local-6989586621683241657"><span class="hs-identifier">ge_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241658"><a href="#local-6989586621683241658"><span class="hs-identifier">gt_op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#primOrdOps"><span class="hs-identifier hs-var">primOrdOps</span></a><span> </span><span class="hs-string">&quot;Ord&quot;</span><span> </span><a href="#local-6989586621683241650"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-515"></a><span>   </span><a name="local-6989586621683241659"><a href="#local-6989586621683241659"><span class="hs-identifier">wrap</span></a></a><span> </span><a name="local-6989586621683241662"><a href="#local-6989586621683241662"><span class="hs-identifier">prim_op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><a href="#local-6989586621683241660"><span class="hs-identifier hs-var">a_expr</span></a><span> </span><a href="#local-6989586621683241662"><span class="hs-identifier hs-var">prim_op</span></a><span> </span><a href="#local-6989586621683241661"><span class="hs-identifier hs-var">b_expr</span></a><span>
</span><a name="line-516"></a><span>   </span><a name="local-6989586621683241660"><a href="#local-6989586621683241660"><span class="hs-identifier">a_expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241652"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-517"></a><span>   </span><a name="local-6989586621683241661"><a href="#local-6989586621683241661"><span class="hs-identifier">b_expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241653"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span class="hs-identifier">unliftedCompare</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-520"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>   </span><span class="hs-comment">-- What to cmpare</span><span>
</span><a name="line-521"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-522"></a><span>                                                    </span><span class="hs-comment">-- Three results</span><span>
</span><a name="line-523"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-524"></a><span class="hs-comment">-- Return (if a &lt; b then lt else if a == b then eq else gt)</span><span>
</span><a name="line-525"></a><a name="unliftedCompare"><a href="TcGenDeriv.html#unliftedCompare"><span class="hs-identifier">unliftedCompare</span></a></a><span> </span><a name="local-6989586621683241663"><a href="#local-6989586621683241663"><span class="hs-identifier">lt_op</span></a></a><span> </span><a name="local-6989586621683241664"><a href="#local-6989586621683241664"><span class="hs-identifier">eq_op</span></a></a><span> </span><a name="local-6989586621683241665"><a href="#local-6989586621683241665"><span class="hs-identifier">a_expr</span></a></a><span> </span><a name="local-6989586621683241666"><a href="#local-6989586621683241666"><span class="hs-identifier">b_expr</span></a></a><span> </span><a name="local-6989586621683241667"><a href="#local-6989586621683241667"><span class="hs-identifier">lt</span></a></a><span> </span><a name="local-6989586621683241668"><a href="#local-6989586621683241668"><span class="hs-identifier">eq</span></a></a><span> </span><a name="local-6989586621683241669"><a href="#local-6989586621683241669"><span class="hs-identifier">gt</span></a></a><span>
</span><a name="line-526"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsIf</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241670"><span class="hs-identifier hs-var">ascribeBool</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><a href="#local-6989586621683241665"><span class="hs-identifier hs-var">a_expr</span></a><span> </span><a href="#local-6989586621683241663"><span class="hs-identifier hs-var">lt_op</span></a><span> </span><a href="#local-6989586621683241666"><span class="hs-identifier hs-var">b_expr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241667"><span class="hs-identifier hs-var">lt</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-527"></a><span>                        </span><span class="hs-comment">-- Test (&lt;) first, not (==), because the latter</span><span>
</span><a name="line-528"></a><span>                        </span><span class="hs-comment">-- is true less often, so putting it first would</span><span>
</span><a name="line-529"></a><span>                        </span><span class="hs-comment">-- mean more tests (dynamically)</span><span>
</span><a name="line-530"></a><span>        </span><span class="hs-identifier hs-var">nlHsIf</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241670"><span class="hs-identifier hs-var">ascribeBool</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><a href="#local-6989586621683241665"><span class="hs-identifier hs-var">a_expr</span></a><span> </span><a href="#local-6989586621683241664"><span class="hs-identifier hs-var">eq_op</span></a><span> </span><a href="#local-6989586621683241666"><span class="hs-identifier hs-var">b_expr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241668"><span class="hs-identifier hs-var">eq</span></a><span> </span><a href="#local-6989586621683241669"><span class="hs-identifier hs-var">gt</span></a><span>
</span><a name="line-531"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-532"></a><span>    </span><a name="local-6989586621683241670"><a href="#local-6989586621683241670"><span class="hs-identifier">ascribeBool</span></a></a><span> </span><a name="local-6989586621683241671"><a href="#local-6989586621683241671"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#nlExprWithTySig"><span class="hs-identifier hs-var">nlExprWithTySig</span></a><span> </span><a href="#local-6989586621683241671"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-identifier hs-var">boolTy</span><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span class="hs-identifier">nlConWildPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-535"></a><span class="hs-comment">-- The pattern (K {})</span><span>
</span><a name="line-536"></a><a name="nlConWildPat"><a href="TcGenDeriv.html#nlConWildPat"><span class="hs-identifier">nlConWildPat</span></a></a><span> </span><a name="local-6989586621683241672"><a href="#local-6989586621683241672"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatIn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241672"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-537"></a><span>                                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rec_flds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-538"></a><span>                                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rec_dotdot</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Enum instances
*                                                                      *
************************************************************************

@Enum@ can only be derived for enumeration types.  For a type
\begin{verbatim}
data Foo ... = N1 | N2 | ... | Nn
\end{verbatim}

we use both @con2tag_Foo@ and @tag2con_Foo@ functions, as well as a
@maxtag_Foo@ variable (all generated by @gen_tag_n_con_binds@).

\begin{verbatim}
instance ... Enum (Foo ...) where
    succ x   = toEnum (1 + fromEnum x)
    pred x   = toEnum (fromEnum x - 1)

    toEnum i = tag2con_Foo i

    enumFrom a = map tag2con_Foo [con2tag_Foo a .. maxtag_Foo]

    -- or, really...
    enumFrom a
      = case con2tag_Foo a of
          a# -&gt; map tag2con_Foo (enumFromTo (I# a#) maxtag_Foo)

   enumFromThen a b
     = map tag2con_Foo [con2tag_Foo a, con2tag_Foo b .. maxtag_Foo]

    -- or, really...
    enumFromThen a b
      = case con2tag_Foo a of { a# -&gt;
        case con2tag_Foo b of { b# -&gt;
        map tag2con_Foo (enumFromThenTo (I# a#) (I# b#) maxtag_Foo)
        }}
\end{verbatim}

For @enumFromTo@ and @enumFromThenTo@, we use the default methods.
-}</span><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span class="hs-identifier">gen_Enum_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-584"></a><a name="gen_Enum_binds"><a href="TcGenDeriv.html#gen_Enum_binds"><span class="hs-identifier">gen_Enum_binds</span></a></a><span> </span><a name="local-6989586621683241673"><a href="#local-6989586621683241673"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241674"><a href="#local-6989586621683241674"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-585"></a><span>    </span><a name="local-6989586621683241691"><a href="#local-6989586621683241691"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-586"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241675"><span class="hs-identifier hs-var">method_binds</span></a><span> </span><a href="#local-6989586621683241691"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241676"><span class="hs-identifier hs-var">aux_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-587"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-588"></a><span>    </span><a name="local-6989586621683241675"><a href="#local-6989586621683241675"><span class="hs-identifier">method_binds</span></a></a><span> </span><a name="local-6989586621683241684"><a href="#local-6989586621683241684"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span>
</span><a name="line-589"></a><span>      </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241678"><span class="hs-identifier hs-var">succ_enum</span></a><span>      </span><a href="#local-6989586621683241684"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-590"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241679"><span class="hs-identifier hs-var">pred_enum</span></a><span>      </span><a href="#local-6989586621683241684"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-591"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241680"><span class="hs-identifier hs-var">to_enum</span></a><span>        </span><a href="#local-6989586621683241684"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-592"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241681"><span class="hs-identifier hs-var">enum_from</span></a><span>      </span><a href="#local-6989586621683241684"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-593"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241682"><span class="hs-identifier hs-var">enum_from_then</span></a><span> </span><a href="#local-6989586621683241684"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-594"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241683"><span class="hs-identifier hs-var">from_enum</span></a><span>      </span><a href="#local-6989586621683241684"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-595"></a><span>      </span><span class="hs-special">]</span><span>
</span><a name="line-596"></a><span>    </span><a name="local-6989586621683241676"><a href="#local-6989586621683241676"><span class="hs-identifier">aux_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="TcGenDeriv.html#DerivAuxBind"><span class="hs-identifier hs-var">DerivAuxBind</span></a><span>
</span><a name="line-597"></a><span>                  </span><span class="hs-special">[</span><a href="TcGenDeriv.html#DerivCon2Tag"><span class="hs-identifier hs-var">DerivCon2Tag</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#DerivTag2Con"><span class="hs-identifier hs-var">DerivTag2Con</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#DerivMaxTag"><span class="hs-identifier hs-var">DerivMaxTag</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">]</span><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span>    </span><a name="local-6989586621683241677"><a href="#local-6989586621683241677"><span class="hs-identifier">occ_nm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getOccString</span><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span>    </span><a name="local-6989586621683241678"><a href="#local-6989586621683241678"><span class="hs-identifier">succ_enum</span></a></a><span> </span><a name="local-6989586621683241685"><a href="#local-6989586621683241685"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-602"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241673"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">succ_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-603"></a><span>        </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241685"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-604"></a><span>        </span><span class="hs-identifier hs-var">nlHsIf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">eq_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#maxtag_RDR"><span class="hs-identifier hs-var">maxtag_RDR</span></a><span> </span><a href="#local-6989586621683241685"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-605"></a><span>                               </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span>             </span><span class="hs-special">(</span><a href="TcGenDeriv.html#illegal_Expr"><span class="hs-identifier hs-var">illegal_Expr</span></a><span> </span><span class="hs-string">&quot;succ&quot;</span><span> </span><a href="#local-6989586621683241677"><span class="hs-identifier hs-var">occ_nm</span></a><span> </span><span class="hs-string">&quot;tried to take `succ' of last tag in enumeration&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#tag2con_RDR"><span class="hs-identifier hs-var">tag2con_RDR</span></a><span> </span><a href="#local-6989586621683241685"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">plus_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-609"></a><span>                                        </span><span class="hs-identifier hs-var">nlHsIntLit</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-610"></a><span>
</span><a name="line-611"></a><span>    </span><a name="local-6989586621683241679"><a href="#local-6989586621683241679"><span class="hs-identifier">pred_enum</span></a></a><span> </span><a name="local-6989586621683241686"><a href="#local-6989586621683241686"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-612"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241673"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">pred_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-613"></a><span>        </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241686"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-614"></a><span>        </span><span class="hs-identifier hs-var">nlHsIf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">eq_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsIntLit</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span>
</span><a name="line-615"></a><span>                               </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-616"></a><span>             </span><span class="hs-special">(</span><a href="TcGenDeriv.html#illegal_Expr"><span class="hs-identifier hs-var">illegal_Expr</span></a><span> </span><span class="hs-string">&quot;pred&quot;</span><span> </span><a href="#local-6989586621683241677"><span class="hs-identifier hs-var">occ_nm</span></a><span> </span><span class="hs-string">&quot;tried to take `pred' of first tag in enumeration&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-617"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#tag2con_RDR"><span class="hs-identifier hs-var">tag2con_RDR</span></a><span> </span><a href="#local-6989586621683241686"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">plus_RDR</span><span>
</span><a name="line-619"></a><span>                            </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span>
</span><a name="line-620"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt</span><span> </span><span class="hs-identifier hs-var">noExt</span><span>
</span><a name="line-621"></a><span>                                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-622"></a><span>
</span><a name="line-623"></a><span>    </span><a name="local-6989586621683241680"><a href="#local-6989586621683241680"><span class="hs-identifier">to_enum</span></a></a><span> </span><a name="local-6989586621683241687"><a href="#local-6989586621683241687"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-624"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241673"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">toEnum_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-625"></a><span>        </span><span class="hs-identifier hs-var">nlHsIf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">and_RDR</span><span>
</span><a name="line-626"></a><span>                </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">ge_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsIntLit</span><span> </span><span class="hs-number">0</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-627"></a><span>                 </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">le_RDR</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span>
</span><a name="line-628"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#maxtag_RDR"><span class="hs-identifier hs-var">maxtag_RDR</span></a><span> </span><a href="#local-6989586621683241687"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-629"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#tag2con_RDR"><span class="hs-identifier hs-var">tag2con_RDR</span></a><span> </span><a href="#local-6989586621683241687"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-630"></a><span>             </span><span class="hs-special">(</span><a href="TcGenDeriv.html#illegal_toEnum_tag"><span class="hs-identifier hs-var">illegal_toEnum_tag</span></a><span> </span><a href="#local-6989586621683241677"><span class="hs-identifier hs-var">occ_nm</span></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#maxtag_RDR"><span class="hs-identifier hs-var">maxtag_RDR</span></a><span> </span><a href="#local-6989586621683241687"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span>    </span><a name="local-6989586621683241681"><a href="#local-6989586621683241681"><span class="hs-identifier">enum_from</span></a></a><span> </span><a name="local-6989586621683241688"><a href="#local-6989586621683241688"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-633"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241673"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">enumFrom_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-634"></a><span>          </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241688"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-635"></a><span>          </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">map_RDR</span><span>
</span><a name="line-636"></a><span>                </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#tag2con_RDR"><span class="hs-identifier hs-var">tag2con_RDR</span></a><span> </span><a href="#local-6989586621683241688"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-637"></a><span>                 </span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#enum_from_to_Expr"><span class="hs-identifier hs-var">enum_from_to_Expr</span></a><span>
</span><a name="line-638"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-639"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#maxtag_RDR"><span class="hs-identifier hs-var">maxtag_RDR</span></a><span> </span><a href="#local-6989586621683241688"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-640"></a><span>
</span><a name="line-641"></a><span>    </span><a name="local-6989586621683241682"><a href="#local-6989586621683241682"><span class="hs-identifier">enum_from_then</span></a></a><span> </span><a name="local-6989586621683241689"><a href="#local-6989586621683241689"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-642"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241673"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">enumFromThen_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier hs-var">b_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-643"></a><span>          </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241689"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-644"></a><span>          </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">map_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#tag2con_RDR"><span class="hs-identifier hs-var">tag2con_RDR</span></a><span> </span><a href="#local-6989586621683241689"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-645"></a><span>            </span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#enum_from_then_to_Expr"><span class="hs-identifier hs-var">enum_from_then_to_Expr</span></a><span>
</span><a name="line-646"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-647"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-648"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsIf</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">gt_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-649"></a><span>                                               </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-650"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsIntLit</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#maxtag_RDR"><span class="hs-identifier hs-var">maxtag_RDR</span></a><span> </span><a href="#local-6989586621683241689"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>                           </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-653"></a><span>
</span><a name="line-654"></a><span>    </span><a name="local-6989586621683241683"><a href="#local-6989586621683241683"><span class="hs-identifier">from_enum</span></a></a><span> </span><a name="local-6989586621683241690"><a href="#local-6989586621683241690"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-655"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241673"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">fromEnum_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-656"></a><span>          </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241690"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241674"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-657"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-658"></a><span>
</span><a name="line-659"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Bounded instances
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">gen_Bounded_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-668"></a><a name="gen_Bounded_binds"><a href="TcGenDeriv.html#gen_Bounded_binds"><span class="hs-identifier">gen_Bounded_binds</span></a></a><span> </span><a name="local-6989586621683241692"><a href="#local-6989586621683241692"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241693"><a href="#local-6989586621683241693"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-669"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isEnumerationTyCon</span><span> </span><a href="#local-6989586621683241693"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-670"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241695"><span class="hs-identifier hs-var">min_bound_enum</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241696"><span class="hs-identifier hs-var">max_bound_enum</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">)</span><span>
</span><a name="line-671"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-672"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">isSingleton</span><span> </span><span class="hs-identifier">data_cons</span><span class="hs-special">)</span><span>
</span><a name="line-673"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241702"><span class="hs-identifier hs-var">min_bound_1con</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241703"><span class="hs-identifier hs-var">max_bound_1con</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">)</span><span>
</span><a name="line-674"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-675"></a><span>    </span><a name="local-6989586621683241694"><a href="#local-6989586621683241694"><span class="hs-identifier">data_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683241693"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-676"></a><span>
</span><a name="line-677"></a><span>    </span><span class="hs-comment">----- enum-flavored: ---------------------------</span><span>
</span><a name="line-678"></a><span>    </span><a name="local-6989586621683241695"><a href="#local-6989586621683241695"><span class="hs-identifier">min_bound_enum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241692"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">minBound_RDR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241699"><span class="hs-identifier hs-var">data_con_1_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-679"></a><span>    </span><a name="local-6989586621683241696"><a href="#local-6989586621683241696"><span class="hs-identifier">max_bound_enum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241692"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">maxBound_RDR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241700"><span class="hs-identifier hs-var">data_con_N_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-680"></a><span>
</span><a name="line-681"></a><span>    </span><a name="local-6989586621683241697"><a href="#local-6989586621683241697"><span class="hs-identifier">data_con_1</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621683241694"><span class="hs-identifier hs-var">data_cons</span></a><span>
</span><a name="line-682"></a><span>    </span><a name="local-6989586621683241698"><a href="#local-6989586621683241698"><span class="hs-identifier">data_con_N</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">last</span><span> </span><a href="#local-6989586621683241694"><span class="hs-identifier hs-var">data_cons</span></a><span>
</span><a name="line-683"></a><span>    </span><a name="local-6989586621683241699"><a href="#local-6989586621683241699"><span class="hs-identifier">data_con_1_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241697"><span class="hs-identifier hs-var">data_con_1</span></a><span>
</span><a name="line-684"></a><span>    </span><a name="local-6989586621683241700"><a href="#local-6989586621683241700"><span class="hs-identifier">data_con_N_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241698"><span class="hs-identifier hs-var">data_con_N</span></a><span>
</span><a name="line-685"></a><span>
</span><a name="line-686"></a><span>    </span><span class="hs-comment">----- single-constructor-flavored: -------------</span><span>
</span><a name="line-687"></a><span>    </span><a name="local-6989586621683241701"><a href="#local-6989586621683241701"><span class="hs-identifier">arity</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241697"><span class="hs-identifier hs-var">data_con_1</span></a><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span>    </span><a name="local-6989586621683241702"><a href="#local-6989586621683241702"><span class="hs-identifier">min_bound_1con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241692"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">minBound_RDR</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-690"></a><span>                     </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><a href="#local-6989586621683241699"><span class="hs-identifier hs-var">data_con_1_RDR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nOfThem</span><span> </span><a href="#local-6989586621683241701"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-identifier hs-var">minBound_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-691"></a><span>    </span><a name="local-6989586621683241703"><a href="#local-6989586621683241703"><span class="hs-identifier">max_bound_1con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241692"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">maxBound_RDR</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-692"></a><span>                     </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><a href="#local-6989586621683241699"><span class="hs-identifier hs-var">data_con_1_RDR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nOfThem</span><span> </span><a href="#local-6989586621683241701"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-identifier hs-var">maxBound_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Ix instances
*                                                                      *
************************************************************************

Deriving @Ix@ is only possible for enumeration types and
single-constructor types.  We deal with them in turn.

For an enumeration type, e.g.,
\begin{verbatim}
    data Foo ... = N1 | N2 | ... | Nn
\end{verbatim}
things go not too differently from @Enum@:
\begin{verbatim}
instance ... Ix (Foo ...) where
    range (a, b)
      = map tag2con_Foo [con2tag_Foo a .. con2tag_Foo b]

    -- or, really...
    range (a, b)
      = case (con2tag_Foo a) of { a# -&gt;
        case (con2tag_Foo b) of { b# -&gt;
        map tag2con_Foo (enumFromTo (I# a#) (I# b#))
        }}

    -- Generate code for unsafeIndex, because using index leads
    -- to lots of redundant range tests
    unsafeIndex c@(a, b) d
      = case (con2tag_Foo d -# con2tag_Foo a) of
               r# -&gt; I# r#

    inRange (a, b) c
      = let
            p_tag = con2tag_Foo c
        in
        p_tag &gt;= con2tag_Foo a &amp;&amp; p_tag &lt;= con2tag_Foo b

    -- or, really...
    inRange (a, b) c
      = case (con2tag_Foo a)   of { a_tag -&gt;
        case (con2tag_Foo b)   of { b_tag -&gt;
        case (con2tag_Foo c)   of { c_tag -&gt;
        if (c_tag &gt;=# a_tag) then
          c_tag &lt;=# b_tag
        else
          False
        }}}
\end{verbatim}
(modulo suitable case-ification to handle the unlifted tags)

For a single-constructor type (NB: this includes all tuples), e.g.,
\begin{verbatim}
    data Foo ... = MkFoo a b Int Double c c
\end{verbatim}
we follow the scheme given in Figure~19 of the Haskell~1.2 report
(p.~147).
-}</span><span>
</span><a name="line-753"></a><span>
</span><a name="line-754"></a><span class="hs-identifier">gen_Ix_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><a name="gen_Ix_binds"><a href="TcGenDeriv.html#gen_Ix_binds"><span class="hs-identifier">gen_Ix_binds</span></a></a><span> </span><a name="local-6989586621683241704"><a href="#local-6989586621683241704"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241705"><a href="#local-6989586621683241705"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-757"></a><span>    </span><a name="local-6989586621683241750"><a href="#local-6989586621683241750"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-758"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isEnumerationTyCon</span><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-759"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241706"><span class="hs-identifier hs-var">enum_ixes</span></a><span> </span><a href="#local-6989586621683241750"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="TcGenDeriv.html#DerivAuxBind"><span class="hs-identifier hs-var">DerivAuxBind</span></a><span>
</span><a name="line-760"></a><span>                   </span><span class="hs-special">[</span><a href="TcGenDeriv.html#DerivCon2Tag"><span class="hs-identifier hs-var">DerivCon2Tag</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#DerivTag2Con"><span class="hs-identifier hs-var">DerivTag2Con</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#DerivMaxTag"><span class="hs-identifier hs-var">DerivMaxTag</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-761"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241710"><span class="hs-identifier hs-var">single_con_ixes</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivAuxBind"><span class="hs-identifier hs-var">DerivAuxBind</span></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivCon2Tag"><span class="hs-identifier hs-var">DerivCon2Tag</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-762"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-763"></a><span>    </span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><a name="line-764"></a><span>    </span><a name="local-6989586621683241706"><a href="#local-6989586621683241706"><span class="hs-identifier">enum_ixes</span></a></a><span> </span><a name="local-6989586621683241722"><a href="#local-6989586621683241722"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span>
</span><a name="line-765"></a><span>      </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241707"><span class="hs-identifier hs-var">enum_range</span></a><span>   </span><a href="#local-6989586621683241722"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-766"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241708"><span class="hs-identifier hs-var">enum_index</span></a><span>   </span><a href="#local-6989586621683241722"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-767"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241709"><span class="hs-identifier hs-var">enum_inRange</span></a><span> </span><a href="#local-6989586621683241722"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-768"></a><span>      </span><span class="hs-special">]</span><span>
</span><a name="line-769"></a><span>
</span><a name="line-770"></a><span>    </span><a name="local-6989586621683241707"><a href="#local-6989586621683241707"><span class="hs-identifier">enum_range</span></a></a><span> </span><a name="local-6989586621683241723"><a href="#local-6989586621683241723"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-771"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241704"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">range_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlTuplePat</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier hs-var">b_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Boxed</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-772"></a><span>          </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241723"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-773"></a><span>          </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241723"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-774"></a><span>          </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">map_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#tag2con_RDR"><span class="hs-identifier hs-var">tag2con_RDR</span></a><span> </span><a href="#local-6989586621683241723"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-775"></a><span>              </span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#enum_from_to_Expr"><span class="hs-identifier hs-var">enum_from_to_Expr</span></a><span>
</span><a name="line-776"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-778"></a><span>
</span><a name="line-779"></a><span>    </span><a name="local-6989586621683241708"><a href="#local-6989586621683241708"><span class="hs-identifier">enum_index</span></a></a><span> </span><a name="local-6989586621683241724"><a href="#local-6989586621683241724"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-780"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241704"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">unsafeIndex_RDR</span><span>
</span><a name="line-781"></a><span>                </span><span class="hs-special">[</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AsPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><a href="TcGenDeriv.html#c_RDR"><span class="hs-identifier hs-var">c_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-782"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlTuplePat</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Boxed</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-783"></a><span>                                </span><a href="TcGenDeriv.html#d_Pat"><span class="hs-identifier hs-var">d_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-784"></a><span>           </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241724"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-785"></a><span>           </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241724"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#d_RDR"><span class="hs-identifier hs-var">d_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#dh_RDR"><span class="hs-identifier hs-var">dh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-786"></a><span>           </span><span class="hs-keyword">let</span><span>
</span><a name="line-787"></a><span>                </span><a name="local-6989586621683241725"><a href="#local-6989586621683241725"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#c_RDR"><span class="hs-identifier hs-var">c_RDR</span></a><span class="hs-special">]</span><span>
</span><a name="line-788"></a><span>           </span><span class="hs-keyword">in</span><span>
</span><a name="line-789"></a><span>           </span><span class="hs-identifier hs-var">nlHsCase</span><span>
</span><a name="line-790"></a><span>             </span><span class="hs-special">(</span><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier hs-var">genOpApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#dh_RDR"><span class="hs-identifier hs-var">dh_RDR</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#minusInt_RDR"><span class="hs-identifier hs-var">minusInt_RDR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-791"></a><span>             </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#c_RDR"><span class="hs-identifier hs-var">c_RDR</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241725"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">]</span><span>
</span><a name="line-792"></a><span>           </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-793"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span>    </span><span class="hs-comment">-- This produces something like `(ch &gt;= ah) &amp;&amp; (ch &lt;= bh)`</span><span>
</span><a name="line-796"></a><span>    </span><a name="local-6989586621683241709"><a href="#local-6989586621683241709"><span class="hs-identifier">enum_inRange</span></a></a><span> </span><a name="local-6989586621683241726"><a href="#local-6989586621683241726"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-797"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241704"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">inRange_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlTuplePat</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier hs-var">b_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Boxed</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#c_Pat"><span class="hs-identifier hs-var">c_Pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-798"></a><span>          </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241726"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-799"></a><span>          </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241726"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-800"></a><span>          </span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683241726"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcGenDeriv.html#c_RDR"><span class="hs-identifier hs-var">c_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#ch_RDR"><span class="hs-identifier hs-var">ch_RDR</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-801"></a><span>          </span><span class="hs-comment">-- This used to use `if`, which interacts badly with RebindableSyntax.</span><span>
</span><a name="line-802"></a><span>          </span><span class="hs-comment">-- See #11396.</span><span>
</span><a name="line-803"></a><span>          </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">and_RDR</span><span>
</span><a name="line-804"></a><span>              </span><span class="hs-special">[</span><span> </span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#ch_RDR"><span class="hs-identifier hs-var">ch_RDR</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#geInt_RDR"><span class="hs-identifier hs-var">geInt_RDR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier hs-var">ah_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-805"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#ch_RDR"><span class="hs-identifier hs-var">ch_RDR</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#leInt_RDR"><span class="hs-identifier hs-var">leInt_RDR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier hs-var">bh_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-806"></a><span>              </span><span class="hs-special">]</span><span>
</span><a name="line-807"></a><span>          </span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-808"></a><span>
</span><a name="line-809"></a><span>    </span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><a name="line-810"></a><span>    </span><a name="local-6989586621683241710"><a href="#local-6989586621683241710"><span class="hs-identifier">single_con_ixes</span></a></a><span>
</span><a name="line-811"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241719"><span class="hs-identifier hs-var">single_con_range</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241720"><span class="hs-identifier hs-var">single_con_index</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241721"><span class="hs-identifier hs-var">single_con_inRange</span></a><span class="hs-special">]</span><span>
</span><a name="line-812"></a><span>
</span><a name="line-813"></a><span>    </span><a name="local-6989586621683241711"><a href="#local-6989586621683241711"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-814"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tyConSingleDataCon_maybe</span><span> </span><a href="#local-6989586621683241705"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- just checking...</span><span>
</span><a name="line-815"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;get_Ix_binds&quot;</span><span>
</span><a name="line-816"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683241727"><a href="#local-6989586621683241727"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683241727"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-817"></a><span>
</span><a name="line-818"></a><span>    </span><a name="local-6989586621683241712"><a href="#local-6989586621683241712"><span class="hs-identifier">con_arity</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241711"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-819"></a><span>    </span><a name="local-6989586621683241713"><a href="#local-6989586621683241713"><span class="hs-identifier">data_con_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241711"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-820"></a><span>
</span><a name="line-821"></a><span>    </span><a name="local-6989586621683241714"><a href="#local-6989586621683241714"><span class="hs-identifier">as_needed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683241712"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><a href="TcGenDeriv.html#as_RDRs"><span class="hs-identifier hs-var">as_RDRs</span></a><span>
</span><a name="line-822"></a><span>    </span><a name="local-6989586621683241715"><a href="#local-6989586621683241715"><span class="hs-identifier">bs_needed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683241712"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><a href="TcGenDeriv.html#bs_RDRs"><span class="hs-identifier hs-var">bs_RDRs</span></a><span>
</span><a name="line-823"></a><span>    </span><a name="local-6989586621683241716"><a href="#local-6989586621683241716"><span class="hs-identifier">cs_needed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683241712"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><a href="TcGenDeriv.html#cs_RDRs"><span class="hs-identifier hs-var">cs_RDRs</span></a><span>
</span><a name="line-824"></a><span>
</span><a name="line-825"></a><span>    </span><a name="local-6989586621683241717"><a href="#local-6989586621683241717"><span class="hs-identifier">con_pat</span></a></a><span>  </span><a name="local-6989586621683241728"><a href="#local-6989586621683241728"><span class="hs-identifier">xs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><a href="#local-6989586621683241713"><span class="hs-identifier hs-var">data_con_RDR</span></a><span> </span><a href="#local-6989586621683241728"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-826"></a><span>    </span><a name="local-6989586621683241718"><a href="#local-6989586621683241718"><span class="hs-identifier">con_expr</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><a href="#local-6989586621683241713"><span class="hs-identifier hs-var">data_con_RDR</span></a><span> </span><a href="#local-6989586621683241716"><span class="hs-identifier hs-var">cs_needed</span></a><span>
</span><a name="line-827"></a><span>
</span><a name="line-828"></a><span>    </span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><a name="line-829"></a><span>    </span><a name="local-6989586621683241719"><a href="#local-6989586621683241719"><span class="hs-identifier">single_con_range</span></a></a><span>
</span><a name="line-830"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241704"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">range_RDR</span><span>
</span><a name="line-831"></a><span>          </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlTuplePat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241717"><span class="hs-identifier hs-var">con_pat</span></a><span> </span><a href="#local-6989586621683241714"><span class="hs-identifier hs-var">as_needed</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241717"><span class="hs-identifier hs-var">con_pat</span></a><span> </span><a href="#local-6989586621683241715"><span class="hs-identifier hs-var">bs_needed</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Boxed</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-832"></a><span>        </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsComp</span><span> </span><span class="hs-identifier hs-var">ListComp</span><span> </span><a href="#local-6989586621683241729"><span class="hs-identifier hs-var">stmts</span></a><span> </span><a href="#local-6989586621683241718"><span class="hs-identifier hs-var">con_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-833"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-834"></a><span>        </span><a name="local-6989586621683241729"><a href="#local-6989586621683241729"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith3Equal</span><span> </span><span class="hs-string">&quot;single_con_range&quot;</span><span> </span><a href="#local-6989586621683241730"><span class="hs-identifier hs-var">mk_qual</span></a><span> </span><a href="#local-6989586621683241714"><span class="hs-identifier hs-var">as_needed</span></a><span> </span><a href="#local-6989586621683241715"><span class="hs-identifier hs-var">bs_needed</span></a><span> </span><a href="#local-6989586621683241716"><span class="hs-identifier hs-var">cs_needed</span></a><span>
</span><a name="line-835"></a><span>
</span><a name="line-836"></a><span>        </span><a name="local-6989586621683241730"><a href="#local-6989586621683241730"><span class="hs-identifier">mk_qual</span></a></a><span> </span><a name="local-6989586621683241731"><a href="#local-6989586621683241731"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683241732"><a href="#local-6989586621683241732"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621683241733"><a href="#local-6989586621683241733"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkBindStmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="#local-6989586621683241733"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-837"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">range_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-838"></a><span>                                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLHsVarTuple</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241731"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621683241732"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-839"></a><span>
</span><a name="line-840"></a><span>    </span><span class="hs-comment">----------------</span><span>
</span><a name="line-841"></a><span>    </span><a name="local-6989586621683241720"><a href="#local-6989586621683241720"><span class="hs-identifier">single_con_index</span></a></a><span>
</span><a name="line-842"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241704"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">unsafeIndex_RDR</span><span>
</span><a name="line-843"></a><span>                </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlTuplePat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241717"><span class="hs-identifier hs-var">con_pat</span></a><span> </span><a href="#local-6989586621683241714"><span class="hs-identifier hs-var">as_needed</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241717"><span class="hs-identifier hs-var">con_pat</span></a><span> </span><a href="#local-6989586621683241715"><span class="hs-identifier hs-var">bs_needed</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Boxed</span><span class="hs-special">,</span><span>
</span><a name="line-844"></a><span>                 </span><a href="#local-6989586621683241717"><span class="hs-identifier hs-var">con_pat</span></a><span> </span><a href="#local-6989586621683241716"><span class="hs-identifier hs-var">cs_needed</span></a><span class="hs-special">]</span><span>
</span><a name="line-845"></a><span>        </span><span class="hs-comment">-- We need to reverse the order we consider the components in</span><span>
</span><a name="line-846"></a><span>        </span><span class="hs-comment">-- so that</span><span>
</span><a name="line-847"></a><span>        </span><span class="hs-comment">--     range (l,u) !! index (l,u) i == i   -- when i is in range</span><span>
</span><a name="line-848"></a><span>        </span><span class="hs-comment">-- (from http://haskell.org/onlinereport/ix.html) holds.</span><span>
</span><a name="line-849"></a><span>                </span><span class="hs-special">(</span><a href="#local-6989586621683241734"><span class="hs-identifier hs-var">mk_index</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip3</span><span> </span><a href="#local-6989586621683241714"><span class="hs-identifier hs-var">as_needed</span></a><span> </span><a href="#local-6989586621683241715"><span class="hs-identifier hs-var">bs_needed</span></a><span> </span><a href="#local-6989586621683241716"><span class="hs-identifier hs-var">cs_needed</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-850"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-851"></a><span>        </span><span class="hs-comment">-- index (l1,u1) i1 + rangeSize (l1,u1) * (index (l2,u2) i2 + ...)</span><span>
</span><a name="line-852"></a><span>        </span><a name="local-6989586621683241734"><a href="#local-6989586621683241734"><span class="hs-identifier">mk_index</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsIntLit</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-853"></a><span>        </span><span class="hs-identifier">mk_index</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-6989586621683241736"><a href="#local-6989586621683241736"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621683241737"><a href="#local-6989586621683241737"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><a name="local-6989586621683241738"><a href="#local-6989586621683241738"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241735"><span class="hs-identifier hs-var">mk_one</span></a><span> </span><a href="#local-6989586621683241736"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621683241737"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621683241738"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-854"></a><span>        </span><span class="hs-identifier">mk_index</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621683241739"><a href="#local-6989586621683241739"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621683241740"><a href="#local-6989586621683241740"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><a name="local-6989586621683241741"><a href="#local-6989586621683241741"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621683241742"><a href="#local-6989586621683241742"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-855"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier hs-var">genOpApp</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-856"></a><span>                </span><a href="#local-6989586621683241735"><span class="hs-identifier hs-var">mk_one</span></a><span> </span><a href="#local-6989586621683241739"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621683241740"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621683241741"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-857"></a><span>            </span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">plus_RDR</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-858"></a><span>                </span><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier hs-var">genOpApp</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-859"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">unsafeRangeSize_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-860"></a><span>                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLHsVarTuple</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241739"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621683241740"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-861"></a><span>                </span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">times_RDR</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241734"><span class="hs-identifier hs-var">mk_index</span></a><span> </span><a href="#local-6989586621683241742"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-862"></a><span>           </span><span class="hs-special">)</span><span>
</span><a name="line-863"></a><span>        </span><a name="local-6989586621683241735"><a href="#local-6989586621683241735"><span class="hs-identifier">mk_one</span></a></a><span> </span><a name="local-6989586621683241743"><a href="#local-6989586621683241743"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621683241744"><a href="#local-6989586621683241744"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621683241745"><a href="#local-6989586621683241745"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-864"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">unsafeIndex_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkLHsVarTuple</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241743"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621683241744"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241745"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">]</span><span>
</span><a name="line-865"></a><span>
</span><a name="line-866"></a><span>    </span><span class="hs-comment">------------------</span><span>
</span><a name="line-867"></a><span>    </span><a name="local-6989586621683241721"><a href="#local-6989586621683241721"><span class="hs-identifier">single_con_inRange</span></a></a><span>
</span><a name="line-868"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241704"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">inRange_RDR</span><span>
</span><a name="line-869"></a><span>                </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlTuplePat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241717"><span class="hs-identifier hs-var">con_pat</span></a><span> </span><a href="#local-6989586621683241714"><span class="hs-identifier hs-var">as_needed</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241717"><span class="hs-identifier hs-var">con_pat</span></a><span> </span><a href="#local-6989586621683241715"><span class="hs-identifier hs-var">bs_needed</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Boxed</span><span class="hs-special">,</span><span>
</span><a name="line-870"></a><span>                 </span><a href="#local-6989586621683241717"><span class="hs-identifier hs-var">con_pat</span></a><span> </span><a href="#local-6989586621683241716"><span class="hs-identifier hs-var">cs_needed</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-871"></a><span>          </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621683241712"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-872"></a><span>             </span><span class="hs-comment">-- If the product type has no fields, inRange is trivially true</span><span>
</span><a name="line-873"></a><span>             </span><span class="hs-comment">-- (see Trac #12853).</span><span>
</span><a name="line-874"></a><span>             </span><span class="hs-keyword">then</span><span> </span><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier hs-var">true_Expr</span></a><span>
</span><a name="line-875"></a><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">foldl1</span><span> </span><a href="TcGenDeriv.html#and_Expr"><span class="hs-identifier hs-var">and_Expr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith3Equal</span><span> </span><span class="hs-string">&quot;single_con_inRange&quot;</span><span> </span><a href="#local-6989586621683241746"><span class="hs-identifier hs-var">in_range</span></a><span>
</span><a name="line-876"></a><span>                    </span><a href="#local-6989586621683241714"><span class="hs-identifier hs-var">as_needed</span></a><span> </span><a href="#local-6989586621683241715"><span class="hs-identifier hs-var">bs_needed</span></a><span> </span><a href="#local-6989586621683241716"><span class="hs-identifier hs-var">cs_needed</span></a><span class="hs-special">)</span><span>
</span><a name="line-877"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-878"></a><span>        </span><a name="local-6989586621683241746"><a href="#local-6989586621683241746"><span class="hs-identifier">in_range</span></a></a><span> </span><a name="local-6989586621683241747"><a href="#local-6989586621683241747"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683241748"><a href="#local-6989586621683241748"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621683241749"><a href="#local-6989586621683241749"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">inRange_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkLHsVarTuple</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241747"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621683241748"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241749"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-879"></a><span>
</span><a name="line-880"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Read instances
*                                                                      *
************************************************************************

Example

  infix 4 %%
  data T = Int %% Int
         | T1 { f1 :: Int }
         | T2 T

instance Read T where
  readPrec =
    parens
    ( prec 4 (
        do x &lt;- ReadP.step Read.readPrec
           expectP (Symbol &quot;%%&quot;)
           y &lt;- ReadP.step Read.readPrec
           return (x %% y))
      +++
      prec (appPrec+1) (
        -- Note the &quot;+1&quot; part; &quot;T2 T1 {f1=3}&quot; should parse ok
        -- Record construction binds even more tightly than application
        do expectP (Ident &quot;T1&quot;)
           expectP (Punc '{')
           x          &lt;- Read.readField &quot;f1&quot; (ReadP.reset readPrec)
           expectP (Punc '}')
           return (T1 { f1 = x }))
      +++
      prec appPrec (
        do expectP (Ident &quot;T2&quot;)
           x &lt;- ReadP.step Read.readPrec
           return (T2 x))
    )

  readListPrec = readListPrecDefault
  readList     = readListDefault


Note [Use expectP]
~~~~~~~~~~~~~~~~~~
Note that we use
   expectP (Ident &quot;T1&quot;)
rather than
   Ident &quot;T1&quot; &lt;- lexP
The latter desugares to inline code for matching the Ident and the
string, and this can be very voluminous. The former is much more
compact.  Cf Trac #7258, although that also concerned non-linearity in
the occurrence analyser, a separate issue.

Note [Read for empty data types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
What should we get for this?  (Trac #7931)
   data Emp deriving( Read )   -- No data constructors

Here we want
  read &quot;[]&quot; :: [Emp]   to succeed, returning []
So we do NOT want
   instance Read Emp where
     readPrec = error &quot;urk&quot;
Rather we want
   instance Read Emp where
     readPred = pfail   -- Same as choose []

Because 'pfail' allows the parser to backtrack, but 'error' doesn't.
These instances are also useful for Read (Either Int Emp), where
we want to be able to parse (Left 3) just fine.
-}</span><span>
</span><a name="line-951"></a><span>
</span><a name="line-952"></a><span class="hs-identifier">gen_Read_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span>
</span><a name="line-953"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><a name="gen_Read_binds"><a href="TcGenDeriv.html#gen_Read_binds"><span class="hs-identifier">gen_Read_binds</span></a></a><span> </span><a name="local-6989586621683241751"><a href="#local-6989586621683241751"><span class="hs-identifier">get_fixity</span></a></a><span> </span><a name="local-6989586621683241752"><a href="#local-6989586621683241752"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241753"><a href="#local-6989586621683241753"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-956"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241759"><span class="hs-identifier hs-var">read_prec</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241754"><span class="hs-identifier hs-var">default_readlist</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241755"><span class="hs-identifier hs-var">default_readlistprec</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">)</span><span>
</span><a name="line-957"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-958"></a><span>    </span><span class="hs-comment">-----------------------------------------------------------------------</span><span>
</span><a name="line-959"></a><span>    </span><a name="local-6989586621683241754"><a href="#local-6989586621683241754"><span class="hs-identifier">default_readlist</span></a></a><span>
</span><a name="line-960"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241752"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">readList_RDR</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">readListDefault_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-961"></a><span>
</span><a name="line-962"></a><span>    </span><a name="local-6989586621683241755"><a href="#local-6989586621683241755"><span class="hs-identifier">default_readlistprec</span></a></a><span>
</span><a name="line-963"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241752"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">readListPrec_RDR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">readListPrecDefault_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-964"></a><span>    </span><span class="hs-comment">-----------------------------------------------------------------------</span><span>
</span><a name="line-965"></a><span>
</span><a name="line-966"></a><span>    </span><a name="local-6989586621683241756"><a href="#local-6989586621683241756"><span class="hs-identifier">data_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683241753"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-967"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683241757"><a href="#local-6989586621683241757"><span class="hs-identifier">nullary_cons</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241758"><a href="#local-6989586621683241758"><span class="hs-identifier">non_nullary_cons</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-identifier hs-var">isNullarySrcDataCon</span><span> </span><a href="#local-6989586621683241756"><span class="hs-identifier hs-var">data_cons</span></a><span>
</span><a name="line-968"></a><span>
</span><a name="line-969"></a><span>    </span><a name="local-6989586621683241759"><a href="#local-6989586621683241759"><span class="hs-identifier">read_prec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241752"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">readPrec_RDR</span><span> </span><a href="#local-6989586621683241777"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-970"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-971"></a><span>        </span><a name="local-6989586621683241777"><a href="#local-6989586621683241777"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683241756"><span class="hs-identifier hs-var">data_cons</span></a><span> </span><span class="hs-comment">-- See Note [Read for empty data types]</span><span>
</span><a name="line-972"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">pfail_RDR</span><span>
</span><a name="line-973"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-974"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">parens_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-975"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr1</span><span> </span><a href="#local-6989586621683241765"><span class="hs-identifier hs-var">mk_alt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241761"><span class="hs-identifier hs-var">read_nullary_cons</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-976"></a><span>                                      </span><a href="#local-6989586621683241760"><span class="hs-identifier hs-var">read_non_nullary_cons</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>
</span><a name="line-978"></a><span>    </span><a name="local-6989586621683241760"><a href="#local-6989586621683241760"><span class="hs-identifier">read_non_nullary_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683241764"><span class="hs-identifier hs-var">read_non_nullary_con</span></a><span> </span><a href="#local-6989586621683241758"><span class="hs-identifier hs-var">non_nullary_cons</span></a><span>
</span><a name="line-979"></a><span>
</span><a name="line-980"></a><span>    </span><a name="local-6989586621683241761"><a href="#local-6989586621683241761"><span class="hs-identifier">read_nullary_cons</span></a></a><span>
</span><a name="line-981"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683241757"><span class="hs-identifier hs-var">nullary_cons</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-982"></a><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-983"></a><span>            </span><span class="hs-special">[</span><a name="local-6989586621683241778"><a href="#local-6989586621683241778"><span class="hs-identifier">con</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsDo</span><span> </span><span class="hs-identifier hs-var">DoExpr</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241762"><span class="hs-identifier hs-var">match_con</span></a><span> </span><a href="#local-6989586621683241778"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkLastStmt</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241768"><span class="hs-identifier hs-var">result_expr</span></a><span> </span><a href="#local-6989586621683241778"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-984"></a><span>            </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">choose_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-985"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683241763"><span class="hs-identifier hs-var">mk_pair</span></a><span> </span><a href="#local-6989586621683241757"><span class="hs-identifier hs-var">nullary_cons</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-986"></a><span>        </span><span class="hs-comment">-- NB For operators the parens around (:=:) are matched by the</span><span>
</span><a name="line-987"></a><span>        </span><span class="hs-comment">-- enclosing &quot;parens&quot; call, so here we must match the naked</span><span>
</span><a name="line-988"></a><span>        </span><span class="hs-comment">-- data_con_str con</span><span>
</span><a name="line-989"></a><span>
</span><a name="line-990"></a><span>    </span><a name="local-6989586621683241762"><a href="#local-6989586621683241762"><span class="hs-identifier">match_con</span></a></a><span> </span><a name="local-6989586621683241779"><a href="#local-6989586621683241779"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcGenDeriv.html#isSym"><span class="hs-identifier hs-var">isSym</span></a><span> </span><a href="#local-6989586621683241780"><span class="hs-identifier hs-var">con_str</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241772"><span class="hs-identifier hs-var">symbol_pat</span></a><span> </span><a href="#local-6989586621683241780"><span class="hs-identifier hs-var">con_str</span></a><span class="hs-special">]</span><span>
</span><a name="line-991"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241769"><span class="hs-identifier hs-var">ident_h_pat</span></a><span>  </span><a href="#local-6989586621683241780"><span class="hs-identifier hs-var">con_str</span></a><span>
</span><a name="line-992"></a><span>                  </span><span class="hs-keyword">where</span><span>
</span><a name="line-993"></a><span>                    </span><a name="local-6989586621683241780"><a href="#local-6989586621683241780"><span class="hs-identifier">con_str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241774"><span class="hs-identifier hs-var">data_con_str</span></a><span> </span><a href="#local-6989586621683241779"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-994"></a><span>        </span><span class="hs-comment">-- For nullary constructors we must match Ident s for normal constrs</span><span>
</span><a name="line-995"></a><span>        </span><span class="hs-comment">-- and   Symbol s   for operators</span><span>
</span><a name="line-996"></a><span>
</span><a name="line-997"></a><span>    </span><a name="local-6989586621683241763"><a href="#local-6989586621683241763"><span class="hs-identifier">mk_pair</span></a></a><span> </span><a name="local-6989586621683241781"><a href="#local-6989586621683241781"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLHsTupleExpr</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241774"><span class="hs-identifier hs-var">data_con_str</span></a><span> </span><a href="#local-6989586621683241781"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-998"></a><span>                                  </span><a href="#local-6989586621683241768"><span class="hs-identifier hs-var">result_expr</span></a><span> </span><a href="#local-6989586621683241781"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-999"></a><span>
</span><a name="line-1000"></a><span>    </span><a name="local-6989586621683241764"><a href="#local-6989586621683241764"><span class="hs-identifier">read_non_nullary_con</span></a></a><span> </span><a name="local-6989586621683241782"><a href="#local-6989586621683241782"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-1001"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241795"><span class="hs-identifier hs-var">is_infix</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241766"><span class="hs-identifier hs-var">mk_parser</span></a><span> </span><a href="#local-6989586621683241802"><span class="hs-identifier hs-var">infix_prec</span></a><span>  </span><a href="#local-6989586621683241789"><span class="hs-identifier hs-var">infix_stmts</span></a><span>  </span><a href="#local-6989586621683241783"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1002"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241796"><span class="hs-identifier hs-var">is_record</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241766"><span class="hs-identifier hs-var">mk_parser</span></a><span> </span><a href="#local-6989586621683241803"><span class="hs-identifier hs-var">record_prec</span></a><span> </span><a href="#local-6989586621683241790"><span class="hs-identifier hs-var">record_stmts</span></a><span> </span><a href="#local-6989586621683241783"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1003"></a><span class="hs-comment">--              Using these two lines instead allows the derived</span><span>
</span><a name="line-1004"></a><span class="hs-comment">--              read for infix and record bindings to read the prefix form</span><span>
</span><a name="line-1005"></a><span class="hs-comment">--      | is_infix  = mk_alt prefix_parser (mk_parser infix_prec  infix_stmts  body)</span><span>
</span><a name="line-1006"></a><span class="hs-comment">--      | is_record = mk_alt prefix_parser (mk_parser record_prec record_stmts body)</span><span>
</span><a name="line-1007"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241785"><span class="hs-identifier hs-var">prefix_parser</span></a><span>
</span><a name="line-1008"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1009"></a><span>        </span><a name="local-6989586621683241783"><a href="#local-6989586621683241783"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241768"><span class="hs-identifier hs-var">result_expr</span></a><span> </span><a href="#local-6989586621683241782"><span class="hs-identifier hs-var">data_con</span></a><span> </span><a href="#local-6989586621683241797"><span class="hs-identifier hs-var">as_needed</span></a><span>
</span><a name="line-1010"></a><span>        </span><a name="local-6989586621683241784"><a href="#local-6989586621683241784"><span class="hs-identifier">con_str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241774"><span class="hs-identifier hs-var">data_con_str</span></a><span> </span><a href="#local-6989586621683241782"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1011"></a><span>
</span><a name="line-1012"></a><span>        </span><a name="local-6989586621683241785"><a href="#local-6989586621683241785"><span class="hs-identifier">prefix_parser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241766"><span class="hs-identifier hs-var">mk_parser</span></a><span> </span><a href="#local-6989586621683241801"><span class="hs-identifier hs-var">prefix_prec</span></a><span> </span><a href="#local-6989586621683241788"><span class="hs-identifier hs-var">prefix_stmts</span></a><span> </span><a href="#local-6989586621683241783"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span>        </span><a name="local-6989586621683241786"><a href="#local-6989586621683241786"><span class="hs-identifier">read_prefix_con</span></a></a><span>
</span><a name="line-1015"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="TcGenDeriv.html#isSym"><span class="hs-identifier hs-var">isSym</span></a><span> </span><a href="#local-6989586621683241784"><span class="hs-identifier hs-var">con_str</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241773"><span class="hs-identifier hs-var">read_punc</span></a><span> </span><span class="hs-string">&quot;(&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241772"><span class="hs-identifier hs-var">symbol_pat</span></a><span> </span><a href="#local-6989586621683241784"><span class="hs-identifier hs-var">con_str</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241773"><span class="hs-identifier hs-var">read_punc</span></a><span> </span><span class="hs-string">&quot;)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1016"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241769"><span class="hs-identifier hs-var">ident_h_pat</span></a><span> </span><a href="#local-6989586621683241784"><span class="hs-identifier hs-var">con_str</span></a><span>
</span><a name="line-1017"></a><span>
</span><a name="line-1018"></a><span>        </span><a name="local-6989586621683241787"><a href="#local-6989586621683241787"><span class="hs-identifier">read_infix_con</span></a></a><span>
</span><a name="line-1019"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="TcGenDeriv.html#isSym"><span class="hs-identifier hs-var">isSym</span></a><span> </span><a href="#local-6989586621683241784"><span class="hs-identifier hs-var">con_str</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241772"><span class="hs-identifier hs-var">symbol_pat</span></a><span> </span><a href="#local-6989586621683241784"><span class="hs-identifier hs-var">con_str</span></a><span class="hs-special">]</span><span>
</span><a name="line-1020"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241773"><span class="hs-identifier hs-var">read_punc</span></a><span> </span><span class="hs-string">&quot;`&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683241769"><span class="hs-identifier hs-var">ident_h_pat</span></a><span> </span><a href="#local-6989586621683241784"><span class="hs-identifier hs-var">con_str</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241773"><span class="hs-identifier hs-var">read_punc</span></a><span> </span><span class="hs-string">&quot;`&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1021"></a><span>
</span><a name="line-1022"></a><span>        </span><a name="local-6989586621683241788"><a href="#local-6989586621683241788"><span class="hs-identifier">prefix_stmts</span></a></a><span>            </span><span class="hs-comment">-- T a b c</span><span>
</span><a name="line-1023"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241786"><span class="hs-identifier hs-var">read_prefix_con</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683241798"><span class="hs-identifier hs-var">read_args</span></a><span>
</span><a name="line-1024"></a><span>
</span><a name="line-1025"></a><span>        </span><a name="local-6989586621683241789"><a href="#local-6989586621683241789"><span class="hs-identifier">infix_stmts</span></a></a><span>             </span><span class="hs-comment">-- a %% b, or  a `T` b</span><span>
</span><a name="line-1026"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241799"><span class="hs-identifier hs-var">read_a1</span></a><span class="hs-special">]</span><span>
</span><a name="line-1027"></a><span>            </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683241787"><span class="hs-identifier hs-var">read_infix_con</span></a><span>
</span><a name="line-1028"></a><span>            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241800"><span class="hs-identifier hs-var">read_a2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1029"></a><span>
</span><a name="line-1030"></a><span>        </span><a name="local-6989586621683241790"><a href="#local-6989586621683241790"><span class="hs-identifier">record_stmts</span></a></a><span>            </span><span class="hs-comment">-- T { f1 = a, f2 = b }</span><span>
</span><a name="line-1031"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241786"><span class="hs-identifier hs-var">read_prefix_con</span></a><span>
</span><a name="line-1032"></a><span>            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241773"><span class="hs-identifier hs-var">read_punc</span></a><span> </span><span class="hs-string">&quot;{&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1033"></a><span>            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">intersperse</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241773"><span class="hs-identifier hs-var">read_punc</span></a><span> </span><span class="hs-string">&quot;,&quot;</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621683241791"><span class="hs-identifier hs-var">field_stmts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1034"></a><span>            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241773"><span class="hs-identifier hs-var">read_punc</span></a><span> </span><span class="hs-string">&quot;}&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1035"></a><span>
</span><a name="line-1036"></a><span>        </span><a name="local-6989586621683241791"><a href="#local-6989586621683241791"><span class="hs-identifier">field_stmts</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWithEqual</span><span> </span><span class="hs-string">&quot;lbl_stmts&quot;</span><span> </span><a href="#local-6989586621683241776"><span class="hs-identifier hs-var">read_field</span></a><span> </span><a href="#local-6989586621683241793"><span class="hs-identifier hs-var">labels</span></a><span> </span><a href="#local-6989586621683241797"><span class="hs-identifier hs-var">as_needed</span></a><span>
</span><a name="line-1037"></a><span>
</span><a name="line-1038"></a><span>        </span><a name="local-6989586621683241792"><a href="#local-6989586621683241792"><span class="hs-identifier">con_arity</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241782"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1039"></a><span>        </span><a name="local-6989586621683241793"><a href="#local-6989586621683241793"><span class="hs-identifier">labels</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">flLabel</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">dataConFieldLabels</span><span> </span><a href="#local-6989586621683241782"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1040"></a><span>        </span><a name="local-6989586621683241794"><a href="#local-6989586621683241794"><span class="hs-identifier">dc_nm</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getName</span><span> </span><a href="#local-6989586621683241782"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1041"></a><span>        </span><a name="local-6989586621683241795"><a href="#local-6989586621683241795"><span class="hs-identifier">is_infix</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConIsInfix</span><span> </span><a href="#local-6989586621683241782"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1042"></a><span>        </span><a name="local-6989586621683241796"><a href="#local-6989586621683241796"><span class="hs-identifier">is_record</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241793"><span class="hs-identifier hs-var">labels</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthExceeds</span><span class="hs-special">`</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1043"></a><span>        </span><a name="local-6989586621683241797"><a href="#local-6989586621683241797"><span class="hs-identifier">as_needed</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683241792"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><a href="TcGenDeriv.html#as_RDRs"><span class="hs-identifier hs-var">as_RDRs</span></a><span>
</span><a name="line-1044"></a><span>        </span><a name="local-6989586621683241798"><a href="#local-6989586621683241798"><span class="hs-identifier">read_args</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWithEqual</span><span> </span><span class="hs-string">&quot;gen_Read_binds&quot;</span><span> </span><a href="#local-6989586621683241775"><span class="hs-identifier hs-var">read_arg</span></a><span> </span><a href="#local-6989586621683241797"><span class="hs-identifier hs-var">as_needed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConOrigArgTys</span><span> </span><a href="#local-6989586621683241782"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-1045"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621683241799"><a href="#local-6989586621683241799"><span class="hs-identifier">read_a1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683241800"><a href="#local-6989586621683241800"><span class="hs-identifier">read_a2</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241798"><span class="hs-identifier hs-var">read_args</span></a><span>
</span><a name="line-1046"></a><span>
</span><a name="line-1047"></a><span>        </span><a name="local-6989586621683241801"><a href="#local-6989586621683241801"><span class="hs-identifier">prefix_prec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#appPrecedence"><span class="hs-identifier hs-var">appPrecedence</span></a><span>
</span><a name="line-1048"></a><span>        </span><a name="local-6989586621683241802"><a href="#local-6989586621683241802"><span class="hs-identifier">infix_prec</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#getPrecedence"><span class="hs-identifier hs-var">getPrecedence</span></a><span> </span><a href="#local-6989586621683241751"><span class="hs-identifier hs-var">get_fixity</span></a><span> </span><a href="#local-6989586621683241794"><span class="hs-identifier hs-var">dc_nm</span></a><span>
</span><a name="line-1049"></a><span>        </span><a name="local-6989586621683241803"><a href="#local-6989586621683241803"><span class="hs-identifier">record_prec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#appPrecedence"><span class="hs-identifier hs-var">appPrecedence</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-comment">-- Record construction binds even more tightly</span><span>
</span><a name="line-1050"></a><span>                                        </span><span class="hs-comment">-- than application; e.g. T2 T1 {x=2} means T2 (T1 {x=2})</span><span>
</span><a name="line-1051"></a><span>
</span><a name="line-1052"></a><span>    </span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><a name="line-1053"></a><span>    </span><span class="hs-comment">--          Helpers</span><span>
</span><a name="line-1054"></a><span>    </span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><a name="line-1055"></a><span>    </span><a name="local-6989586621683241765"><a href="#local-6989586621683241765"><span class="hs-identifier">mk_alt</span></a></a><span> </span><a name="local-6989586621683241804"><a href="#local-6989586621683241804"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621683241805"><a href="#local-6989586621683241805"><span class="hs-identifier">e2</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier hs-var">genOpApp</span></a><span> </span><a href="#local-6989586621683241804"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-identifier hs-var">alt_RDR</span><span> </span><a href="#local-6989586621683241805"><span class="hs-identifier hs-var">e2</span></a><span>                         </span><span class="hs-comment">-- e1 +++ e2</span><span>
</span><a name="line-1056"></a><span>    </span><a name="local-6989586621683241766"><a href="#local-6989586621683241766"><span class="hs-identifier">mk_parser</span></a></a><span> </span><a name="local-6989586621683241806"><a href="#local-6989586621683241806"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621683241807"><a href="#local-6989586621683241807"><span class="hs-identifier">ss</span></a></a><span> </span><a name="local-6989586621683241808"><a href="#local-6989586621683241808"><span class="hs-identifier">b</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">prec_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsIntLit</span><span> </span><a href="#local-6989586621683241806"><span class="hs-identifier hs-var">p</span></a><span>                </span><span class="hs-comment">-- prec p (do { ss ; b })</span><span>
</span><a name="line-1057"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsDo</span><span> </span><span class="hs-identifier hs-var">DoExpr</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241807"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkLastStmt</span><span> </span><a href="#local-6989586621683241808"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1058"></a><span>    </span><a name="local-6989586621683241767"><a href="#local-6989586621683241767"><span class="hs-identifier">con_app</span></a></a><span> </span><a name="local-6989586621683241809"><a href="#local-6989586621683241809"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-keyword">as</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241809"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span>                </span><span class="hs-comment">-- con as</span><span>
</span><a name="line-1059"></a><span>    </span><a name="local-6989586621683241768"><a href="#local-6989586621683241768"><span class="hs-identifier">result_expr</span></a></a><span> </span><a name="local-6989586621683241811"><a href="#local-6989586621683241811"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">returnM_RDR</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241767"><span class="hs-identifier hs-var">con_app</span></a><span> </span><a href="#local-6989586621683241811"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- return (con as)</span><span>
</span><a name="line-1060"></a><span>
</span><a name="line-1061"></a><span>    </span><span class="hs-comment">-- For constructors and field labels ending in '#', we hackily</span><span>
</span><a name="line-1062"></a><span>    </span><span class="hs-comment">-- let the lexer generate two tokens, and look for both in sequence</span><span>
</span><a name="line-1063"></a><span>    </span><span class="hs-comment">-- Thus [Ident &quot;I&quot;; Symbol &quot;#&quot;].  See Trac #5041</span><span>
</span><a name="line-1064"></a><span>    </span><a name="local-6989586621683241769"><a href="#local-6989586621683241769"><span class="hs-identifier">ident_h_pat</span></a></a><span> </span><a name="local-6989586621683241813"><a href="#local-6989586621683241813"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241814"><a href="#local-6989586621683241814"><span class="hs-identifier">ss</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-char">'#'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">snocView</span><span> </span><a href="#local-6989586621683241813"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241771"><span class="hs-identifier hs-var">ident_pat</span></a><span> </span><a href="#local-6989586621683241814"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241772"><span class="hs-identifier hs-var">symbol_pat</span></a><span> </span><span class="hs-string">&quot;#&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1065"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683241771"><span class="hs-identifier hs-var">ident_pat</span></a><span> </span><a href="#local-6989586621683241813"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1066"></a><span>
</span><a name="line-1067"></a><span>    </span><a name="local-6989586621683241770"><a href="#local-6989586621683241770"><span class="hs-identifier">bindLex</span></a></a><span> </span><a name="local-6989586621683241815"><a href="#local-6989586621683241815"><span class="hs-identifier">pat</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkBodyStmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">expectP_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241815"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- expectP p</span><span>
</span><a name="line-1068"></a><span>                   </span><span class="hs-comment">-- See Note [Use expectP]</span><span>
</span><a name="line-1069"></a><span>    </span><a name="local-6989586621683241771"><a href="#local-6989586621683241771"><span class="hs-identifier">ident_pat</span></a></a><span>  </span><a name="local-6989586621683241816"><a href="#local-6989586621683241816"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241770"><span class="hs-identifier hs-var">bindLex</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">ident_RDR</span><span>  </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><a href="#local-6989586621683241816"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- expectP (Ident &quot;foo&quot;)</span><span>
</span><a name="line-1070"></a><span>    </span><a name="local-6989586621683241772"><a href="#local-6989586621683241772"><span class="hs-identifier">symbol_pat</span></a></a><span> </span><a name="local-6989586621683241817"><a href="#local-6989586621683241817"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241770"><span class="hs-identifier hs-var">bindLex</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">symbol_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><a href="#local-6989586621683241817"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- expectP (Symbol &quot;&gt;&gt;&quot;)</span><span>
</span><a name="line-1071"></a><span>    </span><a name="local-6989586621683241773"><a href="#local-6989586621683241773"><span class="hs-identifier">read_punc</span></a></a><span> </span><a name="local-6989586621683241818"><a href="#local-6989586621683241818"><span class="hs-identifier">c</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241770"><span class="hs-identifier hs-var">bindLex</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">punc_RDR</span><span>   </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><a href="#local-6989586621683241818"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- expectP (Punc &quot;&lt;&quot;)</span><span>
</span><a name="line-1072"></a><span>
</span><a name="line-1073"></a><span>    </span><a name="local-6989586621683241774"><a href="#local-6989586621683241774"><span class="hs-identifier">data_con_str</span></a></a><span> </span><a name="local-6989586621683241819"><a href="#local-6989586621683241819"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">occNameString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getOccName</span><span> </span><a href="#local-6989586621683241819"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-1074"></a><span>
</span><a name="line-1075"></a><span>    </span><a name="local-6989586621683241775"><a href="#local-6989586621683241775"><span class="hs-identifier">read_arg</span></a></a><span> </span><a name="local-6989586621683241820"><a href="#local-6989586621683241820"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683241821"><a href="#local-6989586621683241821"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isUnliftedType</span><span> </span><span class="hs-identifier hs-var">ty</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1076"></a><span>                    </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkBindStmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="#local-6989586621683241820"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">step_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">readPrec_RDR</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1077"></a><span>
</span><a name="line-1078"></a><span>    </span><span class="hs-comment">-- When reading field labels we might encounter</span><span>
</span><a name="line-1079"></a><span>    </span><span class="hs-comment">--      a  = 3</span><span>
</span><a name="line-1080"></a><span>    </span><span class="hs-comment">--      _a = 3</span><span>
</span><a name="line-1081"></a><span>    </span><span class="hs-comment">-- or   (#) = 4</span><span>
</span><a name="line-1082"></a><span>    </span><span class="hs-comment">-- Note the parens!</span><span>
</span><a name="line-1083"></a><span>    </span><a name="local-6989586621683241776"><a href="#local-6989586621683241776"><span class="hs-identifier">read_field</span></a></a><span> </span><a name="local-6989586621683241822"><a href="#local-6989586621683241822"><span class="hs-identifier">lbl</span></a></a><span> </span><a name="local-6989586621683241823"><a href="#local-6989586621683241823"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1084"></a><span>        </span><span class="hs-special">[</span><span class="hs-identifier hs-var">noLoc</span><span>
</span><a name="line-1085"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkBindStmt</span><span>
</span><a name="line-1086"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="#local-6989586621683241823"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1087"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span>
</span><a name="line-1088"></a><span>              </span><a href="#local-6989586621683241826"><span class="hs-identifier hs-var">read_field</span></a><span>
</span><a name="line-1089"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-identifier hs-var">reset_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">readPrec_RDR</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1090"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-1091"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-1092"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-1093"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-1094"></a><span>          </span><a name="local-6989586621683241824"><a href="#local-6989586621683241824"><span class="hs-identifier">lbl_str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unpackFS</span><span> </span><a href="#local-6989586621683241822"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-1095"></a><span>          </span><a name="local-6989586621683241825"><a href="#local-6989586621683241825"><span class="hs-identifier">mk_read_field</span></a></a><span> </span><a name="local-6989586621683241827"><a href="#local-6989586621683241827"><span class="hs-identifier">read_field_rdr</span></a></a><span> </span><a name="local-6989586621683241828"><a href="#local-6989586621683241828"><span class="hs-identifier">lbl</span></a></a><span>
</span><a name="line-1096"></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><a href="#local-6989586621683241827"><span class="hs-identifier hs-var">read_field_rdr</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><a href="#local-6989586621683241828"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1097"></a><span>          </span><a name="local-6989586621683241826"><a href="#local-6989586621683241826"><span class="hs-identifier">read_field</span></a></a><span>
</span><a name="line-1098"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="TcGenDeriv.html#isSym"><span class="hs-identifier hs-var">isSym</span></a><span> </span><a href="#local-6989586621683241824"><span class="hs-identifier hs-var">lbl_str</span></a><span>
</span><a name="line-1099"></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241825"><span class="hs-identifier hs-var">mk_read_field</span></a><span> </span><span class="hs-identifier hs-var">readSymField_RDR</span><span> </span><a href="#local-6989586621683241824"><span class="hs-identifier hs-var">lbl_str</span></a><span>
</span><a name="line-1100"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241829"><a href="#local-6989586621683241829"><span class="hs-identifier">ss</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-char">'#'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">snocView</span><span> </span><a href="#local-6989586621683241824"><span class="hs-identifier hs-var">lbl_str</span></a><span> </span><span class="hs-comment">-- #14918</span><span>
</span><a name="line-1101"></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241825"><span class="hs-identifier hs-var">mk_read_field</span></a><span> </span><span class="hs-identifier hs-var">readFieldHash_RDR</span><span> </span><a href="#local-6989586621683241829"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-1102"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1103"></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241825"><span class="hs-identifier hs-var">mk_read_field</span></a><span> </span><span class="hs-identifier hs-var">readField_RDR</span><span> </span><a href="#local-6989586621683241824"><span class="hs-identifier hs-var">lbl_str</span></a><span>
</span><a name="line-1104"></a><span>
</span><a name="line-1105"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Show instances
*                                                                      *
************************************************************************

Example

    infixr 5 :^:

    data Tree a =  Leaf a  |  Tree a :^: Tree a

    instance (Show a) =&gt; Show (Tree a) where

        showsPrec d (Leaf m) = showParen (d &gt; app_prec) showStr
          where
             showStr = showString &quot;Leaf &quot; . showsPrec (app_prec+1) m

        showsPrec d (u :^: v) = showParen (d &gt; up_prec) showStr
          where
             showStr = showsPrec (up_prec+1) u .
                       showString &quot; :^: &quot;      .
                       showsPrec (up_prec+1) v
                -- Note: right-associativity of :^: ignored

    up_prec  = 5    -- Precedence of :^:
    app_prec = 10   -- Application has precedence one more than
                    -- the most tightly-binding operator
-}</span><span>
</span><a name="line-1135"></a><span>
</span><a name="line-1136"></a><span class="hs-identifier">gen_Show_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span>
</span><a name="line-1137"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-1138"></a><span>
</span><a name="line-1139"></a><a name="gen_Show_binds"><a href="TcGenDeriv.html#gen_Show_binds"><span class="hs-identifier">gen_Show_binds</span></a></a><span> </span><a name="local-6989586621683241830"><a href="#local-6989586621683241830"><span class="hs-identifier">get_fixity</span></a></a><span> </span><a name="local-6989586621683241831"><a href="#local-6989586621683241831"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241832"><a href="#local-6989586621683241832"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-1140"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitBag</span><span> </span><a href="#local-6989586621683241834"><span class="hs-identifier hs-var">shows_prec</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">)</span><span>
</span><a name="line-1141"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1142"></a><span>    </span><a name="local-6989586621683241833"><a href="#local-6989586621683241833"><span class="hs-identifier">data_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683241832"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1143"></a><span>    </span><a name="local-6989586621683241834"><a href="#local-6989586621683241834"><span class="hs-identifier">shows_prec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkFunBindEC"><span class="hs-identifier hs-var">mkFunBindEC</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621683241831"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-identifier hs-var">showsPrec_RDR</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683241836"><span class="hs-identifier hs-var">pats_etc</span></a><span> </span><a href="#local-6989586621683241833"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-1144"></a><span>    </span><a name="local-6989586621683241835"><a href="#local-6989586621683241835"><span class="hs-identifier">comma_space</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">showCommaSpace_RDR</span><span>
</span><a name="line-1145"></a><span>
</span><a name="line-1146"></a><span>    </span><a name="local-6989586621683241836"><a href="#local-6989586621683241836"><span class="hs-identifier">pats_etc</span></a></a><span> </span><a name="local-6989586621683241837"><a href="#local-6989586621683241837"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-1147"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241843"><span class="hs-identifier hs-var">nullary_con</span></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">-- skip the showParen junk...</span><span>
</span><a name="line-1148"></a><span>         </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-identifier">bs_needed</span><span class="hs-special">)</span><span>
</span><a name="line-1149"></a><span>         </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlWildPat</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241842"><span class="hs-identifier hs-var">con_pat</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><a href="#local-6989586621683241850"><span class="hs-identifier hs-var">op_con_str</span></a><span class="hs-special">)</span><span>
</span><a name="line-1150"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span>
</span><a name="line-1151"></a><span>         </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier hs-var">a_Pat</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241842"><span class="hs-identifier hs-var">con_pat</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1152"></a><span>          </span><a href="TcGenDeriv.html#showParen_Expr"><span class="hs-identifier hs-var">showParen_Expr</span></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier hs-var">genOpApp</span></a><span> </span><a href="TcGenDeriv.html#a_Expr"><span class="hs-identifier hs-var">a_Expr</span></a><span> </span><span class="hs-identifier hs-var">ge_RDR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span>
</span><a name="line-1153"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkIntegralLit</span><span> </span><a href="#local-6989586621683241861"><span class="hs-identifier hs-var">con_prec_plus_one</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1154"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#nested_compose_Expr"><span class="hs-identifier hs-var">nested_compose_Expr</span></a><span> </span><a href="#local-6989586621683241852"><span class="hs-identifier hs-var">show_thingies</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1155"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-1156"></a><span>             </span><a name="local-6989586621683241838"><a href="#local-6989586621683241838"><span class="hs-identifier">data_con_RDR</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241837"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1157"></a><span>             </span><a name="local-6989586621683241839"><a href="#local-6989586621683241839"><span class="hs-identifier">con_arity</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241837"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1158"></a><span>             </span><a name="local-6989586621683241840"><a href="#local-6989586621683241840"><span class="hs-identifier">bs_needed</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683241839"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><a href="TcGenDeriv.html#bs_RDRs"><span class="hs-identifier hs-var">bs_RDRs</span></a><span>
</span><a name="line-1159"></a><span>             </span><a name="local-6989586621683241841"><a href="#local-6989586621683241841"><span class="hs-identifier">arg_tys</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConOrigArgTys</span><span> </span><a href="#local-6989586621683241837"><span class="hs-identifier hs-var">data_con</span></a><span>         </span><span class="hs-comment">-- Correspond 1-1 with bs_needed</span><span>
</span><a name="line-1160"></a><span>             </span><a name="local-6989586621683241842"><a href="#local-6989586621683241842"><span class="hs-identifier">con_pat</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><a href="#local-6989586621683241838"><span class="hs-identifier hs-var">data_con_RDR</span></a><span> </span><a href="#local-6989586621683241840"><span class="hs-identifier hs-var">bs_needed</span></a><span>
</span><a name="line-1161"></a><span>             </span><a name="local-6989586621683241843"><a href="#local-6989586621683241843"><span class="hs-identifier">nullary_con</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241839"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1162"></a><span>             </span><a name="local-6989586621683241844"><a href="#local-6989586621683241844"><span class="hs-identifier">labels</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">flLabel</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">dataConFieldLabels</span><span> </span><a href="#local-6989586621683241837"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1163"></a><span>             </span><a name="local-6989586621683241845"><a href="#local-6989586621683241845"><span class="hs-identifier">lab_fields</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621683241844"><span class="hs-identifier hs-var">labels</span></a><span>
</span><a name="line-1164"></a><span>             </span><a name="local-6989586621683241846"><a href="#local-6989586621683241846"><span class="hs-identifier">record_syntax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241845"><span class="hs-identifier hs-var">lab_fields</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1165"></a><span>
</span><a name="line-1166"></a><span>             </span><a name="local-6989586621683241847"><a href="#local-6989586621683241847"><span class="hs-identifier">dc_nm</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getName</span><span> </span><a href="#local-6989586621683241837"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1167"></a><span>             </span><a name="local-6989586621683241848"><a href="#local-6989586621683241848"><span class="hs-identifier">dc_occ_nm</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getOccName</span><span> </span><a href="#local-6989586621683241837"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1168"></a><span>             </span><a name="local-6989586621683241849"><a href="#local-6989586621683241849"><span class="hs-identifier">con_str</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">occNameString</span><span> </span><a href="#local-6989586621683241848"><span class="hs-identifier hs-var">dc_occ_nm</span></a><span>
</span><a name="line-1169"></a><span>             </span><a name="local-6989586621683241850"><a href="#local-6989586621683241850"><span class="hs-identifier">op_con_str</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#wrapOpParens"><span class="hs-identifier hs-var">wrapOpParens</span></a><span> </span><a href="#local-6989586621683241849"><span class="hs-identifier hs-var">con_str</span></a><span>
</span><a name="line-1170"></a><span>             </span><a name="local-6989586621683241851"><a href="#local-6989586621683241851"><span class="hs-identifier">backquote_str</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#wrapOpBackquotes"><span class="hs-identifier hs-var">wrapOpBackquotes</span></a><span> </span><a href="#local-6989586621683241849"><span class="hs-identifier hs-var">con_str</span></a><span>
</span><a name="line-1171"></a><span>
</span><a name="line-1172"></a><span>             </span><a name="local-6989586621683241852"><a href="#local-6989586621683241852"><span class="hs-identifier">show_thingies</span></a></a><span>
</span><a name="line-1173"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241860"><span class="hs-identifier hs-var">is_infix</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241855"><span class="hs-identifier hs-var">show_arg1</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683241851"><span class="hs-identifier hs-var">backquote_str</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241856"><span class="hs-identifier hs-var">show_arg2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1174"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241846"><span class="hs-identifier hs-var">record_syntax</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241850"><span class="hs-identifier hs-var">op_con_str</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; {&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-1175"></a><span>                                  </span><a href="#local-6989586621683241858"><span class="hs-identifier hs-var">show_record_args</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><span class="hs-string">&quot;}&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-1176"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241850"><span class="hs-identifier hs-var">op_con_str</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621683241857"><span class="hs-identifier hs-var">show_prefix_args</span></a><span>
</span><a name="line-1177"></a><span>
</span><a name="line-1178"></a><span>             </span><a name="local-6989586621683241853"><a href="#local-6989586621683241853"><span class="hs-identifier">show_label</span></a></a><span> </span><a name="local-6989586621683241863"><a href="#local-6989586621683241863"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241864"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; = &quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1179"></a><span>                        </span><span class="hs-comment">-- Note the spaces around the &quot;=&quot; sign.  If we</span><span>
</span><a name="line-1180"></a><span>                        </span><span class="hs-comment">-- don't have them then we get Foo { x=-1 } and</span><span>
</span><a name="line-1181"></a><span>                        </span><span class="hs-comment">-- the &quot;=-&quot; parses as a single lexeme.  Only the</span><span>
</span><a name="line-1182"></a><span>                        </span><span class="hs-comment">-- space after the '=' is necessary, but it</span><span>
</span><a name="line-1183"></a><span>                        </span><span class="hs-comment">-- seems tidier to have them both sides.</span><span>
</span><a name="line-1184"></a><span>                 </span><span class="hs-keyword">where</span><span>
</span><a name="line-1185"></a><span>                   </span><a name="local-6989586621683241864"><a href="#local-6989586621683241864"><span class="hs-identifier">nm</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#wrapOpParens"><span class="hs-identifier hs-var">wrapOpParens</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unpackFS</span><span> </span><a href="#local-6989586621683241863"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1186"></a><span>
</span><a name="line-1187"></a><span>             </span><a name="local-6989586621683241854"><a href="#local-6989586621683241854"><span class="hs-identifier">show_args</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621683241859"><span class="hs-identifier hs-var">show_arg</span></a><span> </span><a href="#local-6989586621683241840"><span class="hs-identifier hs-var">bs_needed</span></a><span> </span><a href="#local-6989586621683241841"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1188"></a><span>             </span><span class="hs-special">(</span><a name="local-6989586621683241855"><a href="#local-6989586621683241855"><span class="hs-identifier">show_arg1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683241856"><a href="#local-6989586621683241856"><span class="hs-identifier">show_arg2</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241854"><span class="hs-identifier hs-var">show_args</span></a><span>
</span><a name="line-1189"></a><span>             </span><a name="local-6989586621683241857"><a href="#local-6989586621683241857"><span class="hs-identifier">show_prefix_args</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">intersperse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">showSpace_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241854"><span class="hs-identifier hs-var">show_args</span></a><span>
</span><a name="line-1190"></a><span>
</span><a name="line-1191"></a><span>                </span><span class="hs-comment">-- Assumption for record syntax: no of fields == no of</span><span>
</span><a name="line-1192"></a><span>                </span><span class="hs-comment">-- labelled fields (and in same order)</span><span>
</span><a name="line-1193"></a><span>             </span><a name="local-6989586621683241858"><a href="#local-6989586621683241858"><span class="hs-identifier">show_record_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1194"></a><span>                                </span><span class="hs-identifier hs-var">intersperse</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241835"><span class="hs-identifier hs-var">comma_space</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1195"></a><span>                                </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241853"><span class="hs-identifier hs-var">show_label</span></a><span> </span><a href="#local-6989586621683241865"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241866"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1196"></a><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241865"><a href="#local-6989586621683241865"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">,</span><a name="local-6989586621683241866"><a href="#local-6989586621683241866"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zipEqual</span><span> </span><span class="hs-string">&quot;gen_Show_binds&quot;</span><span>
</span><a name="line-1197"></a><span>                                                        </span><a href="#local-6989586621683241844"><span class="hs-identifier hs-var">labels</span></a><span> </span><a href="#local-6989586621683241854"><span class="hs-identifier hs-var">show_args</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1198"></a><span>
</span><a name="line-1199"></a><span>             </span><span class="hs-identifier">show_arg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1200"></a><span>             </span><a name="local-6989586621683241859"><a href="#local-6989586621683241859"><span class="hs-identifier">show_arg</span></a></a><span> </span><a name="local-6989586621683241867"><a href="#local-6989586621683241867"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621683241868"><a href="#local-6989586621683241868"><span class="hs-identifier">arg_ty</span></a></a><span>
</span><a name="line-1201"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isUnliftedType</span><span> </span><a href="#local-6989586621683241868"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1202"></a><span>                 </span><span class="hs-comment">-- See Note [Deriving and unboxed types] in TcDerivInfer</span><span>
</span><a name="line-1203"></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241872"><span class="hs-identifier hs-var">with_conv</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1204"></a><span>                    </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">compose_RDR</span><span>
</span><a name="line-1205"></a><span>                        </span><span class="hs-special">[</span><a href="TcGenDeriv.html#mk_shows_app"><span class="hs-identifier hs-var">mk_shows_app</span></a><span> </span><a href="#local-6989586621683241870"><span class="hs-identifier hs-var">boxed_arg</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><a href="#local-6989586621683241871"><span class="hs-identifier hs-var">postfixMod</span></a><span class="hs-special">]</span><span>
</span><a name="line-1206"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1207"></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mk_showsPrec_app"><span class="hs-identifier hs-var">mk_showsPrec_app</span></a><span> </span><a href="#local-6989586621683241862"><span class="hs-identifier hs-var">arg_prec</span></a><span> </span><a href="#local-6989586621683241869"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1208"></a><span>               </span><span class="hs-keyword">where</span><span>
</span><a name="line-1209"></a><span>                 </span><a name="local-6989586621683241869"><a href="#local-6989586621683241869"><span class="hs-identifier">arg</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241867"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1210"></a><span>                 </span><a name="local-6989586621683241870"><a href="#local-6989586621683241870"><span class="hs-identifier">boxed_arg</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#box"><span class="hs-identifier hs-var">box</span></a><span> </span><span class="hs-string">&quot;Show&quot;</span><span> </span><a href="#local-6989586621683241869"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621683241868"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1211"></a><span>                 </span><a name="local-6989586621683241871"><a href="#local-6989586621683241871"><span class="hs-identifier">postfixMod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#assoc_ty_id"><span class="hs-identifier hs-var">assoc_ty_id</span></a><span> </span><span class="hs-string">&quot;Show&quot;</span><span> </span><a href="TcGenDeriv.html#postfixModTbl"><span class="hs-identifier hs-var">postfixModTbl</span></a><span> </span><a href="#local-6989586621683241868"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1212"></a><span>                 </span><a name="local-6989586621683241872"><a href="#local-6989586621683241872"><span class="hs-identifier">with_conv</span></a></a><span> </span><a name="local-6989586621683241873"><a href="#local-6989586621683241873"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-1213"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683241874"><a href="#local-6989586621683241874"><span class="hs-identifier">conv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcGenDeriv.html#assoc_ty_id_maybe"><span class="hs-identifier hs-var">assoc_ty_id_maybe</span></a><span> </span><a href="TcGenDeriv.html#primConvTbl"><span class="hs-identifier hs-var">primConvTbl</span></a><span> </span><a href="#local-6989586621683241868"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1214"></a><span>                        </span><a href="TcGenDeriv.html#nested_compose_Expr"><span class="hs-identifier hs-var">nested_compose_Expr</span></a><span>
</span><a name="line-1215"></a><span>                            </span><span class="hs-special">[</span><span> </span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;(&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683241874"><span class="hs-identifier hs-var">conv</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1216"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241873"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1217"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier hs-var">mk_showString_app</span></a><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-1218"></a><span>                            </span><span class="hs-special">]</span><span>
</span><a name="line-1219"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241873"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1220"></a><span>
</span><a name="line-1221"></a><span>                </span><span class="hs-comment">-- Fixity stuff</span><span>
</span><a name="line-1222"></a><span>             </span><a name="local-6989586621683241860"><a href="#local-6989586621683241860"><span class="hs-identifier">is_infix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConIsInfix</span><span> </span><a href="#local-6989586621683241837"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1223"></a><span>             </span><a name="local-6989586621683241861"><a href="#local-6989586621683241861"><span class="hs-identifier">con_prec_plus_one</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="TcGenDeriv.html#getPrec"><span class="hs-identifier hs-var">getPrec</span></a><span> </span><a href="#local-6989586621683241860"><span class="hs-identifier hs-var">is_infix</span></a><span> </span><a href="#local-6989586621683241830"><span class="hs-identifier hs-var">get_fixity</span></a><span> </span><a href="#local-6989586621683241847"><span class="hs-identifier hs-var">dc_nm</span></a><span>
</span><a name="line-1224"></a><span>             </span><a name="local-6989586621683241862"><a href="#local-6989586621683241862"><span class="hs-identifier">arg_prec</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241846"><span class="hs-identifier hs-var">record_syntax</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>  </span><span class="hs-comment">-- Record fields don't need parens</span><span>
</span><a name="line-1225"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241861"><span class="hs-identifier hs-var">con_prec_plus_one</span></a><span>
</span><a name="line-1226"></a><span>
</span><a name="line-1227"></a><span class="hs-identifier">wrapOpParens</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-1228"></a><a name="wrapOpParens"><a href="TcGenDeriv.html#wrapOpParens"><span class="hs-identifier">wrapOpParens</span></a></a><span> </span><a name="local-6989586621683241875"><a href="#local-6989586621683241875"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcGenDeriv.html#isSym"><span class="hs-identifier hs-var">isSym</span></a><span> </span><a href="#local-6989586621683241875"><span class="hs-identifier hs-var">s</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'('</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621683241875"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-1229"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241875"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1230"></a><span>
</span><a name="line-1231"></a><span class="hs-identifier">wrapOpBackquotes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-1232"></a><a name="wrapOpBackquotes"><a href="TcGenDeriv.html#wrapOpBackquotes"><span class="hs-identifier">wrapOpBackquotes</span></a></a><span> </span><a name="local-6989586621683241876"><a href="#local-6989586621683241876"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcGenDeriv.html#isSym"><span class="hs-identifier hs-var">isSym</span></a><span> </span><a href="#local-6989586621683241876"><span class="hs-identifier hs-var">s</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241876"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1233"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'`'</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621683241876"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;`&quot;</span><span>
</span><a name="line-1234"></a><span>
</span><a name="line-1235"></a><span class="hs-identifier">isSym</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1236"></a><a name="isSym"><a href="TcGenDeriv.html#isSym"><span class="hs-identifier">isSym</span></a></a><span> </span><span class="hs-string">&quot;&quot;</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1237"></a><span class="hs-identifier">isSym</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241877"><a href="#local-6989586621683241877"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">startsVarSym</span><span> </span><a href="#local-6989586621683241877"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">startsConSym</span><span> </span><a href="#local-6989586621683241877"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1238"></a><span>
</span><a name="line-1239"></a><span class="hs-comment">-- | showString :: String -&gt; ShowS</span><span>
</span><a name="line-1240"></a><span class="hs-identifier">mk_showString_app</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1241"></a><a name="mk_showString_app"><a href="TcGenDeriv.html#mk_showString_app"><span class="hs-identifier">mk_showString_app</span></a></a><span> </span><a name="local-6989586621683241878"><a href="#local-6989586621683241878"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">showString_RDR</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><a href="#local-6989586621683241878"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1242"></a><span>
</span><a name="line-1243"></a><span class="hs-comment">-- | showsPrec :: Show a =&gt; Int -&gt; a -&gt; ShowS</span><span>
</span><a name="line-1244"></a><span class="hs-identifier">mk_showsPrec_app</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1245"></a><a name="mk_showsPrec_app"><a href="TcGenDeriv.html#mk_showsPrec_app"><span class="hs-identifier">mk_showsPrec_app</span></a></a><span> </span><a name="local-6989586621683241879"><a href="#local-6989586621683241879"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621683241880"><a href="#local-6989586621683241880"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-1246"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><span class="hs-identifier hs-var">showsPrec_RDR</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkIntegralLit</span><span> </span><a href="#local-6989586621683241879"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241880"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-1247"></a><span>
</span><a name="line-1248"></a><span class="hs-comment">-- | shows :: Show a =&gt; a -&gt; ShowS</span><span>
</span><a name="line-1249"></a><span class="hs-identifier">mk_shows_app</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1250"></a><a name="mk_shows_app"><a href="TcGenDeriv.html#mk_shows_app"><span class="hs-identifier">mk_shows_app</span></a></a><span> </span><a name="local-6989586621683241881"><a href="#local-6989586621683241881"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">shows_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241881"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1251"></a><span>
</span><a name="line-1252"></a><span class="hs-identifier">getPrec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-1253"></a><a name="getPrec"><a href="TcGenDeriv.html#getPrec"><span class="hs-identifier">getPrec</span></a></a><span> </span><a name="local-6989586621683241882"><a href="#local-6989586621683241882"><span class="hs-identifier">is_infix</span></a></a><span> </span><a name="local-6989586621683241883"><a href="#local-6989586621683241883"><span class="hs-identifier">get_fixity</span></a></a><span> </span><a name="local-6989586621683241884"><a href="#local-6989586621683241884"><span class="hs-identifier">nm</span></a></a><span>
</span><a name="line-1254"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621683241882"><span class="hs-identifier hs-var">is_infix</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#appPrecedence"><span class="hs-identifier hs-var">appPrecedence</span></a><span>
</span><a name="line-1255"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#getPrecedence"><span class="hs-identifier hs-var">getPrecedence</span></a><span> </span><a href="#local-6989586621683241883"><span class="hs-identifier hs-var">get_fixity</span></a><span> </span><a href="#local-6989586621683241884"><span class="hs-identifier hs-var">nm</span></a><span>
</span><a name="line-1256"></a><span>
</span><a name="line-1257"></a><span class="hs-identifier">appPrecedence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-1258"></a><a name="appPrecedence"><a href="TcGenDeriv.html#appPrecedence"><span class="hs-identifier">appPrecedence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-identifier hs-var">maxPrecedence</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1259"></a><span>  </span><span class="hs-comment">-- One more than the precedence of the most</span><span>
</span><a name="line-1260"></a><span>  </span><span class="hs-comment">-- tightly-binding operator</span><span>
</span><a name="line-1261"></a><span>
</span><a name="line-1262"></a><span class="hs-identifier">getPrecedence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fixity</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-1263"></a><a name="getPrecedence"><a href="TcGenDeriv.html#getPrecedence"><span class="hs-identifier">getPrecedence</span></a></a><span> </span><a name="local-6989586621683241885"><a href="#local-6989586621683241885"><span class="hs-identifier">get_fixity</span></a></a><span> </span><a name="local-6989586621683241886"><a href="#local-6989586621683241886"><span class="hs-identifier">nm</span></a></a><span>
</span><a name="line-1264"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683241885"><span class="hs-identifier hs-var">get_fixity</span></a><span> </span><a href="#local-6989586621683241886"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1265"></a><span>        </span><span class="hs-identifier hs-var">Fixity</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683241887"><a href="#local-6989586621683241887"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621683241888"><a href="#local-6989586621683241888"><span class="hs-identifier">_assoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621683241887"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1266"></a><span>          </span><span class="hs-comment">-- NB: the Report says that associativity is not taken</span><span>
</span><a name="line-1267"></a><span>          </span><span class="hs-comment">--     into account for either Read or Show; hence we</span><span>
</span><a name="line-1268"></a><span>          </span><span class="hs-comment">--     ignore associativity here</span><span>
</span><a name="line-1269"></a><span>
</span><a name="line-1270"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Data instances
*                                                                      *
************************************************************************

From the data type

  data T a b = T1 a b | T2

we generate

  $cT1 = mkDataCon $dT &quot;T1&quot; Prefix
  $cT2 = mkDataCon $dT &quot;T2&quot; Prefix
  $dT  = mkDataType &quot;Module.T&quot; [] [$con_T1, $con_T2]
  -- the [] is for field labels.

  instance (Data a, Data b) =&gt; Data (T a b) where
    gfoldl k z (T1 a b) = z T `k` a `k` b
    gfoldl k z T2           = z T2
    -- ToDo: add gmapT,Q,M, gfoldr

    gunfold k z c = case conIndex c of
                        I# 1# -&gt; k (k (z T1))
                        I# 2# -&gt; z T2

    toConstr (T1 _ _) = $cT1
    toConstr T2       = $cT2

    dataTypeOf _ = $dT

    dataCast1 = gcast1   -- If T :: * -&gt; *
    dataCast2 = gcast2   -- if T :: * -&gt; * -&gt; *
-}</span><span>
</span><a name="line-1305"></a><span>
</span><a name="line-1306"></a><span class="hs-identifier">gen_Data_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span>
</span><a name="line-1307"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span>                 </span><span class="hs-comment">-- For data families, this is the</span><span>
</span><a name="line-1308"></a><span>                                        </span><span class="hs-comment">--  *representation* TyCon</span><span>
</span><a name="line-1309"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The method bindings</span><span>
</span><a name="line-1310"></a><span>                       </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Auxiliary bindings</span><span>
</span><a name="line-1311"></a><a name="gen_Data_binds"><a href="TcGenDeriv.html#gen_Data_binds"><span class="hs-identifier">gen_Data_binds</span></a></a><span> </span><a name="local-6989586621683241889"><a href="#local-6989586621683241889"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241890"><a href="#local-6989586621683241890"><span class="hs-identifier">rep_tc</span></a></a><span>
</span><a name="line-1312"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621683241891"><a href="#local-6989586621683241891"><span class="hs-identifier">dflags</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1313"></a><span>
</span><a name="line-1314"></a><span>       </span><span class="hs-comment">-- Make unique names for the data type and constructor</span><span>
</span><a name="line-1315"></a><span>       </span><span class="hs-comment">-- auxiliary bindings.  Start with the name of the TyCon/DataCon</span><span>
</span><a name="line-1316"></a><span>       </span><span class="hs-comment">-- but that might not be unique: see Trac #12245.</span><span>
</span><a name="line-1317"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621683241892"><a href="#local-6989586621683241892"><span class="hs-identifier">dt_occ</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#chooseUniqueOccTc"><span class="hs-identifier hs-var">chooseUniqueOccTc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkDataTOcc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getOccName</span><span> </span><a href="#local-6989586621683241890"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1318"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621683241893"><a href="#local-6989586621683241893"><span class="hs-identifier">dc_occs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#chooseUniqueOccTc"><span class="hs-identifier hs-var">chooseUniqueOccTc</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mkDataCOcc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">getOccName</span><span class="hs-special">)</span><span>
</span><a name="line-1319"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683241890"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1320"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683241894"><a href="#local-6989586621683241894"><span class="hs-identifier">dt_rdr</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkRdrUnqual</span><span> </span><a href="#local-6989586621683241892"><span class="hs-identifier hs-var">dt_occ</span></a><span>
</span><a name="line-1321"></a><span>             </span><a name="local-6989586621683241895"><a href="#local-6989586621683241895"><span class="hs-identifier">dc_rdrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">mkRdrUnqual</span><span> </span><a href="#local-6989586621683241893"><span class="hs-identifier hs-var">dc_occs</span></a><span>
</span><a name="line-1322"></a><span>
</span><a name="line-1323"></a><span>       </span><span class="hs-comment">-- OK, now do the work</span><span>
</span><a name="line-1324"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#gen_data"><span class="hs-identifier hs-var">gen_data</span></a><span> </span><a href="#local-6989586621683241891"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683241894"><span class="hs-identifier hs-var">dt_rdr</span></a><span> </span><a href="#local-6989586621683241895"><span class="hs-identifier hs-var">dc_rdrs</span></a><span> </span><a href="#local-6989586621683241889"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683241890"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1325"></a><span>
</span><a name="line-1326"></a><span class="hs-identifier">gen_data</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-1327"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span>
</span><a name="line-1328"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- The method bindings</span><span>
</span><a name="line-1329"></a><span>             </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Auxiliary bindings</span><span>
</span><a name="line-1330"></a><a name="gen_data"><a href="TcGenDeriv.html#gen_data"><span class="hs-identifier">gen_data</span></a></a><span> </span><a name="local-6989586621683241896"><a href="#local-6989586621683241896"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683241897"><a href="#local-6989586621683241897"><span class="hs-identifier">data_type_name</span></a></a><span> </span><a name="local-6989586621683241898"><a href="#local-6989586621683241898"><span class="hs-identifier">constr_names</span></a></a><span> </span><a name="local-6989586621683241899"><a href="#local-6989586621683241899"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241900"><a href="#local-6989586621683241900"><span class="hs-identifier">rep_tc</span></a></a><span>
</span><a name="line-1331"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241908"><span class="hs-identifier hs-var">gfoldl_bind</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241910"><span class="hs-identifier hs-var">gunfold_bind</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241915"><span class="hs-identifier hs-var">toCon_bind</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241917"><span class="hs-identifier hs-var">dataTypeOf_bind</span></a><span class="hs-special">]</span><span>
</span><a name="line-1332"></a><span>     </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unionBags</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683241919"><span class="hs-identifier hs-var">gcast_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-1333"></a><span>                </span><span class="hs-comment">-- Auxiliary definitions: the data type and constructors</span><span>
</span><a name="line-1334"></a><span>     </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621683241904"><span class="hs-identifier hs-var">genDataTyCon</span></a><span>
</span><a name="line-1335"></a><span>               </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621683241907"><span class="hs-identifier hs-var">genDataDataCon</span></a><span> </span><a href="#local-6989586621683241901"><span class="hs-identifier hs-var">data_cons</span></a><span> </span><a href="#local-6989586621683241898"><span class="hs-identifier hs-var">constr_names</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1336"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1337"></a><span>    </span><a name="local-6989586621683241901"><a href="#local-6989586621683241901"><span class="hs-identifier">data_cons</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683241900"><span class="hs-identifier hs-var">rep_tc</span></a><span>
</span><a name="line-1338"></a><span>    </span><a name="local-6989586621683241902"><a href="#local-6989586621683241902"><span class="hs-identifier">n_cons</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621683241901"><span class="hs-identifier hs-var">data_cons</span></a><span>
</span><a name="line-1339"></a><span>    </span><a name="local-6989586621683241903"><a href="#local-6989586621683241903"><span class="hs-identifier">one_constr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241902"><span class="hs-identifier hs-var">n_cons</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1340"></a><span>    </span><span class="hs-identifier">genDataTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#DerivStuff"><span class="hs-identifier hs-type">DerivStuff</span></a><span>
</span><a name="line-1341"></a><span>    </span><a name="local-6989586621683241904"><a href="#local-6989586621683241904"><span class="hs-identifier">genDataTyCon</span></a></a><span>        </span><span class="hs-comment">--  $dT</span><span>
</span><a name="line-1342"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#DerivHsBind"><span class="hs-identifier hs-var">DerivHsBind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683241897"><span class="hs-identifier hs-var">data_type_name</span></a><span> </span><a href="#local-6989586621683241906"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1343"></a><span>                     </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683241897"><span class="hs-identifier hs-var">data_type_name</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621683241905"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1344"></a><span>
</span><a name="line-1345"></a><span>    </span><a name="local-6989586621683241905"><a href="#local-6989586621683241905"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLHsSigWcType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsTyVar</span><span> </span><a href="TcGenDeriv.html#dataType_RDR"><span class="hs-identifier hs-var">dataType_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-1346"></a><span>    </span><a name="local-6989586621683241906"><a href="#local-6989586621683241906"><span class="hs-identifier">rhs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#mkDataType_RDR"><span class="hs-identifier hs-var">mkDataType_RDR</span></a><span>
</span><a name="line-1347"></a><span>             </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApp</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">showSDocOneLine</span><span> </span><a href="#local-6989586621683241896"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683241900"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1348"></a><span>             </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApp</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">nlList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241898"><span class="hs-identifier hs-var">constr_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span>    </span><span class="hs-identifier">genDataDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#DerivStuff"><span class="hs-identifier hs-type">DerivStuff</span></a><span>
</span><a name="line-1351"></a><span>    </span><a name="local-6989586621683241907"><a href="#local-6989586621683241907"><span class="hs-identifier">genDataDataCon</span></a></a><span> </span><a name="local-6989586621683241921"><a href="#local-6989586621683241921"><span class="hs-identifier">dc</span></a></a><span> </span><a name="local-6989586621683241922"><a href="#local-6989586621683241922"><span class="hs-identifier">constr_name</span></a></a><span>       </span><span class="hs-comment">--  $cT1 etc</span><span>
</span><a name="line-1352"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#DerivHsBind"><span class="hs-identifier hs-var">DerivHsBind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683241922"><span class="hs-identifier hs-var">constr_name</span></a><span> </span><a href="#local-6989586621683241924"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1353"></a><span>                     </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683241922"><span class="hs-identifier hs-var">constr_name</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621683241923"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1354"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1355"></a><span>        </span><a name="local-6989586621683241923"><a href="#local-6989586621683241923"><span class="hs-identifier">sig_ty</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLHsSigWcType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsTyVar</span><span> </span><a href="TcGenDeriv.html#constr_RDR"><span class="hs-identifier hs-var">constr_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-1356"></a><span>        </span><a name="local-6989586621683241924"><a href="#local-6989586621683241924"><span class="hs-identifier">rhs</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><a href="TcGenDeriv.html#mkConstr_RDR"><span class="hs-identifier hs-var">mkConstr_RDR</span></a><span> </span><a href="#local-6989586621683241925"><span class="hs-identifier hs-var">constr_args</span></a><span>
</span><a name="line-1357"></a><span>
</span><a name="line-1358"></a><span>        </span><a name="local-6989586621683241925"><a href="#local-6989586621683241925"><span class="hs-identifier">constr_args</span></a></a><span>
</span><a name="line-1359"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- nlHsIntLit (toInteger (dataConTag dc)),   -- Tag</span><span>
</span><a name="line-1360"></a><span>               </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241897"><span class="hs-identifier hs-var">data_type_name</span></a><span class="hs-special">)</span><span>                     </span><span class="hs-comment">-- DataType</span><span>
</span><a name="line-1361"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">occNameString</span><span> </span><a href="#local-6989586621683241927"><span class="hs-identifier hs-var">dc_occ</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- String name</span><span>
</span><a name="line-1362"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlList</span><span>  </span><a href="#local-6989586621683241926"><span class="hs-identifier hs-var">labels</span></a><span>                               </span><span class="hs-comment">-- Field labels</span><span>
</span><a name="line-1363"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241929"><span class="hs-identifier hs-var">fixity</span></a><span> </span><span class="hs-special">]</span><span>                             </span><span class="hs-comment">-- Fixity</span><span>
</span><a name="line-1364"></a><span>
</span><a name="line-1365"></a><span>        </span><a name="local-6989586621683241926"><a href="#local-6989586621683241926"><span class="hs-identifier">labels</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mkHsString</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unpackFS</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">flLabel</span><span class="hs-special">)</span><span>
</span><a name="line-1366"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConFieldLabels</span><span> </span><a href="#local-6989586621683241921"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1367"></a><span>        </span><a name="local-6989586621683241927"><a href="#local-6989586621683241927"><span class="hs-identifier">dc_occ</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getOccName</span><span> </span><a href="#local-6989586621683241921"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-1368"></a><span>        </span><a name="local-6989586621683241928"><a href="#local-6989586621683241928"><span class="hs-identifier">is_infix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isDataSymOcc</span><span> </span><a href="#local-6989586621683241927"><span class="hs-identifier hs-var">dc_occ</span></a><span>
</span><a name="line-1369"></a><span>        </span><a name="local-6989586621683241929"><a href="#local-6989586621683241929"><span class="hs-identifier">fixity</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241928"><span class="hs-identifier hs-var">is_infix</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#infix_RDR"><span class="hs-identifier hs-var">infix_RDR</span></a><span>
</span><a name="line-1370"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#prefix_RDR"><span class="hs-identifier hs-var">prefix_RDR</span></a><span>
</span><a name="line-1371"></a><span>
</span><a name="line-1372"></a><span>        </span><span class="hs-comment">------------ gfoldl</span><span>
</span><a name="line-1373"></a><span>    </span><a name="local-6989586621683241908"><a href="#local-6989586621683241908"><span class="hs-identifier">gfoldl_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkFunBindEC"><span class="hs-identifier hs-var">mkFunBindEC</span></a><span> </span><span class="hs-number">3</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="TcGenDeriv.html#gfoldl_RDR"><span class="hs-identifier hs-var">gfoldl_RDR</span></a><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683241909"><span class="hs-identifier hs-var">gfoldl_eqn</span></a><span> </span><a href="#local-6989586621683241901"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-1374"></a><span>
</span><a name="line-1375"></a><span>    </span><a name="local-6989586621683241909"><a href="#local-6989586621683241909"><span class="hs-identifier">gfoldl_eqn</span></a></a><span> </span><a name="local-6989586621683241930"><a href="#local-6989586621683241930"><span class="hs-identifier">con</span></a></a><span>
</span><a name="line-1376"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#k_RDR"><span class="hs-identifier hs-var">k_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#z_Pat"><span class="hs-identifier hs-var">z_Pat</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><a href="#local-6989586621683241931"><span class="hs-identifier hs-var">con_name</span></a><span> </span><a href="#local-6989586621683241932"><span class="hs-identifier hs-var">as_needed</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1377"></a><span>                   </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621683241933"><span class="hs-identifier hs-var">mk_k_app</span></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#z_Expr"><span class="hs-identifier hs-var">z_Expr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApp</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241931"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241932"><span class="hs-identifier hs-var">as_needed</span></a><span class="hs-special">)</span><span>
</span><a name="line-1378"></a><span>                   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1379"></a><span>                     </span><span class="hs-identifier">con_name</span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-1380"></a><span>                     </span><a name="local-6989586621683241931"><a href="#local-6989586621683241931"><span class="hs-identifier">con_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241930"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-1381"></a><span>                     </span><a name="local-6989586621683241932"><a href="#local-6989586621683241932"><span class="hs-identifier">as_needed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241930"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#as_RDRs"><span class="hs-identifier hs-var">as_RDRs</span></a><span>
</span><a name="line-1382"></a><span>                     </span><a name="local-6989586621683241933"><a href="#local-6989586621683241933"><span class="hs-identifier">mk_k_app</span></a></a><span> </span><a name="local-6989586621683241934"><a href="#local-6989586621683241934"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621683241935"><a href="#local-6989586621683241935"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsOpApp</span><span> </span><a href="#local-6989586621683241934"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="TcGenDeriv.html#k_RDR"><span class="hs-identifier hs-var">k_RDR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241935"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1383"></a><span>
</span><a name="line-1384"></a><span>        </span><span class="hs-comment">------------ gunfold</span><span>
</span><a name="line-1385"></a><span>    </span><a name="local-6989586621683241910"><a href="#local-6989586621683241910"><span class="hs-identifier">gunfold_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-1386"></a><span>                     </span><a href="TcGenDeriv.html#gunfold_RDR"><span class="hs-identifier hs-var">gunfold_RDR</span></a><span>
</span><a name="line-1387"></a><span>                     </span><span class="hs-special">[</span><a href="TcGenDeriv.html#k_Pat"><span class="hs-identifier hs-var">k_Pat</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#z_Pat"><span class="hs-identifier hs-var">z_Pat</span></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621683241903"><span class="hs-identifier hs-var">one_constr</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="TcGenDeriv.html#c_Pat"><span class="hs-identifier hs-var">c_Pat</span></a><span class="hs-special">]</span><span>
</span><a name="line-1388"></a><span>                     </span><a href="#local-6989586621683241911"><span class="hs-identifier hs-var">gunfold_rhs</span></a><span>
</span><a name="line-1389"></a><span>
</span><a name="line-1390"></a><span>    </span><a name="local-6989586621683241911"><a href="#local-6989586621683241911"><span class="hs-identifier">gunfold_rhs</span></a></a><span>
</span><a name="line-1391"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241903"><span class="hs-identifier hs-var">one_constr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241913"><span class="hs-identifier hs-var">mk_unfold_rhs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621683241901"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- No need for case</span><span>
</span><a name="line-1392"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#conIndex_RDR"><span class="hs-identifier hs-var">conIndex_RDR</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApp</span><span class="hs-special">`</span><span> </span><a href="TcGenDeriv.html#c_Expr"><span class="hs-identifier hs-var">c_Expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1393"></a><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683241912"><span class="hs-identifier hs-var">gunfold_alt</span></a><span> </span><a href="#local-6989586621683241901"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-1394"></a><span>
</span><a name="line-1395"></a><span>    </span><a name="local-6989586621683241912"><a href="#local-6989586621683241912"><span class="hs-identifier">gunfold_alt</span></a></a><span> </span><a name="local-6989586621683241936"><a href="#local-6989586621683241936"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241914"><span class="hs-identifier hs-var">mk_unfold_pat</span></a><span> </span><a href="#local-6989586621683241936"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241913"><span class="hs-identifier hs-var">mk_unfold_rhs</span></a><span> </span><a href="#local-6989586621683241936"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1396"></a><span>    </span><a name="local-6989586621683241913"><a href="#local-6989586621683241913"><span class="hs-identifier">mk_unfold_rhs</span></a></a><span> </span><a name="local-6989586621683241937"><a href="#local-6989586621683241937"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span>
</span><a name="line-1397"></a><span>                           </span><span class="hs-special">(</span><a href="TcGenDeriv.html#z_Expr"><span class="hs-identifier hs-var">z_Expr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApp</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241937"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1398"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241937"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#k_RDR"><span class="hs-identifier hs-var">k_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1399"></a><span>
</span><a name="line-1400"></a><span>    </span><a name="local-6989586621683241914"><a href="#local-6989586621683241914"><span class="hs-identifier">mk_unfold_pat</span></a></a><span> </span><a name="local-6989586621683241938"><a href="#local-6989586621683241938"><span class="hs-identifier">dc</span></a></a><span>    </span><span class="hs-comment">-- Last one is a wild-pat, to avoid</span><span>
</span><a name="line-1401"></a><span>                        </span><span class="hs-comment">-- redundant test, and annoying warning</span><span>
</span><a name="line-1402"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241939"><span class="hs-identifier hs-var">tag</span></a><span class="hs-glyph">-</span><span class="hs-identifier hs-var">fIRST_TAG</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621683241902"><span class="hs-identifier hs-var">n_cons</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span>   </span><span class="hs-comment">-- Last constructor</span><span>
</span><a name="line-1403"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlConPat</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span>
</span><a name="line-1404"></a><span>                             </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlLitPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntPrim</span><span> </span><span class="hs-identifier hs-var">NoSourceText</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621683241939"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1405"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1406"></a><span>        </span><a name="local-6989586621683241939"><a href="#local-6989586621683241939"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConTag</span><span> </span><a href="#local-6989586621683241938"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-1407"></a><span>
</span><a name="line-1408"></a><span>        </span><span class="hs-comment">------------ toConstr</span><span>
</span><a name="line-1409"></a><span>    </span><a name="local-6989586621683241915"><a href="#local-6989586621683241915"><span class="hs-identifier">toCon_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkFunBindEC"><span class="hs-identifier hs-var">mkFunBindEC</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="TcGenDeriv.html#toConstr_RDR"><span class="hs-identifier hs-var">toConstr_RDR</span></a><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-1410"></a><span>                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621683241916"><span class="hs-identifier hs-var">to_con_eqn</span></a><span> </span><a href="#local-6989586621683241901"><span class="hs-identifier hs-var">data_cons</span></a><span> </span><a href="#local-6989586621683241898"><span class="hs-identifier hs-var">constr_names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1411"></a><span>    </span><a name="local-6989586621683241916"><a href="#local-6989586621683241916"><span class="hs-identifier">to_con_eqn</span></a></a><span> </span><a name="local-6989586621683241940"><a href="#local-6989586621683241940"><span class="hs-identifier">dc</span></a></a><span> </span><a name="local-6989586621683241941"><a href="#local-6989586621683241941"><span class="hs-identifier">con_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlWildConPat</span><span> </span><a href="#local-6989586621683241940"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241941"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1412"></a><span>
</span><a name="line-1413"></a><span>        </span><span class="hs-comment">------------ dataTypeOf</span><span>
</span><a name="line-1414"></a><span>    </span><a name="local-6989586621683241917"><a href="#local-6989586621683241917"><span class="hs-identifier">dataTypeOf_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span>
</span><a name="line-1415"></a><span>                        </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-1416"></a><span>                        </span><a href="TcGenDeriv.html#dataTypeOf_RDR"><span class="hs-identifier hs-var">dataTypeOf_RDR</span></a><span>
</span><a name="line-1417"></a><span>                        </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlWildPat</span><span class="hs-special">]</span><span>
</span><a name="line-1418"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241897"><span class="hs-identifier hs-var">data_type_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1419"></a><span>
</span><a name="line-1420"></a><span>        </span><span class="hs-comment">------------ gcast1/2</span><span>
</span><a name="line-1421"></a><span>        </span><span class="hs-comment">-- Make the binding    dataCast1 x = gcast1 x  -- if T :: * -&gt; *</span><span>
</span><a name="line-1422"></a><span>        </span><span class="hs-comment">--               or    dataCast2 x = gcast2 s  -- if T :: * -&gt; * -&gt; *</span><span>
</span><a name="line-1423"></a><span>        </span><span class="hs-comment">-- (or nothing if T has neither of these two types)</span><span>
</span><a name="line-1424"></a><span>
</span><a name="line-1425"></a><span>        </span><span class="hs-comment">-- But care is needed for data families:</span><span>
</span><a name="line-1426"></a><span>        </span><span class="hs-comment">-- If we have   data family D a</span><span>
</span><a name="line-1427"></a><span>        </span><span class="hs-comment">--              data instance D (a,b,c) = A | B deriving( Data )</span><span>
</span><a name="line-1428"></a><span>        </span><span class="hs-comment">-- and we want  instance ... =&gt; Data (D [(a,b,c)]) where ...</span><span>
</span><a name="line-1429"></a><span>        </span><span class="hs-comment">-- then we need     dataCast1 x = gcast1 x</span><span>
</span><a name="line-1430"></a><span>        </span><span class="hs-comment">-- because D :: * -&gt; *</span><span>
</span><a name="line-1431"></a><span>        </span><span class="hs-comment">-- even though rep_tc has kind * -&gt; * -&gt; * -&gt; *</span><span>
</span><a name="line-1432"></a><span>        </span><span class="hs-comment">-- Hence looking for the kind of fam_tc not rep_tc</span><span>
</span><a name="line-1433"></a><span>        </span><span class="hs-comment">-- See Trac #4896</span><span>
</span><a name="line-1434"></a><span>    </span><a name="local-6989586621683241918"><a href="#local-6989586621683241918"><span class="hs-identifier">tycon_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tyConFamInst_maybe</span><span> </span><a href="#local-6989586621683241900"><span class="hs-identifier hs-var">rep_tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1435"></a><span>                    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241942"><a href="#local-6989586621683241942"><span class="hs-identifier">fam_tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621683241942"><span class="hs-identifier hs-var">fam_tc</span></a><span>
</span><a name="line-1436"></a><span>                    </span><span class="hs-identifier hs-var">Nothing</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621683241900"><span class="hs-identifier hs-var">rep_tc</span></a><span>
</span><a name="line-1437"></a><span>    </span><a name="local-6989586621683241919"><a href="#local-6989586621683241919"><span class="hs-identifier">gcast_binds</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241918"><span class="hs-identifier hs-var">tycon_kind</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">tcEqKind</span><span class="hs-special">`</span><span> </span><a href="TcGenDeriv.html#kind1"><span class="hs-identifier hs-var">kind1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241920"><span class="hs-identifier hs-var">mk_gcast</span></a><span> </span><a href="TcGenDeriv.html#dataCast1_RDR"><span class="hs-identifier hs-var">dataCast1_RDR</span></a><span> </span><a href="TcGenDeriv.html#gcast1_RDR"><span class="hs-identifier hs-var">gcast1_RDR</span></a><span>
</span><a name="line-1438"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241918"><span class="hs-identifier hs-var">tycon_kind</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">tcEqKind</span><span class="hs-special">`</span><span> </span><a href="TcGenDeriv.html#kind2"><span class="hs-identifier hs-var">kind2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241920"><span class="hs-identifier hs-var">mk_gcast</span></a><span> </span><a href="TcGenDeriv.html#dataCast2_RDR"><span class="hs-identifier hs-var">dataCast2_RDR</span></a><span> </span><a href="TcGenDeriv.html#gcast2_RDR"><span class="hs-identifier hs-var">gcast2_RDR</span></a><span>
</span><a name="line-1439"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span>
</span><a name="line-1440"></a><span>    </span><a name="local-6989586621683241920"><a href="#local-6989586621683241920"><span class="hs-identifier">mk_gcast</span></a></a><span> </span><a name="local-6989586621683241943"><a href="#local-6989586621683241943"><span class="hs-identifier">dataCast_RDR</span></a></a><span> </span><a name="local-6989586621683241944"><a href="#local-6989586621683241944"><span class="hs-identifier">gcast_RDR</span></a></a><span>
</span><a name="line-1441"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mk_easy_FunBind</span><span> </span><a href="#local-6989586621683241899"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683241943"><span class="hs-identifier hs-var">dataCast_RDR</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#f_RDR"><span class="hs-identifier hs-var">f_RDR</span></a><span class="hs-special">]</span><span>
</span><a name="line-1442"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241944"><span class="hs-identifier hs-var">gcast_RDR</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApp</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#f_RDR"><span class="hs-identifier hs-var">f_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1443"></a><span>
</span><a name="line-1444"></a><span>
</span><a name="line-1445"></a><span class="hs-identifier">kind1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">kind2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind</span><span>
</span><a name="line-1446"></a><a name="kind1"><a href="TcGenDeriv.html#kind1"><span class="hs-identifier">kind1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftedTypeKind</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mkFunTy</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">liftedTypeKind</span><span>
</span><a name="line-1447"></a><a name="kind2"><a href="TcGenDeriv.html#kind2"><span class="hs-identifier">kind2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftedTypeKind</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mkFunTy</span><span class="hs-special">`</span><span> </span><a href="TcGenDeriv.html#kind1"><span class="hs-identifier hs-var">kind1</span></a><span>
</span><a name="line-1448"></a><span>
</span><a name="line-1449"></a><span class="hs-identifier">gfoldl_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gunfold_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toConstr_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dataTypeOf_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkConstr_RDR</span><span class="hs-special">,</span><span>
</span><a name="line-1450"></a><span>    </span><span class="hs-identifier">mkDataType_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">conIndex_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">prefix_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">infix_RDR</span><span class="hs-special">,</span><span>
</span><a name="line-1451"></a><span>    </span><span class="hs-identifier">dataCast1_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dataCast2_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gcast1_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gcast2_RDR</span><span class="hs-special">,</span><span>
</span><a name="line-1452"></a><span>    </span><span class="hs-identifier">constr_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dataType_RDR</span><span class="hs-special">,</span><span>
</span><a name="line-1453"></a><span>    </span><span class="hs-identifier">eqChar_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltChar_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geChar_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtChar_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leChar_RDR</span><span>  </span><span class="hs-special">,</span><span>
</span><a name="line-1454"></a><span>    </span><span class="hs-identifier">eqInt_RDR</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltInt_RDR</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geInt_RDR</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtInt_RDR</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leInt_RDR</span><span>   </span><span class="hs-special">,</span><span>
</span><a name="line-1455"></a><span>    </span><span class="hs-identifier">eqInt8_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltInt8_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geInt8_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtInt8_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leInt8_RDR</span><span>  </span><span class="hs-special">,</span><span>
</span><a name="line-1456"></a><span>    </span><span class="hs-identifier">eqInt16_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltInt16_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geInt16_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtInt16_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leInt16_RDR</span><span> </span><span class="hs-special">,</span><span>
</span><a name="line-1457"></a><span>    </span><span class="hs-identifier">eqWord_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltWord_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geWord_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtWord_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leWord_RDR</span><span>  </span><span class="hs-special">,</span><span>
</span><a name="line-1458"></a><span>    </span><span class="hs-identifier">eqWord8_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltWord8_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geWord8_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtWord8_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leWord8_RDR</span><span> </span><span class="hs-special">,</span><span>
</span><a name="line-1459"></a><span>    </span><span class="hs-identifier">eqWord16_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltWord16_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geWord16_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtWord16_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leWord16_RDR</span><span class="hs-special">,</span><span>
</span><a name="line-1460"></a><span>    </span><span class="hs-identifier">eqAddr_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltAddr_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geAddr_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtAddr_RDR</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leAddr_RDR</span><span>  </span><span class="hs-special">,</span><span>
</span><a name="line-1461"></a><span>    </span><span class="hs-identifier">eqFloat_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltFloat_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geFloat_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtFloat_RDR</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leFloat_RDR</span><span> </span><span class="hs-special">,</span><span>
</span><a name="line-1462"></a><span>    </span><span class="hs-identifier">eqDouble_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltDouble_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">geDouble_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtDouble_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">leDouble_RDR</span><span class="hs-special">,</span><span>
</span><a name="line-1463"></a><span>    </span><span class="hs-identifier">extendWord8_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">extendInt8_RDR</span><span class="hs-special">,</span><span>
</span><a name="line-1464"></a><span>    </span><span class="hs-identifier">extendWord16_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">extendInt16_RDR</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-1465"></a><a name="gfoldl_RDR"><a href="TcGenDeriv.html#gfoldl_RDR"><span class="hs-identifier">gfoldl_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gfoldl&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1466"></a><a name="gunfold_RDR"><a href="TcGenDeriv.html#gunfold_RDR"><span class="hs-identifier">gunfold_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gunfold&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1467"></a><a name="toConstr_RDR"><a href="TcGenDeriv.html#toConstr_RDR"><span class="hs-identifier">toConstr_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;toConstr&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1468"></a><a name="dataTypeOf_RDR"><a href="TcGenDeriv.html#dataTypeOf_RDR"><span class="hs-identifier">dataTypeOf_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;dataTypeOf&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1469"></a><a name="dataCast1_RDR"><a href="TcGenDeriv.html#dataCast1_RDR"><span class="hs-identifier">dataCast1_RDR</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;dataCast1&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1470"></a><a name="dataCast2_RDR"><a href="TcGenDeriv.html#dataCast2_RDR"><span class="hs-identifier">dataCast2_RDR</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;dataCast2&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1471"></a><a name="gcast1_RDR"><a href="TcGenDeriv.html#gcast1_RDR"><span class="hs-identifier">gcast1_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">tYPEABLE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gcast1&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1472"></a><a name="gcast2_RDR"><a href="TcGenDeriv.html#gcast2_RDR"><span class="hs-identifier">gcast2_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">tYPEABLE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gcast2&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1473"></a><a name="mkConstr_RDR"><a href="TcGenDeriv.html#mkConstr_RDR"><span class="hs-identifier">mkConstr_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;mkConstr&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1474"></a><a name="constr_RDR"><a href="TcGenDeriv.html#constr_RDR"><span class="hs-identifier">constr_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tcQual_RDR</span><span>   </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;Constr&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1475"></a><a name="mkDataType_RDR"><a href="TcGenDeriv.html#mkDataType_RDR"><span class="hs-identifier">mkDataType_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;mkDataType&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1476"></a><a name="dataType_RDR"><a href="TcGenDeriv.html#dataType_RDR"><span class="hs-identifier">dataType_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tcQual_RDR</span><span>   </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;DataType&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1477"></a><a name="conIndex_RDR"><a href="TcGenDeriv.html#conIndex_RDR"><span class="hs-identifier">conIndex_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;constrIndex&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1478"></a><a name="prefix_RDR"><a href="TcGenDeriv.html#prefix_RDR"><span class="hs-identifier">prefix_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataQual_RDR</span><span> </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;Prefix&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1479"></a><a name="infix_RDR"><a href="TcGenDeriv.html#infix_RDR"><span class="hs-identifier">infix_RDR</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataQual_RDR</span><span> </span><span class="hs-identifier hs-var">gENERICS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;Infix&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1480"></a><span>
</span><a name="line-1481"></a><a name="eqChar_RDR"><a href="TcGenDeriv.html#eqChar_RDR"><span class="hs-identifier">eqChar_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;eqChar#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1482"></a><a name="ltChar_RDR"><a href="TcGenDeriv.html#ltChar_RDR"><span class="hs-identifier">ltChar_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;ltChar#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1483"></a><a name="leChar_RDR"><a href="TcGenDeriv.html#leChar_RDR"><span class="hs-identifier">leChar_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;leChar#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1484"></a><a name="gtChar_RDR"><a href="TcGenDeriv.html#gtChar_RDR"><span class="hs-identifier">gtChar_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gtChar#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1485"></a><a name="geChar_RDR"><a href="TcGenDeriv.html#geChar_RDR"><span class="hs-identifier">geChar_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;geChar#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1486"></a><span>
</span><a name="line-1487"></a><a name="eqInt_RDR"><a href="TcGenDeriv.html#eqInt_RDR"><span class="hs-identifier">eqInt_RDR</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;==#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1488"></a><a name="ltInt_RDR"><a href="TcGenDeriv.html#ltInt_RDR"><span class="hs-identifier">ltInt_RDR</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;&lt;#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1489"></a><a name="leInt_RDR"><a href="TcGenDeriv.html#leInt_RDR"><span class="hs-identifier">leInt_RDR</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;&lt;=#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><a name="gtInt_RDR"><a href="TcGenDeriv.html#gtInt_RDR"><span class="hs-identifier">gtInt_RDR</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;&gt;#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1491"></a><a name="geInt_RDR"><a href="TcGenDeriv.html#geInt_RDR"><span class="hs-identifier">geInt_RDR</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;&gt;=#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1492"></a><span>
</span><a name="line-1493"></a><a name="eqInt8_RDR"><a href="TcGenDeriv.html#eqInt8_RDR"><span class="hs-identifier">eqInt8_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;eqInt8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1494"></a><a name="ltInt8_RDR"><a href="TcGenDeriv.html#ltInt8_RDR"><span class="hs-identifier">ltInt8_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;ltInt8#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1495"></a><a name="leInt8_RDR"><a href="TcGenDeriv.html#leInt8_RDR"><span class="hs-identifier">leInt8_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;leInt8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1496"></a><a name="gtInt8_RDR"><a href="TcGenDeriv.html#gtInt8_RDR"><span class="hs-identifier">gtInt8_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gtInt8#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1497"></a><a name="geInt8_RDR"><a href="TcGenDeriv.html#geInt8_RDR"><span class="hs-identifier">geInt8_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;geInt8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1498"></a><span>
</span><a name="line-1499"></a><a name="eqInt16_RDR"><a href="TcGenDeriv.html#eqInt16_RDR"><span class="hs-identifier">eqInt16_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;eqInt16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1500"></a><a name="ltInt16_RDR"><a href="TcGenDeriv.html#ltInt16_RDR"><span class="hs-identifier">ltInt16_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;ltInt16#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1501"></a><a name="leInt16_RDR"><a href="TcGenDeriv.html#leInt16_RDR"><span class="hs-identifier">leInt16_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;leInt16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1502"></a><a name="gtInt16_RDR"><a href="TcGenDeriv.html#gtInt16_RDR"><span class="hs-identifier">gtInt16_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gtInt16#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1503"></a><a name="geInt16_RDR"><a href="TcGenDeriv.html#geInt16_RDR"><span class="hs-identifier">geInt16_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;geInt16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1504"></a><span>
</span><a name="line-1505"></a><a name="eqWord_RDR"><a href="TcGenDeriv.html#eqWord_RDR"><span class="hs-identifier">eqWord_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;eqWord#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1506"></a><a name="ltWord_RDR"><a href="TcGenDeriv.html#ltWord_RDR"><span class="hs-identifier">ltWord_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;ltWord#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1507"></a><a name="leWord_RDR"><a href="TcGenDeriv.html#leWord_RDR"><span class="hs-identifier">leWord_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;leWord#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1508"></a><a name="gtWord_RDR"><a href="TcGenDeriv.html#gtWord_RDR"><span class="hs-identifier">gtWord_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gtWord#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1509"></a><a name="geWord_RDR"><a href="TcGenDeriv.html#geWord_RDR"><span class="hs-identifier">geWord_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;geWord#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1510"></a><span>
</span><a name="line-1511"></a><a name="eqWord8_RDR"><a href="TcGenDeriv.html#eqWord8_RDR"><span class="hs-identifier">eqWord8_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;eqWord8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1512"></a><a name="ltWord8_RDR"><a href="TcGenDeriv.html#ltWord8_RDR"><span class="hs-identifier">ltWord8_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;ltWord8#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1513"></a><a name="leWord8_RDR"><a href="TcGenDeriv.html#leWord8_RDR"><span class="hs-identifier">leWord8_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;leWord8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1514"></a><a name="gtWord8_RDR"><a href="TcGenDeriv.html#gtWord8_RDR"><span class="hs-identifier">gtWord8_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gtWord8#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1515"></a><a name="geWord8_RDR"><a href="TcGenDeriv.html#geWord8_RDR"><span class="hs-identifier">geWord8_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;geWord8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1516"></a><span>
</span><a name="line-1517"></a><a name="eqWord16_RDR"><a href="TcGenDeriv.html#eqWord16_RDR"><span class="hs-identifier">eqWord16_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;eqWord16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1518"></a><a name="ltWord16_RDR"><a href="TcGenDeriv.html#ltWord16_RDR"><span class="hs-identifier">ltWord16_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;ltWord16#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1519"></a><a name="leWord16_RDR"><a href="TcGenDeriv.html#leWord16_RDR"><span class="hs-identifier">leWord16_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;leWord16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1520"></a><a name="gtWord16_RDR"><a href="TcGenDeriv.html#gtWord16_RDR"><span class="hs-identifier">gtWord16_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gtWord16#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1521"></a><a name="geWord16_RDR"><a href="TcGenDeriv.html#geWord16_RDR"><span class="hs-identifier">geWord16_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;geWord16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><span>
</span><a name="line-1523"></a><a name="eqAddr_RDR"><a href="TcGenDeriv.html#eqAddr_RDR"><span class="hs-identifier">eqAddr_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;eqAddr#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1524"></a><a name="ltAddr_RDR"><a href="TcGenDeriv.html#ltAddr_RDR"><span class="hs-identifier">ltAddr_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;ltAddr#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1525"></a><a name="leAddr_RDR"><a href="TcGenDeriv.html#leAddr_RDR"><span class="hs-identifier">leAddr_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;leAddr#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1526"></a><a name="gtAddr_RDR"><a href="TcGenDeriv.html#gtAddr_RDR"><span class="hs-identifier">gtAddr_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gtAddr#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1527"></a><a name="geAddr_RDR"><a href="TcGenDeriv.html#geAddr_RDR"><span class="hs-identifier">geAddr_RDR</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;geAddr#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1528"></a><span>
</span><a name="line-1529"></a><a name="eqFloat_RDR"><a href="TcGenDeriv.html#eqFloat_RDR"><span class="hs-identifier">eqFloat_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;eqFloat#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1530"></a><a name="ltFloat_RDR"><a href="TcGenDeriv.html#ltFloat_RDR"><span class="hs-identifier">ltFloat_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;ltFloat#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1531"></a><a name="leFloat_RDR"><a href="TcGenDeriv.html#leFloat_RDR"><span class="hs-identifier">leFloat_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;leFloat#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1532"></a><a name="gtFloat_RDR"><a href="TcGenDeriv.html#gtFloat_RDR"><span class="hs-identifier">gtFloat_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;gtFloat#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1533"></a><a name="geFloat_RDR"><a href="TcGenDeriv.html#geFloat_RDR"><span class="hs-identifier">geFloat_RDR</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;geFloat#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1534"></a><span>
</span><a name="line-1535"></a><a name="eqDouble_RDR"><a href="TcGenDeriv.html#eqDouble_RDR"><span class="hs-identifier">eqDouble_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;==##&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1536"></a><a name="ltDouble_RDR"><a href="TcGenDeriv.html#ltDouble_RDR"><span class="hs-identifier">ltDouble_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;&lt;##&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1537"></a><a name="leDouble_RDR"><a href="TcGenDeriv.html#leDouble_RDR"><span class="hs-identifier">leDouble_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;&lt;=##&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1538"></a><a name="gtDouble_RDR"><a href="TcGenDeriv.html#gtDouble_RDR"><span class="hs-identifier">gtDouble_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;&gt;##&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1539"></a><a name="geDouble_RDR"><a href="TcGenDeriv.html#geDouble_RDR"><span class="hs-identifier">geDouble_RDR</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;&gt;=##&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1540"></a><span>
</span><a name="line-1541"></a><a name="extendWord8_RDR"><a href="TcGenDeriv.html#extendWord8_RDR"><span class="hs-identifier">extendWord8_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;extendWord8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1542"></a><a name="extendInt8_RDR"><a href="TcGenDeriv.html#extendInt8_RDR"><span class="hs-identifier">extendInt8_RDR</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;extendInt8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1543"></a><span>
</span><a name="line-1544"></a><a name="extendWord16_RDR"><a href="TcGenDeriv.html#extendWord16_RDR"><span class="hs-identifier">extendWord16_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;extendWord16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1545"></a><a name="extendInt16_RDR"><a href="TcGenDeriv.html#extendInt16_RDR"><span class="hs-identifier">extendInt16_RDR</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varQual_RDR</span><span>  </span><span class="hs-identifier hs-var">gHC_PRIM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;extendInt16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1546"></a><span>
</span><a name="line-1547"></a><span>
</span><a name="line-1548"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        Lift instances
*                                                                      *
************************************************************************

Example:

    data Foo a = Foo a | a :^: a deriving Lift

    ==&gt;

    instance (Lift a) =&gt; Lift (Foo a) where
        lift (Foo a)
          = appE
              (conE
                (mkNameG_d &quot;package-name&quot; &quot;ModuleName&quot; &quot;Foo&quot;))
              (lift a)
        lift (u :^: v)
          = infixApp
              (lift u)
              (conE
                (mkNameG_d &quot;package-name&quot; &quot;ModuleName&quot; &quot;:^:&quot;))
              (lift v)

Note that (mkNameG_d &quot;package-name&quot; &quot;ModuleName&quot; &quot;Foo&quot;) is equivalent to what
'Foo would be when using the -XTemplateHaskell extension. To make sure that
-XDeriveLift can be used on stage-1 compilers, however, we explicitly invoke
makeG_d.
-}</span><span>
</span><a name="line-1579"></a><span>
</span><a name="line-1580"></a><span class="hs-identifier">gen_Lift_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-1581"></a><a name="gen_Lift_binds"><a href="TcGenDeriv.html#gen_Lift_binds"><span class="hs-identifier">gen_Lift_binds</span></a></a><span> </span><a name="local-6989586621683241945"><a href="#local-6989586621683241945"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241946"><a href="#local-6989586621683241946"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitBag</span><span> </span><a href="#local-6989586621683241947"><span class="hs-identifier hs-var">lift_bind</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">)</span><span>
</span><a name="line-1582"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1583"></a><span>    </span><a name="local-6989586621683241947"><a href="#local-6989586621683241947"><span class="hs-identifier">lift_bind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkFunBindEC"><span class="hs-identifier hs-var">mkFunBindEC</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621683241945"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="THNames.html#lift_RDR"><span class="hs-identifier hs-var">lift_RDR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><a href="TcGenDeriv.html#pure_Expr"><span class="hs-identifier hs-var">pure_Expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1584"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683241949"><span class="hs-identifier hs-var">pats_etc</span></a><span> </span><a href="#local-6989586621683241948"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span>
</span><a name="line-1585"></a><span>    </span><a name="local-6989586621683241948"><a href="#local-6989586621683241948"><span class="hs-identifier">data_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683241946"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1586"></a><span>
</span><a name="line-1587"></a><span>    </span><a name="local-6989586621683241949"><a href="#local-6989586621683241949"><span class="hs-identifier">pats_etc</span></a></a><span> </span><a name="local-6989586621683241950"><a href="#local-6989586621683241950"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-1588"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621683241951"><span class="hs-identifier hs-var">con_pat</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241964"><span class="hs-identifier hs-var">lift_Expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1589"></a><span>       </span><span class="hs-keyword">where</span><span>
</span><a name="line-1590"></a><span>            </span><a name="local-6989586621683241951"><a href="#local-6989586621683241951"><span class="hs-identifier">con_pat</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><a href="#local-6989586621683241952"><span class="hs-identifier hs-var">data_con_RDR</span></a><span> </span><a href="#local-6989586621683241954"><span class="hs-identifier hs-var">as_needed</span></a><span>
</span><a name="line-1591"></a><span>            </span><a name="local-6989586621683241952"><a href="#local-6989586621683241952"><span class="hs-identifier">data_con_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241950"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1592"></a><span>            </span><a name="local-6989586621683241953"><a href="#local-6989586621683241953"><span class="hs-identifier">con_arity</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConSourceArity</span><span> </span><a href="#local-6989586621683241950"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1593"></a><span>            </span><a name="local-6989586621683241954"><a href="#local-6989586621683241954"><span class="hs-identifier">as_needed</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683241953"><span class="hs-identifier hs-var">con_arity</span></a><span> </span><a href="TcGenDeriv.html#as_RDRs"><span class="hs-identifier hs-var">as_RDRs</span></a><span>
</span><a name="line-1594"></a><span>            </span><a name="local-6989586621683241955"><a href="#local-6989586621683241955"><span class="hs-identifier">lifted_as</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWithEqual</span><span> </span><span class="hs-string">&quot;mk_lift_app&quot;</span><span> </span><a href="#local-6989586621683241959"><span class="hs-identifier hs-var">mk_lift_app</span></a><span>
</span><a name="line-1595"></a><span>                             </span><a href="#local-6989586621683241958"><span class="hs-identifier hs-var">tys_needed</span></a><span> </span><a href="#local-6989586621683241954"><span class="hs-identifier hs-var">as_needed</span></a><span>
</span><a name="line-1596"></a><span>            </span><a name="local-6989586621683241956"><a href="#local-6989586621683241956"><span class="hs-identifier">tycon_name</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621683241946"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1597"></a><span>            </span><a name="local-6989586621683241957"><a href="#local-6989586621683241957"><span class="hs-identifier">is_infix</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConIsInfix</span><span> </span><a href="#local-6989586621683241950"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1598"></a><span>            </span><a name="local-6989586621683241958"><a href="#local-6989586621683241958"><span class="hs-identifier">tys_needed</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dataConOrigArgTys</span><span> </span><a href="#local-6989586621683241950"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1599"></a><span>
</span><a name="line-1600"></a><span>            </span><a name="local-6989586621683241959"><a href="#local-6989586621683241959"><span class="hs-identifier">mk_lift_app</span></a></a><span> </span><a name="local-6989586621683241967"><a href="#local-6989586621683241967"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621683241968"><a href="#local-6989586621683241968"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-1601"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isUnliftedType</span><span> </span><a href="#local-6989586621683241967"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#lift_RDR"><span class="hs-identifier hs-var">lift_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-1602"></a><span>                                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241968"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1603"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#litE_RDR"><span class="hs-identifier hs-var">litE_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-1604"></a><span>                              </span><span class="hs-special">(</span><a href="#local-6989586621683241969"><span class="hs-identifier hs-var">primLitOp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683241970"><span class="hs-identifier hs-var">mkBoxExp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241968"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1605"></a><span>              </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683241969"><a href="#local-6989586621683241969"><span class="hs-identifier">primLitOp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683241970"><a href="#local-6989586621683241970"><span class="hs-identifier">mkBoxExp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#primLitOps"><span class="hs-identifier hs-var">primLitOps</span></a><span> </span><span class="hs-string">&quot;Lift&quot;</span><span> </span><a href="#local-6989586621683241967"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1606"></a><span>
</span><a name="line-1607"></a><span>            </span><a name="local-6989586621683241960"><a href="#local-6989586621683241960"><span class="hs-identifier">pkg_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitIdString</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">moduleUnitId</span><span>
</span><a name="line-1608"></a><span>                     </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameModule</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621683241956"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-1609"></a><span>            </span><a name="local-6989586621683241961"><a href="#local-6989586621683241961"><span class="hs-identifier">mod_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">moduleNameString</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameModule</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621683241956"><span class="hs-identifier hs-var">tycon_name</span></a><span>
</span><a name="line-1610"></a><span>            </span><a name="local-6989586621683241962"><a href="#local-6989586621683241962"><span class="hs-identifier">con_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">occNameString</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameOccName</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">dataConName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621683241950"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1611"></a><span>
</span><a name="line-1612"></a><span>            </span><a name="local-6989586621683241963"><a href="#local-6989586621683241963"><span class="hs-identifier">conE_Expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#conE_RDR"><span class="hs-identifier hs-var">conE_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-1613"></a><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><a href="THNames.html#mkNameG_dRDR"><span class="hs-identifier hs-var">mkNameG_dRDR</span></a><span>
</span><a name="line-1614"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mkHsString</span><span class="hs-special">)</span><span>
</span><a name="line-1615"></a><span>                                    </span><span class="hs-special">[</span><a href="#local-6989586621683241960"><span class="hs-identifier hs-var">pkg_name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241961"><span class="hs-identifier hs-var">mod_name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241962"><span class="hs-identifier hs-var">con_name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1616"></a><span>
</span><a name="line-1617"></a><span>            </span><a name="local-6989586621683241964"><a href="#local-6989586621683241964"><span class="hs-identifier">lift_Expr</span></a></a><span>
</span><a name="line-1618"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683241957"><span class="hs-identifier hs-var">is_infix</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><a href="THNames.html#infixApp_RDR"><span class="hs-identifier hs-var">infixApp_RDR</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241965"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241963"><span class="hs-identifier hs-var">conE_Expr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241966"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1619"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="TcGenDeriv.html#mk_appE_app"><span class="hs-identifier hs-var">mk_appE_app</span></a><span> </span><a href="#local-6989586621683241963"><span class="hs-identifier hs-var">conE_Expr</span></a><span> </span><a href="#local-6989586621683241955"><span class="hs-identifier hs-var">lifted_as</span></a><span>
</span><a name="line-1620"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621683241965"><a href="#local-6989586621683241965"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683241966"><a href="#local-6989586621683241966"><span class="hs-identifier">a2</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683241955"><span class="hs-identifier hs-var">lifted_as</span></a><span>
</span><a name="line-1621"></a><span>
</span><a name="line-1622"></a><span class="hs-identifier">mk_appE_app</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1623"></a><a name="mk_appE_app"><a href="TcGenDeriv.html#mk_appE_app"><span class="hs-identifier">mk_appE_app</span></a></a><span> </span><a name="local-6989586621683241971"><a href="#local-6989586621683241971"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683241972"><a href="#local-6989586621683241972"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApps</span><span> </span><a href="THNames.html#appE_RDR"><span class="hs-identifier hs-var">appE_RDR</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683241971"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241972"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-1624"></a><span>
</span><a name="line-1625"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     Newtype-deriving instances
*                                                                      *
************************************************************************

Note [Newtype-deriving instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We take every method in the original instance and `coerce` it to fit
into the derived instance. We need type applications on the argument
to `coerce` to make it obvious what instantiation of the method we're
coercing from.  So from, say,

  class C a b where
    op :: forall c. a -&gt; [b] -&gt; c -&gt; Int

  newtype T x = MkT &lt;rep-ty&gt;

  instance C a &lt;rep-ty&gt; =&gt; C a (T x) where
    op = coerce @ (a -&gt; [&lt;rep-ty&gt;] -&gt; c -&gt; Int)
                @ (a -&gt; [T x]      -&gt; c -&gt; Int)
                op :: forall c. a -&gt; [T x] -&gt; c -&gt; Int

In addition to the type applications, we also have an explicit
type signature on the entire RHS. This brings the method-bound variable
`c` into scope over the two type applications.
See Note [GND and QuantifiedConstraints] for more information on why this
is important.

Giving 'coerce' two explicitly-visible type arguments grants us finer control
over how it should be instantiated. Recall

  coerce :: Coercible a b =&gt; a -&gt; b

By giving it explicit type arguments we deal with the case where
'op' has a higher rank type, and so we must instantiate 'coerce' with
a polytype.  E.g.

   class C a where op :: a -&gt; forall b. b -&gt; b
   newtype T x = MkT &lt;rep-ty&gt;
   instance C &lt;rep-ty&gt; =&gt; C (T x) where
     op = coerce @ (&lt;rep-ty&gt; -&gt; forall b. b -&gt; b)
                 @ (T x      -&gt; forall b. b -&gt; b)
                op :: T x -&gt; forall b. b -&gt; b

The use of type applications is crucial here. If we had tried using only
explicit type signatures, like so:

   instance C &lt;rep-ty&gt; =&gt; C (T x) where
     op = coerce (op :: &lt;rep-ty&gt; -&gt; forall b. b -&gt; b)
                     :: T x      -&gt; forall b. b -&gt; b

Then GHC will attempt to deeply skolemize the two type signatures, which will
wreak havoc with the Coercible solver. Therefore, we instead use type
applications, which do not deeply skolemize and thus avoid this issue.
The downside is that we currently require -XImpredicativeTypes to permit this
polymorphic type instantiation, so we have to switch that flag on locally in
TcDeriv.genInst. See #8503 for more discussion.

Note [Newtype-deriving trickiness]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (Trac #12768):
  class C a where { op :: D a =&gt; a -&gt; a }

  instance C a  =&gt; C [a] where { op = opList }

  opList :: (C a, D [a]) =&gt; [a] -&gt; [a]
  opList = ...

Now suppose we try GND on this:
  newtype N a = MkN [a] deriving( C )

The GND is expecting to get an implementation of op for N by
coercing opList, thus:

  instance C a =&gt; C (N a) where { op = opN }

  opN :: (C a, D (N a)) =&gt; N a -&gt; N a
  opN = coerce @([a]   -&gt; [a])
               @([N a] -&gt; [N a]
               opList :: D (N a) =&gt; [N a] -&gt; [N a]

But there is no reason to suppose that (D [a]) and (D (N a))
are inter-coercible; these instances might completely different.
So GHC rightly rejects this code.

Note [GND and QuantifiedConstraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the following example from #15290:

  class C m where
    join :: m (m a) -&gt; m a

  newtype T m a = MkT (m a)

  deriving instance
    (C m, forall p q. Coercible p q =&gt; Coercible (m p) (m q)) =&gt;
    C (T m)

The code that GHC used to generate for this was:

  instance (C m, forall p q. Coercible p q =&gt; Coercible (m p) (m q)) =&gt;
      C (T m) where
    join = coerce @(forall a.   m   (m a) -&gt;   m a)
                  @(forall a. T m (T m a) -&gt; T m a)
                  join

This instantiates `coerce` at a polymorphic type, a form of impredicative
polymorphism, so we're already on thin ice. And in fact the ice breaks,
as we'll explain:

The call to `coerce` gives rise to:

  Coercible (forall a.   m   (m a) -&gt;   m a)
            (forall a. T m (T m a) -&gt; T m a)

And that simplified to the following implication constraint:

  forall a &lt;no-ev&gt;. m (T m a) ~R# m (m a)

But because this constraint is under a `forall`, inside a type, we have to
prove it *without computing any term evidence* (hence the &lt;no-ev&gt;). Alas, we
*must* generate a term-level evidence binding in order to instantiate the
quantified constraint! In response, GHC currently chooses not to use such
a quantified constraint.
See Note [Instances in no-evidence implications] in TcInteract.

But this isn't the death knell for combining QuantifiedConstraints with GND.
On the contrary, if we generate GND bindings in a slightly different way, then
we can avoid this situation altogether. Instead of applying `coerce` to two
polymorphic types, we instead let an explicit type signature do the polymorphic
instantiation, and omit the `forall`s in the type applications.
More concretely, we generate the following code instead:

  instance (C m, forall p q. Coercible p q =&gt; Coercible (m p) (m q)) =&gt;
      C (T m) where
    join = coerce @(  m   (m a) -&gt;   m a)
                  @(T m (T m a) -&gt; T m a)
                  join :: forall a. T m (T m a) -&gt; T m a

Now the visible type arguments are both monotypes, so we need do any of this
funny quantified constraint instantiation business.

You might think that that second @(T m (T m a) -&gt; T m a) argument is redundant
in the presence of the explicit `:: forall a. T m (T m a) -&gt; T m a` type
signature, but in fact leaving it off will break this example (from the
T15290d test case):

  class C a where
    c :: Int -&gt; forall b. b -&gt; a

  instance C Int

  instance C Age where
    c = coerce @(Int -&gt; forall b. b -&gt; Int)
               c :: Int -&gt; forall b. b -&gt; Age

That is because the explicit type signature deeply skolemizes the forall-bound
`b`, which wreaks havoc with the `Coercible` solver. An additional visible type
argument of @(Int -&gt; forall b. b -&gt; Age) is enough to prevent this.

Be aware that the use of an explicit type signature doesn't /solve/ this
problem; it just makes it less likely to occur. For example, if a class has
a truly higher-rank type like so:

  class CProblem m where
    op :: (forall b. ... (m b) ...) -&gt; Int

Then the same situation will arise again. But at least it won't arise for the
common case of methods with ordinary, prenex-quantified types.

Note [GND and ambiguity]
~~~~~~~~~~~~~~~~~~~~~~~~
We make an effort to make the code generated through GND be robust w.r.t.
ambiguous type variables. As one example, consider the following example
(from #15637):

  class C a where f :: String
  instance C () where f = &quot;foo&quot;
  newtype T = T () deriving C

A na&#239;ve attempt and generating a C T instance would be:

  instance C T where
    f = coerce @String @String f
          :: String

This isn't going to typecheck, however, since GHC doesn't know what to
instantiate the type variable `a` with in the call to `f` in the method body.
(Note that `f :: forall a. String`!) To compensate for the possibility of
ambiguity here, we explicitly instantiate `a` like so:

  instance C T where
    f = coerce @String @String (f @())
          :: String

All better now.
-}</span><span>
</span><a name="line-1824"></a><span>
</span><a name="line-1825"></a><span class="hs-identifier">gen_Newtype_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span>
</span><a name="line-1826"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Class</span><span>   </span><span class="hs-comment">-- the class being derived</span><span>
</span><a name="line-1827"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- the tvs in the instance head (this includes</span><span>
</span><a name="line-1828"></a><span>                             </span><span class="hs-comment">-- the tvs from both the class types and the</span><span>
</span><a name="line-1829"></a><span>                             </span><span class="hs-comment">-- newtype itself)</span><span>
</span><a name="line-1830"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- instance head parameters (incl. newtype)</span><span>
</span><a name="line-1831"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>    </span><span class="hs-comment">-- the representation type</span><span>
</span><a name="line-1832"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-1833"></a><span class="hs-comment">-- See Note [Newtype-deriving instances]</span><span>
</span><a name="line-1834"></a><a name="gen_Newtype_binds"><a href="TcGenDeriv.html#gen_Newtype_binds"><span class="hs-identifier">gen_Newtype_binds</span></a></a><span> </span><a name="local-6989586621683241973"><a href="#local-6989586621683241973"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683241974"><a href="#local-6989586621683241974"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621683241975"><a href="#local-6989586621683241975"><span class="hs-identifier">inst_tvs</span></a></a><span> </span><a name="local-6989586621683241976"><a href="#local-6989586621683241976"><span class="hs-identifier">inst_tys</span></a></a><span> </span><a name="local-6989586621683241977"><a href="#local-6989586621683241977"><span class="hs-identifier">rhs_ty</span></a></a><span>
</span><a name="line-1835"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683242007"><a href="#local-6989586621683242007"><span class="hs-identifier">ats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">classATs</span><span> </span><a href="#local-6989586621683241974"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-1836"></a><span>       </span><a name="local-6989586621683242008"><a href="#local-6989586621683242008"><span class="hs-identifier">atf_insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">isDataFamilyTyCon</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">ats</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1837"></a><span>                    </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621683241979"><span class="hs-identifier hs-var">mk_atf_inst</span></a><span> </span><a href="#local-6989586621683242007"><span class="hs-identifier hs-var">ats</span></a><span>
</span><a name="line-1838"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683241978"><span class="hs-identifier hs-var">mk_bind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">classMethods</span><span> </span><a href="#local-6989586621683241974"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-1839"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="TcGenDeriv.html#DerivFamInst"><span class="hs-identifier hs-var">DerivFamInst</span></a><span> </span><a href="#local-6989586621683242008"><span class="hs-identifier hs-var">atf_insts</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1840"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1841"></a><span>    </span><span class="hs-identifier">mk_bind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1842"></a><span>    </span><a name="local-6989586621683241978"><a href="#local-6989586621683241978"><span class="hs-identifier">mk_bind</span></a></a><span> </span><a name="local-6989586621683241981"><a href="#local-6989586621683241981"><span class="hs-identifier">meth_id</span></a></a><span>
</span><a name="line-1843"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkRdrFunBind"><span class="hs-identifier hs-var">mkRdrFunBind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683241973"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683241986"><span class="hs-identifier hs-var">meth_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkSimpleMatch</span><span>
</span><a name="line-1844"></a><span>                                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkPrefixFunRhs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683241973"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683241986"><span class="hs-identifier hs-var">meth_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1845"></a><span>                                          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621683241987"><span class="hs-identifier hs-var">rhs_expr</span></a><span class="hs-special">]</span><span>
</span><a name="line-1846"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1847"></a><span>        </span><span class="hs-identifier hs-var">Pair</span><span> </span><a name="local-6989586621683241982"><a href="#local-6989586621683241982"><span class="hs-identifier">from_ty</span></a></a><span> </span><a name="local-6989586621683241983"><a href="#local-6989586621683241983"><span class="hs-identifier">to_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkCoerceClassMethEqn"><span class="hs-identifier hs-var">mkCoerceClassMethEqn</span></a><span> </span><a href="#local-6989586621683241974"><span class="hs-identifier hs-var">cls</span></a><span> </span><a href="#local-6989586621683241975"><span class="hs-identifier hs-var">inst_tvs</span></a><span> </span><a href="#local-6989586621683241976"><span class="hs-identifier hs-var">inst_tys</span></a><span> </span><a href="#local-6989586621683241977"><span class="hs-identifier hs-var">rhs_ty</span></a><span> </span><a href="#local-6989586621683241981"><span class="hs-identifier hs-var">meth_id</span></a><span>
</span><a name="line-1848"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683241984"><a href="#local-6989586621683241984"><span class="hs-identifier">from_tau</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tcSplitSigmaTy</span><span> </span><a href="#local-6989586621683241982"><span class="hs-identifier hs-var">from_ty</span></a><span>
</span><a name="line-1849"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683241985"><a href="#local-6989586621683241985"><span class="hs-identifier">to_tau</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tcSplitSigmaTy</span><span> </span><a href="#local-6989586621683241983"><span class="hs-identifier hs-var">to_ty</span></a><span>
</span><a name="line-1850"></a><span>
</span><a name="line-1851"></a><span>        </span><a name="local-6989586621683241986"><a href="#local-6989586621683241986"><span class="hs-identifier">meth_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><a href="#local-6989586621683241981"><span class="hs-identifier hs-var">meth_id</span></a><span>
</span><a name="line-1852"></a><span>
</span><a name="line-1853"></a><span>        </span><a name="local-6989586621683241987"><a href="#local-6989586621683241987"><span class="hs-identifier">rhs_expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">coerceId</span><span class="hs-special">)</span><span>
</span><a name="line-1854"></a><span>                                      </span><span class="hs-special">`</span><a href="TcGenDeriv.html#nlHsAppType"><span class="hs-identifier hs-var">nlHsAppType</span></a><span class="hs-special">`</span><span>     </span><a href="#local-6989586621683241984"><span class="hs-identifier hs-var">from_tau</span></a><span>
</span><a name="line-1855"></a><span>                                      </span><span class="hs-special">`</span><a href="TcGenDeriv.html#nlHsAppType"><span class="hs-identifier hs-var">nlHsAppType</span></a><span class="hs-special">`</span><span>     </span><a href="#local-6989586621683241985"><span class="hs-identifier hs-var">to_tau</span></a><span>
</span><a name="line-1856"></a><span>                                      </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApp</span><span class="hs-special">`</span><span>         </span><a href="#local-6989586621683241988"><span class="hs-identifier hs-var">meth_app</span></a><span>
</span><a name="line-1857"></a><span>                                      </span><span class="hs-special">`</span><a href="TcGenDeriv.html#nlExprWithTySig"><span class="hs-identifier hs-var">nlExprWithTySig</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621683241983"><span class="hs-identifier hs-var">to_ty</span></a><span>
</span><a name="line-1858"></a><span>
</span><a name="line-1859"></a><span>        </span><span class="hs-comment">-- The class method, applied to all of the class instance types</span><span>
</span><a name="line-1860"></a><span>        </span><span class="hs-comment">-- (including the representation type) to avoid potential ambiguity.</span><span>
</span><a name="line-1861"></a><span>        </span><span class="hs-comment">-- See Note [GND and ambiguity]</span><span>
</span><a name="line-1862"></a><span>        </span><a name="local-6989586621683241988"><a href="#local-6989586621683241988"><span class="hs-identifier">meth_app</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="TcGenDeriv.html#nlHsAppType"><span class="hs-identifier hs-var">nlHsAppType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683241986"><span class="hs-identifier hs-var">meth_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1863"></a><span>                   </span><span class="hs-identifier hs-var">filterOutInferredTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621683241974"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683241980"><span class="hs-identifier hs-var">underlying_inst_tys</span></a><span>
</span><a name="line-1864"></a><span>                     </span><span class="hs-comment">-- Filter out any inferred arguments, since they can't be</span><span>
</span><a name="line-1865"></a><span>                     </span><span class="hs-comment">-- applied with visible type application.</span><span>
</span><a name="line-1866"></a><span>
</span><a name="line-1867"></a><span>    </span><span class="hs-identifier">mk_atf_inst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">FamInst</span><span>
</span><a name="line-1868"></a><span>    </span><a name="local-6989586621683241979"><a href="#local-6989586621683241979"><span class="hs-identifier">mk_atf_inst</span></a></a><span> </span><a name="local-6989586621683241989"><a href="#local-6989586621683241989"><span class="hs-identifier">fam_tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1869"></a><span>        </span><a name="local-6989586621683242005"><a href="#local-6989586621683242005"><span class="hs-identifier">rep_tc_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#newFamInstTyConName"><span class="hs-identifier hs-var">newFamInstTyConName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683241973"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621683241989"><span class="hs-identifier hs-var">fam_tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1870"></a><span>                                           </span><a href="#local-6989586621683241997"><span class="hs-identifier hs-var">rep_lhs_tys</span></a><span>
</span><a name="line-1871"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683242006"><a href="#local-6989586621683242006"><span class="hs-identifier">axiom</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkSingleCoAxiom</span><span> </span><span class="hs-identifier hs-var">Nominal</span><span> </span><a href="#local-6989586621683242005"><span class="hs-identifier hs-var">rep_tc_name</span></a><span> </span><a href="#local-6989586621683242003"><span class="hs-identifier hs-var">rep_tvs'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621683242004"><span class="hs-identifier hs-var">rep_cvs'</span></a><span>
</span><a name="line-1872"></a><span>                                    </span><a href="#local-6989586621683241989"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-6989586621683241997"><span class="hs-identifier hs-var">rep_lhs_tys</span></a><span> </span><a href="#local-6989586621683241999"><span class="hs-identifier hs-var">rep_rhs_ty</span></a><span>
</span><a name="line-1873"></a><span>        </span><span class="hs-comment">-- Check (c) from Note [GND and associated type families] in TcDeriv</span><span>
</span><a name="line-1874"></a><span>        </span><a href="TcValidity.html#checkValidCoAxBranch"><span class="hs-identifier hs-var">checkValidCoAxBranch</span></a><span> </span><a href="#local-6989586621683241989"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coAxiomSingleBranch</span><span> </span><a href="#local-6989586621683242006"><span class="hs-identifier hs-var">axiom</span></a><span class="hs-special">)</span><span>
</span><a name="line-1875"></a><span>        </span><a href="FamInst.html#newFamInst"><span class="hs-identifier hs-var">newFamInst</span></a><span> </span><span class="hs-identifier hs-var">SynFamilyInst</span><span> </span><a href="#local-6989586621683242006"><span class="hs-identifier hs-var">axiom</span></a><span>
</span><a name="line-1876"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1877"></a><span>        </span><a name="local-6989586621683241990"><a href="#local-6989586621683241990"><span class="hs-identifier">cls_tvs</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classTyVars</span><span> </span><a href="#local-6989586621683241974"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-1878"></a><span>        </span><a name="local-6989586621683241991"><a href="#local-6989586621683241991"><span class="hs-identifier">in_scope</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInScopeSet</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkVarSet</span><span> </span><a href="#local-6989586621683241975"><span class="hs-identifier hs-var">inst_tvs</span></a><span>
</span><a name="line-1879"></a><span>        </span><a name="local-6989586621683241992"><a href="#local-6989586621683241992"><span class="hs-identifier">lhs_env</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipTyEnv</span><span> </span><a href="#local-6989586621683241990"><span class="hs-identifier hs-var">cls_tvs</span></a><span> </span><a href="#local-6989586621683241976"><span class="hs-identifier hs-var">inst_tys</span></a><span>
</span><a name="line-1880"></a><span>        </span><a name="local-6989586621683241993"><a href="#local-6989586621683241993"><span class="hs-identifier">lhs_subst</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTvSubst</span><span> </span><a href="#local-6989586621683241991"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621683241992"><span class="hs-identifier hs-var">lhs_env</span></a><span>
</span><a name="line-1881"></a><span>        </span><a name="local-6989586621683241994"><a href="#local-6989586621683241994"><span class="hs-identifier">rhs_env</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipTyEnv</span><span> </span><a href="#local-6989586621683241990"><span class="hs-identifier hs-var">cls_tvs</span></a><span> </span><a href="#local-6989586621683241980"><span class="hs-identifier hs-var">underlying_inst_tys</span></a><span>
</span><a name="line-1882"></a><span>        </span><a name="local-6989586621683241995"><a href="#local-6989586621683241995"><span class="hs-identifier">rhs_subst</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTvSubst</span><span> </span><a href="#local-6989586621683241991"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621683241994"><span class="hs-identifier hs-var">rhs_env</span></a><span>
</span><a name="line-1883"></a><span>        </span><a name="local-6989586621683241996"><a href="#local-6989586621683241996"><span class="hs-identifier">fam_tvs</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621683241989"><span class="hs-identifier hs-var">fam_tc</span></a><span>
</span><a name="line-1884"></a><span>        </span><a name="local-6989586621683241997"><a href="#local-6989586621683241997"><span class="hs-identifier">rep_lhs_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTyVars</span><span> </span><a href="#local-6989586621683241993"><span class="hs-identifier hs-var">lhs_subst</span></a><span> </span><a href="#local-6989586621683241996"><span class="hs-identifier hs-var">fam_tvs</span></a><span>
</span><a name="line-1885"></a><span>        </span><a name="local-6989586621683241998"><a href="#local-6989586621683241998"><span class="hs-identifier">rep_rhs_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTyVars</span><span> </span><a href="#local-6989586621683241995"><span class="hs-identifier hs-var">rhs_subst</span></a><span> </span><a href="#local-6989586621683241996"><span class="hs-identifier hs-var">fam_tvs</span></a><span>
</span><a name="line-1886"></a><span>        </span><a name="local-6989586621683241999"><a href="#local-6989586621683241999"><span class="hs-identifier">rep_rhs_ty</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621683241989"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-6989586621683241998"><span class="hs-identifier hs-var">rep_rhs_tys</span></a><span>
</span><a name="line-1887"></a><span>        </span><a name="local-6989586621683242000"><a href="#local-6989586621683242000"><span class="hs-identifier">rep_tcvs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyCoVarsOfTypesList</span><span> </span><a href="#local-6989586621683241997"><span class="hs-identifier hs-var">rep_lhs_tys</span></a><span>
</span><a name="line-1888"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621683242001"><a href="#local-6989586621683242001"><span class="hs-identifier">rep_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683242002"><a href="#local-6989586621683242002"><span class="hs-identifier">rep_cvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-identifier hs-var">isTyVar</span><span> </span><a href="#local-6989586621683242000"><span class="hs-identifier hs-var">rep_tcvs</span></a><span>
</span><a name="line-1889"></a><span>        </span><a name="local-6989586621683242003"><a href="#local-6989586621683242003"><span class="hs-identifier">rep_tvs'</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">scopedSort</span><span> </span><a href="#local-6989586621683242001"><span class="hs-identifier hs-var">rep_tvs</span></a><span>
</span><a name="line-1890"></a><span>        </span><a name="local-6989586621683242004"><a href="#local-6989586621683242004"><span class="hs-identifier">rep_cvs'</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">scopedSort</span><span> </span><a href="#local-6989586621683242002"><span class="hs-identifier hs-var">rep_cvs</span></a><span>
</span><a name="line-1891"></a><span>
</span><a name="line-1892"></a><span>    </span><span class="hs-comment">-- Same as inst_tys, but with the last argument type replaced by the</span><span>
</span><a name="line-1893"></a><span>    </span><span class="hs-comment">-- representation type.</span><span>
</span><a name="line-1894"></a><span>    </span><span class="hs-identifier">underlying_inst_tys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-1895"></a><span>    </span><a name="local-6989586621683241980"><a href="#local-6989586621683241980"><span class="hs-identifier">underlying_inst_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">changeLast</span><span> </span><a href="#local-6989586621683241976"><span class="hs-identifier hs-var">inst_tys</span></a><span> </span><a href="#local-6989586621683241977"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-1896"></a><span>
</span><a name="line-1897"></a><span class="hs-identifier">nlHsAppType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1898"></a><a name="nlHsAppType"><a href="TcGenDeriv.html#nlHsAppType"><span class="hs-identifier">nlHsAppType</span></a></a><span> </span><a name="local-6989586621683242009"><a href="#local-6989586621683242009"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621683242010"><a href="#local-6989586621683242010"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsAppType</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621683242009"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621683242011"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1899"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1900"></a><span>    </span><a name="local-6989586621683242011"><a href="#local-6989586621683242011"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsWildCardBndrs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">parenthesizeHsType</span><span> </span><span class="hs-identifier hs-var">appPrec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeToLHsType</span><span> </span><a href="#local-6989586621683242010"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1901"></a><span>
</span><a name="line-1902"></a><span class="hs-identifier">nlExprWithTySig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-1903"></a><a name="nlExprWithTySig"><a href="TcGenDeriv.html#nlExprWithTySig"><span class="hs-identifier">nlExprWithTySig</span></a></a><span> </span><a name="local-6989586621683242012"><a href="#local-6989586621683242012"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621683242013"><a href="#local-6989586621683242013"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ExprWithTySig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">parenthesizeHsExpr</span><span> </span><span class="hs-identifier hs-var">sigPrec</span><span> </span><a href="#local-6989586621683242012"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242014"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-1904"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1905"></a><span>    </span><a name="local-6989586621683242014"><a href="#local-6989586621683242014"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLHsSigWcType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeToLHsType</span><span> </span><a href="#local-6989586621683242013"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1906"></a><span>
</span><a name="line-1907"></a><span class="hs-identifier">mkCoerceClassMethEqn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Class</span><span>   </span><span class="hs-comment">-- the class being derived</span><span>
</span><a name="line-1908"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- the tvs in the instance head (this includes</span><span>
</span><a name="line-1909"></a><span>                                </span><span class="hs-comment">-- the tvs from both the class types and the</span><span>
</span><a name="line-1910"></a><span>                                </span><span class="hs-comment">-- newtype itself)</span><span>
</span><a name="line-1911"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- instance head parameters (incl. newtype)</span><span>
</span><a name="line-1912"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>    </span><span class="hs-comment">-- the representation type</span><span>
</span><a name="line-1913"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Id</span><span>      </span><span class="hs-comment">-- the method to look at</span><span>
</span><a name="line-1914"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pair</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-1915"></a><span class="hs-comment">-- See Note [Newtype-deriving instances]</span><span>
</span><a name="line-1916"></a><span class="hs-comment">-- See also Note [Newtype-deriving trickiness]</span><span>
</span><a name="line-1917"></a><span class="hs-comment">-- The pair is the (from_type, to_type), where to_type is</span><span>
</span><a name="line-1918"></a><span class="hs-comment">-- the type of the method we are trying to get</span><span>
</span><a name="line-1919"></a><a name="mkCoerceClassMethEqn"><a href="TcGenDeriv.html#mkCoerceClassMethEqn"><span class="hs-identifier">mkCoerceClassMethEqn</span></a></a><span> </span><a name="local-6989586621683242015"><a href="#local-6989586621683242015"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621683242016"><a href="#local-6989586621683242016"><span class="hs-identifier">inst_tvs</span></a></a><span> </span><a name="local-6989586621683242017"><a href="#local-6989586621683242017"><span class="hs-identifier">inst_tys</span></a></a><span> </span><a name="local-6989586621683242018"><a href="#local-6989586621683242018"><span class="hs-identifier">rhs_ty</span></a></a><span> </span><a name="local-6989586621683242019"><a href="#local-6989586621683242019"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-1920"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Pair</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">substTy</span><span> </span><a href="#local-6989586621683242023"><span class="hs-identifier hs-var">rhs_subst</span></a><span> </span><a href="#local-6989586621683242026"><span class="hs-identifier hs-var">user_meth_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1921"></a><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">substTy</span><span> </span><a href="#local-6989586621683242022"><span class="hs-identifier hs-var">lhs_subst</span></a><span> </span><a href="#local-6989586621683242026"><span class="hs-identifier hs-var">user_meth_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1922"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1923"></a><span>    </span><a name="local-6989586621683242020"><a href="#local-6989586621683242020"><span class="hs-identifier">cls_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classTyVars</span><span> </span><a href="#local-6989586621683242015"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-1924"></a><span>    </span><a name="local-6989586621683242021"><a href="#local-6989586621683242021"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInScopeSet</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkVarSet</span><span> </span><a href="#local-6989586621683242016"><span class="hs-identifier hs-var">inst_tvs</span></a><span>
</span><a name="line-1925"></a><span>    </span><a name="local-6989586621683242022"><a href="#local-6989586621683242022"><span class="hs-identifier">lhs_subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTvSubst</span><span> </span><a href="#local-6989586621683242021"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipTyEnv</span><span> </span><a href="#local-6989586621683242020"><span class="hs-identifier hs-var">cls_tvs</span></a><span> </span><a href="#local-6989586621683242017"><span class="hs-identifier hs-var">inst_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1926"></a><span>    </span><a name="local-6989586621683242023"><a href="#local-6989586621683242023"><span class="hs-identifier">rhs_subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTvSubst</span><span> </span><a href="#local-6989586621683242021"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipTyEnv</span><span> </span><a href="#local-6989586621683242020"><span class="hs-identifier hs-var">cls_tvs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">changeLast</span><span> </span><a href="#local-6989586621683242017"><span class="hs-identifier hs-var">inst_tys</span></a><span> </span><a href="#local-6989586621683242018"><span class="hs-identifier hs-var">rhs_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1927"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683242024"><a href="#local-6989586621683242024"><span class="hs-identifier">_class_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683242025"><a href="#local-6989586621683242025"><span class="hs-identifier">_class_constraint</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683242026"><a href="#local-6989586621683242026"><span class="hs-identifier">user_meth_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1928"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tcSplitMethodTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621683242019"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1929"></a><span>
</span><a name="line-1930"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Generating extra binds (@con2tag@ and @tag2con@)}
*                                                                      *
************************************************************************

\begin{verbatim}
data Foo ... = ...

con2tag_Foo :: Foo ... -&gt; Int#
tag2con_Foo :: Int -&gt; Foo ...   -- easier if Int, not Int#
maxtag_Foo  :: Int              -- ditto (NB: not unlifted)
\end{verbatim}

The `tags' here start at zero, hence the @fIRST_TAG@ (currently one)
fiddling around.
-}</span><span>
</span><a name="line-1948"></a><span>
</span><a name="line-1949"></a><span class="hs-identifier">genAuxBindSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#AuxBindSpec"><span class="hs-identifier hs-type">AuxBindSpec</span></a><span>
</span><a name="line-1950"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-1951"></a><a name="genAuxBindSpec"><a href="TcGenDeriv.html#genAuxBindSpec"><span class="hs-identifier">genAuxBindSpec</span></a></a><span> </span><a name="local-6989586621683242027"><a href="#local-6989586621683242027"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242028"><a href="#local-6989586621683242028"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivCon2Tag"><span class="hs-identifier hs-var">DerivCon2Tag</span></a><span> </span><a name="local-6989586621683242029"><a href="#local-6989586621683242029"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1952"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#mkFunBindSE"><span class="hs-identifier hs-var">mkFunBindSE</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621683242028"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242030"><span class="hs-identifier hs-var">rdr_name</span></a><span> </span><a href="#local-6989586621683242033"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">,</span><span>
</span><a name="line-1953"></a><span>     </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242028"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242028"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242030"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621683242031"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1954"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1955"></a><span>    </span><a name="local-6989586621683242030"><a href="#local-6989586621683242030"><span class="hs-identifier">rdr_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#con2tag_RDR"><span class="hs-identifier hs-var">con2tag_RDR</span></a><span> </span><a href="#local-6989586621683242027"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242029"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1956"></a><span>
</span><a name="line-1957"></a><span>    </span><a name="local-6989586621683242031"><a href="#local-6989586621683242031"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLHsSigWcType</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242028"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">XHsType</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">NHsCoreTy</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1958"></a><span>             </span><span class="hs-identifier hs-var">mkSpecSigmaTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621683242029"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConStupidTheta</span><span> </span><a href="#local-6989586621683242029"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1959"></a><span>             </span><a href="TcGenDeriv.html#mkParentType"><span class="hs-identifier hs-var">mkParentType</span></a><span> </span><a href="#local-6989586621683242029"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mkFunTy</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">intPrimTy</span><span>
</span><a name="line-1960"></a><span>
</span><a name="line-1961"></a><span>    </span><a name="local-6989586621683242032"><a href="#local-6989586621683242032"><span class="hs-identifier">lots_of_constructors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConFamilySize</span><span> </span><a href="#local-6989586621683242029"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-1962"></a><span>                        </span><span class="hs-comment">-- was: mAX_FAMILY_SIZE_FOR_VEC_RETURNS</span><span>
</span><a name="line-1963"></a><span>                        </span><span class="hs-comment">-- but we don't do vectored returns any more.</span><span>
</span><a name="line-1964"></a><span>
</span><a name="line-1965"></a><span>    </span><a name="local-6989586621683242033"><a href="#local-6989586621683242033"><span class="hs-identifier">eqns</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683242032"><span class="hs-identifier hs-var">lots_of_constructors</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683242034"><span class="hs-identifier hs-var">get_tag_eqn</span></a><span class="hs-special">]</span><span>
</span><a name="line-1966"></a><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683242035"><span class="hs-identifier hs-var">mk_eqn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683242029"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1967"></a><span>
</span><a name="line-1968"></a><span>    </span><a name="local-6989586621683242034"><a href="#local-6989586621683242034"><span class="hs-identifier">get_tag_eqn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">getTag_RDR</span><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#a_Expr"><span class="hs-identifier hs-var">a_Expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1969"></a><span>
</span><a name="line-1970"></a><span>    </span><span class="hs-identifier">mk_eqn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-1971"></a><span>    </span><a name="local-6989586621683242035"><a href="#local-6989586621683242035"><span class="hs-identifier">mk_eqn</span></a></a><span> </span><a name="local-6989586621683242036"><a href="#local-6989586621683242036"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlWildConPat</span><span> </span><a href="#local-6989586621683242036"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1972"></a><span>                  </span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntPrim</span><span> </span><span class="hs-identifier hs-var">NoSourceText</span><span>
</span><a name="line-1973"></a><span>                                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConTag</span><span> </span><a href="#local-6989586621683242036"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">fIRST_TAG</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1974"></a><span>
</span><a name="line-1975"></a><span class="hs-identifier">genAuxBindSpec</span><span> </span><a name="local-6989586621683242037"><a href="#local-6989586621683242037"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242038"><a href="#local-6989586621683242038"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivTag2Con"><span class="hs-identifier hs-var">DerivTag2Con</span></a><span> </span><a name="local-6989586621683242039"><a href="#local-6989586621683242039"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1976"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#mkFunBindSE"><span class="hs-identifier hs-var">mkFunBindSE</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621683242038"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242041"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-1977"></a><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">nlConVarPat</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1978"></a><span>           </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#tagToEnum_RDR"><span class="hs-identifier hs-var">tagToEnum_RDR</span></a><span class="hs-special">)</span><span> </span><a href="TcGenDeriv.html#a_Expr"><span class="hs-identifier hs-var">a_Expr</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1979"></a><span>     </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242038"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242038"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242041"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621683242040"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1980"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1981"></a><span>    </span><a name="local-6989586621683242040"><a href="#local-6989586621683242040"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLHsSigWcType</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242038"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1982"></a><span>             </span><span class="hs-identifier hs-var">XHsType</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">NHsCoreTy</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkSpecForAllTys</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621683242039"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1983"></a><span>             </span><span class="hs-identifier hs-var">intTy</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mkFunTy</span><span class="hs-special">`</span><span> </span><a href="TcGenDeriv.html#mkParentType"><span class="hs-identifier hs-var">mkParentType</span></a><span> </span><a href="#local-6989586621683242039"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1984"></a><span>
</span><a name="line-1985"></a><span>    </span><a name="local-6989586621683242041"><a href="#local-6989586621683242041"><span class="hs-identifier">rdr_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#tag2con_RDR"><span class="hs-identifier hs-var">tag2con_RDR</span></a><span> </span><a href="#local-6989586621683242037"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242039"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1986"></a><span>
</span><a name="line-1987"></a><span class="hs-identifier">genAuxBindSpec</span><span> </span><a name="local-6989586621683242042"><a href="#local-6989586621683242042"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242043"><a href="#local-6989586621683242043"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivMaxTag"><span class="hs-identifier hs-var">DerivMaxTag</span></a><span> </span><a name="local-6989586621683242044"><a href="#local-6989586621683242044"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1988"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsVarBind</span><span> </span><a href="#local-6989586621683242043"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242045"><span class="hs-identifier hs-var">rdr_name</span></a><span> </span><a href="#local-6989586621683242047"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1989"></a><span>     </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242043"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242043"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242045"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621683242046"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1990"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1991"></a><span>    </span><a name="local-6989586621683242045"><a href="#local-6989586621683242045"><span class="hs-identifier">rdr_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#maxtag_RDR"><span class="hs-identifier hs-var">maxtag_RDR</span></a><span> </span><a href="#local-6989586621683242042"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242044"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1992"></a><span>    </span><a name="local-6989586621683242046"><a href="#local-6989586621683242046"><span class="hs-identifier">sig_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLHsSigWcType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242043"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NHsCoreTy</span><span> </span><span class="hs-identifier hs-var">intTy</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1993"></a><span>    </span><a name="local-6989586621683242047"><a href="#local-6989586621683242047"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">intDataCon_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-1994"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntPrim</span><span> </span><span class="hs-identifier hs-var">NoSourceText</span><span> </span><a href="#local-6989586621683242048"><span class="hs-identifier hs-var">max_tag</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1995"></a><span>    </span><a name="local-6989586621683242048"><a href="#local-6989586621683242048"><span class="hs-identifier">max_tag</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683242044"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1996"></a><span>                 </span><a name="local-6989586621683242049"><a href="#local-6989586621683242049"><span class="hs-identifier">data_cons</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621683242049"><span class="hs-identifier hs-var">data_cons</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">fIRST_TAG</span><span class="hs-special">)</span><span>
</span><a name="line-1997"></a><span>
</span><a name="line-1998"></a><span class="hs-keyword">type</span><span> </span><a name="SeparateBagsDerivStuff"><a href="TcGenDeriv.html#SeparateBagsDerivStuff"><span class="hs-identifier">SeparateBagsDerivStuff</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1999"></a><span>  </span><span class="hs-comment">-- AuxBinds and SYB bindings</span><span>
</span><a name="line-2000"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-2001"></a><span>  </span><span class="hs-comment">-- Extra family instances (used by Generic and DeriveAnyClass)</span><span>
</span><a name="line-2002"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FamInst</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2003"></a><span>
</span><a name="line-2004"></a><span class="hs-identifier">genAuxBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#SeparateBagsDerivStuff"><span class="hs-identifier hs-type">SeparateBagsDerivStuff</span></a><span>
</span><a name="line-2005"></a><a name="genAuxBinds"><a href="TcGenDeriv.html#genAuxBinds"><span class="hs-identifier">genAuxBinds</span></a></a><span> </span><a name="local-6989586621683242050"><a href="#local-6989586621683242050"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242051"><a href="#local-6989586621683242051"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683242052"><a href="#local-6989586621683242052"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683242058"><span class="hs-identifier hs-var">genAuxBinds'</span></a><span> </span><a href="#local-6989586621683242054"><span class="hs-identifier hs-var">b2</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2006"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621683242053"><a href="#local-6989586621683242053"><span class="hs-identifier">b1</span></a></a><span class="hs-special">,</span><a name="local-6989586621683242054"><a href="#local-6989586621683242054"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partitionBagWith</span><span> </span><a href="#local-6989586621683242055"><span class="hs-identifier hs-var">splitDerivAuxBind</span></a><span> </span><a href="#local-6989586621683242052"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2007"></a><span>  </span><a name="local-6989586621683242055"><a href="#local-6989586621683242055"><span class="hs-identifier">splitDerivAuxBind</span></a></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivAuxBind"><span class="hs-identifier hs-var">DerivAuxBind</span></a><span> </span><a name="local-6989586621683242062"><a href="#local-6989586621683242062"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621683242062"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2008"></a><span>  </span><span class="hs-identifier">splitDerivAuxBind</span><span>  </span><a name="local-6989586621683242063"><a href="#local-6989586621683242063"><span class="hs-identifier">x</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621683242063"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2009"></a><span>
</span><a name="line-2010"></a><span>  </span><a name="local-6989586621683242056"><a href="#local-6989586621683242056"><span class="hs-identifier">rm_dups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldrBag</span><span> </span><a href="#local-6989586621683242057"><span class="hs-identifier hs-var">dup_check</span></a><span> </span><span class="hs-identifier hs-var">emptyBag</span><span>
</span><a name="line-2011"></a><span>  </span><a name="local-6989586621683242057"><a href="#local-6989586621683242057"><span class="hs-identifier">dup_check</span></a></a><span> </span><a name="local-6989586621683242064"><a href="#local-6989586621683242064"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683242065"><a href="#local-6989586621683242065"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">anyBag</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621683242064"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242065"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621683242065"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">consBag</span><span> </span><a href="#local-6989586621683242064"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621683242065"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2012"></a><span>
</span><a name="line-2013"></a><span>  </span><span class="hs-identifier">genAuxBinds'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#BagDerivStuff"><span class="hs-identifier hs-type">BagDerivStuff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#SeparateBagsDerivStuff"><span class="hs-identifier hs-type">SeparateBagsDerivStuff</span></a><span>
</span><a name="line-2014"></a><span>  </span><a name="local-6989586621683242058"><a href="#local-6989586621683242058"><span class="hs-identifier">genAuxBinds'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldrBag</span><span> </span><a href="#local-6989586621683242059"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">mapBag</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#genAuxBindSpec"><span class="hs-identifier hs-var">genAuxBindSpec</span></a><span> </span><a href="#local-6989586621683242050"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242051"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683242056"><span class="hs-identifier hs-var">rm_dups</span></a><span> </span><a href="#local-6989586621683242053"><span class="hs-identifier hs-var">b1</span></a><span class="hs-special">)</span><span>
</span><a name="line-2015"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2016"></a><span>  </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcGenDeriv.html#DerivStuff"><span class="hs-identifier hs-type">DerivStuff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#SeparateBagsDerivStuff"><span class="hs-identifier hs-type">SeparateBagsDerivStuff</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcGenDeriv.html#SeparateBagsDerivStuff"><span class="hs-identifier hs-type">SeparateBagsDerivStuff</span></a><span>
</span><a name="line-2017"></a><span>  </span><a name="local-6989586621683242059"><a href="#local-6989586621683242059"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivAuxBind"><span class="hs-identifier hs-var">DerivAuxBind</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genAuxBinds'&quot;</span><span> </span><span class="hs-comment">-- We have removed these before</span><span>
</span><a name="line-2018"></a><span>  </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivHsBind"><span class="hs-identifier hs-var">DerivHsBind</span></a><span>  </span><a name="local-6989586621683242066"><a href="#local-6989586621683242066"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683242060"><span class="hs-identifier hs-var">add1</span></a><span> </span><a href="#local-6989586621683242066"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2019"></a><span>  </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#DerivFamInst"><span class="hs-identifier hs-var">DerivFamInst</span></a><span> </span><a name="local-6989586621683242067"><a href="#local-6989586621683242067"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683242061"><span class="hs-identifier hs-var">add2</span></a><span> </span><a href="#local-6989586621683242067"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2020"></a><span>
</span><a name="line-2021"></a><span>  </span><a name="local-6989586621683242060"><a href="#local-6989586621683242060"><span class="hs-identifier">add1</span></a></a><span> </span><a name="local-6989586621683242068"><a href="#local-6989586621683242068"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683242069"><a href="#local-6989586621683242069"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621683242070"><a href="#local-6989586621683242070"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683242068"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">consBag</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683242069"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621683242070"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-2022"></a><span>  </span><a name="local-6989586621683242061"><a href="#local-6989586621683242061"><span class="hs-identifier">add2</span></a></a><span> </span><a name="local-6989586621683242071"><a href="#local-6989586621683242071"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683242072"><a href="#local-6989586621683242072"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621683242073"><a href="#local-6989586621683242073"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683242072"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621683242071"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">consBag</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683242073"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-2023"></a><span>
</span><a name="line-2024"></a><span class="hs-identifier">mkParentType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-2025"></a><span class="hs-comment">-- Turn the representation tycon of a family into</span><span>
</span><a name="line-2026"></a><span class="hs-comment">-- a use of its family constructor</span><span>
</span><a name="line-2027"></a><a name="mkParentType"><a href="TcGenDeriv.html#mkParentType"><span class="hs-identifier">mkParentType</span></a></a><span> </span><a name="local-6989586621683242074"><a href="#local-6989586621683242074"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-2028"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tyConFamInst_maybe</span><span> </span><a href="#local-6989586621683242074"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2029"></a><span>       </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621683242074"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarTys</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621683242074"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2030"></a><span>       </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683242075"><a href="#local-6989586621683242075"><span class="hs-identifier">fam_tc</span></a></a><span class="hs-special">,</span><a name="local-6989586621683242076"><a href="#local-6989586621683242076"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkTyConApp</span><span> </span><a href="#local-6989586621683242075"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><a href="#local-6989586621683242076"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2031"></a><span>
</span><a name="line-2032"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Utility bits for generating bindings}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2039"></a><span>
</span><a name="line-2040"></a><span class="hs-comment">-- | Make a function binding. If no equations are given, produce a function</span><span>
</span><a name="line-2041"></a><span class="hs-comment">-- with the given arity that produces a stock error.</span><span>
</span><a name="line-2042"></a><span class="hs-identifier">mkFunBindSE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-2043"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2044"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2045"></a><a name="mkFunBindSE"><a href="TcGenDeriv.html#mkFunBindSE"><span class="hs-identifier">mkFunBindSE</span></a></a><span> </span><a name="local-6989586621683242077"><a href="#local-6989586621683242077"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621683242078"><a href="#local-6989586621683242078"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683242079"><a href="#local-6989586621683242079"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621683242080"><a href="#local-6989586621683242080"><span class="hs-identifier">pats_and_exprs</span></a></a><span>
</span><a name="line-2046"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkRdrFunBindSE"><span class="hs-identifier hs-var">mkRdrFunBindSE</span></a><span> </span><a href="#local-6989586621683242077"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242078"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242079"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242081"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-2047"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2048"></a><span>    </span><a name="local-6989586621683242081"><a href="#local-6989586621683242081"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkMatch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkPrefixFunRhs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242078"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242079"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2049"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">parenthesizePat</span><span> </span><span class="hs-identifier hs-var">appPrec</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242082"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242083"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-2050"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-identifier hs-var">emptyLocalBinds</span><span class="hs-special">)</span><span>
</span><a name="line-2051"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683242082"><a href="#local-6989586621683242082"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621683242083"><a href="#local-6989586621683242083"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><a href="#local-6989586621683242080"><span class="hs-identifier hs-var">pats_and_exprs</span></a><span class="hs-special">]</span><span>
</span><a name="line-2052"></a><span>
</span><a name="line-2053"></a><span class="hs-identifier">mkRdrFunBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2054"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2055"></a><a name="mkRdrFunBind"><a href="TcGenDeriv.html#mkRdrFunBind"><span class="hs-identifier">mkRdrFunBind</span></a></a><span> </span><a name="local-6989586621683242084"><a href="#local-6989586621683242084"><span class="hs-identifier">fun</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621683242085"><a href="#local-6989586621683242085"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683242086"><a href="#local-6989586621683242086"><span class="hs-identifier">_fun_rdr</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683242087"><a href="#local-6989586621683242087"><span class="hs-identifier">matches</span></a></a><span>
</span><a name="line-2056"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242085"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkFunBind</span><span> </span><a href="#local-6989586621683242084"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621683242087"><span class="hs-identifier hs-var">matches</span></a><span class="hs-special">)</span><span>
</span><a name="line-2057"></a><span>
</span><a name="line-2058"></a><span class="hs-comment">-- | Make a function binding. If no equations are given, produce a function</span><span>
</span><a name="line-2059"></a><span class="hs-comment">-- with the given arity that uses an empty case expression for the last</span><span>
</span><a name="line-2060"></a><span class="hs-comment">-- argument that is passes to the given function to produce the right-hand</span><span>
</span><a name="line-2061"></a><span class="hs-comment">-- side.</span><span>
</span><a name="line-2062"></a><span class="hs-identifier">mkFunBindEC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-2063"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-2064"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2065"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2066"></a><a name="mkFunBindEC"><a href="TcGenDeriv.html#mkFunBindEC"><span class="hs-identifier">mkFunBindEC</span></a></a><span> </span><a name="local-6989586621683242088"><a href="#local-6989586621683242088"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621683242089"><a href="#local-6989586621683242089"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683242090"><a href="#local-6989586621683242090"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621683242091"><a href="#local-6989586621683242091"><span class="hs-identifier">catch_all</span></a></a><span> </span><a name="local-6989586621683242092"><a href="#local-6989586621683242092"><span class="hs-identifier">pats_and_exprs</span></a></a><span>
</span><a name="line-2067"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mkRdrFunBindEC"><span class="hs-identifier hs-var">mkRdrFunBindEC</span></a><span> </span><a href="#local-6989586621683242088"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-6989586621683242091"><span class="hs-identifier hs-var">catch_all</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242089"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242090"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242093"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-2068"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2069"></a><span>    </span><a name="local-6989586621683242093"><a href="#local-6989586621683242093"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">mkMatch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkPrefixFunRhs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242089"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621683242090"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2070"></a><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">parenthesizePat</span><span> </span><span class="hs-identifier hs-var">appPrec</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242094"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242095"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-2071"></a><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-identifier hs-var">emptyLocalBinds</span><span class="hs-special">)</span><span>
</span><a name="line-2072"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683242094"><a href="#local-6989586621683242094"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621683242095"><a href="#local-6989586621683242095"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683242092"><span class="hs-identifier hs-var">pats_and_exprs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2073"></a><span>
</span><a name="line-2074"></a><span class="hs-comment">-- | Produces a function binding. When no equations are given, it generates</span><span>
</span><a name="line-2075"></a><span class="hs-comment">-- a binding of the given arity and an empty case expression</span><span>
</span><a name="line-2076"></a><span class="hs-comment">-- for the last argument that it passes to the given function to produce</span><span>
</span><a name="line-2077"></a><span class="hs-comment">-- the right-hand side.</span><span>
</span><a name="line-2078"></a><span class="hs-identifier">mkRdrFunBindEC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arity</span><span>
</span><a name="line-2079"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-2080"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-2081"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2082"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2083"></a><a name="mkRdrFunBindEC"><a href="TcGenDeriv.html#mkRdrFunBindEC"><span class="hs-identifier">mkRdrFunBindEC</span></a></a><span> </span><a name="local-6989586621683242096"><a href="#local-6989586621683242096"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621683242097"><a href="#local-6989586621683242097"><span class="hs-identifier">catch_all</span></a></a><span>
</span><a name="line-2084"></a><span>                 </span><a name="local-6989586621683242098"><a href="#local-6989586621683242098"><span class="hs-identifier">fun</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621683242099"><a href="#local-6989586621683242099"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683242100"><a href="#local-6989586621683242100"><span class="hs-identifier">_fun_rdr</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683242101"><a href="#local-6989586621683242101"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242099"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkFunBind</span><span> </span><a href="#local-6989586621683242098"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621683242102"><span class="hs-identifier hs-var">matches'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2085"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2086"></a><span>   </span><span class="hs-comment">-- Catch-all eqn looks like</span><span>
</span><a name="line-2087"></a><span>   </span><span class="hs-comment">--     fmap _ z = case z of {}</span><span>
</span><a name="line-2088"></a><span>   </span><span class="hs-comment">-- or</span><span>
</span><a name="line-2089"></a><span>   </span><span class="hs-comment">--     traverse _ z = pure (case z of)</span><span>
</span><a name="line-2090"></a><span>   </span><span class="hs-comment">-- or</span><span>
</span><a name="line-2091"></a><span>   </span><span class="hs-comment">--     foldMap _ z = mempty</span><span>
</span><a name="line-2092"></a><span>   </span><span class="hs-comment">-- It's needed if there no data cons at all,</span><span>
</span><a name="line-2093"></a><span>   </span><span class="hs-comment">-- which can happen with -XEmptyDataDecls</span><span>
</span><a name="line-2094"></a><span>   </span><span class="hs-comment">-- See Trac #4302</span><span>
</span><a name="line-2095"></a><span>   </span><a name="local-6989586621683242102"><a href="#local-6989586621683242102"><span class="hs-identifier">matches'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683242101"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-2096"></a><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkMatch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkPrefixFunRhs</span><span> </span><a href="#local-6989586621683242098"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span>
</span><a name="line-2097"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683242096"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="TcGenDeriv.html#z_Pat"><span class="hs-identifier hs-var">z_Pat</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2098"></a><span>                            </span><span class="hs-special">(</span><a href="#local-6989586621683242097"><span class="hs-identifier hs-var">catch_all</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><a href="TcGenDeriv.html#z_Expr"><span class="hs-identifier hs-var">z_Expr</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2099"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-identifier hs-var">emptyLocalBinds</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2100"></a><span>              </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621683242101"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-2101"></a><span>
</span><a name="line-2102"></a><span class="hs-comment">-- | Produces a function binding. When there are no equations, it generates</span><span>
</span><a name="line-2103"></a><span class="hs-comment">-- a binding with the given arity that produces an error based on the name of</span><span>
</span><a name="line-2104"></a><span class="hs-comment">-- the type of the last argument.</span><span>
</span><a name="line-2105"></a><span class="hs-identifier">mkRdrFunBindSE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2106"></a><span>                    </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2107"></a><a name="mkRdrFunBindSE"><a href="TcGenDeriv.html#mkRdrFunBindSE"><span class="hs-identifier">mkRdrFunBindSE</span></a></a><span> </span><a name="local-6989586621683242103"><a href="#local-6989586621683242103"><span class="hs-identifier">arity</span></a></a><span>
</span><a name="line-2108"></a><span>                 </span><a name="local-6989586621683242104"><a href="#local-6989586621683242104"><span class="hs-identifier">fun</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621683242105"><a href="#local-6989586621683242105"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621683242106"><a href="#local-6989586621683242106"><span class="hs-identifier">fun_rdr</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683242107"><a href="#local-6989586621683242107"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621683242105"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkFunBind</span><span> </span><a href="#local-6989586621683242104"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621683242108"><span class="hs-identifier hs-var">matches'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2109"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2110"></a><span>   </span><span class="hs-comment">-- Catch-all eqn looks like</span><span>
</span><a name="line-2111"></a><span>   </span><span class="hs-comment">--     compare _ _ = error &quot;Void compare&quot;</span><span>
</span><a name="line-2112"></a><span>   </span><span class="hs-comment">-- It's needed if there no data cons at all,</span><span>
</span><a name="line-2113"></a><span>   </span><span class="hs-comment">-- which can happen with -XEmptyDataDecls</span><span>
</span><a name="line-2114"></a><span>   </span><span class="hs-comment">-- See Trac #4302</span><span>
</span><a name="line-2115"></a><span>   </span><a name="local-6989586621683242108"><a href="#local-6989586621683242108"><span class="hs-identifier">matches'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683242107"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-2116"></a><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkMatch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkPrefixFunRhs</span><span> </span><a href="#local-6989586621683242104"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span>
</span><a name="line-2117"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621683242103"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-identifier hs-var">nlWildPat</span><span class="hs-special">)</span><span>
</span><a name="line-2118"></a><span>                            </span><span class="hs-special">(</span><a href="TcGenDeriv.html#error_Expr"><span class="hs-identifier hs-var">error_Expr</span></a><span> </span><a href="#local-6989586621683242109"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-identifier hs-var">emptyLocalBinds</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2119"></a><span>              </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621683242107"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-2120"></a><span>   </span><a name="local-6989586621683242109"><a href="#local-6989586621683242109"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Void &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">occNameString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rdrNameOcc</span><span> </span><a href="#local-6989586621683242106"><span class="hs-identifier hs-var">fun_rdr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2121"></a><span>
</span><a name="line-2122"></a><span>
</span><a name="line-2123"></a><span class="hs-identifier">box</span><span> </span><span class="hs-glyph">::</span><span>         </span><span class="hs-identifier hs-type">String</span><span>           </span><span class="hs-comment">-- The class involved</span><span>
</span><a name="line-2124"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>    </span><span class="hs-comment">-- The argument</span><span>
</span><a name="line-2125"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>             </span><span class="hs-comment">-- The argument type</span><span>
</span><a name="line-2126"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>    </span><span class="hs-comment">-- Boxed version of the arg</span><span>
</span><a name="line-2127"></a><span class="hs-comment">-- See Note [Deriving and unboxed types] in TcDerivInfer</span><span>
</span><a name="line-2128"></a><a name="box"><a href="TcGenDeriv.html#box"><span class="hs-identifier">box</span></a></a><span> </span><a name="local-6989586621683242110"><a href="#local-6989586621683242110"><span class="hs-identifier">cls_str</span></a></a><span> </span><a name="local-6989586621683242111"><a href="#local-6989586621683242111"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621683242112"><a href="#local-6989586621683242112"><span class="hs-identifier">arg_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#assoc_ty_id"><span class="hs-identifier hs-var">assoc_ty_id</span></a><span> </span><a href="#local-6989586621683242110"><span class="hs-identifier hs-var">cls_str</span></a><span> </span><a href="TcGenDeriv.html#boxConTbl"><span class="hs-identifier hs-var">boxConTbl</span></a><span> </span><a href="#local-6989586621683242112"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-6989586621683242111"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2129"></a><span>
</span><a name="line-2130"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-2131"></a><span class="hs-identifier">primOrdOps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>    </span><span class="hs-comment">-- The class involved</span><span>
</span><a name="line-2132"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>      </span><span class="hs-comment">-- The type</span><span>
</span><a name="line-2133"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- (lt,le,eq,ge,gt)</span><span>
</span><a name="line-2134"></a><span class="hs-comment">-- See Note [Deriving and unboxed types] in TcDerivInfer</span><span>
</span><a name="line-2135"></a><a name="primOrdOps"><a href="TcGenDeriv.html#primOrdOps"><span class="hs-identifier">primOrdOps</span></a></a><span> </span><a name="local-6989586621683242113"><a href="#local-6989586621683242113"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621683242114"><a href="#local-6989586621683242114"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#assoc_ty_id"><span class="hs-identifier hs-var">assoc_ty_id</span></a><span> </span><a href="#local-6989586621683242113"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="TcGenDeriv.html#ordOpTbl"><span class="hs-identifier hs-var">ordOpTbl</span></a><span> </span><a href="#local-6989586621683242114"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2136"></a><span>
</span><a name="line-2137"></a><span class="hs-identifier">primLitOps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- The class involved</span><span>
</span><a name="line-2138"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>   </span><span class="hs-comment">-- The type</span><span>
</span><a name="line-2139"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-comment">-- Constructs a Q Exp value</span><span>
</span><a name="line-2140"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-comment">-- Constructs a boxed value</span><span>
</span><a name="line-2141"></a><span>              </span><span class="hs-special">)</span><span>
</span><a name="line-2142"></a><a name="primLitOps"><a href="TcGenDeriv.html#primLitOps"><span class="hs-identifier">primLitOps</span></a></a><span> </span><a name="local-6989586621683242115"><a href="#local-6989586621683242115"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621683242116"><a href="#local-6989586621683242116"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#assoc_ty_id"><span class="hs-identifier hs-var">assoc_ty_id</span></a><span> </span><a href="#local-6989586621683242115"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="TcGenDeriv.html#litConTbl"><span class="hs-identifier hs-var">litConTbl</span></a><span> </span><a href="#local-6989586621683242116"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621683242119"><a href="#local-6989586621683242119"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683242117"><span class="hs-identifier hs-var">boxed</span></a><span> </span><a href="#local-6989586621683242119"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-2143"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2144"></a><span>    </span><a name="local-6989586621683242117"><a href="#local-6989586621683242117"><span class="hs-identifier">boxed</span></a></a><span> </span><a name="local-6989586621683242118"><a href="#local-6989586621683242118"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-2145"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683242116"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">addrPrimTy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">unpackCString_RDR</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApp</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683242118"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-2146"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#assoc_ty_id"><span class="hs-identifier hs-var">assoc_ty_id</span></a><span> </span><a href="#local-6989586621683242115"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="TcGenDeriv.html#boxConTbl"><span class="hs-identifier hs-var">boxConTbl</span></a><span> </span><a href="#local-6989586621683242116"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621683242118"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-2147"></a><span>
</span><a name="line-2148"></a><span class="hs-identifier">ordOpTbl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2149"></a><a name="ordOpTbl"><a href="TcGenDeriv.html#ordOpTbl"><span class="hs-identifier">ordOpTbl</span></a></a><span>
</span><a name="line-2150"></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">charPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltChar_RDR"><span class="hs-identifier hs-var">ltChar_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leChar_RDR"><span class="hs-identifier hs-var">leChar_RDR</span></a><span>
</span><a name="line-2151"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqChar_RDR"><span class="hs-identifier hs-var">eqChar_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geChar_RDR"><span class="hs-identifier hs-var">geChar_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtChar_RDR"><span class="hs-identifier hs-var">gtChar_RDR</span></a><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2152"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">intPrimTy</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltInt_RDR"><span class="hs-identifier hs-var">ltInt_RDR</span></a><span>   </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leInt_RDR"><span class="hs-identifier hs-var">leInt_RDR</span></a><span>
</span><a name="line-2153"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqInt_RDR"><span class="hs-identifier hs-var">eqInt_RDR</span></a><span>   </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geInt_RDR"><span class="hs-identifier hs-var">geInt_RDR</span></a><span>   </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtInt_RDR"><span class="hs-identifier hs-var">gtInt_RDR</span></a><span>   </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2154"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">int8PrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltInt8_RDR"><span class="hs-identifier hs-var">ltInt8_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leInt8_RDR"><span class="hs-identifier hs-var">leInt8_RDR</span></a><span>
</span><a name="line-2155"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqInt8_RDR"><span class="hs-identifier hs-var">eqInt8_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geInt8_RDR"><span class="hs-identifier hs-var">geInt8_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtInt8_RDR"><span class="hs-identifier hs-var">gtInt8_RDR</span></a><span>   </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2156"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">int16PrimTy</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltInt16_RDR"><span class="hs-identifier hs-var">ltInt16_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leInt16_RDR"><span class="hs-identifier hs-var">leInt16_RDR</span></a><span>
</span><a name="line-2157"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqInt16_RDR"><span class="hs-identifier hs-var">eqInt16_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geInt16_RDR"><span class="hs-identifier hs-var">geInt16_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtInt16_RDR"><span class="hs-identifier hs-var">gtInt16_RDR</span></a><span>   </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2158"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltWord_RDR"><span class="hs-identifier hs-var">ltWord_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leWord_RDR"><span class="hs-identifier hs-var">leWord_RDR</span></a><span>
</span><a name="line-2159"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqWord_RDR"><span class="hs-identifier hs-var">eqWord_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geWord_RDR"><span class="hs-identifier hs-var">geWord_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtWord_RDR"><span class="hs-identifier hs-var">gtWord_RDR</span></a><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2160"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">word8PrimTy</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltWord8_RDR"><span class="hs-identifier hs-var">ltWord8_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leWord8_RDR"><span class="hs-identifier hs-var">leWord8_RDR</span></a><span>
</span><a name="line-2161"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqWord8_RDR"><span class="hs-identifier hs-var">eqWord8_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geWord8_RDR"><span class="hs-identifier hs-var">geWord8_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtWord8_RDR"><span class="hs-identifier hs-var">gtWord8_RDR</span></a><span>   </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2162"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">word16PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltWord16_RDR"><span class="hs-identifier hs-var">ltWord16_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leWord16_RDR"><span class="hs-identifier hs-var">leWord16_RDR</span></a><span>
</span><a name="line-2163"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqWord16_RDR"><span class="hs-identifier hs-var">eqWord16_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geWord16_RDR"><span class="hs-identifier hs-var">geWord16_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtWord16_RDR"><span class="hs-identifier hs-var">gtWord16_RDR</span></a><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2164"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">addrPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltAddr_RDR"><span class="hs-identifier hs-var">ltAddr_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leAddr_RDR"><span class="hs-identifier hs-var">leAddr_RDR</span></a><span>
</span><a name="line-2165"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqAddr_RDR"><span class="hs-identifier hs-var">eqAddr_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geAddr_RDR"><span class="hs-identifier hs-var">geAddr_RDR</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtAddr_RDR"><span class="hs-identifier hs-var">gtAddr_RDR</span></a><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2166"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">floatPrimTy</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltFloat_RDR"><span class="hs-identifier hs-var">ltFloat_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leFloat_RDR"><span class="hs-identifier hs-var">leFloat_RDR</span></a><span>
</span><a name="line-2167"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqFloat_RDR"><span class="hs-identifier hs-var">eqFloat_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geFloat_RDR"><span class="hs-identifier hs-var">geFloat_RDR</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtFloat_RDR"><span class="hs-identifier hs-var">gtFloat_RDR</span></a><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2168"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">doublePrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#ltDouble_RDR"><span class="hs-identifier hs-var">ltDouble_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#leDouble_RDR"><span class="hs-identifier hs-var">leDouble_RDR</span></a><span>
</span><a name="line-2169"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#eqDouble_RDR"><span class="hs-identifier hs-var">eqDouble_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#geDouble_RDR"><span class="hs-identifier hs-var">geDouble_RDR</span></a><span class="hs-special">,</span><span> </span><a href="TcGenDeriv.html#gtDouble_RDR"><span class="hs-identifier hs-var">gtDouble_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2170"></a><span>
</span><a name="line-2171"></a><span class="hs-comment">-- A mapping from a primitive type to a function that constructs its boxed</span><span>
</span><a name="line-2172"></a><span class="hs-comment">-- version.</span><span>
</span><a name="line-2173"></a><span class="hs-comment">-- NOTE: Int8#/Word8# will become Int/Word.</span><span>
</span><a name="line-2174"></a><span class="hs-identifier">boxConTbl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2175"></a><a name="boxConTbl"><a href="TcGenDeriv.html#boxConTbl"><span class="hs-identifier">boxConTbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2176"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">charPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">charDataCon</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2177"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">intPrimTy</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">intDataCon</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2178"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">wordDataCon</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2179"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">floatPrimTy</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">floatDataCon</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2180"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">doublePrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">doubleDataCon</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2181"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int8PrimTy</span><span class="hs-special">,</span><span>
</span><a name="line-2182"></a><span>        </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">intDataCon</span><span class="hs-special">)</span><span>
</span><a name="line-2183"></a><span>        </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#extendInt8_RDR"><span class="hs-identifier hs-var">extendInt8_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2184"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">word8PrimTy</span><span class="hs-special">,</span><span>
</span><a name="line-2185"></a><span>        </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">wordDataCon</span><span class="hs-special">)</span><span>
</span><a name="line-2186"></a><span>        </span><span class="hs-operator hs-var">.</span><span>  </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#extendWord8_RDR"><span class="hs-identifier hs-var">extendWord8_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2187"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int16PrimTy</span><span class="hs-special">,</span><span>
</span><a name="line-2188"></a><span>        </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">intDataCon</span><span class="hs-special">)</span><span>
</span><a name="line-2189"></a><span>        </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#extendInt16_RDR"><span class="hs-identifier hs-var">extendInt16_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2190"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">word16PrimTy</span><span class="hs-special">,</span><span>
</span><a name="line-2191"></a><span>        </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-identifier hs-var">wordDataCon</span><span class="hs-special">)</span><span>
</span><a name="line-2192"></a><span>        </span><span class="hs-operator hs-var">.</span><span>  </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#extendWord16_RDR"><span class="hs-identifier hs-var">extendWord16_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2193"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-2194"></a><span>
</span><a name="line-2195"></a><span>
</span><a name="line-2196"></a><span class="hs-comment">-- | A table of postfix modifiers for unboxed values.</span><span>
</span><a name="line-2197"></a><span class="hs-identifier">postfixModTbl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2198"></a><a name="postfixModTbl"><a href="TcGenDeriv.html#postfixModTbl"><span class="hs-identifier">postfixModTbl</span></a></a><span>
</span><a name="line-2199"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">charPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2200"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">intPrimTy</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2201"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;##&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2202"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">floatPrimTy</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;#&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2203"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">doublePrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;##&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2204"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">int8PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2205"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">word8PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;##&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2206"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">int16PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2207"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">word16PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;##&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2208"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-2209"></a><span>
</span><a name="line-2210"></a><span class="hs-identifier">primConvTbl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2211"></a><a name="primConvTbl"><a href="TcGenDeriv.html#primConvTbl"><span class="hs-identifier">primConvTbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2212"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int8PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;narrowInt8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2213"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">word8PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;narrowWord8#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2214"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int16PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;narrowInt16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2215"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">word16PrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;narrowWord16#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2216"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-2217"></a><span>
</span><a name="line-2218"></a><span class="hs-identifier">litConTbl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2219"></a><a name="litConTbl"><a href="TcGenDeriv.html#litConTbl"><span class="hs-identifier">litConTbl</span></a></a><span>
</span><a name="line-2220"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">charPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#charPrimL_RDR"><span class="hs-identifier hs-var">charPrimL_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2221"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">intPrimTy</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#intPrimL_RDR"><span class="hs-identifier hs-var">intPrimL_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-2222"></a><span>                      </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">toInteger_RDR</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2223"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#wordPrimL_RDR"><span class="hs-identifier hs-var">wordPrimL_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-2224"></a><span>                      </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">toInteger_RDR</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2225"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">addrPrimTy</span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#stringPrimL_RDR"><span class="hs-identifier hs-var">stringPrimL_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-2226"></a><span>                      </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span>
</span><a name="line-2227"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">map_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-2228"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compose_RDR</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">nlHsApps</span><span class="hs-special">`</span><span>
</span><a name="line-2229"></a><span>                            </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">fromIntegral_RDR</span><span>
</span><a name="line-2230"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">fromEnum_RDR</span><span>
</span><a name="line-2231"></a><span>                            </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2232"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">floatPrimTy</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#floatPrimL_RDR"><span class="hs-identifier hs-var">floatPrimL_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-2233"></a><span>                      </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">toRational_RDR</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2234"></a><span>    </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">doublePrimTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="THNames.html#doublePrimL_RDR"><span class="hs-identifier hs-var">doublePrimL_RDR</span></a><span class="hs-special">)</span><span>
</span><a name="line-2235"></a><span>                      </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">toRational_RDR</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2236"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-2237"></a><span>
</span><a name="line-2238"></a><span class="hs-comment">-- | Lookup `Type` in an association list.</span><span>
</span><a name="line-2239"></a><span class="hs-identifier">assoc_ty_id</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>           </span><span class="hs-comment">-- The class involved</span><span>
</span><a name="line-2240"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><a href="#local-6989586621683241546"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- The table</span><span>
</span><a name="line-2241"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>             </span><span class="hs-comment">-- The type</span><span>
</span><a name="line-2242"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683241546"><span class="hs-identifier hs-type">a</span></a><span>                </span><span class="hs-comment">-- The result of the lookup</span><span>
</span><a name="line-2243"></a><a name="assoc_ty_id"><a href="TcGenDeriv.html#assoc_ty_id"><span class="hs-identifier">assoc_ty_id</span></a></a><span> </span><a name="local-6989586621683242120"><a href="#local-6989586621683242120"><span class="hs-identifier">cls_str</span></a></a><span> </span><a name="local-6989586621683242121"><a href="#local-6989586621683242121"><span class="hs-identifier">tbl</span></a></a><span> </span><a name="local-6989586621683242122"><a href="#local-6989586621683242122"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2244"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683242123"><a href="#local-6989586621683242123"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcGenDeriv.html#assoc_ty_id_maybe"><span class="hs-identifier hs-var">assoc_ty_id_maybe</span></a><span> </span><a href="#local-6989586621683242121"><span class="hs-identifier hs-var">tbl</span></a><span> </span><a href="#local-6989586621683242122"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683242123"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-2245"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2246"></a><span>      </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;Error in deriving:&quot;</span><span>
</span><a name="line-2247"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Can't derive&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621683242120"><span class="hs-identifier hs-var">cls_str</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-2248"></a><span>           </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;for primitive type&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683242122"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2249"></a><span>
</span><a name="line-2250"></a><span class="hs-comment">-- | Lookup `Type` in an association list.</span><span>
</span><a name="line-2251"></a><span class="hs-identifier">assoc_ty_id_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683241545"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621683241545"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2252"></a><a name="assoc_ty_id_maybe"><a href="TcGenDeriv.html#assoc_ty_id_maybe"><span class="hs-identifier">assoc_ty_id_maybe</span></a></a><span> </span><a name="local-6989586621683242124"><a href="#local-6989586621683242124"><span class="hs-identifier">tbl</span></a></a><span> </span><a name="local-6989586621683242125"><a href="#local-6989586621683242125"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621683242126"><a href="#local-6989586621683242126"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683242126"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683242125"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242124"><span class="hs-identifier hs-var">tbl</span></a><span>
</span><a name="line-2253"></a><span>
</span><a name="line-2254"></a><span class="hs-comment">-----------------------------------------------------------------------</span><span>
</span><a name="line-2255"></a><span>
</span><a name="line-2256"></a><span class="hs-identifier">and_Expr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2257"></a><a name="and_Expr"><a href="TcGenDeriv.html#and_Expr"><span class="hs-identifier">and_Expr</span></a></a><span> </span><a name="local-6989586621683242127"><a href="#local-6989586621683242127"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683242128"><a href="#local-6989586621683242128"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier hs-var">genOpApp</span></a><span> </span><a href="#local-6989586621683242127"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-identifier hs-var">and_RDR</span><span>    </span><a href="#local-6989586621683242128"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2258"></a><span>
</span><a name="line-2259"></a><span class="hs-comment">-----------------------------------------------------------------------</span><span>
</span><a name="line-2260"></a><span>
</span><a name="line-2261"></a><span class="hs-identifier">eq_Expr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2262"></a><a name="eq_Expr"><a href="TcGenDeriv.html#eq_Expr"><span class="hs-identifier">eq_Expr</span></a></a><span> </span><a name="local-6989586621683242129"><a href="#local-6989586621683242129"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621683242130"><a href="#local-6989586621683242130"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621683242131"><a href="#local-6989586621683242131"><span class="hs-identifier">b</span></a></a><span>
</span><a name="line-2263"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isUnliftedType</span><span> </span><a href="#local-6989586621683242129"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier hs-var">genOpApp</span></a><span> </span><a href="#local-6989586621683242130"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-identifier hs-var">eq_RDR</span><span> </span><a href="#local-6989586621683242131"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2264"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier hs-var">genPrimOpApp</span></a><span> </span><a href="#local-6989586621683242130"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621683242132"><span class="hs-identifier hs-var">prim_eq</span></a><span> </span><a href="#local-6989586621683242131"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2265"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2266"></a><span>   </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683242132"><a href="#local-6989586621683242132"><span class="hs-identifier">prim_eq</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#primOrdOps"><span class="hs-identifier hs-var">primOrdOps</span></a><span> </span><span class="hs-string">&quot;Eq&quot;</span><span> </span><a href="#local-6989586621683242129"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2267"></a><span>
</span><a name="line-2268"></a><span class="hs-identifier">untag_Expr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2269"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2270"></a><a name="untag_Expr"><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier">untag_Expr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621683242133"><a href="#local-6989586621683242133"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683242133"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-2271"></a><span class="hs-identifier">untag_Expr</span><span> </span><a name="local-6989586621683242134"><a href="#local-6989586621683242134"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242135"><a href="#local-6989586621683242135"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621683242136"><a href="#local-6989586621683242136"><span class="hs-identifier">untag_this</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683242137"><a href="#local-6989586621683242137"><span class="hs-identifier">put_tag_here</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621683242138"><a href="#local-6989586621683242138"><span class="hs-identifier">more</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683242139"><a href="#local-6989586621683242139"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-2272"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVarApps</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#con2tag_RDR"><span class="hs-identifier hs-var">con2tag_RDR</span></a><span> </span><a href="#local-6989586621683242134"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242135"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-2273"></a><span>                                   </span><span class="hs-special">[</span><a href="#local-6989586621683242136"><span class="hs-identifier hs-var">untag_this</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">{-of-}</span><span>
</span><a name="line-2274"></a><span>      </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="#local-6989586621683242137"><span class="hs-identifier hs-var">put_tag_here</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#untag_Expr"><span class="hs-identifier hs-var">untag_Expr</span></a><span> </span><a href="#local-6989586621683242134"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242135"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621683242138"><span class="hs-identifier hs-var">more</span></a><span> </span><a href="#local-6989586621683242139"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2275"></a><span>
</span><a name="line-2276"></a><span class="hs-identifier">enum_from_to_Expr</span><span>
</span><a name="line-2277"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2278"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2279"></a><span class="hs-identifier">enum_from_then_to_Expr</span><span>
</span><a name="line-2280"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2281"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2282"></a><span>
</span><a name="line-2283"></a><a name="enum_from_to_Expr"><a href="TcGenDeriv.html#enum_from_to_Expr"><span class="hs-identifier">enum_from_to_Expr</span></a></a><span>      </span><a name="local-6989586621683242140"><a href="#local-6989586621683242140"><span class="hs-identifier">f</span></a></a><span>   </span><a name="local-6989586621683242141"><a href="#local-6989586621683242141"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">enumFromTo_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242140"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242141"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2284"></a><a name="enum_from_then_to_Expr"><a href="TcGenDeriv.html#enum_from_then_to_Expr"><span class="hs-identifier">enum_from_then_to_Expr</span></a></a><span> </span><a name="local-6989586621683242142"><a href="#local-6989586621683242142"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621683242143"><a href="#local-6989586621683242143"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621683242144"><a href="#local-6989586621683242144"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">enumFromThenTo_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242142"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242143"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242144"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2285"></a><span>
</span><a name="line-2286"></a><span class="hs-identifier">showParen_Expr</span><span>
</span><a name="line-2287"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2288"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2289"></a><span>
</span><a name="line-2290"></a><a name="showParen_Expr"><a href="TcGenDeriv.html#showParen_Expr"><span class="hs-identifier">showParen_Expr</span></a></a><span> </span><a name="local-6989586621683242145"><a href="#local-6989586621683242145"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621683242146"><a href="#local-6989586621683242146"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">showParen_RDR</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242145"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242146"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-2291"></a><span>
</span><a name="line-2292"></a><span class="hs-identifier">nested_compose_Expr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2293"></a><span>
</span><a name="line-2294"></a><a name="nested_compose_Expr"><a href="TcGenDeriv.html#nested_compose_Expr"><span class="hs-identifier">nested_compose_Expr</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;nested_compose_expr&quot;</span><span>   </span><span class="hs-comment">-- Arg is always non-empty</span><span>
</span><a name="line-2295"></a><span class="hs-identifier">nested_compose_Expr</span><span> </span><span class="hs-special">[</span><a name="local-6989586621683242147"><a href="#local-6989586621683242147"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#parenify"><span class="hs-identifier hs-var">parenify</span></a><span> </span><a href="#local-6989586621683242147"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-2296"></a><span class="hs-identifier">nested_compose_Expr</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683242148"><a href="#local-6989586621683242148"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683242149"><a href="#local-6989586621683242149"><span class="hs-identifier">es</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2297"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">compose_RDR</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#parenify"><span class="hs-identifier hs-var">parenify</span></a><span> </span><a href="#local-6989586621683242148"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcGenDeriv.html#nested_compose_Expr"><span class="hs-identifier hs-var">nested_compose_Expr</span></a><span> </span><a href="#local-6989586621683242149"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">)</span><span>
</span><a name="line-2298"></a><span>
</span><a name="line-2299"></a><span class="hs-comment">-- impossible_Expr is used in case RHSs that should never happen.</span><span>
</span><a name="line-2300"></a><span class="hs-comment">-- We generate these to keep the desugarer from complaining that they *might* happen!</span><span>
</span><a name="line-2301"></a><span class="hs-identifier">error_Expr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2302"></a><a name="error_Expr"><a href="TcGenDeriv.html#error_Expr"><span class="hs-identifier">error_Expr</span></a></a><span> </span><a name="local-6989586621683242150"><a href="#local-6989586621683242150"><span class="hs-identifier">string</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">error_RDR</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><a href="#local-6989586621683242150"><span class="hs-identifier hs-var">string</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2303"></a><span>
</span><a name="line-2304"></a><span class="hs-comment">-- illegal_Expr is used when signalling error conditions in the RHS of a derived</span><span>
</span><a name="line-2305"></a><span class="hs-comment">-- method. It is currently only used by Enum.{succ,pred}</span><span>
</span><a name="line-2306"></a><span class="hs-identifier">illegal_Expr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2307"></a><a name="illegal_Expr"><a href="TcGenDeriv.html#illegal_Expr"><span class="hs-identifier">illegal_Expr</span></a></a><span> </span><a name="local-6989586621683242151"><a href="#local-6989586621683242151"><span class="hs-identifier">meth</span></a></a><span> </span><a name="local-6989586621683242152"><a href="#local-6989586621683242152"><span class="hs-identifier">tp</span></a></a><span> </span><a name="local-6989586621683242153"><a href="#local-6989586621683242153"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2308"></a><span>   </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">error_RDR</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683242151"><span class="hs-identifier hs-var">meth</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-char">'{'</span><span class="hs-glyph">:</span><a href="#local-6989586621683242152"><span class="hs-identifier hs-var">tp</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;}: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683242153"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2309"></a><span>
</span><a name="line-2310"></a><span class="hs-comment">-- illegal_toEnum_tag is an extended version of illegal_Expr, which also allows you</span><span>
</span><a name="line-2311"></a><span class="hs-comment">-- to include the value of a_RDR in the error string.</span><span>
</span><a name="line-2312"></a><span class="hs-identifier">illegal_toEnum_tag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2313"></a><a name="illegal_toEnum_tag"><a href="TcGenDeriv.html#illegal_toEnum_tag"><span class="hs-identifier">illegal_toEnum_tag</span></a></a><span> </span><a name="local-6989586621683242154"><a href="#local-6989586621683242154"><span class="hs-identifier">tp</span></a></a><span> </span><a name="local-6989586621683242155"><a href="#local-6989586621683242155"><span class="hs-identifier">maxtag</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2314"></a><span>   </span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">error_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-2315"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">append_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-2316"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;toEnum{&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683242154"><span class="hs-identifier hs-var">tp</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;}: tag (&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2317"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span>
</span><a name="line-2318"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">showsPrec_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-2319"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsIntLit</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2320"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2321"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span>
</span><a name="line-2322"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">append_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-2323"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><span class="hs-string">&quot;) is outside of enumeration's range (0,&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2324"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span>
</span><a name="line-2325"></a><span>                                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">showsPrec_RDR</span><span class="hs-special">)</span><span>
</span><a name="line-2326"></a><span>                                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsIntLit</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2327"></a><span>                                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="#local-6989586621683242155"><span class="hs-identifier hs-var">maxtag</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2328"></a><span>                                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsString</span><span> </span><span class="hs-string">&quot;)&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2329"></a><span>
</span><a name="line-2330"></a><span class="hs-identifier">parenify</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2331"></a><a name="parenify"><a href="TcGenDeriv.html#parenify"><span class="hs-identifier">parenify</span></a></a><span> </span><a name="local-6989586621683242156"><a href="#local-6989586621683242156"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsVar</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683242156"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-2332"></a><span class="hs-identifier">parenify</span><span> </span><a name="local-6989586621683242157"><a href="#local-6989586621683242157"><span class="hs-identifier">e</span></a></a><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsPar</span><span> </span><a href="#local-6989586621683242157"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-2333"></a><span>
</span><a name="line-2334"></a><span class="hs-comment">-- genOpApp wraps brackets round the operator application, so that the</span><span>
</span><a name="line-2335"></a><span class="hs-comment">-- renamer won't subsequently try to re-associate it.</span><span>
</span><a name="line-2336"></a><span class="hs-identifier">genOpApp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2337"></a><a name="genOpApp"><a href="TcGenDeriv.html#genOpApp"><span class="hs-identifier">genOpApp</span></a></a><span> </span><a name="local-6989586621683242158"><a href="#local-6989586621683242158"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621683242159"><a href="#local-6989586621683242159"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621683242160"><a href="#local-6989586621683242160"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsOpApp</span><span> </span><a href="#local-6989586621683242158"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621683242159"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683242160"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2338"></a><span>
</span><a name="line-2339"></a><span class="hs-identifier">genPrimOpApp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2340"></a><a name="genPrimOpApp"><a href="TcGenDeriv.html#genPrimOpApp"><span class="hs-identifier">genPrimOpApp</span></a></a><span> </span><a name="local-6989586621683242161"><a href="#local-6989586621683242161"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621683242162"><a href="#local-6989586621683242162"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621683242163"><a href="#local-6989586621683242163"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsPar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#tagToEnum_RDR"><span class="hs-identifier hs-var">tagToEnum_RDR</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsOpApp</span><span> </span><a href="#local-6989586621683242161"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621683242162"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621683242163"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2341"></a><span>
</span><a name="line-2342"></a><span class="hs-identifier">a_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">c_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">d_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">k_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">z_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ah_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bh_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ch_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dh_RDR</span><span>
</span><a name="line-2343"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-2344"></a><a name="a_RDR"><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier">a_RDR</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;a&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2345"></a><a name="b_RDR"><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier">b_RDR</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;b&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2346"></a><a name="c_RDR"><a href="TcGenDeriv.html#c_RDR"><span class="hs-identifier">c_RDR</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;c&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2347"></a><a name="d_RDR"><a href="TcGenDeriv.html#d_RDR"><span class="hs-identifier">d_RDR</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;d&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2348"></a><a name="f_RDR"><a href="TcGenDeriv.html#f_RDR"><span class="hs-identifier">f_RDR</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;f&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2349"></a><a name="k_RDR"><a href="TcGenDeriv.html#k_RDR"><span class="hs-identifier">k_RDR</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;k&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2350"></a><a name="z_RDR"><a href="TcGenDeriv.html#z_RDR"><span class="hs-identifier">z_RDR</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;z&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2351"></a><a name="ah_RDR"><a href="TcGenDeriv.html#ah_RDR"><span class="hs-identifier">ah_RDR</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;a#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2352"></a><a name="bh_RDR"><a href="TcGenDeriv.html#bh_RDR"><span class="hs-identifier">bh_RDR</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;b#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2353"></a><a name="ch_RDR"><a href="TcGenDeriv.html#ch_RDR"><span class="hs-identifier">ch_RDR</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;c#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2354"></a><a name="dh_RDR"><a href="TcGenDeriv.html#dh_RDR"><span class="hs-identifier">dh_RDR</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;d#&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2355"></a><span>
</span><a name="line-2356"></a><span class="hs-identifier">as_RDRs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bs_RDRs</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cs_RDRs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span>
</span><a name="line-2357"></a><a name="as_RDRs"><a href="TcGenDeriv.html#as_RDRs"><span class="hs-identifier">as_RDRs</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkFastString</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;a&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621683242164"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621683242164"><a href="#local-6989586621683242164"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2358"></a><a name="bs_RDRs"><a href="TcGenDeriv.html#bs_RDRs"><span class="hs-identifier">bs_RDRs</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkFastString</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;b&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621683242165"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621683242165"><a href="#local-6989586621683242165"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2359"></a><a name="cs_RDRs"><a href="TcGenDeriv.html#cs_RDRs"><span class="hs-identifier">cs_RDRs</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">mkVarUnqual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkFastString</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;c&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621683242166"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621683242166"><a href="#local-6989586621683242166"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2360"></a><span>
</span><a name="line-2361"></a><span class="hs-identifier">a_Expr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b_Expr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">c_Expr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">z_Expr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ltTag_Expr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eqTag_Expr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtTag_Expr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">false_Expr</span><span class="hs-special">,</span><span>
</span><a name="line-2362"></a><span>    </span><span class="hs-identifier">true_Expr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pure_Expr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2363"></a><a name="a_Expr"><a href="TcGenDeriv.html#a_Expr"><span class="hs-identifier">a_Expr</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span>
</span><a name="line-2364"></a><a name="b_Expr"><a href="TcGenDeriv.html#b_Expr"><span class="hs-identifier">b_Expr</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span>
</span><a name="line-2365"></a><a name="c_Expr"><a href="TcGenDeriv.html#c_Expr"><span class="hs-identifier">c_Expr</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#c_RDR"><span class="hs-identifier hs-var">c_RDR</span></a><span>
</span><a name="line-2366"></a><a name="z_Expr"><a href="TcGenDeriv.html#z_Expr"><span class="hs-identifier">z_Expr</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><a href="TcGenDeriv.html#z_RDR"><span class="hs-identifier hs-var">z_RDR</span></a><span>
</span><a name="line-2367"></a><a name="ltTag_Expr"><a href="TcGenDeriv.html#ltTag_Expr"><span class="hs-identifier">ltTag_Expr</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">ltTag_RDR</span><span>
</span><a name="line-2368"></a><a name="eqTag_Expr"><a href="TcGenDeriv.html#eqTag_Expr"><span class="hs-identifier">eqTag_Expr</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">eqTag_RDR</span><span>
</span><a name="line-2369"></a><a name="gtTag_Expr"><a href="TcGenDeriv.html#gtTag_Expr"><span class="hs-identifier">gtTag_Expr</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">gtTag_RDR</span><span>
</span><a name="line-2370"></a><a name="false_Expr"><a href="TcGenDeriv.html#false_Expr"><span class="hs-identifier">false_Expr</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">false_RDR</span><span>
</span><a name="line-2371"></a><a name="true_Expr"><a href="TcGenDeriv.html#true_Expr"><span class="hs-identifier">true_Expr</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">true_RDR</span><span>
</span><a name="line-2372"></a><a name="pure_Expr"><a href="TcGenDeriv.html#pure_Expr"><span class="hs-identifier">pure_Expr</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlHsVar</span><span> </span><span class="hs-identifier hs-var">pure_RDR</span><span>
</span><a name="line-2373"></a><span>
</span><a name="line-2374"></a><span class="hs-identifier">a_Pat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b_Pat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">c_Pat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">d_Pat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">k_Pat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">z_Pat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-2375"></a><a name="a_Pat"><a href="TcGenDeriv.html#a_Pat"><span class="hs-identifier">a_Pat</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#a_RDR"><span class="hs-identifier hs-var">a_RDR</span></a><span>
</span><a name="line-2376"></a><a name="b_Pat"><a href="TcGenDeriv.html#b_Pat"><span class="hs-identifier">b_Pat</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#b_RDR"><span class="hs-identifier hs-var">b_RDR</span></a><span>
</span><a name="line-2377"></a><a name="c_Pat"><a href="TcGenDeriv.html#c_Pat"><span class="hs-identifier">c_Pat</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#c_RDR"><span class="hs-identifier hs-var">c_RDR</span></a><span>
</span><a name="line-2378"></a><a name="d_Pat"><a href="TcGenDeriv.html#d_Pat"><span class="hs-identifier">d_Pat</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#d_RDR"><span class="hs-identifier hs-var">d_RDR</span></a><span>
</span><a name="line-2379"></a><a name="k_Pat"><a href="TcGenDeriv.html#k_Pat"><span class="hs-identifier">k_Pat</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#k_RDR"><span class="hs-identifier hs-var">k_RDR</span></a><span>
</span><a name="line-2380"></a><a name="z_Pat"><a href="TcGenDeriv.html#z_Pat"><span class="hs-identifier">z_Pat</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nlVarPat</span><span> </span><a href="TcGenDeriv.html#z_RDR"><span class="hs-identifier hs-var">z_RDR</span></a><span>
</span><a name="line-2381"></a><span>
</span><a name="line-2382"></a><span class="hs-identifier">minusInt_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tagToEnum_RDR</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-2383"></a><a name="minusInt_RDR"><a href="TcGenDeriv.html#minusInt_RDR"><span class="hs-identifier">minusInt_RDR</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-special">(</span><a href="PrelInfo.html#primOpId"><span class="hs-identifier hs-var">primOpId</span></a><span> </span><span class="hs-identifier hs-var">IntSubOp</span><span>   </span><span class="hs-special">)</span><span>
</span><a name="line-2384"></a><a name="tagToEnum_RDR"><a href="TcGenDeriv.html#tagToEnum_RDR"><span class="hs-identifier">tagToEnum_RDR</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getRdrName</span><span> </span><span class="hs-special">(</span><a href="PrelInfo.html#primOpId"><span class="hs-identifier hs-var">primOpId</span></a><span> </span><span class="hs-identifier hs-var">TagToEnumOp</span><span class="hs-special">)</span><span>
</span><a name="line-2385"></a><span>
</span><a name="line-2386"></a><span class="hs-identifier">con2tag_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tag2con_RDR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">maxtag_RDR</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-2387"></a><span class="hs-comment">-- Generates Orig s RdrName, for the binding positions</span><span>
</span><a name="line-2388"></a><a name="con2tag_RDR"><a href="TcGenDeriv.html#con2tag_RDR"><span class="hs-identifier">con2tag_RDR</span></a></a><span> </span><a name="local-6989586621683242167"><a href="#local-6989586621683242167"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242168"><a href="#local-6989586621683242168"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mk_tc_deriv_name"><span class="hs-identifier hs-var">mk_tc_deriv_name</span></a><span> </span><a href="#local-6989586621683242167"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242168"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-identifier hs-var">mkCon2TagOcc</span><span>
</span><a name="line-2389"></a><a name="tag2con_RDR"><a href="TcGenDeriv.html#tag2con_RDR"><span class="hs-identifier">tag2con_RDR</span></a></a><span> </span><a name="local-6989586621683242169"><a href="#local-6989586621683242169"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242170"><a href="#local-6989586621683242170"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mk_tc_deriv_name"><span class="hs-identifier hs-var">mk_tc_deriv_name</span></a><span> </span><a href="#local-6989586621683242169"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242170"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-identifier hs-var">mkTag2ConOcc</span><span>
</span><a name="line-2390"></a><a name="maxtag_RDR"><a href="TcGenDeriv.html#maxtag_RDR"><span class="hs-identifier">maxtag_RDR</span></a></a><span>  </span><a name="local-6989586621683242171"><a href="#local-6989586621683242171"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242172"><a href="#local-6989586621683242172"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcGenDeriv.html#mk_tc_deriv_name"><span class="hs-identifier hs-var">mk_tc_deriv_name</span></a><span> </span><a href="#local-6989586621683242171"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683242172"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-identifier hs-var">mkMaxTagOcc</span><span>
</span><a name="line-2391"></a><span>
</span><a name="line-2392"></a><span class="hs-identifier">mk_tc_deriv_name</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OccName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OccName</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-2393"></a><a name="mk_tc_deriv_name"><a href="TcGenDeriv.html#mk_tc_deriv_name"><span class="hs-identifier">mk_tc_deriv_name</span></a></a><span> </span><a name="local-6989586621683242173"><a href="#local-6989586621683242173"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242174"><a href="#local-6989586621683242174"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621683242175"><a href="#local-6989586621683242175"><span class="hs-identifier">occ_fun</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2394"></a><span>   </span><a href="TcGenDeriv.html#mkAuxBinderName"><span class="hs-identifier hs-var">mkAuxBinderName</span></a><span> </span><a href="#local-6989586621683242173"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621683242174"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242175"><span class="hs-identifier hs-var">occ_fun</span></a><span>
</span><a name="line-2395"></a><span>
</span><a name="line-2396"></a><span class="hs-identifier">mkAuxBinderName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OccName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OccName</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span>
</span><a name="line-2397"></a><span class="hs-comment">-- ^ Make a top-level binder name for an auxiliary binding for a parent name</span><span>
</span><a name="line-2398"></a><span class="hs-comment">-- See Note [Auxiliary binders]</span><span>
</span><a name="line-2399"></a><a name="mkAuxBinderName"><a href="TcGenDeriv.html#mkAuxBinderName"><span class="hs-identifier">mkAuxBinderName</span></a></a><span> </span><a name="local-6989586621683242176"><a href="#local-6989586621683242176"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683242177"><a href="#local-6989586621683242177"><span class="hs-identifier">parent</span></a></a><span> </span><a name="local-6989586621683242178"><a href="#local-6989586621683242178"><span class="hs-identifier">occ_fun</span></a></a><span>
</span><a name="line-2400"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkRdrUnqual</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683242178"><span class="hs-identifier hs-var">occ_fun</span></a><span> </span><a href="#local-6989586621683242179"><span class="hs-identifier hs-var">stable_parent_occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-2401"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2402"></a><span>    </span><a name="local-6989586621683242179"><a href="#local-6989586621683242179"><span class="hs-identifier">stable_parent_occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkOccName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">occNameSpace</span><span> </span><a href="#local-6989586621683242183"><span class="hs-identifier hs-var">parent_occ</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683242180"><span class="hs-identifier hs-var">stable_string</span></a><span>
</span><a name="line-2403"></a><span>    </span><a name="local-6989586621683242180"><a href="#local-6989586621683242180"><span class="hs-identifier">stable_string</span></a></a><span>
</span><a name="line-2404"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">hasPprDebug</span><span> </span><a href="#local-6989586621683242176"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683242181"><span class="hs-identifier hs-var">parent_stable</span></a><span>
</span><a name="line-2405"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683242182"><span class="hs-identifier hs-var">parent_stable_hash</span></a><span>
</span><a name="line-2406"></a><span>    </span><a name="local-6989586621683242181"><a href="#local-6989586621683242181"><span class="hs-identifier">parent_stable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nameStableString</span><span> </span><a href="#local-6989586621683242177"><span class="hs-identifier hs-var">parent</span></a><span>
</span><a name="line-2407"></a><span>    </span><a name="local-6989586621683242182"><a href="#local-6989586621683242182"><span class="hs-identifier">parent_stable_hash</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2408"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Fingerprint</span><span> </span><a name="local-6989586621683242184"><a href="#local-6989586621683242184"><span class="hs-identifier">high</span></a></a><span> </span><a name="local-6989586621683242185"><a href="#local-6989586621683242185"><span class="hs-identifier">low</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprintString</span><span> </span><a href="#local-6989586621683242181"><span class="hs-identifier hs-var">parent_stable</span></a><span>
</span><a name="line-2409"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">toBase62</span><span> </span><a href="#local-6989586621683242184"><span class="hs-identifier hs-var">high</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">toBase62Padded</span><span> </span><a href="#local-6989586621683242185"><span class="hs-identifier hs-var">low</span></a><span>
</span><a name="line-2410"></a><span>      </span><span class="hs-comment">-- See Note [Base 62 encoding 128-bit integers] in Encoding</span><span>
</span><a name="line-2411"></a><span>    </span><a name="local-6989586621683242183"><a href="#local-6989586621683242183"><span class="hs-identifier">parent_occ</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nameOccName</span><span> </span><a href="#local-6989586621683242177"><span class="hs-identifier hs-var">parent</span></a><span>
</span><a name="line-2412"></a><span>
</span><a name="line-2413"></a><span>
</span><a name="line-2414"></a><span class="hs-comment">{-
Note [Auxiliary binders]
~~~~~~~~~~~~~~~~~~~~~~~~
We often want to make a top-level auxiliary binding.  E.g. for comparison we haev

  instance Ord T where
    compare a b = $con2tag a `compare` $con2tag b

  $con2tag :: T -&gt; Int
  $con2tag = ...code....

Of course these top-level bindings should all have distinct name, and we are
generating RdrNames here.  We can't just use the TyCon or DataCon to distinguish
because with standalone deriving two imported TyCons might both be called T!
(See Trac #7947.)

So we use package name, module name and the name of the parent
(T in this example) as part of the OccName we generate for the new binding.
To make the symbol names short we take a base62 hash of the full name.

In the past we used the *unique* from the parent, but that's not stable across
recompilations as uniques are nondeterministic.
-}</span><span>
</span><a name="line-2437"></a></pre></body></html>