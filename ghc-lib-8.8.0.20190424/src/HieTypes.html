<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveTraversable #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE TypeSynonymInstances #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">HieTypes</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Binary</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>                 </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">FastString</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">IfaceType</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Module</span><span>                     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ModuleName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Module</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>                       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>                     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">RealSrcSpan</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Avail</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Array</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">A</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString</span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Data</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Semigroup</span><span>             </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;|&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">type</span><span> </span><a name="Span"><a href="HieTypes.html#Span"><span class="hs-identifier">Span</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">RealSrcSpan</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">-- | Current version of @.hie@ files</span><span>
</span><a name="line-31"></a><span class="hs-identifier">curHieVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>
</span><a name="line-32"></a><a name="curHieVersion"><a href="HieTypes.html#curHieVersion"><span class="hs-identifier">curHieVersion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-comment">{- |
GHC builds up a wealth of information about Haskell source as it compiles it.
@.hie@ files are a way of persisting some of this information to disk so that
external tools that need to work with haskell source don't need to parse,
typecheck, and rename all over again. These files contain:

  * a simplified AST

       * nodes are annotated with source positions and types
       * identifiers are annotated with scope information

  * the raw bytes of the initial Haskell source

Besides saving compilation cycles, @.hie@ files also offer a more stable
interface than the GHC API.
-}</span><span>
</span><a name="line-50"></a><span class="hs-keyword">data</span><span> </span><a name="HieFile"><a href="HieTypes.html#HieFile"><span class="hs-identifier">HieFile</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HieFile"><a href="HieTypes.html#HieFile"><span class="hs-identifier">HieFile</span></a></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="hie_version"><a href="HieTypes.html#hie_version"><span class="hs-identifier">hie_version</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-comment">-- ^ version of the HIE format</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="hie_ghc_version"><a href="HieTypes.html#hie_ghc_version"><span class="hs-identifier">hie_ghc_version</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-comment">-- ^ Version of GHC that produced this file</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="hie_hs_file"><a href="HieTypes.html#hie_hs_file"><span class="hs-identifier">hie_hs_file</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-comment">-- ^ Initial Haskell source file path</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="hie_module"><a href="HieTypes.html#hie_module"><span class="hs-identifier">hie_module</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Module</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-comment">-- ^ The module this HIE file is for</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="hie_types"><a href="HieTypes.html#hie_types"><span class="hs-identifier">hie_types</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">A.Array</span><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span> </span><a href="HieTypes.html#HieTypeFlat"><span class="hs-identifier hs-type">HieTypeFlat</span></a><span>
</span><a name="line-64"></a><span>    </span><span class="hs-comment">-- ^ Types referenced in the 'hie_asts'.</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-comment">-- See Note [Efficient serialization of redundant type info]</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="hie_asts"><a href="HieTypes.html#hie_asts"><span class="hs-identifier">hie_asts</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HieTypes.html#HieASTs"><span class="hs-identifier hs-type">HieASTs</span></a><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span>
</span><a name="line-69"></a><span>    </span><span class="hs-comment">-- ^ Type-annotated abstract syntax trees</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="hie_exports"><a href="HieTypes.html#hie_exports"><span class="hs-identifier">hie_exports</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">AvailInfo</span><span class="hs-special">]</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-comment">-- ^ The names that this module exports</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="hie_hs_src"><a href="HieTypes.html#hie_hs_src"><span class="hs-identifier">hie_hs_src</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-comment">-- ^ Raw bytes of the initial Haskell source</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="HieTypes.html#HieFile"><span class="hs-identifier hs-type">HieFile</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-79"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650384"><a href="#local-6989586621679650384"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650385"><a href="#local-6989586621679650385"><span class="hs-identifier">hf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hie_version</span><span> </span><a href="#local-6989586621679650385"><span class="hs-identifier hs-var">hf</span></a><span>
</span><a name="line-81"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hie_ghc_version</span><span> </span><a href="#local-6989586621679650385"><span class="hs-identifier hs-var">hf</span></a><span>
</span><a name="line-82"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hie_hs_file</span><span> </span><a href="#local-6989586621679650385"><span class="hs-identifier hs-var">hf</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hie_module</span><span> </span><a href="#local-6989586621679650385"><span class="hs-identifier hs-var">hf</span></a><span>
</span><a name="line-84"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hie_types</span><span> </span><a href="#local-6989586621679650385"><span class="hs-identifier hs-var">hf</span></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hie_asts</span><span> </span><a href="#local-6989586621679650385"><span class="hs-identifier hs-var">hf</span></a><span>
</span><a name="line-86"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hie_exports</span><span> </span><a href="#local-6989586621679650385"><span class="hs-identifier hs-var">hf</span></a><span>
</span><a name="line-87"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">hie_hs_src</span><span> </span><a href="#local-6989586621679650385"><span class="hs-identifier hs-var">hf</span></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650386"><a href="#local-6989586621679650386"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HieTypes.html#HieFile"><span class="hs-identifier hs-var">HieFile</span></a><span>
</span><a name="line-90"></a><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650386"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-91"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650386"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-92"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650386"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-93"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650386"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-94"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650386"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-95"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650386"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650386"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-97"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650386"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">{-
Note [Efficient serialization of redundant type info]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The type information in .hie files is highly repetitive and redundant. For
example, consider the expression

    const True 'a'

There is a lot of shared structure between the types of subterms:

  * const True 'a' ::                 Bool
  * const True     ::         Char -&gt; Bool
  * const          :: Bool -&gt; Char -&gt; Bool

Since all 3 of these types need to be stored in the .hie file, it is worth
making an effort to deduplicate this shared structure. The trick is to define
a new data type that is a flattened version of 'Type':

    data HieType a = HAppTy a a  -- data Type = AppTy Type Type
                   | HFunTy a a  --           | FunTy Type Type
                   | ...

    type TypeIndex = Int

Types in the final AST are stored in an 'A.Array TypeIndex (HieType TypeIndex)',
where the 'TypeIndex's in the 'HieType' are references to other elements of the
array. Types recovered from GHC are deduplicated and stored in this compressed
form with sharing of subtrees.
-}</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-keyword">type</span><span> </span><a name="TypeIndex"><a href="HieTypes.html#TypeIndex"><span class="hs-identifier">TypeIndex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- | A flattened version of 'Type'.</span><span>
</span><a name="line-134"></a><span class="hs-comment">--</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- See Note [Efficient serialization of redundant type info]</span><span>
</span><a name="line-136"></a><span class="hs-keyword">data</span><span> </span><a name="HieType"><a href="HieTypes.html#HieType"><span class="hs-identifier">HieType</span></a></a><span> </span><a name="local-6989586621679650281"><a href="#local-6989586621679650281"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-137"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="HTyVarTy"><a href="HieTypes.html#HTyVarTy"><span class="hs-identifier">HTyVarTy</span></a></a><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-138"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HAppTy"><a href="HieTypes.html#HAppTy"><span class="hs-identifier">HAppTy</span></a></a><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieArgs"><span class="hs-identifier hs-type">HieArgs</span></a><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HTyConApp"><a href="HieTypes.html#HTyConApp"><span class="hs-identifier">HTyConApp</span></a></a><span> </span><span class="hs-identifier hs-type">IfaceTyCon</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieArgs"><span class="hs-identifier hs-type">HieArgs</span></a><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HForAllTy"><a href="HieTypes.html#HForAllTy"><span class="hs-identifier">HForAllTy</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-type">ArgFlag</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-141"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HFunTy"><a href="HieTypes.html#HFunTy"><span class="hs-identifier">HFunTy</span></a></a><span>  </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-142"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HQualTy"><a href="HieTypes.html#HQualTy"><span class="hs-identifier">HQualTy</span></a></a><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span>           </span><span class="hs-comment">-- ^ type with constraint: @t1 =&gt; t2@ (see 'IfaceDFunTy')</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HLitTy"><a href="HieTypes.html#HLitTy"><span class="hs-identifier">HLitTy</span></a></a><span> </span><span class="hs-identifier hs-type">IfaceTyLit</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HCastTy"><a href="HieTypes.html#HCastTy"><span class="hs-identifier">HCastTy</span></a></a><span> </span><a href="#local-6989586621679650281"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-145"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HCoercionTy"><a href="HieTypes.html#HCoercionTy"><span class="hs-identifier">HCoercionTy</span></a></a><span>
</span><a name="line-146"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-keyword">type</span><span> </span><a name="HieTypeFlat"><a href="HieTypes.html#HieTypeFlat"><span class="hs-identifier">HieTypeFlat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HieTypes.html#HieType"><span class="hs-identifier hs-type">HieType</span></a><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-comment">-- | Roughly isomorphic to the original core 'Type'.</span><span>
</span><a name="line-151"></a><span class="hs-keyword">newtype</span><span> </span><a name="HieTypeFix"><a href="HieTypes.html#HieTypeFix"><span class="hs-identifier">HieTypeFix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Roll"><a href="HieTypes.html#Roll"><span class="hs-identifier">Roll</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieType"><span class="hs-identifier hs-type">HieType</span></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieTypeFix"><span class="hs-identifier hs-type">HieTypeFix</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieType"><span class="hs-identifier hs-type">HieType</span></a><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-154"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650360"><a href="#local-6989586621679650360"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HTyVarTy"><span class="hs-identifier hs-var">HTyVarTy</span></a><span> </span><a name="local-6989586621679650361"><a href="#local-6989586621679650361"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650360"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650360"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650361"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650362"><a href="#local-6989586621679650362"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HAppTy"><span class="hs-identifier hs-var">HAppTy</span></a><span> </span><a name="local-6989586621679650363"><a href="#local-6989586621679650363"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679650364"><a href="#local-6989586621679650364"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650362"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650362"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650363"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-160"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650362"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650364"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-161"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650365"><a href="#local-6989586621679650365"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HTyConApp"><span class="hs-identifier hs-var">HTyConApp</span></a><span> </span><a name="local-6989586621679650366"><a href="#local-6989586621679650366"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679650367"><a href="#local-6989586621679650367"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650365"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-163"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650365"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650366"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-164"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650365"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650367"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-165"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650368"><a href="#local-6989586621679650368"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HForAllTy"><span class="hs-identifier hs-var">HForAllTy</span></a><span> </span><a name="local-6989586621679650369"><a href="#local-6989586621679650369"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621679650370"><a href="#local-6989586621679650370"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650368"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650368"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650369"><span class="hs-identifier hs-var">bndr</span></a><span>
</span><a name="line-168"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650368"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650370"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-169"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650371"><a href="#local-6989586621679650371"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HFunTy"><span class="hs-identifier hs-var">HFunTy</span></a><span> </span><a name="local-6989586621679650372"><a href="#local-6989586621679650372"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679650373"><a href="#local-6989586621679650373"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650371"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650371"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650372"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-172"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650371"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650373"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-173"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650374"><a href="#local-6989586621679650374"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HQualTy"><span class="hs-identifier hs-var">HQualTy</span></a><span> </span><a name="local-6989586621679650375"><a href="#local-6989586621679650375"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679650376"><a href="#local-6989586621679650376"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-174"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650374"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-175"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650374"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650375"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-176"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650374"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650376"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-177"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650377"><a href="#local-6989586621679650377"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HLitTy"><span class="hs-identifier hs-var">HLitTy</span></a><span> </span><a name="local-6989586621679650378"><a href="#local-6989586621679650378"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650377"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-179"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650377"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650378"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-180"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650379"><a href="#local-6989586621679650379"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HCastTy"><span class="hs-identifier hs-var">HCastTy</span></a><span> </span><a name="local-6989586621679650380"><a href="#local-6989586621679650380"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-181"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650379"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">7</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650379"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650380"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-183"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650381"><a href="#local-6989586621679650381"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HCoercionTy"><span class="hs-identifier hs-var">HCoercionTy</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650381"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">8</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650382"><a href="#local-6989586621679650382"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679650383"><a href="#local-6989586621679650383"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-187"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679650383"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-188"></a><span>      </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#HTyVarTy"><span class="hs-identifier hs-var">HTyVarTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-189"></a><span>      </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#HAppTy"><span class="hs-identifier hs-var">HAppTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-190"></a><span>      </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#HTyConApp"><span class="hs-identifier hs-var">HTyConApp</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-191"></a><span>      </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#HForAllTy"><span class="hs-identifier hs-var">HForAllTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-192"></a><span>      </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#HFunTy"><span class="hs-identifier hs-var">HFunTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-193"></a><span>      </span><span class="hs-number">5</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#HQualTy"><span class="hs-identifier hs-var">HQualTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-194"></a><span>      </span><span class="hs-number">6</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#HLitTy"><span class="hs-identifier hs-var">HLitTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-195"></a><span>      </span><span class="hs-number">7</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#HCastTy"><span class="hs-identifier hs-var">HCastTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650382"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-196"></a><span>      </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HieTypes.html#HCoercionTy"><span class="hs-identifier hs-var">HCoercionTy</span></a><span>
</span><a name="line-197"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;Binary (HieArgs Int): invalid tag&quot;</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | A list of type arguments along with their respective visibilities (ie. is</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- this an argument that would return 'True' for 'isVisibleArgFlag'?).</span><span>
</span><a name="line-202"></a><span class="hs-keyword">newtype</span><span> </span><a name="HieArgs"><a href="HieTypes.html#HieArgs"><span class="hs-identifier">HieArgs</span></a></a><span> </span><a name="local-6989586621679650280"><a href="#local-6989586621679650280"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HieArgs"><a href="HieTypes.html#HieArgs"><span class="hs-identifier">HieArgs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><a href="#local-6989586621679650280"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieArgs"><span class="hs-identifier hs-type">HieArgs</span></a><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-206"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650357"><a href="#local-6989586621679650357"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieArgs"><span class="hs-identifier hs-var">HieArgs</span></a><span> </span><a name="local-6989586621679650358"><a href="#local-6989586621679650358"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650357"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650358"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-207"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650359"><a href="#local-6989586621679650359"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HieTypes.html#HieArgs"><span class="hs-identifier hs-var">HieArgs</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650359"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-- | Mapping from filepaths (represented using 'FastString') to the</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- corresponding AST</span><span>
</span><a name="line-211"></a><span class="hs-keyword">newtype</span><span> </span><a name="HieASTs"><a href="HieTypes.html#HieASTs"><span class="hs-identifier">HieASTs</span></a></a><span> </span><a name="local-6989586621679650279"><a href="#local-6989586621679650279"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HieASTs"><a href="HieTypes.html#HieASTs"><span class="hs-identifier">HieASTs</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getAsts"><a href="HieTypes.html#getAsts"><span class="hs-identifier">getAsts</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">M.Map</span><span> </span><span class="hs-identifier hs-type">FastString</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieAST"><span class="hs-identifier hs-type">HieAST</span></a><span> </span><a href="#local-6989586621679650279"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-212"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieASTs"><span class="hs-identifier hs-type">HieASTs</span></a><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-215"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650354"><a href="#local-6989586621679650354"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650355"><a href="#local-6989586621679650355"><span class="hs-identifier">asts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650354"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.toAscList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">getAsts</span><span> </span><a href="#local-6989586621679650355"><span class="hs-identifier hs-var">asts</span></a><span>
</span><a name="line-216"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650356"><a href="#local-6989586621679650356"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HieTypes.html#HieASTs"><span class="hs-identifier hs-var">HieASTs</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">M.fromDistinctAscList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650356"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-keyword">data</span><span> </span><a name="HieAST"><a href="HieTypes.html#HieAST"><span class="hs-identifier">HieAST</span></a></a><span> </span><a name="local-6989586621679650278"><a href="#local-6989586621679650278"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-220"></a><span>  </span><a name="Node"><a href="HieTypes.html#Node"><span class="hs-identifier">Node</span></a></a><span>
</span><a name="line-221"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="nodeInfo"><a href="HieTypes.html#nodeInfo"><span class="hs-identifier">nodeInfo</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HieTypes.html#NodeInfo"><span class="hs-identifier hs-type">NodeInfo</span></a><span> </span><a href="#local-6989586621679650278"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="nodeSpan"><a href="HieTypes.html#nodeSpan"><span class="hs-identifier">nodeSpan</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HieTypes.html#Span"><span class="hs-identifier hs-type">Span</span></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="nodeChildren"><a href="HieTypes.html#nodeChildren"><span class="hs-identifier">nodeChildren</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HieTypes.html#HieAST"><span class="hs-identifier hs-type">HieAST</span></a><span> </span><a href="#local-6989586621679650278"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-224"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#HieAST"><span class="hs-identifier hs-type">HieAST</span></a><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-227"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650351"><a href="#local-6989586621679650351"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650352"><a href="#local-6989586621679650352"><span class="hs-identifier">ast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-228"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650351"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nodeInfo</span><span> </span><a href="#local-6989586621679650352"><span class="hs-identifier hs-var">ast</span></a><span>
</span><a name="line-229"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650351"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nodeSpan</span><span> </span><a href="#local-6989586621679650352"><span class="hs-identifier hs-var">ast</span></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650351"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nodeChildren</span><span> </span><a href="#local-6989586621679650352"><span class="hs-identifier hs-var">ast</span></a><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650353"><a href="#local-6989586621679650353"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HieTypes.html#Node"><span class="hs-identifier hs-var">Node</span></a><span>
</span><a name="line-233"></a><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650353"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650353"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-235"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650353"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-comment">-- | The information stored in one AST node.</span><span>
</span><a name="line-239"></a><span class="hs-comment">--</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- The type parameter exists to provide flexibility in representation of types</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- (see Note [Efficient serialization of redundant type info]).</span><span>
</span><a name="line-242"></a><span class="hs-keyword">data</span><span> </span><a name="NodeInfo"><a href="HieTypes.html#NodeInfo"><span class="hs-identifier">NodeInfo</span></a></a><span> </span><a name="local-6989586621679650277"><a href="#local-6989586621679650277"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NodeInfo"><a href="HieTypes.html#NodeInfo"><span class="hs-identifier">NodeInfo</span></a></a><span>
</span><a name="line-243"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="nodeAnnotations"><a href="HieTypes.html#nodeAnnotations"><span class="hs-identifier">nodeAnnotations</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FastString</span><span class="hs-special">,</span><span class="hs-identifier hs-type">FastString</span><span class="hs-special">)</span><span>
</span><a name="line-244"></a><span>    </span><span class="hs-comment">-- ^ (name of the AST node constructor, name of the AST node Type)</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="nodeType"><a href="HieTypes.html#nodeType"><span class="hs-identifier">nodeType</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679650277"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-comment">-- ^ The Haskell types of this node, if any.</span><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="nodeIdentifiers"><a href="HieTypes.html#nodeIdentifiers"><span class="hs-identifier">nodeIdentifiers</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HieTypes.html#NodeIdentifiers"><span class="hs-identifier hs-type">NodeIdentifiers</span></a><span> </span><a href="#local-6989586621679650277"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-250"></a><span>    </span><span class="hs-comment">-- ^ All the identifiers and their details</span><span>
</span><a name="line-251"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#NodeInfo"><span class="hs-identifier hs-type">NodeInfo</span></a><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-254"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650348"><a href="#local-6989586621679650348"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650349"><a href="#local-6989586621679650349"><span class="hs-identifier">ni</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-255"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650348"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">S.toAscList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nodeAnnotations</span><span> </span><a href="#local-6989586621679650349"><span class="hs-identifier hs-var">ni</span></a><span>
</span><a name="line-256"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650348"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nodeType</span><span> </span><a href="#local-6989586621679650349"><span class="hs-identifier hs-var">ni</span></a><span>
</span><a name="line-257"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650348"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nodeIdentifiers</span><span> </span><a href="#local-6989586621679650349"><span class="hs-identifier hs-var">ni</span></a><span>
</span><a name="line-258"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650350"><a href="#local-6989586621679650350"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HieTypes.html#NodeInfo"><span class="hs-identifier hs-var">NodeInfo</span></a><span>
</span><a name="line-259"></a><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">S.fromDistinctAscList</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650350"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650350"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-261"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.fromList</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650350"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-keyword">type</span><span> </span><a name="Identifier"><a href="HieTypes.html#Identifier"><span class="hs-identifier">Identifier</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">ModuleName</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-keyword">type</span><span> </span><a name="NodeIdentifiers"><a href="HieTypes.html#NodeIdentifiers"><span class="hs-identifier">NodeIdentifiers</span></a></a><span> </span><a name="local-6989586621679650276"><a href="#local-6989586621679650276"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">M.Map</span><span> </span><a href="HieTypes.html#Identifier"><span class="hs-identifier hs-type">Identifier</span></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier hs-type">IdentifierDetails</span></a><span> </span><a href="#local-6989586621679650276"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">-- | Information associated with every identifier</span><span>
</span><a name="line-268"></a><span class="hs-comment">--</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- We need to include types with identifiers because sometimes multiple</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- identifiers occur in the same span(Overloaded Record Fields and so on)</span><span>
</span><a name="line-271"></a><span class="hs-keyword">data</span><span> </span><a name="IdentifierDetails"><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier">IdentifierDetails</span></a></a><span> </span><a name="local-6989586621679650275"><a href="#local-6989586621679650275"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="IdentifierDetails"><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier">IdentifierDetails</span></a></a><span>
</span><a name="line-272"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="identType"><a href="HieTypes.html#identType"><span class="hs-identifier">identType</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679650275"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-273"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="identInfo"><a href="HieTypes.html#identInfo"><span class="hs-identifier">identInfo</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">S.Set</span><span> </span><a href="HieTypes.html#ContextInfo"><span class="hs-identifier hs-type">ContextInfo</span></a><span>
</span><a name="line-274"></a><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="#local-6989586621679650346"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier hs-type">IdentifierDetails</span></a><span> </span><a href="#local-6989586621679650346"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-277"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><a name="local-6989586621679650347"><a href="#local-6989586621679650347"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;IdentifierDetails&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">identType</span><span> </span><a href="#local-6989586621679650347"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">identInfo</span><span> </span><a href="#local-6989586621679650347"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier hs-type">IdentifierDetails</span></a><span> </span><a href="#local-6989586621679650343"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-280"></a><span>  </span><a name="local-6989586621679650344"><a href="#local-6989586621679650344"><span class="hs-identifier">d1</span></a></a><span> </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><a name="local-6989586621679650345"><a href="#local-6989586621679650345"><span class="hs-identifier">d2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier hs-var">IdentifierDetails</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identType</span><span> </span><a href="#local-6989586621679650344"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><span class="hs-identifier">identType</span><span> </span><a href="#local-6989586621679650345"><span class="hs-identifier hs-var">d2</span></a><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">S.union</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">identInfo</span><span> </span><a href="#local-6989586621679650344"><span class="hs-identifier hs-var">d1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">identInfo</span><span> </span><a href="#local-6989586621679650345"><span class="hs-identifier hs-var">d2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier hs-type">IdentifierDetails</span></a><span> </span><a href="#local-6989586621679650342"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-284"></a><span>  </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier hs-var">IdentifierDetails</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier hs-type">IdentifierDetails</span></a><span> </span><a href="HieTypes.html#TypeIndex"><span class="hs-identifier hs-type">TypeIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-287"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650339"><a href="#local-6989586621679650339"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650340"><a href="#local-6989586621679650340"><span class="hs-identifier">dets</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-288"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650339"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">identType</span><span> </span><a href="#local-6989586621679650340"><span class="hs-identifier hs-var">dets</span></a><span>
</span><a name="line-289"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650339"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">S.toAscList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">identInfo</span><span> </span><a href="#local-6989586621679650340"><span class="hs-identifier hs-var">dets</span></a><span>
</span><a name="line-290"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650341"><a href="#local-6989586621679650341"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="HieTypes.html#IdentifierDetails"><span class="hs-identifier hs-var">IdentifierDetails</span></a><span>
</span><a name="line-291"></a><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650341"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-292"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">S.fromDistinctAscList</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650341"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-comment">-- | Different contexts under which identifiers exist</span><span>
</span><a name="line-296"></a><span class="hs-keyword">data</span><span> </span><a name="ContextInfo"><a href="HieTypes.html#ContextInfo"><span class="hs-identifier">ContextInfo</span></a></a><span>
</span><a name="line-297"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Use"><a href="HieTypes.html#Use"><span class="hs-identifier">Use</span></a></a><span>                </span><span class="hs-comment">-- ^ regular variable</span><span>
</span><a name="line-298"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MatchBind"><a href="HieTypes.html#MatchBind"><span class="hs-identifier">MatchBind</span></a></a><span>
</span><a name="line-299"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IEThing"><a href="HieTypes.html#IEThing"><span class="hs-identifier">IEThing</span></a></a><span> </span><a href="HieTypes.html#IEType"><span class="hs-identifier hs-type">IEType</span></a><span>     </span><span class="hs-comment">-- ^ import/export</span><span>
</span><a name="line-300"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TyDecl"><a href="HieTypes.html#TyDecl"><span class="hs-identifier">TyDecl</span></a></a><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span>  </span><span class="hs-comment">-- | Value binding</span><span>
</span><a name="line-303"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ValBind"><a href="HieTypes.html#ValBind"><span class="hs-identifier">ValBind</span></a></a><span>
</span><a name="line-304"></a><span>      </span><a href="HieTypes.html#BindType"><span class="hs-identifier hs-type">BindType</span></a><span>     </span><span class="hs-comment">-- ^ whether or not the binding is in an instance</span><span>
</span><a name="line-305"></a><span>      </span><a href="HieTypes.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span>        </span><span class="hs-comment">-- ^ scope over which the value is bound</span><span>
</span><a name="line-306"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HieTypes.html#Span"><span class="hs-identifier hs-type">Span</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ span of entire binding</span><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span>  </span><span class="hs-comment">-- | Pattern binding</span><span>
</span><a name="line-309"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-310"></a><span>  </span><span class="hs-comment">-- This case is tricky because the bound identifier can be used in two</span><span>
</span><a name="line-311"></a><span>  </span><span class="hs-comment">-- distinct scopes. Consider the following example (with @-XViewPatterns@)</span><span>
</span><a name="line-312"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-313"></a><span>  </span><span class="hs-comment">-- @</span><span>
</span><a name="line-314"></a><span>  </span><span class="hs-comment">-- do (b, a, (a -&gt; True)) &lt;- bar</span><span>
</span><a name="line-315"></a><span>  </span><span class="hs-comment">--    foo a</span><span>
</span><a name="line-316"></a><span>  </span><span class="hs-comment">-- @</span><span>
</span><a name="line-317"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-318"></a><span>  </span><span class="hs-comment">-- The identifier @a@ has two scopes: in the view pattern @(a -&gt; True)@ and</span><span>
</span><a name="line-319"></a><span>  </span><span class="hs-comment">-- in the rest of the @do@-block in @foo a@.</span><span>
</span><a name="line-320"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatternBind"><a href="HieTypes.html#PatternBind"><span class="hs-identifier">PatternBind</span></a></a><span>
</span><a name="line-321"></a><span>      </span><a href="HieTypes.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span>        </span><span class="hs-comment">-- ^ scope /in the pattern/ (the variable bound can be used</span><span>
</span><a name="line-322"></a><span>                   </span><span class="hs-comment">-- further in the pattern)</span><span>
</span><a name="line-323"></a><span>      </span><a href="HieTypes.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span>        </span><span class="hs-comment">-- ^ rest of the scope outside the pattern</span><span>
</span><a name="line-324"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HieTypes.html#Span"><span class="hs-identifier hs-type">Span</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ span of entire binding</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ClassTyDecl"><a href="HieTypes.html#ClassTyDecl"><span class="hs-identifier">ClassTyDecl</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HieTypes.html#Span"><span class="hs-identifier hs-type">Span</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span>  </span><span class="hs-comment">-- | Declaration</span><span>
</span><a name="line-329"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Decl"><a href="HieTypes.html#Decl"><span class="hs-identifier">Decl</span></a></a><span>
</span><a name="line-330"></a><span>      </span><a href="HieTypes.html#DeclType"><span class="hs-identifier hs-type">DeclType</span></a><span>     </span><span class="hs-comment">-- ^ type of declaration</span><span>
</span><a name="line-331"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HieTypes.html#Span"><span class="hs-identifier hs-type">Span</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ span of entire binding</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span>  </span><span class="hs-comment">-- | Type variable</span><span>
</span><a name="line-334"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TyVarBind"><a href="HieTypes.html#TyVarBind"><span class="hs-identifier">TyVarBind</span></a></a><span> </span><a href="HieTypes.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><a href="HieTypes.html#TyVarScope"><span class="hs-identifier hs-type">TyVarScope</span></a><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span>  </span><span class="hs-comment">-- | Record field</span><span>
</span><a name="line-337"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RecField"><a href="HieTypes.html#RecField"><span class="hs-identifier">RecField</span></a></a><span> </span><a href="HieTypes.html#RecFieldContext"><span class="hs-identifier hs-type">RecFieldContext</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HieTypes.html#Span"><span class="hs-identifier hs-type">Span</span></a><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="HieTypes.html#ContextInfo"><span class="hs-identifier hs-type">ContextInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-341"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="HieTypes.html#ContextInfo"><span class="hs-identifier hs-type">ContextInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-344"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650313"><a href="#local-6989586621679650313"><span class="hs-identifier">bh</span></a></a><span> </span><a href="HieTypes.html#Use"><span class="hs-identifier hs-var">Use</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650313"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650314"><a href="#local-6989586621679650314"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#IEThing"><span class="hs-identifier hs-var">IEThing</span></a><span> </span><a name="local-6989586621679650315"><a href="#local-6989586621679650315"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650314"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-347"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650314"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650315"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-348"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650316"><a href="#local-6989586621679650316"><span class="hs-identifier">bh</span></a></a><span> </span><a href="HieTypes.html#TyDecl"><span class="hs-identifier hs-var">TyDecl</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650316"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-349"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650317"><a href="#local-6989586621679650317"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#ValBind"><span class="hs-identifier hs-var">ValBind</span></a><span> </span><a name="local-6989586621679650318"><a href="#local-6989586621679650318"><span class="hs-identifier">bt</span></a></a><span> </span><a name="local-6989586621679650319"><a href="#local-6989586621679650319"><span class="hs-identifier">sc</span></a></a><span> </span><a name="local-6989586621679650320"><a href="#local-6989586621679650320"><span class="hs-identifier">msp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-350"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650317"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-351"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650317"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650318"><span class="hs-identifier hs-var">bt</span></a><span>
</span><a name="line-352"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650317"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650319"><span class="hs-identifier hs-var">sc</span></a><span>
</span><a name="line-353"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650317"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650320"><span class="hs-identifier hs-var">msp</span></a><span>
</span><a name="line-354"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650321"><a href="#local-6989586621679650321"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#PatternBind"><span class="hs-identifier hs-var">PatternBind</span></a><span> </span><a name="local-6989586621679650322"><a href="#local-6989586621679650322"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679650323"><a href="#local-6989586621679650323"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679650324"><a href="#local-6989586621679650324"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-355"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650321"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-356"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650321"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650322"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-357"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650321"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650323"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-358"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650321"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650324"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-359"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650325"><a href="#local-6989586621679650325"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#ClassTyDecl"><span class="hs-identifier hs-var">ClassTyDecl</span></a><span> </span><a name="local-6989586621679650326"><a href="#local-6989586621679650326"><span class="hs-identifier">sp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-360"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650325"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-361"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650325"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650326"><span class="hs-identifier hs-var">sp</span></a><span>
</span><a name="line-362"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650327"><a href="#local-6989586621679650327"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#Decl"><span class="hs-identifier hs-var">Decl</span></a><span> </span><a name="local-6989586621679650328"><a href="#local-6989586621679650328"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679650329"><a href="#local-6989586621679650329"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-363"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650327"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-364"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650327"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650328"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-365"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650327"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650329"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-366"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650330"><a href="#local-6989586621679650330"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#TyVarBind"><span class="hs-identifier hs-var">TyVarBind</span></a><span> </span><a name="local-6989586621679650331"><a href="#local-6989586621679650331"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679650332"><a href="#local-6989586621679650332"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-367"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650330"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">7</span><span>
</span><a name="line-368"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650330"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650331"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-369"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650330"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650332"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-370"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650333"><a href="#local-6989586621679650333"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#RecField"><span class="hs-identifier hs-var">RecField</span></a><span> </span><a name="local-6989586621679650334"><a href="#local-6989586621679650334"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679650335"><a href="#local-6989586621679650335"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-371"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650333"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">8</span><span>
</span><a name="line-372"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650333"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650334"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-373"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650333"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650335"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-374"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650336"><a href="#local-6989586621679650336"><span class="hs-identifier">bh</span></a></a><span> </span><a href="HieTypes.html#MatchBind"><span class="hs-identifier hs-var">MatchBind</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650336"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">9</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650337"><a href="#local-6989586621679650337"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-377"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679650338"><a href="#local-6989586621679650338"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-378"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679650338"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-379"></a><span>      </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HieTypes.html#Use"><span class="hs-identifier hs-var">Use</span></a><span>
</span><a name="line-380"></a><span>      </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#IEThing"><span class="hs-identifier hs-var">IEThing</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-381"></a><span>      </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HieTypes.html#TyDecl"><span class="hs-identifier hs-var">TyDecl</span></a><span>
</span><a name="line-382"></a><span>      </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#ValBind"><span class="hs-identifier hs-var">ValBind</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-383"></a><span>      </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#PatternBind"><span class="hs-identifier hs-var">PatternBind</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-384"></a><span>      </span><span class="hs-number">5</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#ClassTyDecl"><span class="hs-identifier hs-var">ClassTyDecl</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-385"></a><span>      </span><span class="hs-number">6</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#Decl"><span class="hs-identifier hs-var">Decl</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-386"></a><span>      </span><span class="hs-number">7</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#TyVarBind"><span class="hs-identifier hs-var">TyVarBind</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-387"></a><span>      </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#RecField"><span class="hs-identifier hs-var">RecField</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650337"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-388"></a><span>      </span><span class="hs-number">9</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HieTypes.html#MatchBind"><span class="hs-identifier hs-var">MatchBind</span></a><span>
</span><a name="line-389"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;Binary ContextInfo: invalid tag&quot;</span><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-comment">-- | Types of imports and exports</span><span>
</span><a name="line-393"></a><span class="hs-keyword">data</span><span> </span><a name="IEType"><a href="HieTypes.html#IEType"><span class="hs-identifier">IEType</span></a></a><span>
</span><a name="line-394"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Import"><a href="HieTypes.html#Import"><span class="hs-identifier">Import</span></a></a><span>
</span><a name="line-395"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImportAs"><a href="HieTypes.html#ImportAs"><span class="hs-identifier">ImportAs</span></a></a><span>
</span><a name="line-396"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImportHiding"><a href="HieTypes.html#ImportHiding"><span class="hs-identifier">ImportHiding</span></a></a><span>
</span><a name="line-397"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Export"><a href="HieTypes.html#Export"><span class="hs-identifier">Export</span></a></a><span>
</span><a name="line-398"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="HieTypes.html#IEType"><span class="hs-identifier hs-type">IEType</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-401"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650309"><a href="#local-6989586621679650309"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650310"><a href="#local-6989586621679650310"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650309"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679650310"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650311"><a href="#local-6989586621679650311"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679650312"><a href="#local-6989586621679650312"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getByte</span><span> </span><a href="#local-6989586621679650311"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679650312"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-keyword">data</span><span> </span><a name="RecFieldContext"><a href="HieTypes.html#RecFieldContext"><span class="hs-identifier">RecFieldContext</span></a></a><span>
</span><a name="line-406"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="RecFieldDecl"><a href="HieTypes.html#RecFieldDecl"><span class="hs-identifier">RecFieldDecl</span></a></a><span>
</span><a name="line-407"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RecFieldAssign"><a href="HieTypes.html#RecFieldAssign"><span class="hs-identifier">RecFieldAssign</span></a></a><span>
</span><a name="line-408"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RecFieldMatch"><a href="HieTypes.html#RecFieldMatch"><span class="hs-identifier">RecFieldMatch</span></a></a><span>
</span><a name="line-409"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RecFieldOcc"><a href="HieTypes.html#RecFieldOcc"><span class="hs-identifier">RecFieldOcc</span></a></a><span>
</span><a name="line-410"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="HieTypes.html#RecFieldContext"><span class="hs-identifier hs-type">RecFieldContext</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-413"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650305"><a href="#local-6989586621679650305"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650306"><a href="#local-6989586621679650306"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650305"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679650306"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-414"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650307"><a href="#local-6989586621679650307"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679650308"><a href="#local-6989586621679650308"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getByte</span><span> </span><a href="#local-6989586621679650307"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679650308"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-keyword">data</span><span> </span><a name="BindType"><a href="HieTypes.html#BindType"><span class="hs-identifier">BindType</span></a></a><span>
</span><a name="line-418"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="RegularBind"><a href="HieTypes.html#RegularBind"><span class="hs-identifier">RegularBind</span></a></a><span>
</span><a name="line-419"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InstanceBind"><a href="HieTypes.html#InstanceBind"><span class="hs-identifier">InstanceBind</span></a></a><span>
</span><a name="line-420"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="HieTypes.html#BindType"><span class="hs-identifier hs-type">BindType</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-423"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650301"><a href="#local-6989586621679650301"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650302"><a href="#local-6989586621679650302"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650301"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679650302"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650303"><a href="#local-6989586621679650303"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679650304"><a href="#local-6989586621679650304"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getByte</span><span> </span><a href="#local-6989586621679650303"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679650304"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-keyword">data</span><span> </span><a name="DeclType"><a href="HieTypes.html#DeclType"><span class="hs-identifier">DeclType</span></a></a><span>
</span><a name="line-428"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="FamDec"><a href="HieTypes.html#FamDec"><span class="hs-identifier">FamDec</span></a></a><span>     </span><span class="hs-comment">-- ^ type or data family</span><span>
</span><a name="line-429"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SynDec"><a href="HieTypes.html#SynDec"><span class="hs-identifier">SynDec</span></a></a><span>     </span><span class="hs-comment">-- ^ type synonym</span><span>
</span><a name="line-430"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DataDec"><a href="HieTypes.html#DataDec"><span class="hs-identifier">DataDec</span></a></a><span>    </span><span class="hs-comment">-- ^ data declaration</span><span>
</span><a name="line-431"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ConDec"><a href="HieTypes.html#ConDec"><span class="hs-identifier">ConDec</span></a></a><span>     </span><span class="hs-comment">-- ^ constructor declaration</span><span>
</span><a name="line-432"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatSynDec"><a href="HieTypes.html#PatSynDec"><span class="hs-identifier">PatSynDec</span></a></a><span>  </span><span class="hs-comment">-- ^ pattern synonym</span><span>
</span><a name="line-433"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ClassDec"><a href="HieTypes.html#ClassDec"><span class="hs-identifier">ClassDec</span></a></a><span>   </span><span class="hs-comment">-- ^ class declaration</span><span>
</span><a name="line-434"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InstDec"><a href="HieTypes.html#InstDec"><span class="hs-identifier">InstDec</span></a></a><span>    </span><span class="hs-comment">-- ^ instance declaration</span><span>
</span><a name="line-435"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">)</span><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="HieTypes.html#DeclType"><span class="hs-identifier hs-type">DeclType</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-438"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650297"><a href="#local-6989586621679650297"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621679650298"><a href="#local-6989586621679650298"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650297"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679650298"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650299"><a href="#local-6989586621679650299"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679650300"><a href="#local-6989586621679650300"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getByte</span><span> </span><a href="#local-6989586621679650299"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679650300"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span>
</span><a name="line-442"></a><span class="hs-keyword">data</span><span> </span><a name="Scope"><a href="HieTypes.html#Scope"><span class="hs-identifier">Scope</span></a></a><span>
</span><a name="line-443"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoScope"><a href="HieTypes.html#NoScope"><span class="hs-identifier">NoScope</span></a></a><span>
</span><a name="line-444"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LocalScope"><a href="HieTypes.html#LocalScope"><span class="hs-identifier">LocalScope</span></a></a><span> </span><a href="HieTypes.html#Span"><span class="hs-identifier hs-type">Span</span></a><span>
</span><a name="line-445"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ModuleScope"><a href="HieTypes.html#ModuleScope"><span class="hs-identifier">ModuleScope</span></a></a><span>
</span><a name="line-446"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Data</span><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>
</span><a name="line-448"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="HieTypes.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-449"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><a href="HieTypes.html#NoScope"><span class="hs-identifier hs-var">NoScope</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;NoScope&quot;</span><span>
</span><a name="line-450"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HieTypes.html#LocalScope"><span class="hs-identifier hs-var">LocalScope</span></a><span> </span><a name="local-6989586621679650296"><a href="#local-6989586621679650296"><span class="hs-identifier">sp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;LocalScope&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621679650296"><span class="hs-identifier hs-var">sp</span></a><span>
</span><a name="line-451"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="HieTypes.html#ModuleScope"><span class="hs-identifier hs-var">ModuleScope</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ModuleScope&quot;</span><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="HieTypes.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-454"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650290"><a href="#local-6989586621679650290"><span class="hs-identifier">bh</span></a></a><span> </span><a href="HieTypes.html#NoScope"><span class="hs-identifier hs-var">NoScope</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650290"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-455"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650291"><a href="#local-6989586621679650291"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#LocalScope"><span class="hs-identifier hs-var">LocalScope</span></a><span> </span><a name="local-6989586621679650292"><a href="#local-6989586621679650292"><span class="hs-identifier">span</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-456"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650291"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-457"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650291"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650292"><span class="hs-identifier hs-var">span</span></a><span>
</span><a name="line-458"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650293"><a href="#local-6989586621679650293"><span class="hs-identifier">bh</span></a></a><span> </span><a href="HieTypes.html#ModuleScope"><span class="hs-identifier hs-var">ModuleScope</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650293"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650294"><a href="#local-6989586621679650294"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-461"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679650295"><a href="#local-6989586621679650295"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650294"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-462"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679650295"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-463"></a><span>      </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HieTypes.html#NoScope"><span class="hs-identifier hs-var">NoScope</span></a><span>
</span><a name="line-464"></a><span>      </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#LocalScope"><span class="hs-identifier hs-var">LocalScope</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650294"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-465"></a><span>      </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HieTypes.html#ModuleScope"><span class="hs-identifier hs-var">ModuleScope</span></a><span>
</span><a name="line-466"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;Binary Scope: invalid tag&quot;</span><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-comment">-- | Scope of a type variable.</span><span>
</span><a name="line-470"></a><span class="hs-comment">--</span><span>
</span><a name="line-471"></a><span class="hs-comment">-- This warrants a data type apart from 'Scope' because of complexities</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- introduced by features like @-XScopedTypeVariables@ and @-XInstanceSigs@. For</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- example, consider:</span><span>
</span><a name="line-474"></a><span class="hs-comment">--</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-476"></a><span class="hs-comment">-- foo, bar, baz :: forall a. a -&gt; a</span><span>
</span><a name="line-477"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-478"></a><span class="hs-comment">--</span><span>
</span><a name="line-479"></a><span class="hs-comment">-- Here @a@ is in scope in all the definitions of @foo@, @bar@, and @baz@, so we</span><span>
</span><a name="line-480"></a><span class="hs-comment">-- need a list of scopes to keep track of this. Furthermore, this list cannot be</span><span>
</span><a name="line-481"></a><span class="hs-comment">-- computed until we resolve the binding sites of @foo@, @bar@, and @baz@.</span><span>
</span><a name="line-482"></a><span class="hs-comment">--</span><span>
</span><a name="line-483"></a><span class="hs-comment">-- Consequently, @a@ starts with an @'UnresolvedScope' [foo, bar, baz] Nothing@</span><span>
</span><a name="line-484"></a><span class="hs-comment">-- which later gets resolved into a 'ResolvedScopes'.</span><span>
</span><a name="line-485"></a><span class="hs-keyword">data</span><span> </span><a name="TyVarScope"><a href="HieTypes.html#TyVarScope"><span class="hs-identifier">TyVarScope</span></a></a><span>
</span><a name="line-486"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ResolvedScopes"><a href="HieTypes.html#ResolvedScopes"><span class="hs-identifier">ResolvedScopes</span></a></a><span> </span><span class="hs-special">[</span><a href="HieTypes.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span class="hs-special">]</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span>  </span><span class="hs-comment">-- | Unresolved scopes should never show up in the final @.hie@ file</span><span>
</span><a name="line-489"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UnresolvedScope"><a href="HieTypes.html#UnresolvedScope"><span class="hs-identifier">UnresolvedScope</span></a></a><span>
</span><a name="line-490"></a><span>        </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- ^ names of the definitions over which the scope spans</span><span>
</span><a name="line-491"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HieTypes.html#Span"><span class="hs-identifier hs-type">Span</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ the location of the instance/class declaration for</span><span>
</span><a name="line-492"></a><span>                      </span><span class="hs-comment">-- the case where the type variable is declared in a</span><span>
</span><a name="line-493"></a><span>                      </span><span class="hs-comment">-- method type signature</span><span>
</span><a name="line-494"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="HieTypes.html#TyVarScope"><span class="hs-identifier hs-type">TyVarScope</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-497"></a><span>  </span><a name="local-8214565720323790323"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#ResolvedScopes"><span class="hs-identifier hs-var">ResolvedScopes</span></a><span> </span><a name="local-6989586621679650289"><a href="#local-6989586621679650289"><span class="hs-identifier">sc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679650289"><span class="hs-identifier hs-var">sc</span></a><span>
</span><a name="line-498"></a><span>  </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;UnresolvedScope&quot;</span><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="HieTypes.html#TyVarScope"><span class="hs-identifier hs-type">TyVarScope</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-501"></a><span>  </span><a name="local-8214565720323805157"><span class="hs-identifier">put_</span></a><span> </span><a name="local-6989586621679650282"><a href="#local-6989586621679650282"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#ResolvedScopes"><span class="hs-identifier hs-var">ResolvedScopes</span></a><span> </span><a name="local-6989586621679650283"><a href="#local-6989586621679650283"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-502"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650282"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-503"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650282"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650283"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-504"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621679650284"><a href="#local-6989586621679650284"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HieTypes.html#UnresolvedScope"><span class="hs-identifier hs-var">UnresolvedScope</span></a><span> </span><a name="local-6989586621679650285"><a href="#local-6989586621679650285"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621679650286"><a href="#local-6989586621679650286"><span class="hs-identifier">span</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-505"></a><span>    </span><span class="hs-identifier hs-var">putByte</span><span> </span><a href="#local-6989586621679650284"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-506"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650284"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650285"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-507"></a><span>    </span><span class="hs-identifier hs-var">put_</span><span> </span><a href="#local-6989586621679650284"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621679650286"><span class="hs-identifier hs-var">span</span></a><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span>  </span><a name="local-8214565720323805155"><span class="hs-identifier">get</span></a><span> </span><a name="local-6989586621679650287"><a href="#local-6989586621679650287"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-510"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679650288"><a href="#local-6989586621679650288"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650287"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-511"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679650288"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-512"></a><span>      </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#ResolvedScopes"><span class="hs-identifier hs-var">ResolvedScopes</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650287"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-513"></a><span>      </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HieTypes.html#UnresolvedScope"><span class="hs-identifier hs-var">UnresolvedScope</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650287"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><a href="#local-6989586621679650287"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-514"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;Binary TyVarScope: invalid tag&quot;</span><span>
</span><a name="line-515"></a></pre></body></html>