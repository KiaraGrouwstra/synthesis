<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">--</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Pretty-printing TyThings</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- (c) The GHC Team 2005</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-10"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PprTyThing</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-11"></a><span>        </span><a href="PprTyThing.html#pprTyThing"><span class="hs-identifier hs-var">pprTyThing</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="PprTyThing.html#pprTyThingInContext"><span class="hs-identifier hs-var">pprTyThingInContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="PprTyThing.html#pprTyThingLoc"><span class="hs-identifier hs-var">pprTyThingLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="PprTyThing.html#pprTyThingInContextLoc"><span class="hs-identifier hs-var">pprTyThingInContextLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="PprTyThing.html#pprTyThingHdr"><span class="hs-identifier hs-var">pprTyThingHdr</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="PprTyThing.html#pprTypeForUser"><span class="hs-identifier hs-var">pprTypeForUser</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="PprTyThing.html#pprFamInst"><span class="hs-identifier hs-var">pprFamInst</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ArgFlag</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkTyVarBinders</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprUserForAll</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">IfaceSyn</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ShowSub</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ShowHowMuch</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">AltPpr</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">showToHeader</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprIfaceDecl</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoAxiom</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">coAxiomTyCon</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HscTypes</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">tyThingParent_maybe</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="MkIface.html"><span class="hs-identifier">MkIface</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="MkIface.html#tyThingToIfaceDecl"><span class="hs-identifier hs-var">tyThingToIfaceDecl</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">tidyOpenType</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FamInstEnv</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">FamInst</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FamFlavor</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprTypeApp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprSigmaType</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">VarEnv</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">emptyTidyEnv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- Pretty-printing entities that we get from the GHC API</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">{- Note [Pretty printing via IfaceSyn]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Our general plan for prett-printing
  - Types
  - TyCons
  - Classes
  - Pattern synonyms
  ...etc...

is to convert them to IfaceSyn, and pretty-print that. For example
  - pprType converts a Type to an IfaceType, and pretty prints that.
  - pprTyThing converts the TyThing to an IfaceDecl,
    and pretty prints that.

So IfaceSyn play a dual role:
  - it's the internal version of an interface files
  - it's used for pretty-printing

Why do this?

* A significant reason is that we need to be able
  to pretty-print IfaceSyn (to display Foo.hi), and it was a
  pain to duplicate masses of pretty-printing goop, esp for
  Type and IfaceType.

* When pretty-printing (a type, say), we want to tidy (with
  tidyType) to avoids having (forall a a. blah) where the two
  a's have different uniques.

  Alas, for type constructors, TyCon, tidying does not work well,
  because a TyCon includes DataCons which include Types, which mention
  TyCons. And tidying can't tidy a mutually recursive data structure
  graph, only trees.

* Interface files contains fast-strings, not uniques, so the very same
  tidying must take place when we convert to IfaceDecl. E.g.
  MkIface.tyThingToIfaceDecl which converts a TyThing (i.e. TyCon,
  Class etc) to an IfaceDecl.

  Bottom line: IfaceDecls are already 'tidy', so it's straightforward
  to print them.

* An alternative I once explored was to ensure that TyCons get type
  variables with distinct print-names. That's ok for type variables
  but less easy for kind variables. Processing data type declarations
  is already so complicated that I don't think it's sensible to add
  the extra requirement that it generates only &quot;pretty&quot; types and
  kinds.

Consequences:

- IfaceSyn (and IfaceType) must contain enough information to
  print nicely.  Hence, for example, the IfaceAppArgs type, which
  allows us to suppress invisible kind arguments in types
  (see Note [Suppressing invisible arguments] in IfaceType)

- In a few places we have info that is used only for pretty-printing,
  and is totally ignored when turning IfaceSyn back into TyCons
  etc (in TcIface). For example, IfaceClosedSynFamilyTyCon
  stores a [IfaceAxBranch] that is used only for pretty-printing.

- See Note [Free tyvars in IfaceType] in IfaceType

See #7730, #8776 for details   -}</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- | Pretty-prints a 'FamInst' (type/data family instance) with its defining location.</span><span>
</span><a name="line-107"></a><span class="hs-identifier">pprFamInst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInst</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-108"></a><span class="hs-comment">--  * For data instances we go via pprTyThing of the representational TyCon,</span><span>
</span><a name="line-109"></a><span class="hs-comment">--    because there is already much cleverness associated with printing</span><span>
</span><a name="line-110"></a><span class="hs-comment">--    data type declarations that I don't want to duplicate</span><span>
</span><a name="line-111"></a><span class="hs-comment">--  * For type instances we print directly here; there is no TyCon</span><span>
</span><a name="line-112"></a><span class="hs-comment">--    to give to pprTyThing</span><span>
</span><a name="line-113"></a><span class="hs-comment">--</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- FamInstEnv.pprFamInst does a more quick-and-dirty job for internal purposes</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><a name="pprFamInst"><a href="PprTyThing.html#pprFamInst"><span class="hs-identifier">pprFamInst</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FamInst</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fi_flavor</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DataFamilyInst</span><span> </span><a name="local-6989586621682580106"><a href="#local-6989586621682580106"><span class="hs-identifier">rep_tc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PprTyThing.html#pprTyThingInContextLoc"><span class="hs-identifier hs-var">pprTyThingInContextLoc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ATyCon</span><span> </span><a href="#local-6989586621682580106"><span class="hs-identifier hs-var">rep_tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-identifier">pprFamInst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FamInst</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fi_flavor</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SynFamilyInst</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fi_axiom</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682580107"><a href="#local-6989586621682580107"><span class="hs-identifier">axiom</span></a></a><span>
</span><a name="line-120"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fi_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682580108"><a href="#local-6989586621682580108"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fi_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682580109"><a href="#local-6989586621682580109"><span class="hs-identifier">lhs_tys</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fi_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682580110"><a href="#local-6989586621682580110"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PprTyThing.html#showWithLoc"><span class="hs-identifier hs-var">showWithLoc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprDefinedAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getName</span><span> </span><a href="#local-6989586621682580107"><span class="hs-identifier hs-var">axiom</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;type instance&quot;</span><span>
</span><a name="line-123"></a><span>            </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprUserForAll</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarBinders</span><span> </span><span class="hs-identifier hs-var">Specified</span><span> </span><a href="#local-6989586621682580108"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>                </span><span class="hs-comment">-- See Note [Printing foralls in type family instances]</span><span>
</span><a name="line-125"></a><span>                </span><span class="hs-comment">-- in IfaceType</span><span>
</span><a name="line-126"></a><span>            </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprTypeApp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coAxiomTyCon</span><span> </span><a href="#local-6989586621682580107"><span class="hs-identifier hs-var">axiom</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682580109"><span class="hs-identifier hs-var">lhs_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">equals</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682580110"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-comment">----------------------------</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- | Pretty-prints a 'TyThing' with its defining location.</span><span>
</span><a name="line-131"></a><span class="hs-identifier">pprTyThingLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-132"></a><a name="pprTyThingLoc"><a href="PprTyThing.html#pprTyThingLoc"><span class="hs-identifier">pprTyThingLoc</span></a></a><span> </span><a name="local-6989586621682580111"><a href="#local-6989586621682580111"><span class="hs-identifier">tyThing</span></a></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PprTyThing.html#showWithLoc"><span class="hs-identifier hs-var">showWithLoc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprDefinedAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getName</span><span> </span><a href="#local-6989586621682580111"><span class="hs-identifier hs-var">tyThing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>                </span><span class="hs-special">(</span><a href="PprTyThing.html#pprTyThing"><span class="hs-identifier hs-var">pprTyThing</span></a><span> </span><span class="hs-identifier hs-var">showToHeader</span><span> </span><a href="#local-6989586621682580111"><span class="hs-identifier hs-var">tyThing</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Pretty-prints the 'TyThing' header. For functions and data constructors</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- the function is equivalent to 'pprTyThing' but for type constructors</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- and classes it prints only the header part of the declaration.</span><span>
</span><a name="line-139"></a><span class="hs-identifier">pprTyThingHdr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-140"></a><a name="pprTyThingHdr"><a href="PprTyThing.html#pprTyThingHdr"><span class="hs-identifier">pprTyThingHdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PprTyThing.html#pprTyThing"><span class="hs-identifier hs-var">pprTyThing</span></a><span> </span><span class="hs-identifier hs-var">showToHeader</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- | Pretty-prints a 'TyThing' in context: that is, if the entity</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- is a data constructor, record selector, or class method, then</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- the entity's parent declaration is pretty-printed with irrelevant</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- parts omitted.</span><span>
</span><a name="line-146"></a><span class="hs-identifier">pprTyThingInContext</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ShowSub</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-147"></a><a name="pprTyThingInContext"><a href="PprTyThing.html#pprTyThingInContext"><span class="hs-identifier">pprTyThingInContext</span></a></a><span> </span><a name="local-6989586621682580112"><a href="#local-6989586621682580112"><span class="hs-identifier">show_sub</span></a></a><span> </span><a name="local-6989586621682580113"><a href="#local-6989586621682580113"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-148"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682580114"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621682580113"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-149"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-150"></a><span>    </span><a name="local-6989586621682580114"><a href="#local-6989586621682580114"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621682580115"><a href="#local-6989586621682580115"><span class="hs-identifier">ss</span></a></a><span> </span><a name="local-6989586621682580116"><a href="#local-6989586621682580116"><span class="hs-identifier">thing</span></a></a><span>
</span><a name="line-151"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tyThingParent_maybe</span><span> </span><a href="#local-6989586621682580116"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-152"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682580117"><a href="#local-6989586621682580117"><span class="hs-identifier">parent</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-153"></a><span>            </span><a href="#local-6989586621682580114"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getOccName</span><span> </span><a href="#local-6989586621682580116"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621682580115"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682580117"><span class="hs-identifier hs-var">parent</span></a><span>
</span><a name="line-154"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-155"></a><span>            </span><a href="PprTyThing.html#pprTyThing"><span class="hs-identifier hs-var">pprTyThing</span></a><span>
</span><a name="line-156"></a><span>              </span><span class="hs-special">(</span><a href="#local-6989586621682580112"><span class="hs-identifier hs-var">show_sub</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ss_how_much</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ShowSome</span><span> </span><a href="#local-6989586621682580115"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AltPpr</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>              </span><a href="#local-6989586621682580116"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-- | Like 'pprTyThingInContext', but adds the defining location.</span><span>
</span><a name="line-160"></a><span class="hs-identifier">pprTyThingInContextLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-161"></a><a name="pprTyThingInContextLoc"><a href="PprTyThing.html#pprTyThingInContextLoc"><span class="hs-identifier">pprTyThingInContextLoc</span></a></a><span> </span><a name="local-6989586621682580118"><a href="#local-6989586621682580118"><span class="hs-identifier">tyThing</span></a></a><span>
</span><a name="line-162"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PprTyThing.html#showWithLoc"><span class="hs-identifier hs-var">showWithLoc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprDefinedAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getName</span><span> </span><a href="#local-6989586621682580118"><span class="hs-identifier hs-var">tyThing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>                </span><span class="hs-special">(</span><a href="PprTyThing.html#pprTyThingInContext"><span class="hs-identifier hs-var">pprTyThingInContext</span></a><span> </span><span class="hs-identifier hs-var">showToHeader</span><span> </span><a href="#local-6989586621682580118"><span class="hs-identifier hs-var">tyThing</span></a><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- | Pretty-prints a 'TyThing'.</span><span>
</span><a name="line-166"></a><span class="hs-identifier">pprTyThing</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ShowSub</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyThing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- We pretty-print 'TyThing' via 'IfaceDecl'</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- See Note [Pretty-printing TyThings]</span><span>
</span><a name="line-169"></a><a name="pprTyThing"><a href="PprTyThing.html#pprTyThing"><span class="hs-identifier">pprTyThing</span></a></a><span> </span><a name="local-6989586621682580119"><a href="#local-6989586621682580119"><span class="hs-identifier">ss</span></a></a><span> </span><a name="local-6989586621682580120"><a href="#local-6989586621682580120"><span class="hs-identifier">ty_thing</span></a></a><span>
</span><a name="line-170"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprIfaceDecl</span><span> </span><a href="#local-6989586621682580121"><span class="hs-identifier hs-var">ss'</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#tyThingToIfaceDecl"><span class="hs-identifier hs-var">tyThingToIfaceDecl</span></a><span> </span><a href="#local-6989586621682580120"><span class="hs-identifier hs-var">ty_thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-172"></a><span>    </span><a name="local-6989586621682580121"><a href="#local-6989586621682580121"><span class="hs-identifier">ss'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">ss_how_much</span><span> </span><a href="#local-6989586621682580119"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-173"></a><span>      </span><span class="hs-identifier hs-var">ShowHeader</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AltPpr</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682580119"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ss_how_much</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ShowHeader</span><span> </span><a href="#local-6989586621682580122"><span class="hs-identifier hs-var">ppr'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-174"></a><span>      </span><span class="hs-identifier hs-var">ShowSome</span><span> </span><a name="local-6989586621682580124"><a href="#local-6989586621682580124"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AltPpr</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682580119"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ss_how_much</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ShowSome</span><span> </span><a href="#local-6989586621682580124"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621682580122"><span class="hs-identifier hs-var">ppr'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-175"></a><span>      </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682580119"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>    </span><a name="local-6989586621682580122"><a href="#local-6989586621682580122"><span class="hs-identifier">ppr'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AltPpr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621682580123"><span class="hs-identifier hs-var">ppr_bndr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getName</span><span> </span><a href="#local-6989586621682580120"><span class="hs-identifier hs-var">ty_thing</span></a><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span>    </span><span class="hs-identifier">ppr_bndr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OccName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>    </span><a name="local-6989586621682580123"><a href="#local-6989586621682580123"><span class="hs-identifier">ppr_bndr</span></a></a><span> </span><a name="local-6989586621682580125"><a href="#local-6989586621682580125"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-181"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isBuiltInSyntax</span><span> </span><a href="#local-6989586621682580125"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-182"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-183"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-184"></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">nameModule_maybe</span><span> </span><a href="#local-6989586621682580125"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-185"></a><span>             </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682580126"><a href="#local-6989586621682580126"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682580127"><a href="#local-6989586621682580127"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">getPprStyle</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682580128"><a href="#local-6989586621682580128"><span class="hs-identifier">sty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-186"></a><span>               </span><span class="hs-identifier hs-var">pprModulePrefix</span><span> </span><a href="#local-6989586621682580128"><span class="hs-identifier hs-var">sty</span></a><span> </span><a href="#local-6989586621682580126"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621682580127"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682580127"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-187"></a><span>             </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier hs-var">name</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-188"></a><span>             </span><span class="hs-comment">-- Nothing is unexpected here; TyThings have External names</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-identifier">pprTypeForUser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- The type is tidied</span><span>
</span><a name="line-192"></a><a name="pprTypeForUser"><a href="PprTyThing.html#pprTypeForUser"><span class="hs-identifier">pprTypeForUser</span></a></a><span> </span><a name="local-6989586621682580129"><a href="#local-6989586621682580129"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-193"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprSigmaType</span><span> </span><a href="#local-6989586621682580130"><span class="hs-identifier hs-var">tidy_ty</span></a><span>
</span><a name="line-194"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-195"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682580130"><a href="#local-6989586621682580130"><span class="hs-identifier">tidy_ty</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tidyOpenType</span><span> </span><span class="hs-identifier hs-var">emptyTidyEnv</span><span> </span><a href="#local-6989586621682580129"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-196"></a><span>     </span><span class="hs-comment">-- Often the types/kinds we print in ghci are fully generalised</span><span>
</span><a name="line-197"></a><span>     </span><span class="hs-comment">-- and have no free variables, but it turns out that we sometimes</span><span>
</span><a name="line-198"></a><span>     </span><span class="hs-comment">-- print un-generalised kinds (eg when doing :k T), so it's</span><span>
</span><a name="line-199"></a><span>     </span><span class="hs-comment">-- better to use tidyOpenType here</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-identifier">showWithLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-202"></a><a name="showWithLoc"><a href="PprTyThing.html#showWithLoc"><span class="hs-identifier">showWithLoc</span></a></a><span> </span><a name="local-6989586621682580131"><a href="#local-6989586621682580131"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682580132"><a href="#local-6989586621682580132"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-203"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><a href="#local-6989586621682580132"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\t'</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621682580133"><span class="hs-identifier hs-var">comment</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621682580131"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>                </span><span class="hs-comment">-- The tab tries to make them line up a bit</span><span>
</span><a name="line-205"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-206"></a><span>    </span><a name="local-6989586621682580133"><a href="#local-6989586621682580133"><span class="hs-identifier">comment</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;--&quot;</span><span>
</span><a name="line-207"></a></pre></body></html>