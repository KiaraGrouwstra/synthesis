<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RegAlloc.Graph.TrivColorable</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-4"></a><span>        </span><a href="RegAlloc.Graph.TrivColorable.html#trivColorable"><span class="hs-identifier hs-var">trivColorable</span></a><span class="hs-special">,</span><span>
</span><a name="line-5"></a><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">where</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="RegClass.html"><span class="hs-identifier">RegClass</span></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Reg.html"><span class="hs-identifier">Reg</span></a><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="GraphBase.html"><span class="hs-identifier">GraphBase</span></a><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqSet</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Panic</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-comment">-- trivColorable ---------------------------------------------------------------</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-comment">-- trivColorable function for the graph coloring allocator</span><span>
</span><a name="line-25"></a><span class="hs-comment">--</span><span>
</span><a name="line-26"></a><span class="hs-comment">--      This gets hammered by scanGraph during register allocation,</span><span>
</span><a name="line-27"></a><span class="hs-comment">--      so needs to be fairly efficient.</span><span>
</span><a name="line-28"></a><span class="hs-comment">--</span><span>
</span><a name="line-29"></a><span class="hs-comment">--      NOTE:   This only works for arcitectures with just RcInteger and RcDouble</span><span>
</span><a name="line-30"></a><span class="hs-comment">--              (which are disjoint) ie. x86, x86_64 and ppc</span><span>
</span><a name="line-31"></a><span class="hs-comment">--</span><span>
</span><a name="line-32"></a><span class="hs-comment">--      The number of allocatable regs is hard coded in here so we can do</span><span>
</span><a name="line-33"></a><span class="hs-comment">--              a fast comparison in trivColorable.</span><span>
</span><a name="line-34"></a><span class="hs-comment">--</span><span>
</span><a name="line-35"></a><span class="hs-comment">--      It's ok if these numbers are _less_ than the actual number of free</span><span>
</span><a name="line-36"></a><span class="hs-comment">--              regs, but they can't be more or the register conflict</span><span>
</span><a name="line-37"></a><span class="hs-comment">--              graph won't color.</span><span>
</span><a name="line-38"></a><span class="hs-comment">--</span><span>
</span><a name="line-39"></a><span class="hs-comment">--      If the graph doesn't color then the allocator will panic, but it won't</span><span>
</span><a name="line-40"></a><span class="hs-comment">--              generate bad object code or anything nasty like that.</span><span>
</span><a name="line-41"></a><span class="hs-comment">--</span><span>
</span><a name="line-42"></a><span class="hs-comment">--      There is an allocatableRegsInClass :: RegClass -&gt; Int, but doing</span><span>
</span><a name="line-43"></a><span class="hs-comment">--      the unboxing is too slow for us here.</span><span>
</span><a name="line-44"></a><span class="hs-comment">--      TODO: Is that still true? Could we use allocatableRegsInClass</span><span>
</span><a name="line-45"></a><span class="hs-comment">--      without losing performance now?</span><span>
</span><a name="line-46"></a><span class="hs-comment">--</span><span>
</span><a name="line-47"></a><span class="hs-comment">--      Look at includes/stg/MachRegs.h to get the numbers.</span><span>
</span><a name="line-48"></a><span class="hs-comment">--</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- Disjoint registers ----------------------------------------------------------</span><span>
</span><a name="line-52"></a><span class="hs-comment">--</span><span>
</span><a name="line-53"></a><span class="hs-comment">--      The definition has been unfolded into individual cases for speed.</span><span>
</span><a name="line-54"></a><span class="hs-comment">--      Each architecture has a different register setup, so we use a</span><span>
</span><a name="line-55"></a><span class="hs-comment">--      different regSqueeze function for each.</span><span>
</span><a name="line-56"></a><span class="hs-comment">--</span><span>
</span><a name="line-57"></a><span class="hs-identifier">accSqueeze</span><span>
</span><a name="line-58"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-59"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-60"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679992221"><span class="hs-identifier hs-type">reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">UniqSet</span><span> </span><a href="#local-6989586621679992221"><span class="hs-identifier hs-type">reg</span></a><span>
</span><a name="line-62"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><a name="accSqueeze"><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier">accSqueeze</span></a></a><span> </span><a name="local-6989586621679992222"><a href="#local-6989586621679992222"><span class="hs-identifier">count</span></a></a><span> </span><a name="local-6989586621679992223"><a href="#local-6989586621679992223"><span class="hs-identifier">maxCount</span></a></a><span> </span><a name="local-6989586621679992224"><a href="#local-6989586621679992224"><span class="hs-identifier">squeeze</span></a></a><span> </span><a name="local-6989586621679992225"><a href="#local-6989586621679992225"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679992226"><span class="hs-identifier hs-var">acc</span></a><span> </span><a href="#local-6989586621679992222"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nonDetEltsUniqSet</span><span> </span><a href="#local-6989586621679992225"><span class="hs-identifier hs-var">us</span></a><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>  </span><span class="hs-comment">-- See Note [Unique Determinism and code generation]</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679992226"><a href="#local-6989586621679992226"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679992227"><a href="#local-6989586621679992227"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679992227"><span class="hs-identifier hs-var">count</span></a><span>
</span><a name="line-67"></a><span>        </span><span class="hs-identifier">acc</span><span> </span><a name="local-6989586621679992228"><a href="#local-6989586621679992228"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679992228"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679992223"><span class="hs-identifier hs-var">maxCount</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679992228"><span class="hs-identifier hs-var">count</span></a><span>
</span><a name="line-68"></a><span>        </span><span class="hs-identifier">acc</span><span> </span><a name="local-6989586621679992229"><a href="#local-6989586621679992229"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679992230"><a href="#local-6989586621679992230"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679992231"><a href="#local-6989586621679992231"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679992226"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679992229"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679992224"><span class="hs-identifier hs-var">squeeze</span></a><span> </span><a href="#local-6989586621679992230"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679992231"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-comment">{- Note [accSqueeze]
~~~~~~~~~~~~~~~~~~~~
BL 2007/09
Doing a nice fold over the UniqSet makes trivColorable use
32% of total compile time and 42% of total alloc when compiling SHA1.hs from darcs.
Therefore the UniqFM is made non-abstract and we use custom fold.

MS 2010/04
When converting UniqFM to use Data.IntMap, the fold cannot use UniqFM internal
representation any more. But it is imperative that the accSqueeze stops
the folding if the count gets greater or equal to maxCount. We thus convert
UniqFM to a (lazy) list, do the fold and stops if necessary, which was
the most efficient variant tried. Benchmark compiling 10-times SHA1.hs follows.
(original = previous implementation, folding = fold of the whole UFM,
 lazyFold = the current implementation,
 hackFold = using internal representation of Data.IntMap)

                                 original  folding   hackFold  lazyFold
 -O -fasm (used everywhere)      31.509s   30.387s   30.791s   30.603s
                                 100.00%   96.44%    97.72%    97.12%
 -fregs-graph                    67.938s   74.875s   62.673s   64.679s
                                 100.00%   110.21%   92.25%    95.20%
 -fregs-iterative                89.761s   143.913s  81.075s   86.912s
                                 100.00%   160.33%   90.32%    96.83%
 -fnew-codegen                   38.225s   37.142s   37.551s   37.119s
                                 100.00%   97.17%    98.24%    97.11%
 -fnew-codegen -fregs-graph      91.786s   91.51s    87.368s   86.88s
                                 100.00%   99.70%    95.19%    94.65%
 -fnew-codegen -fregs-iterative  206.72s   343.632s  194.694s  208.677s
                                 100.00%   166.23%   94.18%    100.95%
-}</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-identifier">trivColorable</span><span>
</span><a name="line-103"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span>
</span><a name="line-104"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#VirtualReg"><span class="hs-identifier hs-type">VirtualReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GraphBase.html#Triv"><span class="hs-identifier hs-type">Triv</span></a><span> </span><a href="Reg.html#VirtualReg"><span class="hs-identifier hs-type">VirtualReg</span></a><span> </span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span> </span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><a name="trivColorable"><a href="RegAlloc.Graph.TrivColorable.html#trivColorable"><span class="hs-identifier">trivColorable</span></a></a><span> </span><a name="local-6989586621679992232"><a href="#local-6989586621679992232"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621679992233"><a href="#local-6989586621679992233"><span class="hs-identifier">virtualRegSqueeze</span></a></a><span> </span><a name="local-6989586621679992234"><a href="#local-6989586621679992234"><span class="hs-identifier">realRegSqueeze</span></a></a><span> </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span> </span><a name="local-6989586621679992235"><a href="#local-6989586621679992235"><span class="hs-identifier">conflicts</span></a></a><span> </span><a name="local-6989586621679992236"><a href="#local-6989586621679992236"><span class="hs-identifier">exclusions</span></a></a><span>
</span><a name="line-109"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679992237"><a href="#local-6989586621679992237"><span class="hs-identifier">cALLOCATABLE_REGS_INTEGER</span></a></a><span>
</span><a name="line-110"></a><span>                  </span><span class="hs-glyph">=</span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-6989586621679992232"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-111"></a><span>                            </span><span class="hs-identifier hs-var">ArchX86</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-112"></a><span>                            </span><span class="hs-identifier hs-var">ArchX86_64</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-113"></a><span>                            </span><span class="hs-identifier hs-var">ArchPPC</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-114"></a><span>                            </span><span class="hs-identifier hs-var">ArchSPARC</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">14</span><span>
</span><a name="line-115"></a><span>                            </span><span class="hs-identifier hs-var">ArchSPARC64</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchSPARC64&quot;</span><span>
</span><a name="line-116"></a><span>                            </span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">15</span><span>
</span><a name="line-117"></a><span>                            </span><span class="hs-identifier hs-var">ArchARM</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchARM&quot;</span><span>
</span><a name="line-118"></a><span>                            </span><span class="hs-identifier hs-var">ArchARM64</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchARM64&quot;</span><span>
</span><a name="line-119"></a><span>                            </span><span class="hs-identifier hs-var">ArchAlpha</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchAlpha&quot;</span><span>
</span><a name="line-120"></a><span>                            </span><span class="hs-identifier hs-var">ArchMipseb</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchMipseb&quot;</span><span>
</span><a name="line-121"></a><span>                            </span><span class="hs-identifier hs-var">ArchMipsel</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchMipsel&quot;</span><span>
</span><a name="line-122"></a><span>                            </span><span class="hs-identifier hs-var">ArchJavaScript</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchJavaScript&quot;</span><span>
</span><a name="line-123"></a><span>                            </span><span class="hs-identifier hs-var">ArchUnknown</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchUnknown&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679992238"><a href="#local-6989586621679992238"><span class="hs-identifier">count2</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier hs-var">accSqueeze</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679992237"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_INTEGER</span></a><span>
</span><a name="line-125"></a><span>                                </span><span class="hs-special">(</span><a href="#local-6989586621679992233"><span class="hs-identifier hs-var">virtualRegSqueeze</span></a><span> </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>                                </span><a href="#local-6989586621679992235"><span class="hs-identifier hs-var">conflicts</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679992239"><a href="#local-6989586621679992239"><span class="hs-identifier">count3</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier hs-var">accSqueeze</span></a><span>  </span><a href="#local-6989586621679992238"><span class="hs-identifier hs-var">count2</span></a><span>    </span><a href="#local-6989586621679992237"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_INTEGER</span></a><span>
</span><a name="line-129"></a><span>                                </span><span class="hs-special">(</span><a href="#local-6989586621679992234"><span class="hs-identifier hs-var">realRegSqueeze</span></a><span>   </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>                                </span><a href="#local-6989586621679992236"><span class="hs-identifier hs-var">exclusions</span></a><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679992239"><span class="hs-identifier hs-var">count3</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679992237"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_INTEGER</span></a><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-identifier">trivColorable</span><span> </span><a name="local-6989586621679992240"><a href="#local-6989586621679992240"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621679992241"><a href="#local-6989586621679992241"><span class="hs-identifier">virtualRegSqueeze</span></a></a><span> </span><a name="local-6989586621679992242"><a href="#local-6989586621679992242"><span class="hs-identifier">realRegSqueeze</span></a></a><span> </span><a href="RegClass.html#RcFloat"><span class="hs-identifier hs-var">RcFloat</span></a><span> </span><a name="local-6989586621679992243"><a href="#local-6989586621679992243"><span class="hs-identifier">conflicts</span></a></a><span> </span><a name="local-6989586621679992244"><a href="#local-6989586621679992244"><span class="hs-identifier">exclusions</span></a></a><span>
</span><a name="line-135"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679992245"><a href="#local-6989586621679992245"><span class="hs-identifier">cALLOCATABLE_REGS_FLOAT</span></a></a><span>
</span><a name="line-136"></a><span>                  </span><span class="hs-glyph">=</span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-6989586621679992240"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-137"></a><span>                            </span><span class="hs-identifier hs-var">ArchX86</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-138"></a><span>                            </span><span class="hs-identifier hs-var">ArchX86_64</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-139"></a><span>                            </span><span class="hs-identifier hs-var">ArchPPC</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-140"></a><span>                            </span><span class="hs-identifier hs-var">ArchSPARC</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">22</span><span>
</span><a name="line-141"></a><span>                            </span><span class="hs-identifier hs-var">ArchSPARC64</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchSPARC64&quot;</span><span>
</span><a name="line-142"></a><span>                            </span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-143"></a><span>                            </span><span class="hs-identifier hs-var">ArchARM</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchARM&quot;</span><span>
</span><a name="line-144"></a><span>                            </span><span class="hs-identifier hs-var">ArchARM64</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchARM64&quot;</span><span>
</span><a name="line-145"></a><span>                            </span><span class="hs-identifier hs-var">ArchAlpha</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchAlpha&quot;</span><span>
</span><a name="line-146"></a><span>                            </span><span class="hs-identifier hs-var">ArchMipseb</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchMipseb&quot;</span><span>
</span><a name="line-147"></a><span>                            </span><span class="hs-identifier hs-var">ArchMipsel</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchMipsel&quot;</span><span>
</span><a name="line-148"></a><span>                            </span><span class="hs-identifier hs-var">ArchJavaScript</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchJavaScript&quot;</span><span>
</span><a name="line-149"></a><span>                            </span><span class="hs-identifier hs-var">ArchUnknown</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchUnknown&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679992246"><a href="#local-6989586621679992246"><span class="hs-identifier">count2</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier hs-var">accSqueeze</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679992245"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_FLOAT</span></a><span>
</span><a name="line-151"></a><span>                                </span><span class="hs-special">(</span><a href="#local-6989586621679992241"><span class="hs-identifier hs-var">virtualRegSqueeze</span></a><span> </span><a href="RegClass.html#RcFloat"><span class="hs-identifier hs-var">RcFloat</span></a><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>                                </span><a href="#local-6989586621679992243"><span class="hs-identifier hs-var">conflicts</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679992247"><a href="#local-6989586621679992247"><span class="hs-identifier">count3</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier hs-var">accSqueeze</span></a><span>  </span><a href="#local-6989586621679992246"><span class="hs-identifier hs-var">count2</span></a><span>    </span><a href="#local-6989586621679992245"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_FLOAT</span></a><span>
</span><a name="line-155"></a><span>                                </span><span class="hs-special">(</span><a href="#local-6989586621679992242"><span class="hs-identifier hs-var">realRegSqueeze</span></a><span>   </span><a href="RegClass.html#RcFloat"><span class="hs-identifier hs-var">RcFloat</span></a><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>                                </span><a href="#local-6989586621679992244"><span class="hs-identifier hs-var">exclusions</span></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679992247"><span class="hs-identifier hs-var">count3</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679992245"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_FLOAT</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-identifier">trivColorable</span><span> </span><a name="local-6989586621679992248"><a href="#local-6989586621679992248"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621679992249"><a href="#local-6989586621679992249"><span class="hs-identifier">virtualRegSqueeze</span></a></a><span> </span><a name="local-6989586621679992250"><a href="#local-6989586621679992250"><span class="hs-identifier">realRegSqueeze</span></a></a><span> </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span> </span><a name="local-6989586621679992251"><a href="#local-6989586621679992251"><span class="hs-identifier">conflicts</span></a></a><span> </span><a name="local-6989586621679992252"><a href="#local-6989586621679992252"><span class="hs-identifier">exclusions</span></a></a><span>
</span><a name="line-161"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679992253"><a href="#local-6989586621679992253"><span class="hs-identifier">cALLOCATABLE_REGS_DOUBLE</span></a></a><span>
</span><a name="line-162"></a><span>                  </span><span class="hs-glyph">=</span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-6989586621679992248"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-163"></a><span>                            </span><span class="hs-identifier hs-var">ArchX86</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-164"></a><span>                            </span><span class="hs-identifier hs-var">ArchX86_64</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-165"></a><span>                            </span><span class="hs-identifier hs-var">ArchPPC</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">26</span><span>
</span><a name="line-166"></a><span>                            </span><span class="hs-identifier hs-var">ArchSPARC</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">11</span><span>
</span><a name="line-167"></a><span>                            </span><span class="hs-identifier hs-var">ArchSPARC64</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchSPARC64&quot;</span><span>
</span><a name="line-168"></a><span>                            </span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">20</span><span>
</span><a name="line-169"></a><span>                            </span><span class="hs-identifier hs-var">ArchARM</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchARM&quot;</span><span>
</span><a name="line-170"></a><span>                            </span><span class="hs-identifier hs-var">ArchARM64</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchARM64&quot;</span><span>
</span><a name="line-171"></a><span>                            </span><span class="hs-identifier hs-var">ArchAlpha</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchAlpha&quot;</span><span>
</span><a name="line-172"></a><span>                            </span><span class="hs-identifier hs-var">ArchMipseb</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchMipseb&quot;</span><span>
</span><a name="line-173"></a><span>                            </span><span class="hs-identifier hs-var">ArchMipsel</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchMipsel&quot;</span><span>
</span><a name="line-174"></a><span>                            </span><span class="hs-identifier hs-var">ArchJavaScript</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchJavaScript&quot;</span><span>
</span><a name="line-175"></a><span>                            </span><span class="hs-identifier hs-var">ArchUnknown</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchUnknown&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679992254"><a href="#local-6989586621679992254"><span class="hs-identifier">count2</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier hs-var">accSqueeze</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679992253"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_DOUBLE</span></a><span>
</span><a name="line-177"></a><span>                                </span><span class="hs-special">(</span><a href="#local-6989586621679992249"><span class="hs-identifier hs-var">virtualRegSqueeze</span></a><span> </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>                                </span><a href="#local-6989586621679992251"><span class="hs-identifier hs-var">conflicts</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679992255"><a href="#local-6989586621679992255"><span class="hs-identifier">count3</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier hs-var">accSqueeze</span></a><span>  </span><a href="#local-6989586621679992254"><span class="hs-identifier hs-var">count2</span></a><span>    </span><a href="#local-6989586621679992253"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_DOUBLE</span></a><span>
</span><a name="line-181"></a><span>                                </span><span class="hs-special">(</span><a href="#local-6989586621679992250"><span class="hs-identifier hs-var">realRegSqueeze</span></a><span>   </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>                                </span><a href="#local-6989586621679992252"><span class="hs-identifier hs-var">exclusions</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679992255"><span class="hs-identifier hs-var">count3</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679992253"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_DOUBLE</span></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-identifier">trivColorable</span><span> </span><a name="local-6989586621679992256"><a href="#local-6989586621679992256"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621679992257"><a href="#local-6989586621679992257"><span class="hs-identifier">virtualRegSqueeze</span></a></a><span> </span><a name="local-6989586621679992258"><a href="#local-6989586621679992258"><span class="hs-identifier">realRegSqueeze</span></a></a><span> </span><a href="RegClass.html#RcDoubleSSE"><span class="hs-identifier hs-var">RcDoubleSSE</span></a><span> </span><a name="local-6989586621679992259"><a href="#local-6989586621679992259"><span class="hs-identifier">conflicts</span></a></a><span> </span><a name="local-6989586621679992260"><a href="#local-6989586621679992260"><span class="hs-identifier">exclusions</span></a></a><span>
</span><a name="line-187"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679992261"><a href="#local-6989586621679992261"><span class="hs-identifier">cALLOCATABLE_REGS_SSE</span></a></a><span>
</span><a name="line-188"></a><span>                  </span><span class="hs-glyph">=</span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-6989586621679992256"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-189"></a><span>                            </span><span class="hs-identifier hs-var">ArchX86</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-190"></a><span>                            </span><span class="hs-identifier hs-var">ArchX86_64</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-191"></a><span>                            </span><span class="hs-identifier hs-var">ArchPPC</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-192"></a><span>                            </span><span class="hs-identifier hs-var">ArchSPARC</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-193"></a><span>                            </span><span class="hs-identifier hs-var">ArchSPARC64</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchSPARC64&quot;</span><span>
</span><a name="line-194"></a><span>                            </span><span class="hs-identifier hs-var">ArchPPC_64</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-195"></a><span>                            </span><span class="hs-identifier hs-var">ArchARM</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchARM&quot;</span><span>
</span><a name="line-196"></a><span>                            </span><span class="hs-identifier hs-var">ArchARM64</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchARM64&quot;</span><span>
</span><a name="line-197"></a><span>                            </span><span class="hs-identifier hs-var">ArchAlpha</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchAlpha&quot;</span><span>
</span><a name="line-198"></a><span>                            </span><span class="hs-identifier hs-var">ArchMipseb</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchMipseb&quot;</span><span>
</span><a name="line-199"></a><span>                            </span><span class="hs-identifier hs-var">ArchMipsel</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchMipsel&quot;</span><span>
</span><a name="line-200"></a><span>                            </span><span class="hs-identifier hs-var">ArchJavaScript</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchJavaScript&quot;</span><span>
</span><a name="line-201"></a><span>                            </span><span class="hs-identifier hs-var">ArchUnknown</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;trivColorable ArchUnknown&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679992262"><a href="#local-6989586621679992262"><span class="hs-identifier">count2</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier hs-var">accSqueeze</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679992261"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_SSE</span></a><span>
</span><a name="line-203"></a><span>                                </span><span class="hs-special">(</span><a href="#local-6989586621679992257"><span class="hs-identifier hs-var">virtualRegSqueeze</span></a><span> </span><a href="RegClass.html#RcDoubleSSE"><span class="hs-identifier hs-var">RcDoubleSSE</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>                                </span><a href="#local-6989586621679992259"><span class="hs-identifier hs-var">conflicts</span></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679992263"><a href="#local-6989586621679992263"><span class="hs-identifier">count3</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RegAlloc.Graph.TrivColorable.html#accSqueeze"><span class="hs-identifier hs-var">accSqueeze</span></a><span>  </span><a href="#local-6989586621679992262"><span class="hs-identifier hs-var">count2</span></a><span>    </span><a href="#local-6989586621679992261"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_SSE</span></a><span>
</span><a name="line-207"></a><span>                                </span><span class="hs-special">(</span><a href="#local-6989586621679992258"><span class="hs-identifier hs-var">realRegSqueeze</span></a><span>   </span><a href="RegClass.html#RcDoubleSSE"><span class="hs-identifier hs-var">RcDoubleSSE</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>                                </span><a href="#local-6989586621679992260"><span class="hs-identifier hs-var">exclusions</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679992263"><span class="hs-identifier hs-var">count3</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679992261"><span class="hs-identifier hs-var">cALLOCATABLE_REGS_SSE</span></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-comment">-- Specification Code ----------------------------------------------------------</span><span>
</span><a name="line-214"></a><span class="hs-comment">--</span><span>
</span><a name="line-215"></a><span class="hs-comment">--      The trivColorable function for each particular architecture should</span><span>
</span><a name="line-216"></a><span class="hs-comment">--      implement the following function, but faster.</span><span>
</span><a name="line-217"></a><span class="hs-comment">--</span><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">{-
trivColorable :: RegClass -&gt; UniqSet Reg -&gt; UniqSet Reg -&gt; Bool
trivColorable classN conflicts exclusions
 = let

        acc :: Reg -&gt; (Int, Int) -&gt; (Int, Int)
        acc r (cd, cf)
         = case regClass r of
                RcInteger       -&gt; (cd+1, cf)
                RcFloat         -&gt; (cd,   cf+1)
                _               -&gt; panic &quot;Regs.trivColorable: reg class not handled&quot;

        tmp                     = nonDetFoldUFM acc (0, 0) conflicts
        (countInt,  countFloat) = nonDetFoldUFM acc tmp    exclusions

        squeese         = worst countInt   classN RcInteger
                        + worst countFloat classN RcFloat

   in   squeese &lt; allocatableRegsInClass classN

-- | Worst case displacement
--      node N of classN has n neighbors of class C.
--
--      We currently only have RcInteger and RcDouble, which don't conflict at all.
--      This is a bit boring compared to what's in RegArchX86.
--
worst :: Int -&gt; RegClass -&gt; RegClass -&gt; Int
worst n classN classC
 = case classN of
        RcInteger
         -&gt; case classC of
                RcInteger       -&gt; min n (allocatableRegsInClass RcInteger)
                RcFloat         -&gt; 0

        RcDouble
         -&gt; case classC of
                RcFloat         -&gt; min n (allocatableRegsInClass RcFloat)
                RcInteger       -&gt; 0

-- allocatableRegs is allMachRegNos with the fixed-use regs removed.
-- i.e., these are the regs for which we are prepared to allow the
-- register allocator to attempt to map VRegs to.
allocatableRegs :: [RegNo]
allocatableRegs
   = let isFree i = freeReg i
     in  filter isFree allMachRegNos


-- | The number of regs in each class.
--      We go via top level CAFs to ensure that we're not recomputing
--      the length of these lists each time the fn is called.
allocatableRegsInClass :: RegClass -&gt; Int
allocatableRegsInClass cls
 = case cls of
        RcInteger       -&gt; allocatableRegsInteger
        RcFloat         -&gt; allocatableRegsDouble

allocatableRegsInteger :: Int
allocatableRegsInteger
        = length $ filter (\r -&gt; regClass r == RcInteger)
                 $ map RealReg allocatableRegs

allocatableRegsFloat :: Int
allocatableRegsFloat
        = length $ filter (\r -&gt; regClass r == RcFloat
                 $ map RealReg allocatableRegs
-}</span><span>
</span><a name="line-286"></a></pre></body></html>