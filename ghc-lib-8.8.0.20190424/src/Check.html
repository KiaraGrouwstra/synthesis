<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
Author: George Karachalias &lt;george.karachalias@cs.kuleuven.be&gt;

Pattern Matching Coverage Checking.
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE CPP, GADTs, DataKinds, KindSignatures #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns  #-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Check</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>        </span><span class="hs-comment">-- Checking and printing</span><span>
</span><a name="line-13"></a><span>        </span><a href="Check.html#checkSingle"><span class="hs-identifier hs-var">checkSingle</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#checkMatches"><span class="hs-identifier hs-var">checkMatches</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#checkGuardMatches"><span class="hs-identifier hs-var">checkGuardMatches</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#isAnyPmCheckEnabled"><span class="hs-identifier hs-var">isAnyPmCheckEnabled</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span>        </span><span class="hs-comment">-- See Note [Type and Term Equality Propagation]</span><span>
</span><a name="line-16"></a><span>        </span><a href="Check.html#genCaseTmCs1"><span class="hs-identifier hs-var">genCaseTmCs1</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#genCaseTmCs2"><span class="hs-identifier hs-var">genCaseTmCs2</span></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="TmOracle.html"><span class="hs-identifier">TmOracle</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unify</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">tcMatchTy</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsSyn</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="TcHsSyn.html"><span class="hs-identifier">TcHsSyn</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Id</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ConLike</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FamInstEnv</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysPrim</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tYPETyCon</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysWiredIn</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCon</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PatSyn</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HscTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CompleteMatch</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="DsMonad.html"><span class="hs-identifier">DsMonad</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="TcSimplify.html"><span class="hs-identifier">TcSimplify</span></a><span>    </span><span class="hs-special">(</span><a href="TcSimplify.html#tcCheckSatisfiability"><span class="hs-identifier hs-var">tcCheckSatisfiability</span></a><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcType</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isStringTy</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Bag</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ErrUtils</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Var</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-type">EvVar</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCoRep</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqSupply</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="DsUtils.html"><span class="hs-identifier">DsUtils</span></a><span>       </span><span class="hs-special">(</span><a href="DsUtils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Maybes</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">expectJust</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.LanguageExtensions</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">find</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isJust</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">when</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">forM_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">zipWithM</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Coercion</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcEvidence</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="TcSimplify.html"><span class="hs-identifier">TcSimplify</span></a><span>    </span><span class="hs-special">(</span><a href="TcSimplify.html#tcNormalise"><span class="hs-identifier hs-var">tcNormalise</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">IOEnv</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Semigroup</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Semi</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="ListT.html"><span class="hs-identifier">ListT</span></a><span> </span><span class="hs-special">(</span><a href="ListT.html#ListT"><span class="hs-identifier hs-type">ListT</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="ListT.html#fold"><span class="hs-identifier hs-var">fold</span></a><span class="hs-special">,</span><span> </span><a href="ListT.html#select"><span class="hs-identifier hs-var">select</span></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-comment">{-
This module checks pattern matches for:
\begin{enumerate}
  \item Equations that are redundant
  \item Equations with inaccessible right-hand-side
  \item Exhaustiveness
\end{enumerate}

The algorithm is based on the paper:

  &quot;GADTs Meet Their Match:
     Pattern-matching Warnings That Account for GADTs, Guards, and Laziness&quot;

    http://people.cs.kuleuven.be/~george.karachalias/papers/p424-karachalias.pdf

%************************************************************************
%*                                                                      *
                     Pattern Match Check Types
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-comment">-- We use the non-determinism monad to apply the algorithm to several</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- possible sets of constructors. Users can specify complete sets of</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- constructors by using COMPLETE pragmas.</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- The algorithm only picks out constructor</span><span>
</span><a name="line-93"></a><span class="hs-comment">-- sets deep in the bowels which makes a simpler `mapM` more difficult to</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- implement. The non-determinism is only used in one place, see the ConVar</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- case in `pmCheckHd`.</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-keyword">type</span><span> </span><a name="PmM"><a href="Check.html#PmM"><span class="hs-identifier">PmM</span></a></a><span> </span><a name="local-6989586621683964015"><a href="#local-6989586621683964015"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListT.html#ListT"><span class="hs-identifier hs-type">ListT</span></a><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="#local-6989586621683964015"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-identifier">liftD</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="#local-6989586621683964044"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="#local-6989586621683964044"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-100"></a><a name="liftD"><a href="Check.html#liftD"><span class="hs-identifier">liftD</span></a></a><span> </span><a name="local-6989586621683964045"><a href="#local-6989586621683964045"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ListT.html#ListT"><span class="hs-identifier hs-var">ListT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621683964046"><a href="#local-6989586621683964046"><span class="hs-identifier">sk</span></a></a><span> </span><a name="local-6989586621683964047"><a href="#local-6989586621683964047"><span class="hs-identifier">fk</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964045"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621683964048"><a href="#local-6989586621683964048"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964046"><span class="hs-identifier hs-var">sk</span></a><span> </span><a href="#local-6989586621683964048"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621683964047"><span class="hs-identifier hs-var">fk</span></a><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- Pick the first match complete covered match or otherwise the &quot;best&quot; match.</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- The best match is the one with the least uncovered clauses, ties broken</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- by the number of inaccessible clauses followed by number of redundant</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- clauses.</span><span>
</span><a name="line-106"></a><span class="hs-comment">--</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- This is specified in the</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- &quot;Disambiguating between multiple ``COMPLETE`` pragmas&quot; section of the</span><span>
</span><a name="line-109"></a><span class="hs-comment">-- users' guide. If you update the implementation of this function, make sure</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- to update that section of the users' guide as well.</span><span>
</span><a name="line-111"></a><span class="hs-identifier">getResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span>
</span><a name="line-112"></a><a name="getResult"><a href="Check.html#getResult"><span class="hs-identifier">getResult</span></a></a><span> </span><a name="local-6989586621683964049"><a href="#local-6989586621683964049"><span class="hs-identifier">ls</span></a></a><span>
</span><a name="line-113"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621683964067"><a href="#local-6989586621683964067"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ListT.html#fold"><span class="hs-identifier hs-var">fold</span></a><span> </span><a href="#local-6989586621683964049"><span class="hs-identifier hs-var">ls</span></a><span> </span><a href="#local-6989586621683964050"><span class="hs-identifier hs-var">goM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-114"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964067"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-115"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;getResult is empty&quot;</span><span>
</span><a name="line-116"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964068"><a href="#local-6989586621683964068"><span class="hs-identifier">a</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621683964068"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-117"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-identifier">goM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>    </span><a name="local-6989586621683964050"><a href="#local-6989586621683964050"><span class="hs-identifier">goM</span></a></a><span> </span><a name="local-6989586621683964052"><a href="#local-6989586621683964052"><span class="hs-identifier">mpm</span></a></a><span> </span><a name="local-6989586621683964053"><a href="#local-6989586621683964053"><span class="hs-identifier">dpm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621683964054"><a href="#local-6989586621683964054"><span class="hs-identifier">pmr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964053"><span class="hs-identifier hs-var">dpm</span></a><span>
</span><a name="line-120"></a><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621683964051"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621683964054"><span class="hs-identifier hs-var">pmr</span></a><span> </span><a href="#local-6989586621683964052"><span class="hs-identifier hs-var">mpm</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-comment">-- Careful not to force unecessary results</span><span>
</span><a name="line-123"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span>
</span><a name="line-124"></a><span>    </span><a name="local-6989586621683964051"><a href="#local-6989586621683964051"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621683964055"><a href="#local-6989586621683964055"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964055"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-125"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964056"><a href="#local-6989586621683964056"><span class="hs-identifier">old</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><a name="local-6989586621683964057"><a href="#local-6989586621683964057"><span class="hs-identifier">prov</span></a></a><span> </span><a name="local-6989586621683964058"><a href="#local-6989586621683964058"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#UncoveredPatterns"><span class="hs-identifier hs-var">UncoveredPatterns</span></a><span> </span><a name="local-6989586621683964059"><a href="#local-6989586621683964059"><span class="hs-identifier">us</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964060"><a href="#local-6989586621683964060"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964061"><a href="#local-6989586621683964061"><span class="hs-identifier">new</span></a></a><span>
</span><a name="line-126"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964059"><span class="hs-identifier hs-var">us</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964058"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964060"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964056"><span class="hs-identifier hs-var">old</span></a><span>
</span><a name="line-127"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-128"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><a name="local-6989586621683964062"><a href="#local-6989586621683964062"><span class="hs-identifier">prov'</span></a></a><span> </span><a name="local-6989586621683964063"><a href="#local-6989586621683964063"><span class="hs-identifier">rs'</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#UncoveredPatterns"><span class="hs-identifier hs-var">UncoveredPatterns</span></a><span> </span><a name="local-6989586621683964064"><a href="#local-6989586621683964064"><span class="hs-identifier">us'</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964065"><a href="#local-6989586621683964065"><span class="hs-identifier">is'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964061"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-129"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">compareLength</span><span> </span><a href="#local-6989586621683964059"><span class="hs-identifier hs-var">us</span></a><span> </span><a href="#local-6989586621683964064"><span class="hs-identifier hs-var">us'</span></a><span>
</span><a name="line-130"></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compareLength</span><span> </span><a href="#local-6989586621683964060"><span class="hs-identifier hs-var">is</span></a><span> </span><a href="#local-6989586621683964065"><span class="hs-identifier hs-var">is'</span></a><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compareLength</span><span> </span><a href="#local-6989586621683964058"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-6989586621683964063"><span class="hs-identifier hs-var">rs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621683964057"><span class="hs-identifier hs-var">prov</span></a><span> </span><a href="#local-6989586621683964062"><span class="hs-identifier hs-var">prov'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-133"></a><span>              </span><span class="hs-identifier hs-var">GT</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964061"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-134"></a><span>              </span><span class="hs-identifier hs-var">EQ</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964061"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-135"></a><span>              </span><span class="hs-identifier hs-var">LT</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964056"><span class="hs-identifier hs-var">old</span></a><span>
</span><a name="line-136"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Check.html#TypeOfUncovered"><span class="hs-identifier hs-var">TypeOfUncovered</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964066"><a href="#local-6989586621683964066"><span class="hs-identifier">_new</span></a></a><span>
</span><a name="line-137"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;getResult: No inhabitation candidates&quot;</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-keyword">data</span><span> </span><a name="PatTy"><a href="Check.html#PatTy"><span class="hs-identifier">PatTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PAT"><a href="Check.html#PAT"><span class="hs-identifier">PAT</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="VA"><a href="Check.html#VA"><span class="hs-identifier">VA</span></a></a><span> </span><span class="hs-comment">-- Used only as a kind, to index PmPat</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">-- The *arity* of a PatVec [p1,..,pn] is</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- the number of p1..pn that are not Guards</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-keyword">data</span><span> </span><a name="PmPat"><a href="Check.html#PmPat"><span class="hs-identifier">PmPat</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatTy"><span class="hs-identifier hs-type">PatTy</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-145"></a><span>  </span><a name="PmCon"><a href="Check.html#PmCon"><span class="hs-identifier">PmCon</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><a name="pm_con_con"><a href="Check.html#pm_con_con"><span class="hs-identifier">pm_con_con</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConLike</span><span>
</span><a name="line-146"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="pm_con_arg_tys"><a href="Check.html#pm_con_arg_tys"><span class="hs-identifier">pm_con_arg_tys</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-147"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="pm_con_tvs"><a href="Check.html#pm_con_tvs"><span class="hs-identifier">pm_con_tvs</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span>
</span><a name="line-148"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="pm_con_dicts"><a href="Check.html#pm_con_dicts"><span class="hs-identifier">pm_con_dicts</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">EvVar</span><span class="hs-special">]</span><span>
</span><a name="line-149"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="pm_con_args"><a href="Check.html#pm_con_args"><span class="hs-identifier">pm_con_args</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><a href="#local-6989586621683964012"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><a href="#local-6989586621683964012"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-150"></a><span>            </span><span class="hs-comment">-- For PmCon arguments' meaning see @ConPatOut@ in hsSyn/HsPat.hs</span><span>
</span><a name="line-151"></a><span>  </span><a name="PmVar"><a href="Check.html#PmVar"><span class="hs-identifier">PmVar</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><a name="pm_var_id"><a href="Check.html#pm_var_id"><span class="hs-identifier">pm_var_id</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><a href="#local-6989586621683964013"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-152"></a><span>  </span><a name="PmLit"><a href="Check.html#PmLit"><span class="hs-identifier">PmLit</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><a name="pm_lit_lit"><a href="Check.html#pm_lit_lit"><span class="hs-identifier">pm_lit_lit</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PmLit</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><a href="#local-6989586621683964014"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-comment">-- See Note [Literals in PmPat]</span><span>
</span><a name="line-153"></a><span>  </span><a name="PmNLit"><a href="Check.html#PmNLit"><span class="hs-identifier">PmNLit</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><a name="pm_lit_id"><a href="Check.html#pm_lit_id"><span class="hs-identifier">pm_lit_id</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-154"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="pm_lit_not"><a href="Check.html#pm_lit_not"><span class="hs-identifier">pm_lit_not</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">PmLit</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><span class="hs-special">'</span><a href="Check.html#VA"><span class="hs-identifier hs-type">VA</span></a><span>
</span><a name="line-155"></a><span>  </span><a name="PmGrd"><a href="Check.html#PmGrd"><span class="hs-identifier">PmGrd</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span> </span><a name="pm_grd_pv"><a href="Check.html#pm_grd_pv"><span class="hs-identifier">pm_grd_pv</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-156"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="pm_grd_expr"><a href="Check.html#pm_grd_expr"><span class="hs-identifier">pm_grd_expr</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PmExpr</span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><span class="hs-special">'</span><a href="Check.html#PAT"><span class="hs-identifier hs-type">PAT</span></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><a href="#local-6989586621683964037"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-159"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#pprPmPatDebug"><span class="hs-identifier hs-var">pprPmPatDebug</span></a><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- data T a where</span><span>
</span><a name="line-162"></a><span class="hs-comment">--     MkT :: forall p q. (Eq p, Ord q) =&gt; p -&gt; q -&gt; T [p]</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- or  MkT :: forall p q r. (Eq p, Ord q, [p] ~ r) =&gt; p -&gt; q -&gt; T r</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-keyword">type</span><span> </span><a name="Pattern"><a href="Check.html#Pattern"><span class="hs-identifier">Pattern</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><span class="hs-special">'</span><a href="Check.html#PAT"><span class="hs-identifier hs-type">PAT</span></a><span> </span><span class="hs-comment">-- ^ Patterns</span><span>
</span><a name="line-166"></a><span class="hs-keyword">type</span><span> </span><a name="ValAbs"><a href="Check.html#ValAbs"><span class="hs-identifier">ValAbs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><span class="hs-special">'</span><a href="Check.html#VA"><span class="hs-identifier hs-type">VA</span></a><span>  </span><span class="hs-comment">-- ^ Value Abstractions</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-keyword">type</span><span> </span><a name="PatVec"><a href="Check.html#PatVec"><span class="hs-identifier">PatVec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- ^ Pattern Vectors</span><span>
</span><a name="line-169"></a><span class="hs-keyword">data</span><span> </span><a name="ValVec"><a href="Check.html#ValVec"><span class="hs-identifier">ValVec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ValVec"><a href="Check.html#ValVec"><span class="hs-identifier">ValVec</span></a></a><span> </span><span class="hs-special">[</span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span class="hs-special">]</span><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span> </span><span class="hs-comment">-- ^ Value Vector Abstractions</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-comment">-- | Term and type constraints to accompany each value vector abstraction.</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- For efficiency, we store the term oracle state instead of the term</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- constraints. TODO: Do the same for the type constraints?</span><span>
</span><a name="line-174"></a><span class="hs-keyword">data</span><span> </span><a name="Delta"><a href="Check.html#Delta"><span class="hs-identifier">Delta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MkDelta"><a href="Check.html#MkDelta"><span class="hs-identifier">MkDelta</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="delta_ty_cs"><a href="Check.html#delta_ty_cs"><span class="hs-identifier">delta_ty_cs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span>
</span><a name="line-175"></a><span>                     </span><span class="hs-special">,</span><span> </span><a name="delta_tm_cs"><a href="Check.html#delta_tm_cs"><span class="hs-identifier">delta_tm_cs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TmOracle.html#TmState"><span class="hs-identifier hs-type">TmState</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-keyword">type</span><span> </span><a name="ValSetAbs"><a href="Check.html#ValSetAbs"><span class="hs-identifier">ValSetAbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Value Set Abstractions</span><span>
</span><a name="line-178"></a><span class="hs-keyword">type</span><span> </span><a name="Uncovered"><a href="Check.html#Uncovered"><span class="hs-identifier">Uncovered</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#ValSetAbs"><span class="hs-identifier hs-type">ValSetAbs</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- Instead of keeping the whole sets in memory, we keep a boolean for both the</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- covered and the divergent set (we store the uncovered set though, since we</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- want to print it). For both the covered and the divergent we have:</span><span>
</span><a name="line-183"></a><span class="hs-comment">--</span><span>
</span><a name="line-184"></a><span class="hs-comment">--   True &lt;=&gt; The set is non-empty</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- hence:</span><span>
</span><a name="line-187"></a><span class="hs-comment">--  C = True             ==&gt; Useful clause (no warning)</span><span>
</span><a name="line-188"></a><span class="hs-comment">--  C = False, D = True  ==&gt; Clause with inaccessible RHS</span><span>
</span><a name="line-189"></a><span class="hs-comment">--  C = False, D = False ==&gt; Redundant clause</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-keyword">data</span><span> </span><a name="Covered"><a href="Check.html#Covered"><span class="hs-identifier">Covered</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Covered"><a href="Check.html#Covered"><span class="hs-identifier">Covered</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="NotCovered"><a href="Check.html#NotCovered"><span class="hs-identifier">NotCovered</span></a></a><span>
</span><a name="line-192"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="Check.html#Covered"><span class="hs-identifier hs-type">Covered</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-195"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#Covered"><span class="hs-identifier hs-var">Covered</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Covered&quot;</span><span>
</span><a name="line-196"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;NotCovered&quot;</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- Like the or monoid for booleans</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- Covered = True, Uncovered = False</span><span>
</span><a name="line-200"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semi.Semigroup</span><span> </span><a href="Check.html#Covered"><span class="hs-identifier hs-type">Covered</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-201"></a><span>  </span><a href="Check.html#Covered"><span class="hs-identifier hs-var">Covered</span></a><span> </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#Covered"><span class="hs-identifier hs-var">Covered</span></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><a href="Check.html#Covered"><span class="hs-identifier hs-var">Covered</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#Covered"><span class="hs-identifier hs-var">Covered</span></a><span>
</span><a name="line-203"></a><span>  </span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="Check.html#Covered"><span class="hs-identifier hs-type">Covered</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-206"></a><span>  </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span>
</span><a name="line-207"></a><span>  </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">Semi.&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-keyword">data</span><span> </span><a name="Diverged"><a href="Check.html#Diverged"><span class="hs-identifier">Diverged</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Diverged"><a href="Check.html#Diverged"><span class="hs-identifier">Diverged</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="NotDiverged"><a href="Check.html#NotDiverged"><span class="hs-identifier">NotDiverged</span></a></a><span>
</span><a name="line-210"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-type">Diverged</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-213"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-var">Diverged</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Diverged&quot;</span><span>
</span><a name="line-214"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="Check.html#NotDiverged"><span class="hs-identifier hs-var">NotDiverged</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;NotDiverged&quot;</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semi.Semigroup</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-type">Diverged</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-217"></a><span>  </span><a href="Check.html#Diverged"><span class="hs-identifier hs-var">Diverged</span></a><span> </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-var">Diverged</span></a><span>
</span><a name="line-218"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-var">Diverged</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-var">Diverged</span></a><span>
</span><a name="line-219"></a><span>  </span><a href="Check.html#NotDiverged"><span class="hs-identifier hs-var">NotDiverged</span></a><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><a href="Check.html#NotDiverged"><span class="hs-identifier hs-var">NotDiverged</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#NotDiverged"><span class="hs-identifier hs-var">NotDiverged</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-type">Diverged</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-222"></a><span>  </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#NotDiverged"><span class="hs-identifier hs-var">NotDiverged</span></a><span>
</span><a name="line-223"></a><span>  </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">Semi.&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">-- | When we learned that a given match group is complete</span><span>
</span><a name="line-226"></a><span class="hs-keyword">data</span><span> </span><a name="Provenance"><a href="Check.html#Provenance"><span class="hs-identifier">Provenance</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-227"></a><span>                  </span><a name="FromBuiltin"><a href="Check.html#FromBuiltin"><span class="hs-identifier">FromBuiltin</span></a></a><span> </span><span class="hs-comment">-- ^  From the original definition of the type</span><span>
</span><a name="line-228"></a><span>                              </span><span class="hs-comment">--    constructor.</span><span>
</span><a name="line-229"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a name="FromComplete"><a href="Check.html#FromComplete"><span class="hs-identifier">FromComplete</span></a></a><span> </span><span class="hs-comment">-- ^ From a user-provided @COMPLETE@ pragma</span><span>
</span><a name="line-230"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="Check.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-233"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semi.Semigroup</span><span> </span><a href="Check.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-236"></a><span>  </span><a href="Check.html#FromComplete"><span class="hs-identifier hs-var">FromComplete</span></a><span> </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#FromComplete"><span class="hs-identifier hs-var">FromComplete</span></a><span>
</span><a name="line-237"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><a href="Check.html#FromComplete"><span class="hs-identifier hs-var">FromComplete</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#FromComplete"><span class="hs-identifier hs-var">FromComplete</span></a><span>
</span><a name="line-238"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#FromBuiltin"><span class="hs-identifier hs-var">FromBuiltin</span></a><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="Check.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-241"></a><span>  </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#FromBuiltin"><span class="hs-identifier hs-var">FromBuiltin</span></a><span>
</span><a name="line-242"></a><span>  </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">Semi.&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-keyword">data</span><span> </span><a name="PartialResult"><a href="Check.html#PartialResult"><span class="hs-identifier">PartialResult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PartialResult"><a href="Check.html#PartialResult"><span class="hs-identifier">PartialResult</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-245"></a><span>                        </span><a name="presultProvenance"><a href="Check.html#presultProvenance"><span class="hs-identifier">presultProvenance</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a><span>
</span><a name="line-246"></a><span>                         </span><span class="hs-comment">-- keep track of provenance because we don't want</span><span>
</span><a name="line-247"></a><span>                         </span><span class="hs-comment">-- to warn about redundant matches if the result</span><span>
</span><a name="line-248"></a><span>                         </span><span class="hs-comment">-- is contaminated with a COMPLETE pragma</span><span>
</span><a name="line-249"></a><span>                      </span><span class="hs-special">,</span><span> </span><a name="presultCovered"><a href="Check.html#presultCovered"><span class="hs-identifier">presultCovered</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Covered"><span class="hs-identifier hs-type">Covered</span></a><span>
</span><a name="line-250"></a><span>                      </span><span class="hs-special">,</span><span> </span><a name="presultUncovered"><a href="Check.html#presultUncovered"><span class="hs-identifier">presultUncovered</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Uncovered"><span class="hs-identifier hs-type">Uncovered</span></a><span>
</span><a name="line-251"></a><span>                      </span><span class="hs-special">,</span><span> </span><a name="presultDivergent"><a href="Check.html#presultDivergent"><span class="hs-identifier">presultDivergent</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-type">Diverged</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-254"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><a name="local-6989586621683964033"><a href="#local-6989586621683964033"><span class="hs-identifier">prov</span></a></a><span> </span><a name="local-6989586621683964034"><a href="#local-6989586621683964034"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621683964035"><a href="#local-6989586621683964035"><span class="hs-identifier">vsa</span></a></a><span> </span><a name="local-6989586621683964036"><a href="#local-6989586621683964036"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;PartialResult&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964033"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964034"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-256"></a><span>                                  </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964036"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964035"><span class="hs-identifier hs-var">vsa</span></a><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semi.Semigroup</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-260"></a><span>  </span><span class="hs-special">(</span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><a name="local-6989586621683964025"><a href="#local-6989586621683964025"><span class="hs-identifier">prov1</span></a></a><span> </span><a name="local-6989586621683964026"><a href="#local-6989586621683964026"><span class="hs-identifier">cs1</span></a></a><span> </span><a name="local-6989586621683964027"><a href="#local-6989586621683964027"><span class="hs-identifier">vsa1</span></a></a><span> </span><a name="local-6989586621683964028"><a href="#local-6989586621683964028"><span class="hs-identifier">ds1</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>    </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><a name="local-6989586621683964029"><a href="#local-6989586621683964029"><span class="hs-identifier">prov2</span></a></a><span> </span><a name="local-6989586621683964030"><a href="#local-6989586621683964030"><span class="hs-identifier">cs2</span></a></a><span> </span><a name="local-6989586621683964031"><a href="#local-6989586621683964031"><span class="hs-identifier">vsa2</span></a></a><span> </span><a name="local-6989586621683964032"><a href="#local-6989586621683964032"><span class="hs-identifier">ds2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964025"><span class="hs-identifier hs-var">prov1</span></a><span> </span><span class="hs-operator hs-var">Semi.&lt;&gt;</span><span> </span><a href="#local-6989586621683964029"><span class="hs-identifier hs-var">prov2</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>                      </span><span class="hs-special">(</span><a href="#local-6989586621683964026"><span class="hs-identifier hs-var">cs1</span></a><span> </span><span class="hs-operator hs-var">Semi.&lt;&gt;</span><span> </span><a href="#local-6989586621683964030"><span class="hs-identifier hs-var">cs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-264"></a><span>                      </span><span class="hs-special">(</span><a href="#local-6989586621683964027"><span class="hs-identifier hs-var">vsa1</span></a><span> </span><span class="hs-operator hs-var">Semi.&lt;&gt;</span><span> </span><a href="#local-6989586621683964031"><span class="hs-identifier hs-var">vsa2</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>                      </span><span class="hs-special">(</span><a href="#local-6989586621683964028"><span class="hs-identifier hs-var">ds1</span></a><span> </span><span class="hs-operator hs-var">Semi.&lt;&gt;</span><span> </span><a href="#local-6989586621683964032"><span class="hs-identifier hs-var">ds2</span></a><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-269"></a><span>  </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-270"></a><span>  </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">Semi.&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-comment">-- newtype ChoiceOf a = ChoiceOf [a]</span><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-comment">-- | Pattern check result</span><span>
</span><a name="line-275"></a><span class="hs-comment">--</span><span>
</span><a name="line-276"></a><span class="hs-comment">-- * Redundant clauses</span><span>
</span><a name="line-277"></a><span class="hs-comment">-- * Not-covered clauses (or their type, if no pattern is available)</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- * Clauses with inaccessible RHS</span><span>
</span><a name="line-279"></a><span class="hs-comment">--</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- More details about the classification of clauses into useful, redundant</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- and with inaccessible right hand side can be found here:</span><span>
</span><a name="line-282"></a><span class="hs-comment">--</span><span>
</span><a name="line-283"></a><span class="hs-comment">--     https://ghc.haskell.org/trac/ghc/wiki/PatternMatchCheck</span><span>
</span><a name="line-284"></a><span class="hs-comment">--</span><span>
</span><a name="line-285"></a><span class="hs-keyword">data</span><span> </span><a name="PmResult"><a href="Check.html#PmResult"><span class="hs-identifier">PmResult</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-286"></a><span>  </span><a name="PmResult"><a href="Check.html#PmResult"><span class="hs-identifier">PmResult</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-287"></a><span>      </span><a name="pmresultProvenance"><a href="Check.html#pmresultProvenance"><span class="hs-identifier">pmresultProvenance</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a><span>
</span><a name="line-288"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pmresultRedundant"><a href="Check.html#pmresultRedundant"><span class="hs-identifier">pmresultRedundant</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-289"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pmresultUncovered"><a href="Check.html#pmresultUncovered"><span class="hs-identifier">pmresultUncovered</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#UncoveredCandidates"><span class="hs-identifier hs-type">UncoveredCandidates</span></a><span>
</span><a name="line-290"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pmresultInaccessible"><a href="Check.html#pmresultInaccessible"><span class="hs-identifier">pmresultInaccessible</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-comment">-- | Either a list of patterns that are not covered, or their type, in case we</span><span>
</span><a name="line-293"></a><span class="hs-comment">-- have no patterns at hand. Not having patterns at hand can arise when</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- handling EmptyCase expressions, in two cases:</span><span>
</span><a name="line-295"></a><span class="hs-comment">--</span><span>
</span><a name="line-296"></a><span class="hs-comment">-- * The type of the scrutinee is a trivially inhabited type (like Int or Char)</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- * The type of the scrutinee cannot be reduced to WHNF.</span><span>
</span><a name="line-298"></a><span class="hs-comment">--</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- In both these cases we have no inhabitation candidates for the type at hand,</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- but we don't want to issue just a wildcard as missing. Instead, we print a</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- type annotated wildcard, so that the user knows what kind of patterns is</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- expected (e.g. (_ :: Int), or (_ :: F Int), where F Int does not reduce).</span><span>
</span><a name="line-303"></a><span class="hs-keyword">data</span><span> </span><a name="UncoveredCandidates"><a href="Check.html#UncoveredCandidates"><span class="hs-identifier">UncoveredCandidates</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UncoveredPatterns"><a href="Check.html#UncoveredPatterns"><span class="hs-identifier">UncoveredPatterns</span></a></a><span> </span><a href="Check.html#Uncovered"><span class="hs-identifier hs-type">Uncovered</span></a><span>
</span><a name="line-304"></a><span>                         </span><span class="hs-glyph">|</span><span> </span><a name="TypeOfUncovered"><a href="Check.html#TypeOfUncovered"><span class="hs-identifier">TypeOfUncovered</span></a></a><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-comment">-- | The empty pattern check result</span><span>
</span><a name="line-307"></a><span class="hs-identifier">emptyPmResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span>
</span><a name="line-308"></a><a name="emptyPmResult"><a href="Check.html#emptyPmResult"><span class="hs-identifier">emptyPmResult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><a href="Check.html#FromBuiltin"><span class="hs-identifier hs-var">FromBuiltin</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Check.html#UncoveredPatterns"><span class="hs-identifier hs-var">UncoveredPatterns</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span class="hs-comment">-- | Non-exhaustive empty case with unknown/trivial inhabitants</span><span>
</span><a name="line-311"></a><span class="hs-identifier">uncoveredWithTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span>
</span><a name="line-312"></a><a name="uncoveredWithTy"><a href="Check.html#uncoveredWithTy"><span class="hs-identifier">uncoveredWithTy</span></a></a><span> </span><a name="local-6989586621683964069"><a href="#local-6989586621683964069"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><a href="Check.html#FromBuiltin"><span class="hs-identifier hs-var">FromBuiltin</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Check.html#TypeOfUncovered"><span class="hs-identifier hs-var">TypeOfUncovered</span></a><span> </span><a href="#local-6989586621683964069"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
       Entry points to the checker: checkSingle and checkMatches
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-comment">-- | Check a single pattern binding (let)</span><span>
</span><a name="line-323"></a><span class="hs-identifier">checkSingle</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-324"></a><a name="checkSingle"><a href="Check.html#checkSingle"><span class="hs-identifier">checkSingle</span></a></a><span> </span><a name="local-6989586621683964070"><a href="#local-6989586621683964070"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683964071"><a href="#local-6989586621683964071"><span class="hs-identifier">ctxt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964072"><a href="#local-6989586621683964072"><span class="hs-identifier">locn</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964073"><a href="#local-6989586621683964073"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621683964074"><a href="#local-6989586621683964074"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-325"></a><span>  </span><a href="Check.html#tracePmD"><span class="hs-identifier hs-var">tracePmD</span></a><span> </span><span class="hs-string">&quot;checkSingle&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964071"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964073"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964074"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-326"></a><span>  </span><a name="local-6989586621683964075"><a href="#local-6989586621683964075"><span class="hs-identifier">mb_pm_res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">tryM</span><span> </span><span class="hs-special">(</span><a href="Check.html#getResult"><span class="hs-identifier hs-var">getResult</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#checkSingle%27"><span class="hs-identifier hs-var">checkSingle'</span></a><span> </span><a href="#local-6989586621683964072"><span class="hs-identifier hs-var">locn</span></a><span> </span><a href="#local-6989586621683964073"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621683964074"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964075"><span class="hs-identifier hs-var">mb_pm_res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-328"></a><span>    </span><span class="hs-identifier hs-var">Left</span><span>  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#warnPmIters"><span class="hs-identifier hs-var">warnPmIters</span></a><span> </span><a href="#local-6989586621683964070"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683964071"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-329"></a><span>    </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621683964076"><a href="#local-6989586621683964076"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#dsPmWarn"><span class="hs-identifier hs-var">dsPmWarn</span></a><span> </span><a href="#local-6989586621683964070"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683964071"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621683964076"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">-- | Check a single pattern binding (let)</span><span>
</span><a name="line-332"></a><span class="hs-identifier">checkSingle'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span>
</span><a name="line-333"></a><a name="checkSingle%27"><a href="Check.html#checkSingle%27"><span class="hs-identifier">checkSingle'</span></a></a><span> </span><a name="local-6989586621683964077"><a href="#local-6989586621683964077"><span class="hs-identifier">locn</span></a></a><span> </span><a name="local-6989586621683964078"><a href="#local-6989586621683964078"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621683964079"><a href="#local-6989586621683964079"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-334"></a><span>  </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#resetPmIterDs"><span class="hs-identifier hs-var">resetPmIterDs</span></a><span> </span><span class="hs-comment">-- set the iter-no to zero</span><span>
</span><a name="line-335"></a><span>  </span><a name="local-6989586621683964081"><a href="#local-6989586621683964081"><span class="hs-identifier">fam_insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a><span>
</span><a name="line-336"></a><span>  </span><a name="local-6989586621683964082"><a href="#local-6989586621683964082"><span class="hs-identifier">clause</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964081"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964079"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-337"></a><span>  </span><a name="local-6989586621683964083"><a href="#local-6989586621683964083"><span class="hs-identifier">missing</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#mkInitialUncovered"><span class="hs-identifier hs-var">mkInitialUncovered</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964078"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">]</span><span>
</span><a name="line-338"></a><span>  </span><a href="Check.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a><span> </span><span class="hs-string">&quot;checkSingle: missing&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#pprValVecDebug"><span class="hs-identifier hs-var">pprValVecDebug</span></a><span> </span><a href="#local-6989586621683964083"><span class="hs-identifier hs-var">missing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>                                 </span><span class="hs-comment">-- no guards</span><span>
</span><a name="line-340"></a><span>  </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><a name="local-6989586621683964084"><a href="#local-6989586621683964084"><span class="hs-identifier">prov</span></a></a><span> </span><a name="local-6989586621683964085"><a href="#local-6989586621683964085"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621683964086"><a href="#local-6989586621683964086"><span class="hs-identifier">us</span></a></a><span> </span><a name="local-6989586621683964087"><a href="#local-6989586621683964087"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#runMany"><span class="hs-identifier hs-var">runMany</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><a href="#local-6989586621683964082"><span class="hs-identifier hs-var">clause</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964083"><span class="hs-identifier hs-var">missing</span></a><span>
</span><a name="line-341"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964088"><a href="#local-6989586621683964088"><span class="hs-identifier">us'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#UncoveredPatterns"><span class="hs-identifier hs-var">UncoveredPatterns</span></a><span> </span><a href="#local-6989586621683964086"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-342"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964085"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><a href="#local-6989586621683964087"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-343"></a><span>    </span><span class="hs-special">(</span><a href="Check.html#Covered"><span class="hs-identifier hs-var">Covered</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><a href="#local-6989586621683964084"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621683964088"><span class="hs-identifier hs-var">us'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- useful</span><span>
</span><a name="line-344"></a><span>    </span><span class="hs-special">(</span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#NotDiverged"><span class="hs-identifier hs-var">NotDiverged</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><a href="#local-6989586621683964084"><span class="hs-identifier hs-var">prov</span></a><span> </span><a href="#local-6989586621683964080"><span class="hs-identifier hs-var">m</span></a><span>  </span><a href="#local-6989586621683964088"><span class="hs-identifier hs-var">us'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- redundant</span><span>
</span><a name="line-345"></a><span>    </span><span class="hs-special">(</span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-var">Diverged</span></a><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><a href="#local-6989586621683964084"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621683964088"><span class="hs-identifier hs-var">us'</span></a><span> </span><a href="#local-6989586621683964080"><span class="hs-identifier hs-var">m</span></a><span>  </span><span class="hs-comment">-- inaccessible rhs</span><span>
</span><a name="line-346"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621683964080"><a href="#local-6989586621683964080"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621683964077"><span class="hs-identifier hs-var">locn</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621683964077"><span class="hs-identifier hs-var">locn</span></a><span> </span><a href="#local-6989586621683964079"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- | Exhaustive for guard matches, is used for guards in pattern bindings and</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- in @MultiIf@ expressions.</span><span>
</span><a name="line-350"></a><span class="hs-identifier">checkGuardMatches</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span>          </span><span class="hs-comment">-- Match context</span><span>
</span><a name="line-351"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GRHSs</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Guarded RHSs</span><span>
</span><a name="line-352"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-353"></a><a name="checkGuardMatches"><a href="Check.html#checkGuardMatches"><span class="hs-identifier">checkGuardMatches</span></a></a><span> </span><a name="local-6989586621683964089"><a href="#local-6989586621683964089"><span class="hs-identifier">hs_ctx</span></a></a><span> </span><a name="local-6989586621683964090"><a href="#local-6989586621683964090"><span class="hs-identifier">guards</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHSs</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964091"><a href="#local-6989586621683964091"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-354"></a><span>    </span><a name="local-6989586621683964092"><a href="#local-6989586621683964092"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-355"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964093"><a href="#local-6989586621683964093"><span class="hs-identifier">combinedLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl1</span><span> </span><span class="hs-identifier hs-var">combineSrcSpans</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">getLoc</span><span> </span><a href="#local-6989586621683964091"><span class="hs-identifier hs-var">grhss</span></a><span class="hs-special">)</span><span>
</span><a name="line-356"></a><span>        </span><a name="local-6989586621683964094"><a href="#local-6989586621683964094"><span class="hs-identifier">dsMatchContext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a><span> </span><a href="#local-6989586621683964089"><span class="hs-identifier hs-var">hs_ctx</span></a><span> </span><a href="#local-6989586621683964093"><span class="hs-identifier hs-var">combinedLoc</span></a><span>
</span><a name="line-357"></a><span>        </span><a name="local-6989586621683964095"><a href="#local-6989586621683964095"><span class="hs-identifier">match</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621683964093"><span class="hs-identifier hs-var">combinedLoc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-358"></a><span>                  </span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span>
</span><a name="line-359"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964089"><span class="hs-identifier hs-var">hs_ctx</span></a><span>
</span><a name="line-360"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-361"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964090"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-362"></a><span>    </span><a href="Check.html#checkMatches"><span class="hs-identifier hs-var">checkMatches</span></a><span> </span><a href="#local-6989586621683964092"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683964094"><span class="hs-identifier hs-var">dsMatchContext</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964095"><span class="hs-identifier hs-var">match</span></a><span class="hs-special">]</span><span>
</span><a name="line-363"></a><span class="hs-identifier">checkGuardMatches</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XGRHSs</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;checkGuardMatches&quot;</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-comment">-- | Check a matchgroup (case, functions, etc.)</span><span>
</span><a name="line-366"></a><span class="hs-identifier">checkMatches</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a><span>
</span><a name="line-367"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-368"></a><a name="checkMatches"><a href="Check.html#checkMatches"><span class="hs-identifier">checkMatches</span></a></a><span> </span><a name="local-6989586621683964096"><a href="#local-6989586621683964096"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683964097"><a href="#local-6989586621683964097"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621683964098"><a href="#local-6989586621683964098"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621683964099"><a href="#local-6989586621683964099"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-369"></a><span>  </span><a href="Check.html#tracePmD"><span class="hs-identifier hs-var">tracePmD</span></a><span> </span><span class="hs-string">&quot;checkMatches&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964097"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-370"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964098"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-371"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Matches:&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span>                               </span><span class="hs-number">2</span><span>
</span><a name="line-373"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964099"><span class="hs-identifier hs-var">matches</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-374"></a><span>  </span><a name="local-6989586621683964102"><a href="#local-6989586621683964102"><span class="hs-identifier">mb_pm_res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">tryM</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#getResult"><span class="hs-identifier hs-var">getResult</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964099"><span class="hs-identifier hs-var">matches</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-375"></a><span>    </span><span class="hs-comment">-- Check EmptyCase separately</span><span>
</span><a name="line-376"></a><span>    </span><span class="hs-comment">-- See Note [Checking EmptyCase Expressions]</span><span>
</span><a name="line-377"></a><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><a name="local-6989586621683964100"><a href="#local-6989586621683964100"><span class="hs-identifier">var</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964098"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#checkEmptyCase%27"><span class="hs-identifier hs-var">checkEmptyCase'</span></a><span> </span><a href="#local-6989586621683964100"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-378"></a><span>    </span><a name="local-6989586621683964101"><a href="#local-6989586621683964101"><span class="hs-identifier">_normal_match</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#checkMatches%27"><span class="hs-identifier hs-var">checkMatches'</span></a><span> </span><a href="#local-6989586621683964098"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621683964099"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-379"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964102"><span class="hs-identifier hs-var">mb_pm_res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-380"></a><span>    </span><span class="hs-identifier hs-var">Left</span><span>  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#warnPmIters"><span class="hs-identifier hs-var">warnPmIters</span></a><span> </span><a href="#local-6989586621683964096"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683964097"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-381"></a><span>    </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621683964103"><a href="#local-6989586621683964103"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#dsPmWarn"><span class="hs-identifier hs-var">dsPmWarn</span></a><span> </span><a href="#local-6989586621683964096"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683964097"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621683964103"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-comment">-- | Check a matchgroup (case, functions, etc.). To be called on a non-empty</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- list of matches. For empty case expressions, use checkEmptyCase' instead.</span><span>
</span><a name="line-385"></a><span class="hs-identifier">checkMatches'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span>
</span><a name="line-386"></a><a name="checkMatches%27"><a href="Check.html#checkMatches%27"><span class="hs-identifier">checkMatches'</span></a></a><span> </span><a name="local-6989586621683964104"><a href="#local-6989586621683964104"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621683964105"><a href="#local-6989586621683964105"><span class="hs-identifier">matches</span></a></a><span>
</span><a name="line-387"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964105"><span class="hs-identifier hs-var">matches</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;checkMatches': EmptyCase&quot;</span><span>
</span><a name="line-388"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-389"></a><span>      </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#resetPmIterDs"><span class="hs-identifier hs-var">resetPmIterDs</span></a><span> </span><span class="hs-comment">-- set the iter-no to zero</span><span>
</span><a name="line-390"></a><span>      </span><a name="local-6989586621683964129"><a href="#local-6989586621683964129"><span class="hs-identifier">missing</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#mkInitialUncovered"><span class="hs-identifier hs-var">mkInitialUncovered</span></a><span> </span><a href="#local-6989586621683964104"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-391"></a><span>      </span><a href="Check.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a><span> </span><span class="hs-string">&quot;checkMatches': missing&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#pprValVecDebug"><span class="hs-identifier hs-var">pprValVecDebug</span></a><span> </span><a href="#local-6989586621683964129"><span class="hs-identifier hs-var">missing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621683964130"><a href="#local-6989586621683964130"><span class="hs-identifier">prov</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964131"><a href="#local-6989586621683964131"><span class="hs-identifier">rs</span></a></a><span class="hs-special">,</span><a name="local-6989586621683964132"><a href="#local-6989586621683964132"><span class="hs-identifier">us</span></a></a><span class="hs-special">,</span><a name="local-6989586621683964133"><a href="#local-6989586621683964133"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964106"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621683964105"><span class="hs-identifier hs-var">matches</span></a><span> </span><a href="#local-6989586621683964129"><span class="hs-identifier hs-var">missing</span></a><span>
</span><a name="line-393"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-394"></a><span>                   </span><span class="hs-identifier">pmresultProvenance</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964130"><span class="hs-identifier hs-var">prov</span></a><span>
</span><a name="line-395"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pmresultRedundant</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683964107"><span class="hs-identifier hs-var">hsLMatchToLPats</span></a><span> </span><a href="#local-6989586621683964131"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-396"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pmresultUncovered</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#UncoveredPatterns"><span class="hs-identifier hs-var">UncoveredPatterns</span></a><span> </span><a href="#local-6989586621683964132"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-397"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pmresultInaccessible</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683964107"><span class="hs-identifier hs-var">hsLMatchToLPats</span></a><span> </span><a href="#local-6989586621683964133"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-398"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-399"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Uncovered"><span class="hs-identifier hs-type">Uncovered</span></a><span>
</span><a name="line-400"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a><span>
</span><a name="line-401"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-402"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Check.html#Uncovered"><span class="hs-identifier hs-type">Uncovered</span></a><span>
</span><a name="line-403"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-404"></a><span>    </span><a name="local-6989586621683964106"><a href="#local-6989586621683964106"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><a name="local-6989586621683964110"><a href="#local-6989586621683964110"><span class="hs-identifier">missing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964110"><span class="hs-identifier hs-var">missing</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964111"><a href="#local-6989586621683964111"><span class="hs-identifier">m</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683964112"><a href="#local-6989586621683964112"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964113"><a href="#local-6989586621683964113"><span class="hs-identifier">missing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-406"></a><span>      </span><a href="Check.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a><span> </span><span class="hs-string">&quot;checMatches': go&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964111"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964113"><span class="hs-identifier hs-var">missing</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>      </span><a name="local-6989586621683964114"><a href="#local-6989586621683964114"><span class="hs-identifier">fam_insts</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a><span>
</span><a name="line-408"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621683964115"><a href="#local-6989586621683964115"><span class="hs-identifier">clause</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964116"><a href="#local-6989586621683964116"><span class="hs-identifier">guards</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#translateMatch"><span class="hs-identifier hs-var">translateMatch</span></a><span> </span><a href="#local-6989586621683964114"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964111"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-409"></a><span>      </span><a name="local-6989586621683964117"><a href="#local-6989586621683964117"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><a name="local-6989586621683964118"><a href="#local-6989586621683964118"><span class="hs-identifier">prov</span></a></a><span> </span><a name="local-6989586621683964119"><a href="#local-6989586621683964119"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621683964120"><a href="#local-6989586621683964120"><span class="hs-identifier">missing'</span></a></a><span> </span><a name="local-6989586621683964121"><a href="#local-6989586621683964121"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#runMany"><span class="hs-identifier hs-var">runMany</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><a href="#local-6989586621683964115"><span class="hs-identifier hs-var">clause</span></a><span> </span><a href="#local-6989586621683964116"><span class="hs-identifier hs-var">guards</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964113"><span class="hs-identifier hs-var">missing</span></a><span>
</span><a name="line-411"></a><span>      </span><a href="Check.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a><span> </span><span class="hs-string">&quot;checMatches': go: res&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964117"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-412"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621683964122"><a href="#local-6989586621683964122"><span class="hs-identifier">ms_prov</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964123"><a href="#local-6989586621683964123"><span class="hs-identifier">rs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964124"><a href="#local-6989586621683964124"><span class="hs-identifier">final_u</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964125"><a href="#local-6989586621683964125"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964106"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621683964112"><span class="hs-identifier hs-var">ms</span></a><span> </span><a href="#local-6989586621683964120"><span class="hs-identifier hs-var">missing'</span></a><span>
</span><a name="line-413"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964126"><a href="#local-6989586621683964126"><span class="hs-identifier">final_prov</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964118"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964122"><span class="hs-identifier hs-var">ms_prov</span></a><span>
</span><a name="line-414"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964119"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964121"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-415"></a><span>        </span><span class="hs-comment">-- useful</span><span>
</span><a name="line-416"></a><span>        </span><span class="hs-special">(</span><a href="Check.html#Covered"><span class="hs-identifier hs-var">Covered</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964126"><span class="hs-identifier hs-var">final_prov</span></a><span class="hs-special">,</span><span>  </span><a href="#local-6989586621683964123"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964124"><span class="hs-identifier hs-var">final_u</span></a><span class="hs-special">,</span><span>   </span><a href="#local-6989586621683964125"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>        </span><span class="hs-comment">-- redundant</span><span>
</span><a name="line-418"></a><span>        </span><span class="hs-special">(</span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#NotDiverged"><span class="hs-identifier hs-var">NotDiverged</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964126"><span class="hs-identifier hs-var">final_prov</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964111"><span class="hs-identifier hs-var">m</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964123"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964124"><span class="hs-identifier hs-var">final_u</span></a><span class="hs-special">,</span><a href="#local-6989586621683964125"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-419"></a><span>        </span><span class="hs-comment">-- inaccessible</span><span>
</span><a name="line-420"></a><span>        </span><span class="hs-special">(</span><a href="Check.html#NotCovered"><span class="hs-identifier hs-var">NotCovered</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-var">Diverged</span></a><span> </span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964126"><span class="hs-identifier hs-var">final_prov</span></a><span class="hs-special">,</span><span>  </span><a href="#local-6989586621683964123"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964124"><span class="hs-identifier hs-var">final_u</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964111"><span class="hs-identifier hs-var">m</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964125"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span>    </span><span class="hs-identifier">hsLMatchToLPats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LMatch</span><span> </span><a href="#local-6989586621683964108"><span class="hs-identifier hs-type">id</span></a><span> </span><a href="#local-6989586621683964109"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><a href="#local-6989586621683964108"><span class="hs-identifier hs-type">id</span></a><span class="hs-special">]</span><span>
</span><a name="line-423"></a><span>    </span><a name="local-6989586621683964107"><a href="#local-6989586621683964107"><span class="hs-identifier">hsLMatchToLPats</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621683964127"><a href="#local-6989586621683964127"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964128"><a href="#local-6989586621683964128"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621683964127"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621683964128"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-424"></a><span>    </span><span class="hs-identifier">hsLMatchToLPats</span><span> </span><span class="hs-identifier">_</span><span>                                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;checMatches'&quot;</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span class="hs-comment">-- | Check an empty case expression. Since there are no clauses to process, we</span><span>
</span><a name="line-427"></a><span class="hs-comment">--   only compute the uncovered set. See Note [Checking EmptyCase Expressions]</span><span>
</span><a name="line-428"></a><span class="hs-comment">--   for details.</span><span>
</span><a name="line-429"></a><span class="hs-identifier">checkEmptyCase'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span>
</span><a name="line-430"></a><a name="checkEmptyCase%27"><a href="Check.html#checkEmptyCase%27"><span class="hs-identifier">checkEmptyCase'</span></a></a><span> </span><a name="local-6989586621683964134"><a href="#local-6989586621683964134"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-431"></a><span>  </span><a name="local-6989586621683964135"><a href="#local-6989586621683964135"><span class="hs-identifier">tm_ty_css</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmInitialTmTyCs"><span class="hs-identifier hs-var">pmInitialTmTyCs</span></a><span>
</span><a name="line-432"></a><span>  </span><a name="local-6989586621683964136"><a href="#local-6989586621683964136"><span class="hs-identifier">mb_candidates</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#inhabitationCandidates"><span class="hs-identifier hs-var">inhabitationCandidates</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_ty_cs</span><span> </span><a href="#local-6989586621683964135"><span class="hs-identifier hs-var">tm_ty_css</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621683964134"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-433"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964136"><span class="hs-identifier hs-var">mb_candidates</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-434"></a><span>    </span><span class="hs-comment">-- Inhabitation checking failed / the type is trivially inhabited</span><span>
</span><a name="line-435"></a><span>    </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621683964137"><a href="#local-6989586621683964137"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Check.html#uncoveredWithTy"><span class="hs-identifier hs-var">uncoveredWithTy</span></a><span> </span><a href="#local-6989586621683964137"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span>    </span><span class="hs-comment">-- A list of inhabitant candidates is available: Check for each</span><span>
</span><a name="line-438"></a><span>    </span><span class="hs-comment">-- one for the satisfiability of the constraints it gives rise to.</span><span>
</span><a name="line-439"></a><span>    </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683964138"><a href="#local-6989586621683964138"><span class="hs-identifier">candidates</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-440"></a><span>      </span><a name="local-6989586621683964144"><a href="#local-6989586621683964144"><span class="hs-identifier">missing_m</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">mapMaybeM</span><span> </span><a href="#local-6989586621683964138"><span class="hs-identifier hs-var">candidates</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-441"></a><span>          </span><span class="hs-glyph">\</span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-var">InhabitationCandidate</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_val_abs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964139"><a href="#local-6989586621683964139"><span class="hs-identifier">va</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_tm_ct</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964140"><a href="#local-6989586621683964140"><span class="hs-identifier">tm_ct</span></a></a><span>
</span><a name="line-442"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_ty_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964141"><a href="#local-6989586621683964141"><span class="hs-identifier">ty_cs</span></a></a><span>
</span><a name="line-443"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_strict_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964142"><a href="#local-6989586621683964142"><span class="hs-identifier">strict_arg_tys</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-444"></a><span>        </span><a name="local-6989586621683964143"><a href="#local-6989586621683964143"><span class="hs-identifier">mb_sat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmIsSatisfiable"><span class="hs-identifier hs-var">pmIsSatisfiable</span></a><span> </span><a href="#local-6989586621683964135"><span class="hs-identifier hs-var">tm_ty_css</span></a><span> </span><a href="#local-6989586621683964140"><span class="hs-identifier hs-var">tm_ct</span></a><span> </span><a href="#local-6989586621683964141"><span class="hs-identifier hs-var">ty_cs</span></a><span> </span><a href="#local-6989586621683964142"><span class="hs-identifier hs-var">strict_arg_tys</span></a><span>
</span><a name="line-445"></a><span>        </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964139"><span class="hs-identifier hs-var">va</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964143"><span class="hs-identifier hs-var">mb_sat</span></a><span>
</span><a name="line-446"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964144"><span class="hs-identifier hs-var">missing_m</span></a><span>
</span><a name="line-447"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Check.html#emptyPmResult"><span class="hs-identifier hs-var">emptyPmResult</span></a><span>
</span><a name="line-448"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span> </span><a href="Check.html#FromBuiltin"><span class="hs-identifier hs-var">FromBuiltin</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Check.html#UncoveredPatterns"><span class="hs-identifier hs-var">UncoveredPatterns</span></a><span> </span><a href="#local-6989586621683964144"><span class="hs-identifier hs-var">missing_m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span class="hs-comment">-- | Returns 'True' if the argument 'Type' is a fully saturated application of</span><span>
</span><a name="line-451"></a><span class="hs-comment">-- a closed type constructor.</span><span>
</span><a name="line-452"></a><span class="hs-comment">--</span><span>
</span><a name="line-453"></a><span class="hs-comment">-- Closed type constructors are those with a fixed right hand side, as</span><span>
</span><a name="line-454"></a><span class="hs-comment">-- opposed to e.g. associated types. These are of particular interest for</span><span>
</span><a name="line-455"></a><span class="hs-comment">-- pattern-match coverage checking, because GHC can exhaustively consider all</span><span>
</span><a name="line-456"></a><span class="hs-comment">-- possible forms that values of a closed type can take on.</span><span>
</span><a name="line-457"></a><span class="hs-comment">--</span><span>
</span><a name="line-458"></a><span class="hs-comment">-- Note that this function is intended to be used to check types of value-level</span><span>
</span><a name="line-459"></a><span class="hs-comment">-- patterns, so as a consequence, the 'Type' supplied as an argument to this</span><span>
</span><a name="line-460"></a><span class="hs-comment">-- function should be of kind @Type@.</span><span>
</span><a name="line-461"></a><span class="hs-identifier">pmIsClosedType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-462"></a><a name="pmIsClosedType"><a href="Check.html#pmIsClosedType"><span class="hs-identifier">pmIsClosedType</span></a></a><span> </span><a name="local-6989586621683964145"><a href="#local-6989586621683964145"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-463"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">splitTyConApp_maybe</span><span> </span><a href="#local-6989586621683964145"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-464"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964148"><a href="#local-6989586621683964148"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964149"><a href="#local-6989586621683964149"><span class="hs-identifier">ty_args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-465"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964146"><span class="hs-identifier hs-var">is_algebraic_like</span></a><span> </span><a href="#local-6989586621683964148"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isFamilyTyCon</span><span> </span><a href="#local-6989586621683964148"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ty_args</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><span class="hs-identifier">tc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-467"></a><span>      </span><a name="local-6989586621683964150"><a href="#local-6989586621683964150"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-468"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-469"></a><span>    </span><span class="hs-comment">-- This returns True for TyCons which /act like/ algebraic types.</span><span>
</span><a name="line-470"></a><span>    </span><span class="hs-comment">-- (See &quot;Type#type_classification&quot; for what an algebraic type is.)</span><span>
</span><a name="line-471"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-472"></a><span>    </span><span class="hs-comment">-- This is qualified with \&quot;like\&quot; because of a particular special</span><span>
</span><a name="line-473"></a><span>    </span><span class="hs-comment">-- case: TYPE (the underlyind kind behind Type, among others). TYPE</span><span>
</span><a name="line-474"></a><span>    </span><span class="hs-comment">-- is conceptually a datatype (and thus algebraic), but in practice it is</span><span>
</span><a name="line-475"></a><span>    </span><span class="hs-comment">-- a primitive builtin type, so we must check for it specially.</span><span>
</span><a name="line-476"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-477"></a><span>    </span><span class="hs-comment">-- NB: it makes sense to think of TYPE as a closed type in a value-level,</span><span>
</span><a name="line-478"></a><span>    </span><span class="hs-comment">-- pattern-matching context. However, at the kind level, TYPE is certainly</span><span>
</span><a name="line-479"></a><span>    </span><span class="hs-comment">-- not closed! Since this function is specifically tailored towards pattern</span><span>
</span><a name="line-480"></a><span>    </span><span class="hs-comment">-- matching, however, it's OK to label TYPE as closed.</span><span>
</span><a name="line-481"></a><span>    </span><span class="hs-identifier">is_algebraic_like</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-482"></a><span>    </span><a name="local-6989586621683964146"><a href="#local-6989586621683964146"><span class="hs-identifier">is_algebraic_like</span></a></a><span> </span><a name="local-6989586621683964147"><a href="#local-6989586621683964147"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isAlgTyCon</span><span> </span><a href="#local-6989586621683964147"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621683964147"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">tYPETyCon</span><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span class="hs-identifier">pmTopNormaliseType_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-485"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">DataCon</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- ^ Get rid of *outermost* (or toplevel)</span><span>
</span><a name="line-487"></a><span class="hs-comment">--      * type function redex</span><span>
</span><a name="line-488"></a><span class="hs-comment">--      * data family redex</span><span>
</span><a name="line-489"></a><span class="hs-comment">--      * newtypes</span><span>
</span><a name="line-490"></a><span class="hs-comment">--</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- Behaves exactly like `topNormaliseType_maybe`, but instead of returning a</span><span>
</span><a name="line-492"></a><span class="hs-comment">-- coercion, it returns useful information for issuing pattern matching</span><span>
</span><a name="line-493"></a><span class="hs-comment">-- warnings. See Note [Type normalisation for EmptyCase] for details.</span><span>
</span><a name="line-494"></a><span class="hs-comment">--</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- NB: Normalisation can potentially change kinds, if the head of the type</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- is a type family with a variable result kind. I (Richard E) can't think</span><span>
</span><a name="line-497"></a><span class="hs-comment">-- of a way to cause trouble here, though.</span><span>
</span><a name="line-498"></a><a name="pmTopNormaliseType_maybe"><a href="Check.html#pmTopNormaliseType_maybe"><span class="hs-identifier">pmTopNormaliseType_maybe</span></a></a><span> </span><a name="local-6989586621683964151"><a href="#local-6989586621683964151"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621683964152"><a href="#local-6989586621683964152"><span class="hs-identifier">ty_cs</span></a></a><span> </span><a name="local-6989586621683964153"><a href="#local-6989586621683964153"><span class="hs-identifier">typ</span></a></a><span>
</span><a name="line-499"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683964183"><a href="#local-6989586621683964183"><span class="hs-identifier">mb_typ'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DsMonad.html#initTcDsForSolver"><span class="hs-identifier hs-var">initTcDsForSolver</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcSimplify.html#tcNormalise"><span class="hs-identifier hs-var">tcNormalise</span></a><span> </span><a href="#local-6989586621683964152"><span class="hs-identifier hs-var">ty_cs</span></a><span> </span><a href="#local-6989586621683964153"><span class="hs-identifier hs-var">typ</span></a><span>
</span><a name="line-500"></a><span>         </span><span class="hs-comment">-- Before proceeding, we chuck typ into the constraint solver, in case</span><span>
</span><a name="line-501"></a><span>         </span><span class="hs-comment">-- solving for given equalities may reduce typ some. See</span><span>
</span><a name="line-502"></a><span>         </span><span class="hs-comment">-- &quot;Wrinkle: local equalities&quot; in</span><span>
</span><a name="line-503"></a><span>         </span><span class="hs-comment">-- Note [Type normalisation for EmptyCase].</span><span>
</span><a name="line-504"></a><span>       </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621683964184"><a href="#local-6989586621683964184"><span class="hs-identifier">typ'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964183"><span class="hs-identifier hs-var">mb_typ'</span></a><span>
</span><a name="line-505"></a><span>                 </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621683964185"><a href="#local-6989586621683964185"><span class="hs-identifier">ty_f</span></a></a><span class="hs-special">,</span><a name="local-6989586621683964186"><a href="#local-6989586621683964186"><span class="hs-identifier">tm_f</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683964187"><a href="#local-6989586621683964187"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">topNormaliseTypeX</span><span> </span><a href="#local-6989586621683964157"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="#local-6989586621683964156"><span class="hs-identifier hs-var">comb</span></a><span> </span><a href="#local-6989586621683964184"><span class="hs-identifier hs-var">typ'</span></a><span>
</span><a name="line-506"></a><span>                 </span><span class="hs-comment">-- We need to do topNormaliseTypeX in addition to tcNormalise,</span><span>
</span><a name="line-507"></a><span>                 </span><span class="hs-comment">-- since topNormaliseX looks through newtypes, which</span><span>
</span><a name="line-508"></a><span>                 </span><span class="hs-comment">-- tcNormalise does not do.</span><span>
</span><a name="line-509"></a><span>                 </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964154"><span class="hs-identifier hs-var">eq_src_ty</span></a><span> </span><a href="#local-6989586621683964187"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964184"><span class="hs-identifier hs-var">typ'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621683964185"><span class="hs-identifier hs-var">ty_f</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964187"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964186"><span class="hs-identifier hs-var">tm_f</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964187"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-511"></a><span>    </span><span class="hs-comment">-- Find the first type in the sequence of rewrites that is a data type,</span><span>
</span><a name="line-512"></a><span>    </span><span class="hs-comment">-- newtype, or a data family application (not the representation tycon!).</span><span>
</span><a name="line-513"></a><span>    </span><span class="hs-comment">-- This is the one that is equal (in source Haskell) to the initial type.</span><span>
</span><a name="line-514"></a><span>    </span><span class="hs-comment">-- If none is found in the list, then all of them are type family</span><span>
</span><a name="line-515"></a><span>    </span><span class="hs-comment">-- applications, so we simply return the last one, which is the *simplest*.</span><span>
</span><a name="line-516"></a><span>    </span><span class="hs-identifier">eq_src_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-517"></a><span>    </span><a name="local-6989586621683964154"><a href="#local-6989586621683964154"><span class="hs-identifier">eq_src_ty</span></a></a><span> </span><a name="local-6989586621683964160"><a href="#local-6989586621683964160"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621683964161"><a href="#local-6989586621683964161"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><a href="#local-6989586621683964160"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">find</span><span> </span><a href="#local-6989586621683964155"><span class="hs-identifier hs-var">is_closed_or_data_family</span></a><span> </span><a href="#local-6989586621683964161"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span>    </span><span class="hs-identifier">is_closed_or_data_family</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-520"></a><span>    </span><a name="local-6989586621683964155"><a href="#local-6989586621683964155"><span class="hs-identifier">is_closed_or_data_family</span></a></a><span> </span><a name="local-6989586621683964162"><a href="#local-6989586621683964162"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#pmIsClosedType"><span class="hs-identifier hs-var">pmIsClosedType</span></a><span> </span><a href="#local-6989586621683964162"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">isDataFamilyAppType</span><span> </span><a href="#local-6989586621683964162"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-521"></a><span>
</span><a name="line-522"></a><span>    </span><span class="hs-comment">-- For efficiency, represent both lists as difference lists.</span><span>
</span><a name="line-523"></a><span>    </span><span class="hs-comment">-- comb performs the concatenation, for both lists.</span><span>
</span><a name="line-524"></a><span>    </span><a name="local-6989586621683964156"><a href="#local-6989586621683964156"><span class="hs-identifier">comb</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964163"><a href="#local-6989586621683964163"><span class="hs-identifier">tyf1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964164"><a href="#local-6989586621683964164"><span class="hs-identifier">tmf1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964165"><a href="#local-6989586621683964165"><span class="hs-identifier">tyf2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964166"><a href="#local-6989586621683964166"><span class="hs-identifier">tmf2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964163"><span class="hs-identifier hs-var">tyf1</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621683964165"><span class="hs-identifier hs-var">tyf2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964164"><span class="hs-identifier hs-var">tmf1</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621683964166"><span class="hs-identifier hs-var">tmf2</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>
</span><a name="line-526"></a><span>    </span><a name="local-6989586621683964157"><a href="#local-6989586621683964157"><span class="hs-identifier">stepper</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964158"><span class="hs-identifier hs-var">newTypeStepper</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">composeSteppers</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964159"><span class="hs-identifier hs-var">tyFamStepper</span></a><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span>    </span><span class="hs-comment">-- A 'NormaliseStepper' that unwraps newtypes, careful not to fall into</span><span>
</span><a name="line-529"></a><span>    </span><span class="hs-comment">-- a loop. If it would fall into a loop, it produces 'NS_Abort'.</span><span>
</span><a name="line-530"></a><span>    </span><span class="hs-identifier">newTypeStepper</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NormaliseStepper</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-type">DataCon</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">DataCon</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>    </span><a name="local-6989586621683964158"><a href="#local-6989586621683964158"><span class="hs-identifier">newTypeStepper</span></a></a><span> </span><a name="local-6989586621683964167"><a href="#local-6989586621683964167"><span class="hs-identifier">rec_nts</span></a></a><span> </span><a name="local-6989586621683964168"><a href="#local-6989586621683964168"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621683964169"><a href="#local-6989586621683964169"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-532"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964170"><a href="#local-6989586621683964170"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964171"><a href="#local-6989586621683964171"><span class="hs-identifier">_co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">instNewTyCon_maybe</span><span> </span><a href="#local-6989586621683964168"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621683964169"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-533"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">checkRecTc</span><span> </span><a href="#local-6989586621683964167"><span class="hs-identifier hs-var">rec_nts</span></a><span> </span><a href="#local-6989586621683964168"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-534"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964172"><a href="#local-6989586621683964172"><span class="hs-identifier">rec_nts'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964173"><a href="#local-6989586621683964173"><span class="hs-identifier">tyf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyConApp</span><span> </span><a href="#local-6989586621683964168"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621683964169"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>                               </span><a name="local-6989586621683964174"><a href="#local-6989586621683964174"><span class="hs-identifier">tmf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConSingleDataCon</span><span> </span><a href="#local-6989586621683964168"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-536"></a><span>                           </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">NS_Step</span><span> </span><a href="#local-6989586621683964172"><span class="hs-identifier hs-var">rec_nts'</span></a><span> </span><a href="#local-6989586621683964170"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964173"><span class="hs-identifier hs-var">tyf</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964174"><span class="hs-identifier hs-var">tmf</span></a><span class="hs-special">)</span><span>
</span><a name="line-537"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NS_Abort</span><span>
</span><a name="line-538"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-539"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NS_Done</span><span>
</span><a name="line-540"></a><span>
</span><a name="line-541"></a><span>    </span><span class="hs-identifier">tyFamStepper</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NormaliseStepper</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">DataCon</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">DataCon</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>    </span><a name="local-6989586621683964159"><a href="#local-6989586621683964159"><span class="hs-identifier">tyFamStepper</span></a></a><span> </span><a name="local-6989586621683964175"><a href="#local-6989586621683964175"><span class="hs-identifier">rec_nts</span></a></a><span> </span><a name="local-6989586621683964176"><a href="#local-6989586621683964176"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621683964177"><a href="#local-6989586621683964177"><span class="hs-identifier">tys</span></a></a><span>  </span><span class="hs-comment">-- Try to step a type/data family</span><span>
</span><a name="line-543"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964178"><a href="#local-6989586621683964178"><span class="hs-identifier">_args_co</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964179"><a href="#local-6989586621683964179"><span class="hs-identifier">ntys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964180"><a href="#local-6989586621683964180"><span class="hs-identifier">_res_co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">normaliseTcArgs</span><span> </span><a href="#local-6989586621683964151"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-identifier hs-var">Representational</span><span> </span><a href="#local-6989586621683964176"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621683964177"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-544"></a><span>          </span><span class="hs-comment">-- NB: It's OK to use normaliseTcArgs here instead of</span><span>
</span><a name="line-545"></a><span>          </span><span class="hs-comment">-- normalise_tc_args (which takes the LiftingContext described</span><span>
</span><a name="line-546"></a><span>          </span><span class="hs-comment">-- in Note [Normalising types]) because the reduceTyFamApp below</span><span>
</span><a name="line-547"></a><span>          </span><span class="hs-comment">-- works only at top level. We'll never recur in this function</span><span>
</span><a name="line-548"></a><span>          </span><span class="hs-comment">-- after reducing the kind of a bound tyvar.</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reduceTyFamApp_maybe</span><span> </span><a href="#local-6989586621683964151"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-identifier hs-var">Representational</span><span> </span><a href="#local-6989586621683964176"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621683964179"><span class="hs-identifier hs-var">ntys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-551"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964181"><a href="#local-6989586621683964181"><span class="hs-identifier">_co</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964182"><a href="#local-6989586621683964182"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NS_Step</span><span> </span><a href="#local-6989586621683964175"><span class="hs-identifier hs-var">rec_nts</span></a><span> </span><a href="#local-6989586621683964182"><span class="hs-identifier hs-var">rhs</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621683964182"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-glyph">:</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">id</span><span class="hs-special">)</span><span>
</span><a name="line-552"></a><span>          </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">NS_Done</span><span>
</span><a name="line-553"></a><span>
</span><a name="line-554"></a><span class="hs-comment">-- | Determine suitable constraints to use at the beginning of pattern-match</span><span>
</span><a name="line-555"></a><span class="hs-comment">-- coverage checking by consulting the sets of term and type constraints</span><span>
</span><a name="line-556"></a><span class="hs-comment">-- currently in scope. If one of these sets of constraints is unsatisfiable,</span><span>
</span><a name="line-557"></a><span class="hs-comment">-- use an empty set in its place. (See</span><span>
</span><a name="line-558"></a><span class="hs-comment">-- @Note [Recovering from unsatisfiable pattern-matching constraints]@</span><span>
</span><a name="line-559"></a><span class="hs-comment">-- for why this is done.)</span><span>
</span><a name="line-560"></a><span class="hs-identifier">pmInitialTmTyCs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span>
</span><a name="line-561"></a><a name="pmInitialTmTyCs"><a href="Check.html#pmInitialTmTyCs"><span class="hs-identifier">pmInitialTmTyCs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-562"></a><span>  </span><a name="local-6989586621683964188"><a href="#local-6989586621683964188"><span class="hs-identifier">ty_cs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#getDictsDs"><span class="hs-identifier hs-var">getDictsDs</span></a><span>
</span><a name="line-563"></a><span>  </span><a name="local-6989586621683964189"><a href="#local-6989586621683964189"><span class="hs-identifier">tm_cs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toComplex</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">bagToList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#getTmCsDs"><span class="hs-identifier hs-var">getTmCsDs</span></a><span>
</span><a name="line-564"></a><span>  </span><a name="local-6989586621683964190"><a href="#local-6989586621683964190"><span class="hs-identifier">sat_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#tyOracle"><span class="hs-identifier hs-var">tyOracle</span></a><span> </span><a href="#local-6989586621683964188"><span class="hs-identifier hs-var">ty_cs</span></a><span>
</span><a name="line-565"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964191"><a href="#local-6989586621683964191"><span class="hs-identifier">initTyCs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621683964190"><span class="hs-identifier hs-var">sat_ty</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621683964188"><span class="hs-identifier hs-var">ty_cs</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span>
</span><a name="line-566"></a><span>      </span><a name="local-6989586621683964192"><a href="#local-6989586621683964192"><span class="hs-identifier">initTmState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><a href="TmOracle.html#initialTmState"><span class="hs-identifier hs-var">initialTmState</span></a><span> </span><span class="hs-special">(</span><a href="TmOracle.html#tmOracle"><span class="hs-identifier hs-var">tmOracle</span></a><span> </span><a href="TmOracle.html#initialTmState"><span class="hs-identifier hs-var">initialTmState</span></a><span> </span><a href="#local-6989586621683964189"><span class="hs-identifier hs-var">tm_cs</span></a><span class="hs-special">)</span><span>
</span><a name="line-567"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#MkDelta"><span class="hs-identifier hs-var">MkDelta</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964192"><span class="hs-identifier hs-var">initTmState</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">delta_ty_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964191"><span class="hs-identifier hs-var">initTyCs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a><span class="hs-comment">{-
Note [Recovering from unsatisfiable pattern-matching constraints]
~~~~~~~~~~~~~~~~
Consider the following code (see #12957 and #15450):

  f :: Int ~ Bool =&gt; ()
  f = case True of { False -&gt; () }

We want to warn that the pattern-matching in `f` is non-exhaustive. But GHC
used not to do this; in fact, it would warn that the match was /redundant/!
This is because the constraint (Int ~ Bool) in `f` is unsatisfiable, and the
coverage checker deems any matches with unsatifiable constraint sets to be
unreachable.

We decide to better than this. When beginning coverage checking, we first
check if the constraints in scope are unsatisfiable, and if so, we start
afresh with an empty set of constraints. This way, we'll get the warnings
that we expect.
-}</span><span>
</span><a name="line-588"></a><span>
</span><a name="line-589"></a><span class="hs-comment">-- | Given a conlike's term constraints, type constraints, and strict argument</span><span>
</span><a name="line-590"></a><span class="hs-comment">-- types, check if they are satisfiable.</span><span>
</span><a name="line-591"></a><span class="hs-comment">-- (In other words, this is the &#8866;_Sat oracle judgment from the GADTs Meet</span><span>
</span><a name="line-592"></a><span class="hs-comment">-- Their Match paper.)</span><span>
</span><a name="line-593"></a><span class="hs-comment">--</span><span>
</span><a name="line-594"></a><span class="hs-comment">-- For the purposes of efficiency, this takes as separate arguments the</span><span>
</span><a name="line-595"></a><span class="hs-comment">-- ambient term and type constraints (which are known beforehand to be</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- satisfiable), as well as the new term and type constraints (which may not</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- be satisfiable). This lets us implement two mini-optimizations:</span><span>
</span><a name="line-598"></a><span class="hs-comment">--</span><span>
</span><a name="line-599"></a><span class="hs-comment">-- * If there are no new type constraints, then don't bother initializing</span><span>
</span><a name="line-600"></a><span class="hs-comment">--   the type oracle, since it's redundant to do so.</span><span>
</span><a name="line-601"></a><span class="hs-comment">-- * Since the new term constraint is a separate argument, we only need to</span><span>
</span><a name="line-602"></a><span class="hs-comment">--   execute one iteration of the term oracle (instead of traversing the</span><span>
</span><a name="line-603"></a><span class="hs-comment">--   entire set of term constraints).</span><span>
</span><a name="line-604"></a><span class="hs-comment">--</span><span>
</span><a name="line-605"></a><span class="hs-comment">-- Taking strict argument types into account is something which was not</span><span>
</span><a name="line-606"></a><span class="hs-comment">-- discussed in GADTs Meet Their Match. For an explanation of what role they</span><span>
</span><a name="line-607"></a><span class="hs-comment">-- serve, see @Note [Extensions to GADTs Meet Their Match]@.</span><span>
</span><a name="line-608"></a><span class="hs-identifier">pmIsSatisfiable</span><span>
</span><a name="line-609"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span>     </span><span class="hs-comment">-- ^ The ambient term and type constraints</span><span>
</span><a name="line-610"></a><span>               </span><span class="hs-comment">--   (known to be satisfiable).</span><span>
</span><a name="line-611"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ComplexEq</span><span> </span><span class="hs-comment">-- ^ The new term constraint.</span><span>
</span><a name="line-612"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span> </span><span class="hs-comment">-- ^ The new type constraints.</span><span>
</span><a name="line-613"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ The strict argument types.</span><span>
</span><a name="line-614"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-615"></a><span>               </span><span class="hs-comment">-- ^ @'Just' delta@ if the constraints (@delta@) are</span><span>
</span><a name="line-616"></a><span>               </span><span class="hs-comment">-- satisfiable, and each strict argument type is inhabitable.</span><span>
</span><a name="line-617"></a><span>               </span><span class="hs-comment">-- 'Nothing' otherwise.</span><span>
</span><a name="line-618"></a><a name="pmIsSatisfiable"><a href="Check.html#pmIsSatisfiable"><span class="hs-identifier">pmIsSatisfiable</span></a></a><span> </span><a name="local-6989586621683964193"><a href="#local-6989586621683964193"><span class="hs-identifier">amb_cs</span></a></a><span> </span><a name="local-6989586621683964194"><a href="#local-6989586621683964194"><span class="hs-identifier">new_tm_c</span></a></a><span> </span><a name="local-6989586621683964195"><a href="#local-6989586621683964195"><span class="hs-identifier">new_ty_cs</span></a></a><span> </span><a name="local-6989586621683964196"><a href="#local-6989586621683964196"><span class="hs-identifier">strict_arg_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-619"></a><span>  </span><a name="local-6989586621683964197"><a href="#local-6989586621683964197"><span class="hs-identifier">mb_sat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#tmTyCsAreSatisfiable"><span class="hs-identifier hs-var">tmTyCsAreSatisfiable</span></a><span> </span><a href="#local-6989586621683964193"><span class="hs-identifier hs-var">amb_cs</span></a><span> </span><a href="#local-6989586621683964194"><span class="hs-identifier hs-var">new_tm_c</span></a><span> </span><a href="#local-6989586621683964195"><span class="hs-identifier hs-var">new_ty_cs</span></a><span>
</span><a name="line-620"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964197"><span class="hs-identifier hs-var">mb_sat</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-621"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-622"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964198"><a href="#local-6989586621683964198"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-623"></a><span>      </span><span class="hs-comment">-- We know that the term and type constraints are inhabitable, so now</span><span>
</span><a name="line-624"></a><span>      </span><span class="hs-comment">-- check if each strict argument type is inhabitable.</span><span>
</span><a name="line-625"></a><span>      </span><a name="local-6989586621683964199"><a href="#local-6989586621683964199"><span class="hs-identifier">all_non_void</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#checkAllNonVoid"><span class="hs-identifier hs-var">checkAllNonVoid</span></a><span> </span><span class="hs-identifier hs-var">initRecTc</span><span> </span><a href="#local-6989586621683964198"><span class="hs-identifier hs-var">delta</span></a><span> </span><a href="#local-6989586621683964196"><span class="hs-identifier hs-var">strict_arg_tys</span></a><span>
</span><a name="line-626"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621683964199"><span class="hs-identifier hs-var">all_non_void</span></a><span> </span><span class="hs-comment">-- Check if each strict argument type</span><span>
</span><a name="line-627"></a><span>                             </span><span class="hs-comment">-- is inhabitable</span><span>
</span><a name="line-628"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621683964198"><span class="hs-identifier hs-var">delta</span></a><span>
</span><a name="line-629"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span class="hs-comment">-- | Like 'pmIsSatisfiable', but only checks if term and type constraints are</span><span>
</span><a name="line-632"></a><span class="hs-comment">-- satisfiable, and doesn't bother checking anything related to strict argument</span><span>
</span><a name="line-633"></a><span class="hs-comment">-- types.</span><span>
</span><a name="line-634"></a><span class="hs-identifier">tmTyCsAreSatisfiable</span><span>
</span><a name="line-635"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span>     </span><span class="hs-comment">-- ^ The ambient term and type constraints</span><span>
</span><a name="line-636"></a><span>               </span><span class="hs-comment">--   (known to be satisfiable).</span><span>
</span><a name="line-637"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ComplexEq</span><span> </span><span class="hs-comment">-- ^ The new term constraint.</span><span>
</span><a name="line-638"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span> </span><span class="hs-comment">-- ^ The new type constraints.</span><span>
</span><a name="line-639"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-640"></a><span>       </span><span class="hs-comment">-- ^ @'Just' delta@ if the constraints (@delta@) are</span><span>
</span><a name="line-641"></a><span>       </span><span class="hs-comment">-- satisfiable. 'Nothing' otherwise.</span><span>
</span><a name="line-642"></a><a name="tmTyCsAreSatisfiable"><a href="Check.html#tmTyCsAreSatisfiable"><span class="hs-identifier">tmTyCsAreSatisfiable</span></a></a><span>
</span><a name="line-643"></a><span>    </span><span class="hs-special">(</span><a href="Check.html#MkDelta"><span class="hs-identifier hs-var">MkDelta</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964200"><a href="#local-6989586621683964200"><span class="hs-identifier">amb_tm_cs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">delta_ty_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964201"><a href="#local-6989586621683964201"><span class="hs-identifier">amb_ty_cs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-644"></a><span>    </span><a name="local-6989586621683964202"><a href="#local-6989586621683964202"><span class="hs-identifier">new_tm_c</span></a></a><span> </span><a name="local-6989586621683964203"><a href="#local-6989586621683964203"><span class="hs-identifier">new_ty_cs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-645"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964204"><a href="#local-6989586621683964204"><span class="hs-identifier">ty_cs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964203"><span class="hs-identifier hs-var">new_ty_cs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unionBags</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964201"><span class="hs-identifier hs-var">amb_ty_cs</span></a><span>
</span><a name="line-646"></a><span>  </span><a name="local-6989586621683964205"><a href="#local-6989586621683964205"><span class="hs-identifier">sat_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isEmptyBag</span><span> </span><a href="#local-6989586621683964203"><span class="hs-identifier hs-var">new_ty_cs</span></a><span>
</span><a name="line-647"></a><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-648"></a><span>               </span><span class="hs-keyword">else</span><span> </span><a href="Check.html#tyOracle"><span class="hs-identifier hs-var">tyOracle</span></a><span> </span><a href="#local-6989586621683964204"><span class="hs-identifier hs-var">ty_cs</span></a><span>
</span><a name="line-649"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964205"><span class="hs-identifier hs-var">sat_ty</span></a><span class="hs-special">,</span><span> </span><a href="TmOracle.html#solveOneEq"><span class="hs-identifier hs-var">solveOneEq</span></a><span> </span><a href="#local-6989586621683964200"><span class="hs-identifier hs-var">amb_tm_cs</span></a><span> </span><a href="#local-6989586621683964202"><span class="hs-identifier hs-var">new_tm_c</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-650"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964206"><a href="#local-6989586621683964206"><span class="hs-identifier">term_cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#MkDelta"><span class="hs-identifier hs-var">MkDelta</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_ty_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964204"><span class="hs-identifier hs-var">ty_cs</span></a><span>
</span><a name="line-651"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964206"><span class="hs-identifier hs-var">term_cs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-652"></a><span>           </span><a name="local-6989586621683964207"><a href="#local-6989586621683964207"><span class="hs-identifier">_unsat</span></a></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-653"></a><span>
</span><a name="line-654"></a><span class="hs-comment">-- | Implements two performance optimizations, as described in the</span><span>
</span><a name="line-655"></a><span class="hs-comment">-- \&quot;Strict argument type constraints\&quot; section of</span><span>
</span><a name="line-656"></a><span class="hs-comment">-- @Note [Extensions to GADTs Meet Their Match]@.</span><span>
</span><a name="line-657"></a><span class="hs-identifier">checkAllNonVoid</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RecTcChecker</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-658"></a><a name="checkAllNonVoid"><a href="Check.html#checkAllNonVoid"><span class="hs-identifier">checkAllNonVoid</span></a></a><span> </span><a name="local-6989586621683964208"><a href="#local-6989586621683964208"><span class="hs-identifier">rec_ts</span></a></a><span> </span><a name="local-6989586621683964209"><a href="#local-6989586621683964209"><span class="hs-identifier">amb_cs</span></a></a><span> </span><a name="local-6989586621683964210"><a href="#local-6989586621683964210"><span class="hs-identifier">strict_arg_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-659"></a><span>  </span><a name="local-6989586621683964211"><a href="#local-6989586621683964211"><span class="hs-identifier">fam_insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a><span>
</span><a name="line-660"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964212"><a href="#local-6989586621683964212"><span class="hs-identifier">definitely_inhabited</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-661"></a><span>        </span><a href="Check.html#definitelyInhabitedType"><span class="hs-identifier hs-var">definitelyInhabitedType</span></a><span> </span><a href="#local-6989586621683964211"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_ty_cs</span><span> </span><a href="#local-6989586621683964209"><span class="hs-identifier hs-var">amb_cs</span></a><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>  </span><a name="local-6989586621683964213"><a href="#local-6989586621683964213"><span class="hs-identifier">tys_to_check</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">filterOutM</span><span> </span><a href="#local-6989586621683964212"><span class="hs-identifier hs-var">definitely_inhabited</span></a><span> </span><a href="#local-6989586621683964210"><span class="hs-identifier hs-var">strict_arg_tys</span></a><span>
</span><a name="line-663"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964214"><a href="#local-6989586621683964214"><span class="hs-identifier">rec_max_bound</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964213"><span class="hs-identifier hs-var">tys_to_check</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthExceeds</span><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-664"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-665"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-666"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">defaultRecTcMaxBound</span><span>
</span><a name="line-667"></a><span>      </span><a name="local-6989586621683964215"><a href="#local-6989586621683964215"><span class="hs-identifier">rec_ts'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">setRecTcMaxBound</span><span> </span><a href="#local-6989586621683964214"><span class="hs-identifier hs-var">rec_max_bound</span></a><span> </span><a href="#local-6989586621683964208"><span class="hs-identifier hs-var">rec_ts</span></a><span>
</span><a name="line-668"></a><span>  </span><span class="hs-identifier hs-var">allM</span><span> </span><span class="hs-special">(</span><a href="Check.html#nonVoid"><span class="hs-identifier hs-var">nonVoid</span></a><span> </span><a href="#local-6989586621683964215"><span class="hs-identifier hs-var">rec_ts'</span></a><span> </span><a href="#local-6989586621683964209"><span class="hs-identifier hs-var">amb_cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964213"><span class="hs-identifier hs-var">tys_to_check</span></a><span>
</span><a name="line-669"></a><span>
</span><a name="line-670"></a><span class="hs-comment">-- | Checks if a strict argument type of a conlike is inhabitable by a</span><span>
</span><a name="line-671"></a><span class="hs-comment">-- terminating value (i.e, an 'InhabitationCandidate').</span><span>
</span><a name="line-672"></a><span class="hs-comment">-- See @Note [Extensions to GADTs Meet Their Match]@.</span><span>
</span><a name="line-673"></a><span class="hs-identifier">nonVoid</span><span>
</span><a name="line-674"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RecTcChecker</span><span> </span><span class="hs-comment">-- ^ The per-'TyCon' recursion depth limit.</span><span>
</span><a name="line-675"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span>        </span><span class="hs-comment">-- ^ The ambient term/type constraints (known to be</span><span>
</span><a name="line-676"></a><span>                  </span><span class="hs-comment">--   satisfiable).</span><span>
</span><a name="line-677"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>         </span><span class="hs-comment">-- ^ The strict argument type.</span><span>
</span><a name="line-678"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- ^ 'True' if the strict argument type might be inhabited by</span><span>
</span><a name="line-679"></a><span>                  </span><span class="hs-comment">--   a terminating value (i.e., an 'InhabitationCandidate').</span><span>
</span><a name="line-680"></a><span>                  </span><span class="hs-comment">--   'False' if it is definitely uninhabitable by anything</span><span>
</span><a name="line-681"></a><span>                  </span><span class="hs-comment">--   (except bottom).</span><span>
</span><a name="line-682"></a><a name="nonVoid"><a href="Check.html#nonVoid"><span class="hs-identifier">nonVoid</span></a></a><span> </span><a name="local-6989586621683964216"><a href="#local-6989586621683964216"><span class="hs-identifier">rec_ts</span></a></a><span> </span><a name="local-6989586621683964217"><a href="#local-6989586621683964217"><span class="hs-identifier">amb_cs</span></a></a><span> </span><a name="local-6989586621683964218"><a href="#local-6989586621683964218"><span class="hs-identifier">strict_arg_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-683"></a><span>  </span><a name="local-6989586621683964227"><a href="#local-6989586621683964227"><span class="hs-identifier">mb_cands</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#inhabitationCandidates"><span class="hs-identifier hs-var">inhabitationCandidates</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_ty_cs</span><span> </span><a href="#local-6989586621683964217"><span class="hs-identifier hs-var">amb_cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964218"><span class="hs-identifier hs-var">strict_arg_ty</span></a><span>
</span><a name="line-684"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964227"><span class="hs-identifier hs-var">mb_cands</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-685"></a><span>    </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964228"><a href="#local-6989586621683964228"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964229"><a href="#local-6989586621683964229"><span class="hs-identifier">cands</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-686"></a><span>      </span><span class="hs-glyph">|</span><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964230"><a href="#local-6989586621683964230"><span class="hs-identifier">rec_ts'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">checkRecTc</span><span> </span><a href="#local-6989586621683964216"><span class="hs-identifier hs-var">rec_ts</span></a><span> </span><a href="#local-6989586621683964228"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-687"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">anyM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964219"><span class="hs-identifier hs-var">cand_is_inhabitable</span></a><span> </span><a href="#local-6989586621683964230"><span class="hs-identifier hs-var">rec_ts'</span></a><span> </span><a href="#local-6989586621683964217"><span class="hs-identifier hs-var">amb_cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964229"><span class="hs-identifier hs-var">cands</span></a><span>
</span><a name="line-688"></a><span>           </span><span class="hs-comment">-- A strict argument type is inhabitable by a terminating value if</span><span>
</span><a name="line-689"></a><span>           </span><span class="hs-comment">-- at least one InhabitationCandidate is inhabitable.</span><span>
</span><a name="line-690"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-691"></a><span>           </span><span class="hs-comment">-- Either the type is trivially inhabited or we have exceeded the</span><span>
</span><a name="line-692"></a><span>           </span><span class="hs-comment">-- recursion depth for some TyCon (so bail out and conservatively</span><span>
</span><a name="line-693"></a><span>           </span><span class="hs-comment">-- claim the type is inhabited).</span><span>
</span><a name="line-694"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-695"></a><span>    </span><span class="hs-comment">-- Checks if an InhabitationCandidate for a strict argument type:</span><span>
</span><a name="line-696"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-697"></a><span>    </span><span class="hs-comment">-- (1) Has satisfiable term and type constraints.</span><span>
</span><a name="line-698"></a><span>    </span><span class="hs-comment">-- (2) Has 'nonVoid' strict argument types (we bail out of this</span><span>
</span><a name="line-699"></a><span>    </span><span class="hs-comment">--     check if recursion is detected).</span><span>
</span><a name="line-700"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-701"></a><span>    </span><span class="hs-comment">-- See Note [Extensions to GADTs Meet Their Match]</span><span>
</span><a name="line-702"></a><span>    </span><span class="hs-identifier">cand_is_inhabitable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RecTcChecker</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Delta"><span class="hs-identifier hs-type">Delta</span></a><span>
</span><a name="line-703"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-type">InhabitationCandidate</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-704"></a><span>    </span><a name="local-6989586621683964219"><a href="#local-6989586621683964219"><span class="hs-identifier">cand_is_inhabitable</span></a></a><span> </span><a name="local-6989586621683964220"><a href="#local-6989586621683964220"><span class="hs-identifier">rec_ts</span></a></a><span> </span><a name="local-6989586621683964221"><a href="#local-6989586621683964221"><span class="hs-identifier">amb_cs</span></a></a><span>
</span><a name="line-705"></a><span>      </span><span class="hs-special">(</span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-var">InhabitationCandidate</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_tm_ct</span><span>          </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964222"><a href="#local-6989586621683964222"><span class="hs-identifier">new_term_c</span></a></a><span>
</span><a name="line-706"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_ty_cs</span><span>          </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964223"><a href="#local-6989586621683964223"><span class="hs-identifier">new_ty_cs</span></a></a><span>
</span><a name="line-707"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_strict_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964224"><a href="#local-6989586621683964224"><span class="hs-identifier">new_strict_arg_tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-708"></a><span>        </span><a name="local-6989586621683964225"><a href="#local-6989586621683964225"><span class="hs-identifier">mb_sat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#tmTyCsAreSatisfiable"><span class="hs-identifier hs-var">tmTyCsAreSatisfiable</span></a><span> </span><a href="#local-6989586621683964221"><span class="hs-identifier hs-var">amb_cs</span></a><span> </span><a href="#local-6989586621683964222"><span class="hs-identifier hs-var">new_term_c</span></a><span> </span><a href="#local-6989586621683964223"><span class="hs-identifier hs-var">new_ty_cs</span></a><span>
</span><a name="line-709"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964225"><span class="hs-identifier hs-var">mb_sat</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-710"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-711"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964226"><a href="#local-6989586621683964226"><span class="hs-identifier">new_delta</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-712"></a><span>            </span><a href="Check.html#checkAllNonVoid"><span class="hs-identifier hs-var">checkAllNonVoid</span></a><span> </span><a href="#local-6989586621683964220"><span class="hs-identifier hs-var">rec_ts</span></a><span> </span><a href="#local-6989586621683964226"><span class="hs-identifier hs-var">new_delta</span></a><span> </span><a href="#local-6989586621683964224"><span class="hs-identifier hs-var">new_strict_arg_tys</span></a><span>
</span><a name="line-713"></a><span>
</span><a name="line-714"></a><span class="hs-comment">-- | @'definitelyInhabitedType' ty@ returns 'True' if @ty@ has at least one</span><span>
</span><a name="line-715"></a><span class="hs-comment">-- constructor @C@ such that:</span><span>
</span><a name="line-716"></a><span class="hs-comment">--</span><span>
</span><a name="line-717"></a><span class="hs-comment">-- 1. @C@ has no equality constraints.</span><span>
</span><a name="line-718"></a><span class="hs-comment">-- 2. @C@ has no strict argument types.</span><span>
</span><a name="line-719"></a><span class="hs-comment">--</span><span>
</span><a name="line-720"></a><span class="hs-comment">-- See the \&quot;Strict argument type constraints\&quot; section of</span><span>
</span><a name="line-721"></a><span class="hs-comment">-- @Note [Extensions to GADTs Meet Their Match]@.</span><span>
</span><a name="line-722"></a><span class="hs-identifier">definitelyInhabitedType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-723"></a><a name="definitelyInhabitedType"><a href="Check.html#definitelyInhabitedType"><span class="hs-identifier">definitelyInhabitedType</span></a></a><span> </span><a name="local-6989586621683964231"><a href="#local-6989586621683964231"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621683964232"><a href="#local-6989586621683964232"><span class="hs-identifier">ty_cs</span></a></a><span> </span><a name="local-6989586621683964233"><a href="#local-6989586621683964233"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-724"></a><span>  </span><a name="local-6989586621683964236"><a href="#local-6989586621683964236"><span class="hs-identifier">mb_res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmTopNormaliseType_maybe"><span class="hs-identifier hs-var">pmTopNormaliseType_maybe</span></a><span> </span><a href="#local-6989586621683964231"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621683964232"><span class="hs-identifier hs-var">ty_cs</span></a><span> </span><a href="#local-6989586621683964233"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-725"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964236"><span class="hs-identifier hs-var">mb_res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-726"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683964237"><a href="#local-6989586621683964237"><span class="hs-identifier">cons</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="#local-6989586621683964234"><span class="hs-identifier hs-var">meets_criteria</span></a><span> </span><a href="#local-6989586621683964237"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-727"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-728"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-729"></a><span>    </span><span class="hs-identifier">meets_criteria</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-730"></a><span>    </span><a name="local-6989586621683964234"><a href="#local-6989586621683964234"><span class="hs-identifier">meets_criteria</span></a></a><span> </span><a name="local-6989586621683964235"><a href="#local-6989586621683964235"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-731"></a><span>      </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConEqSpec</span><span> </span><a href="#local-6989586621683964235"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-comment">-- (1)</span><span>
</span><a name="line-732"></a><span>      </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConImplBangs</span><span> </span><a href="#local-6989586621683964235"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (2)</span><span>
</span><a name="line-733"></a><span>
</span><a name="line-734"></a><span class="hs-comment">{- Note [Type normalisation for EmptyCase]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
EmptyCase is an exception for pattern matching, since it is strict. This means
that it boils down to checking whether the type of the scrutinee is inhabited.
Function pmTopNormaliseType_maybe gets rid of the outermost type function/data
family redex and newtypes, in search of an algebraic type constructor, which is
easier to check for inhabitation.

It returns 3 results instead of one, because there are 2 subtle points:
1. Newtypes are isomorphic to the underlying type in core but not in the source
   language,
2. The representational data family tycon is used internally but should not be
   shown to the user

Hence, if pmTopNormaliseType_maybe env ty_cs ty = Just (src_ty, dcs, core_ty),
then
  (a) src_ty is the rewritten type which we can show to the user. That is, the
      type we get if we rewrite type families but not data families or
      newtypes.
  (b) dcs is the list of data constructors &quot;skipped&quot;, every time we normalise a
      newtype to its core representation, we keep track of the source data
      constructor.
  (c) core_ty is the rewritten type. That is,
        pmTopNormaliseType_maybe env ty_cs ty = Just (src_ty, dcs, core_ty)
      implies
        topNormaliseType_maybe env ty = Just (co, core_ty)
      for some coercion co.

To see how all cases come into play, consider the following example:

  data family T a :: *
  data instance T Int = T1 | T2 Bool
  -- Which gives rise to FC:
  --   data T a
  --   data R:TInt = T1 | T2 Bool
  --   axiom ax_ti : T Int ~R R:TInt

  newtype G1 = MkG1 (T Int)
  newtype G2 = MkG2 G1

  type instance F Int  = F Char
  type instance F Char = G2

In this case pmTopNormaliseType_maybe env ty_cs (F Int) results in

  Just (G2, [MkG2,MkG1], R:TInt)

Which means that in source Haskell:
  - G2 is equivalent to F Int (in contrast, G1 isn't).
  - if (x : R:TInt) then (MkG2 (MkG1 x) : F Int).

-----
-- Wrinkle: Local equalities
-----

Given the following type family:

  type family F a
  type instance F Int = Void

Should the following program (from #14813) be considered exhaustive?

  f :: (i ~ Int) =&gt; F i -&gt; a
  f x = case x of {}

You might think &quot;of course, since `x` is obviously of type Void&quot;. But the
idType of `x` is technically F i, not Void, so if we pass F i to
inhabitationCandidates, we'll mistakenly conclude that `f` is non-exhaustive.
In order to avoid this pitfall, we need to normalise the type passed to
pmTopNormaliseType_maybe, using the constraint solver to solve for any local
equalities (such as i ~ Int) that may be in scope.
-}</span><span>
</span><a name="line-806"></a><span>
</span><a name="line-807"></a><span class="hs-comment">-- | Generate all 'InhabitationCandidate's for a given type. The result is</span><span>
</span><a name="line-808"></a><span class="hs-comment">-- either @'Left' ty@, if the type cannot be reduced to a closed algebraic type</span><span>
</span><a name="line-809"></a><span class="hs-comment">-- (or if it's one trivially inhabited, like 'Int'), or @'Right' candidates@,</span><span>
</span><a name="line-810"></a><span class="hs-comment">-- if it can. In this case, the candidates are the signature of the tycon, each</span><span>
</span><a name="line-811"></a><span class="hs-comment">-- one accompanied by the term- and type- constraints it gives rise to.</span><span>
</span><a name="line-812"></a><span class="hs-comment">-- See also Note [Checking EmptyCase Expressions]</span><span>
</span><a name="line-813"></a><span class="hs-identifier">inhabitationCandidates</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-814"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TyCon</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-type">InhabitationCandidate</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-815"></a><a name="inhabitationCandidates"><a href="Check.html#inhabitationCandidates"><span class="hs-identifier">inhabitationCandidates</span></a></a><span> </span><a name="local-6989586621683964238"><a href="#local-6989586621683964238"><span class="hs-identifier">ty_cs</span></a></a><span> </span><a name="local-6989586621683964239"><a href="#local-6989586621683964239"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-816"></a><span>  </span><a name="local-6989586621683964255"><a href="#local-6989586621683964255"><span class="hs-identifier">fam_insts</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a><span>
</span><a name="line-817"></a><span>  </span><a name="local-6989586621683964256"><a href="#local-6989586621683964256"><span class="hs-identifier">mb_norm_res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmTopNormaliseType_maybe"><span class="hs-identifier hs-var">pmTopNormaliseType_maybe</span></a><span> </span><a href="#local-6989586621683964255"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964238"><span class="hs-identifier hs-var">ty_cs</span></a><span> </span><a href="#local-6989586621683964239"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-818"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964256"><span class="hs-identifier hs-var">mb_norm_res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-819"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964257"><a href="#local-6989586621683964257"><span class="hs-identifier">src_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964258"><a href="#local-6989586621683964258"><span class="hs-identifier">dcs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964259"><a href="#local-6989586621683964259"><span class="hs-identifier">core_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964242"><span class="hs-identifier hs-var">alts_to_check</span></a><span> </span><a href="#local-6989586621683964257"><span class="hs-identifier hs-var">src_ty</span></a><span> </span><a href="#local-6989586621683964259"><span class="hs-identifier hs-var">core_ty</span></a><span> </span><a href="#local-6989586621683964258"><span class="hs-identifier hs-var">dcs</span></a><span>
</span><a name="line-820"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964242"><span class="hs-identifier hs-var">alts_to_check</span></a><span> </span><a href="#local-6989586621683964239"><span class="hs-identifier hs-var">ty</span></a><span>     </span><a href="#local-6989586621683964239"><span class="hs-identifier hs-var">ty</span></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-821"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-822"></a><span>    </span><span class="hs-comment">-- All these types are trivially inhabited</span><span>
</span><a name="line-823"></a><span>    </span><a name="local-6989586621683964240"><a href="#local-6989586621683964240"><span class="hs-identifier">trivially_inhabited</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">charTyCon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">doubleTyCon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">floatTyCon</span><span>
</span><a name="line-824"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">intTyCon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">wordTyCon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">word8TyCon</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-825"></a><span>
</span><a name="line-826"></a><span>    </span><span class="hs-comment">-- Note: At the moment we leave all the typing and constraint fields of</span><span>
</span><a name="line-827"></a><span>    </span><span class="hs-comment">-- PmCon empty, since we know that they are not gonna be used. Is the</span><span>
</span><a name="line-828"></a><span>    </span><span class="hs-comment">-- right-thing-to-do to actually create them, even if they are never used?</span><span>
</span><a name="line-829"></a><span>    </span><span class="hs-identifier">build_tm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">DataCon</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span>
</span><a name="line-830"></a><span>    </span><a name="local-6989586621683964241"><a href="#local-6989586621683964241"><span class="hs-identifier">build_tm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621683964243"><a href="#local-6989586621683964243"><span class="hs-identifier">dc</span></a></a><span> </span><a name="local-6989586621683964244"><a href="#local-6989586621683964244"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><a href="#local-6989586621683964243"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964244"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-831"></a><span>
</span><a name="line-832"></a><span>    </span><span class="hs-comment">-- Inhabitation candidates, using the result of pmTopNormaliseType_maybe</span><span>
</span><a name="line-833"></a><span>    </span><span class="hs-identifier">alts_to_check</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">DataCon</span><span class="hs-special">]</span><span>
</span><a name="line-834"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TyCon</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-type">InhabitationCandidate</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-835"></a><span>    </span><a name="local-6989586621683964242"><a href="#local-6989586621683964242"><span class="hs-identifier">alts_to_check</span></a></a><span> </span><a name="local-6989586621683964245"><a href="#local-6989586621683964245"><span class="hs-identifier">src_ty</span></a></a><span> </span><a name="local-6989586621683964246"><a href="#local-6989586621683964246"><span class="hs-identifier">core_ty</span></a></a><span> </span><a name="local-6989586621683964247"><a href="#local-6989586621683964247"><span class="hs-identifier">dcs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">splitTyConApp_maybe</span><span> </span><a href="#local-6989586621683964246"><span class="hs-identifier hs-var">core_ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-836"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964248"><a href="#local-6989586621683964248"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-837"></a><span>        </span><span class="hs-glyph">|</span><span>  </span><a href="#local-6989586621683964248"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964240"><span class="hs-identifier hs-var">trivially_inhabited</span></a><span>
</span><a name="line-838"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964247"><span class="hs-identifier hs-var">dcs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-839"></a><span>             </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621683964245"><span class="hs-identifier hs-var">src_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-840"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621683964249"><a href="#local-6989586621683964249"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a><span> </span><a href="#local-6989586621683964246"><span class="hs-identifier hs-var">core_ty</span></a><span>
</span><a name="line-841"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964250"><a href="#local-6989586621683964250"><span class="hs-identifier">va</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964241"><span class="hs-identifier hs-var">build_tm</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a href="#local-6989586621683964249"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964247"><span class="hs-identifier hs-var">dcs</span></a><span>
</span><a name="line-842"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964248"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-var">InhabitationCandidate</span></a><span>
</span><a name="line-843"></a><span>                           </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_val_abs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964250"><span class="hs-identifier hs-var">va</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_tm_ct</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#mkIdEq"><span class="hs-identifier hs-var">mkIdEq</span></a><span> </span><a href="#local-6989586621683964249"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-844"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_ty_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_strict_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-845"></a><span>
</span><a name="line-846"></a><span>        </span><span class="hs-glyph">|</span><span>  </span><a href="Check.html#pmIsClosedType"><span class="hs-identifier hs-var">pmIsClosedType</span></a><span> </span><a href="#local-6989586621683964246"><span class="hs-identifier hs-var">core_ty</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isAbstractTyCon</span><span> </span><a href="#local-6989586621683964248"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-847"></a><span>           </span><span class="hs-comment">-- Don't consider abstract tycons since we don't know what their</span><span>
</span><a name="line-848"></a><span>           </span><span class="hs-comment">-- constructors are, which makes the results of coverage checking</span><span>
</span><a name="line-849"></a><span>           </span><span class="hs-comment">-- them extremely misleading.</span><span>
</span><a name="line-850"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-851"></a><span>             </span><a name="local-6989586621683964251"><a href="#local-6989586621683964251"><span class="hs-identifier">var</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a><span> </span><a href="#local-6989586621683964246"><span class="hs-identifier hs-var">core_ty</span></a><span> </span><span class="hs-comment">-- it would be wrong to unify x</span><span>
</span><a name="line-852"></a><span>             </span><a name="local-6989586621683964252"><a href="#local-6989586621683964252"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Check.html#mkOneConFull"><span class="hs-identifier hs-var">mkOneConFull</span></a><span> </span><a href="#local-6989586621683964251"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">RealDataCon</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621683964248"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-853"></a><span>             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Right</span><span>
</span><a name="line-854"></a><span>               </span><span class="hs-special">(</span><a href="#local-6989586621683964248"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683964253"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">{</span><span class="hs-identifier">ic_val_abs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964241"><span class="hs-identifier hs-var">build_tm</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_val_abs</span><span> </span><a href="#local-6989586621683964253"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964247"><span class="hs-identifier hs-var">dcs</span></a><span class="hs-special">}</span><span>
</span><a name="line-855"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621683964253"><a href="#local-6989586621683964253"><span class="hs-identifier">alt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964252"><span class="hs-identifier hs-var">alts</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>      </span><span class="hs-comment">-- For other types conservatively assume that they are inhabited.</span><span>
</span><a name="line-857"></a><span>      </span><a name="local-6989586621683964254"><a href="#local-6989586621683964254"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621683964245"><span class="hs-identifier hs-var">src_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-858"></a><span>
</span><a name="line-859"></a><span class="hs-comment">{- Note [Checking EmptyCase Expressions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Empty case expressions are strict on the scrutinee. That is, `case x of {}`
will force argument `x`. Hence, `checkMatches` is not sufficient for checking
empty cases, because it assumes that the match is not strict (which is true
for all other cases, apart from EmptyCase). This gave rise to #10746. Instead,
we do the following:

1. We normalise the outermost type family redex, data family redex or newtype,
   using pmTopNormaliseType_maybe (in types/FamInstEnv.hs). This computes 3
   things:
   (a) A normalised type src_ty, which is equal to the type of the scrutinee in
       source Haskell (does not normalise newtypes or data families)
   (b) The actual normalised type core_ty, which coincides with the result
       topNormaliseType_maybe. This type is not necessarily equal to the input
       type in source Haskell. And this is precicely the reason we compute (a)
       and (c): the reasoning happens with the underlying types, but both the
       patterns and types we print should respect newtypes and also show the
       family type constructors and not the representation constructors.

   (c) A list of all newtype data constructors dcs, each one corresponding to a
       newtype rewrite performed in (b).

   For an example see also Note [Type normalisation for EmptyCase]
   in types/FamInstEnv.hs.

2. Function checkEmptyCase' performs the check:
   - If core_ty is not an algebraic type, then we cannot check for
     inhabitation, so we emit (_ :: src_ty) as missing, conservatively assuming
     that the type is inhabited.
   - If core_ty is an algebraic type, then we unfold the scrutinee to all
     possible constructor patterns, using inhabitationCandidates, and then
     check each one for constraint satisfiability, same as we for normal
     pattern match checking.

%************************************************************************
%*                                                                      *
              Transform source syntax to *our* syntax
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-900"></a><span>
</span><a name="line-901"></a><span class="hs-comment">-- -----------------------------------------------------------------------</span><span>
</span><a name="line-902"></a><span class="hs-comment">-- * Utilities</span><span>
</span><a name="line-903"></a><span>
</span><a name="line-904"></a><span class="hs-identifier">nullaryConPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConLike</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span>
</span><a name="line-905"></a><span class="hs-comment">-- Nullary data constructor and nullary type constructor</span><span>
</span><a name="line-906"></a><a name="nullaryConPattern"><a href="Check.html#nullaryConPattern"><span class="hs-identifier">nullaryConPattern</span></a></a><span> </span><a name="local-6989586621683964260"><a href="#local-6989586621683964260"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-907"></a><span>  </span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964260"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-908"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-909"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">nullaryConPattern</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-910"></a><span>
</span><a name="line-911"></a><span class="hs-identifier">truePattern</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span>
</span><a name="line-912"></a><a name="truePattern"><a href="Check.html#truePattern"><span class="hs-identifier">truePattern</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#nullaryConPattern"><span class="hs-identifier hs-var">nullaryConPattern</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><span class="hs-identifier hs-var">trueDataCon</span><span class="hs-special">)</span><span>
</span><a name="line-913"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">truePattern</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-914"></a><span>
</span><a name="line-915"></a><span class="hs-comment">-- | A fake guard pattern (True &lt;- _) used to represent cases we cannot handle</span><span>
</span><a name="line-916"></a><span class="hs-identifier">fake_pat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span>
</span><a name="line-917"></a><a name="fake_pat"><a href="Check.html#fake_pat"><span class="hs-identifier">fake_pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_grd_pv</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#truePattern"><span class="hs-identifier hs-var">truePattern</span></a><span class="hs-special">]</span><span>
</span><a name="line-918"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_grd_expr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PmExprOther</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EWildPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-919"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">fake_pat</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-920"></a><span>
</span><a name="line-921"></a><span class="hs-comment">-- | Check whether a guard pattern is generated by the checker (unhandled)</span><span>
</span><a name="line-922"></a><span class="hs-identifier">isFakeGuard</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PmExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-923"></a><a name="isFakeGuard"><a href="Check.html#isFakeGuard"><span class="hs-identifier">isFakeGuard</span></a></a><span> </span><span class="hs-special">[</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><a name="local-6989586621683964261"><a href="#local-6989586621683964261"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PmExprOther</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EWildPat</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-924"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964261"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">trueDataCon</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-925"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-926"></a><span class="hs-identifier">isFakeGuard</span><span> </span><a name="local-6989586621683964262"><a href="#local-6989586621683964262"><span class="hs-identifier">_pats</span></a></a><span> </span><a name="local-6989586621683964263"><a href="#local-6989586621683964263"><span class="hs-identifier">_e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-927"></a><span>
</span><a name="line-928"></a><span class="hs-comment">-- | Generate a `canFail` pattern vector of a specific type</span><span>
</span><a name="line-929"></a><span class="hs-identifier">mkCanFailPmPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-930"></a><a name="mkCanFailPmPat"><a href="Check.html#mkCanFailPmPat"><span class="hs-identifier">mkCanFailPmPat</span></a></a><span> </span><a name="local-6989586621683964264"><a href="#local-6989586621683964264"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-931"></a><span>  </span><a name="local-6989586621683964265"><a href="#local-6989586621683964265"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#mkPmVar"><span class="hs-identifier hs-var">mkPmVar</span></a><span> </span><a href="#local-6989586621683964264"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-932"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964265"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="Check.html#fake_pat"><span class="hs-identifier hs-var">fake_pat</span></a><span class="hs-special">]</span><span>
</span><a name="line-933"></a><span>
</span><a name="line-934"></a><span class="hs-identifier">vanillaConPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConLike</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span>
</span><a name="line-935"></a><span class="hs-comment">-- ADT constructor pattern =&gt; no existentials, no local constraints</span><span>
</span><a name="line-936"></a><a name="vanillaConPattern"><a href="Check.html#vanillaConPattern"><span class="hs-identifier">vanillaConPattern</span></a></a><span> </span><a name="local-6989586621683964266"><a href="#local-6989586621683964266"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621683964267"><a href="#local-6989586621683964267"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-6989586621683964268"><a href="#local-6989586621683964268"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-937"></a><span>  </span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964266"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964267"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-938"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964268"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-939"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">vanillaConPattern</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-940"></a><span>
</span><a name="line-941"></a><span class="hs-comment">-- | Create an empty list pattern of a given type</span><span>
</span><a name="line-942"></a><span class="hs-identifier">nilPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span>
</span><a name="line-943"></a><a name="nilPattern"><a href="Check.html#nilPattern"><span class="hs-identifier">nilPattern</span></a></a><span> </span><a name="local-6989586621683964269"><a href="#local-6989586621683964269"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-944"></a><span>  </span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><span class="hs-identifier hs-var">nilDataCon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964269"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-945"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-946"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-947"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">nilPattern</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-948"></a><span>
</span><a name="line-949"></a><span class="hs-identifier">mkListPatVec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-950"></a><a name="mkListPatVec"><a href="Check.html#mkListPatVec"><span class="hs-identifier">mkListPatVec</span></a></a><span> </span><a name="local-6989586621683964270"><a href="#local-6989586621683964270"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621683964271"><a href="#local-6989586621683964271"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621683964272"><a href="#local-6989586621683964272"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><span class="hs-identifier hs-var">consDataCon</span><span>
</span><a name="line-951"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964270"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-952"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-953"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964271"><span class="hs-identifier hs-var">xs</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621683964272"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-954"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mkListPatVec</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-955"></a><span>
</span><a name="line-956"></a><span class="hs-comment">-- | Create a (non-overloaded) literal pattern</span><span>
</span><a name="line-957"></a><span class="hs-identifier">mkLitPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span>
</span><a name="line-958"></a><a name="mkLitPattern"><a href="Check.html#mkLitPattern"><span class="hs-identifier">mkLitPattern</span></a></a><span> </span><a name="local-6989586621683964273"><a href="#local-6989586621683964273"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_lit</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PmSLit</span><span> </span><a href="#local-6989586621683964273"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-959"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mkLitPattern</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-960"></a><span>
</span><a name="line-961"></a><span class="hs-comment">-- -----------------------------------------------------------------------</span><span>
</span><a name="line-962"></a><span class="hs-comment">-- * Transform (Pat Id) into of (PmPat Id)</span><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span class="hs-identifier">translatePat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-965"></a><a name="translatePat"><a href="Check.html#translatePat"><span class="hs-identifier">translatePat</span></a></a><span> </span><a name="local-6989586621683964274"><a href="#local-6989586621683964274"><span class="hs-identifier">fam_insts</span></a></a><span> </span><a name="local-6989586621683964275"><a href="#local-6989586621683964275"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964275"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-966"></a><span>  </span><span class="hs-identifier hs-var">WildPat</span><span>  </span><a name="local-6989586621683964276"><a href="#local-6989586621683964276"><span class="hs-identifier">ty</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#mkPmVars"><span class="hs-identifier hs-var">mkPmVars</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964276"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-967"></a><span>  </span><span class="hs-identifier hs-var">VarPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964277"><a href="#local-6989586621683964277"><span class="hs-identifier">id</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964277"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-968"></a><span>  </span><span class="hs-identifier hs-var">ParPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964278"><a href="#local-6989586621683964278"><span class="hs-identifier">p</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964278"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-969"></a><span>  </span><span class="hs-identifier hs-var">LazyPat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#mkPmVars"><span class="hs-identifier hs-var">mkPmVars</span></a><span> </span><span class="hs-special">[</span><a href="TcHsSyn.html#hsPatType"><span class="hs-identifier hs-var">hsPatType</span></a><span> </span><a href="#local-6989586621683964275"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- like a variable</span><span>
</span><a name="line-970"></a><span>
</span><a name="line-971"></a><span>  </span><span class="hs-comment">-- ignore strictness annotations for now</span><span>
</span><a name="line-972"></a><span>  </span><span class="hs-identifier hs-var">BangPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964279"><a href="#local-6989586621683964279"><span class="hs-identifier">p</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964279"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-973"></a><span>
</span><a name="line-974"></a><span>  </span><span class="hs-identifier hs-var">AsPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964280"><a href="#local-6989586621683964280"><span class="hs-identifier">lid</span></a></a><span> </span><a name="local-6989586621683964281"><a href="#local-6989586621683964281"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-975"></a><span>     </span><span class="hs-comment">-- Note [Translating As Patterns]</span><span>
</span><a name="line-976"></a><span>    </span><a name="local-6989586621683964282"><a href="#local-6989586621683964282"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964281"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-6989586621683964283"><a href="#local-6989586621683964283"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#vaToPmExpr"><span class="hs-identifier hs-var">vaToPmExpr</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#coercePatVec"><span class="hs-identifier hs-var">coercePatVec</span></a><span> </span><a href="#local-6989586621683964282"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-978"></a><span>        </span><a name="local-6989586621683964284"><a href="#local-6989586621683964284"><span class="hs-identifier">g</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><span class="hs-special">[</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964280"><span class="hs-identifier hs-var">lid</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621683964283"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-979"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964282"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964284"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-980"></a><span>
</span><a name="line-981"></a><span>  </span><span class="hs-identifier hs-var">SigPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964285"><a href="#local-6989586621683964285"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621683964286"><a href="#local-6989586621683964286"><span class="hs-identifier">_ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964285"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-982"></a><span>
</span><a name="line-983"></a><span>  </span><span class="hs-comment">-- See Note [Translate CoPats]</span><span>
</span><a name="line-984"></a><span>  </span><span class="hs-identifier hs-var">CoPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964287"><a href="#local-6989586621683964287"><span class="hs-identifier">wrapper</span></a></a><span> </span><a name="local-6989586621683964288"><a href="#local-6989586621683964288"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621683964289"><a href="#local-6989586621683964289"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-985"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isIdHsWrapper</span><span> </span><a href="#local-6989586621683964287"><span class="hs-identifier hs-var">wrapper</span></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964288"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-986"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">WpCast</span><span> </span><a name="local-6989586621683964290"><a href="#local-6989586621683964290"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><a href="#local-6989586621683964287"><span class="hs-identifier hs-var">wrapper</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isReflexiveCo</span><span> </span><a href="#local-6989586621683964290"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964288"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-987"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-988"></a><span>        </span><a name="local-6989586621683964291"><a href="#local-6989586621683964291"><span class="hs-identifier">ps</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964288"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-989"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621683964292"><a href="#local-6989586621683964292"><span class="hs-identifier">xp</span></a></a><span class="hs-special">,</span><a name="local-6989586621683964293"><a href="#local-6989586621683964293"><span class="hs-identifier">xe</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#mkPmId2Forms"><span class="hs-identifier hs-var">mkPmId2Forms</span></a><span> </span><a href="#local-6989586621683964289"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-990"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964294"><a href="#local-6989586621683964294"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#mkGuard"><span class="hs-identifier hs-var">mkGuard</span></a><span> </span><a href="#local-6989586621683964291"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkHsWrap</span><span> </span><a href="#local-6989586621683964287"><span class="hs-identifier hs-var">wrapper</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964293"><span class="hs-identifier hs-var">xe</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-991"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964292"><span class="hs-identifier hs-var">xp</span></a><span class="hs-special">,</span><a href="#local-6989586621683964294"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">]</span><span>
</span><a name="line-992"></a><span>
</span><a name="line-993"></a><span>  </span><span class="hs-comment">-- (n + k)  ===&gt;   x (True &lt;- x &gt;= k) (n &lt;- x-k)</span><span>
</span><a name="line-994"></a><span>  </span><span class="hs-identifier hs-var">NPlusKPat</span><span> </span><a name="local-6989586621683964295"><a href="#local-6989586621683964295"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964296"><a href="#local-6989586621683964296"><span class="hs-identifier">_n</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964297"><a href="#local-6989586621683964297"><span class="hs-identifier">_k1</span></a></a><span> </span><a name="local-6989586621683964298"><a href="#local-6989586621683964298"><span class="hs-identifier">_k2</span></a></a><span> </span><a name="local-6989586621683964299"><a href="#local-6989586621683964299"><span class="hs-identifier">_ge</span></a></a><span> </span><a name="local-6989586621683964300"><a href="#local-6989586621683964300"><span class="hs-identifier">_minus</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#mkCanFailPmPat"><span class="hs-identifier hs-var">mkCanFailPmPat</span></a><span> </span><a href="#local-6989586621683964295"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span>  </span><span class="hs-comment">-- (fun -&gt; pat)   ===&gt;   x (pat &lt;- fun x)</span><span>
</span><a name="line-997"></a><span>  </span><span class="hs-identifier hs-var">ViewPat</span><span> </span><a name="local-6989586621683964301"><a href="#local-6989586621683964301"><span class="hs-identifier">arg_ty</span></a></a><span> </span><a name="local-6989586621683964302"><a href="#local-6989586621683964302"><span class="hs-identifier">lexpr</span></a></a><span> </span><a name="local-6989586621683964303"><a href="#local-6989586621683964303"><span class="hs-identifier">lpat</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-998"></a><span>    </span><a name="local-6989586621683964304"><a href="#local-6989586621683964304"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964303"><span class="hs-identifier hs-var">lpat</span></a><span class="hs-special">)</span><span>
</span><a name="line-999"></a><span>    </span><span class="hs-comment">-- See Note [Guards and Approximation]</span><span>
</span><a name="line-1000"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="Check.html#cantFailPattern"><span class="hs-identifier hs-var">cantFailPattern</span></a><span> </span><a href="#local-6989586621683964304"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1001"></a><span>      </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1002"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621683964305"><a href="#local-6989586621683964305"><span class="hs-identifier">xp</span></a></a><span class="hs-special">,</span><a name="local-6989586621683964306"><a href="#local-6989586621683964306"><span class="hs-identifier">xe</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#mkPmId2Forms"><span class="hs-identifier hs-var">mkPmId2Forms</span></a><span> </span><a href="#local-6989586621683964301"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1003"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964307"><a href="#local-6989586621683964307"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#mkGuard"><span class="hs-identifier hs-var">mkGuard</span></a><span> </span><a href="#local-6989586621683964304"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsApp</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621683964302"><span class="hs-identifier hs-var">lexpr</span></a><span> </span><a href="#local-6989586621683964306"><span class="hs-identifier hs-var">xe</span></a><span class="hs-special">)</span><span>
</span><a name="line-1004"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964305"><span class="hs-identifier hs-var">xp</span></a><span class="hs-special">,</span><a href="#local-6989586621683964307"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">]</span><span>
</span><a name="line-1005"></a><span>      </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#mkCanFailPmPat"><span class="hs-identifier hs-var">mkCanFailPmPat</span></a><span> </span><a href="#local-6989586621683964301"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1006"></a><span>
</span><a name="line-1007"></a><span>  </span><span class="hs-comment">-- list</span><span>
</span><a name="line-1008"></a><span>  </span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><a name="local-6989586621683964308"><a href="#local-6989586621683964308"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964309"><a href="#local-6989586621683964309"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1009"></a><span>    </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="Check.html#mkListPatVec"><span class="hs-identifier hs-var">mkListPatVec</span></a><span> </span><a href="#local-6989586621683964308"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Check.html#nilPattern"><span class="hs-identifier hs-var">nilPattern</span></a><span> </span><a href="#local-6989586621683964308"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-1010"></a><span>      </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#translatePatVec"><span class="hs-identifier hs-var">translatePatVec</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964309"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1011"></a><span>
</span><a name="line-1012"></a><span>  </span><span class="hs-comment">-- overloaded list</span><span>
</span><a name="line-1013"></a><span>  </span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><a name="local-6989586621683964310"><a href="#local-6989586621683964310"><span class="hs-identifier">_elem_ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964311"><a href="#local-6989586621683964311"><span class="hs-identifier">pat_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964312"><a href="#local-6989586621683964312"><span class="hs-identifier">_to_list</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964313"><a href="#local-6989586621683964313"><span class="hs-identifier">lpats</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1014"></a><span>    </span><a name="local-6989586621683964314"><a href="#local-6989586621683964314"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1015"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">xopt</span><span> </span><span class="hs-identifier hs-var">LangExt.RebindableSyntax</span><span> </span><a href="#local-6989586621683964314"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1016"></a><span>       </span><span class="hs-keyword">then</span><span> </span><a href="Check.html#mkCanFailPmPat"><span class="hs-identifier hs-var">mkCanFailPmPat</span></a><span> </span><a href="#local-6989586621683964311"><span class="hs-identifier hs-var">pat_ty</span></a><span>
</span><a name="line-1017"></a><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">splitListTyConApp_maybe</span><span> </span><a href="#local-6989586621683964311"><span class="hs-identifier hs-var">pat_ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1018"></a><span>              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964315"><a href="#local-6989586621683964315"><span class="hs-identifier">e_ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span>
</span><a name="line-1019"></a><span>                                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><a href="#local-6989586621683964315"><span class="hs-identifier hs-var">e_ty</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964313"><span class="hs-identifier hs-var">lpats</span></a><span class="hs-special">)</span><span>
</span><a name="line-1020"></a><span>              </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#mkCanFailPmPat"><span class="hs-identifier hs-var">mkCanFailPmPat</span></a><span> </span><a href="#local-6989586621683964311"><span class="hs-identifier hs-var">pat_ty</span></a><span>
</span><a name="line-1021"></a><span>    </span><span class="hs-comment">-- (a) In the presence of RebindableSyntax, we don't know anything about</span><span>
</span><a name="line-1022"></a><span>    </span><span class="hs-comment">--     `toList`, we should treat `ListPat` as any other view pattern.</span><span>
</span><a name="line-1023"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1024"></a><span>    </span><span class="hs-comment">-- (b) In the absence of RebindableSyntax,</span><span>
</span><a name="line-1025"></a><span>    </span><span class="hs-comment">--     - If the pat_ty is `[a]`, then we treat the overloaded list pattern</span><span>
</span><a name="line-1026"></a><span>    </span><span class="hs-comment">--       as ordinary list pattern. Although we can give an instance</span><span>
</span><a name="line-1027"></a><span>    </span><span class="hs-comment">--       `IsList [Int]` (more specific than the default `IsList [a]`), in</span><span>
</span><a name="line-1028"></a><span>    </span><span class="hs-comment">--       practice, we almost never do that. We assume the `_to_list` is</span><span>
</span><a name="line-1029"></a><span>    </span><span class="hs-comment">--       the `toList` from `instance IsList [a]`.</span><span>
</span><a name="line-1030"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1031"></a><span>    </span><span class="hs-comment">--     - Otherwise, we treat the `ListPat` as ordinary view pattern.</span><span>
</span><a name="line-1032"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1033"></a><span>    </span><span class="hs-comment">-- See Trac #14547, especially comment#9 and comment#10.</span><span>
</span><a name="line-1034"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1035"></a><span>    </span><span class="hs-comment">-- Here we construct CanFailPmPat directly, rather can construct a view</span><span>
</span><a name="line-1036"></a><span>    </span><span class="hs-comment">-- pattern and do further translation as an optimization, for the reason,</span><span>
</span><a name="line-1037"></a><span>    </span><span class="hs-comment">-- see Note [Guards and Approximation].</span><span>
</span><a name="line-1038"></a><span>
</span><a name="line-1039"></a><span>  </span><span class="hs-identifier hs-var">ConPatOut</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_con</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964316"><a href="#local-6989586621683964316"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1040"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964317"><a href="#local-6989586621683964317"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-1041"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_tvs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964318"><a href="#local-6989586621683964318"><span class="hs-identifier">ex_tvs</span></a></a><span>
</span><a name="line-1042"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_dicts</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964319"><a href="#local-6989586621683964319"><span class="hs-identifier">dicts</span></a></a><span>
</span><a name="line-1043"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_args</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964320"><a href="#local-6989586621683964320"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1044"></a><span>    </span><a name="local-6989586621683964321"><a href="#local-6989586621683964321"><span class="hs-identifier">groups</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#allCompleteMatches"><span class="hs-identifier hs-var">allCompleteMatches</span></a><span> </span><a href="#local-6989586621683964316"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621683964317"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1045"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964321"><span class="hs-identifier hs-var">groups</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1046"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#mkCanFailPmPat"><span class="hs-identifier hs-var">mkCanFailPmPat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">conLikeResTy</span><span> </span><a href="#local-6989586621683964316"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621683964317"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1047"></a><span>      </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1048"></a><span>        </span><a name="local-6989586621683964322"><a href="#local-6989586621683964322"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#translateConPatVec"><span class="hs-identifier hs-var">translateConPatVec</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964317"><span class="hs-identifier hs-var">arg_tys</span></a><span> </span><a href="#local-6989586621683964318"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><a href="#local-6989586621683964316"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621683964320"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1049"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964316"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-1050"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964317"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1051"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964318"><span class="hs-identifier hs-var">ex_tvs</span></a><span>
</span><a name="line-1052"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964319"><span class="hs-identifier hs-var">dicts</span></a><span>
</span><a name="line-1053"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964322"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1054"></a><span>
</span><a name="line-1055"></a><span>  </span><span class="hs-comment">-- See Note [Translate Overloaded Literal for Exhaustiveness Checking]</span><span>
</span><a name="line-1056"></a><span>  </span><span class="hs-identifier hs-var">NPat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964323"><a href="#local-6989586621683964323"><span class="hs-identifier">olit</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964324"><a href="#local-6989586621683964324"><span class="hs-identifier">mb_neg</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1057"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">OverLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OverLitTc</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621683964325"><a href="#local-6989586621683964325"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIsString</span><span> </span><a name="local-6989586621683964326"><a href="#local-6989586621683964326"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621683964327"><a href="#local-6989586621683964327"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964323"><span class="hs-identifier hs-var">olit</span></a><span>
</span><a name="line-1058"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isStringTy</span><span> </span><a href="#local-6989586621683964325"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1059"></a><span>        </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="Check.html#mkListPatVec"><span class="hs-identifier hs-var">mkListPatVec</span></a><span> </span><span class="hs-identifier hs-var">charTy</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Check.html#nilPattern"><span class="hs-identifier hs-var">nilPattern</span></a><span> </span><span class="hs-identifier hs-var">charTy</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1060"></a><span>          </span><a href="Check.html#translatePatVec"><span class="hs-identifier hs-var">translatePatVec</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span>
</span><a name="line-1061"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">HsChar</span><span> </span><a href="#local-6989586621683964326"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unpackFS</span><span> </span><a href="#local-6989586621683964327"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1062"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_lit</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PmOLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJust</span><span> </span><a href="#local-6989586621683964324"><span class="hs-identifier hs-var">mb_neg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964323"><span class="hs-identifier hs-var">olit</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1063"></a><span>
</span><a name="line-1064"></a><span>  </span><span class="hs-comment">-- See Note [Translate Overloaded Literal for Exhaustiveness Checking]</span><span>
</span><a name="line-1065"></a><span>  </span><span class="hs-identifier hs-var">LitPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964328"><a href="#local-6989586621683964328"><span class="hs-identifier">lit</span></a></a><span>
</span><a name="line-1066"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">HsString</span><span> </span><a name="local-6989586621683964329"><a href="#local-6989586621683964329"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621683964330"><a href="#local-6989586621683964330"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964328"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1067"></a><span>        </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="Check.html#mkListPatVec"><span class="hs-identifier hs-var">mkListPatVec</span></a><span> </span><span class="hs-identifier hs-var">charTy</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Check.html#nilPattern"><span class="hs-identifier hs-var">nilPattern</span></a><span> </span><span class="hs-identifier hs-var">charTy</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1068"></a><span>          </span><a href="Check.html#translatePatVec"><span class="hs-identifier hs-var">translatePatVec</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span>
</span><a name="line-1069"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">HsChar</span><span> </span><a href="#local-6989586621683964329"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unpackFS</span><span> </span><a href="#local-6989586621683964330"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1070"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#mkLitPattern"><span class="hs-identifier hs-var">mkLitPattern</span></a><span> </span><a href="#local-6989586621683964328"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">]</span><span>
</span><a name="line-1071"></a><span>
</span><a name="line-1072"></a><span>  </span><span class="hs-identifier hs-var">TuplePat</span><span> </span><a name="local-6989586621683964331"><a href="#local-6989586621683964331"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621683964332"><a href="#local-6989586621683964332"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964333"><a href="#local-6989586621683964333"><span class="hs-identifier">boxity</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1073"></a><span>    </span><a name="local-6989586621683964334"><a href="#local-6989586621683964334"><span class="hs-identifier">tidy_ps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#translatePatVec"><span class="hs-identifier hs-var">translatePatVec</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964332"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1074"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964335"><a href="#local-6989586621683964335"><span class="hs-identifier">tuple_con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleDataCon</span><span> </span><a href="#local-6989586621683964333"><span class="hs-identifier hs-var">boxity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621683964332"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1075"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#vanillaConPattern"><span class="hs-identifier hs-var">vanillaConPattern</span></a><span> </span><a href="#local-6989586621683964335"><span class="hs-identifier hs-var">tuple_con</span></a><span> </span><a href="#local-6989586621683964331"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621683964334"><span class="hs-identifier hs-var">tidy_ps</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1076"></a><span>
</span><a name="line-1077"></a><span>  </span><span class="hs-identifier hs-var">SumPat</span><span> </span><a name="local-6989586621683964336"><a href="#local-6989586621683964336"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621683964337"><a href="#local-6989586621683964337"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621683964338"><a href="#local-6989586621683964338"><span class="hs-identifier">alt</span></a></a><span> </span><a name="local-6989586621683964339"><a href="#local-6989586621683964339"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1078"></a><span>    </span><a name="local-6989586621683964340"><a href="#local-6989586621683964340"><span class="hs-identifier">tidy_p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964274"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964337"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1079"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964341"><a href="#local-6989586621683964341"><span class="hs-identifier">sum_con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sumDataCon</span><span> </span><a href="#local-6989586621683964338"><span class="hs-identifier hs-var">alt</span></a><span> </span><a href="#local-6989586621683964339"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span>
</span><a name="line-1080"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#vanillaConPattern"><span class="hs-identifier hs-var">vanillaConPattern</span></a><span> </span><a href="#local-6989586621683964341"><span class="hs-identifier hs-var">sum_con</span></a><span> </span><a href="#local-6989586621683964336"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621683964340"><span class="hs-identifier hs-var">tidy_p</span></a><span class="hs-special">]</span><span>
</span><a name="line-1081"></a><span>
</span><a name="line-1082"></a><span>  </span><span class="hs-comment">-- --------------------------------------------------------------------------</span><span>
</span><a name="line-1083"></a><span>  </span><span class="hs-comment">-- Not supposed to happen</span><span>
</span><a name="line-1084"></a><span>  </span><span class="hs-identifier hs-var">ConPatIn</span><span>  </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;Check.translatePat: ConPatIn&quot;</span><span>
</span><a name="line-1085"></a><span>  </span><span class="hs-identifier hs-var">SplicePat</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;Check.translatePat: SplicePat&quot;</span><span>
</span><a name="line-1086"></a><span>  </span><span class="hs-identifier hs-var">XPat</span><span>      </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;Check.translatePat: XPat&quot;</span><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span class="hs-comment">{- Note [Translate Overloaded Literal for Exhaustiveness Checking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The translation of @NPat@ in exhaustiveness checker is a bit different
from translation in pattern matcher.

  * In pattern matcher (see `tidyNPat' in deSugar/MatchLit.hs), we
    translate integral literals to HsIntPrim or HsWordPrim and translate
    overloaded strings to HsString.

  * In exhaustiveness checker, in `genCaseTmCs1/genCaseTmCs2`, we use
    `lhsExprToPmExpr` to generate uncovered set. In `hsExprToPmExpr`,
    however we generate `PmOLit` for HsOverLit, rather than refine
    `HsOverLit` inside `NPat` to HsIntPrim/HsWordPrim. If we do
    the same thing in `translatePat` as in `tidyNPat`, the exhaustiveness
    checker will fail to match the literals patterns correctly. See
    Trac #14546.

  In Note [Undecidable Equality for Overloaded Literals], we say: &quot;treat
  overloaded literals that look different as different&quot;, but previously we
  didn't do such things.

  Now, we translate the literal value to match and the literal patterns
  consistently:

  * For integral literals, we parse both the integral literal value and
    the patterns as OverLit HsIntegral. For example:

      case 0::Int of
          0 -&gt; putStrLn &quot;A&quot;
          1 -&gt; putStrLn &quot;B&quot;
          _ -&gt; putStrLn &quot;C&quot;

    When checking the exhaustiveness of pattern matching, we translate the 0
    in value position as PmOLit, but translate the 0 and 1 in pattern position
    as PmSLit. The inconsistency leads to the failure of eqPmLit to detect the
    equality and report warning of &quot;Pattern match is redundant&quot; on pattern 0,
    as reported in Trac #14546. In this patch we remove the specialization of
    OverLit patterns, and keep the overloaded number literal in pattern as it
    is to maintain the consistency. We know nothing about the `fromInteger`
    method (see Note [Undecidable Equality for Overloaded Literals]). Now we
    can capture the exhaustiveness of pattern 0 and the redundancy of pattern
    1 and _.

  * For string literals, we parse the string literals as HsString. When
    OverloadedStrings is enabled, it further be turned as HsOverLit HsIsString.
    For example:

      case &quot;foo&quot; of
          &quot;foo&quot; -&gt; putStrLn &quot;A&quot;
          &quot;bar&quot; -&gt; putStrLn &quot;B&quot;
          &quot;baz&quot; -&gt; putStrLn &quot;C&quot;

    Previously, the overloaded string values are translated to PmOLit and the
    non-overloaded string values are translated to PmSLit. However the string
    patterns, both overloaded and non-overloaded, are translated to list of
    characters. The inconsistency leads to wrong warnings about redundant and
    non-exhaustive pattern matching warnings, as reported in Trac #14546.

    In order to catch the redundant pattern in following case:

      case &quot;foo&quot; of
          ('f':_) -&gt; putStrLn &quot;A&quot;
          &quot;bar&quot; -&gt; putStrLn &quot;B&quot;

    in this patch, we translate non-overloaded string literals, both in value
    position and pattern position, as list of characters. For overloaded string
    literals, we only translate it to list of characters only when it's type
    is stringTy, since we know nothing about the toString methods. But we know
    that if two overloaded strings are syntax equal, then they are equal. Then
    if it's type is not stringTy, we just translate it to PmOLit. We can still
    capture the exhaustiveness of pattern &quot;foo&quot; and the redundancy of pattern
    &quot;bar&quot; and &quot;baz&quot; in the following code:

      {-# LANGUAGE OverloadedStrings #-}
      main = do
        case &quot;foo&quot; of
            &quot;foo&quot; -&gt; putStrLn &quot;A&quot;
            &quot;bar&quot; -&gt; putStrLn &quot;B&quot;
            &quot;baz&quot; -&gt; putStrLn &quot;C&quot;

  We must ensure that doing the same translation to literal values and patterns
  in `translatePat` and `hsExprToPmExpr`. The previous inconsistent work led to
  Trac #14546.
-}</span><span>
</span><a name="line-1172"></a><span>
</span><a name="line-1173"></a><span class="hs-comment">-- | Translate a list of patterns (Note: each pattern is translated</span><span>
</span><a name="line-1174"></a><span class="hs-comment">-- to a pattern vector but we do not concatenate the results).</span><span>
</span><a name="line-1175"></a><span class="hs-identifier">translatePatVec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">[</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">]</span><span>
</span><a name="line-1176"></a><a name="translatePatVec"><a href="Check.html#translatePatVec"><span class="hs-identifier">translatePatVec</span></a></a><span> </span><a name="local-6989586621683964342"><a href="#local-6989586621683964342"><span class="hs-identifier">fam_insts</span></a></a><span> </span><a name="local-6989586621683964343"><a href="#local-6989586621683964343"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964342"><span class="hs-identifier hs-var">fam_insts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964343"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1177"></a><span>
</span><a name="line-1178"></a><span class="hs-comment">-- | Translate a constructor pattern</span><span>
</span><a name="line-1179"></a><span class="hs-identifier">translateConPatVec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span>
</span><a name="line-1180"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ConLike</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsConPatDetails</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-1181"></a><a name="translateConPatVec"><a href="Check.html#translateConPatVec"><span class="hs-identifier">translateConPatVec</span></a></a><span> </span><a name="local-6989586621683964344"><a href="#local-6989586621683964344"><span class="hs-identifier">fam_insts</span></a></a><span> </span><a name="local-6989586621683964345"><a href="#local-6989586621683964345"><span class="hs-identifier">_univ_tys</span></a></a><span> </span><a name="local-6989586621683964346"><a href="#local-6989586621683964346"><span class="hs-identifier">_ex_tvs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><a name="local-6989586621683964347"><a href="#local-6989586621683964347"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1182"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#translatePatVec"><span class="hs-identifier hs-var">translatePatVec</span></a><span> </span><a href="#local-6989586621683964344"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964347"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1183"></a><span class="hs-identifier">translateConPatVec</span><span> </span><a name="local-6989586621683964348"><a href="#local-6989586621683964348"><span class="hs-identifier">fam_insts</span></a></a><span> </span><a name="local-6989586621683964349"><a href="#local-6989586621683964349"><span class="hs-identifier">_univ_tys</span></a></a><span> </span><a name="local-6989586621683964350"><a href="#local-6989586621683964350"><span class="hs-identifier">_ex_tvs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a name="local-6989586621683964351"><a href="#local-6989586621683964351"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621683964352"><a href="#local-6989586621683964352"><span class="hs-identifier">p2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1184"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#translatePatVec"><span class="hs-identifier hs-var">translatePatVec</span></a><span> </span><a href="#local-6989586621683964348"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964351"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><a href="#local-6989586621683964352"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1185"></a><span class="hs-identifier">translateConPatVec</span><span> </span><a name="local-6989586621683964353"><a href="#local-6989586621683964353"><span class="hs-identifier">fam_insts</span></a></a><span>  </span><a name="local-6989586621683964354"><a href="#local-6989586621683964354"><span class="hs-identifier">univ_tys</span></a></a><span>  </span><a name="local-6989586621683964355"><a href="#local-6989586621683964355"><span class="hs-identifier">ex_tvs</span></a></a><span> </span><a name="local-6989586621683964356"><a href="#local-6989586621683964356"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><a name="local-6989586621683964357"><a href="#local-6989586621683964357"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1186"></a><span>    </span><span class="hs-comment">-- Nothing matched. Make up some fresh term variables</span><span>
</span><a name="line-1187"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964357"><span class="hs-identifier hs-var">fs</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#mkPmVars"><span class="hs-identifier hs-var">mkPmVars</span></a><span> </span><a href="#local-6989586621683964358"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1188"></a><span>    </span><span class="hs-comment">-- The data constructor was not defined using record syntax. For the</span><span>
</span><a name="line-1189"></a><span>    </span><span class="hs-comment">-- pattern to be in record syntax it should be empty (e.g. Just {}).</span><span>
</span><a name="line-1190"></a><span>    </span><span class="hs-comment">-- So just like the previous case.</span><span>
</span><a name="line-1191"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964359"><span class="hs-identifier hs-var">orig_lbls</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-identifier">matched_lbls</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964361"><span class="hs-identifier hs-var">mkPmVars</span></a><span> </span><span class="hs-identifier">arg_tys</span><span>
</span><a name="line-1192"></a><span>    </span><span class="hs-comment">-- Some of the fields appear, in the original order (there may be holes).</span><span>
</span><a name="line-1193"></a><span>    </span><span class="hs-comment">-- Generate a simple constructor pattern and make up fresh variables for</span><span>
</span><a name="line-1194"></a><span>    </span><span class="hs-comment">-- the rest of the fields</span><span>
</span><a name="line-1195"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964361"><span class="hs-identifier hs-var">matched_lbls</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621683964362"><span class="hs-identifier hs-var">subsetOf</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964359"><span class="hs-identifier hs-var">orig_lbls</span></a><span>
</span><a name="line-1196"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">orig_lbls</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">arg_tys</span><span class="hs-special">)</span><span>
</span><a name="line-1197"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964371"><a href="#local-6989586621683964371"><span class="hs-identifier">translateOne</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964372"><a href="#local-6989586621683964372"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964373"><a href="#local-6989586621683964373"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621683964372"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621683964360"><span class="hs-identifier hs-var">matched_pats</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1198"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964374"><a href="#local-6989586621683964374"><span class="hs-identifier">p</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964353"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964374"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1199"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#mkPmVars"><span class="hs-identifier hs-var">mkPmVars</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964373"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-1200"></a><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">concatMapM</span><span> </span><a href="#local-6989586621683964371"><span class="hs-identifier hs-var">translateOne</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621683964359"><span class="hs-identifier hs-var">orig_lbls</span></a><span> </span><a href="#local-6989586621683964358"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1201"></a><span>    </span><span class="hs-comment">-- The fields that appear are not in the correct order. Make up fresh</span><span>
</span><a name="line-1202"></a><span>    </span><span class="hs-comment">-- variables for all fields and add guards after matching, to force the</span><span>
</span><a name="line-1203"></a><span>    </span><span class="hs-comment">-- evaluation in the correct order.</span><span>
</span><a name="line-1204"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1205"></a><span>      </span><a name="local-6989586621683964375"><a href="#local-6989586621683964375"><span class="hs-identifier">arg_var_pats</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#mkPmVars"><span class="hs-identifier hs-var">mkPmVars</span></a><span> </span><a href="#local-6989586621683964358"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1206"></a><span>      </span><a name="local-6989586621683964379"><a href="#local-6989586621683964379"><span class="hs-identifier">translated_pats</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forM</span><span> </span><a href="#local-6989586621683964360"><span class="hs-identifier hs-var">matched_pats</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621683964376"><a href="#local-6989586621683964376"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621683964377"><a href="#local-6989586621683964377"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1207"></a><span>        </span><a name="local-6989586621683964378"><a href="#local-6989586621683964378"><span class="hs-identifier">pvec</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964353"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964377"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1208"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964376"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964378"><span class="hs-identifier hs-var">pvec</span></a><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><span>
</span><a name="line-1210"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964380"><a href="#local-6989586621683964380"><span class="hs-identifier">zipped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621683964359"><span class="hs-identifier hs-var">orig_lbls</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683964382"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a name="local-6989586621683964382"><a href="#local-6989586621683964382"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964375"><span class="hs-identifier hs-var">arg_var_pats</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1211"></a><span>          </span><a name="local-6989586621683964381"><a href="#local-6989586621683964381"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621683964383"><a href="#local-6989586621683964383"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><a name="local-6989586621683964384"><a href="#local-6989586621683964384"><span class="hs-identifier">pvec</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621683964383"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621683964380"><span class="hs-identifier hs-var">zipped</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1212"></a><span>                            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964385"><a href="#local-6989586621683964385"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><a href="#local-6989586621683964384"><span class="hs-identifier hs-var">pvec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964385"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span>                            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateConPatVec: lookup&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1214"></a><span>                       </span><a href="#local-6989586621683964379"><span class="hs-identifier hs-var">translated_pats</span></a><span>
</span><a name="line-1215"></a><span>
</span><a name="line-1216"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964375"><span class="hs-identifier hs-var">arg_var_pats</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683964381"><span class="hs-identifier hs-var">guards</span></a><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1218"></a><span>    </span><span class="hs-comment">-- The actual argument types (instantiated)</span><span>
</span><a name="line-1219"></a><span>    </span><a name="local-6989586621683964358"><a href="#local-6989586621683964358"><span class="hs-identifier">arg_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">conLikeInstOrigArgTys</span><span> </span><a href="#local-6989586621683964356"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964354"><span class="hs-identifier hs-var">univ_tys</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">mkTyVarTys</span><span> </span><a href="#local-6989586621683964355"><span class="hs-identifier hs-var">ex_tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1220"></a><span>
</span><a name="line-1221"></a><span>    </span><span class="hs-comment">-- Some label information</span><span>
</span><a name="line-1222"></a><span>    </span><a name="local-6989586621683964359"><a href="#local-6989586621683964359"><span class="hs-identifier">orig_lbls</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">flSelector</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">conLikeFieldLabels</span><span> </span><a href="#local-6989586621683964356"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1223"></a><span>    </span><a name="local-6989586621683964360"><a href="#local-6989586621683964360"><span class="hs-identifier">matched_pats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsRecFieldId</span><span> </span><a href="#local-6989586621683964364"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsRecFieldArg</span><span> </span><a href="#local-6989586621683964364"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1224"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964364"><a href="#local-6989586621683964364"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964357"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1225"></a><span>    </span><a name="local-6989586621683964361"><a href="#local-6989586621683964361"><span class="hs-identifier">matched_lbls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683964365"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964365"><a href="#local-6989586621683964365"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964366"><a href="#local-6989586621683964366"><span class="hs-identifier">_pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964360"><span class="hs-identifier hs-var">matched_pats</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1226"></a><span>
</span><a name="line-1227"></a><span>    </span><span class="hs-identifier">subsetOf</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621683964363"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964363"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964363"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1228"></a><span>    </span><a name="local-6989586621683964362"><a href="#local-6989586621683964362"><span class="hs-identifier">subsetOf</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1229"></a><span>    </span><span class="hs-identifier">subsetOf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1230"></a><span>    </span><span class="hs-identifier">subsetOf</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964367"><a href="#local-6989586621683964367"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683964368"><a href="#local-6989586621683964368"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964369"><a href="#local-6989586621683964369"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683964370"><a href="#local-6989586621683964370"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1231"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964367"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621683964369"><span class="hs-identifier hs-var">y</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964362"><span class="hs-identifier hs-var">subsetOf</span></a><span>    </span><a href="#local-6989586621683964368"><span class="hs-identifier hs-var">xs</span></a><span>  </span><a href="#local-6989586621683964370"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-1232"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964362"><span class="hs-identifier hs-var">subsetOf</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964367"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964368"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964370"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-1233"></a><span>
</span><a name="line-1234"></a><span class="hs-comment">-- Translate a single match</span><span>
</span><a name="line-1235"></a><span class="hs-identifier">translateMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1236"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">,</span><span class="hs-special">[</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1237"></a><a name="translateMatch"><a href="Check.html#translateMatch"><span class="hs-identifier">translateMatch</span></a></a><span> </span><a name="local-6989586621683964386"><a href="#local-6989586621683964386"><span class="hs-identifier">fam_insts</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964387"><a href="#local-6989586621683964387"><span class="hs-identifier">lpats</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964388"><a href="#local-6989586621683964388"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1238"></a><span>  </span><span class="hs-keyword">do</span><span>
</span><a name="line-1239"></a><span>  </span><a name="local-6989586621683964393"><a href="#local-6989586621683964393"><span class="hs-identifier">pats'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#translatePatVec"><span class="hs-identifier hs-var">translatePatVec</span></a><span> </span><a href="#local-6989586621683964386"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964390"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1240"></a><span>  </span><a name="local-6989586621683964394"><a href="#local-6989586621683964394"><span class="hs-identifier">guards'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Check.html#translateGuards"><span class="hs-identifier hs-var">translateGuards</span></a><span> </span><a href="#local-6989586621683964386"><span class="hs-identifier hs-var">fam_insts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964391"><span class="hs-identifier hs-var">guards</span></a><span>
</span><a name="line-1241"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964393"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964394"><span class="hs-identifier hs-var">guards'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1242"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1243"></a><span>    </span><span class="hs-identifier">extractGuards</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LGRHS</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">GuardStmt</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span>
</span><a name="line-1244"></a><span>    </span><a name="local-6989586621683964389"><a href="#local-6989586621683964389"><span class="hs-identifier">extractGuards</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHS</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964392"><a href="#local-6989586621683964392"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964392"><span class="hs-identifier hs-var">gs</span></a><span>
</span><a name="line-1245"></a><span>    </span><span class="hs-identifier">extractGuards</span><span> </span><span class="hs-identifier">_</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateMatch&quot;</span><span>
</span><a name="line-1246"></a><span>
</span><a name="line-1247"></a><span>    </span><a name="local-6989586621683964390"><a href="#local-6989586621683964390"><span class="hs-identifier">pats</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964387"><span class="hs-identifier hs-var">lpats</span></a><span>
</span><a name="line-1248"></a><span>    </span><a name="local-6989586621683964391"><a href="#local-6989586621683964391"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621683964389"><span class="hs-identifier hs-var">extractGuards</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">grhssGRHSs</span><span> </span><a href="#local-6989586621683964388"><span class="hs-identifier hs-var">grhss</span></a><span class="hs-special">)</span><span>
</span><a name="line-1249"></a><span class="hs-identifier">translateMatch</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateMatch&quot;</span><span>
</span><a name="line-1250"></a><span>
</span><a name="line-1251"></a><span class="hs-comment">-- -----------------------------------------------------------------------</span><span>
</span><a name="line-1252"></a><span class="hs-comment">-- * Transform source guards (GuardStmt Id) to PmPats (Pattern)</span><span>
</span><a name="line-1253"></a><span>
</span><a name="line-1254"></a><span class="hs-comment">-- | Translate a list of guard statements to a pattern vector</span><span>
</span><a name="line-1255"></a><span class="hs-identifier">translateGuards</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">GuardStmt</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-1256"></a><a name="translateGuards"><a href="Check.html#translateGuards"><span class="hs-identifier">translateGuards</span></a></a><span> </span><a name="local-6989586621683964395"><a href="#local-6989586621683964395"><span class="hs-identifier">fam_insts</span></a></a><span> </span><a name="local-6989586621683964396"><a href="#local-6989586621683964396"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1257"></a><span>  </span><a name="local-6989586621683964407"><a href="#local-6989586621683964407"><span class="hs-identifier">all_guards</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Check.html#translateGuard"><span class="hs-identifier hs-var">translateGuard</span></a><span> </span><a href="#local-6989586621683964395"><span class="hs-identifier hs-var">fam_insts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964396"><span class="hs-identifier hs-var">guards</span></a><span>
</span><a name="line-1258"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964397"><span class="hs-identifier hs-var">replace_unhandled</span></a><span> </span><a href="#local-6989586621683964407"><span class="hs-identifier hs-var">all_guards</span></a><span class="hs-special">)</span><span>
</span><a name="line-1259"></a><span>  </span><span class="hs-comment">-- It should have been (return all_guards) but it is too expressive.</span><span>
</span><a name="line-1260"></a><span>  </span><span class="hs-comment">-- Since the term oracle does not handle all constraints we generate,</span><span>
</span><a name="line-1261"></a><span>  </span><span class="hs-comment">-- we (hackily) replace all constraints the oracle cannot handle with a</span><span>
</span><a name="line-1262"></a><span>  </span><span class="hs-comment">-- single one (we need to know if there is a possibility of falure).</span><span>
</span><a name="line-1263"></a><span>  </span><span class="hs-comment">-- See Note [Guards and Approximation] for all guard-related approximations</span><span>
</span><a name="line-1264"></a><span>  </span><span class="hs-comment">-- we implement.</span><span>
</span><a name="line-1265"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1266"></a><span>    </span><span class="hs-identifier">replace_unhandled</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-1267"></a><span>    </span><a name="local-6989586621683964397"><a href="#local-6989586621683964397"><span class="hs-identifier">replace_unhandled</span></a></a><span> </span><a name="local-6989586621683964400"><a href="#local-6989586621683964400"><span class="hs-identifier">gv</span></a></a><span>
</span><a name="line-1268"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964398"><span class="hs-identifier hs-var">any_unhandled</span></a><span> </span><a href="#local-6989586621683964400"><span class="hs-identifier hs-var">gv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#fake_pat"><span class="hs-identifier hs-var">fake_pat</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621683964401"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621683964401"><a href="#local-6989586621683964401"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964400"><span class="hs-identifier hs-var">gv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964399"><span class="hs-identifier hs-var">shouldKeep</span></a><span> </span><a href="#local-6989586621683964401"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1269"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964400"><span class="hs-identifier hs-var">gv</span></a><span>
</span><a name="line-1270"></a><span>
</span><a name="line-1271"></a><span>    </span><span class="hs-identifier">any_unhandled</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1272"></a><span>    </span><a name="local-6989586621683964398"><a href="#local-6989586621683964398"><span class="hs-identifier">any_unhandled</span></a></a><span> </span><a name="local-6989586621683964402"><a href="#local-6989586621683964402"><span class="hs-identifier">gv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621683964399"><span class="hs-identifier hs-var">shouldKeep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964402"><span class="hs-identifier hs-var">gv</span></a><span>
</span><a name="line-1273"></a><span>
</span><a name="line-1274"></a><span>    </span><span class="hs-identifier">shouldKeep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1275"></a><span>    </span><a name="local-6989586621683964399"><a href="#local-6989586621683964399"><span class="hs-identifier">shouldKeep</span></a></a><span> </span><a name="local-6989586621683964403"><a href="#local-6989586621683964403"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-1276"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964403"><span class="hs-identifier hs-var">p</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1277"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964403"><span class="hs-identifier hs-var">p</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#singleConstructor"><span class="hs-identifier hs-var">singleConstructor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pm_con_con</span><span> </span><a href="#local-6989586621683964403"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1278"></a><span>                             </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="#local-6989586621683964399"><span class="hs-identifier hs-var">shouldKeep</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pm_con_args</span><span> </span><a href="#local-6989586621683964403"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1279"></a><span>    </span><span class="hs-identifier">shouldKeep</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><a name="local-6989586621683964404"><a href="#local-6989586621683964404"><span class="hs-identifier">pv</span></a></a><span> </span><a name="local-6989586621683964405"><a href="#local-6989586621683964405"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1280"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="#local-6989586621683964399"><span class="hs-identifier hs-var">shouldKeep</span></a><span> </span><a href="#local-6989586621683964404"><span class="hs-identifier hs-var">pv</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1281"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNotPmExprOther</span><span> </span><a href="#local-6989586621683964405"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-comment">-- expensive but we want it</span><span>
</span><a name="line-1282"></a><span>    </span><span class="hs-identifier">shouldKeep</span><span> </span><a name="local-6989586621683964406"><a href="#local-6989586621683964406"><span class="hs-identifier">_other_pat</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- let the rest..</span><span>
</span><a name="line-1283"></a><span>
</span><a name="line-1284"></a><span class="hs-comment">-- | Check whether a pattern can fail to match</span><span>
</span><a name="line-1285"></a><span class="hs-identifier">cantFailPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1286"></a><a name="cantFailPattern"><a href="Check.html#cantFailPattern"><span class="hs-identifier">cantFailPattern</span></a></a><span> </span><a name="local-6989586621683964408"><a href="#local-6989586621683964408"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-1287"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964408"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1288"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964408"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#singleConstructor"><span class="hs-identifier hs-var">singleConstructor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pm_con_con</span><span> </span><a href="#local-6989586621683964408"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1289"></a><span>                    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="Check.html#cantFailPattern"><span class="hs-identifier hs-var">cantFailPattern</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pm_con_args</span><span> </span><a href="#local-6989586621683964408"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1290"></a><span class="hs-identifier">cantFailPattern</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><a name="local-6989586621683964409"><a href="#local-6989586621683964409"><span class="hs-identifier">pv</span></a></a><span> </span><a name="local-6989586621683964410"><a href="#local-6989586621683964410"><span class="hs-identifier">_e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1291"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="Check.html#cantFailPattern"><span class="hs-identifier hs-var">cantFailPattern</span></a><span> </span><a href="#local-6989586621683964409"><span class="hs-identifier hs-var">pv</span></a><span>
</span><a name="line-1292"></a><span class="hs-identifier">cantFailPattern</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1293"></a><span>
</span><a name="line-1294"></a><span class="hs-comment">-- | Translate a guard statement to Pattern</span><span>
</span><a name="line-1295"></a><span class="hs-identifier">translateGuard</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GuardStmt</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-1296"></a><a name="translateGuard"><a href="Check.html#translateGuard"><span class="hs-identifier">translateGuard</span></a></a><span> </span><a name="local-6989586621683964411"><a href="#local-6989586621683964411"><span class="hs-identifier">fam_insts</span></a></a><span> </span><a name="local-6989586621683964412"><a href="#local-6989586621683964412"><span class="hs-identifier">guard</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964412"><span class="hs-identifier hs-var">guard</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1297"></a><span>  </span><span class="hs-identifier hs-var">BodyStmt</span><span> </span><span class="hs-identifier">_</span><span>   </span><a name="local-6989586621683964413"><a href="#local-6989586621683964413"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translateBoolGuard"><span class="hs-identifier hs-var">translateBoolGuard</span></a><span> </span><a href="#local-6989586621683964413"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1298"></a><span>  </span><span class="hs-identifier hs-var">LetStmt</span><span>  </span><span class="hs-identifier">_</span><span>   </span><a name="local-6989586621683964414"><a href="#local-6989586621683964414"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translateLet"><span class="hs-identifier hs-var">translateLet</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964414"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1299"></a><span>  </span><span class="hs-identifier hs-var">BindStmt</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964415"><a href="#local-6989586621683964415"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621683964416"><a href="#local-6989586621683964416"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#translateBind"><span class="hs-identifier hs-var">translateBind</span></a><span> </span><a href="#local-6989586621683964411"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964415"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621683964416"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1300"></a><span>  </span><span class="hs-identifier hs-var">LastStmt</span><span>        </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateGuard LastStmt&quot;</span><span>
</span><a name="line-1301"></a><span>  </span><span class="hs-identifier hs-var">ParStmt</span><span>         </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateGuard ParStmt&quot;</span><span>
</span><a name="line-1302"></a><span>  </span><span class="hs-identifier hs-var">TransStmt</span><span>       </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateGuard TransStmt&quot;</span><span>
</span><a name="line-1303"></a><span>  </span><span class="hs-identifier hs-var">RecStmt</span><span>         </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateGuard RecStmt&quot;</span><span>
</span><a name="line-1304"></a><span>  </span><span class="hs-identifier hs-var">ApplicativeStmt</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateGuard ApplicativeLastStmt&quot;</span><span>
</span><a name="line-1305"></a><span>  </span><span class="hs-identifier hs-var">XStmtLR</span><span>         </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;translateGuard RecStmt&quot;</span><span>
</span><a name="line-1306"></a><span>
</span><a name="line-1307"></a><span class="hs-comment">-- | Translate let-bindings</span><span>
</span><a name="line-1308"></a><span class="hs-identifier">translateLet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLocalBinds</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-1309"></a><a name="translateLet"><a href="Check.html#translateLet"><span class="hs-identifier">translateLet</span></a></a><span> </span><a name="local-6989586621683964417"><a href="#local-6989586621683964417"><span class="hs-identifier">_binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1310"></a><span>
</span><a name="line-1311"></a><span class="hs-comment">-- | Translate a pattern guard</span><span>
</span><a name="line-1312"></a><span class="hs-identifier">translateBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FamInstEnvs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-1313"></a><a name="translateBind"><a href="Check.html#translateBind"><span class="hs-identifier">translateBind</span></a></a><span> </span><a name="local-6989586621683964418"><a href="#local-6989586621683964418"><span class="hs-identifier">fam_insts</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964419"><a href="#local-6989586621683964419"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964420"><a href="#local-6989586621683964420"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1314"></a><span>  </span><a name="local-6989586621683964421"><a href="#local-6989586621683964421"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964418"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964419"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1315"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#mkGuard"><span class="hs-identifier hs-var">mkGuard</span></a><span> </span><a href="#local-6989586621683964421"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964420"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1316"></a><span>
</span><a name="line-1317"></a><span class="hs-comment">-- | Translate a boolean guard</span><span>
</span><a name="line-1318"></a><span class="hs-identifier">translateBoolGuard</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-1319"></a><a name="translateBoolGuard"><a href="Check.html#translateBoolGuard"><span class="hs-identifier">translateBoolGuard</span></a></a><span> </span><a name="local-6989586621683964422"><a href="#local-6989586621683964422"><span class="hs-identifier">e</span></a></a><span>
</span><a name="line-1320"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-special">(</span><a href="DsUtils.html#isTrueLHsExpr"><span class="hs-identifier hs-var">isTrueLHsExpr</span></a><span> </span><a href="#local-6989586621683964422"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1321"></a><span>    </span><span class="hs-comment">-- The formal thing to do would be to generate (True &lt;- True)</span><span>
</span><a name="line-1322"></a><span>    </span><span class="hs-comment">-- but it is trivial to solve so instead we give back an empty</span><span>
</span><a name="line-1323"></a><span>    </span><span class="hs-comment">-- PatVec for efficiency</span><span>
</span><a name="line-1324"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#mkGuard"><span class="hs-identifier hs-var">mkGuard</span></a><span> </span><span class="hs-special">[</span><a href="Check.html#truePattern"><span class="hs-identifier hs-var">truePattern</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964422"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1325"></a><span>
</span><a name="line-1326"></a><span class="hs-comment">{- Note [Guards and Approximation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Even if the algorithm is really expressive, the term oracle we use is not.
Hence, several features are not translated *properly* but we approximate.
The list includes:

1. View Patterns
----------------
A view pattern @(f -&gt; p)@ should be translated to @x (p &lt;- f x)@. The term
oracle does not handle function applications so we know that the generated
constraints will not be handled at the end. Hence, we distinguish between two
cases:
  a) Pattern @p@ cannot fail. Then this is just a binding and we do the *right
     thing*.
  b) Pattern @p@ can fail. This means that when checking the guard, we will
     generate several cases, with no useful information. E.g.:

       h (f -&gt; [a,b]) = ...
       h x ([a,b] &lt;- f x) = ...

       uncovered set = { [x |&gt; { False ~ (f x ~ [])            }]
                       , [x |&gt; { False ~ (f x ~ (t1:[]))       }]
                       , [x |&gt; { False ~ (f x ~ (t1:t2:t3:t4)) }] }

     So we have two problems:
       1) Since we do not print the constraints in the general case (they may
          be too many), the warning will look like this:

            Pattern match(es) are non-exhaustive
            In an equation for `h':
                Patterns not matched:
                    _
                    _
                    _
          Which is not short and not more useful than a single underscore.
       2) The size of the uncovered set increases a lot, without gaining more
          expressivity in our warnings.

     Hence, in this case, we replace the guard @([a,b] &lt;- f x)@ with a *dummy*
     @fake_pat@: @True &lt;- _@. That is, we record that there is a possibility
     of failure but we minimize it to a True/False. This generates a single
     warning and much smaller uncovered sets.

2. Overloaded Lists
-------------------
An overloaded list @[...]@ should be translated to @x ([...] &lt;- toList x)@. The
problem is exactly like above, as its solution. For future reference, the code
below is the *right thing to do*:

   ListPat (ListPatTc elem_ty (Just (pat_ty, _to_list))) lpats
     otherwise -&gt; do
       (xp, xe) &lt;- mkPmId2Forms pat_ty
       ps       &lt;- translatePatVec (map unLoc lpats)
       let pats = foldr (mkListPatVec elem_ty) [nilPattern elem_ty] ps
           g    = mkGuard pats (HsApp (noLoc to_list) xe)
       return [xp,g]

3. Overloaded Literals
----------------------
The case with literals is a bit different. a literal @l@ should be translated
to @x (True &lt;- x == from l)@. Since we want to have better warnings for
overloaded literals as it is a very common feature, we treat them differently.
They are mainly covered in Note [Undecidable Equality for Overloaded Literals]
in PmExpr.

4. N+K Patterns &amp; Pattern Synonyms
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
An n+k pattern (n+k) should be translated to @x (True &lt;- x &gt;= k) (n &lt;- x-k)@.
Since the only pattern of the three that causes failure is guard @(n &lt;- x-k)@,
and has two possible outcomes. Hence, there is no benefit in using a dummy and
we implement the proper thing. Pattern synonyms are simply not implemented yet.
Hence, to be conservative, we generate a dummy pattern, assuming that the
pattern can fail.

5. Actual Guards
----------------
During translation, boolean guards and pattern guards are translated properly.
Let bindings though are omitted by function @translateLet@. Since they are lazy
bindings, we do not actually want to generate a (strict) equality (like we do
in the pattern bind case). Hence, we safely drop them.

Additionally, top-level guard translation (performed by @translateGuards@)
replaces guards that cannot be reasoned about (like the ones we described in
1-4) with a single @fake_pat@ to record the possibility of failure to match.

Note [Translate CoPats]
~~~~~~~~~~~~~~~~~~~~~~~
The pattern match checker did not know how to handle coerced patterns `CoPat`
efficiently, which gave rise to #11276. The original approach translated
`CoPat`s:

    pat |&gt; co    ===&gt;    x (pat &lt;- (e |&gt; co))

Instead, we now check whether the coercion is a hole or if it is just refl, in
which case we can drop it. Unfortunately, data families generate useful
coercions so guards are still generated in these cases and checking data
families is not really efficient.

%************************************************************************
%*                                                                      *
                 Utilities for Pattern Match Checking
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1430"></a><span>
</span><a name="line-1431"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-1432"></a><span class="hs-comment">-- * Basic utilities</span><span>
</span><a name="line-1433"></a><span>
</span><a name="line-1434"></a><span class="hs-comment">-- | Get the type out of a PmPat. For guard patterns (ps &lt;- e) we use the type</span><span>
</span><a name="line-1435"></a><span class="hs-comment">-- of the first (or the single -WHEREVER IT IS- valid to use?) pattern</span><span>
</span><a name="line-1436"></a><span class="hs-identifier">pmPatType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><a href="#local-6989586621683964043"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-1437"></a><a name="pmPatType"><a href="Check.html#pmPatType"><span class="hs-identifier">pmPatType</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964423"><a href="#local-6989586621683964423"><span class="hs-identifier">con</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964424"><a href="#local-6989586621683964424"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1438"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">conLikeResTy</span><span> </span><a href="#local-6989586621683964423"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621683964424"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1439"></a><span class="hs-identifier">pmPatType</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_var_id</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964425"><a href="#local-6989586621683964425"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621683964425"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1440"></a><span class="hs-identifier">pmPatType</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_lit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964426"><a href="#local-6989586621683964426"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TmOracle.html#pmLitType"><span class="hs-identifier hs-var">pmLitType</span></a><span> </span><a href="#local-6989586621683964426"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1441"></a><span class="hs-identifier">pmPatType</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmNLit"><span class="hs-identifier hs-var">PmNLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_id</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964427"><a href="#local-6989586621683964427"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621683964427"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1442"></a><span class="hs-identifier">pmPatType</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_grd_pv</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964428"><a href="#local-6989586621683964428"><span class="hs-identifier">pv</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1443"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">patVecArity</span><span> </span><span class="hs-identifier">pv</span><span> </span><a href="Check.html#patVecArity"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pmPatType</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-1444"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964429"><a href="#local-6989586621683964429"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Check.html#patternArity"><span class="hs-identifier hs-var">patternArity</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964428"><span class="hs-identifier hs-var">pv</span></a><span>
</span><a name="line-1445"></a><span>
</span><a name="line-1446"></a><span class="hs-comment">-- | Information about a conlike that is relevant to coverage checking.</span><span>
</span><a name="line-1447"></a><span class="hs-comment">-- It is called an \&quot;inhabitation candidate\&quot; since it is a value which may</span><span>
</span><a name="line-1448"></a><span class="hs-comment">-- possibly inhabit some type, but only if its term constraint ('ic_tm_ct')</span><span>
</span><a name="line-1449"></a><span class="hs-comment">-- and type constraints ('ic_ty_cs') are permitting, and if all of its strict</span><span>
</span><a name="line-1450"></a><span class="hs-comment">-- argument types ('ic_strict_arg_tys') are inhabitable.</span><span>
</span><a name="line-1451"></a><span class="hs-comment">-- See @Note [Extensions to GADTs Meet Their Match]@.</span><span>
</span><a name="line-1452"></a><span class="hs-keyword">data</span><span> </span><a name="InhabitationCandidate"><a href="Check.html#InhabitationCandidate"><span class="hs-identifier">InhabitationCandidate</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1453"></a><span>  </span><a name="InhabitationCandidate"><a href="Check.html#InhabitationCandidate"><span class="hs-identifier">InhabitationCandidate</span></a></a><span>
</span><a name="line-1454"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="ic_val_abs"><a href="Check.html#ic_val_abs"><span class="hs-identifier">ic_val_abs</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span>
</span><a name="line-1455"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="ic_tm_ct"><a href="Check.html#ic_tm_ct"><span class="hs-identifier">ic_tm_ct</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ComplexEq</span><span>
</span><a name="line-1456"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="ic_ty_cs"><a href="Check.html#ic_ty_cs"><span class="hs-identifier">ic_ty_cs</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span>
</span><a name="line-1457"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="ic_strict_arg_tys"><a href="Check.html#ic_strict_arg_tys"><span class="hs-identifier">ic_strict_arg_tys</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-1458"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-1459"></a><span>
</span><a name="line-1460"></a><span class="hs-comment">{-
Note [Extensions to GADTs Meet Their Match]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The GADTs Meet Their Match paper presents the formalism that GHC's coverage
checker adheres to. Since the paper's publication, there have been some
additional features added to the coverage checker which are not described in
the paper. This Note serves as a reference for these new features.

-----
-- Strict argument type constraints
-----

In the ConVar case of clause processing, each conlike K traditionally
generates two different forms of constraints:

* A term constraint (e.g., x ~ K y1 ... yn)
* Type constraints from the conlike's context (e.g., if K has type
  forall bs. Q =&gt; s1 .. sn -&gt; T tys, then Q would be its type constraints)

As it turns out, these alone are not enough to detect a certain class of
unreachable code. Consider the following example (adapted from #15305):

  data K = K1 | K2 !Void

  f :: K -&gt; ()
  f K1 = ()

Even though `f` doesn't match on `K2`, `f` is exhaustive in its patterns. Why?
Because it's impossible to construct a terminating value of type `K` using the
`K2` constructor, and thus it's impossible for `f` to ever successfully match
on `K2`.

The reason is because `K2`'s field of type `Void` is //strict//. Because there
are no terminating values of type `Void`, any attempt to construct something
using `K2` will immediately loop infinitely or throw an exception due to the
strictness annotation. (If the field were not strict, then `f` could match on,
say, `K2 undefined` or `K2 (let x = x in x)`.)

Since neither the term nor type constraints mentioned above take strict
argument types into account, we make use of the `nonVoid` function to
determine whether a strict type is inhabitable by a terminating value or not.

`nonVoid ty` returns True when either:
1. `ty` has at least one InhabitationCandidate for which both its term and type
   constraints are satifiable, and `nonVoid` returns `True` for all of the
   strict argument types in that InhabitationCandidate.
2. We're unsure if it's inhabited by a terminating value.

`nonVoid ty` returns False when `ty` is definitely uninhabited by anything
(except bottom). Some examples:

* `nonVoid Void` returns False, since Void has no InhabitationCandidates.
  (This is what lets us discard the `K2` constructor in the earlier example.)
* `nonVoid (Int :~: Int)` returns True, since it has an InhabitationCandidate
  (through the Refl constructor), and its term constraint (x ~ Refl) and
  type constraint (Int ~ Int) are satisfiable.
* `nonVoid (Int :~: Bool)` returns False. Although it has an
  InhabitationCandidate (by way of Refl), its type constraint (Int ~ Bool) is
  not satisfiable.
* Given the following definition of `MyVoid`:

    data MyVoid = MkMyVoid !Void

  `nonVoid MyVoid` returns False. The InhabitationCandidate for the MkMyVoid
  constructor contains Void as a strict argument type, and since `nonVoid Void`
  returns False, that InhabitationCandidate is discarded, leaving no others.

* Performance considerations

We must be careful when recursively calling `nonVoid` on the strict argument
types of an InhabitationCandidate, because doing so na&#239;vely can cause GHC to
fall into an infinite loop. Consider the following example:

  data Abyss = MkAbyss !Abyss

  stareIntoTheAbyss :: Abyss -&gt; a
  stareIntoTheAbyss x = case x of {}

In principle, stareIntoTheAbyss is exhaustive, since there is no way to
construct a terminating value using MkAbyss. However, both the term and type
constraints for MkAbyss are satisfiable, so the only way one could determine
that MkAbyss is unreachable is to check if `nonVoid Abyss` returns False.
There is only one InhabitationCandidate for Abyss&#8212;MkAbyss&#8212;and both its term
and type constraints are satisfiable, so we'd need to check if `nonVoid Abyss`
returns False... and now we've entered an infinite loop!

To avoid this sort of conundrum, `nonVoid` uses a simple test to detect the
presence of recursive types (through `checkRecTc`), and if recursion is
detected, we bail out and conservatively assume that the type is inhabited by
some terminating value. This avoids infinite loops at the expense of making
the coverage checker incomplete with respect to functions like
stareIntoTheAbyss above. Then again, the same problem occurs with recursive
newtypes, like in the following code:

  newtype Chasm = MkChasm Chasm

  gazeIntoTheChasm :: Chasm -&gt; a
  gazeIntoTheChasm x = case x of {} -- Erroneously warned as non-exhaustive

So this limitation is somewhat understandable.

Note that even with this recursion detection, there is still a possibility that
`nonVoid` can run in exponential time. Consider the following data type:

  data T = MkT !T !T !T

If we call `nonVoid` on each of its fields, that will require us to once again
check if `MkT` is inhabitable in each of those three fields, which in turn will
require us to check if `MkT` is inhabitable again... As you can see, the
branching factor adds up quickly, and if the recursion depth limit is, say,
100, then `nonVoid T` will effectively take forever.

To mitigate this, we check the branching factor every time we are about to call
`nonVoid` on a list of strict argument types. If the branching factor exceeds 1
(i.e., if there is potential for exponential runtime), then we limit the
maximum recursion depth to 1 to mitigate the problem. If the branching factor
is exactly 1 (i.e., we have a linear chain instead of a tree), then it's okay
to stick with a larger maximum recursion depth.

Another microoptimization applies to data types like this one:

  data S a = ![a] !T

Even though there is a strict field of type [a], it's quite silly to call
nonVoid on it, since it's &quot;obvious&quot; that it is inhabitable. To make this
intuition formal, we say that a type is definitely inhabitable (DI) if:

  * It has at least one constructor C such that:
    1. C has no equality constraints (since they might be unsatisfiable)
    2. C has no strict argument types (since they might be uninhabitable)

It's relatively cheap to cheap if a type is DI, so before we call `nonVoid`
on a list of strict argument types, we filter out all of the DI ones.
-}</span><span>
</span><a name="line-1594"></a><span>
</span><a name="line-1595"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-type">InhabitationCandidate</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1596"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-var">InhabitationCandidate</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_val_abs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964021"><a href="#local-6989586621683964021"><span class="hs-identifier">va</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_tm_ct</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964022"><a href="#local-6989586621683964022"><span class="hs-identifier">tm_ct</span></a></a><span>
</span><a name="line-1597"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_ty_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964023"><a href="#local-6989586621683964023"><span class="hs-identifier">ty_cs</span></a></a><span>
</span><a name="line-1598"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_strict_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964024"><a href="#local-6989586621683964024"><span class="hs-identifier">strict_arg_tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1599"></a><span>    </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;InhabitationCandidate&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-1600"></a><span>      </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ic_val_abs        =&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964021"><span class="hs-identifier hs-var">va</span></a><span>
</span><a name="line-1601"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ic_tm_ct          =&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964022"><span class="hs-identifier hs-var">tm_ct</span></a><span>
</span><a name="line-1602"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ic_ty_cs          =&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964023"><span class="hs-identifier hs-var">ty_cs</span></a><span>
</span><a name="line-1603"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ic_strict_arg_tys =&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964024"><span class="hs-identifier hs-var">strict_arg_tys</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1604"></a><span>
</span><a name="line-1605"></a><span class="hs-comment">-- | Generate an 'InhabitationCandidate' for a given conlike (generate</span><span>
</span><a name="line-1606"></a><span class="hs-comment">-- fresh variables of the appropriate type for arguments)</span><span>
</span><a name="line-1607"></a><span class="hs-identifier">mkOneConFull</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ConLike</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-type">InhabitationCandidate</span></a><span>
</span><a name="line-1608"></a><span class="hs-comment">--  *  x :: T tys, where T is an algebraic data type</span><span>
</span><a name="line-1609"></a><span class="hs-comment">--     NB: in the case of a data family, T is the *representation* TyCon</span><span>
</span><a name="line-1610"></a><span class="hs-comment">--     e.g.   data instance T (a,b) = T1 a b</span><span>
</span><a name="line-1611"></a><span class="hs-comment">--       leads to</span><span>
</span><a name="line-1612"></a><span class="hs-comment">--            data TPair a b = T1 a b  -- The &quot;representation&quot; type</span><span>
</span><a name="line-1613"></a><span class="hs-comment">--       It is TPair, not T, that is given to mkOneConFull</span><span>
</span><a name="line-1614"></a><span class="hs-comment">--</span><span>
</span><a name="line-1615"></a><span class="hs-comment">--  * 'con' K is a conlike of data type T</span><span>
</span><a name="line-1616"></a><span class="hs-comment">--</span><span>
</span><a name="line-1617"></a><span class="hs-comment">-- After instantiating the universal tyvars of K we get</span><span>
</span><a name="line-1618"></a><span class="hs-comment">--          K tys :: forall bs. Q =&gt; s1 .. sn -&gt; T tys</span><span>
</span><a name="line-1619"></a><span class="hs-comment">--</span><span>
</span><a name="line-1620"></a><span class="hs-comment">-- Suppose y1 is a strict field. Then we get</span><span>
</span><a name="line-1621"></a><span class="hs-comment">-- Results: ic_val_abs:        K (y1::s1) .. (yn::sn)</span><span>
</span><a name="line-1622"></a><span class="hs-comment">--          ic_tm_ct:          x ~ K y1..yn</span><span>
</span><a name="line-1623"></a><span class="hs-comment">--          ic_ty_cs:          Q</span><span>
</span><a name="line-1624"></a><span class="hs-comment">--          ic_strict_arg_tys: [s1]</span><span>
</span><a name="line-1625"></a><a name="mkOneConFull"><a href="Check.html#mkOneConFull"><span class="hs-identifier">mkOneConFull</span></a></a><span> </span><a name="local-6989586621683964430"><a href="#local-6989586621683964430"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621683964431"><a href="#local-6989586621683964431"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1626"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964432"><a href="#local-6989586621683964432"><span class="hs-identifier">res_ty</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621683964430"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1627"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621683964433"><a href="#local-6989586621683964433"><span class="hs-identifier">univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964434"><a href="#local-6989586621683964434"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964435"><a href="#local-6989586621683964435"><span class="hs-identifier">eq_spec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964436"><a href="#local-6989586621683964436"><span class="hs-identifier">thetas</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964437"><a href="#local-6989586621683964437"><span class="hs-identifier">_req_theta</span></a></a><span> </span><span class="hs-special">,</span><span> </span><a name="local-6989586621683964438"><a href="#local-6989586621683964438"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964439"><a href="#local-6989586621683964439"><span class="hs-identifier">con_res_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1628"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">conLikeFullSig</span><span> </span><a href="#local-6989586621683964431"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-1629"></a><span>      </span><a name="local-6989586621683964440"><a href="#local-6989586621683964440"><span class="hs-identifier">arg_is_banged</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">isBanged</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">conLikeImplBangs</span><span> </span><a href="#local-6989586621683964431"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-1630"></a><span>      </span><a name="local-6989586621683964441"><a href="#local-6989586621683964441"><span class="hs-identifier">tc_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyConAppArgs</span><span> </span><a href="#local-6989586621683964432"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-1631"></a><span>      </span><a name="local-6989586621683964442"><a href="#local-6989586621683964442"><span class="hs-identifier">subst1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964431"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1632"></a><span>                  </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">zipTvSubst</span><span> </span><a href="#local-6989586621683964433"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="#local-6989586621683964441"><span class="hs-identifier hs-var">tc_args</span></a><span>
</span><a name="line-1633"></a><span>                  </span><span class="hs-identifier hs-var">PatSynCon</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">expectJust</span><span> </span><span class="hs-string">&quot;mkOneConFull&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tcMatchTy</span><span> </span><a href="#local-6989586621683964439"><span class="hs-identifier hs-var">con_res_ty</span></a><span> </span><a href="#local-6989586621683964432"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1634"></a><span>                                    </span><span class="hs-comment">-- See Note [Pattern synonym result type] in PatSyn</span><span>
</span><a name="line-1635"></a><span>
</span><a name="line-1636"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621683964443"><a href="#local-6989586621683964443"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964444"><a href="#local-6989586621683964444"><span class="hs-identifier">ex_tvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">cloneTyVarBndrs</span><span> </span><a href="#local-6989586621683964442"><span class="hs-identifier hs-var">subst1</span></a><span> </span><a href="#local-6989586621683964434"><span class="hs-identifier hs-var">ex_tvs</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">getUniqueSupplyM</span><span>
</span><a name="line-1637"></a><span>
</span><a name="line-1638"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964445"><a href="#local-6989586621683964445"><span class="hs-identifier">arg_tys'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTys</span><span> </span><a href="#local-6989586621683964443"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621683964438"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1639"></a><span>  </span><span class="hs-comment">-- Fresh term variables (VAs) as arguments to the constructor</span><span>
</span><a name="line-1640"></a><span>  </span><a name="local-6989586621683964446"><a href="#local-6989586621683964446"><span class="hs-identifier">arguments</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Check.html#mkPmVar"><span class="hs-identifier hs-var">mkPmVar</span></a><span> </span><a href="#local-6989586621683964445"><span class="hs-identifier hs-var">arg_tys'</span></a><span>
</span><a name="line-1641"></a><span>  </span><span class="hs-comment">-- All constraints bound by the constructor (alpha-renamed)</span><span>
</span><a name="line-1642"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964447"><a href="#local-6989586621683964447"><span class="hs-identifier">theta_cs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">substTheta</span><span> </span><a href="#local-6989586621683964443"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">eqSpecPreds</span><span> </span><a href="#local-6989586621683964435"><span class="hs-identifier hs-var">eq_spec</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683964436"><span class="hs-identifier hs-var">thetas</span></a><span class="hs-special">)</span><span>
</span><a name="line-1643"></a><span>  </span><a name="local-6989586621683964448"><a href="#local-6989586621683964448"><span class="hs-identifier">evvars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Check.html#nameType"><span class="hs-identifier hs-var">nameType</span></a><span> </span><span class="hs-string">&quot;pm&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964447"><span class="hs-identifier hs-var">theta_cs</span></a><span>
</span><a name="line-1644"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964449"><a href="#local-6989586621683964449"><span class="hs-identifier">con_abs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964431"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-1645"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964441"><span class="hs-identifier hs-var">tc_args</span></a><span>
</span><a name="line-1646"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964444"><span class="hs-identifier hs-var">ex_tvs'</span></a><span>
</span><a name="line-1647"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964448"><span class="hs-identifier hs-var">evvars</span></a><span>
</span><a name="line-1648"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964446"><span class="hs-identifier hs-var">arguments</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1649"></a><span>      </span><a name="local-6989586621683964450"><a href="#local-6989586621683964450"><span class="hs-identifier">strict_arg_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterByList</span><span> </span><a href="#local-6989586621683964440"><span class="hs-identifier hs-var">arg_is_banged</span></a><span> </span><a href="#local-6989586621683964445"><span class="hs-identifier hs-var">arg_tys'</span></a><span>
</span><a name="line-1650"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-var">InhabitationCandidate</span></a><span>
</span><a name="line-1651"></a><span>           </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_val_abs</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964449"><span class="hs-identifier hs-var">con_abs</span></a><span>
</span><a name="line-1652"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_tm_ct</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964430"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Check.html#vaToPmExpr"><span class="hs-identifier hs-var">vaToPmExpr</span></a><span> </span><a href="#local-6989586621683964449"><span class="hs-identifier hs-var">con_abs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1653"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_ty_cs</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><a href="#local-6989586621683964448"><span class="hs-identifier hs-var">evvars</span></a><span>
</span><a name="line-1654"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_strict_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964450"><span class="hs-identifier hs-var">strict_arg_tys</span></a><span>
</span><a name="line-1655"></a><span>           </span><span class="hs-special">}</span><span>
</span><a name="line-1656"></a><span>
</span><a name="line-1657"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-1658"></a><span class="hs-comment">-- * More smart constructors and fresh variable generation</span><span>
</span><a name="line-1659"></a><span>
</span><a name="line-1660"></a><span class="hs-comment">-- | Create a guard pattern</span><span>
</span><a name="line-1661"></a><span class="hs-identifier">mkGuard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span>
</span><a name="line-1662"></a><a name="mkGuard"><a href="Check.html#mkGuard"><span class="hs-identifier">mkGuard</span></a></a><span> </span><a name="local-6989586621683964451"><a href="#local-6989586621683964451"><span class="hs-identifier">pv</span></a></a><span> </span><a name="local-6989586621683964452"><a href="#local-6989586621683964452"><span class="hs-identifier">e</span></a></a><span>
</span><a name="line-1663"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="Check.html#cantFailPattern"><span class="hs-identifier hs-var">cantFailPattern</span></a><span> </span><a href="#local-6989586621683964451"><span class="hs-identifier hs-var">pv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><a href="#local-6989586621683964451"><span class="hs-identifier hs-var">pv</span></a><span> </span><a href="#local-6989586621683964453"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1664"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">PmExprOther</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964453"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#fake_pat"><span class="hs-identifier hs-var">fake_pat</span></a><span>
</span><a name="line-1665"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><a href="#local-6989586621683964451"><span class="hs-identifier hs-var">pv</span></a><span> </span><a href="#local-6989586621683964453"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1666"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1667"></a><span>    </span><a name="local-6989586621683964453"><a href="#local-6989586621683964453"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsExprToPmExpr</span><span> </span><a href="#local-6989586621683964452"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1668"></a><span>
</span><a name="line-1669"></a><span class="hs-comment">-- | Create a term equality of the form: `(False ~ (x ~ lit))`</span><span>
</span><a name="line-1670"></a><span class="hs-identifier">mkNegEq</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PmLit</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ComplexEq</span><span>
</span><a name="line-1671"></a><a name="mkNegEq"><a href="Check.html#mkNegEq"><span class="hs-identifier">mkNegEq</span></a></a><span> </span><a name="local-6989586621683964454"><a href="#local-6989586621683964454"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621683964455"><a href="#local-6989586621683964455"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">falsePmExpr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964454"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">PmExprEq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">PmExprLit</span><span> </span><a href="#local-6989586621683964455"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1672"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mkNegEq</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1673"></a><span>
</span><a name="line-1674"></a><span class="hs-comment">-- | Create a term equality of the form: `(x ~ lit)`</span><span>
</span><a name="line-1675"></a><span class="hs-identifier">mkPosEq</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PmLit</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ComplexEq</span><span>
</span><a name="line-1676"></a><a name="mkPosEq"><a href="Check.html#mkPosEq"><span class="hs-identifier">mkPosEq</span></a></a><span> </span><a name="local-6989586621683964456"><a href="#local-6989586621683964456"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621683964457"><a href="#local-6989586621683964457"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964456"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">PmExprLit</span><span> </span><a href="#local-6989586621683964457"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1677"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mkPosEq</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1678"></a><span>
</span><a name="line-1679"></a><span class="hs-comment">-- | Create a term equality of the form: `(x ~ x)`</span><span>
</span><a name="line-1680"></a><span class="hs-comment">-- (always discharged by the term oracle)</span><span>
</span><a name="line-1681"></a><span class="hs-identifier">mkIdEq</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ComplexEq</span><span>
</span><a name="line-1682"></a><a name="mkIdEq"><a href="Check.html#mkIdEq"><span class="hs-identifier">mkIdEq</span></a></a><span> </span><a name="local-6989586621683964458"><a href="#local-6989586621683964458"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><a href="#local-6989586621683964459"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><a href="#local-6989586621683964459"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1683"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621683964459"><a href="#local-6989586621683964459"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964458"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1684"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mkIdEq</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1685"></a><span>
</span><a name="line-1686"></a><span class="hs-comment">-- | Generate a variable pattern of a given type</span><span>
</span><a name="line-1687"></a><span class="hs-identifier">mkPmVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><a href="#local-6989586621683964042"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1688"></a><a name="mkPmVar"><a href="Check.html#mkPmVar"><span class="hs-identifier">mkPmVar</span></a></a><span> </span><a name="local-6989586621683964460"><a href="#local-6989586621683964460"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a><span> </span><a href="#local-6989586621683964460"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1689"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mkPmVar</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1690"></a><span>
</span><a name="line-1691"></a><span class="hs-comment">-- | Generate many variable patterns, given a list of types</span><span>
</span><a name="line-1692"></a><span class="hs-identifier">mkPmVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span>
</span><a name="line-1693"></a><a name="mkPmVars"><a href="Check.html#mkPmVars"><span class="hs-identifier">mkPmVars</span></a></a><span> </span><a name="local-6989586621683964461"><a href="#local-6989586621683964461"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Check.html#mkPmVar"><span class="hs-identifier hs-var">mkPmVar</span></a><span> </span><a href="#local-6989586621683964461"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1694"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mkPmVars</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1695"></a><span>
</span><a name="line-1696"></a><span class="hs-comment">-- | Generate a fresh `Id` of a given type</span><span>
</span><a name="line-1697"></a><span class="hs-identifier">mkPmId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-1698"></a><a name="mkPmId"><a href="Check.html#mkPmId"><span class="hs-identifier">mkPmId</span></a></a><span> </span><a name="local-6989586621683964462"><a href="#local-6989586621683964462"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getUniqueM</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621683964463"><a href="#local-6989586621683964463"><span class="hs-identifier">unique</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1699"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964464"><a href="#local-6989586621683964464"><span class="hs-identifier">occname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarOccFS</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;$pm&quot;</span><span>
</span><a name="line-1700"></a><span>      </span><a name="local-6989586621683964465"><a href="#local-6989586621683964465"><span class="hs-identifier">name</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInternalName</span><span> </span><a href="#local-6989586621683964463"><span class="hs-identifier hs-var">unique</span></a><span> </span><a href="#local-6989586621683964464"><span class="hs-identifier hs-var">occname</span></a><span> </span><span class="hs-identifier hs-var">noSrcSpan</span><span>
</span><a name="line-1701"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLocalId</span><span> </span><a href="#local-6989586621683964465"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621683964462"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1702"></a><span>
</span><a name="line-1703"></a><span class="hs-comment">-- | Generate a fresh term variable of a given and return it in two forms:</span><span>
</span><a name="line-1704"></a><span class="hs-comment">-- * A variable pattern</span><span>
</span><a name="line-1705"></a><span class="hs-comment">-- * A variable expression</span><span>
</span><a name="line-1706"></a><span class="hs-identifier">mkPmId2Forms</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1707"></a><a name="mkPmId2Forms"><a href="Check.html#mkPmId2Forms"><span class="hs-identifier">mkPmId2Forms</span></a></a><span> </span><a name="local-6989586621683964466"><a href="#local-6989586621683964466"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1708"></a><span>  </span><a name="local-6989586621683964467"><a href="#local-6989586621683964467"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a><span> </span><a href="#local-6989586621683964466"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1709"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a href="#local-6989586621683964467"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsVar</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><a href="#local-6989586621683964467"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1710"></a><span>
</span><a name="line-1711"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-1712"></a><span class="hs-comment">-- * Converting between Value Abstractions, Patterns and PmExpr</span><span>
</span><a name="line-1713"></a><span>
</span><a name="line-1714"></a><span class="hs-comment">-- | Convert a value abstraction an expression</span><span>
</span><a name="line-1715"></a><span class="hs-identifier">vaToPmExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PmExpr</span><span>
</span><a name="line-1716"></a><a name="vaToPmExpr"><a href="Check.html#vaToPmExpr"><span class="hs-identifier">vaToPmExpr</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964468"><a href="#local-6989586621683964468"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964469"><a href="#local-6989586621683964469"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1717"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PmExprCon</span><span> </span><a href="#local-6989586621683964468"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#vaToPmExpr"><span class="hs-identifier hs-var">vaToPmExpr</span></a><span> </span><a href="#local-6989586621683964469"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1718"></a><span class="hs-identifier">vaToPmExpr</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_var_id</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964470"><a href="#local-6989586621683964470"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964470"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1719"></a><span class="hs-identifier">vaToPmExpr</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_lit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964471"><a href="#local-6989586621683964471"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PmExprLit</span><span> </span><a href="#local-6989586621683964471"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1720"></a><span class="hs-identifier">vaToPmExpr</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmNLit"><span class="hs-identifier hs-var">PmNLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_id</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964472"><a href="#local-6989586621683964472"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964472"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1721"></a><span>
</span><a name="line-1722"></a><span class="hs-comment">-- | Convert a pattern vector to a list of value abstractions by dropping the</span><span>
</span><a name="line-1723"></a><span class="hs-comment">-- guards (See Note [Translating As Patterns])</span><span>
</span><a name="line-1724"></a><span class="hs-identifier">coercePatVec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1725"></a><a name="coercePatVec"><a href="Check.html#coercePatVec"><span class="hs-identifier">coercePatVec</span></a></a><span> </span><a name="local-6989586621683964473"><a href="#local-6989586621683964473"><span class="hs-identifier">pv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="Check.html#coercePmPat"><span class="hs-identifier hs-var">coercePmPat</span></a><span> </span><a href="#local-6989586621683964473"><span class="hs-identifier hs-var">pv</span></a><span>
</span><a name="line-1726"></a><span>
</span><a name="line-1727"></a><span class="hs-comment">-- | Convert a pattern to a list of value abstractions (will be either an empty</span><span>
</span><a name="line-1728"></a><span class="hs-comment">-- list if the pattern is a guard pattern, or a singleton list in all other</span><span>
</span><a name="line-1729"></a><span class="hs-comment">-- cases) by dropping the guards (See Note [Translating As Patterns])</span><span>
</span><a name="line-1730"></a><span class="hs-identifier">coercePmPat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1731"></a><a name="coercePmPat"><a href="Check.html#coercePmPat"><span class="hs-identifier">coercePmPat</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_var_id</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964474"><a href="#local-6989586621683964474"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_var_id</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964474"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1732"></a><span class="hs-identifier">coercePmPat</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_lit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964475"><a href="#local-6989586621683964475"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_lit</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964475"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1733"></a><span class="hs-identifier">coercePmPat</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964476"><a href="#local-6989586621683964476"><span class="hs-identifier">con</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964477"><a href="#local-6989586621683964477"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-1734"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964478"><a href="#local-6989586621683964478"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964479"><a href="#local-6989586621683964479"><span class="hs-identifier">dicts</span></a></a><span>
</span><a name="line-1735"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964480"><a href="#local-6989586621683964480"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1736"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964476"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964477"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1737"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964478"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964479"><span class="hs-identifier hs-var">dicts</span></a><span>
</span><a name="line-1738"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#coercePatVec"><span class="hs-identifier hs-var">coercePatVec</span></a><span> </span><a href="#local-6989586621683964480"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-1739"></a><span class="hs-identifier">coercePmPat</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- drop the guards</span><span>
</span><a name="line-1740"></a><span>
</span><a name="line-1741"></a><span class="hs-comment">-- | Check whether a data constructor is the only way to construct</span><span>
</span><a name="line-1742"></a><span class="hs-comment">-- a data type.</span><span>
</span><a name="line-1743"></a><span class="hs-identifier">singleConstructor</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConLike</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1744"></a><a name="singleConstructor"><a href="Check.html#singleConstructor"><span class="hs-identifier">singleConstructor</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><a name="local-6989586621683964481"><a href="#local-6989586621683964481"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1745"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConTyCon</span><span> </span><a href="#local-6989586621683964481"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1746"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1747"></a><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1748"></a><span class="hs-identifier">singleConstructor</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1749"></a><span>
</span><a name="line-1750"></a><span class="hs-comment">-- | For a given conlike, finds all the sets of patterns which could</span><span>
</span><a name="line-1751"></a><span class="hs-comment">-- be relevant to that conlike by consulting the result type.</span><span>
</span><a name="line-1752"></a><span class="hs-comment">--</span><span>
</span><a name="line-1753"></a><span class="hs-comment">-- These come from two places.</span><span>
</span><a name="line-1754"></a><span class="hs-comment">--  1. From data constructors defined with the result type constructor.</span><span>
</span><a name="line-1755"></a><span class="hs-comment">--  2. From `COMPLETE` pragmas which have the same type as the result</span><span>
</span><a name="line-1756"></a><span class="hs-comment">--     type constructor. Note that we only use `COMPLETE` pragmas</span><span>
</span><a name="line-1757"></a><span class="hs-comment">--     *all* of whose pattern types match. See #14135</span><span>
</span><a name="line-1758"></a><span class="hs-identifier">allCompleteMatches</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConLike</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Check.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ConLike</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1759"></a><a name="allCompleteMatches"><a href="Check.html#allCompleteMatches"><span class="hs-identifier">allCompleteMatches</span></a></a><span> </span><a name="local-6989586621683964482"><a href="#local-6989586621683964482"><span class="hs-identifier">cl</span></a></a><span> </span><a name="local-6989586621683964483"><a href="#local-6989586621683964483"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1760"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964490"><a href="#local-6989586621683964490"><span class="hs-identifier">fam</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964482"><span class="hs-identifier hs-var">cl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1761"></a><span>           </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><a name="local-6989586621683964492"><a href="#local-6989586621683964492"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1762"></a><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Check.html#FromBuiltin"><span class="hs-identifier hs-var">FromBuiltin</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConTyCon</span><span> </span><a href="#local-6989586621683964492"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1763"></a><span>           </span><span class="hs-identifier hs-var">PatSynCon</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1764"></a><span>      </span><a name="local-6989586621683964491"><a href="#local-6989586621683964491"><span class="hs-identifier">ty</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">conLikeResTy</span><span> </span><a href="#local-6989586621683964482"><span class="hs-identifier hs-var">cl</span></a><span> </span><a href="#local-6989586621683964483"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1765"></a><span>  </span><a name="local-6989586621683964494"><a href="#local-6989586621683964494"><span class="hs-identifier">pragmas</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">splitTyConApp_maybe</span><span> </span><a href="#local-6989586621683964491"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1766"></a><span>               </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964493"><a href="#local-6989586621683964493"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#dsGetCompleteMatches"><span class="hs-identifier hs-var">dsGetCompleteMatches</span></a><span> </span><a href="#local-6989586621683964493"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1767"></a><span>               </span><span class="hs-identifier hs-var">Nothing</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1768"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964495"><a href="#local-6989586621683964495"><span class="hs-identifier">fams</span></a></a><span> </span><a name="local-6989586621683964496"><a href="#local-6989586621683964496"><span class="hs-identifier">cm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Check.html#FromComplete"><span class="hs-identifier hs-var">FromComplete</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1769"></a><span>                </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="DsMonad.html#dsLookupConLike"><span class="hs-identifier hs-var">dsLookupConLike</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">completeMatchConLikes</span><span> </span><a href="#local-6989586621683964496"><span class="hs-identifier hs-var">cm</span></a><span class="hs-special">)</span><span>
</span><a name="line-1770"></a><span>  </span><a name="local-6989586621683964498"><a href="#local-6989586621683964498"><span class="hs-identifier">from_pragma</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621683964497"><a href="#local-6989586621683964497"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964484"><span class="hs-identifier hs-var">isValidCompleteMatch</span></a><span> </span><a href="#local-6989586621683964491"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621683964497"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1771"></a><span>                </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621683964495"><span class="hs-identifier hs-var">fams</span></a><span> </span><a href="#local-6989586621683964494"><span class="hs-identifier hs-var">pragmas</span></a><span>
</span><a name="line-1772"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964499"><a href="#local-6989586621683964499"><span class="hs-identifier">final_groups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964490"><span class="hs-identifier hs-var">fam</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683964498"><span class="hs-identifier hs-var">from_pragma</span></a><span>
</span><a name="line-1773"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621683964499"><span class="hs-identifier hs-var">final_groups</span></a><span>
</span><a name="line-1774"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1775"></a><span>      </span><span class="hs-comment">-- Check that all the pattern synonym return types in a `COMPLETE`</span><span>
</span><a name="line-1776"></a><span>      </span><span class="hs-comment">-- pragma subsume the type we're matching.</span><span>
</span><a name="line-1777"></a><span>      </span><span class="hs-comment">-- See Note [Filtering out non-matching COMPLETE sets]</span><span>
</span><a name="line-1778"></a><span>      </span><span class="hs-identifier">isValidCompleteMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ConLike</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1779"></a><span>      </span><a name="local-6989586621683964484"><a href="#local-6989586621683964484"><span class="hs-identifier">isValidCompleteMatch</span></a></a><span> </span><a name="local-6989586621683964485"><a href="#local-6989586621683964485"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="#local-6989586621683964486"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-1780"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-1781"></a><span>          </span><a name="local-6989586621683964486"><a href="#local-6989586621683964486"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1782"></a><span>          </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynCon</span><span> </span><a name="local-6989586621683964488"><a href="#local-6989586621683964488"><span class="hs-identifier">psc</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">tcMatchTy</span><span> </span><a href="#local-6989586621683964485"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621683964487"><span class="hs-identifier hs-var">patSynResTy</span></a><span>
</span><a name="line-1783"></a><span>                                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">patSynSig</span><span> </span><a href="#local-6989586621683964488"><span class="hs-identifier hs-var">psc</span></a><span>
</span><a name="line-1784"></a><span>
</span><a name="line-1785"></a><span>          </span><a name="local-6989586621683964487"><a href="#local-6989586621683964487"><span class="hs-identifier">patSynResTy</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683964489"><a href="#local-6989586621683964489"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964489"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-1786"></a><span>
</span><a name="line-1787"></a><span class="hs-comment">{-
Note [Filtering out non-matching COMPLETE sets]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Currently, conlikes in a COMPLETE set are simply grouped by the
type constructor heading the return type. This is nice and simple, but it does
mean that there are scenarios when a COMPLETE set might be incompatible with
the type of a scrutinee. For instance, consider (from #14135):

  data Foo a = Foo1 a | Foo2 a

  pattern MyFoo2 :: Int -&gt; Foo Int
  pattern MyFoo2 i = Foo2 i

  {-# COMPLETE Foo1, MyFoo2 #-}

  f :: Foo a -&gt; a
  f (Foo1 x) = x

`f` has an incomplete pattern-match, so when choosing which constructors to
report as unmatched in a warning, GHC must choose between the original set of
data constructors {Foo1, Foo2} and the COMPLETE set {Foo1, MyFoo2}. But observe
that GHC shouldn't even consider the COMPLETE set as a possibility: the return
type of MyFoo2, Foo Int, does not match the type of the scrutinee, Foo a, since
there's no substitution `s` such that s(Foo Int) = Foo a.

To ensure that GHC doesn't pick this COMPLETE set, it checks each pattern
synonym constructor's return type matches the type of the scrutinee, and if one
doesn't, then we remove the whole COMPLETE set from consideration.

One might wonder why GHC only checks /pattern synonym/ constructors, and not
/data/ constructors as well. The reason is because that the type of a
GADT constructor very well may not match the type of a scrutinee, and that's
OK. Consider this example (from #14059):

  data SBool (z :: Bool) where
    SFalse :: SBool False
    STrue  :: SBool True

  pattern STooGoodToBeTrue :: forall (z :: Bool). ()
                           =&gt; z ~ True
                           =&gt; SBool z
  pattern STooGoodToBeTrue = STrue
  {-# COMPLETE SFalse, STooGoodToBeTrue #-}

  wobble :: SBool z -&gt; Bool
  wobble STooGoodToBeTrue = True

In the incomplete pattern match for `wobble`, we /do/ want to warn that SFalse
should be matched against, even though its type, SBool False, does not match
the scrutinee type, SBool z.
-}</span><span>
</span><a name="line-1838"></a><span>
</span><a name="line-1839"></a><span class="hs-comment">-- -----------------------------------------------------------------------</span><span>
</span><a name="line-1840"></a><span class="hs-comment">-- * Types and constraints</span><span>
</span><a name="line-1841"></a><span>
</span><a name="line-1842"></a><span class="hs-identifier">newEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span>
</span><a name="line-1843"></a><a name="newEvVar"><a href="Check.html#newEvVar"><span class="hs-identifier">newEvVar</span></a></a><span> </span><a name="local-6989586621683964500"><a href="#local-6989586621683964500"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621683964501"><a href="#local-6989586621683964501"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLocalId</span><span> </span><a href="#local-6989586621683964500"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621683964501"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1844"></a><span>
</span><a name="line-1845"></a><span class="hs-identifier">nameType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span>
</span><a name="line-1846"></a><a name="nameType"><a href="Check.html#nameType"><span class="hs-identifier">nameType</span></a></a><span> </span><a name="local-6989586621683964502"><a href="#local-6989586621683964502"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621683964503"><a href="#local-6989586621683964503"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1847"></a><span>  </span><a name="local-6989586621683964504"><a href="#local-6989586621683964504"><span class="hs-identifier">unique</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getUniqueM</span><span>
</span><a name="line-1848"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964505"><a href="#local-6989586621683964505"><span class="hs-identifier">occname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkVarOccFS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964502"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;_&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621683964504"><span class="hs-identifier hs-var">unique</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1849"></a><span>      </span><a name="local-6989586621683964506"><a href="#local-6989586621683964506"><span class="hs-identifier">idname</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkInternalName</span><span> </span><a href="#local-6989586621683964504"><span class="hs-identifier hs-var">unique</span></a><span> </span><a href="#local-6989586621683964505"><span class="hs-identifier hs-var">occname</span></a><span> </span><span class="hs-identifier hs-var">noSrcSpan</span><span>
</span><a name="line-1850"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Check.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a><span> </span><a href="#local-6989586621683964506"><span class="hs-identifier hs-var">idname</span></a><span> </span><a href="#local-6989586621683964503"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1851"></a><span>
</span><a name="line-1852"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                              The type oracle
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1859"></a><span>
</span><a name="line-1860"></a><span class="hs-comment">-- | Check whether a set of type constraints is satisfiable.</span><span>
</span><a name="line-1861"></a><span class="hs-identifier">tyOracle</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1862"></a><a name="tyOracle"><a href="Check.html#tyOracle"><span class="hs-identifier">tyOracle</span></a></a><span> </span><a name="local-6989586621683964507"><a href="#local-6989586621683964507"><span class="hs-identifier">evs</span></a></a><span>
</span><a name="line-1863"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1864"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621683964508"><a href="#local-6989586621683964508"><span class="hs-identifier">_warns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964509"><a href="#local-6989586621683964509"><span class="hs-identifier">errs</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683964510"><a href="#local-6989586621683964510"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#initTcDsForSolver"><span class="hs-identifier hs-var">initTcDsForSolver</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcSimplify.html#tcCheckSatisfiability"><span class="hs-identifier hs-var">tcCheckSatisfiability</span></a><span> </span><a href="#local-6989586621683964507"><span class="hs-identifier hs-var">evs</span></a><span>
</span><a name="line-1865"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964510"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1866"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964511"><a href="#local-6989586621683964511"><span class="hs-identifier">sat</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621683964511"><span class="hs-identifier hs-var">sat</span></a><span>
</span><a name="line-1867"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;tyOracle&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">pprErrMsgBagWithLoc</span><span> </span><a href="#local-6989586621683964509"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1868"></a><span>
</span><a name="line-1869"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                             Sanity Checks
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1876"></a><span>
</span><a name="line-1877"></a><span class="hs-comment">-- | The arity of a pattern/pattern vector is the</span><span>
</span><a name="line-1878"></a><span class="hs-comment">-- number of top-level patterns that are not guards</span><span>
</span><a name="line-1879"></a><span class="hs-keyword">type</span><span> </span><a name="PmArity"><a href="Check.html#PmArity"><span class="hs-identifier">PmArity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1880"></a><span>
</span><a name="line-1881"></a><span class="hs-comment">-- | Compute the arity of a pattern vector</span><span>
</span><a name="line-1882"></a><span class="hs-identifier">patVecArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmArity"><span class="hs-identifier hs-type">PmArity</span></a><span>
</span><a name="line-1883"></a><a name="patVecArity"><a href="Check.html#patVecArity"><span class="hs-identifier">patVecArity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#patternArity"><span class="hs-identifier hs-var">patternArity</span></a><span>
</span><a name="line-1884"></a><span>
</span><a name="line-1885"></a><span class="hs-comment">-- | Compute the arity of a pattern</span><span>
</span><a name="line-1886"></a><span class="hs-identifier">patternArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmArity"><span class="hs-identifier hs-type">PmArity</span></a><span>
</span><a name="line-1887"></a><a name="patternArity"><a href="Check.html#patternArity"><span class="hs-identifier">patternArity</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1888"></a><span class="hs-identifier">patternArity</span><span> </span><a name="local-6989586621683964512"><a href="#local-6989586621683964512"><span class="hs-identifier">_other_pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1889"></a><span>
</span><a name="line-1890"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Heart of the algorithm: Function pmcheck
%*                                                                      *
%************************************************************************

Main functions are:

* mkInitialUncovered :: [Id] -&gt; PmM Uncovered

  Generates the initial uncovered set. Term and type constraints in scope
  are checked, if they are inconsistent, the set is empty, otherwise, the
  set contains only a vector of variables with the constraints in scope.

* pmcheck :: PatVec -&gt; [PatVec] -&gt; ValVec -&gt; PmM PartialResult

  Checks redundancy, coverage and inaccessibility, using auxilary functions
  `pmcheckGuards` and `pmcheckHd`. Mainly handles the guard case which is
  common in all three checks (see paper) and calls `pmcheckGuards` when the
  whole clause is checked, or `pmcheckHd` when the pattern vector does not
  start with a guard.

* pmcheckGuards :: [PatVec] -&gt; ValVec -&gt; PmM PartialResult

  Processes the guards.

* pmcheckHd :: Pattern -&gt; PatVec -&gt; [PatVec]
          -&gt; ValAbs -&gt; ValVec -&gt; PmM PartialResult

  Worker: This function implements functions `covered`, `uncovered` and
  `divergent` from the paper at once. Slightly different from the paper because
  it does not even produce the covered and uncovered sets. Since we only care
  about whether a clause covers SOMETHING or if it may forces ANY argument, we
  only store a boolean in both cases, for efficiency.
-}</span><span>
</span><a name="line-1926"></a><span>
</span><a name="line-1927"></a><span class="hs-comment">-- | Lift a pattern matching action from a single value vector abstration to a</span><span>
</span><a name="line-1928"></a><span class="hs-comment">-- value set abstraction, but calling it on every vector and the combining the</span><span>
</span><a name="line-1929"></a><span class="hs-comment">-- results.</span><span>
</span><a name="line-1930"></a><span class="hs-identifier">runMany</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Check.html#Uncovered"><span class="hs-identifier hs-type">Uncovered</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-1931"></a><a name="runMany"><a href="Check.html#runMany"><span class="hs-identifier">runMany</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1932"></a><span class="hs-identifier">runMany</span><span> </span><a name="local-6989586621683964513"><a href="#local-6989586621683964513"><span class="hs-identifier">pm</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964514"><a href="#local-6989586621683964514"><span class="hs-identifier">m</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683964515"><a href="#local-6989586621683964515"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mappend</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621683964513"><span class="hs-identifier hs-var">pm</span></a><span> </span><a href="#local-6989586621683964514"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Check.html#runMany"><span class="hs-identifier hs-var">runMany</span></a><span> </span><a href="#local-6989586621683964513"><span class="hs-identifier hs-var">pm</span></a><span> </span><a href="#local-6989586621683964515"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-1933"></a><span>
</span><a name="line-1934"></a><span class="hs-comment">-- | Generate the initial uncovered set. It initializes the</span><span>
</span><a name="line-1935"></a><span class="hs-comment">-- delta with all term and type constraints in scope.</span><span>
</span><a name="line-1936"></a><span class="hs-identifier">mkInitialUncovered</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#Uncovered"><span class="hs-identifier hs-type">Uncovered</span></a><span>
</span><a name="line-1937"></a><a name="mkInitialUncovered"><a href="Check.html#mkInitialUncovered"><span class="hs-identifier">mkInitialUncovered</span></a></a><span> </span><a name="local-6989586621683964516"><a href="#local-6989586621683964516"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1938"></a><span>  </span><a name="local-6989586621683964517"><a href="#local-6989586621683964517"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmInitialTmTyCs"><span class="hs-identifier hs-var">pmInitialTmTyCs</span></a><span>
</span><a name="line-1939"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964518"><a href="#local-6989586621683964518"><span class="hs-identifier">patterns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a href="#local-6989586621683964516"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-1940"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a href="#local-6989586621683964518"><span class="hs-identifier hs-var">patterns</span></a><span> </span><a href="#local-6989586621683964517"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">]</span><span>
</span><a name="line-1941"></a><span>
</span><a name="line-1942"></a><span class="hs-comment">-- | Increase the counter for elapsed algorithm iterations, check that the</span><span>
</span><a name="line-1943"></a><span class="hs-comment">-- limit is not exceeded and call `pmcheck`</span><span>
</span><a name="line-1944"></a><span class="hs-identifier">pmcheckI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-1945"></a><a name="pmcheckI"><a href="Check.html#pmcheckI"><span class="hs-identifier">pmcheckI</span></a></a><span> </span><a name="local-6989586621683964519"><a href="#local-6989586621683964519"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964520"><a href="#local-6989586621683964520"><span class="hs-identifier">guards</span></a></a><span> </span><a name="local-6989586621683964521"><a href="#local-6989586621683964521"><span class="hs-identifier">vva</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1946"></a><span>  </span><a name="local-6989586621683964522"><a href="#local-6989586621683964522"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#incrCheckPmIterDs"><span class="hs-identifier hs-var">incrCheckPmIterDs</span></a><span>
</span><a name="line-1947"></a><span>  </span><a href="Check.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a><span> </span><span class="hs-string">&quot;pmCheck&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964522"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="Check.html#pprPatVec"><span class="hs-identifier hs-var">pprPatVec</span></a><span> </span><a href="#local-6989586621683964519"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1948"></a><span>                        </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;guards:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#pprPatVec"><span class="hs-identifier hs-var">pprPatVec</span></a><span> </span><a href="#local-6989586621683964520"><span class="hs-identifier hs-var">guards</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1949"></a><span>                        </span><span class="hs-operator hs-var">$$</span><span> </span><a href="Check.html#pprValVecDebug"><span class="hs-identifier hs-var">pprValVecDebug</span></a><span> </span><a href="#local-6989586621683964521"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span>
</span><a name="line-1950"></a><span>  </span><a name="local-6989586621683964523"><a href="#local-6989586621683964523"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmcheck"><span class="hs-identifier hs-var">pmcheck</span></a><span> </span><a href="#local-6989586621683964519"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964520"><span class="hs-identifier hs-var">guards</span></a><span> </span><a href="#local-6989586621683964521"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-1951"></a><span>  </span><a href="Check.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a><span> </span><span class="hs-string">&quot;pmCheckResult:&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964523"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1952"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621683964523"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1953"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">pmcheckI</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1954"></a><span>
</span><a name="line-1955"></a><span class="hs-comment">-- | Increase the counter for elapsed algorithm iterations, check that the</span><span>
</span><a name="line-1956"></a><span class="hs-comment">-- limit is not exceeded and call `pmcheckGuards`</span><span>
</span><a name="line-1957"></a><span class="hs-identifier">pmcheckGuardsI</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-1958"></a><a name="pmcheckGuardsI"><a href="Check.html#pmcheckGuardsI"><span class="hs-identifier">pmcheckGuardsI</span></a></a><span> </span><a name="local-6989586621683964524"><a href="#local-6989586621683964524"><span class="hs-identifier">gvs</span></a></a><span> </span><a name="local-6989586621683964525"><a href="#local-6989586621683964525"><span class="hs-identifier">vva</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#incrCheckPmIterDs"><span class="hs-identifier hs-var">incrCheckPmIterDs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Check.html#pmcheckGuards"><span class="hs-identifier hs-var">pmcheckGuards</span></a><span> </span><a href="#local-6989586621683964524"><span class="hs-identifier hs-var">gvs</span></a><span> </span><a href="#local-6989586621683964525"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-1959"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">pmcheckGuardsI</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1960"></a><span>
</span><a name="line-1961"></a><span class="hs-comment">-- | Increase the counter for elapsed algorithm iterations, check that the</span><span>
</span><a name="line-1962"></a><span class="hs-comment">-- limit is not exceeded and call `pmcheckHd`</span><span>
</span><a name="line-1963"></a><span class="hs-identifier">pmcheckHdI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span>
</span><a name="line-1964"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-1965"></a><a name="pmcheckHdI"><a href="Check.html#pmcheckHdI"><span class="hs-identifier">pmcheckHdI</span></a></a><span> </span><a name="local-6989586621683964526"><a href="#local-6989586621683964526"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621683964527"><a href="#local-6989586621683964527"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964528"><a href="#local-6989586621683964528"><span class="hs-identifier">guards</span></a></a><span> </span><a name="local-6989586621683964529"><a href="#local-6989586621683964529"><span class="hs-identifier">va</span></a></a><span> </span><a name="local-6989586621683964530"><a href="#local-6989586621683964530"><span class="hs-identifier">vva</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1966"></a><span>  </span><a name="local-6989586621683964531"><a href="#local-6989586621683964531"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><a href="DsMonad.html#incrCheckPmIterDs"><span class="hs-identifier hs-var">incrCheckPmIterDs</span></a><span>
</span><a name="line-1967"></a><span>  </span><a href="Check.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a><span> </span><span class="hs-string">&quot;pmCheckHdI&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964531"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="Check.html#pprPmPatDebug"><span class="hs-identifier hs-var">pprPmPatDebug</span></a><span> </span><a href="#local-6989586621683964526"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1968"></a><span>                        </span><span class="hs-operator hs-var">$$</span><span> </span><a href="Check.html#pprPatVec"><span class="hs-identifier hs-var">pprPatVec</span></a><span> </span><a href="#local-6989586621683964527"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1969"></a><span>                        </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;guards:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#pprPatVec"><span class="hs-identifier hs-var">pprPatVec</span></a><span> </span><a href="#local-6989586621683964528"><span class="hs-identifier hs-var">guards</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1970"></a><span>                        </span><span class="hs-operator hs-var">$$</span><span> </span><a href="Check.html#pprPmPatDebug"><span class="hs-identifier hs-var">pprPmPatDebug</span></a><span> </span><a href="#local-6989586621683964529"><span class="hs-identifier hs-var">va</span></a><span>
</span><a name="line-1971"></a><span>                        </span><span class="hs-operator hs-var">$$</span><span> </span><a href="Check.html#pprValVecDebug"><span class="hs-identifier hs-var">pprValVecDebug</span></a><span> </span><a href="#local-6989586621683964530"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span>
</span><a name="line-1972"></a><span>
</span><a name="line-1973"></a><span>  </span><a name="local-6989586621683964532"><a href="#local-6989586621683964532"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmcheckHd"><span class="hs-identifier hs-var">pmcheckHd</span></a><span> </span><a href="#local-6989586621683964526"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621683964527"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964528"><span class="hs-identifier hs-var">guards</span></a><span> </span><a href="#local-6989586621683964529"><span class="hs-identifier hs-var">va</span></a><span> </span><a href="#local-6989586621683964530"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-1974"></a><span>  </span><a href="Check.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a><span> </span><span class="hs-string">&quot;pmCheckHdI: res&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964532"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1975"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621683964532"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1976"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">pmcheckHdI</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1977"></a><span>
</span><a name="line-1978"></a><span class="hs-comment">-- | Matching function: Check simultaneously a clause (takes separately the</span><span>
</span><a name="line-1979"></a><span class="hs-comment">-- patterns and the list of guards) for exhaustiveness, redundancy and</span><span>
</span><a name="line-1980"></a><span class="hs-comment">-- inaccessibility.</span><span>
</span><a name="line-1981"></a><span class="hs-identifier">pmcheck</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-1982"></a><a name="pmcheck"><a href="Check.html#pmcheck"><span class="hs-identifier">pmcheck</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621683964533"><a href="#local-6989586621683964533"><span class="hs-identifier">guards</span></a></a><span> </span><a name="local-6989586621683964534"><a href="#local-6989586621683964534"><span class="hs-identifier">vva</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1983"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964533"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">presultCovered</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#Covered"><span class="hs-identifier hs-var">Covered</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1984"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#pmcheckGuardsI"><span class="hs-identifier hs-var">pmcheckGuardsI</span></a><span> </span><a href="#local-6989586621683964533"><span class="hs-identifier hs-var">guards</span></a><span> </span><a href="#local-6989586621683964534"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-1985"></a><span>
</span><a name="line-1986"></a><span class="hs-comment">-- Guard</span><span>
</span><a name="line-1987"></a><span class="hs-identifier">pmcheck</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964535"><a href="#local-6989586621683964535"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><a name="local-6989586621683964536"><a href="#local-6989586621683964536"><span class="hs-identifier">pv</span></a></a><span> </span><a name="local-6989586621683964537"><a href="#local-6989586621683964537"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621683964538"><a href="#local-6989586621683964538"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964539"><a href="#local-6989586621683964539"><span class="hs-identifier">guards</span></a></a><span> </span><a name="local-6989586621683964540"><a href="#local-6989586621683964540"><span class="hs-identifier">vva</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964541"><a href="#local-6989586621683964541"><span class="hs-identifier">vas</span></a></a><span> </span><a name="local-6989586621683964542"><a href="#local-6989586621683964542"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1988"></a><span>    </span><span class="hs-comment">-- short-circuit if the guard pattern is useless.</span><span>
</span><a name="line-1989"></a><span>    </span><span class="hs-comment">-- we just have two possible outcomes: fail here or match and recurse</span><span>
</span><a name="line-1990"></a><span>    </span><span class="hs-comment">-- none of the two contains any useful information about the failure</span><span>
</span><a name="line-1991"></a><span>    </span><span class="hs-comment">-- though. So just have these two cases but do not do all the boilerplate</span><span>
</span><a name="line-1992"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#isFakeGuard"><span class="hs-identifier hs-var">isFakeGuard</span></a><span> </span><a href="#local-6989586621683964536"><span class="hs-identifier hs-var">pv</span></a><span> </span><a href="#local-6989586621683964537"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#forces"><span class="hs-identifier hs-var">forces</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Check.html#mkCons"><span class="hs-identifier hs-var">mkCons</span></a><span> </span><a href="#local-6989586621683964540"><span class="hs-identifier hs-var">vva</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><a href="#local-6989586621683964538"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964539"><span class="hs-identifier hs-var">guards</span></a><span> </span><a href="#local-6989586621683964540"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-1993"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1994"></a><span>      </span><a name="local-6989586621683964543"><a href="#local-6989586621683964543"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#pmPatType"><span class="hs-identifier hs-var">pmPatType</span></a><span> </span><a href="#local-6989586621683964535"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1995"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964544"><a href="#local-6989586621683964544"><span class="hs-identifier">tm_state</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TmOracle.html#extendSubst"><span class="hs-identifier hs-var">extendSubst</span></a><span> </span><a href="#local-6989586621683964543"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621683964537"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964542"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-1996"></a><span>          </span><a name="local-6989586621683964545"><a href="#local-6989586621683964545"><span class="hs-identifier">delta'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964542"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964544"><span class="hs-identifier hs-var">tm_state</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1997"></a><span>      </span><a href="Check.html#utail"><span class="hs-identifier hs-var">utail</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964536"><span class="hs-identifier hs-var">pv</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683964538"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964539"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a href="#local-6989586621683964543"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621683964541"><span class="hs-identifier hs-var">vas</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964545"><span class="hs-identifier hs-var">delta'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1998"></a><span>
</span><a name="line-1999"></a><span class="hs-identifier">pmcheck</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;pmcheck: nil-cons&quot;</span><span>
</span><a name="line-2000"></a><span class="hs-identifier">pmcheck</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;pmcheck: cons-nil&quot;</span><span>
</span><a name="line-2001"></a><span>
</span><a name="line-2002"></a><span class="hs-identifier">pmcheck</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964546"><a href="#local-6989586621683964546"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683964547"><a href="#local-6989586621683964547"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964548"><a href="#local-6989586621683964548"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964549"><a href="#local-6989586621683964549"><span class="hs-identifier">va</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683964550"><a href="#local-6989586621683964550"><span class="hs-identifier">vva</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964551"><a href="#local-6989586621683964551"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2003"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#pmcheckHdI"><span class="hs-identifier hs-var">pmcheckHdI</span></a><span> </span><a href="#local-6989586621683964546"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621683964547"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964548"><span class="hs-identifier hs-var">guards</span></a><span> </span><a href="#local-6989586621683964549"><span class="hs-identifier hs-var">va</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a href="#local-6989586621683964550"><span class="hs-identifier hs-var">vva</span></a><span> </span><a href="#local-6989586621683964551"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-2004"></a><span>
</span><a name="line-2005"></a><span class="hs-comment">-- | Check the list of guards</span><span>
</span><a name="line-2006"></a><span class="hs-identifier">pmcheckGuards</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2007"></a><a name="pmcheckGuards"><a href="Check.html#pmcheckGuards"><span class="hs-identifier">pmcheckGuards</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><a name="local-6989586621683964552"><a href="#local-6989586621683964552"><span class="hs-identifier">vva</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Check.html#usimple"><span class="hs-identifier hs-var">usimple</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964552"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2008"></a><span class="hs-identifier">pmcheckGuards</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964553"><a href="#local-6989586621683964553"><span class="hs-identifier">gv</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621683964554"><a href="#local-6989586621683964554"><span class="hs-identifier">gvs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964555"><a href="#local-6989586621683964555"><span class="hs-identifier">vva</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2009"></a><span>  </span><span class="hs-special">(</span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><a name="local-6989586621683964556"><a href="#local-6989586621683964556"><span class="hs-identifier">prov1</span></a></a><span> </span><a name="local-6989586621683964557"><a href="#local-6989586621683964557"><span class="hs-identifier">cs</span></a></a><span> </span><a name="local-6989586621683964558"><a href="#local-6989586621683964558"><span class="hs-identifier">vsa</span></a></a><span> </span><a name="local-6989586621683964559"><a href="#local-6989586621683964559"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><a href="#local-6989586621683964553"><span class="hs-identifier hs-var">gv</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621683964555"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-2010"></a><span>  </span><span class="hs-special">(</span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><a name="local-6989586621683964560"><a href="#local-6989586621683964560"><span class="hs-identifier">prov2</span></a></a><span> </span><a name="local-6989586621683964561"><a href="#local-6989586621683964561"><span class="hs-identifier">css</span></a></a><span> </span><a name="local-6989586621683964562"><a href="#local-6989586621683964562"><span class="hs-identifier">vsas</span></a></a><span> </span><a name="local-6989586621683964563"><a href="#local-6989586621683964563"><span class="hs-identifier">dss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#runMany"><span class="hs-identifier hs-var">runMany</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#pmcheckGuardsI"><span class="hs-identifier hs-var">pmcheckGuardsI</span></a><span> </span><a href="#local-6989586621683964554"><span class="hs-identifier hs-var">gvs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964558"><span class="hs-identifier hs-var">vsa</span></a><span>
</span><a name="line-2011"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964556"><span class="hs-identifier hs-var">prov1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964560"><span class="hs-identifier hs-var">prov2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2012"></a><span>                         </span><span class="hs-special">(</span><a href="#local-6989586621683964557"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964561"><span class="hs-identifier hs-var">css</span></a><span class="hs-special">)</span><span>
</span><a name="line-2013"></a><span>                         </span><a href="#local-6989586621683964562"><span class="hs-identifier hs-var">vsas</span></a><span>
</span><a name="line-2014"></a><span>                         </span><span class="hs-special">(</span><a href="#local-6989586621683964559"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964563"><span class="hs-identifier hs-var">dss</span></a><span class="hs-special">)</span><span>
</span><a name="line-2015"></a><span>
</span><a name="line-2016"></a><span class="hs-comment">-- | Worker function: Implements all cases described in the paper for all three</span><span>
</span><a name="line-2017"></a><span class="hs-comment">-- functions (`covered`, `uncovered` and `divergent`) apart from the `Guard`</span><span>
</span><a name="line-2018"></a><span class="hs-comment">-- cases which are handled by `pmcheck`</span><span>
</span><a name="line-2019"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span>
</span><a name="line-2020"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2021"></a><span>
</span><a name="line-2022"></a><span class="hs-comment">-- Var</span><span>
</span><a name="line-2023"></a><a name="pmcheckHd"><a href="Check.html#pmcheckHd"><span class="hs-identifier">pmcheckHd</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a name="local-6989586621683964564"><a href="#local-6989586621683964564"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964565"><a href="#local-6989586621683964565"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964566"><a href="#local-6989586621683964566"><span class="hs-identifier">guards</span></a></a><span> </span><a name="local-6989586621683964567"><a href="#local-6989586621683964567"><span class="hs-identifier">va</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964568"><a href="#local-6989586621683964568"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964569"><a href="#local-6989586621683964569"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2024"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964570"><a href="#local-6989586621683964570"><span class="hs-identifier">tm_state</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TmOracle.html#solveOneEq"><span class="hs-identifier hs-var">solveOneEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964569"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-2025"></a><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PmExprVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964564"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Check.html#vaToPmExpr"><span class="hs-identifier hs-var">vaToPmExpr</span></a><span> </span><a href="#local-6989586621683964567"><span class="hs-identifier hs-var">va</span></a><span class="hs-special">)</span><span>
</span><a name="line-2026"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#ucon"><span class="hs-identifier hs-var">ucon</span></a><span> </span><a href="#local-6989586621683964567"><span class="hs-identifier hs-var">va</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><a href="#local-6989586621683964565"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964566"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a href="#local-6989586621683964568"><span class="hs-identifier hs-var">vva</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964569"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964570"><span class="hs-identifier hs-var">tm_state</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2027"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-2028"></a><span>
</span><a name="line-2029"></a><span class="hs-comment">-- ConCon</span><span>
</span><a name="line-2030"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><span> </span><a name="local-6989586621683964571"><a href="#local-6989586621683964571"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964572"><a href="#local-6989586621683964572"><span class="hs-identifier">c1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964573"><a href="#local-6989586621683964573"><span class="hs-identifier">ex_tvs1</span></a></a><span>
</span><a name="line-2031"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964574"><a href="#local-6989586621683964574"><span class="hs-identifier">args1</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964575"><a href="#local-6989586621683964575"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964576"><a href="#local-6989586621683964576"><span class="hs-identifier">guards</span></a></a><span>
</span><a name="line-2032"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621683964577"><a href="#local-6989586621683964577"><span class="hs-identifier">va</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964578"><a href="#local-6989586621683964578"><span class="hs-identifier">c2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964579"><a href="#local-6989586621683964579"><span class="hs-identifier">ex_tvs2</span></a></a><span>
</span><a name="line-2033"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964580"><a href="#local-6989586621683964580"><span class="hs-identifier">args2</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964581"><a href="#local-6989586621683964581"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964582"><a href="#local-6989586621683964582"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2034"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964572"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621683964578"><span class="hs-identifier hs-var">c2</span></a><span>  </span><span class="hs-glyph">=</span><span>
</span><a name="line-2035"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Check.html#usimple"><span class="hs-identifier hs-var">usimple</span></a><span> </span><span class="hs-special">[</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964577"><span class="hs-identifier hs-var">va</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964581"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964582"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2036"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2037"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964583"><a href="#local-6989586621683964583"><span class="hs-identifier">to_evvar</span></a></a><span> </span><a name="local-6989586621683964585"><a href="#local-6989586621683964585"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-6989586621683964586"><a href="#local-6989586621683964586"><span class="hs-identifier">tv2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#nameType"><span class="hs-identifier hs-var">nameType</span></a><span> </span><span class="hs-string">&quot;pmConCon&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2038"></a><span>                           </span><span class="hs-identifier hs-var">mkPrimEqPred</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarTy</span><span> </span><a href="#local-6989586621683964585"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarTy</span><span> </span><a href="#local-6989586621683964586"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2039"></a><span>        </span><a name="local-6989586621683964584"><a href="#local-6989586621683964584"><span class="hs-identifier">mb_to_evvar</span></a></a><span> </span><a name="local-6989586621683964587"><a href="#local-6989586621683964587"><span class="hs-identifier">tv1</span></a></a><span> </span><a name="local-6989586621683964588"><a href="#local-6989586621683964588"><span class="hs-identifier">tv2</span></a></a><span>
</span><a name="line-2040"></a><span>            </span><span class="hs-comment">-- If we have identical constructors but different existential</span><span>
</span><a name="line-2041"></a><span>            </span><span class="hs-comment">-- tyvars, then generate extra equality constraints to ensure the</span><span>
</span><a name="line-2042"></a><span>            </span><span class="hs-comment">-- existential tyvars.</span><span>
</span><a name="line-2043"></a><span>            </span><span class="hs-comment">-- See Note [Coverage checking and existential tyvars].</span><span>
</span><a name="line-2044"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964587"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621683964588"><span class="hs-identifier hs-var">tv2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2045"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621683964583"><span class="hs-identifier hs-var">to_evvar</span></a><span> </span><a href="#local-6989586621683964587"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621683964588"><span class="hs-identifier hs-var">tv2</span></a><span>
</span><a name="line-2046"></a><span>    </span><a name="local-6989586621683964589"><a href="#local-6989586621683964589"><span class="hs-identifier">evvars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-2047"></a><span>              </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">ex_tvs1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">ex_tvs2</span><span class="hs-special">)</span><span>
</span><a name="line-2048"></a><span>              </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWithM</span><span> </span><a href="#local-6989586621683964584"><span class="hs-identifier hs-var">mb_to_evvar</span></a><span> </span><a href="#local-6989586621683964573"><span class="hs-identifier hs-var">ex_tvs1</span></a><span> </span><a href="#local-6989586621683964579"><span class="hs-identifier hs-var">ex_tvs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2049"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964590"><a href="#local-6989586621683964590"><span class="hs-identifier">delta'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964582"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_ty_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964589"><span class="hs-identifier hs-var">evvars</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unionBags</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">delta_ty_cs</span><span> </span><a href="#local-6989586621683964582"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2050"></a><span>    </span><a href="Check.html#kcon"><span class="hs-identifier hs-var">kcon</span></a><span> </span><a href="#local-6989586621683964572"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><a href="#local-6989586621683964571"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pm_con_tvs</span><span> </span><a href="#local-6989586621683964571"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pm_con_dicts</span><span> </span><a href="#local-6989586621683964571"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-2051"></a><span>      </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964574"><span class="hs-identifier hs-var">args1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683964575"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964576"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964580"><span class="hs-identifier hs-var">args2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621683964581"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964590"><span class="hs-identifier hs-var">delta'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2052"></a><span>
</span><a name="line-2053"></a><span class="hs-comment">-- LitLit</span><span>
</span><a name="line-2054"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a name="local-6989586621683964591"><a href="#local-6989586621683964591"><span class="hs-identifier">l1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964592"><a href="#local-6989586621683964592"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964593"><a href="#local-6989586621683964593"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964594"><a href="#local-6989586621683964594"><span class="hs-identifier">va</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a name="local-6989586621683964595"><a href="#local-6989586621683964595"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964596"><a href="#local-6989586621683964596"><span class="hs-identifier">vva</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2055"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">eqPmLit</span><span> </span><a href="#local-6989586621683964591"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621683964595"><span class="hs-identifier hs-var">l2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2056"></a><span>    </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ucon"><span class="hs-identifier hs-var">ucon</span></a><span> </span><a href="#local-6989586621683964594"><span class="hs-identifier hs-var">va</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><a href="#local-6989586621683964592"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964593"><span class="hs-identifier hs-var">guards</span></a><span> </span><a href="#local-6989586621683964596"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-2057"></a><span>    </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#ucon"><span class="hs-identifier hs-var">ucon</span></a><span> </span><a href="#local-6989586621683964594"><span class="hs-identifier hs-var">va</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#usimple"><span class="hs-identifier hs-var">usimple</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964596"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2058"></a><span>
</span><a name="line-2059"></a><span class="hs-comment">-- ConVar</span><span>
</span><a name="line-2060"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964597"><a href="#local-6989586621683964597"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964598"><a href="#local-6989586621683964598"><span class="hs-identifier">con</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964599"><a href="#local-6989586621683964599"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2061"></a><span>          </span><a name="local-6989586621683964600"><a href="#local-6989586621683964600"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964601"><a href="#local-6989586621683964601"><span class="hs-identifier">guards</span></a></a><span>
</span><a name="line-2062"></a><span>          </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a name="local-6989586621683964602"><a href="#local-6989586621683964602"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964603"><a href="#local-6989586621683964603"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964604"><a href="#local-6989586621683964604"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2063"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621683964605"><a href="#local-6989586621683964605"><span class="hs-identifier">prov</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964606"><a href="#local-6989586621683964606"><span class="hs-identifier">complete_match</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ListT.html#select"><span class="hs-identifier hs-var">select</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#allCompleteMatches"><span class="hs-identifier hs-var">allCompleteMatches</span></a><span> </span><a href="#local-6989586621683964598"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621683964599"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2064"></a><span>
</span><a name="line-2065"></a><span>  </span><a name="local-6989586621683964607"><a href="#local-6989586621683964607"><span class="hs-identifier">cons_cs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Check.html#mkOneConFull"><span class="hs-identifier hs-var">mkOneConFull</span></a><span> </span><a href="#local-6989586621683964602"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964606"><span class="hs-identifier hs-var">complete_match</span></a><span>
</span><a name="line-2066"></a><span>
</span><a name="line-2067"></a><span>  </span><a name="local-6989586621683964613"><a href="#local-6989586621683964613"><span class="hs-identifier">inst_vsa</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">mapMaybeM</span><span> </span><a href="#local-6989586621683964607"><span class="hs-identifier hs-var">cons_cs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2068"></a><span>      </span><span class="hs-glyph">\</span><a href="Check.html#InhabitationCandidate"><span class="hs-identifier hs-var">InhabitationCandidate</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_val_abs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964608"><a href="#local-6989586621683964608"><span class="hs-identifier">va</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_tm_ct</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964609"><a href="#local-6989586621683964609"><span class="hs-identifier">tm_ct</span></a></a><span>
</span><a name="line-2069"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_ty_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964610"><a href="#local-6989586621683964610"><span class="hs-identifier">ty_cs</span></a></a><span>
</span><a name="line-2070"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_strict_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964611"><a href="#local-6989586621683964611"><span class="hs-identifier">strict_arg_tys</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2071"></a><span>    </span><a name="local-6989586621683964612"><a href="#local-6989586621683964612"><span class="hs-identifier">mb_sat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#pmIsSatisfiable"><span class="hs-identifier hs-var">pmIsSatisfiable</span></a><span> </span><a href="#local-6989586621683964604"><span class="hs-identifier hs-var">delta</span></a><span> </span><a href="#local-6989586621683964609"><span class="hs-identifier hs-var">tm_ct</span></a><span> </span><a href="#local-6989586621683964610"><span class="hs-identifier hs-var">ty_cs</span></a><span> </span><a href="#local-6989586621683964611"><span class="hs-identifier hs-var">strict_arg_tys</span></a><span>
</span><a name="line-2072"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964608"><span class="hs-identifier hs-var">va</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964603"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964612"><span class="hs-identifier hs-var">mb_sat</span></a><span>
</span><a name="line-2073"></a><span>
</span><a name="line-2074"></a><span>  </span><a href="Check.html#set_provenance"><span class="hs-identifier hs-var">set_provenance</span></a><span> </span><a href="#local-6989586621683964605"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-2075"></a><span>    </span><a href="Check.html#force_if"><span class="hs-identifier hs-var">force_if</span></a><span> </span><span class="hs-special">(</span><a href="TmOracle.html#canDiverge"><span class="hs-identifier hs-var">canDiverge</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964602"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964604"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-2076"></a><span>      </span><a href="Check.html#runMany"><span class="hs-identifier hs-var">runMany</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#pmcheckI"><span class="hs-identifier hs-var">pmcheckI</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964597"><span class="hs-identifier hs-var">p</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964600"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964601"><span class="hs-identifier hs-var">guards</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964613"><span class="hs-identifier hs-var">inst_vsa</span></a><span>
</span><a name="line-2077"></a><span>
</span><a name="line-2078"></a><span class="hs-comment">-- LitVar</span><span>
</span><a name="line-2079"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964614"><a href="#local-6989586621683964614"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a name="local-6989586621683964615"><a href="#local-6989586621683964615"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964616"><a href="#local-6989586621683964616"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964617"><a href="#local-6989586621683964617"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a name="local-6989586621683964618"><a href="#local-6989586621683964618"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964619"><a href="#local-6989586621683964619"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964620"><a href="#local-6989586621683964620"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2080"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#force_if"><span class="hs-identifier hs-var">force_if</span></a><span> </span><span class="hs-special">(</span><a href="TmOracle.html#canDiverge"><span class="hs-identifier hs-var">canDiverge</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621683964618"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964620"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-2081"></a><span>      </span><a href="Check.html#mkUnion"><span class="hs-identifier hs-var">mkUnion</span></a><span> </span><a href="#local-6989586621683964622"><span class="hs-identifier hs-var">non_matched</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-2082"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="TmOracle.html#solveOneEq"><span class="hs-identifier hs-var">solveOneEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964620"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#mkPosEq"><span class="hs-identifier hs-var">mkPosEq</span></a><span> </span><a href="#local-6989586621683964618"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621683964615"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2083"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964624"><a href="#local-6989586621683964624"><span class="hs-identifier">tm_state</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#pmcheckHdI"><span class="hs-identifier hs-var">pmcheckHdI</span></a><span> </span><a href="#local-6989586621683964614"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621683964616"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964617"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a href="#local-6989586621683964615"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2084"></a><span>                             </span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a href="#local-6989586621683964619"><span class="hs-identifier hs-var">vva</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964620"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964624"><span class="hs-identifier hs-var">tm_state</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2085"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-2086"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2087"></a><span>    </span><a name="local-6989586621683964621"><a href="#local-6989586621683964621"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964623"><a href="#local-6989586621683964623"><span class="hs-identifier">tm_state</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TmOracle.html#solveOneEq"><span class="hs-identifier hs-var">solveOneEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964620"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#mkNegEq"><span class="hs-identifier hs-var">mkNegEq</span></a><span> </span><a href="#local-6989586621683964618"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621683964615"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-2088"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmNLit"><span class="hs-identifier hs-var">PmNLit</span></a><span> </span><a href="#local-6989586621683964618"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964615"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621683964619"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964620"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964623"><span class="hs-identifier hs-var">tm_state</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2089"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2090"></a><span>
</span><a name="line-2091"></a><span>    </span><a name="local-6989586621683964622"><a href="#local-6989586621683964622"><span class="hs-identifier">non_matched</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#usimple"><span class="hs-identifier hs-var">usimple</span></a><span> </span><a href="#local-6989586621683964621"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-2092"></a><span>
</span><a name="line-2093"></a><span class="hs-comment">-- LitNLit</span><span>
</span><a name="line-2094"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964625"><a href="#local-6989586621683964625"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a name="local-6989586621683964626"><a href="#local-6989586621683964626"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964627"><a href="#local-6989586621683964627"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964628"><a href="#local-6989586621683964628"><span class="hs-identifier">guards</span></a></a><span>
</span><a name="line-2095"></a><span>          </span><span class="hs-special">(</span><a href="Check.html#PmNLit"><span class="hs-identifier hs-var">PmNLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964629"><a href="#local-6989586621683964629"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_lit_not</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964630"><a href="#local-6989586621683964630"><span class="hs-identifier">lits</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964631"><a href="#local-6989586621683964631"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964632"><a href="#local-6989586621683964632"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2096"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">eqPmLit</span><span> </span><a href="#local-6989586621683964626"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964630"><span class="hs-identifier hs-var">lits</span></a><span>
</span><a name="line-2097"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964636"><a href="#local-6989586621683964636"><span class="hs-identifier">tm_state</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TmOracle.html#solveOneEq"><span class="hs-identifier hs-var">solveOneEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964632"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#mkPosEq"><span class="hs-identifier hs-var">mkPosEq</span></a><span> </span><a href="#local-6989586621683964629"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621683964626"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-2098"></a><span>    </span><span class="hs-comment">-- Both guards check the same so it would be sufficient to have only</span><span>
</span><a name="line-2099"></a><span>    </span><span class="hs-comment">-- the second one. Nevertheless, it is much cheaper to check whether</span><span>
</span><a name="line-2100"></a><span>    </span><span class="hs-comment">-- the literal is in the list so we check it first, to avoid calling</span><span>
</span><a name="line-2101"></a><span>    </span><span class="hs-comment">-- the term oracle (`solveOneEq`) if possible</span><span>
</span><a name="line-2102"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#mkUnion"><span class="hs-identifier hs-var">mkUnion</span></a><span> </span><a href="#local-6989586621683964634"><span class="hs-identifier hs-var">non_matched</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-2103"></a><span>      </span><a href="Check.html#pmcheckHdI"><span class="hs-identifier hs-var">pmcheckHdI</span></a><span> </span><a href="#local-6989586621683964625"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621683964627"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964628"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a href="#local-6989586621683964626"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-2104"></a><span>                </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a href="#local-6989586621683964631"><span class="hs-identifier hs-var">vva</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964632"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964636"><span class="hs-identifier hs-var">tm_state</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2105"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621683964634"><span class="hs-identifier hs-var">non_matched</span></a><span>
</span><a name="line-2106"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2107"></a><span>    </span><a name="local-6989586621683964633"><a href="#local-6989586621683964633"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964635"><a href="#local-6989586621683964635"><span class="hs-identifier">tm_state</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TmOracle.html#solveOneEq"><span class="hs-identifier hs-var">solveOneEq</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964632"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#mkNegEq"><span class="hs-identifier hs-var">mkNegEq</span></a><span> </span><a href="#local-6989586621683964629"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621683964626"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-2108"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmNLit"><span class="hs-identifier hs-var">PmNLit</span></a><span> </span><a href="#local-6989586621683964629"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964626"><span class="hs-identifier hs-var">l</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964630"><span class="hs-identifier hs-var">lits</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621683964631"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964632"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964635"><span class="hs-identifier hs-var">tm_state</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2109"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2110"></a><span>
</span><a name="line-2111"></a><span>    </span><a name="local-6989586621683964634"><a href="#local-6989586621683964634"><span class="hs-identifier">non_matched</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#usimple"><span class="hs-identifier hs-var">usimple</span></a><span> </span><a href="#local-6989586621683964633"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-2112"></a><span>
</span><a name="line-2113"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-2114"></a><span class="hs-comment">-- The following three can happen only in cases like #322 where constructors</span><span>
</span><a name="line-2115"></a><span class="hs-comment">-- and overloaded literals appear in the same match. The general strategy is</span><span>
</span><a name="line-2116"></a><span class="hs-comment">-- to replace the literal (positive/negative) by a variable and recurse. The</span><span>
</span><a name="line-2117"></a><span class="hs-comment">-- fact that the variable is equal to the literal is recorded in `delta` so</span><span>
</span><a name="line-2118"></a><span class="hs-comment">-- no information is lost</span><span>
</span><a name="line-2119"></a><span>
</span><a name="line-2120"></a><span class="hs-comment">-- LitCon</span><span>
</span><a name="line-2121"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a name="local-6989586621683964637"><a href="#local-6989586621683964637"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964638"><a href="#local-6989586621683964638"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964639"><a href="#local-6989586621683964639"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964640"><a href="#local-6989586621683964640"><span class="hs-identifier">va</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964641"><a href="#local-6989586621683964641"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964642"><a href="#local-6989586621683964642"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2122"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621683964643"><a href="#local-6989586621683964643"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#pmPatType"><span class="hs-identifier hs-var">pmPatType</span></a><span> </span><a href="#local-6989586621683964640"><span class="hs-identifier hs-var">va</span></a><span class="hs-special">)</span><span>
</span><a name="line-2123"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964644"><a href="#local-6989586621683964644"><span class="hs-identifier">tm_state</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TmOracle.html#extendSubst"><span class="hs-identifier hs-var">extendSubst</span></a><span> </span><a href="#local-6989586621683964643"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PmExprLit</span><span> </span><a href="#local-6989586621683964637"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964642"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-2124"></a><span>           </span><a name="local-6989586621683964645"><a href="#local-6989586621683964645"><span class="hs-identifier">delta'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964642"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964644"><span class="hs-identifier hs-var">tm_state</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2125"></a><span>       </span><a href="Check.html#pmcheckHdI"><span class="hs-identifier hs-var">pmcheckHdI</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a href="#local-6989586621683964643"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964638"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964639"><span class="hs-identifier hs-var">guards</span></a><span> </span><a href="#local-6989586621683964640"><span class="hs-identifier hs-var">va</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a href="#local-6989586621683964641"><span class="hs-identifier hs-var">vva</span></a><span> </span><a href="#local-6989586621683964645"><span class="hs-identifier hs-var">delta'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2126"></a><span>
</span><a name="line-2127"></a><span class="hs-comment">-- ConLit</span><span>
</span><a name="line-2128"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964646"><a href="#local-6989586621683964646"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964647"><a href="#local-6989586621683964647"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964648"><a href="#local-6989586621683964648"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a name="local-6989586621683964649"><a href="#local-6989586621683964649"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964650"><a href="#local-6989586621683964650"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964651"><a href="#local-6989586621683964651"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2129"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621683964652"><a href="#local-6989586621683964652"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#pmPatType"><span class="hs-identifier hs-var">pmPatType</span></a><span> </span><a href="#local-6989586621683964646"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-2130"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964653"><a href="#local-6989586621683964653"><span class="hs-identifier">tm_state</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TmOracle.html#extendSubst"><span class="hs-identifier hs-var">extendSubst</span></a><span> </span><a href="#local-6989586621683964652"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PmExprLit</span><span> </span><a href="#local-6989586621683964649"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964651"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-2131"></a><span>           </span><a name="local-6989586621683964654"><a href="#local-6989586621683964654"><span class="hs-identifier">delta'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964651"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delta_tm_cs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964653"><span class="hs-identifier hs-var">tm_state</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2132"></a><span>       </span><a href="Check.html#pmcheckHdI"><span class="hs-identifier hs-var">pmcheckHdI</span></a><span> </span><a href="#local-6989586621683964646"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621683964647"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964648"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a href="#local-6989586621683964652"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a href="#local-6989586621683964650"><span class="hs-identifier hs-var">vva</span></a><span> </span><a href="#local-6989586621683964654"><span class="hs-identifier hs-var">delta'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2133"></a><span>
</span><a name="line-2134"></a><span class="hs-comment">-- ConNLit</span><span>
</span><a name="line-2135"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964655"><a href="#local-6989586621683964655"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964656"><a href="#local-6989586621683964656"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621683964657"><a href="#local-6989586621683964657"><span class="hs-identifier">guards</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmNLit"><span class="hs-identifier hs-var">PmNLit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_lit_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964658"><a href="#local-6989586621683964658"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621683964659"><a href="#local-6989586621683964659"><span class="hs-identifier">vva</span></a></a><span>
</span><a name="line-2136"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#pmcheckHdI"><span class="hs-identifier hs-var">pmcheckHdI</span></a><span> </span><a href="#local-6989586621683964655"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621683964656"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621683964657"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a href="#local-6989586621683964658"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964659"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-2137"></a><span>
</span><a name="line-2138"></a><span class="hs-comment">-- Impossible: handled by pmcheck</span><span>
</span><a name="line-2139"></a><span class="hs-identifier">pmcheckHd</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;pmcheckHd: Guard&quot;</span><span>
</span><a name="line-2140"></a><span>
</span><a name="line-2141"></a><span class="hs-comment">{-
Note [Coverage checking and existential tyvars]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
GHC's implementation of the pattern-match coverage algorithm (as described in
the GADTs Meet Their Match paper) must take some care to emit enough type
constraints when handling data constructors with exisentially quantified type
variables. To better explain what the challenge is, consider a constructor K
of the form:

  K @e_1 ... @e_m ev_1 ... ev_v ty_1 ... ty_n :: T u_1 ... u_p

Where:

* e_1, ..., e_m are the existentially bound type variables.
* ev_1, ..., ev_v are evidence variables, which may inhabit a dictionary type
  (e.g., Eq) or an equality constraint (e.g., e_1 ~ Int).
* ty_1, ..., ty_n are the types of K's fields.
* T u_1 ... u_p is the return type, where T is the data type constructor, and
  u_1, ..., u_p are the universally quantified type variables.

In the ConVar case, the coverage algorithm will have in hand the constructor
K as well as a pattern variable (pv :: T PV_1 ... PV_p), where PV_1, ..., PV_p
are some types that instantiate u_1, ... u_p. The idea is that we should
substitute PV_1 for u_1, ..., and PV_p for u_p when forming a PmCon (the
mkOneConFull function accomplishes this) and then hand this PmCon off to the
ConCon case.

The presence of existentially quantified type variables adds a significant
wrinkle. We always grab e_1, ..., e_m from the definition of K to begin with,
but we don't want them to appear in the final PmCon, because then
calling (mkOneConFull K) for other pattern variables might reuse the same
existential tyvars, which is certainly wrong.

Previously, GHC's solution to this wrinkle was to always create fresh names
for the existential tyvars and put them into the PmCon. This works well for
many cases, but it can break down if you nest GADT pattern matches in just
the right way. For instance, consider the following program:

    data App f a where
      App :: f a -&gt; App f (Maybe a)

    data Ty a where
      TBool :: Ty Bool
      TInt  :: Ty Int

    data T f a where
      C :: T Ty (Maybe Bool)

    foo :: T f a -&gt; App f a -&gt; ()
    foo C (App TBool) = ()

foo is a total program, but with the previous approach to handling existential
tyvars, GHC would mark foo's patterns as non-exhaustive.

When foo is desugared to Core, it looks roughly like so:

    foo @f @a (C co1 _co2) (App @a1 _co3 (TBool |&gt; co1)) = ()

(Where `a1` is an existential tyvar.)

That, in turn, is processed by the coverage checker to become:

    foo @f @a (C co1 _co2) (App @a1 _co3 (pmvar123 :: f a1))
      | TBool &lt;- pmvar123 |&gt; co1
      = ()

Note that the type of pmvar123 is `f a1`&#8212;this will be important later.

Now, we proceed with coverage-checking as usual. When we come to the
ConVar case for App, we create a fresh variable `a2` to represent its
existential tyvar. At this point, we have the equality constraints
`(a ~ Maybe a2, a ~ Maybe Bool, f ~ Ty)` in scope.

However, when we check the guard, it will use the type of pmvar123, which is
`f a1`. Thus, when considering if pmvar123 can match the constructor TInt,
it will generate the constraint `a1 ~ Int`. This means our final set of
equality constraints would be:

    f  ~ Ty
    a  ~ Maybe Bool
    a  ~ Maybe a2
    a1 ~ Int

Which is satisfiable! Freshening the existential tyvar `a` to `a2` doomed us,
because GHC is unable to relate `a2` to `a1`, which really should be the same
tyvar.

Luckily, we can avoid this pitfall. Recall that the ConVar case was where we
generated a PmCon with too-fresh existentials. But after ConVar, we have the
ConCon case, which considers whether each constructor of a particular data type
can be matched on in a particular spot.

In the case of App, when we get to the ConCon case, we will compare our
original App PmCon (from the source program) to the App PmCon created from the
ConVar case. In the former PmCon, we have `a1` in hand, which is exactly the
existential tyvar we want! Thus, we can force `a1` to be the same as `a2` here
by emitting an additional `a1 ~ a2` constraint. Now our final set of equality
constraints will be:

    f  ~ Ty
    a  ~ Maybe Bool
    a  ~ Maybe a2
    a1 ~ Int
    a1 ~ a2

Which is unsatisfiable, as we desired, since we now have that
Int ~ a1 ~ a2 ~ Bool.

In general, App might have more than one constructor, in which case we
couldn't reuse the existential tyvar for App for a different constructor. This
means that we can only use this trick in ConCon when the constructors are the
same. But this is fine, since this is the only scenario where this situation
arises in the first place!
-}</span><span>
</span><a name="line-2255"></a><span>
</span><a name="line-2256"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-2257"></a><span class="hs-comment">-- * Utilities for main checking</span><span>
</span><a name="line-2258"></a><span>
</span><a name="line-2259"></a><span class="hs-identifier">updateVsa</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Check.html#ValSetAbs"><span class="hs-identifier hs-type">ValSetAbs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ValSetAbs"><span class="hs-identifier hs-type">ValSetAbs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-2260"></a><a name="updateVsa"><a href="Check.html#updateVsa"><span class="hs-identifier">updateVsa</span></a></a><span> </span><a name="local-6989586621683964660"><a href="#local-6989586621683964660"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621683964661"><a href="#local-6989586621683964661"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Check.html#PartialResult"><span class="hs-identifier hs-var">PartialResult</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">presultUncovered</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964662"><a href="#local-6989586621683964662"><span class="hs-identifier">old</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2261"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964661"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">presultUncovered</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964660"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621683964662"><span class="hs-identifier hs-var">old</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2262"></a><span>
</span><a name="line-2263"></a><span>
</span><a name="line-2264"></a><span class="hs-comment">-- | Initialise with default values for covering and divergent information.</span><span>
</span><a name="line-2265"></a><span class="hs-identifier">usimple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#ValSetAbs"><span class="hs-identifier hs-type">ValSetAbs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2266"></a><a name="usimple"><a href="Check.html#usimple"><span class="hs-identifier">usimple</span></a></a><span> </span><a name="local-6989586621683964663"><a href="#local-6989586621683964663"><span class="hs-identifier">vsa</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">presultUncovered</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964663"><span class="hs-identifier hs-var">vsa</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2267"></a><span>
</span><a name="line-2268"></a><span class="hs-comment">-- | Take the tail of all value vector abstractions in the uncovered set</span><span>
</span><a name="line-2269"></a><span class="hs-identifier">utail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2270"></a><a name="utail"><a href="Check.html#utail"><span class="hs-identifier">utail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#updateVsa"><span class="hs-identifier hs-var">updateVsa</span></a><span> </span><a href="#local-6989586621683964664"><span class="hs-identifier hs-var">upd</span></a><span>
</span><a name="line-2271"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621683964664"><a href="#local-6989586621683964664"><span class="hs-identifier">upd</span></a></a><span> </span><a name="local-6989586621683964665"><a href="#local-6989586621683964665"><span class="hs-identifier">vsa</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a href="#local-6989586621683964666"><span class="hs-identifier hs-var">vva</span></a><span> </span><a href="#local-6989586621683964667"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621683964666"><a href="#local-6989586621683964666"><span class="hs-identifier">vva</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964667"><a href="#local-6989586621683964667"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964665"><span class="hs-identifier hs-var">vsa</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2272"></a><span>
</span><a name="line-2273"></a><span class="hs-comment">-- | Prepend a value abstraction to all value vector abstractions in the</span><span>
</span><a name="line-2274"></a><span class="hs-comment">-- uncovered set</span><span>
</span><a name="line-2275"></a><span class="hs-identifier">ucon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2276"></a><a name="ucon"><a href="Check.html#ucon"><span class="hs-identifier">ucon</span></a></a><span> </span><a name="local-6989586621683964668"><a href="#local-6989586621683964668"><span class="hs-identifier">va</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#updateVsa"><span class="hs-identifier hs-var">updateVsa</span></a><span> </span><a href="#local-6989586621683964669"><span class="hs-identifier hs-var">upd</span></a><span>
</span><a name="line-2277"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2278"></a><span>    </span><a name="local-6989586621683964669"><a href="#local-6989586621683964669"><span class="hs-identifier">upd</span></a></a><span> </span><a name="local-6989586621683964670"><a href="#local-6989586621683964670"><span class="hs-identifier">vsa</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964668"><span class="hs-identifier hs-var">va</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964671"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964672"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964671"><a href="#local-6989586621683964671"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964672"><a href="#local-6989586621683964672"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964670"><span class="hs-identifier hs-var">vsa</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2279"></a><span>
</span><a name="line-2280"></a><span class="hs-comment">-- | Given a data constructor of arity `a` and an uncovered set containing</span><span>
</span><a name="line-2281"></a><span class="hs-comment">-- value vector abstractions of length `(a+n)`, pass the first `n` value</span><span>
</span><a name="line-2282"></a><span class="hs-comment">-- abstractions to the constructor (Hence, the resulting value vector</span><span>
</span><a name="line-2283"></a><span class="hs-comment">-- abstractions will have length `n+1`)</span><span>
</span><a name="line-2284"></a><span class="hs-identifier">kcon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConLike</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">EvVar</span><span class="hs-special">]</span><span>
</span><a name="line-2285"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2286"></a><a name="kcon"><a href="Check.html#kcon"><span class="hs-identifier">kcon</span></a></a><span> </span><a name="local-6989586621683964673"><a href="#local-6989586621683964673"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621683964674"><a href="#local-6989586621683964674"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-6989586621683964675"><a href="#local-6989586621683964675"><span class="hs-identifier">ex_tvs</span></a></a><span> </span><a name="local-6989586621683964676"><a href="#local-6989586621683964676"><span class="hs-identifier">dicts</span></a></a><span>
</span><a name="line-2287"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964677"><a href="#local-6989586621683964677"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">conLikeArity</span><span> </span><a href="#local-6989586621683964673"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-2288"></a><span>        </span><a name="local-6989586621683964678"><a href="#local-6989586621683964678"><span class="hs-identifier">upd</span></a></a><span> </span><a name="local-6989586621683964679"><a href="#local-6989586621683964679"><span class="hs-identifier">vsa</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2289"></a><span>          </span><span class="hs-special">[</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964684"><span class="hs-identifier hs-var">va</span></a><span class="hs-glyph">:</span><a href="#local-6989586621683964683"><span class="hs-identifier hs-var">vva</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621683964681"><span class="hs-identifier hs-var">delta</span></a><span>
</span><a name="line-2290"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964680"><a href="#local-6989586621683964680"><span class="hs-identifier">vva'</span></a></a><span> </span><a name="local-6989586621683964681"><a href="#local-6989586621683964681"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621683964679"><span class="hs-identifier hs-var">vsa</span></a><span>
</span><a name="line-2291"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964682"><a href="#local-6989586621683964682"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964683"><a href="#local-6989586621683964683"><span class="hs-identifier">vva</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621683964677"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621683964680"><span class="hs-identifier hs-var">vva'</span></a><span>
</span><a name="line-2292"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964684"><a href="#local-6989586621683964684"><span class="hs-identifier">va</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pm_con_con</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964673"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-2293"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964674"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-2294"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_tvs</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964675"><span class="hs-identifier hs-var">ex_tvs</span></a><span>
</span><a name="line-2295"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_dicts</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964676"><span class="hs-identifier hs-var">dicts</span></a><span>
</span><a name="line-2296"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pm_con_args</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964682"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2297"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="Check.html#updateVsa"><span class="hs-identifier hs-var">updateVsa</span></a><span> </span><a href="#local-6989586621683964678"><span class="hs-identifier hs-var">upd</span></a><span>
</span><a name="line-2298"></a><span>
</span><a name="line-2299"></a><span class="hs-comment">-- | Get the union of two covered, uncovered and divergent value set</span><span>
</span><a name="line-2300"></a><span class="hs-comment">-- abstractions. Since the covered and divergent sets are represented by a</span><span>
</span><a name="line-2301"></a><span class="hs-comment">-- boolean, union means computing the logical or (at least one of the two is</span><span>
</span><a name="line-2302"></a><span class="hs-comment">-- non-empty).</span><span>
</span><a name="line-2303"></a><span>
</span><a name="line-2304"></a><span class="hs-identifier">mkUnion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2305"></a><a name="mkUnion"><a href="Check.html#mkUnion"><span class="hs-identifier">mkUnion</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mappend</span><span>
</span><a name="line-2306"></a><span>
</span><a name="line-2307"></a><span class="hs-comment">-- | Add a value vector abstraction to a value set abstraction (uncovered).</span><span>
</span><a name="line-2308"></a><span class="hs-identifier">mkCons</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2309"></a><a name="mkCons"><a href="Check.html#mkCons"><span class="hs-identifier">mkCons</span></a></a><span> </span><a name="local-6989586621683964685"><a href="#local-6989586621683964685"><span class="hs-identifier">vva</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#updateVsa"><span class="hs-identifier hs-var">updateVsa</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964685"><span class="hs-identifier hs-var">vva</span></a><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-2310"></a><span>
</span><a name="line-2311"></a><span class="hs-comment">-- | Set the divergent set to not empty</span><span>
</span><a name="line-2312"></a><span class="hs-identifier">forces</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2313"></a><a name="forces"><a href="Check.html#forces"><span class="hs-identifier">forces</span></a></a><span> </span><a name="local-6989586621683964686"><a href="#local-6989586621683964686"><span class="hs-identifier">pres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964686"><span class="hs-identifier hs-var">pres</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">presultDivergent</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#Diverged"><span class="hs-identifier hs-var">Diverged</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2314"></a><span>
</span><a name="line-2315"></a><span class="hs-comment">-- | Set the divergent set to non-empty if the flag is `True`</span><span>
</span><a name="line-2316"></a><span class="hs-identifier">force_if</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2317"></a><a name="force_if"><a href="Check.html#force_if"><span class="hs-identifier">force_if</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a name="local-6989586621683964687"><a href="#local-6989586621683964687"><span class="hs-identifier">pres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#forces"><span class="hs-identifier hs-var">forces</span></a><span> </span><a href="#local-6989586621683964687"><span class="hs-identifier hs-var">pres</span></a><span>
</span><a name="line-2318"></a><span class="hs-identifier">force_if</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621683964688"><a href="#local-6989586621683964688"><span class="hs-identifier">pres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964688"><span class="hs-identifier hs-var">pres</span></a><span>
</span><a name="line-2319"></a><span>
</span><a name="line-2320"></a><span class="hs-identifier">set_provenance</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PartialResult"><span class="hs-identifier hs-type">PartialResult</span></a><span>
</span><a name="line-2321"></a><a name="set_provenance"><a href="Check.html#set_provenance"><span class="hs-identifier">set_provenance</span></a></a><span> </span><a name="local-6989586621683964689"><a href="#local-6989586621683964689"><span class="hs-identifier">prov</span></a></a><span> </span><a name="local-6989586621683964690"><a href="#local-6989586621683964690"><span class="hs-identifier">pr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964690"><span class="hs-identifier hs-var">pr</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">presultProvenance</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964689"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2322"></a><span>
</span><a name="line-2323"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-2324"></a><span class="hs-comment">-- * Propagation of term constraints inwards when checking nested matches</span><span>
</span><a name="line-2325"></a><span>
</span><a name="line-2326"></a><span class="hs-comment">{- Note [Type and Term Equality Propagation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When checking a match it would be great to have all type and term information
available so we can get more precise results. For this reason we have functions
`addDictsDs' and `addTmCsDs' in PmMonad that store in the environment type and
term constraints (respectively) as we go deeper.

The type constraints we propagate inwards are collected by `collectEvVarsPats'
in HsPat.hs. This handles bug #4139 ( see example
  https://ghc.haskell.org/trac/ghc/attachment/ticket/4139/GADTbug.hs )
where this is needed.

For term equalities we do less, we just generate equalities for HsCase. For
example we accurately give 2 redundancy warnings for the marked cases:

f :: [a] -&gt; Bool
f x = case x of

  []    -&gt; case x of        -- brings (x ~ []) in scope
             []    -&gt; True
             (_:_) -&gt; False -- can't happen

  (_:_) -&gt; case x of        -- brings (x ~ (_:_)) in scope
             (_:_) -&gt; True
             []    -&gt; False -- can't happen

Functions `genCaseTmCs1' and `genCaseTmCs2' are responsible for generating
these constraints.
-}</span><span>
</span><a name="line-2355"></a><span>
</span><a name="line-2356"></a><span class="hs-comment">-- | Generate equalities when checking a case expression:</span><span>
</span><a name="line-2357"></a><span class="hs-comment">--     case x of { p1 -&gt; e1; ... pn -&gt; en }</span><span>
</span><a name="line-2358"></a><span class="hs-comment">-- When we go deeper to check e.g. e1 we record two equalities:</span><span>
</span><a name="line-2359"></a><span class="hs-comment">-- (x ~ y), where y is the initial uncovered when checking (p1; .. ; pn)</span><span>
</span><a name="line-2360"></a><span class="hs-comment">-- and (x ~ p1).</span><span>
</span><a name="line-2361"></a><span class="hs-identifier">genCaseTmCs2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Scrutinee</span><span>
</span><a name="line-2362"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- LHS       (should have length 1)</span><span>
</span><a name="line-2363"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span>                  </span><span class="hs-comment">-- MatchVars (should have length 1)</span><span>
</span><a name="line-2364"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">SimpleEq</span><span class="hs-special">)</span><span>
</span><a name="line-2365"></a><a name="genCaseTmCs2"><a href="Check.html#genCaseTmCs2"><span class="hs-identifier">genCaseTmCs2</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span>
</span><a name="line-2366"></a><span class="hs-identifier">genCaseTmCs2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964691"><a href="#local-6989586621683964691"><span class="hs-identifier">scr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621683964692"><a href="#local-6989586621683964692"><span class="hs-identifier">p</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621683964693"><a href="#local-6989586621683964693"><span class="hs-identifier">var</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2367"></a><span>  </span><a name="local-6989586621683964694"><a href="#local-6989586621683964694"><span class="hs-identifier">fam_insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a><span>
</span><a name="line-2368"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621683964695"><a href="#local-6989586621683964695"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#vaToPmExpr"><span class="hs-identifier hs-var">vaToPmExpr</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Check.html#coercePatVec"><span class="hs-identifier hs-var">coercePatVec</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Check.html#translatePat"><span class="hs-identifier hs-var">translatePat</span></a><span> </span><a href="#local-6989586621683964694"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><a href="#local-6989586621683964692"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2369"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964696"><a href="#local-6989586621683964696"><span class="hs-identifier">scr_e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lhsExprToPmExpr</span><span> </span><a href="#local-6989586621683964691"><span class="hs-identifier hs-var">scr</span></a><span>
</span><a name="line-2370"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621683964693"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964695"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964693"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964696"><span class="hs-identifier hs-var">scr_e</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2371"></a><span class="hs-identifier">genCaseTmCs2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCaseTmCs2: HsCase&quot;</span><span>
</span><a name="line-2372"></a><span>
</span><a name="line-2373"></a><span class="hs-comment">-- | Generate a simple equality when checking a case expression:</span><span>
</span><a name="line-2374"></a><span class="hs-comment">--     case x of { matches }</span><span>
</span><a name="line-2375"></a><span class="hs-comment">-- When checking matches we record that (x ~ y) where y is the initial</span><span>
</span><a name="line-2376"></a><span class="hs-comment">-- uncovered. All matches will have to satisfy this equality.</span><span>
</span><a name="line-2377"></a><span class="hs-identifier">genCaseTmCs1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">SimpleEq</span><span>
</span><a name="line-2378"></a><a name="genCaseTmCs1"><a href="Check.html#genCaseTmCs1"><span class="hs-identifier">genCaseTmCs1</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span>
</span><a name="line-2379"></a><span class="hs-identifier">genCaseTmCs1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621683964697"><a href="#local-6989586621683964697"><span class="hs-identifier">scr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621683964698"><a href="#local-6989586621683964698"><span class="hs-identifier">var</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964698"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">lhsExprToPmExpr</span><span> </span><a href="#local-6989586621683964697"><span class="hs-identifier hs-var">scr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2380"></a><span class="hs-identifier">genCaseTmCs1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCaseTmCs1: HsCase&quot;</span><span>
</span><a name="line-2381"></a><span>
</span><a name="line-2382"></a><span class="hs-comment">{- Note [Literals in PmPat]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Instead of translating a literal to a variable accompanied with a guard, we
treat them like constructor patterns. The following example from
&quot;./libraries/base/GHC/IO/Encoding.hs&quot; shows why:

mkTextEncoding' :: CodingFailureMode -&gt; String -&gt; IO TextEncoding
mkTextEncoding' cfm enc = case [toUpper c | c &lt;- enc, c /= '-'] of
    &quot;UTF8&quot;    -&gt; return $ UTF8.mkUTF8 cfm
    &quot;UTF16&quot;   -&gt; return $ UTF16.mkUTF16 cfm
    &quot;UTF16LE&quot; -&gt; return $ UTF16.mkUTF16le cfm
    ...

Each clause gets translated to a list of variables with an equal number of
guards. For every guard we generate two cases (equals True/equals False) which
means that we generate 2^n cases to feed the oracle with, where n is the sum of
the length of all strings that appear in the patterns. For this particular
example this means over 2^40 cases. Instead, by representing them like with
constructor we get the following:
  1. We exploit the common prefix with our representation of VSAs
  2. We prune immediately non-reachable cases
     (e.g. False == (x == &quot;U&quot;), True == (x == &quot;U&quot;))

Note [Translating As Patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Instead of translating x@p as:  x (p &lt;- x)
we instead translate it as:     p (x &lt;- coercePattern p)
for performance reasons. For example:

  f x@True  = 1
  f y@False = 2

Gives the following with the first translation:

  x |&gt; {x == False, x == y, y == True}

If we use the second translation we get an empty set, independently of the
oracle. Since the pattern `p' may contain guard patterns though, it cannot be
used as an expression. That's why we call `coercePatVec' to drop the guard and
`vaToPmExpr' to transform the value abstraction to an expression in the
guard pattern (value abstractions are a subset of expressions). We keep the
guards in the first pattern `p' though.


%************************************************************************
%*                                                                      *
      Pretty printing of exhaustiveness/redundancy check warnings
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-2432"></a><span>
</span><a name="line-2433"></a><span class="hs-comment">-- | Check whether any part of pattern match checking is enabled (does not</span><span>
</span><a name="line-2434"></a><span class="hs-comment">-- matter whether it is the redundancy check or the exhaustiveness check).</span><span>
</span><a name="line-2435"></a><span class="hs-identifier">isAnyPmCheckEnabled</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2436"></a><a name="isAnyPmCheckEnabled"><a href="Check.html#isAnyPmCheckEnabled"><span class="hs-identifier">isAnyPmCheckEnabled</span></a></a><span> </span><a name="local-6989586621683964699"><a href="#local-6989586621683964699"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a><span> </span><a name="local-6989586621683964700"><a href="#local-6989586621683964700"><span class="hs-identifier">kind</span></a></a><span> </span><a name="local-6989586621683964701"><a href="#local-6989586621683964701"><span class="hs-identifier">_loc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2437"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">wopt</span><span> </span><span class="hs-identifier hs-var">Opt_WarnOverlappingPatterns</span><span> </span><a href="#local-6989586621683964699"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Check.html#exhaustive"><span class="hs-identifier hs-var">exhaustive</span></a><span> </span><a href="#local-6989586621683964699"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683964700"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2438"></a><span>
</span><a name="line-2439"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2440"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964016"><a href="#local-6989586621683964016"><span class="hs-identifier">vva</span></a></a><span> </span><a name="local-6989586621683964017"><a href="#local-6989586621683964017"><span class="hs-identifier">delta</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2441"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621683964018"><a href="#local-6989586621683964018"><span class="hs-identifier">residual_eqs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964019"><a href="#local-6989586621683964019"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#wrapUpTmState"><span class="hs-identifier hs-var">wrapUpTmState</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">delta_tm_cs</span><span> </span><a href="#local-6989586621683964017"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-2442"></a><span>          </span><a name="local-6989586621683964020"><a href="#local-6989586621683964020"><span class="hs-identifier">vector</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#substInValAbs"><span class="hs-identifier hs-var">substInValAbs</span></a><span> </span><a href="#local-6989586621683964019"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621683964016"><span class="hs-identifier hs-var">vva</span></a><span>
</span><a name="line-2443"></a><span>      </span><span class="hs-keyword">in</span><span>  </span><a href="Check.html#ppr_uncovered"><span class="hs-identifier hs-var">ppr_uncovered</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964020"><span class="hs-identifier hs-var">vector</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964018"><span class="hs-identifier hs-var">residual_eqs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2444"></a><span>
</span><a name="line-2445"></a><span class="hs-comment">-- | Apply a term substitution to a value vector abstraction. All VAs are</span><span>
</span><a name="line-2446"></a><span class="hs-comment">-- transformed to PmExpr (used only before pretty printing).</span><span>
</span><a name="line-2447"></a><span class="hs-identifier">substInValAbs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TmOracle.html#PmVarEnv"><span class="hs-identifier hs-type">PmVarEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">PmExpr</span><span class="hs-special">]</span><span>
</span><a name="line-2448"></a><a name="substInValAbs"><a href="Check.html#substInValAbs"><span class="hs-identifier">substInValAbs</span></a></a><span> </span><a name="local-6989586621683964702"><a href="#local-6989586621683964702"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="TmOracle.html#exprDeepLookup"><span class="hs-identifier hs-var">exprDeepLookup</span></a><span> </span><a href="#local-6989586621683964702"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Check.html#vaToPmExpr"><span class="hs-identifier hs-var">vaToPmExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2449"></a><span>
</span><a name="line-2450"></a><span class="hs-comment">-- | Wrap up the term oracle's state once solving is complete. Drop any</span><span>
</span><a name="line-2451"></a><span class="hs-comment">-- information about unhandled constraints (involving HsExprs) and flatten</span><span>
</span><a name="line-2452"></a><span class="hs-comment">-- (height 1) the substitution.</span><span>
</span><a name="line-2453"></a><span class="hs-identifier">wrapUpTmState</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TmOracle.html#TmState"><span class="hs-identifier hs-type">TmState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">ComplexEq</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TmOracle.html#PmVarEnv"><span class="hs-identifier hs-type">PmVarEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2454"></a><a name="wrapUpTmState"><a href="Check.html#wrapUpTmState"><span class="hs-identifier">wrapUpTmState</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964703"><a href="#local-6989586621683964703"><span class="hs-identifier">residual</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621683964704"><a href="#local-6989586621683964704"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964703"><span class="hs-identifier hs-var">residual</span></a><span class="hs-special">,</span><span> </span><a href="TmOracle.html#flattenPmVarEnv"><span class="hs-identifier hs-var">flattenPmVarEnv</span></a><span> </span><a href="#local-6989586621683964704"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2455"></a><span>
</span><a name="line-2456"></a><span class="hs-comment">-- | Issue all the warnings (coverage, exhaustiveness, inaccessibility)</span><span>
</span><a name="line-2457"></a><span class="hs-identifier">dsPmWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmResult"><span class="hs-identifier hs-type">PmResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2458"></a><a name="dsPmWarn"><a href="Check.html#dsPmWarn"><span class="hs-identifier">dsPmWarn</span></a></a><span> </span><a name="local-6989586621683964705"><a href="#local-6989586621683964705"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621683964706"><a href="#local-6989586621683964706"><span class="hs-identifier">ctx</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a><span> </span><a name="local-6989586621683964707"><a href="#local-6989586621683964707"><span class="hs-identifier">kind</span></a></a><span> </span><a name="local-6989586621683964708"><a href="#local-6989586621683964708"><span class="hs-identifier">loc</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964709"><a href="#local-6989586621683964709"><span class="hs-identifier">pm_result</span></a></a><span>
</span><a name="line-2459"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964714"><span class="hs-identifier hs-var">flag_i</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621683964715"><span class="hs-identifier hs-var">flag_u</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2460"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964730"><a href="#local-6989586621683964730"><span class="hs-identifier">exists_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964714"><span class="hs-identifier hs-var">flag_i</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">notNull</span><span> </span><a href="#local-6989586621683964711"><span class="hs-identifier hs-var">redundant</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621683964718"><span class="hs-identifier hs-var">onlyBuiltin</span></a><span>
</span><a name="line-2461"></a><span>          </span><a name="local-6989586621683964731"><a href="#local-6989586621683964731"><span class="hs-identifier">exists_i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964714"><span class="hs-identifier hs-var">flag_i</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">notNull</span><span> </span><a href="#local-6989586621683964713"><span class="hs-identifier hs-var">inaccessible</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621683964718"><span class="hs-identifier hs-var">onlyBuiltin</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621683964717"><span class="hs-identifier hs-var">is_rec_upd</span></a><span>
</span><a name="line-2462"></a><span>          </span><a name="local-6989586621683964732"><a href="#local-6989586621683964732"><span class="hs-identifier">exists_u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964715"><span class="hs-identifier hs-var">flag_u</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964712"><span class="hs-identifier hs-var">uncovered</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2463"></a><span>                                  </span><a href="Check.html#TypeOfUncovered"><span class="hs-identifier hs-var">TypeOfUncovered</span></a><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2464"></a><span>                                  </span><a href="Check.html#UncoveredPatterns"><span class="hs-identifier hs-var">UncoveredPatterns</span></a><span> </span><a name="local-6989586621683964733"><a href="#local-6989586621683964733"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">notNull</span><span> </span><a href="#local-6989586621683964733"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-2465"></a><span>
</span><a name="line-2466"></a><span>      </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621683964730"><span class="hs-identifier hs-var">exists_r</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621683964711"><span class="hs-identifier hs-var">redundant</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621683964734"><a href="#local-6989586621683964734"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621683964735"><a href="#local-6989586621683964735"><span class="hs-identifier">q</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2467"></a><span>        </span><a href="DsMonad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a><span> </span><a href="#local-6989586621683964734"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnOverlappingPatterns</span><span class="hs-special">)</span><span>
</span><a name="line-2468"></a><span>                               </span><span class="hs-special">(</span><a href="#local-6989586621683964720"><span class="hs-identifier hs-var">pprEqn</span></a><span> </span><a href="#local-6989586621683964735"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-string">&quot;is redundant&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2469"></a><span>      </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621683964731"><span class="hs-identifier hs-var">exists_i</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621683964713"><span class="hs-identifier hs-var">inaccessible</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621683964736"><a href="#local-6989586621683964736"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621683964737"><a href="#local-6989586621683964737"><span class="hs-identifier">q</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2470"></a><span>        </span><a href="DsMonad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a><span> </span><a href="#local-6989586621683964736"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnOverlappingPatterns</span><span class="hs-special">)</span><span>
</span><a name="line-2471"></a><span>                               </span><span class="hs-special">(</span><a href="#local-6989586621683964720"><span class="hs-identifier hs-var">pprEqn</span></a><span> </span><a href="#local-6989586621683964737"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-string">&quot;has inaccessible right hand side&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2472"></a><span>      </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621683964732"><span class="hs-identifier hs-var">exists_u</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DsMonad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a><span> </span><a href="#local-6989586621683964708"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><a href="#local-6989586621683964716"><span class="hs-identifier hs-var">flag_u_reason</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2473"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964712"><span class="hs-identifier hs-var">uncovered</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2474"></a><span>          </span><a href="Check.html#TypeOfUncovered"><span class="hs-identifier hs-var">TypeOfUncovered</span></a><span> </span><a name="local-6989586621683964738"><a href="#local-6989586621683964738"><span class="hs-identifier">ty</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964722"><span class="hs-identifier hs-var">warnEmptyCase</span></a><span> </span><a href="#local-6989586621683964738"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2475"></a><span>          </span><a href="Check.html#UncoveredPatterns"><span class="hs-identifier hs-var">UncoveredPatterns</span></a><span> </span><a name="local-6989586621683964739"><a href="#local-6989586621683964739"><span class="hs-identifier">candidates</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964721"><span class="hs-identifier hs-var">pprEqns</span></a><span> </span><a href="#local-6989586621683964739"><span class="hs-identifier hs-var">candidates</span></a><span>
</span><a name="line-2476"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2477"></a><span>    </span><a href="Check.html#PmResult"><span class="hs-identifier hs-var">PmResult</span></a><span>
</span><a name="line-2478"></a><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pmresultProvenance</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964710"><a href="#local-6989586621683964710"><span class="hs-identifier">prov</span></a></a><span>
</span><a name="line-2479"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pmresultRedundant</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964711"><a href="#local-6989586621683964711"><span class="hs-identifier">redundant</span></a></a><span>
</span><a name="line-2480"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pmresultUncovered</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964712"><a href="#local-6989586621683964712"><span class="hs-identifier">uncovered</span></a></a><span>
</span><a name="line-2481"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pmresultInaccessible</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621683964713"><a href="#local-6989586621683964713"><span class="hs-identifier">inaccessible</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964709"><span class="hs-identifier hs-var">pm_result</span></a><span>
</span><a name="line-2482"></a><span>
</span><a name="line-2483"></a><span>    </span><a name="local-6989586621683964714"><a href="#local-6989586621683964714"><span class="hs-identifier">flag_i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">wopt</span><span> </span><span class="hs-identifier hs-var">Opt_WarnOverlappingPatterns</span><span> </span><a href="#local-6989586621683964705"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2484"></a><span>    </span><a name="local-6989586621683964715"><a href="#local-6989586621683964715"><span class="hs-identifier">flag_u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#exhaustive"><span class="hs-identifier hs-var">exhaustive</span></a><span> </span><a href="#local-6989586621683964705"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683964707"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2485"></a><span>    </span><a name="local-6989586621683964716"><a href="#local-6989586621683964716"><span class="hs-identifier">flag_u_reason</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-identifier hs-var">NoReason</span><span> </span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-special">(</span><a href="Check.html#exhaustiveWarningFlag"><span class="hs-identifier hs-var">exhaustiveWarningFlag</span></a><span> </span><a href="#local-6989586621683964707"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2486"></a><span>
</span><a name="line-2487"></a><span>    </span><a name="local-6989586621683964717"><a href="#local-6989586621683964717"><span class="hs-identifier">is_rec_upd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964707"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">RecUpd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2488"></a><span>       </span><span class="hs-comment">-- See Note [Inaccessible warnings for record updates]</span><span>
</span><a name="line-2489"></a><span>
</span><a name="line-2490"></a><span>    </span><a name="local-6989586621683964718"><a href="#local-6989586621683964718"><span class="hs-identifier">onlyBuiltin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964710"><span class="hs-identifier hs-var">prov</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Check.html#FromBuiltin"><span class="hs-identifier hs-var">FromBuiltin</span></a><span>
</span><a name="line-2491"></a><span>
</span><a name="line-2492"></a><span>    </span><a name="local-6989586621683964719"><a href="#local-6989586621683964719"><span class="hs-identifier">maxPatterns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">maxUncoveredPatterns</span><span> </span><a href="#local-6989586621683964705"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2493"></a><span>
</span><a name="line-2494"></a><span>    </span><span class="hs-comment">-- Print a single clause (for redundant/with-inaccessible-rhs)</span><span>
</span><a name="line-2495"></a><span>    </span><a name="local-6989586621683964720"><a href="#local-6989586621683964720"><span class="hs-identifier">pprEqn</span></a></a><span> </span><a name="local-6989586621683964723"><a href="#local-6989586621683964723"><span class="hs-identifier">q</span></a></a><span> </span><a name="local-6989586621683964724"><a href="#local-6989586621683964724"><span class="hs-identifier">txt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#pp_context"><span class="hs-identifier hs-var">pp_context</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621683964706"><span class="hs-identifier hs-var">ctx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621683964724"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621683964725"><a href="#local-6989586621683964725"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#ppr_eqn"><span class="hs-identifier hs-var">ppr_eqn</span></a><span> </span><a href="#local-6989586621683964725"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621683964707"><span class="hs-identifier hs-var">kind</span></a><span> </span><a href="#local-6989586621683964723"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-2496"></a><span>
</span><a name="line-2497"></a><span>    </span><span class="hs-comment">-- Print several clauses (for uncovered clauses)</span><span>
</span><a name="line-2498"></a><span>    </span><a name="local-6989586621683964721"><a href="#local-6989586621683964721"><span class="hs-identifier">pprEqns</span></a></a><span> </span><a name="local-6989586621683964726"><a href="#local-6989586621683964726"><span class="hs-identifier">qs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#pp_context"><span class="hs-identifier hs-var">pp_context</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621683964706"><span class="hs-identifier hs-var">ctx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;are non-exhaustive&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2499"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964726"><span class="hs-identifier hs-var">qs</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- See #11245</span><span>
</span><a name="line-2500"></a><span>           </span><span class="hs-special">[</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span>
</span><a name="line-2501"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Guards do not cover entire pattern space&quot;</span><span>
</span><a name="line-2502"></a><span>           </span><a name="local-6989586621683964727"><a href="#local-6989586621683964727"><span class="hs-identifier">_missing</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621683964728"><a href="#local-6989586621683964728"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964726"><span class="hs-identifier hs-var">qs</span></a><span>
</span><a name="line-2503"></a><span>                       </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Patterns not matched:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-2504"></a><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621683964719"><span class="hs-identifier hs-var">maxPatterns</span></a><span> </span><a href="#local-6989586621683964728"><span class="hs-identifier hs-var">us</span></a><span class="hs-special">)</span><span>
</span><a name="line-2505"></a><span>                                 </span><span class="hs-operator hs-var">$$</span><span> </span><a href="Check.html#dots"><span class="hs-identifier hs-var">dots</span></a><span> </span><a href="#local-6989586621683964719"><span class="hs-identifier hs-var">maxPatterns</span></a><span> </span><a href="#local-6989586621683964728"><span class="hs-identifier hs-var">us</span></a><span class="hs-special">)</span><span>
</span><a name="line-2506"></a><span>
</span><a name="line-2507"></a><span>    </span><span class="hs-comment">-- Print a type-annotated wildcard (for non-exhaustive `EmptyCase`s for</span><span>
</span><a name="line-2508"></a><span>    </span><span class="hs-comment">-- which we only know the type and have no inhabitants at hand)</span><span>
</span><a name="line-2509"></a><span>    </span><a name="local-6989586621683964722"><a href="#local-6989586621683964722"><span class="hs-identifier">warnEmptyCase</span></a></a><span> </span><a name="local-6989586621683964729"><a href="#local-6989586621683964729"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#pp_context"><span class="hs-identifier hs-var">pp_context</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621683964706"><span class="hs-identifier hs-var">ctx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;are non-exhaustive&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2510"></a><span>      </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Patterns not matched:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">underscore</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964729"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2511"></a><span>
</span><a name="line-2512"></a><span class="hs-comment">{- Note [Inaccessible warnings for record updates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (Trac #12957)
  data T a where
    T1 :: { x :: Int } -&gt; T Bool
    T2 :: { x :: Int } -&gt; T a
    T3 :: T a

  f :: T Char -&gt; T a
  f r = r { x = 3 }

The desugarer will (conservatively generate a case for T1 even though
it's impossible:
  f r = case r of
          T1 x -&gt; T1 3   -- Inaccessible branch
          T2 x -&gt; T2 3
          _    -&gt; error &quot;Missing&quot;

We don't want to warn about the inaccessible branch because the programmer
didn't put it there!  So we filter out the warning here.
-}</span><span>
</span><a name="line-2533"></a><span>
</span><a name="line-2534"></a><span class="hs-comment">-- | Issue a warning when the predefined number of iterations is exceeded</span><span>
</span><a name="line-2535"></a><span class="hs-comment">-- for the pattern match checker</span><span>
</span><a name="line-2536"></a><span class="hs-identifier">warnPmIters</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2537"></a><a name="warnPmIters"><a href="Check.html#warnPmIters"><span class="hs-identifier">warnPmIters</span></a></a><span> </span><a name="local-6989586621683964740"><a href="#local-6989586621683964740"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a><span> </span><a name="local-6989586621683964741"><a href="#local-6989586621683964741"><span class="hs-identifier">kind</span></a></a><span> </span><a name="local-6989586621683964742"><a href="#local-6989586621683964742"><span class="hs-identifier">loc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2538"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964745"><span class="hs-identifier hs-var">flag_i</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621683964746"><span class="hs-identifier hs-var">flag_u</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2539"></a><span>      </span><a name="local-6989586621683964748"><a href="#local-6989586621683964748"><span class="hs-identifier">iters</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">maxPmCheckIterations</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2540"></a><span>      </span><a href="DsMonad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a><span> </span><a href="#local-6989586621683964742"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><span class="hs-identifier hs-var">NoReason</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964744"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621683964748"><span class="hs-identifier hs-var">iters</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2541"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2542"></a><span>    </span><a name="local-6989586621683964743"><a href="#local-6989586621683964743"><span class="hs-identifier">ctxt</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprMatchContext</span><span> </span><a href="#local-6989586621683964741"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2543"></a><span>    </span><a name="local-6989586621683964744"><a href="#local-6989586621683964744"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621683964747"><a href="#local-6989586621683964747"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fsep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Pattern match checker exceeded&quot;</span><span>
</span><a name="line-2544"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">parens</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964747"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;iterations in&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621683964743"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">dot</span><span>
</span><a name="line-2545"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;(Use -fmax-pmcheck-iterations=n&quot;</span><span>
</span><a name="line-2546"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;to set the maximun number of iterations to n)&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2547"></a><span>
</span><a name="line-2548"></a><span>    </span><a name="local-6989586621683964745"><a href="#local-6989586621683964745"><span class="hs-identifier">flag_i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">wopt</span><span> </span><span class="hs-identifier hs-var">Opt_WarnOverlappingPatterns</span><span> </span><a href="#local-6989586621683964740"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2549"></a><span>    </span><a name="local-6989586621683964746"><a href="#local-6989586621683964746"><span class="hs-identifier">flag_u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#exhaustive"><span class="hs-identifier hs-var">exhaustive</span></a><span> </span><a href="#local-6989586621683964740"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621683964741"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-2550"></a><span>
</span><a name="line-2551"></a><span class="hs-identifier">dots</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621683964041"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2552"></a><a name="dots"><a href="Check.html#dots"><span class="hs-identifier">dots</span></a></a><span> </span><a name="local-6989586621683964749"><a href="#local-6989586621683964749"><span class="hs-identifier">maxPatterns</span></a></a><span> </span><a name="local-6989586621683964750"><a href="#local-6989586621683964750"><span class="hs-identifier">qs</span></a></a><span>
</span><a name="line-2553"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964750"><span class="hs-identifier hs-var">qs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lengthExceeds</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964749"><span class="hs-identifier hs-var">maxPatterns</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;...&quot;</span><span>
</span><a name="line-2554"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-2555"></a><span>
</span><a name="line-2556"></a><span class="hs-comment">-- | Check whether the exhaustiveness checker should run (exhaustiveness only)</span><span>
</span><a name="line-2557"></a><span class="hs-identifier">exhaustive</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><a href="#local-6989586621683964040"><span class="hs-identifier hs-type">id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2558"></a><a name="exhaustive"><a href="Check.html#exhaustive"><span class="hs-identifier">exhaustive</span></a></a><span>  </span><a name="local-6989586621683964751"><a href="#local-6989586621683964751"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">wopt</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621683964751"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Check.html#exhaustiveWarningFlag"><span class="hs-identifier hs-var">exhaustiveWarningFlag</span></a><span>
</span><a name="line-2559"></a><span>
</span><a name="line-2560"></a><span class="hs-comment">-- | Denotes whether an exhaustiveness check is supported, and if so,</span><span>
</span><a name="line-2561"></a><span class="hs-comment">-- via which 'WarningFlag' it's controlled.</span><span>
</span><a name="line-2562"></a><span class="hs-comment">-- Returns 'Nothing' if check is not supported.</span><span>
</span><a name="line-2563"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><a href="#local-6989586621683964039"><span class="hs-identifier hs-type">id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">WarningFlag</span><span>
</span><a name="line-2564"></a><a name="exhaustiveWarningFlag"><a href="Check.html#exhaustiveWarningFlag"><span class="hs-identifier">exhaustiveWarningFlag</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunRhs</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIncompletePatterns</span><span>
</span><a name="line-2565"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">CaseAlt</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIncompletePatterns</span><span>
</span><a name="line-2566"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">IfAlt</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIncompletePatterns</span><span>
</span><a name="line-2567"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">LambdaExpr</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIncompleteUniPatterns</span><span>
</span><a name="line-2568"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">PatBindRhs</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIncompleteUniPatterns</span><span>
</span><a name="line-2569"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">PatBindGuards</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIncompletePatterns</span><span>
</span><a name="line-2570"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">ProcExpr</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIncompleteUniPatterns</span><span>
</span><a name="line-2571"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">RecUpd</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIncompletePatternsRecUpd</span><span>
</span><a name="line-2572"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">ThPatSplice</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2573"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">PatSyn</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2574"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-identifier hs-var">ThPatQuote</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2575"></a><span class="hs-identifier">exhaustiveWarningFlag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">StmtCtxt</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- Don't warn about incomplete patterns</span><span>
</span><a name="line-2576"></a><span>                                       </span><span class="hs-comment">-- in list comprehensions, pattern guards</span><span>
</span><a name="line-2577"></a><span>                                       </span><span class="hs-comment">-- etc. They are often *supposed* to be</span><span>
</span><a name="line-2578"></a><span>                                       </span><span class="hs-comment">-- incomplete</span><span>
</span><a name="line-2579"></a><span>
</span><a name="line-2580"></a><span class="hs-comment">-- True &lt;==&gt; singular</span><span>
</span><a name="line-2581"></a><span class="hs-identifier">pp_context</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2582"></a><a name="pp_context"><a href="Check.html#pp_context"><span class="hs-identifier">pp_context</span></a></a><span> </span><a name="local-6989586621683964752"><a href="#local-6989586621683964752"><span class="hs-identifier">singular</span></a></a><span> </span><span class="hs-special">(</span><a href="DsMonad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a><span> </span><a name="local-6989586621683964753"><a href="#local-6989586621683964753"><span class="hs-identifier">kind</span></a></a><span> </span><a name="local-6989586621683964754"><a href="#local-6989586621683964754"><span class="hs-identifier">_loc</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621683964755"><a href="#local-6989586621683964755"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621683964756"><a href="#local-6989586621683964756"><span class="hs-identifier">rest_of_msg_fun</span></a></a><span>
</span><a name="line-2583"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621683964757"><span class="hs-identifier hs-var">txt</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621683964755"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">,</span><span>
</span><a name="line-2584"></a><span>          </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621683964758"><span class="hs-identifier hs-var">ppr_match</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">':'</span><span>
</span><a name="line-2585"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621683964756"><span class="hs-identifier hs-var">rest_of_msg_fun</span></a><span> </span><a href="#local-6989586621683964759"><span class="hs-identifier hs-var">pref</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-2586"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2587"></a><span>    </span><a name="local-6989586621683964757"><a href="#local-6989586621683964757"><span class="hs-identifier">txt</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621683964752"><span class="hs-identifier hs-var">singular</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Pattern match&quot;</span><span>
</span><a name="line-2588"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Pattern match(es)&quot;</span><span>
</span><a name="line-2589"></a><span>
</span><a name="line-2590"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683964758"><a href="#local-6989586621683964758"><span class="hs-identifier">ppr_match</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964759"><a href="#local-6989586621683964759"><span class="hs-identifier">pref</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2591"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621683964753"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2592"></a><span>             </span><span class="hs-identifier hs-var">FunRhs</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mc_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621683964760"><a href="#local-6989586621683964760"><span class="hs-identifier">fun</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2593"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprMatchContext</span><span> </span><a href="#local-6989586621683964753"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621683964761"><a href="#local-6989586621683964761"><span class="hs-identifier">pp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964760"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621683964761"><span class="hs-identifier hs-var">pp</span></a><span class="hs-special">)</span><span>
</span><a name="line-2594"></a><span>             </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprMatchContext</span><span> </span><a href="#local-6989586621683964753"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621683964762"><a href="#local-6989586621683964762"><span class="hs-identifier">pp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621683964762"><span class="hs-identifier hs-var">pp</span></a><span class="hs-special">)</span><span>
</span><a name="line-2595"></a><span>
</span><a name="line-2596"></a><span class="hs-identifier">ppr_pats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2597"></a><a name="ppr_pats"><a href="Check.html#ppr_pats"><span class="hs-identifier">ppr_pats</span></a></a><span> </span><a name="local-6989586621683964763"><a href="#local-6989586621683964763"><span class="hs-identifier">kind</span></a></a><span> </span><a name="local-6989586621683964764"><a href="#local-6989586621683964764"><span class="hs-identifier">pats</span></a></a><span>
</span><a name="line-2598"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964764"><span class="hs-identifier hs-var">pats</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">matchSeparator</span><span> </span><a href="#local-6989586621683964763"><span class="hs-identifier hs-var">kind</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;...&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-2599"></a><span>
</span><a name="line-2600"></a><span class="hs-identifier">ppr_eqn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2601"></a><a name="ppr_eqn"><a href="Check.html#ppr_eqn"><span class="hs-identifier">ppr_eqn</span></a></a><span> </span><a name="local-6989586621683964765"><a href="#local-6989586621683964765"><span class="hs-identifier">prefixF</span></a></a><span> </span><a name="local-6989586621683964766"><a href="#local-6989586621683964766"><span class="hs-identifier">kind</span></a></a><span> </span><a name="local-6989586621683964767"><a href="#local-6989586621683964767"><span class="hs-identifier">eqn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964765"><span class="hs-identifier hs-var">prefixF</span></a><span> </span><span class="hs-special">(</span><a href="Check.html#ppr_pats"><span class="hs-identifier hs-var">ppr_pats</span></a><span> </span><a href="#local-6989586621683964766"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621683964767"><span class="hs-identifier hs-var">eqn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2602"></a><span>
</span><a name="line-2603"></a><span class="hs-identifier">ppr_constraint</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SDoc</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-type">PmLit</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2604"></a><a name="ppr_constraint"><a href="Check.html#ppr_constraint"><span class="hs-identifier">ppr_constraint</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964768"><a href="#local-6989586621683964768"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964769"><a href="#local-6989586621683964769"><span class="hs-identifier">lits</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621683964768"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;is not one of&quot;</span><span>
</span><a name="line-2605"></a><span>                                 </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">braces</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprWithCommas</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964769"><span class="hs-identifier hs-var">lits</span></a><span class="hs-special">)</span><span>
</span><a name="line-2606"></a><span>
</span><a name="line-2607"></a><span class="hs-identifier">ppr_uncovered</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">PmExpr</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ComplexEq</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2608"></a><a name="ppr_uncovered"><a href="Check.html#ppr_uncovered"><span class="hs-identifier">ppr_uncovered</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621683964770"><a href="#local-6989586621683964770"><span class="hs-identifier">expr_vec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621683964771"><a href="#local-6989586621683964771"><span class="hs-identifier">complex</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2609"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621683964774"><span class="hs-identifier hs-var">cs</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fsep</span><span> </span><a href="#local-6989586621683964773"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-comment">-- there are no literal constraints</span><span>
</span><a name="line-2610"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsep</span><span> </span><a href="#local-6989586621683964773"><span class="hs-identifier hs-var">vec</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2611"></a><span>                  </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;where&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#ppr_constraint"><span class="hs-identifier hs-var">ppr_constraint</span></a><span> </span><a href="#local-6989586621683964774"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2612"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2613"></a><span>    </span><a name="local-6989586621683964772"><a href="#local-6989586621683964772"><span class="hs-identifier">sdoc_vec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-identifier hs-var">pprPmExprWithParens</span><span> </span><a href="#local-6989586621683964770"><span class="hs-identifier hs-var">expr_vec</span></a><span>
</span><a name="line-2614"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621683964773"><a href="#local-6989586621683964773"><span class="hs-identifier">vec</span></a></a><span class="hs-special">,</span><a name="local-6989586621683964774"><a href="#local-6989586621683964774"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">runPmPprM</span><span> </span><a href="#local-6989586621683964772"><span class="hs-identifier hs-var">sdoc_vec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filterComplex</span><span> </span><a href="#local-6989586621683964771"><span class="hs-identifier hs-var">complex</span></a><span class="hs-special">)</span><span>
</span><a name="line-2615"></a><span>
</span><a name="line-2616"></a><span class="hs-comment">{- Note [Representation of Term Equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In the paper, term constraints always take the form (x ~ e). Of course, a more
general constraint of the form (e1 ~ e1) can always be transformed to an
equivalent set of the former constraints, by introducing a fresh, intermediate
variable: { y ~ e1, y ~ e1 }. Yet, implementing this representation gave rise
to #11160 (incredibly bad performance for literal pattern matching). Two are
the main sources of this problem (the actual problem is how these two interact
with each other):

1. Pattern matching on literals generates twice as many constraints as needed.
   Consider the following (tests/ghci/should_run/ghcirun004):

    foo :: Int -&gt; Int
    foo 1    = 0
    ...
    foo 5000 = 4999

   The covered and uncovered set *should* look like:
     U0 = { x |&gt; {} }

     C1  = { 1  |&gt; { x ~ 1 } }
     U1  = { x  |&gt; { False ~ (x ~ 1) } }
     ...
     C10 = { 10 |&gt; { False ~ (x ~ 1), .., False ~ (x ~ 9), x ~ 10 } }
     U10 = { x  |&gt; { False ~ (x ~ 1), .., False ~ (x ~ 9), False ~ (x ~ 10) } }
     ...

     If we replace { False ~ (x ~ 1) } with { y ~ False, y ~ (x ~ 1) }
     we get twice as many constraints. Also note that half of them are just the
     substitution [x |-&gt; False].

2. The term oracle (`tmOracle` in deSugar/TmOracle) uses equalities of the form
   (x ~ e) as substitutions [x |-&gt; e]. More specifically, function
   `extendSubstAndSolve` applies such substitutions in the residual constraints
   and partitions them in the affected and non-affected ones, which are the new
   worklist. Essentially, this gives quadradic behaviour on the number of the
   residual constraints. (This would not be the case if the term oracle used
   mutable variables but, since we use it to handle disjunctions on value set
   abstractions (`Union` case), we chose a pure, incremental interface).

Now the problem becomes apparent (e.g. for clause 300):
  * Set U300 contains 300 substituting constraints [y_i |-&gt; False] and 300
    constraints that we know that will not reduce (stay in the worklist).
  * To check for consistency, we apply the substituting constraints ONE BY ONE
    (since `tmOracle` is called incrementally, it does not have all of them
    available at once). Hence, we go through the (non-progressing) constraints
    over and over, achieving over-quadradic behaviour.

If instead we allow constraints of the form (e ~ e),
  * All uncovered sets Ui contain no substituting constraints and i
    non-progressing constraints of the form (False ~ (x ~ lit)) so the oracle
    behaves linearly.
  * All covered sets Ci contain exactly (i-1) non-progressing constraints and
    a single substituting constraint. So the term oracle goes through the
    constraints only once.

The performance improvement becomes even more important when more arguments are
involved.
-}</span><span>
</span><a name="line-2676"></a><span>
</span><a name="line-2677"></a><span class="hs-comment">-- Debugging Infrastructre</span><span>
</span><a name="line-2678"></a><span>
</span><a name="line-2679"></a><span class="hs-identifier">tracePm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Check.html#PmM"><span class="hs-identifier hs-type">PmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2680"></a><a name="tracePm"><a href="Check.html#tracePm"><span class="hs-identifier">tracePm</span></a></a><span> </span><a name="local-6989586621683964775"><a href="#local-6989586621683964775"><span class="hs-identifier">herald</span></a></a><span> </span><a name="local-6989586621683964776"><a href="#local-6989586621683964776"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Check.html#liftD"><span class="hs-identifier hs-var">liftD</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Check.html#tracePmD"><span class="hs-identifier hs-var">tracePmD</span></a><span> </span><a href="#local-6989586621683964775"><span class="hs-identifier hs-var">herald</span></a><span> </span><a href="#local-6989586621683964776"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-2681"></a><span>
</span><a name="line-2682"></a><span>
</span><a name="line-2683"></a><span class="hs-identifier">tracePmD</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2684"></a><a name="tracePmD"><a href="Check.html#tracePmD"><span class="hs-identifier">tracePmD</span></a></a><span> </span><a name="local-6989586621683964777"><a href="#local-6989586621683964777"><span class="hs-identifier">herald</span></a></a><span> </span><a name="local-6989586621683964778"><a href="#local-6989586621683964778"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2685"></a><span>  </span><a name="local-6989586621683964779"><a href="#local-6989586621683964779"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2686"></a><span>  </span><a name="local-6989586621683964780"><a href="#local-6989586621683964780"><span class="hs-identifier">printer</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#mkPrintUnqualifiedDs"><span class="hs-identifier hs-var">mkPrintUnqualifiedDs</span></a><span>
</span><a name="line-2687"></a><span>  </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">dumpIfSet_dyn_printer</span><span> </span><a href="#local-6989586621683964780"><span class="hs-identifier hs-var">printer</span></a><span> </span><a href="#local-6989586621683964779"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2688"></a><span>            </span><span class="hs-identifier hs-var">Opt_D_dump_ec_trace</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><a href="#local-6989586621683964777"><span class="hs-identifier hs-var">herald</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621683964778"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2689"></a><span>
</span><a name="line-2690"></a><span>
</span><a name="line-2691"></a><span class="hs-identifier">pprPmPatDebug</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PmPat"><span class="hs-identifier hs-type">PmPat</span></a><span> </span><a href="#local-6989586621683964038"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2692"></a><a name="pprPmPatDebug"><a href="Check.html#pprPmPatDebug"><span class="hs-identifier">pprPmPatDebug</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#PmCon"><span class="hs-identifier hs-var">PmCon</span></a><span> </span><a name="local-6989586621683964781"><a href="#local-6989586621683964781"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621683964782"><a href="#local-6989586621683964782"><span class="hs-identifier">_arg_tys</span></a></a><span> </span><a name="local-6989586621683964783"><a href="#local-6989586621683964783"><span class="hs-identifier">_con_tvs</span></a></a><span> </span><a name="local-6989586621683964784"><a href="#local-6989586621683964784"><span class="hs-identifier">_con_dicts</span></a></a><span> </span><a name="local-6989586621683964785"><a href="#local-6989586621683964785"><span class="hs-identifier">con_args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2693"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;PmCon&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964781"><span class="hs-identifier hs-var">cc</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#pprPmPatDebug"><span class="hs-identifier hs-var">pprPmPatDebug</span></a><span> </span><a href="#local-6989586621683964785"><span class="hs-identifier hs-var">con_args</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2694"></a><span class="hs-identifier">pprPmPatDebug</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmVar"><span class="hs-identifier hs-var">PmVar</span></a><span> </span><a name="local-6989586621683964786"><a href="#local-6989586621683964786"><span class="hs-identifier">vid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;PmVar&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964786"><span class="hs-identifier hs-var">vid</span></a><span>
</span><a name="line-2695"></a><span class="hs-identifier">pprPmPatDebug</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmLit"><span class="hs-identifier hs-var">PmLit</span></a><span> </span><a name="local-6989586621683964787"><a href="#local-6989586621683964787"><span class="hs-identifier">li</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;PmLit&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964787"><span class="hs-identifier hs-var">li</span></a><span>
</span><a name="line-2696"></a><span class="hs-identifier">pprPmPatDebug</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmNLit"><span class="hs-identifier hs-var">PmNLit</span></a><span> </span><a name="local-6989586621683964788"><a href="#local-6989586621683964788"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621683964789"><a href="#local-6989586621683964789"><span class="hs-identifier">nl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;PmNLit&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964788"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964789"><span class="hs-identifier hs-var">nl</span></a><span>
</span><a name="line-2697"></a><span class="hs-identifier">pprPmPatDebug</span><span> </span><span class="hs-special">(</span><a href="Check.html#PmGrd"><span class="hs-identifier hs-var">PmGrd</span></a><span> </span><a name="local-6989586621683964790"><a href="#local-6989586621683964790"><span class="hs-identifier">pv</span></a></a><span> </span><a name="local-6989586621683964791"><a href="#local-6989586621683964791"><span class="hs-identifier">ge</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;PmGrd&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">hsep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#pprPmPatDebug"><span class="hs-identifier hs-var">pprPmPatDebug</span></a><span> </span><a href="#local-6989586621683964790"><span class="hs-identifier hs-var">pv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2698"></a><span>                                           </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621683964791"><span class="hs-identifier hs-var">ge</span></a><span>
</span><a name="line-2699"></a><span>
</span><a name="line-2700"></a><span class="hs-identifier">pprPatVec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#PatVec"><span class="hs-identifier hs-type">PatVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2701"></a><a name="pprPatVec"><a href="Check.html#pprPatVec"><span class="hs-identifier">pprPatVec</span></a></a><span> </span><a name="local-6989586621683964792"><a href="#local-6989586621683964792"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Pattern:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-2702"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sep</span><span>
</span><a name="line-2703"></a><span>                  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">punctuate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comma</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\n'</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#pprPmPatDebug"><span class="hs-identifier hs-var">pprPmPatDebug</span></a><span> </span><a href="#local-6989586621683964792"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2704"></a><span>
</span><a name="line-2705"></a><span class="hs-identifier">pprValAbs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Check.html#ValAbs"><span class="hs-identifier hs-type">ValAbs</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2706"></a><a name="pprValAbs"><a href="Check.html#pprValAbs"><span class="hs-identifier">pprValAbs</span></a></a><span> </span><a name="local-6989586621683964793"><a href="#local-6989586621683964793"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ValAbs:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-2707"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">brackets</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sep</span><span>
</span><a name="line-2708"></a><span>                  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">punctuate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comma</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Check.html#pprPmPatDebug"><span class="hs-identifier hs-var">pprPmPatDebug</span></a><span> </span><a href="#local-6989586621683964793"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2709"></a><span>
</span><a name="line-2710"></a><span class="hs-identifier">pprValVecDebug</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Check.html#ValVec"><span class="hs-identifier hs-type">ValVec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-2711"></a><a name="pprValVecDebug"><a href="Check.html#pprValVecDebug"><span class="hs-identifier">pprValVecDebug</span></a></a><span> </span><span class="hs-special">(</span><a href="Check.html#ValVec"><span class="hs-identifier hs-var">ValVec</span></a><span> </span><a name="local-6989586621683964794"><a href="#local-6989586621683964794"><span class="hs-identifier">vas</span></a></a><span> </span><a name="local-6989586621683964795"><a href="#local-6989586621683964795"><span class="hs-identifier">_d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;ValVec&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span>
</span><a name="line-2712"></a><span>                                  </span><span class="hs-identifier hs-var">parens</span><span> </span><span class="hs-special">(</span><a href="Check.html#pprValAbs"><span class="hs-identifier hs-var">pprValAbs</span></a><span> </span><a href="#local-6989586621683964794"><span class="hs-identifier hs-var">vas</span></a><span class="hs-special">)</span><span>
</span><a name="line-2713"></a></pre></body></html>