<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Stg to C--: code generation for constructors</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- This module provides the support code for StgCmm to deal with with</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- constructors on the RHSs of let(rec)s.</span><span>
</span><a name="line-9"></a><span class="hs-comment">--</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- (c) The University of Glasgow 2004-2006</span><span>
</span><a name="line-11"></a><span class="hs-comment">--</span><span>
</span><a name="line-12"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">StgCmmCon</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span>        </span><a href="StgCmmCon.html#cgTopRhsCon"><span class="hs-identifier hs-var">cgTopRhsCon</span></a><span class="hs-special">,</span><span> </span><a href="StgCmmCon.html#buildDynCon"><span class="hs-identifier hs-var">buildDynCon</span></a><span class="hs-special">,</span><span> </span><a href="StgCmmCon.html#bindConArgs"><span class="hs-identifier hs-var">bindConArgs</span></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="StgSyn.html"><span class="hs-identifier">StgSyn</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreSyn</span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">AltCon</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="StgCmmMonad.html"><span class="hs-identifier">StgCmmMonad</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="StgCmmEnv.html"><span class="hs-identifier">StgCmmEnv</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="StgCmmHeap.html"><span class="hs-identifier">StgCmmHeap</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="StgCmmLayout.html"><span class="hs-identifier">StgCmmLayout</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="StgCmmUtils.html"><span class="hs-identifier">StgCmmUtils</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="StgCmmClosure.html"><span class="hs-identifier">StgCmmClosure</span></a><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="CmmExpr.html"><span class="hs-identifier">CmmExpr</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="CmmUtils.html"><span class="hs-identifier">CmmUtils</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="CLabel.html"><span class="hs-identifier">CLabel</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="MkGraph.html"><span class="hs-identifier">MkGraph</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="SMRep.html"><span class="hs-identifier">SMRep</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CostCentre</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Module</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Id</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">RepType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">countConRepArgs</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Literal</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="PrelInfo.html"><span class="hs-identifier">PrelInfo</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">MonadUtils</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapMaybeM</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><a name="line-57"></a><span class="hs-comment">--      Top-level constructors</span><span>
</span><a name="line-58"></a><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-identifier">cgTopRhsCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-61"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Id</span><span>               </span><span class="hs-comment">-- Name of thing bound to this RHS</span><span>
</span><a name="line-62"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span>          </span><span class="hs-comment">-- Id</span><span>
</span><a name="line-63"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="StgCmmClosure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Args</span><span>
</span><a name="line-64"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="StgCmmMonad.html#CgIdInfo"><span class="hs-identifier hs-type">CgIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="StgCmmMonad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><a name="cgTopRhsCon"><a href="StgCmmCon.html#cgTopRhsCon"><span class="hs-identifier">cgTopRhsCon</span></a></a><span> </span><a name="local-6989586621681519286"><a href="#local-6989586621681519286"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621681519287"><a href="#local-6989586621681519287"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621681519288"><a href="#local-6989586621681519288"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621681519289"><a href="#local-6989586621681519289"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681519307"><a href="#local-6989586621681519307"><span class="hs-identifier">id_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgCmmEnv.html#litIdInfo"><span class="hs-identifier hs-var">litIdInfo</span></a><span> </span><a href="#local-6989586621681519286"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519287"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmClosure.html#mkConLFInfo"><span class="hs-identifier hs-var">mkConLFInfo</span></a><span> </span><a href="#local-6989586621681519288"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a href="#local-6989586621681519292"><span class="hs-identifier hs-var">closure_label</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681519307"><span class="hs-identifier hs-var">id_info</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681519293"><span class="hs-identifier hs-var">gen_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-69"></a><span>   </span><a name="local-6989586621681519290"><a href="#local-6989586621681519290"><span class="hs-identifier">name</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621681519287"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-70"></a><span>   </span><a name="local-6989586621681519291"><a href="#local-6989586621681519291"><span class="hs-identifier">caffy</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idCafInfo</span><span> </span><a href="#local-6989586621681519287"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-comment">-- any stgArgHasCafRefs args</span><span>
</span><a name="line-71"></a><span>   </span><a name="local-6989586621681519292"><a href="#local-6989586621681519292"><span class="hs-identifier">closure_label</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkClosureLabel"><span class="hs-identifier hs-var">mkClosureLabel</span></a><span> </span><a href="#local-6989586621681519290"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681519291"><span class="hs-identifier hs-var">caffy</span></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>   </span><a name="local-6989586621681519293"><a href="#local-6989586621681519293"><span class="hs-identifier">gen_code</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-74"></a><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681519294"><a href="#local-6989586621681519294"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="StgCmmMonad.html#getModuleName"><span class="hs-identifier hs-var">getModuleName</span></a><span>
</span><a name="line-75"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621681519286"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-76"></a><span>              </span><span class="hs-comment">-- Windows DLLs have a problem with static cross-DLL refs.</span><span>
</span><a name="line-77"></a><span>              </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isDllConApp</span><span> </span><span class="hs-identifier">dflags</span><span> </span><span class="hs-identifier">this_mod</span><span> </span><a href="#local-6989586621681519286"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681519294"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">fromNonVoid</span><span> </span><span class="hs-identifier">args</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">args</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">countConRepArgs</span><span> </span><span class="hs-identifier hs-var">con</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>        </span><span class="hs-comment">-- LAY IT OUT</span><span>
</span><a name="line-81"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-82"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621681519295"><a href="#local-6989586621681519295"><span class="hs-identifier">tot_wds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-comment">--  #ptr_wds + #nonptr_wds</span><span>
</span><a name="line-83"></a><span>             </span><a name="local-6989586621681519296"><a href="#local-6989586621681519296"><span class="hs-identifier">ptr_wds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-comment">--  #ptr_wds</span><span>
</span><a name="line-84"></a><span>             </span><a name="local-6989586621681519297"><a href="#local-6989586621681519297"><span class="hs-identifier">nv_args_w_offsets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-85"></a><span>                 </span><a href="StgCmmLayout.html#mkVirtHeapOffsetsWithPadding"><span class="hs-identifier hs-var">mkVirtHeapOffsetsWithPadding</span></a><span> </span><a href="#local-6989586621681519286"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="StgCmmLayout.html#StdHeader"><span class="hs-identifier hs-var">StdHeader</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmClosure.html#addArgReps"><span class="hs-identifier hs-var">addArgReps</span></a><span> </span><a href="#local-6989586621681519289"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>            </span><a name="local-6989586621681519298"><a href="#local-6989586621681519298"><span class="hs-identifier">mk_payload</span></a></a><span> </span><span class="hs-special">(</span><a href="StgCmmLayout.html#Padding"><span class="hs-identifier hs-var">Padding</span></a><span> </span><a name="local-6989586621681519301"><a href="#local-6989586621681519301"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthFromBytes</span><span> </span><a href="#local-6989586621681519301"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>            </span><span class="hs-identifier">mk_payload</span><span> </span><span class="hs-special">(</span><a href="StgCmmLayout.html#FieldOff"><span class="hs-identifier hs-var">FieldOff</span></a><span> </span><a name="local-6989586621681519302"><a href="#local-6989586621681519302"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-89"></a><span>                </span><a name="local-6989586621681519303"><a href="#local-6989586621681519303"><span class="hs-identifier">amode</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="StgCmmEnv.html#getArgAmode"><span class="hs-identifier hs-var">getArgAmode</span></a><span> </span><a href="#local-6989586621681519302"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-90"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681519303"><span class="hs-identifier hs-var">amode</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-91"></a><span>                  </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621681519304"><a href="#local-6989586621681519304"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681519304"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-92"></a><span>                  </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;StgCmmCon.cgTopRhsCon&quot;</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span>            </span><a name="local-6989586621681519299"><a href="#local-6989586621681519299"><span class="hs-identifier">nonptr_wds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681519295"><span class="hs-identifier hs-var">tot_wds</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621681519296"><span class="hs-identifier hs-var">ptr_wds</span></a><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>             </span><span class="hs-comment">-- we're not really going to emit an info table, so having</span><span>
</span><a name="line-97"></a><span>             </span><span class="hs-comment">-- to make a CmmInfoTable is a bit overkill, but mkStaticClosureFields</span><span>
</span><a name="line-98"></a><span>             </span><span class="hs-comment">-- needs to poke around inside it.</span><span>
</span><a name="line-99"></a><span>            </span><a name="local-6989586621681519300"><a href="#local-6989586621681519300"><span class="hs-identifier">info_tbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgCmmClosure.html#mkDataConInfoTable"><span class="hs-identifier hs-var">mkDataConInfoTable</span></a><span> </span><a href="#local-6989586621681519286"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519288"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621681519296"><span class="hs-identifier hs-var">ptr_wds</span></a><span> </span><a href="#local-6989586621681519299"><span class="hs-identifier hs-var">nonptr_wds</span></a><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681519305"><a href="#local-6989586621681519305"><span class="hs-identifier">payload</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681519298"><span class="hs-identifier hs-var">mk_payload</span></a><span> </span><a href="#local-6989586621681519297"><span class="hs-identifier hs-var">nv_args_w_offsets</span></a><span>
</span><a name="line-103"></a><span>                </span><span class="hs-comment">-- NB1: nv_args_w_offsets is sorted into ptrs then non-ptrs</span><span>
</span><a name="line-104"></a><span>                </span><span class="hs-comment">-- NB2: all the amodes should be Lits!</span><span>
</span><a name="line-105"></a><span>                </span><span class="hs-comment">--      TODO (osa): Why?</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681519306"><a href="#local-6989586621681519306"><span class="hs-identifier">closure_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgCmmHeap.html#mkStaticClosureFields"><span class="hs-identifier hs-var">mkStaticClosureFields</span></a><span>
</span><a name="line-108"></a><span>                             </span><a href="#local-6989586621681519286"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-109"></a><span>                             </span><a href="#local-6989586621681519300"><span class="hs-identifier hs-var">info_tbl</span></a><span>
</span><a name="line-110"></a><span>                             </span><span class="hs-identifier hs-var">dontCareCCS</span><span>                </span><span class="hs-comment">-- Because it's static data</span><span>
</span><a name="line-111"></a><span>                             </span><a href="#local-6989586621681519291"><span class="hs-identifier hs-var">caffy</span></a><span>                      </span><span class="hs-comment">-- Has CAF refs</span><span>
</span><a name="line-112"></a><span>                             </span><a href="#local-6989586621681519305"><span class="hs-identifier hs-var">payload</span></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span>                </span><span class="hs-comment">-- BUILD THE OBJECT</span><span>
</span><a name="line-115"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="StgCmmUtils.html#emitDataLits"><span class="hs-identifier hs-var">emitDataLits</span></a><span> </span><a href="#local-6989586621681519292"><span class="hs-identifier hs-var">closure_label</span></a><span> </span><a href="#local-6989586621681519306"><span class="hs-identifier hs-var">closure_rep</span></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><a name="line-121"></a><span class="hs-comment">--      Lay out and allocate non-top-level constructors</span><span>
</span><a name="line-122"></a><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-identifier">buildDynCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span>                 </span><span class="hs-comment">-- Name of the thing to which this constr will</span><span>
</span><a name="line-125"></a><span>                                  </span><span class="hs-comment">-- be bound</span><span>
</span><a name="line-126"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>               </span><span class="hs-comment">-- is it genuinely bound to that name, or just</span><span>
</span><a name="line-127"></a><span>                                  </span><span class="hs-comment">-- for profiling?</span><span>
</span><a name="line-128"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CostCentreStack</span><span>    </span><span class="hs-comment">-- Where to grab cost centre from;</span><span>
</span><a name="line-129"></a><span>                                  </span><span class="hs-comment">-- current CCS if currentOrSubsumedCCS</span><span>
</span><a name="line-130"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span>            </span><span class="hs-comment">-- The data constructor</span><span>
</span><a name="line-131"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="StgCmmClosure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Its args</span><span>
</span><a name="line-132"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgCmmMonad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmMonad.html#CgIdInfo"><span class="hs-identifier hs-type">CgIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="StgCmmMonad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a><span> </span><a href="MkGraph.html#CmmAGraph"><span class="hs-identifier hs-type">CmmAGraph</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>               </span><span class="hs-comment">-- Return details about how to find it and initialization code</span><span>
</span><a name="line-134"></a><a name="buildDynCon"><a href="StgCmmCon.html#buildDynCon"><span class="hs-identifier">buildDynCon</span></a></a><span> </span><a name="local-6989586621681519308"><a href="#local-6989586621681519308"><span class="hs-identifier">binder</span></a></a><span> </span><a name="local-6989586621681519309"><a href="#local-6989586621681519309"><span class="hs-identifier">actually_bound</span></a></a><span> </span><a name="local-6989586621681519310"><a href="#local-6989586621681519310"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-6989586621681519311"><a href="#local-6989586621681519311"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621681519312"><a href="#local-6989586621681519312"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-135"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681519313"><a href="#local-6989586621681519313"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-136"></a><span>         </span><a href="StgCmmCon.html#buildDynCon%27"><span class="hs-identifier hs-var">buildDynCon'</span></a><span> </span><a href="#local-6989586621681519313"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621681519313"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681519308"><span class="hs-identifier hs-var">binder</span></a><span> </span><a href="#local-6989586621681519309"><span class="hs-identifier hs-var">actually_bound</span></a><span> </span><a href="#local-6989586621681519310"><span class="hs-identifier hs-var">cc</span></a><span> </span><a href="#local-6989586621681519311"><span class="hs-identifier hs-var">con</span></a><span> </span><a href="#local-6989586621681519312"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-identifier">buildDynCon'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-140"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Platform</span><span>
</span><a name="line-141"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-142"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CostCentreStack</span><span>
</span><a name="line-143"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span>
</span><a name="line-144"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="StgCmmClosure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a><span> </span><a href="StgSyn.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a><span class="hs-special">]</span><span>
</span><a name="line-145"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgCmmMonad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmMonad.html#CgIdInfo"><span class="hs-identifier hs-type">CgIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="StgCmmMonad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a><span> </span><a href="MkGraph.html#CmmAGraph"><span class="hs-identifier hs-type">CmmAGraph</span></a><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">{- We used to pass a boolean indicating whether all the
args were of size zero, so we could use a static
constructor; but I concluded that it just isn't worth it.
Now I/O uses unboxed tuples there just aren't any constructors
with all size-zero args.

The reason for having a separate argument, rather than looking at
the addr modes of the args is that we may be in a &quot;knot&quot;, and
premature looking at the args will cause the compiler to black-hole!
-}</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-------- buildDynCon': Nullary constructors --------------</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- First we deal with the case of zero-arity constructors.  They</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- will probably be unfolded, so we don't expect to see this case much,</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- if at all, but it does no harm, and sets the scene for characters.</span><span>
</span><a name="line-163"></a><span class="hs-comment">--</span><span>
</span><a name="line-164"></a><span class="hs-comment">-- In the case of zero-arity constructors, or, more accurately, those</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- which have exclusively size-zero (VoidRep) args, we generate no code</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- at all.</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><a name="buildDynCon%27"><a href="StgCmmCon.html#buildDynCon%27"><span class="hs-identifier">buildDynCon'</span></a></a><span> </span><a name="local-6989586621681519314"><a href="#local-6989586621681519314"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681519315"><a href="#local-6989586621681519315"><span class="hs-identifier">binder</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681519316"><a href="#local-6989586621681519316"><span class="hs-identifier">_cc</span></a></a><span> </span><a name="local-6989586621681519317"><a href="#local-6989586621681519317"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-169"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNullaryRepDataCon</span><span> </span><a href="#local-6989586621681519317"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-170"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="StgCmmEnv.html#litIdInfo"><span class="hs-identifier hs-var">litIdInfo</span></a><span> </span><a href="#local-6989586621681519314"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519315"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmClosure.html#mkConLFInfo"><span class="hs-identifier hs-var">mkConLFInfo</span></a><span> </span><a href="#local-6989586621681519317"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>                </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><span class="hs-special">(</span><a href="CLabel.html#mkClosureLabel"><span class="hs-identifier hs-var">mkClosureLabel</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConName</span><span> </span><a href="#local-6989586621681519317"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idCafInfo</span><span> </span><a href="#local-6989586621681519315"><span class="hs-identifier hs-var">binder</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-172"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><a href="MkGraph.html#mkNop"><span class="hs-identifier hs-var">mkNop</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-------- buildDynCon': Charlike and Intlike constructors -----------</span><span>
</span><a name="line-175"></a><span class="hs-comment">{- The following three paragraphs about @Char@-like and @Int@-like
closures are obsolete, but I don't understand the details well enough
to properly word them, sorry. I've changed the treatment of @Char@s to
be analogous to @Int@s: only a subset is preallocated, because @Char@
has now 31 bits. Only literals are handled here. -- Qrczak

Now for @Char@-like closures.  We generate an assignment of the
address of the closure to a temporary.  It would be possible simply to
generate no code, and record the addressing mode in the environment,
but we'd have to be careful if the argument wasn't a constant --- so
for simplicity we just always assign to a temporary.

Last special case: @Int@-like closures.  We only special-case the
situation in which the argument is a literal in the range
@mIN_INTLIKE@..@mAX_INTLILKE@.  NB: for @Char@-like closures we can
work with any old argument, but for @Int@-like ones the argument has
to be a literal.  Reason: @Char@ like closures have an argument type
which is guaranteed in range.

Because of this, we use can safely return an addressing mode.

We don't support this optimisation when compiling into Windows DLLs yet
because they don't support cross package data references well.
-}</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-identifier">buildDynCon'</span><span> </span><a name="local-6989586621681519318"><a href="#local-6989586621681519318"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621681519319"><a href="#local-6989586621681519319"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621681519320"><a href="#local-6989586621681519320"><span class="hs-identifier">binder</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681519321"><a href="#local-6989586621681519321"><span class="hs-identifier">_cc</span></a></a><span> </span><a name="local-6989586621681519322"><a href="#local-6989586621681519322"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621681519323"><a href="#local-6989586621681519323"><span class="hs-identifier">arg</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-201"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="PrelInfo.html#maybeIntLikeCon"><span class="hs-identifier hs-var">maybeIntLikeCon</span></a><span> </span><a href="#local-6989586621681519322"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621681519319"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">positionIndependent</span><span> </span><a href="#local-6989586621681519318"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="StgCmmClosure.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitNumber</span><span> </span><span class="hs-identifier hs-var">LitNumInt</span><span> </span><a name="local-6989586621681519324"><a href="#local-6989586621681519324"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681519323"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-204"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681519324"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mAX_INTLIKE</span><span> </span><a href="#local-6989586621681519318"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Comparisons at type Integer!</span><span>
</span><a name="line-205"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681519324"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mIN_INTLIKE</span><span> </span><a href="#local-6989586621681519318"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ...ditto...</span><span>
</span><a name="line-206"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681519325"><a href="#local-6989586621681519325"><span class="hs-identifier">intlike_lbl</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkCmmClosureLabel"><span class="hs-identifier hs-var">mkCmmClosureLabel</span></a><span> </span><span class="hs-identifier hs-var">rtsUnitId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;stg_INTLIKE&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>              </span><a name="local-6989586621681519326"><a href="#local-6989586621681519326"><span class="hs-identifier">val_int</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681519324"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-208"></a><span>              </span><a name="local-6989586621681519327"><a href="#local-6989586621681519327"><span class="hs-identifier">offsetW</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681519326"><span class="hs-identifier hs-var">val_int</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">mIN_INTLIKE</span><span> </span><a href="#local-6989586621681519318"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621681519318"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-209"></a><span>                </span><span class="hs-comment">-- INTLIKE closures consist of a header and one word payload</span><span>
</span><a name="line-210"></a><span>              </span><a name="local-6989586621681519328"><a href="#local-6989586621681519328"><span class="hs-identifier">intlike_amode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmUtils.html#cmmLabelOffW"><span class="hs-identifier hs-var">cmmLabelOffW</span></a><span> </span><a href="#local-6989586621681519318"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519325"><span class="hs-identifier hs-var">intlike_lbl</span></a><span> </span><a href="#local-6989586621681519327"><span class="hs-identifier hs-var">offsetW</span></a><span>
</span><a name="line-211"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="StgCmmEnv.html#litIdInfo"><span class="hs-identifier hs-var">litIdInfo</span></a><span> </span><a href="#local-6989586621681519318"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519320"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmClosure.html#mkConLFInfo"><span class="hs-identifier hs-var">mkConLFInfo</span></a><span> </span><a href="#local-6989586621681519322"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681519328"><span class="hs-identifier hs-var">intlike_amode</span></a><span>
</span><a name="line-212"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="MkGraph.html#mkNop"><span class="hs-identifier hs-var">mkNop</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-identifier">buildDynCon'</span><span> </span><a name="local-6989586621681519329"><a href="#local-6989586621681519329"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621681519330"><a href="#local-6989586621681519330"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621681519331"><a href="#local-6989586621681519331"><span class="hs-identifier">binder</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681519332"><a href="#local-6989586621681519332"><span class="hs-identifier">_cc</span></a></a><span> </span><a name="local-6989586621681519333"><a href="#local-6989586621681519333"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621681519334"><a href="#local-6989586621681519334"><span class="hs-identifier">arg</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-215"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="PrelInfo.html#maybeCharLikeCon"><span class="hs-identifier hs-var">maybeCharLikeCon</span></a><span> </span><a href="#local-6989586621681519333"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-216"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621681519330"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">positionIndependent</span><span> </span><a href="#local-6989586621681519329"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="StgCmmClosure.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a><span> </span><span class="hs-special">(</span><a href="StgSyn.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitChar</span><span> </span><a name="local-6989586621681519335"><a href="#local-6989586621681519335"><span class="hs-identifier">val</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681519334"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-218"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681519336"><a href="#local-6989586621681519336"><span class="hs-identifier">val_int</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621681519335"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681519336"><span class="hs-identifier hs-var">val_int</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier hs-var">mAX_CHARLIKE</span><span> </span><a href="#local-6989586621681519329"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-220"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681519336"><span class="hs-identifier hs-var">val_int</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier hs-var">mIN_CHARLIKE</span><span> </span><a href="#local-6989586621681519329"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-221"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681519337"><a href="#local-6989586621681519337"><span class="hs-identifier">charlike_lbl</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkCmmClosureLabel"><span class="hs-identifier hs-var">mkCmmClosureLabel</span></a><span> </span><span class="hs-identifier hs-var">rtsUnitId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;stg_CHARLIKE&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>              </span><a name="local-6989586621681519338"><a href="#local-6989586621681519338"><span class="hs-identifier">offsetW</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681519336"><span class="hs-identifier hs-var">val_int</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">mIN_CHARLIKE</span><span> </span><a href="#local-6989586621681519329"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="SMRep.html#fixedHdrSizeW"><span class="hs-identifier hs-var">fixedHdrSizeW</span></a><span> </span><a href="#local-6989586621681519329"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>                </span><span class="hs-comment">-- CHARLIKE closures consist of a header and one word payload</span><span>
</span><a name="line-224"></a><span>              </span><a name="local-6989586621681519339"><a href="#local-6989586621681519339"><span class="hs-identifier">charlike_amode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmUtils.html#cmmLabelOffW"><span class="hs-identifier hs-var">cmmLabelOffW</span></a><span> </span><a href="#local-6989586621681519329"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519337"><span class="hs-identifier hs-var">charlike_lbl</span></a><span> </span><a href="#local-6989586621681519338"><span class="hs-identifier hs-var">offsetW</span></a><span>
</span><a name="line-225"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="StgCmmEnv.html#litIdInfo"><span class="hs-identifier hs-var">litIdInfo</span></a><span> </span><a href="#local-6989586621681519329"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519331"><span class="hs-identifier hs-var">binder</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmClosure.html#mkConLFInfo"><span class="hs-identifier hs-var">mkConLFInfo</span></a><span> </span><a href="#local-6989586621681519333"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681519339"><span class="hs-identifier hs-var">charlike_amode</span></a><span>
</span><a name="line-226"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="MkGraph.html#mkNop"><span class="hs-identifier hs-var">mkNop</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-comment">-------- buildDynCon': the general case -----------</span><span>
</span><a name="line-229"></a><span class="hs-identifier">buildDynCon'</span><span> </span><a name="local-6989586621681519340"><a href="#local-6989586621681519340"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681519341"><a href="#local-6989586621681519341"><span class="hs-identifier">binder</span></a></a><span> </span><a name="local-6989586621681519342"><a href="#local-6989586621681519342"><span class="hs-identifier">actually_bound</span></a></a><span> </span><a name="local-6989586621681519343"><a href="#local-6989586621681519343"><span class="hs-identifier">ccs</span></a></a><span> </span><a name="local-6989586621681519344"><a href="#local-6989586621681519344"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621681519345"><a href="#local-6989586621681519345"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-230"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681519358"><a href="#local-6989586621681519358"><span class="hs-identifier">id_info</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681519359"><a href="#local-6989586621681519359"><span class="hs-identifier">reg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="StgCmmEnv.html#rhsIdInfo"><span class="hs-identifier hs-var">rhsIdInfo</span></a><span> </span><a href="#local-6989586621681519341"><span class="hs-identifier hs-var">binder</span></a><span> </span><a href="#local-6989586621681519346"><span class="hs-identifier hs-var">lf_info</span></a><span>
</span><a name="line-231"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681519358"><span class="hs-identifier hs-var">id_info</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681519347"><span class="hs-identifier hs-var">gen_code</span></a><span> </span><a href="#local-6989586621681519359"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-233"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-234"></a><span>  </span><a name="local-6989586621681519346"><a href="#local-6989586621681519346"><span class="hs-identifier">lf_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgCmmClosure.html#mkConLFInfo"><span class="hs-identifier hs-var">mkConLFInfo</span></a><span> </span><a href="#local-6989586621681519344"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span>  </span><a name="local-6989586621681519347"><a href="#local-6989586621681519347"><span class="hs-identifier">gen_code</span></a></a><span> </span><a name="local-6989586621681519348"><a href="#local-6989586621681519348"><span class="hs-identifier">reg</span></a></a><span>
</span><a name="line-237"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681519351"><a href="#local-6989586621681519351"><span class="hs-identifier">tot_wds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681519352"><a href="#local-6989586621681519352"><span class="hs-identifier">ptr_wds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681519353"><a href="#local-6989586621681519353"><span class="hs-identifier">args_w_offsets</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="StgCmmLayout.html#mkVirtConstrOffsets"><span class="hs-identifier hs-var">mkVirtConstrOffsets</span></a><span> </span><a href="#local-6989586621681519340"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmClosure.html#addArgReps"><span class="hs-identifier hs-var">addArgReps</span></a><span> </span><a href="#local-6989586621681519345"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>                </span><a name="local-6989586621681519354"><a href="#local-6989586621681519354"><span class="hs-identifier">nonptr_wds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681519351"><span class="hs-identifier hs-var">tot_wds</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621681519352"><span class="hs-identifier hs-var">ptr_wds</span></a><span>
</span><a name="line-240"></a><span>                </span><a name="local-6989586621681519355"><a href="#local-6989586621681519355"><span class="hs-identifier">info_tbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgCmmClosure.html#mkDataConInfoTable"><span class="hs-identifier hs-var">mkDataConInfoTable</span></a><span> </span><a href="#local-6989586621681519340"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519344"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-241"></a><span>                                </span><a href="#local-6989586621681519352"><span class="hs-identifier hs-var">ptr_wds</span></a><span> </span><a href="#local-6989586621681519354"><span class="hs-identifier hs-var">nonptr_wds</span></a><span>
</span><a name="line-242"></a><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681519356"><a href="#local-6989586621681519356"><span class="hs-identifier">ticky_name</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681519342"><span class="hs-identifier hs-var">actually_bound</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681519341"><span class="hs-identifier hs-var">binder</span></a><span>
</span><a name="line-243"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>          </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681519357"><a href="#local-6989586621681519357"><span class="hs-identifier">hp_plus_n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="StgCmmHeap.html#allocDynClosure"><span class="hs-identifier hs-var">allocDynClosure</span></a><span> </span><a href="#local-6989586621681519356"><span class="hs-identifier hs-var">ticky_name</span></a><span> </span><a href="#local-6989586621681519355"><span class="hs-identifier hs-var">info_tbl</span></a><span> </span><a href="#local-6989586621681519346"><span class="hs-identifier hs-var">lf_info</span></a><span>
</span><a name="line-246"></a><span>                                          </span><a href="#local-6989586621681519349"><span class="hs-identifier hs-var">use_cc</span></a><span> </span><a href="#local-6989586621681519350"><span class="hs-identifier hs-var">blame_cc</span></a><span> </span><a href="#local-6989586621681519353"><span class="hs-identifier hs-var">args_w_offsets</span></a><span>
</span><a name="line-247"></a><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="StgCmmEnv.html#mkRhsInit"><span class="hs-identifier hs-var">mkRhsInit</span></a><span> </span><a href="#local-6989586621681519340"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519348"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621681519346"><span class="hs-identifier hs-var">lf_info</span></a><span> </span><a href="#local-6989586621681519357"><span class="hs-identifier hs-var">hp_plus_n</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-248"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-249"></a><span>      </span><a name="local-6989586621681519349"><a href="#local-6989586621681519349"><span class="hs-identifier">use_cc</span></a></a><span>      </span><span class="hs-comment">-- cost-centre to stick in the object</span><span>
</span><a name="line-250"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isCurrentCCS</span><span> </span><a href="#local-6989586621681519343"><span class="hs-identifier hs-var">ccs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmUtils.html#cccsExpr"><span class="hs-identifier hs-var">cccsExpr</span></a><span>
</span><a name="line-251"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;buildDynCon: non-current CCS not implemented&quot;</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span>      </span><a name="local-6989586621681519350"><a href="#local-6989586621681519350"><span class="hs-identifier">blame_cc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681519349"><span class="hs-identifier hs-var">use_cc</span></a><span> </span><span class="hs-comment">-- cost-centre on which to blame the alloc (same)</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><a name="line-257"></a><span class="hs-comment">--      Binding constructor arguments</span><span>
</span><a name="line-258"></a><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-identifier">bindConArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">AltCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="StgCmmClosure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a><span> </span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgCmmMonad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a><span class="hs-special">]</span><span>
</span><a name="line-261"></a><span class="hs-comment">-- bindConArgs is called from cgAlt of a case</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- (bindConArgs con args) augments the environment with bindings for the</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- binders args, assuming that we have just returned from a 'case' which</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- found a con</span><span>
</span><a name="line-265"></a><a name="bindConArgs"><a href="StgCmmCon.html#bindConArgs"><span class="hs-identifier">bindConArgs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataAlt</span><span> </span><a name="local-6989586621681519360"><a href="#local-6989586621681519360"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681519361"><a href="#local-6989586621681519361"><span class="hs-identifier">base</span></a></a><span> </span><a name="local-6989586621681519362"><a href="#local-6989586621681519362"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-266"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isUnboxedTupleCon</span><span> </span><span class="hs-identifier hs-var">con</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681519363"><a href="#local-6989586621681519363"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-268"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681519364"><a href="#local-6989586621681519364"><span class="hs-identifier">args_w_offsets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgCmmLayout.html#mkVirtConstrOffsets"><span class="hs-identifier hs-var">mkVirtConstrOffsets</span></a><span> </span><a href="#local-6989586621681519363"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmClosure.html#addIdReps"><span class="hs-identifier hs-var">addIdReps</span></a><span> </span><a href="#local-6989586621681519362"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-269"></a><span>           </span><a name="local-6989586621681519365"><a href="#local-6989586621681519365"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="StgCmmClosure.html#tagForCon"><span class="hs-identifier hs-var">tagForCon</span></a><span> </span><a href="#local-6989586621681519363"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519360"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span>           </span><span class="hs-comment">-- The binding below forces the masking out of the tag bits</span><span>
</span><a name="line-272"></a><span>           </span><span class="hs-comment">-- when accessing the constructor field.</span><span>
</span><a name="line-273"></a><span>           </span><span class="hs-identifier">bind_arg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="StgCmmClosure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a><span> </span><span class="hs-identifier hs-type">Id</span><span class="hs-special">,</span><span> </span><a href="SMRep.html#ByteOff"><span class="hs-identifier hs-type">ByteOff</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="StgCmmMonad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>           </span><a name="local-6989586621681519366"><a href="#local-6989586621681519366"><span class="hs-identifier">bind_arg</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681519367"><a href="#local-6989586621681519367"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="StgCmmClosure.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a><span> </span><a name="local-6989586621681519368"><a href="#local-6989586621681519368"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681519369"><a href="#local-6989586621681519369"><span class="hs-identifier">offset</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isDeadBinder</span><span> </span><a href="#local-6989586621681519368"><span class="hs-identifier hs-var">b</span></a><span>  </span><span class="hs-comment">-- See Note [Dead-binder optimisation] in StgCmmExpr</span><span>
</span><a name="line-276"></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-277"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-278"></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="StgCmmMonad.html#emit"><span class="hs-identifier hs-var">emit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="StgCmmUtils.html#mkTaggedObjectLoad"><span class="hs-identifier hs-var">mkTaggedObjectLoad</span></a><span> </span><a href="#local-6989586621681519363"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="StgCmmEnv.html#idToReg"><span class="hs-identifier hs-var">idToReg</span></a><span> </span><a href="#local-6989586621681519363"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681519367"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>                                              </span><a href="#local-6989586621681519361"><span class="hs-identifier hs-var">base</span></a><span> </span><a href="#local-6989586621681519369"><span class="hs-identifier hs-var">offset</span></a><span> </span><a href="#local-6989586621681519365"><span class="hs-identifier hs-var">tag</span></a><span>
</span><a name="line-280"></a><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="StgCmmEnv.html#bindArgToReg"><span class="hs-identifier hs-var">bindArgToReg</span></a><span> </span><a href="#local-6989586621681519367"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span>       </span><span class="hs-identifier hs-var">mapMaybeM</span><span> </span><a href="#local-6989586621681519366"><span class="hs-identifier hs-var">bind_arg</span></a><span> </span><a href="#local-6989586621681519364"><span class="hs-identifier hs-var">args_w_offsets</span></a><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-identifier">bindConArgs</span><span> </span><a name="local-6989586621681519370"><a href="#local-6989586621681519370"><span class="hs-identifier">_other_con</span></a></a><span> </span><a name="local-6989586621681519371"><a href="#local-6989586621681519371"><span class="hs-identifier">_base</span></a></a><span> </span><a name="local-6989586621681519372"><a href="#local-6989586621681519372"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-285"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-286"></a></pre></body></html>