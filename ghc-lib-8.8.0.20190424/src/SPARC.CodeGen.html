<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Generating machine code (instruction selection)</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- (c) The University of Glasgow 1996-2013</span><span>
</span><a name="line-8"></a><span class="hs-comment">--</span><span>
</span><a name="line-9"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">SPARC.CodeGen</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>        </span><a href="SPARC.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier hs-var">cmmTopCodeGen</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="SPARC.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier hs-var">generateJumpTableForInstr</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-16"></a><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">where</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
#include &quot;nativeGen/NCG.h&quot;
#include &quot;../includes/MachDeps.h&quot;
</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- NCG stuff:</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.Base.html"><span class="hs-identifier">SPARC.Base</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.CodeGen.Sanity.html"><span class="hs-identifier">SPARC.CodeGen.Sanity</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.CodeGen.Amode.html"><span class="hs-identifier">SPARC.CodeGen.Amode</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.CodeGen.CondCode.html"><span class="hs-identifier">SPARC.CodeGen.CondCode</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.CodeGen.Gen64.html"><span class="hs-identifier">SPARC.CodeGen.Gen64</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.CodeGen.Gen32.html"><span class="hs-identifier">SPARC.CodeGen.Gen32</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.CodeGen.Base.html"><span class="hs-identifier">SPARC.CodeGen.Base</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.Ppr.html"><span class="hs-identifier">SPARC.Ppr</span></a><span>        </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.Instr.html"><span class="hs-identifier">SPARC.Instr</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.Imm.html"><span class="hs-identifier">SPARC.Imm</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.AddrMode.html"><span class="hs-identifier">SPARC.AddrMode</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.Regs.html"><span class="hs-identifier">SPARC.Regs</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="SPARC.Stack.html"><span class="hs-identifier">SPARC.Stack</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Instruction.html"><span class="hs-identifier">Instruction</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Format.html"><span class="hs-identifier">Format</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="NCGMonad.html"><span class="hs-identifier">NCGMonad</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">-- Our intermediate code:</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="BlockId.html"><span class="hs-identifier">BlockId</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="Cmm.html"><span class="hs-identifier">Cmm</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="CmmUtils.html"><span class="hs-identifier">CmmUtils</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="CmmSwitch.html"><span class="hs-identifier">CmmSwitch</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Block.html"><span class="hs-identifier">Hoopl.Block</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Graph.html"><span class="hs-identifier">Hoopl.Graph</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="PIC.html"><span class="hs-identifier">PIC</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="Reg.html"><span class="hs-identifier">Reg</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="CLabel.html"><span class="hs-identifier">CLabel</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="CPrim.html"><span class="hs-identifier">CPrim</span></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- The rest:</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">OrdList</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">mapAndUnzipM</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-comment">-- | Top level code generation</span><span>
</span><a name="line-67"></a><span class="hs-identifier">cmmTopCodeGen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a><span>
</span><a name="line-68"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span> </span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><a name="cmmTopCodeGen"><a href="SPARC.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier">cmmTopCodeGen</span></a></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a name="local-6989586621684777553"><a href="#local-6989586621684777553"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621684777554"><a href="#local-6989586621684777554"><span class="hs-identifier">lab</span></a></a><span> </span><a name="local-6989586621684777555"><a href="#local-6989586621684777555"><span class="hs-identifier">live</span></a></a><span> </span><a name="local-6989586621684777556"><a href="#local-6989586621684777556"><span class="hs-identifier">graph</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777557"><a href="#local-6989586621684777557"><span class="hs-identifier">blocks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmUtils.html#toBlockListEntryFirst"><span class="hs-identifier hs-var">toBlockListEntryFirst</span></a><span> </span><a href="#local-6989586621684777556"><span class="hs-identifier hs-var">graph</span></a><span>
</span><a name="line-72"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684777558"><a href="#local-6989586621684777558"><span class="hs-identifier">nat_blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777559"><a href="#local-6989586621684777559"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAndUnzipM</span><span> </span><a href="SPARC.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier hs-var">basicBlockCodeGen</span></a><span> </span><a href="#local-6989586621684777557"><span class="hs-identifier hs-var">blocks</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777560"><a href="#local-6989586621684777560"><span class="hs-identifier">proc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a href="#local-6989586621684777553"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621684777554"><span class="hs-identifier hs-var">lab</span></a><span> </span><a href="#local-6989586621684777555"><span class="hs-identifier hs-var">live</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684777558"><span class="hs-identifier hs-var">nat_blocks</span></a><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777561"><a href="#local-6989586621684777561"><span class="hs-identifier">tops</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684777560"><span class="hs-identifier hs-var">proc</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684777559"><span class="hs-identifier hs-var">statics</span></a><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684777561"><span class="hs-identifier hs-var">tops</span></a><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-identifier">cmmTopCodeGen</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a name="local-6989586621684777562"><a href="#local-6989586621684777562"><span class="hs-identifier">sec</span></a></a><span> </span><a name="local-6989586621684777563"><a href="#local-6989586621684777563"><span class="hs-identifier">dat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a href="#local-6989586621684777562"><span class="hs-identifier hs-var">sec</span></a><span> </span><a href="#local-6989586621684777563"><span class="hs-identifier hs-var">dat</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- no translation, we just use CmmStatic</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">-- | Do code generation on a single block of CMM code.</span><span>
</span><a name="line-84"></a><span class="hs-comment">--      code generation may introduce new basic block boundaries, which</span><span>
</span><a name="line-85"></a><span class="hs-comment">--      are indicated by the NEWBLOCK instruction.  We must split up the</span><span>
</span><a name="line-86"></a><span class="hs-comment">--      instruction stream into basic blocks again.  Also, we extract</span><span>
</span><a name="line-87"></a><span class="hs-comment">--      LDATAs here too.</span><span>
</span><a name="line-88"></a><span class="hs-identifier">basicBlockCodeGen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a><span>
</span><a name="line-89"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a><span> </span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-90"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span> </span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><a name="basicBlockCodeGen"><a href="SPARC.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier">basicBlockCodeGen</span></a></a><span> </span><a name="local-6989586621684777564"><a href="#local-6989586621684777564"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684777565"><a href="#local-6989586621684777565"><span class="hs-identifier">nodes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777566"><a href="#local-6989586621684777566"><span class="hs-identifier">tail</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a><span> </span><a href="#local-6989586621684777564"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-94"></a><span>      </span><a name="local-6989586621684777567"><a href="#local-6989586621684777567"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a><span> </span><a href="#local-6989586621684777564"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-95"></a><span>      </span><a name="local-6989586621684777568"><a href="#local-6989586621684777568"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a><span> </span><a href="#local-6989586621684777565"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-96"></a><span>  </span><a name="local-6989586621684777569"><a href="#local-6989586621684777569"><span class="hs-identifier">mid_instrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.html#stmtsToInstrs"><span class="hs-identifier hs-var">stmtsToInstrs</span></a><span> </span><a href="#local-6989586621684777568"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-97"></a><span>  </span><a name="local-6989586621684777570"><a href="#local-6989586621684777570"><span class="hs-identifier">tail_instrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621684777566"><span class="hs-identifier hs-var">tail</span></a><span>
</span><a name="line-98"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777571"><a href="#local-6989586621684777571"><span class="hs-identifier">instrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684777569"><span class="hs-identifier hs-var">mid_instrs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684777570"><span class="hs-identifier hs-var">tail_instrs</span></a><span>
</span><a name="line-99"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-100"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684777572"><a href="#local-6989586621684777572"><span class="hs-identifier">top</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777573"><a href="#local-6989586621684777573"><span class="hs-identifier">other_blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777574"><a href="#local-6989586621684777574"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldrOL</span><span> </span><a href="#local-6989586621684777575"><span class="hs-identifier hs-var">mkBlocks</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777571"><span class="hs-identifier hs-var">instrs</span></a><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>        </span><a name="local-6989586621684777575"><a href="#local-6989586621684777575"><span class="hs-identifier">mkBlocks</span></a></a><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a name="local-6989586621684777577"><a href="#local-6989586621684777577"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684777578"><a href="#local-6989586621684777578"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777579"><a href="#local-6989586621684777579"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777580"><a href="#local-6989586621684777580"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621684777577"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684777578"><span class="hs-identifier hs-var">instrs</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684777579"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684777580"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span>        </span><span class="hs-identifier">mkBlocks</span><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#LDATA"><span class="hs-identifier hs-var">LDATA</span></a><span> </span><a name="local-6989586621684777581"><a href="#local-6989586621684777581"><span class="hs-identifier">sec</span></a></a><span> </span><a name="local-6989586621684777582"><a href="#local-6989586621684777582"><span class="hs-identifier">dat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684777583"><a href="#local-6989586621684777583"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777584"><a href="#local-6989586621684777584"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777585"><a href="#local-6989586621684777585"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777583"><span class="hs-identifier hs-var">instrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684777584"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a href="#local-6989586621684777581"><span class="hs-identifier hs-var">sec</span></a><span> </span><a href="#local-6989586621684777582"><span class="hs-identifier hs-var">dat</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684777585"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span>        </span><span class="hs-identifier">mkBlocks</span><span> </span><a name="local-6989586621684777586"><a href="#local-6989586621684777586"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684777587"><a href="#local-6989586621684777587"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777588"><a href="#local-6989586621684777588"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684777589"><a href="#local-6989586621684777589"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777586"><span class="hs-identifier hs-var">instr</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684777587"><span class="hs-identifier hs-var">instrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684777588"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684777589"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span>        </span><span class="hs-comment">-- do intra-block sanity checking</span><span>
</span><a name="line-113"></a><span>        </span><a name="local-6989586621684777576"><a href="#local-6989586621684777576"><span class="hs-identifier">blocksChecked</span></a></a><span>
</span><a name="line-114"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="SPARC.CodeGen.Sanity.html#checkBlock"><span class="hs-identifier hs-var">checkBlock</span></a><span> </span><a href="#local-6989586621684777564"><span class="hs-identifier hs-var">block</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>                </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621684777567"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684777572"><span class="hs-identifier hs-var">top</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684777573"><span class="hs-identifier hs-var">other_blocks</span></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777576"><span class="hs-identifier hs-var">blocksChecked</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684777574"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- | Convert some Cmm statements to SPARC instructions.</span><span>
</span><a name="line-121"></a><span class="hs-identifier">stmtsToInstrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="#local-6989586621684777551"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621684777552"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-122"></a><a name="stmtsToInstrs"><a href="SPARC.CodeGen.html#stmtsToInstrs"><span class="hs-identifier">stmtsToInstrs</span></a></a><span> </span><a name="local-6989586621684777590"><a href="#local-6989586621684777590"><span class="hs-identifier">stmts</span></a></a><span>
</span><a name="line-123"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684777591"><a href="#local-6989586621684777591"><span class="hs-identifier">instrss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="SPARC.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621684777590"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-124"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621684777591"><span class="hs-identifier hs-var">instrss</span></a><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-identifier">stmtToInstrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="#local-6989586621684777549"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621684777550"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-128"></a><a name="stmtToInstrs"><a href="SPARC.CodeGen.html#stmtToInstrs"><span class="hs-identifier">stmtToInstrs</span></a></a><span> </span><a name="local-6989586621684777592"><a href="#local-6989586621684777592"><span class="hs-identifier">stmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-129"></a><span>  </span><a name="local-6989586621684777593"><a href="#local-6989586621684777593"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-130"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777592"><span class="hs-identifier hs-var">stmt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-131"></a><span>    </span><a href="CmmNode.html#CmmComment"><span class="hs-identifier hs-var">CmmComment</span></a><span> </span><a name="local-6989586621684777594"><a href="#local-6989586621684777594"><span class="hs-identifier">s</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#COMMENT"><span class="hs-identifier hs-var">COMMENT</span></a><span> </span><a href="#local-6989586621684777594"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>    </span><a href="CmmNode.html#CmmTick"><span class="hs-identifier hs-var">CmmTick</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-133"></a><span>    </span><a href="CmmNode.html#CmmUnwind"><span class="hs-identifier hs-var">CmmUnwind</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span>    </span><a href="CmmNode.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a><span> </span><a name="local-6989586621684777595"><a href="#local-6989586621684777595"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684777596"><a href="#local-6989586621684777596"><span class="hs-identifier">src</span></a></a><span>
</span><a name="line-136"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684777597"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.html#assignReg_FltCode"><span class="hs-identifier hs-var">assignReg_FltCode</span></a><span> </span><a href="#local-6989586621684777598"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684777595"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684777596"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-137"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684777597"><span class="hs-identifier hs-var">ty</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.Gen64.html#assignReg_I64Code"><span class="hs-identifier hs-var">assignReg_I64Code</span></a><span>        </span><a href="#local-6989586621684777595"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684777596"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-138"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.html#assignReg_IntCode"><span class="hs-identifier hs-var">assignReg_IntCode</span></a><span> </span><a href="#local-6989586621684777598"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684777595"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684777596"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-139"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684777597"><a href="#local-6989586621684777597"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621684777593"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684777595"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-140"></a><span>              </span><a name="local-6989586621684777598"><a href="#local-6989586621684777598"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684777597"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>    </span><a href="CmmNode.html#CmmStore"><span class="hs-identifier hs-var">CmmStore</span></a><span> </span><a name="local-6989586621684777599"><a href="#local-6989586621684777599"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684777600"><a href="#local-6989586621684777600"><span class="hs-identifier">src</span></a></a><span>
</span><a name="line-143"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684777601"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.html#assignMem_FltCode"><span class="hs-identifier hs-var">assignMem_FltCode</span></a><span> </span><a href="#local-6989586621684777602"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684777599"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684777600"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-144"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684777601"><span class="hs-identifier hs-var">ty</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.Gen64.html#assignMem_I64Code"><span class="hs-identifier hs-var">assignMem_I64Code</span></a><span>      </span><a href="#local-6989586621684777599"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684777600"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-145"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var">assignMem_IntCode</span></a><span> </span><a href="#local-6989586621684777602"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684777599"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684777600"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-146"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684777601"><a href="#local-6989586621684777601"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684777593"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684777600"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-147"></a><span>              </span><a name="local-6989586621684777602"><a href="#local-6989586621684777602"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684777601"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span>    </span><a href="CmmNode.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-var">CmmUnsafeForeignCall</span></a><span> </span><a name="local-6989586621684777603"><a href="#local-6989586621684777603"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684777604"><a href="#local-6989586621684777604"><span class="hs-identifier">result_regs</span></a></a><span> </span><a name="local-6989586621684777605"><a href="#local-6989586621684777605"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-150"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a><span> </span><a href="#local-6989586621684777603"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684777604"><span class="hs-identifier hs-var">result_regs</span></a><span> </span><a href="#local-6989586621684777605"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>    </span><a href="CmmNode.html#CmmBranch"><span class="hs-identifier hs-var">CmmBranch</span></a><span>   </span><a name="local-6989586621684777606"><a href="#local-6989586621684777606"><span class="hs-identifier">id</span></a></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621684777606"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-153"></a><span>    </span><a href="CmmNode.html#CmmCondBranch"><span class="hs-identifier hs-var">CmmCondBranch</span></a><span> </span><a name="local-6989586621684777607"><a href="#local-6989586621684777607"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621684777608"><a href="#local-6989586621684777608"><span class="hs-identifier">true</span></a></a><span> </span><a name="local-6989586621684777609"><a href="#local-6989586621684777609"><span class="hs-identifier">false</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-154"></a><span>      </span><a name="local-6989586621684777610"><a href="#local-6989586621684777610"><span class="hs-identifier">b1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.html#genCondJump"><span class="hs-identifier hs-var">genCondJump</span></a><span> </span><a href="#local-6989586621684777608"><span class="hs-identifier hs-var">true</span></a><span> </span><a href="#local-6989586621684777607"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-155"></a><span>      </span><a name="local-6989586621684777611"><a href="#local-6989586621684777611"><span class="hs-identifier">b2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621684777609"><span class="hs-identifier hs-var">false</span></a><span>
</span><a name="line-156"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777610"><span class="hs-identifier hs-var">b1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684777611"><span class="hs-identifier hs-var">b2</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>    </span><a href="CmmNode.html#CmmSwitch"><span class="hs-identifier hs-var">CmmSwitch</span></a><span> </span><a name="local-6989586621684777612"><a href="#local-6989586621684777612"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621684777613"><a href="#local-6989586621684777613"><span class="hs-identifier">ids</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684777614"><a href="#local-6989586621684777614"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-158"></a><span>                              </span><a href="SPARC.CodeGen.html#genSwitch"><span class="hs-identifier hs-var">genSwitch</span></a><span> </span><a href="#local-6989586621684777614"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684777612"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621684777613"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-159"></a><span>    </span><a href="CmmNode.html#CmmCall"><span class="hs-identifier hs-var">CmmCall</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cml_target</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684777615"><a href="#local-6989586621684777615"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.CodeGen.html#genJump"><span class="hs-identifier hs-var">genJump</span></a><span> </span><a href="#local-6989586621684777615"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-identifier">_</span><span>
</span><a name="line-162"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;stmtToInstrs: statement should have been cps'd away&quot;</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">{-
Now, given a tree (the argument to a CmmLoad) that references memory,
produce a suitable addressing mode.

A Rule of the Game (tm) for Amodes: use of the addr bit must
immediately follow use of the code part, since the code part puts
values in registers which the addr then refers to.  So you can't put
anything in between, lest it overwrite some of those registers.  If
you need to do some other computation between the code part and use of
the addr bit, first store the effective address from the amode in a
temporary, then do the other computation, and then use the temporary:

    code
    LEA amode, tmp
    ... other computation ...
    ... (tmp) ...
-}</span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-comment">-- | Convert a BlockId to some CmmStatic data</span><span>
</span><a name="line-186"></a><span class="hs-identifier">jumpTableEntry</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#CmmStatic"><span class="hs-identifier hs-type">CmmStatic</span></a><span>
</span><a name="line-187"></a><a name="jumpTableEntry"><a href="SPARC.CodeGen.html#jumpTableEntry"><span class="hs-identifier">jumpTableEntry</span></a></a><span> </span><a name="local-6989586621684777616"><a href="#local-6989586621684777616"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684777616"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span class="hs-identifier">jumpTableEntry</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684777617"><a href="#local-6989586621684777617"><span class="hs-identifier">blockid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a href="#local-6989586621684777618"><span class="hs-identifier hs-var">blockLabel</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684777618"><a href="#local-6989586621684777618"><span class="hs-identifier">blockLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BlockId.html#blockLbl"><span class="hs-identifier hs-var">blockLbl</span></a><span> </span><a href="#local-6989586621684777617"><span class="hs-identifier hs-var">blockid</span></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- Generating assignments</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">-- Assignments are really at the heart of the whole code generation</span><span>
</span><a name="line-197"></a><span class="hs-comment">-- business.  Almost all top-level nodes of any real importance are</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- assignments, which correspond to loads, stores, or register</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- transfers.  If we're really lucky, some of the register transfers</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- will go away, because we can use the destination register to</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- complete the code generation for the right hand side.  This only</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- fails when the right hand side is forced into a fixed register</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- (e.g. the result of a call).</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-identifier">assignMem_IntCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-206"></a><a name="assignMem_IntCode"><a href="SPARC.CodeGen.html#assignMem_IntCode"><span class="hs-identifier">assignMem_IntCode</span></a></a><span> </span><a name="local-6989586621684777619"><a href="#local-6989586621684777619"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684777620"><a href="#local-6989586621684777620"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684777621"><a href="#local-6989586621684777621"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684777622"><a href="#local-6989586621684777622"><span class="hs-identifier">srcReg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777623"><a href="#local-6989586621684777623"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Gen32.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684777621"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-208"></a><span>    </span><a href="SPARC.CodeGen.Base.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684777624"><a href="#local-6989586621684777624"><span class="hs-identifier">dstAddr</span></a></a><span> </span><a name="local-6989586621684777625"><a href="#local-6989586621684777625"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Amode.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684777620"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-209"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684777623"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684777625"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="SPARC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621684777619"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-6989586621684777622"><span class="hs-identifier hs-var">srcReg</span></a><span> </span><a href="#local-6989586621684777624"><span class="hs-identifier hs-var">dstAddr</span></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-identifier">assignReg_IntCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-213"></a><a name="assignReg_IntCode"><a href="SPARC.CodeGen.html#assignReg_IntCode"><span class="hs-identifier">assignReg_IntCode</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684777626"><a href="#local-6989586621684777626"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684777627"><a href="#local-6989586621684777627"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-214"></a><span>    </span><a name="local-6989586621684777628"><a href="#local-6989586621684777628"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-215"></a><span>    </span><a name="local-6989586621684777629"><a href="#local-6989586621684777629"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Gen32.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684777627"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-216"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777630"><a href="#local-6989586621684777630"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SPARC.CodeGen.Base.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684777628"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777626"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-217"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777629"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-218"></a><span>        </span><a href="SPARC.CodeGen.Base.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684777631"><a href="#local-6989586621684777631"><span class="hs-identifier">code</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777631"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684777630"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-219"></a><span>        </span><a href="SPARC.CodeGen.Base.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684777632"><a href="#local-6989586621684777632"><span class="hs-identifier">freg</span></a></a><span> </span><a name="local-6989586621684777633"><a href="#local-6989586621684777633"><span class="hs-identifier">fcode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777633"><span class="hs-identifier hs-var">fcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="SPARC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="SPARC.Regs.html#g0"><span class="hs-identifier hs-var">g0</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684777632"><span class="hs-identifier hs-var">freg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777630"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-comment">-- Floating point assignment to memory</span><span>
</span><a name="line-224"></a><span class="hs-identifier">assignMem_FltCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-225"></a><a name="assignMem_FltCode"><a href="SPARC.CodeGen.html#assignMem_FltCode"><span class="hs-identifier">assignMem_FltCode</span></a></a><span> </span><a name="local-6989586621684777634"><a href="#local-6989586621684777634"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684777635"><a href="#local-6989586621684777635"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684777636"><a href="#local-6989586621684777636"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-226"></a><span>    </span><a name="local-6989586621684777637"><a href="#local-6989586621684777637"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-227"></a><span>    </span><a href="SPARC.CodeGen.Base.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684777638"><a href="#local-6989586621684777638"><span class="hs-identifier">dst__2</span></a></a><span> </span><a name="local-6989586621684777639"><a href="#local-6989586621684777639"><span class="hs-identifier">code1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Amode.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684777635"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-228"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684777640"><a href="#local-6989586621684777640"><span class="hs-identifier">src__2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777641"><a href="#local-6989586621684777641"><span class="hs-identifier">code2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Gen32.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684777636"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-229"></a><span>    </span><a name="local-6989586621684777642"><a href="#local-6989586621684777642"><span class="hs-identifier">tmp1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684777634"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-231"></a><span>        </span><a name="local-6989586621684777643"><a href="#local-6989586621684777643"><span class="hs-identifier">pk__2</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684777637"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684777636"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-232"></a><span>        </span><a name="local-6989586621684777644"><a href="#local-6989586621684777644"><span class="hs-identifier">code__2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684777639"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684777641"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-233"></a><span>            </span><span class="hs-keyword">if</span><span>   </span><a href="Format.html#formatToWidth"><span class="hs-identifier hs-var">formatToWidth</span></a><span> </span><a href="#local-6989586621684777634"><span class="hs-identifier hs-var">pk</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684777643"><span class="hs-identifier hs-var">pk__2</span></a><span>
</span><a name="line-234"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621684777634"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-6989586621684777640"><span class="hs-identifier hs-var">src__2</span></a><span> </span><a href="#local-6989586621684777638"><span class="hs-identifier hs-var">dst__2</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>   </span><span class="hs-special">[</span><span> </span><a href="SPARC.Instr.html#FxTOy"><span class="hs-identifier hs-var">FxTOy</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684777643"><span class="hs-identifier hs-var">pk__2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777634"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-6989586621684777640"><span class="hs-identifier hs-var">src__2</span></a><span> </span><a href="#local-6989586621684777642"><span class="hs-identifier hs-var">tmp1</span></a><span>
</span><a name="line-236"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span>    </span><a href="#local-6989586621684777634"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-6989586621684777642"><span class="hs-identifier hs-var">tmp1</span></a><span> </span><a href="#local-6989586621684777638"><span class="hs-identifier hs-var">dst__2</span></a><span class="hs-special">]</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684777644"><span class="hs-identifier hs-var">code__2</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-comment">-- Floating point assignment to a register/temporary</span><span>
</span><a name="line-240"></a><span class="hs-identifier">assignReg_FltCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-241"></a><a name="assignReg_FltCode"><a href="SPARC.CodeGen.html#assignReg_FltCode"><span class="hs-identifier">assignReg_FltCode</span></a></a><span> </span><a name="local-6989586621684777645"><a href="#local-6989586621684777645"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684777646"><a href="#local-6989586621684777646"><span class="hs-identifier">dstCmmReg</span></a></a><span> </span><a name="local-6989586621684777647"><a href="#local-6989586621684777647"><span class="hs-identifier">srcCmmExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-242"></a><span>    </span><a name="local-6989586621684777648"><a href="#local-6989586621684777648"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-243"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777649"><a href="#local-6989586621684777649"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684777648"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-244"></a><span>    </span><a name="local-6989586621684777650"><a href="#local-6989586621684777650"><span class="hs-identifier">srcRegister</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Gen32.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684777647"><span class="hs-identifier hs-var">srcCmmExpr</span></a><span>
</span><a name="line-245"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777651"><a href="#local-6989586621684777651"><span class="hs-identifier">dstReg</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="SPARC.CodeGen.Base.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684777649"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684777646"><span class="hs-identifier hs-var">dstCmmReg</span></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777650"><span class="hs-identifier hs-var">srcRegister</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-248"></a><span>        </span><a href="SPARC.CodeGen.Base.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684777652"><a href="#local-6989586621684777652"><span class="hs-identifier">code</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777652"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684777651"><span class="hs-identifier hs-var">dstReg</span></a><span>
</span><a name="line-249"></a><span>        </span><a href="SPARC.CodeGen.Base.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684777653"><a href="#local-6989586621684777653"><span class="hs-identifier">srcFixedReg</span></a></a><span> </span><a name="local-6989586621684777654"><a href="#local-6989586621684777654"><span class="hs-identifier">srcCode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777654"><span class="hs-identifier hs-var">srcCode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="SPARC.Instr.html#FMOV"><span class="hs-identifier hs-var">FMOV</span></a><span> </span><a href="#local-6989586621684777645"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-6989586621684777653"><span class="hs-identifier hs-var">srcFixedReg</span></a><span> </span><a href="#local-6989586621684777651"><span class="hs-identifier hs-var">dstReg</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-identifier">genJump</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-comment">{-the branch target-}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><a name="genJump"><a href="SPARC.CodeGen.html#genJump"><span class="hs-identifier">genJump</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684777655"><a href="#local-6989586621684777655"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="SPARC.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621684777656"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621684777656"><a href="#local-6989586621684777656"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="SPARC.Imm.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684777655"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-identifier">genJump</span><span> </span><a name="local-6989586621684777657"><a href="#local-6989586621684777657"><span class="hs-identifier">tree</span></a></a><span>
</span><a name="line-262"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-263"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684777658"><a href="#local-6989586621684777658"><span class="hs-identifier">target</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777659"><a href="#local-6989586621684777659"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Gen32.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684777657"><span class="hs-identifier hs-var">tree</span></a><span>
</span><a name="line-264"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777659"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="SPARC.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.AddrMode.html#AddrRegReg"><span class="hs-identifier hs-var">AddrRegReg</span></a><span> </span><a href="#local-6989586621684777658"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="SPARC.Regs.html#g0"><span class="hs-identifier hs-var">g0</span></a><span class="hs-special">)</span><span>  </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="SPARC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-267"></a><span class="hs-comment">--  Unconditional branches</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-identifier">genBranch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-270"></a><a name="genBranch"><a href="SPARC.CodeGen.html#genBranch"><span class="hs-identifier">genBranch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Instruction.html#mkJumpInstr"><span class="hs-identifier hs-var">mkJumpInstr</span></a><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-274"></a><span class="hs-comment">--  Conditional jumps</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">{-
Conditional jumps are always to local labels, so we can use branch
instructions.  We peek at the arguments to decide what kind of
comparison to do.

SPARC: First, we have to ensure that the condition codes are set
according to the supplied comparison operation.  We generate slightly
different code for floating point comparisons, because a floating
point operation cannot directly precede a @BF@.  We assume the worst
and fill that slot with a @NOP@.

SPARC: Do not fill the delay slots here; you will confuse the register
allocator.
-}</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-identifier">genCondJump</span><span>
</span><a name="line-293"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span>      </span><span class="hs-comment">-- the branch target</span><span>
</span><a name="line-294"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>      </span><span class="hs-comment">-- the condition on which to branch</span><span>
</span><a name="line-295"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><a name="genCondJump"><a href="SPARC.CodeGen.html#genCondJump"><span class="hs-identifier">genCondJump</span></a></a><span> </span><a name="local-6989586621684777660"><a href="#local-6989586621684777660"><span class="hs-identifier">bid</span></a></a><span> </span><a name="local-6989586621684777661"><a href="#local-6989586621684777661"><span class="hs-identifier">bool</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-300"></a><span>  </span><a href="SPARC.CodeGen.Base.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><a name="local-6989586621684777662"><a href="#local-6989586621684777662"><span class="hs-identifier">is_float</span></a></a><span> </span><a name="local-6989586621684777663"><a href="#local-6989586621684777663"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684777664"><a href="#local-6989586621684777664"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.CondCode.html#getCondCode"><span class="hs-identifier hs-var">getCondCode</span></a><span> </span><a href="#local-6989586621684777661"><span class="hs-identifier hs-var">bool</span></a><span>
</span><a name="line-301"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-302"></a><span>       </span><a href="#local-6989586621684777664"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-303"></a><span>       </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-304"></a><span>         </span><span class="hs-keyword">if</span><span>   </span><a href="#local-6989586621684777662"><span class="hs-identifier hs-var">is_float</span></a><span>
</span><a name="line-305"></a><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="SPARC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#BF"><span class="hs-identifier hs-var">BF</span></a><span> </span><a href="#local-6989586621684777663"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684777660"><span class="hs-identifier hs-var">bid</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span class="hs-special">]</span><span>
</span><a name="line-306"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><a href="SPARC.Instr.html#BI"><span class="hs-identifier hs-var">BI</span></a><span> </span><a href="#local-6989586621684777663"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684777660"><span class="hs-identifier hs-var">bid</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span class="hs-special">]</span><span>
</span><a name="line-307"></a><span>       </span><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- Generating a table-branch</span><span>
</span><a name="line-314"></a><span>
</span><a name="line-315"></a><span class="hs-identifier">genSwitch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmSwitch.html#SwitchTargets"><span class="hs-identifier hs-type">SwitchTargets</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-316"></a><a name="genSwitch"><a href="SPARC.CodeGen.html#genSwitch"><span class="hs-identifier">genSwitch</span></a></a><span> </span><a name="local-6989586621684777665"><a href="#local-6989586621684777665"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684777666"><a href="#local-6989586621684777666"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621684777667"><a href="#local-6989586621684777667"><span class="hs-identifier">targets</span></a></a><span>
</span><a name="line-317"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">positionIndependent</span><span> </span><a href="#local-6989586621684777665"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-318"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;MachCodeGen: sparc genSwitch PIC not finished\n&quot;</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-321"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>    </span><span class="hs-special">(</span><a name="local-6989586621684777670"><a href="#local-6989586621684777670"><span class="hs-identifier">e_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777671"><a href="#local-6989586621684777671"><span class="hs-identifier">e_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Gen32.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmUtils.html#cmmOffset"><span class="hs-identifier hs-var">cmmOffset</span></a><span> </span><a href="#local-6989586621684777665"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684777666"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621684777668"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span>                </span><a name="local-6989586621684777672"><a href="#local-6989586621684777672"><span class="hs-identifier">base_reg</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-324"></a><span>                </span><a name="local-6989586621684777673"><a href="#local-6989586621684777673"><span class="hs-identifier">offset_reg</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-325"></a><span>                </span><a name="local-6989586621684777674"><a href="#local-6989586621684777674"><span class="hs-identifier">dst</span></a></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span>                </span><span class="hs-keyword">label</span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684777671"><span class="hs-identifier hs-var">e_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-330"></a><span>                 </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-331"></a><span>                        </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- load base of jump table</span><span>
</span><a name="line-332"></a><span>                          </span><a href="SPARC.Instr.html#SETHI"><span class="hs-identifier hs-var">SETHI</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Imm.html#HI"><span class="hs-identifier hs-var">HI</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Imm.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><span class="hs-keyword">label</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777672"><span class="hs-identifier hs-var">base_reg</span></a><span>
</span><a name="line-333"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span>    </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684777672"><span class="hs-identifier hs-var">base_reg</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Imm.html#LO"><span class="hs-identifier hs-var">LO</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Imm.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><span class="hs-keyword">label</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777672"><span class="hs-identifier hs-var">base_reg</span></a><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span>                        </span><span class="hs-comment">-- the addrs in the table are 32 bits wide..</span><span>
</span><a name="line-336"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#SLL"><span class="hs-identifier hs-var">SLL</span></a><span>   </span><a href="#local-6989586621684777670"><span class="hs-identifier hs-var">e_reg</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#RIImm"><span class="hs-identifier hs-var">RIImm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Imm.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777673"><span class="hs-identifier hs-var">offset_reg</span></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span>                        </span><span class="hs-comment">-- load and jump to the destination</span><span>
</span><a name="line-339"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span>      </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.AddrMode.html#AddrRegReg"><span class="hs-identifier hs-var">AddrRegReg</span></a><span> </span><a href="#local-6989586621684777672"><span class="hs-identifier hs-var">base_reg</span></a><span> </span><a href="#local-6989586621684777673"><span class="hs-identifier hs-var">offset_reg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777674"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-340"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#JMP_TBL"><span class="hs-identifier hs-var">JMP_TBL</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.AddrMode.html#AddrRegImm"><span class="hs-identifier hs-var">AddrRegImm</span></a><span> </span><a href="#local-6989586621684777674"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Imm.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777669"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-keyword">label</span><span>
</span><a name="line-341"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="SPARC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-342"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684777668"><a href="#local-6989586621684777668"><span class="hs-identifier">offset</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777669"><a href="#local-6989586621684777669"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmSwitch.html#switchTargetsToTable"><span class="hs-identifier hs-var">switchTargetsToTable</span></a><span> </span><a href="#local-6989586621684777667"><span class="hs-identifier hs-var">targets</span></a><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span class="hs-identifier">generateJumpTableForInstr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span>
</span><a name="line-345"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span> </span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-346"></a><a name="generateJumpTableForInstr"><a href="SPARC.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier">generateJumpTableForInstr</span></a></a><span> </span><a name="local-6989586621684777676"><a href="#local-6989586621684777676"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#JMP_TBL"><span class="hs-identifier hs-var">JMP_TBL</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684777677"><a href="#local-6989586621684777677"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-keyword">label</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-347"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777679"><a href="#local-6989586621684777679"><span class="hs-identifier">jumpTable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="SPARC.CodeGen.html#jumpTableEntry"><span class="hs-identifier hs-var">jumpTableEntry</span></a><span> </span><a href="#local-6989586621684777676"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777677"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-348"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><span class="hs-keyword">label</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#Statics"><span class="hs-identifier hs-var">Statics</span></a><span> </span><span class="hs-keyword">label</span><span> </span><a href="#local-6989586621684777679"><span class="hs-identifier hs-var">jumpTable</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span class="hs-identifier">generateJumpTableForInstr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- Generating C calls</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span class="hs-comment">{-
   Now the biggest nightmare---calls.  Most of the nastiness is buried in
   @get_arg@, which moves the arguments to the correct registers/stack
   locations.  Apart from that, the code is easy.

   The SPARC calling convention is an absolute
   nightmare.  The first 6x32 bits of arguments are mapped into
   %o0 through %o5, and the remaining arguments are dumped to the
   stack, beginning at [%sp+92].  (Note that %o6 == %sp.)

   If we have to put args on the stack, move %o6==%sp down by
   the number of words to go on the stack, to ensure there's enough space.

   According to Fraser and Hanson's lcc book, page 478, fig 17.2,
   16 words above the stack pointer is a word for the address of
   a structure return value.  I use this as a temporary location
   for moving values from float to int regs.  Certainly it isn't
   safe to put anything in the 16 words starting at %sp, since
   this area can get trashed at any time due to window overflows
   caused by signal handlers.

   A final complication (if the above isn't enough) is that
   we can't blithely calculate the arguments one by one into
   %o0 .. %o5.  Consider the following nested calls:

       fff a (fff b c)

   Naive code moves a into %o0, and (fff b c) into %o1.  Unfortunately
   the inner call will itself use %o0, which trashes the value put there
   in preparation for the outer call.  Upshot: we need to calculate the
   args into temporary regs, and move those to arg regs or onto the
   stack only immediately prior to the call proper.  Sigh.
-}</span><span>
</span><a name="line-389"></a><span>
</span><a name="line-390"></a><span class="hs-identifier">genCCall</span><span>
</span><a name="line-391"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>            </span><span class="hs-comment">-- function to call</span><span>
</span><a name="line-392"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- where to put the result</span><span>
</span><a name="line-393"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- arguments (of mixed type)</span><span>
</span><a name="line-394"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="SPARC.CodeGen.Base.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span>
</span><a name="line-398"></a><span class="hs-comment">-- On SPARC under TSO (Total Store Ordering), writes earlier in the instruction stream</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- are guaranteed to take place before writes afterwards (unlike on PowerPC).</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- Ref: Section 8.4 of the SPARC V9 Architecture manual.</span><span>
</span><a name="line-401"></a><span class="hs-comment">--</span><span>
</span><a name="line-402"></a><span class="hs-comment">-- In the SPARC case we don't need a barrier.</span><span>
</span><a name="line-403"></a><span class="hs-comment">--</span><span>
</span><a name="line-404"></a><a name="genCCall"><a href="SPARC.CodeGen.html#genCCall"><span class="hs-identifier">genCCall</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_WriteBarrier"><span class="hs-identifier hs-var">MO_WriteBarrier</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-405"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-var">MO_Prefetch_Data</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-408"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684777680"><a href="#local-6989586621684777680"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684777681"><a href="#local-6989586621684777681"><span class="hs-identifier">dest_regs</span></a></a><span> </span><a name="local-6989586621684777682"><a href="#local-6989586621684777682"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-411"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-comment">-- work out the arguments, and assign them to integer regs</span><span>
</span><a name="line-412"></a><span>        </span><a name="local-6989586621684777683"><a href="#local-6989586621684777683"><span class="hs-identifier">argcode_and_vregs</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="SPARC.CodeGen.html#arg_to_int_vregs"><span class="hs-identifier hs-var">arg_to_int_vregs</span></a><span> </span><a href="#local-6989586621684777682"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-413"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684777684"><a href="#local-6989586621684777684"><span class="hs-identifier">argcodes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777685"><a href="#local-6989586621684777685"><span class="hs-identifier">vregss</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-6989586621684777683"><span class="hs-identifier hs-var">argcode_and_vregs</span></a><span>
</span><a name="line-414"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777686"><a href="#local-6989586621684777686"><span class="hs-identifier">vregs</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684777685"><span class="hs-identifier hs-var">vregss</span></a><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777687"><a href="#local-6989586621684777687"><span class="hs-identifier">n_argRegs</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="SPARC.Regs.html#allArgRegs"><span class="hs-identifier hs-var">allArgRegs</span></a><span>
</span><a name="line-417"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777688"><a href="#local-6989586621684777688"><span class="hs-identifier">n_argRegs_used</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684777686"><span class="hs-identifier hs-var">vregs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777687"><span class="hs-identifier hs-var">n_argRegs</span></a><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span>        </span><span class="hs-comment">-- deal with static vs dynamic call targets</span><span>
</span><a name="line-421"></a><span>        </span><a name="local-6989586621684777704"><a href="#local-6989586621684777704"><span class="hs-identifier">callinsns</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777680"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-422"></a><span>                </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684777689"><a href="#local-6989586621684777689"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-423"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="SPARC.Imm.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a href="#local-6989586621684777689"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777688"><span class="hs-identifier hs-var">n_argRegs_used</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span>                </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a name="local-6989586621684777690"><a href="#local-6989586621684777690"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-426"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">(</span><a name="local-6989586621684777691"><a href="#local-6989586621684777691"><span class="hs-identifier">dyn_c</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777692"><a href="#local-6989586621684777692"><span class="hs-identifier">dyn_rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.html#arg_to_int_vregs"><span class="hs-identifier hs-var">arg_to_int_vregs</span></a><span> </span><a href="#local-6989586621684777690"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-427"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777693"><a href="#local-6989586621684777693"><span class="hs-identifier">dyn_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777692"><span class="hs-identifier hs-var">dyn_rs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-428"></a><span>                                      </span><span class="hs-special">[</span><a name="local-6989586621684777694"><a href="#local-6989586621684777694"><span class="hs-identifier">dyn_r'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777694"><span class="hs-identifier hs-var">dyn_r'</span></a><span>
</span><a name="line-429"></a><span>                                      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;SPARC.CodeGen.genCCall: arg_to_int&quot;</span><span>
</span><a name="line-430"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777691"><span class="hs-identifier hs-var">dyn_c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="SPARC.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621684777693"><span class="hs-identifier hs-var">dyn_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777688"><span class="hs-identifier hs-var">n_argRegs_used</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span>                </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621684777695"><a href="#local-6989586621684777695"><span class="hs-identifier">mop</span></a></a><span>
</span><a name="line-433"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><a name="local-6989586621684777696"><a href="#local-6989586621684777696"><span class="hs-identifier">res</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.html#outOfLineMachOp"><span class="hs-identifier hs-var">outOfLineMachOp</span></a><span> </span><a href="#local-6989586621684777695"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-434"></a><span>                        </span><a name="local-6989586621684777703"><a href="#local-6989586621684777703"><span class="hs-identifier">lblOrMopExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777696"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-435"></a><span>                                </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621684777697"><a href="#local-6989586621684777697"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-436"></a><span>                                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="SPARC.Imm.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a href="#local-6989586621684777697"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777688"><span class="hs-identifier hs-var">n_argRegs_used</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span>                                </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621684777698"><a href="#local-6989586621684777698"><span class="hs-identifier">mopExpr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-439"></a><span>                                        </span><span class="hs-special">(</span><a name="local-6989586621684777699"><a href="#local-6989586621684777699"><span class="hs-identifier">dyn_c</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777700"><a href="#local-6989586621684777700"><span class="hs-identifier">dyn_rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.html#arg_to_int_vregs"><span class="hs-identifier hs-var">arg_to_int_vregs</span></a><span> </span><a href="#local-6989586621684777698"><span class="hs-identifier hs-var">mopExpr</span></a><span>
</span><a name="line-440"></a><span>                                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777701"><a href="#local-6989586621684777701"><span class="hs-identifier">dyn_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777700"><span class="hs-identifier hs-var">dyn_rs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-441"></a><span>                                                      </span><span class="hs-special">[</span><a name="local-6989586621684777702"><a href="#local-6989586621684777702"><span class="hs-identifier">dyn_r'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777702"><span class="hs-identifier hs-var">dyn_r'</span></a><span>
</span><a name="line-442"></a><span>                                                      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;SPARC.CodeGen.genCCall: arg_to_int&quot;</span><span>
</span><a name="line-443"></a><span>                                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777699"><span class="hs-identifier hs-var">dyn_c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="SPARC.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621684777701"><span class="hs-identifier hs-var">dyn_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777688"><span class="hs-identifier hs-var">n_argRegs_used</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684777703"><span class="hs-identifier hs-var">lblOrMopExpr</span></a><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777705"><a href="#local-6989586621684777705"><span class="hs-identifier">argcode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621684777684"><span class="hs-identifier hs-var">argcodes</span></a><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684777706"><a href="#local-6989586621684777706"><span class="hs-identifier">move_sp_down</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777707"><a href="#local-6989586621684777707"><span class="hs-identifier">move_sp_up</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777708"><a href="#local-6989586621684777708"><span class="hs-identifier">diff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684777686"><span class="hs-identifier hs-var">vregs</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684777687"><span class="hs-identifier hs-var">n_argRegs</span></a><span>
</span><a name="line-451"></a><span>                         </span><a name="local-6989586621684777709"><a href="#local-6989586621684777709"><span class="hs-identifier">nn</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">odd</span><span> </span><a href="#local-6989586621684777708"><span class="hs-identifier hs-var">diff</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621684777708"><span class="hs-identifier hs-var">diff</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621684777708"><span class="hs-identifier hs-var">diff</span></a><span> </span><span class="hs-comment">-- keep 8-byte alignment</span><span>
</span><a name="line-452"></a><span>                     </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span>   </span><a href="#local-6989586621684777709"><span class="hs-identifier hs-var">nn</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-453"></a><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>                         </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#moveSp"><span class="hs-identifier hs-var">moveSp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621684777709"><span class="hs-identifier hs-var">nn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#moveSp"><span class="hs-identifier hs-var">moveSp</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621684777709"><span class="hs-identifier hs-var">nn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-455"></a><span>
</span><a name="line-456"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777710"><a href="#local-6989586621684777710"><span class="hs-identifier">transfer_code</span></a></a><span>
</span><a name="line-457"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">(</span><a href="SPARC.CodeGen.html#move_final"><span class="hs-identifier hs-var">move_final</span></a><span> </span><a href="#local-6989586621684777686"><span class="hs-identifier hs-var">vregs</span></a><span> </span><a href="SPARC.Regs.html#allArgRegs"><span class="hs-identifier hs-var">allArgRegs</span></a><span> </span><a href="SPARC.Base.html#extraStackArgsHere"><span class="hs-identifier hs-var">extraStackArgsHere</span></a><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span>        </span><a name="local-6989586621684777711"><a href="#local-6989586621684777711"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-460"></a><span>        </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-461"></a><span>         </span><span class="hs-operator hs-var">$</span><span>      </span><a href="#local-6989586621684777705"><span class="hs-identifier hs-var">argcode</span></a><span>                 </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-462"></a><span>                </span><a href="#local-6989586621684777706"><span class="hs-identifier hs-var">move_sp_down</span></a><span>            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-463"></a><span>                </span><a href="#local-6989586621684777710"><span class="hs-identifier hs-var">transfer_code</span></a><span>           </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-464"></a><span>                </span><a href="#local-6989586621684777704"><span class="hs-identifier hs-var">callinsns</span></a><span>               </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-465"></a><span>                </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="SPARC.Instr.html#NOP"><span class="hs-identifier hs-var">NOP</span></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-466"></a><span>                </span><a href="#local-6989586621684777707"><span class="hs-identifier hs-var">move_sp_up</span></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-467"></a><span>                </span><a href="SPARC.CodeGen.html#assign_code"><span class="hs-identifier hs-var">assign_code</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684777711"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777681"><span class="hs-identifier hs-var">dest_regs</span></a><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span class="hs-comment">-- | Generate code to calculate an argument, and move it into one</span><span>
</span><a name="line-471"></a><span class="hs-comment">--      or two integer vregs.</span><span>
</span><a name="line-472"></a><span class="hs-identifier">arg_to_int_vregs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-473"></a><a name="arg_to_int_vregs"><a href="SPARC.CodeGen.html#arg_to_int_vregs"><span class="hs-identifier">arg_to_int_vregs</span></a></a><span> </span><a name="local-6989586621684777712"><a href="#local-6989586621684777712"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684777713"><a href="#local-6989586621684777713"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-474"></a><span>                          </span><a href="SPARC.CodeGen.html#arg_to_int_vregs%27"><span class="hs-identifier hs-var">arg_to_int_vregs'</span></a><span> </span><a href="#local-6989586621684777713"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684777712"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-475"></a><span>
</span><a name="line-476"></a><span class="hs-identifier">arg_to_int_vregs'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-477"></a><a name="arg_to_int_vregs%27"><a href="SPARC.CodeGen.html#arg_to_int_vregs%27"><span class="hs-identifier">arg_to_int_vregs'</span></a></a><span> </span><a name="local-6989586621684777714"><a href="#local-6989586621684777714"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684777715"><a href="#local-6989586621684777715"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span>        </span><span class="hs-comment">-- If the expr produces a 64 bit int, then we can just use iselExpr64</span><span>
</span><a name="line-480"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684777714"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684777715"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-481"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>    </span><span class="hs-special">(</span><a href="SPARC.CodeGen.Base.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684777716"><a href="#local-6989586621684777716"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684777717"><a href="#local-6989586621684777717"><span class="hs-identifier">r_lo</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Gen64.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684777715"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-482"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777718"><a href="#local-6989586621684777718"><span class="hs-identifier">r_hi</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684777717"><span class="hs-identifier hs-var">r_lo</span></a><span>
</span><a name="line-483"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777716"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684777718"><span class="hs-identifier hs-var">r_hi</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684777717"><span class="hs-identifier hs-var">r_lo</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-486"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>    </span><span class="hs-special">(</span><a name="local-6989586621684777719"><a href="#local-6989586621684777719"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684777720"><a href="#local-6989586621684777720"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SPARC.CodeGen.Gen32.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684777715"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-487"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777721"><a href="#local-6989586621684777721"><span class="hs-identifier">pk</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684777714"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684777715"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684777721"><span class="hs-identifier hs-var">pk</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span>                 </span><span class="hs-comment">-- Load a 64 bit float return value into two integer regs.</span><span>
</span><a name="line-492"></a><span>                 </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-493"></a><span>                        </span><a name="local-6989586621684777722"><a href="#local-6989586621684777722"><span class="hs-identifier">v1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-494"></a><span>                        </span><a name="local-6989586621684777723"><a href="#local-6989586621684777723"><span class="hs-identifier">v2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777724"><a href="#local-6989586621684777724"><span class="hs-identifier">code2</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-497"></a><span>                                </span><a href="#local-6989586621684777720"><span class="hs-identifier hs-var">code</span></a><span>                            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-498"></a><span>                                </span><a href="SPARC.Instr.html#FMOV"><span class="hs-identifier hs-var">FMOV</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684777719"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="SPARC.Regs.html#f0"><span class="hs-identifier hs-var">f0</span></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-499"></a><span>                                </span><a href="SPARC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span>   </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span>  </span><a href="SPARC.Regs.html#f0"><span class="hs-identifier hs-var">f0</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Stack.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-500"></a><span>                                </span><a href="SPARC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span>   </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>  </span><span class="hs-special">(</span><a href="SPARC.Stack.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777722"><span class="hs-identifier hs-var">v1</span></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-501"></a><span>                                </span><a href="SPARC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span>   </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span>  </span><a href="SPARC.Regs.html#f1"><span class="hs-identifier hs-var">f1</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Stack.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-502"></a><span>                                </span><a href="SPARC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span>   </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>  </span><span class="hs-special">(</span><a href="SPARC.Stack.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777723"><span class="hs-identifier hs-var">v2</span></a><span>
</span><a name="line-503"></a><span>
</span><a name="line-504"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span>  </span><span class="hs-special">(</span><a href="#local-6989586621684777724"><span class="hs-identifier hs-var">code2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684777722"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><a href="#local-6989586621684777723"><span class="hs-identifier hs-var">v2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span>                 </span><span class="hs-comment">-- Load a 32 bit float return value into an integer reg</span><span>
</span><a name="line-507"></a><span>                 </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-508"></a><span>                        </span><a name="local-6989586621684777725"><a href="#local-6989586621684777725"><span class="hs-identifier">v1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777726"><a href="#local-6989586621684777726"><span class="hs-identifier">code2</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-511"></a><span>                                </span><a href="#local-6989586621684777720"><span class="hs-identifier hs-var">code</span></a><span>                            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-512"></a><span>                                </span><a href="SPARC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span>   </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span>  </span><a href="#local-6989586621684777719"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Stack.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span>       </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-513"></a><span>                                </span><a href="SPARC.Instr.html#LD"><span class="hs-identifier hs-var">LD</span></a><span>   </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>  </span><span class="hs-special">(</span><a href="SPARC.Stack.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777725"><span class="hs-identifier hs-var">v1</span></a><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777726"><span class="hs-identifier hs-var">code2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684777725"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span>                 </span><span class="hs-comment">-- Move an integer return value into its destination reg.</span><span>
</span><a name="line-518"></a><span>                 </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-519"></a><span>                        </span><a name="local-6989586621684777727"><a href="#local-6989586621684777727"><span class="hs-identifier">v1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777728"><a href="#local-6989586621684777728"><span class="hs-identifier">code2</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-522"></a><span>                                </span><a href="#local-6989586621684777720"><span class="hs-identifier hs-var">code</span></a><span>                            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-523"></a><span>                                </span><a href="SPARC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="SPARC.Regs.html#g0"><span class="hs-identifier hs-var">g0</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684777719"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777727"><span class="hs-identifier hs-var">v1</span></a><span>
</span><a name="line-524"></a><span>
</span><a name="line-525"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777728"><span class="hs-identifier hs-var">code2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684777727"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span class="hs-comment">-- | Move args from the integer vregs into which they have been</span><span>
</span><a name="line-529"></a><span class="hs-comment">--      marshalled, into %o0 .. %o5, and the rest onto the stack.</span><span>
</span><a name="line-530"></a><span class="hs-comment">--</span><span>
</span><a name="line-531"></a><span class="hs-identifier">move_final</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span class="hs-comment">-- all args done</span><span>
</span><a name="line-534"></a><a name="move_final"><a href="SPARC.CodeGen.html#move_final"><span class="hs-identifier">move_final</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-535"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-536"></a><span>
</span><a name="line-537"></a><span class="hs-comment">-- out of aregs; move to stack</span><span>
</span><a name="line-538"></a><span class="hs-identifier">move_final</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684777729"><a href="#local-6989586621684777729"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684777730"><a href="#local-6989586621684777730"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621684777731"><a href="#local-6989586621684777731"><span class="hs-identifier">offset</span></a></a><span>
</span><a name="line-539"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="SPARC.Instr.html#ST"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684777729"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Stack.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684777731"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-540"></a><span>        </span><span class="hs-glyph">:</span><span> </span><a href="SPARC.CodeGen.html#move_final"><span class="hs-identifier hs-var">move_final</span></a><span> </span><a href="#local-6989586621684777730"><span class="hs-identifier hs-var">vs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684777731"><span class="hs-identifier hs-var">offset</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span class="hs-comment">-- move into an arg (%o[0..5]) reg</span><span>
</span><a name="line-543"></a><span class="hs-identifier">move_final</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684777732"><a href="#local-6989586621684777732"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684777733"><a href="#local-6989586621684777733"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684777734"><a href="#local-6989586621684777734"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684777735"><a href="#local-6989586621684777735"><span class="hs-identifier">az</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684777736"><a href="#local-6989586621684777736"><span class="hs-identifier">offset</span></a></a><span>
</span><a name="line-544"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="SPARC.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="SPARC.Regs.html#g0"><span class="hs-identifier hs-var">g0</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Instr.html#RIReg"><span class="hs-identifier hs-var">RIReg</span></a><span> </span><a href="#local-6989586621684777732"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777734"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-545"></a><span>        </span><span class="hs-glyph">:</span><span> </span><a href="SPARC.CodeGen.html#move_final"><span class="hs-identifier hs-var">move_final</span></a><span> </span><a href="#local-6989586621684777733"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621684777735"><span class="hs-identifier hs-var">az</span></a><span> </span><a href="#local-6989586621684777736"><span class="hs-identifier hs-var">offset</span></a><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-comment">-- | Assign results returned from the call into their</span><span>
</span><a name="line-549"></a><span class="hs-comment">--      destination regs.</span><span>
</span><a name="line-550"></a><span class="hs-comment">--</span><span>
</span><a name="line-551"></a><span class="hs-identifier">assign_code</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-type">LocalReg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="SPARC.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span>
</span><a name="line-552"></a><span>
</span><a name="line-553"></a><a name="assign_code"><a href="SPARC.CodeGen.html#assign_code"><span class="hs-identifier">assign_code</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-554"></a><span>
</span><a name="line-555"></a><span class="hs-identifier">assign_code</span><span> </span><a name="local-6989586621684777737"><a href="#local-6989586621684777737"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684777738"><a href="#local-6989586621684777738"><span class="hs-identifier">dest</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-556"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>  </span><a name="local-6989586621684777739"><a href="#local-6989586621684777739"><span class="hs-identifier">rep</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#localRegType"><span class="hs-identifier hs-var">localRegType</span></a><span> </span><a href="#local-6989586621684777738"><span class="hs-identifier hs-var">dest</span></a><span>
</span><a name="line-557"></a><span>        </span><a name="local-6989586621684777740"><a href="#local-6989586621684777740"><span class="hs-identifier">width</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684777739"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-558"></a><span>        </span><a name="local-6989586621684777741"><a href="#local-6989586621684777741"><span class="hs-identifier">r_dest</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="SPARC.CodeGen.Base.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684777737"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684777738"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>
</span><a name="line-560"></a><span>        </span><a name="local-6989586621684777742"><a href="#local-6989586621684777742"><span class="hs-identifier">result</span></a></a><span>
</span><a name="line-561"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684777739"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-562"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">W32</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684777740"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-563"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Instr.html#FMOV"><span class="hs-identifier hs-var">FMOV</span></a><span> </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777741"><span class="hs-identifier hs-var">r_dest</span></a><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684777739"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-566"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">W64</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684777740"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-567"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Instr.html#FMOV"><span class="hs-identifier hs-var">FMOV</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777741"><span class="hs-identifier hs-var">r_dest</span></a><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684777739"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-570"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">W32</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684777740"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-571"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Instruction.html#mkRegRegMoveInstr"><span class="hs-identifier hs-var">mkRegRegMoveInstr</span></a><span> </span><a href="#local-6989586621684777737"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777741"><span class="hs-identifier hs-var">r_dest</span></a><span>
</span><a name="line-572"></a><span>
</span><a name="line-573"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684777739"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-574"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">W64</span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684777740"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-575"></a><span>                </span><span class="hs-special">,</span><span> </span><a name="local-6989586621684777743"><a href="#local-6989586621684777743"><span class="hs-identifier">r_dest_hi</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684777741"><span class="hs-identifier hs-var">r_dest</span></a><span>
</span><a name="line-576"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>  </span><span class="hs-special">[</span><span> </span><a href="Instruction.html#mkRegRegMoveInstr"><span class="hs-identifier hs-var">mkRegRegMoveInstr</span></a><span> </span><a href="#local-6989586621684777737"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777743"><span class="hs-identifier hs-var">r_dest_hi</span></a><span>
</span><a name="line-577"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Instruction.html#mkRegRegMoveInstr"><span class="hs-identifier hs-var">mkRegRegMoveInstr</span></a><span> </span><a href="#local-6989586621684777737"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#regSingle"><span class="hs-identifier hs-var">regSingle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684777741"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">]</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-580"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;SPARC.CodeGen.GenCCall: no match&quot;</span><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span>   </span><span class="hs-keyword">in</span><span>   </span><a href="#local-6989586621684777742"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-583"></a><span>
</span><a name="line-584"></a><span class="hs-identifier">assign_code</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-585"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;SPARC.CodeGen.GenCCall: no match&quot;</span><span>
</span><a name="line-586"></a><span>
</span><a name="line-587"></a><span>
</span><a name="line-588"></a><span>
</span><a name="line-589"></a><span class="hs-comment">-- | Generate a call to implement an out-of-line floating point operation</span><span>
</span><a name="line-590"></a><span class="hs-identifier">outOfLineMachOp</span><span>
</span><a name="line-591"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="CmmMachOp.html#CallishMachOp"><span class="hs-identifier hs-type">CallishMachOp</span></a><span>
</span><a name="line-592"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><a name="outOfLineMachOp"><a href="SPARC.CodeGen.html#outOfLineMachOp"><span class="hs-identifier">outOfLineMachOp</span></a></a><span> </span><a name="local-6989586621684777744"><a href="#local-6989586621684777744"><span class="hs-identifier">mop</span></a></a><span>
</span><a name="line-595"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777745"><a href="#local-6989586621684777745"><span class="hs-identifier">functionName</span></a></a><span>
</span><a name="line-596"></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="SPARC.CodeGen.html#outOfLineMachOp_table"><span class="hs-identifier hs-var">outOfLineMachOp_table</span></a><span> </span><a href="#local-6989586621684777744"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span>        </span><a name="local-6989586621684777746"><a href="#local-6989586621684777746"><span class="hs-identifier">dflags</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-599"></a><span>        </span><a name="local-6989586621684777747"><a href="#local-6989586621684777747"><span class="hs-identifier">mopExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684777746"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a><span>
</span><a name="line-600"></a><span>                </span><span class="hs-operator hs-var">$</span><span>  </span><a href="CLabel.html#mkForeignLabel"><span class="hs-identifier hs-var">mkForeignLabel</span></a><span> </span><a href="#local-6989586621684777745"><span class="hs-identifier hs-var">functionName</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="CLabel.html#ForeignLabelInExternalPackage"><span class="hs-identifier hs-var">ForeignLabelInExternalPackage</span></a><span> </span><span class="hs-identifier hs-var">IsFunction</span><span>
</span><a name="line-601"></a><span>
</span><a name="line-602"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684777748"><a href="#local-6989586621684777748"><span class="hs-identifier">mopLabelOrExpr</span></a></a><span>
</span><a name="line-603"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777747"><span class="hs-identifier hs-var">mopExpr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-604"></a><span>                        </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684777749"><a href="#local-6989586621684777749"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621684777749"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-605"></a><span>                        </span><span class="hs-identifier">_</span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621684777747"><span class="hs-identifier hs-var">mopExpr</span></a><span>
</span><a name="line-606"></a><span>
</span><a name="line-607"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684777748"><span class="hs-identifier hs-var">mopLabelOrExpr</span></a><span>
</span><a name="line-608"></a><span>
</span><a name="line-609"></a><span>
</span><a name="line-610"></a><span class="hs-comment">-- | Decide what C function to use to implement a CallishMachOp</span><span>
</span><a name="line-611"></a><span class="hs-comment">--</span><span>
</span><a name="line-612"></a><span class="hs-identifier">outOfLineMachOp_table</span><span>
</span><a name="line-613"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="CmmMachOp.html#CallishMachOp"><span class="hs-identifier hs-type">CallishMachOp</span></a><span>
</span><a name="line-614"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FastString</span><span>
</span><a name="line-615"></a><span>
</span><a name="line-616"></a><a name="outOfLineMachOp_table"><a href="SPARC.CodeGen.html#outOfLineMachOp_table"><span class="hs-identifier">outOfLineMachOp_table</span></a></a><span> </span><a name="local-6989586621684777750"><a href="#local-6989586621684777750"><span class="hs-identifier">mop</span></a></a><span>
</span><a name="line-617"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684777750"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-618"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Exp"><span class="hs-identifier hs-var">MO_F32_Exp</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;expf&quot;</span><span>
</span><a name="line-619"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Log"><span class="hs-identifier hs-var">MO_F32_Log</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;logf&quot;</span><span>
</span><a name="line-620"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Sqrt"><span class="hs-identifier hs-var">MO_F32_Sqrt</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sqrtf&quot;</span><span>
</span><a name="line-621"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Fabs"><span class="hs-identifier hs-var">MO_F32_Fabs</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-622"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Pwr"><span class="hs-identifier hs-var">MO_F32_Pwr</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;powf&quot;</span><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Sin"><span class="hs-identifier hs-var">MO_F32_Sin</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinf&quot;</span><span>
</span><a name="line-625"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Cos"><span class="hs-identifier hs-var">MO_F32_Cos</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cosf&quot;</span><span>
</span><a name="line-626"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Tan"><span class="hs-identifier hs-var">MO_F32_Tan</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanf&quot;</span><span>
</span><a name="line-627"></a><span>
</span><a name="line-628"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Asin"><span class="hs-identifier hs-var">MO_F32_Asin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinf&quot;</span><span>
</span><a name="line-629"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Acos"><span class="hs-identifier hs-var">MO_F32_Acos</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acosf&quot;</span><span>
</span><a name="line-630"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Atan"><span class="hs-identifier hs-var">MO_F32_Atan</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanf&quot;</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Sinh"><span class="hs-identifier hs-var">MO_F32_Sinh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinhf&quot;</span><span>
</span><a name="line-633"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Cosh"><span class="hs-identifier hs-var">MO_F32_Cosh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;coshf&quot;</span><span>
</span><a name="line-634"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Tanh"><span class="hs-identifier hs-var">MO_F32_Tanh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanhf&quot;</span><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Asinh"><span class="hs-identifier hs-var">MO_F32_Asinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinhf&quot;</span><span>
</span><a name="line-637"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Acosh"><span class="hs-identifier hs-var">MO_F32_Acosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acoshf&quot;</span><span>
</span><a name="line-638"></a><span>        </span><a href="CmmMachOp.html#MO_F32_Atanh"><span class="hs-identifier hs-var">MO_F32_Atanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanhf&quot;</span><span>
</span><a name="line-639"></a><span>
</span><a name="line-640"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Exp"><span class="hs-identifier hs-var">MO_F64_Exp</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;exp&quot;</span><span>
</span><a name="line-641"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Log"><span class="hs-identifier hs-var">MO_F64_Log</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;log&quot;</span><span>
</span><a name="line-642"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Sqrt"><span class="hs-identifier hs-var">MO_F64_Sqrt</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sqrt&quot;</span><span>
</span><a name="line-643"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Fabs"><span class="hs-identifier hs-var">MO_F64_Fabs</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-644"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Pwr"><span class="hs-identifier hs-var">MO_F64_Pwr</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;pow&quot;</span><span>
</span><a name="line-645"></a><span>
</span><a name="line-646"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Sin"><span class="hs-identifier hs-var">MO_F64_Sin</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sin&quot;</span><span>
</span><a name="line-647"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Cos"><span class="hs-identifier hs-var">MO_F64_Cos</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cos&quot;</span><span>
</span><a name="line-648"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Tan"><span class="hs-identifier hs-var">MO_F64_Tan</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tan&quot;</span><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Asin"><span class="hs-identifier hs-var">MO_F64_Asin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asin&quot;</span><span>
</span><a name="line-651"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Acos"><span class="hs-identifier hs-var">MO_F64_Acos</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acos&quot;</span><span>
</span><a name="line-652"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Atan"><span class="hs-identifier hs-var">MO_F64_Atan</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atan&quot;</span><span>
</span><a name="line-653"></a><span>
</span><a name="line-654"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Sinh"><span class="hs-identifier hs-var">MO_F64_Sinh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinh&quot;</span><span>
</span><a name="line-655"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Cosh"><span class="hs-identifier hs-var">MO_F64_Cosh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cosh&quot;</span><span>
</span><a name="line-656"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Tanh"><span class="hs-identifier hs-var">MO_F64_Tanh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanh&quot;</span><span>
</span><a name="line-657"></a><span>
</span><a name="line-658"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Asinh"><span class="hs-identifier hs-var">MO_F64_Asinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinh&quot;</span><span>
</span><a name="line-659"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Acosh"><span class="hs-identifier hs-var">MO_F64_Acosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acosh&quot;</span><span>
</span><a name="line-660"></a><span>        </span><a href="CmmMachOp.html#MO_F64_Atanh"><span class="hs-identifier hs-var">MO_F64_Atanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanh&quot;</span><span>
</span><a name="line-661"></a><span>
</span><a name="line-662"></a><span>        </span><a href="CmmMachOp.html#MO_UF_Conv"><span class="hs-identifier hs-var">MO_UF_Conv</span></a><span> </span><a name="local-6989586621684777752"><a href="#local-6989586621684777752"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#word2FloatLabel"><span class="hs-identifier hs-var">word2FloatLabel</span></a><span> </span><a href="#local-6989586621684777752"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span>        </span><a href="CmmMachOp.html#MO_Memcpy"><span class="hs-identifier hs-var">MO_Memcpy</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memcpy&quot;</span><span>
</span><a name="line-665"></a><span>        </span><a href="CmmMachOp.html#MO_Memset"><span class="hs-identifier hs-var">MO_Memset</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memset&quot;</span><span>
</span><a name="line-666"></a><span>        </span><a href="CmmMachOp.html#MO_Memmove"><span class="hs-identifier hs-var">MO_Memmove</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memmove&quot;</span><span>
</span><a name="line-667"></a><span>        </span><a href="CmmMachOp.html#MO_Memcmp"><span class="hs-identifier hs-var">MO_Memcmp</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memcmp&quot;</span><span>
</span><a name="line-668"></a><span>
</span><a name="line-669"></a><span>        </span><a href="CmmMachOp.html#MO_BSwap"><span class="hs-identifier hs-var">MO_BSwap</span></a><span> </span><a name="local-6989586621684777753"><a href="#local-6989586621684777753"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#bSwapLabel"><span class="hs-identifier hs-var">bSwapLabel</span></a><span> </span><a href="#local-6989586621684777753"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-670"></a><span>        </span><a href="CmmMachOp.html#MO_PopCnt"><span class="hs-identifier hs-var">MO_PopCnt</span></a><span> </span><a name="local-6989586621684777754"><a href="#local-6989586621684777754"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#popCntLabel"><span class="hs-identifier hs-var">popCntLabel</span></a><span> </span><a href="#local-6989586621684777754"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-671"></a><span>        </span><a href="CmmMachOp.html#MO_Pdep"><span class="hs-identifier hs-var">MO_Pdep</span></a><span> </span><a name="local-6989586621684777755"><a href="#local-6989586621684777755"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#pdepLabel"><span class="hs-identifier hs-var">pdepLabel</span></a><span> </span><a href="#local-6989586621684777755"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-672"></a><span>        </span><a href="CmmMachOp.html#MO_Pext"><span class="hs-identifier hs-var">MO_Pext</span></a><span> </span><a name="local-6989586621684777756"><a href="#local-6989586621684777756"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#pextLabel"><span class="hs-identifier hs-var">pextLabel</span></a><span> </span><a href="#local-6989586621684777756"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-673"></a><span>        </span><a href="CmmMachOp.html#MO_Clz"><span class="hs-identifier hs-var">MO_Clz</span></a><span> </span><a name="local-6989586621684777757"><a href="#local-6989586621684777757"><span class="hs-identifier">w</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#clzLabel"><span class="hs-identifier hs-var">clzLabel</span></a><span> </span><a href="#local-6989586621684777757"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-674"></a><span>        </span><a href="CmmMachOp.html#MO_Ctz"><span class="hs-identifier hs-var">MO_Ctz</span></a><span> </span><a name="local-6989586621684777758"><a href="#local-6989586621684777758"><span class="hs-identifier">w</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#ctzLabel"><span class="hs-identifier hs-var">ctzLabel</span></a><span> </span><a href="#local-6989586621684777758"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-675"></a><span>        </span><a href="CmmMachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-var">MO_AtomicRMW</span></a><span> </span><a name="local-6989586621684777759"><a href="#local-6989586621684777759"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621684777760"><a href="#local-6989586621684777760"><span class="hs-identifier">amop</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#atomicRMWLabel"><span class="hs-identifier hs-var">atomicRMWLabel</span></a><span> </span><a href="#local-6989586621684777759"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621684777760"><span class="hs-identifier hs-var">amop</span></a><span>
</span><a name="line-676"></a><span>        </span><a href="CmmMachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-var">MO_Cmpxchg</span></a><span> </span><a name="local-6989586621684777761"><a href="#local-6989586621684777761"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#cmpxchgLabel"><span class="hs-identifier hs-var">cmpxchgLabel</span></a><span> </span><a href="#local-6989586621684777761"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-677"></a><span>        </span><a href="CmmMachOp.html#MO_AtomicRead"><span class="hs-identifier hs-var">MO_AtomicRead</span></a><span> </span><a name="local-6989586621684777762"><a href="#local-6989586621684777762"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#atomicReadLabel"><span class="hs-identifier hs-var">atomicReadLabel</span></a><span> </span><a href="#local-6989586621684777762"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-678"></a><span>        </span><a href="CmmMachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-var">MO_AtomicWrite</span></a><span> </span><a name="local-6989586621684777763"><a href="#local-6989586621684777763"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#atomicWriteLabel"><span class="hs-identifier hs-var">atomicWriteLabel</span></a><span> </span><a href="#local-6989586621684777763"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><span>        </span><a href="CmmMachOp.html#MO_S_QuotRem"><span class="hs-identifier hs-var">MO_S_QuotRem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-681"></a><span>        </span><a href="CmmMachOp.html#MO_U_QuotRem"><span class="hs-identifier hs-var">MO_U_QuotRem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-682"></a><span>        </span><a href="CmmMachOp.html#MO_U_QuotRem2"><span class="hs-identifier hs-var">MO_U_QuotRem2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-683"></a><span>        </span><a href="CmmMachOp.html#MO_Add2"><span class="hs-identifier hs-var">MO_Add2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-684"></a><span>        </span><a href="CmmMachOp.html#MO_AddWordC"><span class="hs-identifier hs-var">MO_AddWordC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-685"></a><span>        </span><a href="CmmMachOp.html#MO_SubWordC"><span class="hs-identifier hs-var">MO_SubWordC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-686"></a><span>        </span><a href="CmmMachOp.html#MO_AddIntC"><span class="hs-identifier hs-var">MO_AddIntC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-687"></a><span>        </span><a href="CmmMachOp.html#MO_SubIntC"><span class="hs-identifier hs-var">MO_SubIntC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-688"></a><span>        </span><a href="CmmMachOp.html#MO_U_Mul2"><span class="hs-identifier hs-var">MO_U_Mul2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-689"></a><span>        </span><a href="CmmMachOp.html#MO_WriteBarrier"><span class="hs-identifier hs-var">MO_WriteBarrier</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-690"></a><span>        </span><a href="CmmMachOp.html#MO_Touch"><span class="hs-identifier hs-var">MO_Touch</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-691"></a><span>        </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-var">MO_Prefetch_Data</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684777751"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-692"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684777751"><a href="#local-6989586621684777751"><span class="hs-identifier">unsupported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;outOfLineCmmOp: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684777750"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-693"></a><span>                            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; not supported here&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-694"></a><span>
</span><a name="line-695"></a></pre></body></html>