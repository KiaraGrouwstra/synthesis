<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">--</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- (c) The University of Glasgow 1994-2004</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">SPARC.Regs</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-8"></a><span>        </span><span class="hs-comment">-- registers</span><span>
</span><a name="line-9"></a><span>        </span><a href="SPARC.Regs.html#showReg"><span class="hs-identifier hs-var">showReg</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>        </span><a href="SPARC.Regs.html#virtualRegSqueeze"><span class="hs-identifier hs-var">virtualRegSqueeze</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="SPARC.Regs.html#realRegSqueeze"><span class="hs-identifier hs-var">realRegSqueeze</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="SPARC.Regs.html#classOfRealReg"><span class="hs-identifier hs-var">classOfRealReg</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="SPARC.Regs.html#allRealRegs"><span class="hs-identifier hs-var">allRealRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span>        </span><span class="hs-comment">-- machine specific info</span><span>
</span><a name="line-16"></a><span>        </span><a href="SPARC.Regs.html#gReg"><span class="hs-identifier hs-var">gReg</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#iReg"><span class="hs-identifier hs-var">iReg</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#lReg"><span class="hs-identifier hs-var">lReg</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="SPARC.Regs.html#fp"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#sp"><span class="hs-identifier hs-var">sp</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#g0"><span class="hs-identifier hs-var">g0</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#g1"><span class="hs-identifier hs-var">g1</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#g2"><span class="hs-identifier hs-var">g2</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#o0"><span class="hs-identifier hs-var">o0</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#o1"><span class="hs-identifier hs-var">o1</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#f0"><span class="hs-identifier hs-var">f0</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#f1"><span class="hs-identifier hs-var">f1</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#f6"><span class="hs-identifier hs-var">f6</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#f8"><span class="hs-identifier hs-var">f8</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#f22"><span class="hs-identifier hs-var">f22</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#f26"><span class="hs-identifier hs-var">f26</span></a><span class="hs-special">,</span><span> </span><a href="SPARC.Regs.html#f27"><span class="hs-identifier hs-var">f27</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>        </span><span class="hs-comment">-- allocatable</span><span>
</span><a name="line-20"></a><span>        </span><a href="SPARC.Regs.html#allocatableRegs"><span class="hs-identifier hs-var">allocatableRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>        </span><span class="hs-comment">-- args</span><span>
</span><a name="line-23"></a><span>        </span><a href="SPARC.Regs.html#argRegs"><span class="hs-identifier hs-var">argRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="SPARC.Regs.html#allArgRegs"><span class="hs-identifier hs-var">allArgRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="SPARC.Regs.html#callClobberedRegs"><span class="hs-identifier hs-var">callClobberedRegs</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-28"></a><span>        </span><a href="SPARC.Regs.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="SPARC.Regs.html#regDotColor"><span class="hs-identifier hs-var">regDotColor</span></a><span>
</span><a name="line-30"></a><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">where</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="CodeGen.Platform.SPARC.html"><span class="hs-identifier">CodeGen.Platform.SPARC</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Reg.html"><span class="hs-identifier">Reg</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="RegClass.html"><span class="hs-identifier">RegClass</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Format.html"><span class="hs-identifier">Format</span></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unique</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-comment">{-
        The SPARC has 64 registers of interest; 32 integer registers and 32
        floating point registers.  The mapping of STG registers to SPARC
        machine registers is defined in StgRegs.h.  We are, of course,
        prepared for any eventuality.

        The whole fp-register pairing thing on sparcs is a huge nuisance.  See
        includes/stg/MachRegs.h for a description of what's going on
        here.
-}</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- | Get the standard name for the register with this number.</span><span>
</span><a name="line-58"></a><span class="hs-identifier">showReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-59"></a><a name="showReg"><a href="SPARC.Regs.html#showReg"><span class="hs-identifier">showReg</span></a></a><span> </span><a name="local-6989586621680353348"><a href="#local-6989586621680353348"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-60"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span>  </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">8</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;%g&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-61"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">8</span><span>  </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">16</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;%o&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">24</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;%l&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">16</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">24</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">32</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;%i&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">24</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">32</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">64</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;%f&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680353348"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">32</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;SPARC.Regs.showReg: unknown sparc register&quot;</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- Get the register class of a certain real reg</span><span>
</span><a name="line-69"></a><span class="hs-identifier">classOfRealReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span>
</span><a name="line-70"></a><a name="classOfRealReg"><a href="SPARC.Regs.html#classOfRealReg"><span class="hs-identifier">classOfRealReg</span></a></a><span> </span><a name="local-6989586621680353349"><a href="#local-6989586621680353349"><span class="hs-identifier">reg</span></a></a><span>
</span><a name="line-71"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353349"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-72"></a><span>        </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621680353350"><a href="#local-6989586621680353350"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-73"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353350"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">32</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span>
</span><a name="line-74"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RegClass.html#RcFloat"><span class="hs-identifier hs-var">RcFloat</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span>        </span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | regSqueeze_class reg</span><span>
</span><a name="line-80"></a><span class="hs-comment">--      Calculate the maximum number of register colors that could be</span><span>
</span><a name="line-81"></a><span class="hs-comment">--      denied to a node of this class due to having this reg</span><span>
</span><a name="line-82"></a><span class="hs-comment">--      as a neighbour.</span><span>
</span><a name="line-83"></a><span class="hs-comment">--</span><span>
</span><a name="line-84"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">virtualRegSqueeze</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-85"></a><span class="hs-identifier">virtualRegSqueeze</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#VirtualReg"><span class="hs-identifier hs-type">VirtualReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><a name="virtualRegSqueeze"><a href="SPARC.Regs.html#virtualRegSqueeze"><span class="hs-identifier">virtualRegSqueeze</span></a></a><span> </span><a name="local-6989586621680353351"><a href="#local-6989586621680353351"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621680353352"><a href="#local-6989586621680353352"><span class="hs-identifier">vr</span></a></a><span>
</span><a name="line-88"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353351"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-89"></a><span>        </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span>
</span><a name="line-90"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353352"><span class="hs-identifier hs-var">vr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-91"></a><span>                </span><a href="Reg.html#VirtualRegI"><span class="hs-identifier hs-var">VirtualRegI</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-92"></a><span>                </span><a href="Reg.html#VirtualRegHi"><span class="hs-identifier hs-var">VirtualRegHi</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-93"></a><span>                </span><a name="local-6989586621680353353"><a href="#local-6989586621680353353"><span class="hs-identifier">_other</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span>        </span><a href="RegClass.html#RcFloat"><span class="hs-identifier hs-var">RcFloat</span></a><span>
</span><a name="line-96"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353352"><span class="hs-identifier hs-var">vr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-97"></a><span>                </span><a href="Reg.html#VirtualRegF"><span class="hs-identifier hs-var">VirtualRegF</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-98"></a><span>                </span><a href="Reg.html#VirtualRegD"><span class="hs-identifier hs-var">VirtualRegD</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-99"></a><span>                </span><a name="local-6989586621680353354"><a href="#local-6989586621680353354"><span class="hs-identifier">_other</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>        </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span>
</span><a name="line-102"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353352"><span class="hs-identifier hs-var">vr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-103"></a><span>                </span><a href="Reg.html#VirtualRegF"><span class="hs-identifier hs-var">VirtualRegF</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-104"></a><span>                </span><a href="Reg.html#VirtualRegD"><span class="hs-identifier hs-var">VirtualRegD</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-105"></a><span>                </span><a name="local-6989586621680353355"><a href="#local-6989586621680353355"><span class="hs-identifier">_other</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>        </span><a name="local-6989586621680353356"><a href="#local-6989586621680353356"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">realRegSqueeze</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-110"></a><span class="hs-identifier">realRegSqueeze</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RegClass.html#RegClass"><span class="hs-identifier hs-type">RegClass</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><a name="realRegSqueeze"><a href="SPARC.Regs.html#realRegSqueeze"><span class="hs-identifier">realRegSqueeze</span></a></a><span> </span><a name="local-6989586621680353357"><a href="#local-6989586621680353357"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621680353358"><a href="#local-6989586621680353358"><span class="hs-identifier">rr</span></a></a><span>
</span><a name="line-113"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353357"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-114"></a><span>        </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span>
</span><a name="line-115"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353358"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-116"></a><span>                </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621680353359"><a href="#local-6989586621680353359"><span class="hs-identifier">regNo</span></a></a><span>
</span><a name="line-117"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353359"><span class="hs-identifier hs-var">regNo</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">32</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-118"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>                </span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>        </span><a href="RegClass.html#RcFloat"><span class="hs-identifier hs-var">RcFloat</span></a><span>
</span><a name="line-123"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353358"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-124"></a><span>                </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621680353360"><a href="#local-6989586621680353360"><span class="hs-identifier">regNo</span></a></a><span>
</span><a name="line-125"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353360"><span class="hs-identifier hs-var">regNo</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">32</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-126"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>                </span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span>        </span><a href="RegClass.html#RcDouble"><span class="hs-identifier hs-var">RcDouble</span></a><span>
</span><a name="line-131"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353358"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-132"></a><span>                </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621680353361"><a href="#local-6989586621680353361"><span class="hs-identifier">regNo</span></a></a><span>
</span><a name="line-133"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680353361"><span class="hs-identifier hs-var">regNo</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">32</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-134"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>                </span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>        </span><a name="local-6989586621680353362"><a href="#local-6989586621680353362"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- | All the allocatable registers in the machine,</span><span>
</span><a name="line-141"></a><span class="hs-comment">--      including register pairs.</span><span>
</span><a name="line-142"></a><span class="hs-identifier">allRealRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span class="hs-special">]</span><span>
</span><a name="line-143"></a><a name="allRealRegs"><a href="SPARC.Regs.html#allRealRegs"><span class="hs-identifier">allRealRegs</span></a></a><span>
</span><a name="line-144"></a><span>        </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a href="#local-6989586621680353363"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680353363"><a href="#local-6989586621680353363"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-number">63</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-145"></a><span>        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span>   </span><a href="#local-6989586621680353364"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680353364"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680353364"><a href="#local-6989586621680353364"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">32</span><span class="hs-special">,</span><span> </span><span class="hs-number">34</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-number">62</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-comment">-- | Get the regno for this sort of reg</span><span>
</span><a name="line-149"></a><span class="hs-identifier">gReg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lReg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">iReg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">oReg</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fReg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><a name="gReg"><a href="SPARC.Regs.html#gReg"><span class="hs-identifier">gReg</span></a></a><span> </span><a name="local-6989586621680353365"><a href="#local-6989586621680353365"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680353365"><span class="hs-identifier hs-var">x</span></a><span>             </span><span class="hs-comment">-- global regs</span><span>
</span><a name="line-152"></a><a name="oReg"><a href="SPARC.Regs.html#oReg"><span class="hs-identifier">oReg</span></a></a><span> </span><a name="local-6989586621680353366"><a href="#local-6989586621680353366"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">8</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680353366"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- output regs</span><span>
</span><a name="line-153"></a><a name="lReg"><a href="SPARC.Regs.html#lReg"><span class="hs-identifier">lReg</span></a></a><span> </span><a name="local-6989586621680353367"><a href="#local-6989586621680353367"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680353367"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- local regs</span><span>
</span><a name="line-154"></a><a name="iReg"><a href="SPARC.Regs.html#iReg"><span class="hs-identifier">iReg</span></a></a><span> </span><a name="local-6989586621680353368"><a href="#local-6989586621680353368"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">24</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680353368"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- input regs</span><span>
</span><a name="line-155"></a><a name="fReg"><a href="SPARC.Regs.html#fReg"><span class="hs-identifier">fReg</span></a></a><span> </span><a name="local-6989586621680353369"><a href="#local-6989586621680353369"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">32</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680353369"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- float regs</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- | Some specific regs used by the code generator.</span><span>
</span><a name="line-159"></a><span class="hs-identifier">g0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">g2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">o0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">o1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f6</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f22</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f26</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f27</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><a name="f6"><a href="SPARC.Regs.html#f6"><span class="hs-identifier">f6</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">6</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-162"></a><a name="f8"><a href="SPARC.Regs.html#f8"><span class="hs-identifier">f8</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><a name="f22"><a href="SPARC.Regs.html#f22"><span class="hs-identifier">f22</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">22</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><a name="f26"><a href="SPARC.Regs.html#f26"><span class="hs-identifier">f26</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">26</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-165"></a><a name="f27"><a href="SPARC.Regs.html#f27"><span class="hs-identifier">f27</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">27</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">-- g0 is always zero, and writes to it vanish.</span><span>
</span><a name="line-168"></a><a name="g0"><a href="SPARC.Regs.html#g0"><span class="hs-identifier">g0</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#gReg"><span class="hs-identifier hs-var">gReg</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-169"></a><a name="g1"><a href="SPARC.Regs.html#g1"><span class="hs-identifier">g1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#gReg"><span class="hs-identifier hs-var">gReg</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><a name="g2"><a href="SPARC.Regs.html#g2"><span class="hs-identifier">g2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#gReg"><span class="hs-identifier hs-var">gReg</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-comment">-- FP, SP, int and float return (from C) regs.</span><span>
</span><a name="line-173"></a><a name="fp"><a href="SPARC.Regs.html#fp"><span class="hs-identifier">fp</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#iReg"><span class="hs-identifier hs-var">iReg</span></a><span> </span><span class="hs-number">6</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><a name="sp"><a href="SPARC.Regs.html#sp"><span class="hs-identifier">sp</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><span class="hs-number">6</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-175"></a><a name="o0"><a href="SPARC.Regs.html#o0"><span class="hs-identifier">o0</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><a name="o1"><a href="SPARC.Regs.html#o1"><span class="hs-identifier">o1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-177"></a><a name="f0"><a href="SPARC.Regs.html#f0"><span class="hs-identifier">f0</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><a name="f1"><a href="SPARC.Regs.html#f1"><span class="hs-identifier">f1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-special">(</span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- | Produce the second-half-of-a-double register given the first half.</span><span>
</span><a name="line-181"></a><span class="hs-comment">{-
fPair :: Reg -&gt; Maybe Reg
fPair (RealReg n)
        | n &gt;= 32 &amp;&amp; n `mod` 2 == 0  = Just (RealReg (n+1))

fPair (VirtualRegD u)
        = Just (VirtualRegHi u)

fPair reg
        = trace (&quot;MachInstrs.fPair: can't get high half of supposed double reg &quot; ++ showPpr reg)
                Nothing
-}</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-comment">-- | All the regs that the register allocator can allocate to,</span><span>
</span><a name="line-196"></a><span class="hs-comment">--      with the fixed use regs removed.</span><span>
</span><a name="line-197"></a><span class="hs-comment">--</span><span>
</span><a name="line-198"></a><span class="hs-identifier">allocatableRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span class="hs-special">]</span><span>
</span><a name="line-199"></a><a name="allocatableRegs"><a href="SPARC.Regs.html#allocatableRegs"><span class="hs-identifier">allocatableRegs</span></a></a><span>
</span><a name="line-200"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680353370"><a href="#local-6989586621680353370"><span class="hs-identifier">isFree</span></a></a><span> </span><a name="local-6989586621680353371"><a href="#local-6989586621680353371"><span class="hs-identifier">rr</span></a></a><span>
</span><a name="line-201"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353371"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-202"></a><span>                </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621680353372"><a href="#local-6989586621680353372"><span class="hs-identifier">r</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CodeGen.Platform.SPARC.html#freeReg"><span class="hs-identifier hs-var">freeReg</span></a><span> </span><a href="#local-6989586621680353372"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-203"></a><span>                </span><a href="Reg.html#RealRegPair"><span class="hs-identifier hs-var">RealRegPair</span></a><span>   </span><a name="local-6989586621680353373"><a href="#local-6989586621680353373"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621680353374"><a href="#local-6989586621680353374"><span class="hs-identifier">r2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CodeGen.Platform.SPARC.html#freeReg"><span class="hs-identifier hs-var">freeReg</span></a><span> </span><a href="#local-6989586621680353373"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="CodeGen.Platform.SPARC.html#freeReg"><span class="hs-identifier hs-var">freeReg</span></a><span> </span><a href="#local-6989586621680353374"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-204"></a><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621680353370"><span class="hs-identifier hs-var">isFree</span></a><span> </span><a href="SPARC.Regs.html#allRealRegs"><span class="hs-identifier hs-var">allRealRegs</span></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-comment">-- | The registers to place arguments for function calls,</span><span>
</span><a name="line-208"></a><span class="hs-comment">--      for some number of arguments.</span><span>
</span><a name="line-209"></a><span class="hs-comment">--</span><span>
</span><a name="line-210"></a><span class="hs-identifier">argRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#RegNo"><span class="hs-identifier hs-type">RegNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-211"></a><a name="argRegs"><a href="SPARC.Regs.html#argRegs"><span class="hs-identifier">argRegs</span></a></a><span> </span><a name="local-6989586621680353375"><a href="#local-6989586621680353375"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-212"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353375"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-213"></a><span>        </span><span class="hs-number">0</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-number">1</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">]</span><span>
</span><a name="line-215"></a><span>        </span><span class="hs-number">2</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-216"></a><span>        </span><span class="hs-number">3</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">]</span><span>
</span><a name="line-217"></a><span>        </span><span class="hs-number">4</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">]</span><span>
</span><a name="line-218"></a><span>        </span><span class="hs-number">5</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">]</span><span>
</span><a name="line-219"></a><span>        </span><span class="hs-number">6</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">5</span><span class="hs-special">]</span><span>
</span><a name="line-220"></a><span>        </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;MachRegs.argRegs(sparc): don't know about &gt;6 arguments!&quot;</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-comment">-- | All all the regs that could possibly be returned by argRegs</span><span>
</span><a name="line-224"></a><span class="hs-comment">--</span><span>
</span><a name="line-225"></a><span class="hs-identifier">allArgRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-226"></a><a name="allArgRegs"><a href="SPARC.Regs.html#allArgRegs"><span class="hs-identifier">allArgRegs</span></a></a><span>
</span><a name="line-227"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><a href="#local-6989586621680353376"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680353376"><a href="#local-6989586621680353376"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-number">5</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-comment">-- These are the regs that we cannot assume stay alive over a C call.</span><span>
</span><a name="line-231"></a><span class="hs-comment">--      TODO: Why can we assume that o6 isn't clobbered? -- BL 2009/02</span><span>
</span><a name="line-232"></a><span class="hs-comment">--</span><span>
</span><a name="line-233"></a><span class="hs-identifier">callClobberedRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-234"></a><a name="callClobberedRegs"><a href="SPARC.Regs.html#callClobberedRegs"><span class="hs-identifier">callClobberedRegs</span></a></a><span>
</span><a name="line-235"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>                </span><span class="hs-special">(</span><span>  </span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><span class="hs-number">7</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-237"></a><span>                  </span><span class="hs-special">[</span><a href="SPARC.Regs.html#oReg"><span class="hs-identifier hs-var">oReg</span></a><span> </span><a href="#local-6989586621680353377"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680353377"><a href="#local-6989586621680353377"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-number">5</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-238"></a><span>                  </span><span class="hs-special">[</span><a href="SPARC.Regs.html#gReg"><span class="hs-identifier hs-var">gReg</span></a><span> </span><a href="#local-6989586621680353378"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680353378"><a href="#local-6989586621680353378"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-number">7</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-239"></a><span>                  </span><span class="hs-special">[</span><a href="SPARC.Regs.html#fReg"><span class="hs-identifier hs-var">fReg</span></a><span> </span><a href="#local-6989586621680353379"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680353379"><a href="#local-6989586621680353379"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-number">31</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-comment">-- | Make a virtual reg with this format.</span><span>
</span><a name="line-244"></a><span class="hs-identifier">mkVirtualReg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Unique</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#VirtualReg"><span class="hs-identifier hs-type">VirtualReg</span></a><span>
</span><a name="line-245"></a><a name="mkVirtualReg"><a href="SPARC.Regs.html#mkVirtualReg"><span class="hs-identifier">mkVirtualReg</span></a></a><span> </span><a name="local-6989586621680353380"><a href="#local-6989586621680353380"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621680353381"><a href="#local-6989586621680353381"><span class="hs-identifier">format</span></a></a><span>
</span><a name="line-246"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Format.html#isFloatFormat"><span class="hs-identifier hs-var">isFloatFormat</span></a><span> </span><a href="#local-6989586621680353381"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#VirtualRegI"><span class="hs-identifier hs-var">VirtualRegI</span></a><span> </span><a href="#local-6989586621680353380"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-250"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680353381"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-251"></a><span>                </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#VirtualRegF"><span class="hs-identifier hs-var">VirtualRegF</span></a><span> </span><a href="#local-6989586621680353380"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-252"></a><span>                </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#VirtualRegD"><span class="hs-identifier hs-var">VirtualRegD</span></a><span> </span><a href="#local-6989586621680353380"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-253"></a><span>                </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;mkVReg&quot;</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-identifier">regDotColor</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#RealReg"><span class="hs-identifier hs-type">RealReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-257"></a><a name="regDotColor"><a href="SPARC.Regs.html#regDotColor"><span class="hs-identifier">regDotColor</span></a></a><span> </span><a name="local-6989586621680353382"><a href="#local-6989586621680353382"><span class="hs-identifier">reg</span></a></a><span>
</span><a name="line-258"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="SPARC.Regs.html#classOfRealReg"><span class="hs-identifier hs-var">classOfRealReg</span></a><span> </span><a href="#local-6989586621680353382"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-259"></a><span>        </span><a href="RegClass.html#RcInteger"><span class="hs-identifier hs-var">RcInteger</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;blue&quot;</span><span>
</span><a name="line-260"></a><span>        </span><a href="RegClass.html#RcFloat"><span class="hs-identifier hs-var">RcFloat</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;red&quot;</span><span>
</span><a name="line-261"></a><span>        </span><a name="local-6989586621680353383"><a href="#local-6989586621680353383"><span class="hs-identifier">_other</span></a></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;green&quot;</span><span>
</span><a name="line-262"></a></pre></body></html>