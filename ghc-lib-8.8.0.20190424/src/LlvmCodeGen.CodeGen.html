<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, GADTs #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-type-defaults #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- | Handle conversion of CmmProc to LLVM code.</span><span>
</span><a name="line-5"></a><span class="hs-comment">--</span><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">LlvmCodeGen.CodeGen</span><span> </span><span class="hs-special">(</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLlvmProc"><span class="hs-identifier hs-var">genLlvmProc</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="Llvm.html"><span class="hs-identifier">Llvm</span></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="LlvmCodeGen.Base.html"><span class="hs-identifier">LlvmCodeGen.Base</span></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="LlvmCodeGen.Regs.html"><span class="hs-identifier">LlvmCodeGen.Regs</span></a><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="BlockId.html"><span class="hs-identifier">BlockId</span></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="CodeGen.Platform.html"><span class="hs-identifier">CodeGen.Platform</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="CodeGen.Platform.html#activeStgRegs"><span class="hs-identifier hs-var">activeStgRegs</span></a><span class="hs-special">,</span><span> </span><a href="CodeGen.Platform.html#callerSaves"><span class="hs-identifier hs-var">callerSaves</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="CLabel.html"><span class="hs-identifier">CLabel</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Cmm.html"><span class="hs-identifier">Cmm</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="PprCmm.html"><span class="hs-identifier">PprCmm</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="CmmUtils.html"><span class="hs-identifier">CmmUtils</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="CmmSwitch.html"><span class="hs-identifier">CmmSwitch</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Block.html"><span class="hs-identifier">Hoopl.Block</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Graph.html"><span class="hs-identifier">Hoopl.Graph</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Collections.html"><span class="hs-identifier">Hoopl.Collections</span></a><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ForeignCall</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">panic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">OrdList</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqSupply</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unique</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Class</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Trans.Writer</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Semigroup</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Semigroup</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">type</span><span> </span><a name="Atomic"><a href="LlvmCodeGen.CodeGen.html#Atomic"><span class="hs-identifier">Atomic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-46"></a><span class="hs-keyword">type</span><span> </span><a name="LlvmStatements"><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier">LlvmStatements</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="Llvm.AbsSyn.html#LlvmStatement"><span class="hs-identifier hs-type">LlvmStatement</span></a><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-keyword">data</span><span> </span><a name="Signage"><a href="LlvmCodeGen.CodeGen.html#Signage"><span class="hs-identifier">Signage</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Signed"><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier">Signed</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Unsigned"><a href="LlvmCodeGen.CodeGen.html#Unsigned"><span class="hs-identifier">Unsigned</span></a></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- | Top-level of the LLVM proc Code generator</span><span>
</span><a name="line-52"></a><span class="hs-comment">--</span><span>
</span><a name="line-53"></a><span class="hs-identifier">genLlvmProc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span>
</span><a name="line-54"></a><a name="genLlvmProc"><a href="LlvmCodeGen.CodeGen.html#genLlvmProc"><span class="hs-identifier">genLlvmProc</span></a></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a name="local-6989586621680818457"><a href="#local-6989586621680818457"><span class="hs-identifier">infos</span></a></a><span> </span><a name="local-6989586621680818458"><a href="#local-6989586621680818458"><span class="hs-identifier">lbl</span></a></a><span> </span><a name="local-6989586621680818459"><a href="#local-6989586621680818459"><span class="hs-identifier">live</span></a></a><span> </span><a name="local-6989586621680818460"><a href="#local-6989586621680818460"><span class="hs-identifier">graph</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818461"><a href="#local-6989586621680818461"><span class="hs-identifier">blocks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmUtils.html#toBlockListEntryFirstFalseFallthrough"><span class="hs-identifier hs-var">toBlockListEntryFirstFalseFallthrough</span></a><span> </span><a href="#local-6989586621680818460"><span class="hs-identifier hs-var">graph</span></a><span>
</span><a name="line-56"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818462"><a href="#local-6989586621680818462"><span class="hs-identifier">lmblocks</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818463"><a href="#local-6989586621680818463"><span class="hs-identifier">lmdata</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#basicBlocksCodeGen"><span class="hs-identifier hs-var">basicBlocksCodeGen</span></a><span> </span><a href="#local-6989586621680818459"><span class="hs-identifier hs-var">live</span></a><span> </span><a href="#local-6989586621680818461"><span class="hs-identifier hs-var">blocks</span></a><span>
</span><a name="line-57"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818464"><a href="#local-6989586621680818464"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Collections.html#mapLookup"><span class="hs-identifier hs-var">mapLookup</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">g_entry</span><span> </span><a href="#local-6989586621680818460"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818457"><span class="hs-identifier hs-var">infos</span></a><span>
</span><a name="line-58"></a><span>        </span><a name="local-6989586621680818465"><a href="#local-6989586621680818465"><span class="hs-identifier">proc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a href="#local-6989586621680818464"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621680818458"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621680818459"><span class="hs-identifier hs-var">live</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a><span> </span><a href="#local-6989586621680818462"><span class="hs-identifier hs-var">lmblocks</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818465"><span class="hs-identifier hs-var">proc</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680818463"><span class="hs-identifier hs-var">lmdata</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-identifier">genLlvmProc</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genLlvmProc: case that shouldn't reach here!&quot;</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-64"></a><span class="hs-comment">-- * Block code generation</span><span>
</span><a name="line-65"></a><span class="hs-comment">--</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-comment">-- | Generate code for a list of blocks that make up a complete</span><span>
</span><a name="line-68"></a><span class="hs-comment">-- procedure. The first block in the list is expected to be the entry</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- point and will get the prologue.</span><span>
</span><a name="line-70"></a><span class="hs-identifier">basicBlocksCodeGen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.Base.html#LiveGlobalRegs"><span class="hs-identifier hs-type">LiveGlobalRegs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a><span class="hs-special">]</span><span>
</span><a name="line-71"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmBasicBlock"><span class="hs-identifier hs-type">LlvmBasicBlock</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><a name="basicBlocksCodeGen"><a href="LlvmCodeGen.CodeGen.html#basicBlocksCodeGen"><span class="hs-identifier">basicBlocksCodeGen</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;no entry block!&quot;</span><span>
</span><a name="line-73"></a><span class="hs-identifier">basicBlocksCodeGen</span><span> </span><a name="local-6989586621680818466"><a href="#local-6989586621680818466"><span class="hs-identifier">live</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680818467"><a href="#local-6989586621680818467"><span class="hs-identifier">entryBlock</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680818468"><a href="#local-6989586621680818468"><span class="hs-identifier">cmmBlocks</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818469"><a href="#local-6989586621680818469"><span class="hs-identifier">prologue</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818470"><a href="#local-6989586621680818470"><span class="hs-identifier">prologueTops</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#funPrologue"><span class="hs-identifier hs-var">funPrologue</span></a><span> </span><a href="#local-6989586621680818466"><span class="hs-identifier hs-var">live</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818467"><span class="hs-identifier hs-var">entryBlock</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680818468"><span class="hs-identifier hs-var">cmmBlocks</span></a><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span>       </span><span class="hs-comment">-- Generate code</span><span>
</span><a name="line-77"></a><span>       </span><span class="hs-special">(</span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a name="local-6989586621680818471"><a href="#local-6989586621680818471"><span class="hs-identifier">bid</span></a></a><span> </span><a name="local-6989586621680818472"><a href="#local-6989586621680818472"><span class="hs-identifier">entry</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818473"><a href="#local-6989586621680818473"><span class="hs-identifier">entryTops</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier hs-var">basicBlockCodeGen</span></a><span> </span><a href="#local-6989586621680818467"><span class="hs-identifier hs-var">entryBlock</span></a><span>
</span><a name="line-78"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621680818474"><a href="#local-6989586621680818474"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818475"><a href="#local-6989586621680818475"><span class="hs-identifier">topss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="LlvmCodeGen.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier hs-var">basicBlockCodeGen</span></a><span> </span><a href="#local-6989586621680818468"><span class="hs-identifier hs-var">cmmBlocks</span></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>       </span><span class="hs-comment">-- Compose</span><span>
</span><a name="line-81"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818476"><a href="#local-6989586621680818476"><span class="hs-identifier">entryBlock</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621680818471"><span class="hs-identifier hs-var">bid</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromOL</span><span> </span><a href="#local-6989586621680818469"><span class="hs-identifier hs-var">prologue</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818472"><span class="hs-identifier hs-var">entry</span></a><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818476"><span class="hs-identifier hs-var">entryBlock</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680818474"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818470"><span class="hs-identifier hs-var">prologueTops</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818473"><span class="hs-identifier hs-var">entryTops</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621680818475"><span class="hs-identifier hs-var">topss</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">-- | Generate code for one block</span><span>
</span><a name="line-86"></a><span class="hs-identifier">basicBlockCodeGen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmBasicBlock"><span class="hs-identifier hs-type">LlvmBasicBlock</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><a name="basicBlockCodeGen"><a href="LlvmCodeGen.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier">basicBlockCodeGen</span></a></a><span> </span><a name="local-6989586621680818477"><a href="#local-6989586621680818477"><span class="hs-identifier">block</span></a></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680818478"><a href="#local-6989586621680818478"><span class="hs-identifier">nodes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818479"><a href="#local-6989586621680818479"><span class="hs-identifier">tail</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a><span> </span><a href="#local-6989586621680818477"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-89"></a><span>           </span><a name="local-6989586621680818480"><a href="#local-6989586621680818480"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a><span> </span><a href="#local-6989586621680818477"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-90"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621680818481"><a href="#local-6989586621680818481"><span class="hs-identifier">mid_instrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818482"><a href="#local-6989586621680818482"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#stmtsToInstrs"><span class="hs-identifier hs-var">stmtsToInstrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Hoopl.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a><span> </span><a href="#local-6989586621680818478"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-91"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621680818483"><a href="#local-6989586621680818483"><span class="hs-identifier">tail_instrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818484"><a href="#local-6989586621680818484"><span class="hs-identifier">top'</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621680818479"><span class="hs-identifier hs-var">tail</span></a><span>
</span><a name="line-92"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818485"><a href="#local-6989586621680818485"><span class="hs-identifier">instrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromOL</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818481"><span class="hs-identifier hs-var">mid_instrs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818483"><span class="hs-identifier hs-var">tail_instrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621680818480"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621680818485"><span class="hs-identifier hs-var">instrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818484"><span class="hs-identifier hs-var">top'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818482"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- * CmmNode code generation</span><span>
</span><a name="line-97"></a><span class="hs-comment">--</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">-- A statement conversion return data.</span><span>
</span><a name="line-100"></a><span class="hs-comment">--   * LlvmStatements: The compiled LLVM statements.</span><span>
</span><a name="line-101"></a><span class="hs-comment">--   * LlvmCmmDecl: Any global data needed.</span><span>
</span><a name="line-102"></a><span class="hs-keyword">type</span><span> </span><a name="StmtData"><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier">StmtData</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-comment">-- | Convert a list of CmmNode's to LlvmStatement's</span><span>
</span><a name="line-106"></a><span class="hs-identifier">stmtsToInstrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="#local-6989586621680818455"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621680818456"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-107"></a><a name="stmtsToInstrs"><a href="LlvmCodeGen.CodeGen.html#stmtsToInstrs"><span class="hs-identifier">stmtsToInstrs</span></a></a><span> </span><a name="local-6989586621680818486"><a href="#local-6989586621680818486"><span class="hs-identifier">stmts</span></a></a><span>
</span><a name="line-108"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818487"><a href="#local-6989586621680818487"><span class="hs-identifier">instrss</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818488"><a href="#local-6989586621680818488"><span class="hs-identifier">topss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="LlvmCodeGen.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621680818486"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-109"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621680818487"><span class="hs-identifier hs-var">instrss</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621680818488"><span class="hs-identifier hs-var">topss</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">-- | Convert a CmmStmt to a list of LlvmStatement's</span><span>
</span><a name="line-113"></a><span class="hs-identifier">stmtToInstrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="#local-6989586621680818453"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621680818454"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-114"></a><a name="stmtToInstrs"><a href="LlvmCodeGen.CodeGen.html#stmtToInstrs"><span class="hs-identifier">stmtToInstrs</span></a></a><span> </span><a name="local-6989586621680818489"><a href="#local-6989586621680818489"><span class="hs-identifier">stmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818489"><span class="hs-identifier hs-var">stmt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>    </span><a href="CmmNode.html#CmmComment"><span class="hs-identifier hs-var">CmmComment</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- nuke comments</span><span>
</span><a name="line-117"></a><span>    </span><a href="CmmNode.html#CmmTick"><span class="hs-identifier hs-var">CmmTick</span></a><span>    </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>    </span><a href="CmmNode.html#CmmUnwind"><span class="hs-identifier hs-var">CmmUnwind</span></a><span>  </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>    </span><a href="CmmNode.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a><span> </span><a name="local-6989586621680818490"><a href="#local-6989586621680818490"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621680818491"><a href="#local-6989586621680818491"><span class="hs-identifier">src</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genAssign"><span class="hs-identifier hs-var">genAssign</span></a><span> </span><a href="#local-6989586621680818490"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621680818491"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-121"></a><span>    </span><a href="CmmNode.html#CmmStore"><span class="hs-identifier hs-var">CmmStore</span></a><span> </span><a name="local-6989586621680818492"><a href="#local-6989586621680818492"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621680818493"><a href="#local-6989586621680818493"><span class="hs-identifier">src</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genStore"><span class="hs-identifier hs-var">genStore</span></a><span> </span><a href="#local-6989586621680818492"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621680818493"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span>    </span><a href="CmmNode.html#CmmBranch"><span class="hs-identifier hs-var">CmmBranch</span></a><span> </span><a name="local-6989586621680818494"><a href="#local-6989586621680818494"><span class="hs-identifier">id</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621680818494"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-124"></a><span>    </span><a href="CmmNode.html#CmmCondBranch"><span class="hs-identifier hs-var">CmmCondBranch</span></a><span> </span><a name="local-6989586621680818495"><a href="#local-6989586621680818495"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621680818496"><a href="#local-6989586621680818496"><span class="hs-identifier">true</span></a></a><span> </span><a name="local-6989586621680818497"><a href="#local-6989586621680818497"><span class="hs-identifier">false</span></a></a><span> </span><a name="local-6989586621680818498"><a href="#local-6989586621680818498"><span class="hs-identifier">likely</span></a></a><span>
</span><a name="line-125"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genCondBranch"><span class="hs-identifier hs-var">genCondBranch</span></a><span> </span><a href="#local-6989586621680818495"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621680818496"><span class="hs-identifier hs-var">true</span></a><span> </span><a href="#local-6989586621680818497"><span class="hs-identifier hs-var">false</span></a><span> </span><a href="#local-6989586621680818498"><span class="hs-identifier hs-var">likely</span></a><span>
</span><a name="line-126"></a><span>    </span><a href="CmmNode.html#CmmSwitch"><span class="hs-identifier hs-var">CmmSwitch</span></a><span> </span><a name="local-6989586621680818499"><a href="#local-6989586621680818499"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621680818500"><a href="#local-6989586621680818500"><span class="hs-identifier">ids</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genSwitch"><span class="hs-identifier hs-var">genSwitch</span></a><span> </span><a href="#local-6989586621680818499"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621680818500"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>    </span><span class="hs-comment">-- Foreign Call</span><span>
</span><a name="line-129"></a><span>    </span><a href="CmmNode.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-var">CmmUnsafeForeignCall</span></a><span> </span><a name="local-6989586621680818501"><a href="#local-6989586621680818501"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621680818502"><a href="#local-6989586621680818502"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-6989586621680818503"><a href="#local-6989586621680818503"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-130"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genCall"><span class="hs-identifier hs-var">genCall</span></a><span> </span><a href="#local-6989586621680818501"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621680818502"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621680818503"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span>    </span><span class="hs-comment">-- Tail call</span><span>
</span><a name="line-133"></a><span>    </span><a href="CmmNode.html#CmmCall"><span class="hs-identifier hs-var">CmmCall</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cml_target</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680818504"><a href="#local-6989586621680818504"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-134"></a><span>              </span><span class="hs-identifier">cml_args_regs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680818505"><a href="#local-6989586621680818505"><span class="hs-identifier">live</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genJump"><span class="hs-identifier hs-var">genJump</span></a><span> </span><a href="#local-6989586621680818504"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621680818505"><span class="hs-identifier hs-var">live</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;Llvm.CodeGen.stmtToInstrs&quot;</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | Wrapper function to declare an instrinct function by function type</span><span>
</span><a name="line-139"></a><span class="hs-identifier">getInstrinct2</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Llvm.Types.html#LMString"><span class="hs-identifier hs-type">LMString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-140"></a><a name="getInstrinct2"><a href="LlvmCodeGen.CodeGen.html#getInstrinct2"><span class="hs-identifier">getInstrinct2</span></a></a><span> </span><a name="local-6989586621680818506"><a href="#local-6989586621680818506"><span class="hs-identifier">fname</span></a></a><span> </span><a name="local-6989586621680818507"><a href="#local-6989586621680818507"><span class="hs-identifier">fty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Llvm.Types.html#LMFunction"><span class="hs-identifier hs-var">LMFunction</span></a><span> </span><a name="local-6989586621680818508"><a href="#local-6989586621680818508"><span class="hs-identifier">funSig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818509"><a href="#local-6989586621680818509"><span class="hs-identifier">fv</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMGlobalVar"><span class="hs-identifier hs-var">LMGlobalVar</span></a><span> </span><a href="#local-6989586621680818506"><span class="hs-identifier hs-var">fname</span></a><span> </span><a href="#local-6989586621680818507"><span class="hs-identifier hs-var">fty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">funcLinkage</span><span> </span><a href="#local-6989586621680818508"><span class="hs-identifier hs-var">funSig</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="Llvm.Types.html#Constant"><span class="hs-identifier hs-var">Constant</span></a><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621680818510"><a href="#local-6989586621680818510"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#funLookup"><span class="hs-identifier hs-var">funLookup</span></a><span> </span><a href="#local-6989586621680818506"><span class="hs-identifier hs-var">fname</span></a><span>
</span><a name="line-145"></a><span>    </span><a name="local-6989586621680818513"><a href="#local-6989586621680818513"><span class="hs-identifier">tops</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818510"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-146"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-147"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-148"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-149"></a><span>        </span><a href="LlvmCodeGen.Base.html#funInsert"><span class="hs-identifier hs-var">funInsert</span></a><span> </span><a href="#local-6989586621680818506"><span class="hs-identifier hs-var">fname</span></a><span> </span><a href="#local-6989586621680818507"><span class="hs-identifier hs-var">fty</span></a><span>
</span><a name="line-150"></a><span>        </span><a name="local-6989586621680818511"><a href="#local-6989586621680818511"><span class="hs-identifier">un</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getUniqueM</span><span>
</span><a name="line-151"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818512"><a href="#local-6989586621680818512"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkAsmTempLabel"><span class="hs-identifier hs-var">mkAsmTempLabel</span></a><span> </span><a href="#local-6989586621680818511"><span class="hs-identifier hs-var">un</span></a><span>
</span><a name="line-152"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#Data"><span class="hs-identifier hs-var">Data</span></a><span> </span><a href="#local-6989586621680818512"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="#local-6989586621680818507"><span class="hs-identifier hs-var">fty</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818509"><span class="hs-identifier hs-var">fv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818513"><span class="hs-identifier hs-var">tops</span></a><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-identifier">getInstrinct2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;getInstrinct2: Non-function type!&quot;</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- | Declares an instrinct function by return and parameter types</span><span>
</span><a name="line-159"></a><span class="hs-identifier">getInstrinct</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Llvm.Types.html#LMString"><span class="hs-identifier hs-type">LMString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-160"></a><a name="getInstrinct"><a href="LlvmCodeGen.CodeGen.html#getInstrinct"><span class="hs-identifier">getInstrinct</span></a></a><span> </span><a name="local-6989586621680818514"><a href="#local-6989586621680818514"><span class="hs-identifier">fname</span></a></a><span> </span><a name="local-6989586621680818515"><a href="#local-6989586621680818515"><span class="hs-identifier">retTy</span></a></a><span> </span><a name="local-6989586621680818516"><a href="#local-6989586621680818516"><span class="hs-identifier">parTys</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818517"><a href="#local-6989586621680818517"><span class="hs-identifier">funSig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LlvmFunctionDecl"><span class="hs-identifier hs-var">LlvmFunctionDecl</span></a><span> </span><a href="#local-6989586621680818514"><span class="hs-identifier hs-var">fname</span></a><span> </span><a href="Llvm.Types.html#ExternallyVisible"><span class="hs-identifier hs-var">ExternallyVisible</span></a><span> </span><a href="Llvm.Types.html#CC_Ccc"><span class="hs-identifier hs-var">CC_Ccc</span></a><span> </span><a href="#local-6989586621680818515"><span class="hs-identifier hs-var">retTy</span></a><span>
</span><a name="line-162"></a><span>                    </span><a href="Llvm.Types.html#FixedArgs"><span class="hs-identifier hs-var">FixedArgs</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#tysToParams"><span class="hs-identifier hs-var">tysToParams</span></a><span> </span><a href="#local-6989586621680818516"><span class="hs-identifier hs-var">parTys</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-163"></a><span>        </span><a name="local-6989586621680818518"><a href="#local-6989586621680818518"><span class="hs-identifier">fty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMFunction"><span class="hs-identifier hs-var">LMFunction</span></a><span> </span><a href="#local-6989586621680818517"><span class="hs-identifier hs-var">funSig</span></a><span>
</span><a name="line-164"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getInstrinct2"><span class="hs-identifier hs-var">getInstrinct2</span></a><span> </span><a href="#local-6989586621680818514"><span class="hs-identifier hs-var">fname</span></a><span> </span><a href="#local-6989586621680818518"><span class="hs-identifier hs-var">fty</span></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">-- | Memory barrier instruction for LLVM &gt;= 3.0</span><span>
</span><a name="line-167"></a><span class="hs-identifier">barrier</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-168"></a><a name="barrier"><a href="LlvmCodeGen.CodeGen.html#barrier"><span class="hs-identifier">barrier</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818519"><a href="#local-6989586621680818519"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Fence"><span class="hs-identifier hs-var">Fence</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="Llvm.AbsSyn.html#SyncSeqCst"><span class="hs-identifier hs-var">SyncSeqCst</span></a><span>
</span><a name="line-170"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="#local-6989586621680818519"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-comment">-- | Foreign Calls</span><span>
</span><a name="line-173"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>
</span><a name="line-174"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-comment">-- Write barrier needs to be handled specially as it is implemented as an LLVM</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- intrinsic function.</span><span>
</span><a name="line-178"></a><a name="genCall"><a href="LlvmCodeGen.CodeGen.html#genCall"><span class="hs-identifier">genCall</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_WriteBarrier"><span class="hs-identifier hs-var">MO_WriteBarrier</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-179"></a><span>    </span><a name="local-6989586621680818520"><a href="#local-6989586621680818520"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#getLlvmPlatform"><span class="hs-identifier hs-var">getLlvmPlatform</span></a><span>
</span><a name="line-180"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-6989586621680818520"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ArchX86</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ArchX86_64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ArchSPARC</span><span class="hs-special">]</span><span>
</span><a name="line-181"></a><span>       </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>       </span><span class="hs-keyword">else</span><span> </span><a href="LlvmCodeGen.CodeGen.html#barrier"><span class="hs-identifier hs-var">barrier</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_Touch"><span class="hs-identifier hs-var">MO_Touch</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-185"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UF_Conv"><span class="hs-identifier hs-var">MO_UF_Conv</span></a><span> </span><a name="local-6989586621680818521"><a href="#local-6989586621680818521"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818522"><a href="#local-6989586621680818522"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818523"><a href="#local-6989586621680818523"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-188"></a><span>    </span><a name="local-6989586621680818524"><a href="#local-6989586621680818524"><span class="hs-identifier">dstV</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegW"><span class="hs-identifier hs-var">getCmmRegW</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818522"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818525"><a href="#local-6989586621680818525"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#localRegType"><span class="hs-identifier hs-var">localRegType</span></a><span> </span><a href="#local-6989586621680818522"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-190"></a><span>        </span><a name="local-6989586621680818526"><a href="#local-6989586621680818526"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680818521"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-191"></a><span>    </span><a name="local-6989586621680818527"><a href="#local-6989586621680818527"><span class="hs-identifier">castV</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkLocalVar"><span class="hs-identifier hs-var">mkLocalVar</span></a><span> </span><a href="#local-6989586621680818525"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-192"></a><span>    </span><a name="local-6989586621680818528"><a href="#local-6989586621680818528"><span class="hs-identifier">ve</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818523"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-193"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a><span> </span><a href="#local-6989586621680818527"><span class="hs-identifier hs-var">castV</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Uitofp"><span class="hs-identifier hs-var">LM_Uitofp</span></a><span> </span><a href="#local-6989586621680818528"><span class="hs-identifier hs-var">ve</span></a><span> </span><a href="#local-6989586621680818526"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-194"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818527"><span class="hs-identifier hs-var">castV</span></a><span> </span><a href="#local-6989586621680818524"><span class="hs-identifier hs-var">dstV</span></a><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UF_Conv"><span class="hs-identifier hs-var">MO_UF_Conv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680818529"><a href="#local-6989586621680818529"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-197"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCall: Too many arguments to MO_UF_Conv. &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-string">&quot;Can only handle 1, given&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680818529"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- Handle prefetching data</span><span>
</span><a name="line-201"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818530"><a href="#local-6989586621680818530"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-var">MO_Prefetch_Data</span></a><span> </span><a name="local-6989586621680818531"><a href="#local-6989586621680818531"><span class="hs-identifier">localityInt</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680818532"><a href="#local-6989586621680818532"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621680818531"><span class="hs-identifier hs-var">localityInt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680818531"><span class="hs-identifier hs-var">localityInt</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818533"><a href="#local-6989586621680818533"><span class="hs-identifier">argTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Llvm.Types.html#i8Ptr"><span class="hs-identifier hs-var">i8Ptr</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span class="hs-special">]</span><span>
</span><a name="line-204"></a><span>        </span><a name="local-6989586621680818534"><a href="#local-6989586621680818534"><span class="hs-identifier">funTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680818535"><a href="#local-6989586621680818535"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LMFunction"><span class="hs-identifier hs-var">LMFunction</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LlvmFunctionDecl"><span class="hs-identifier hs-var">LlvmFunctionDecl</span></a><span> </span><a href="#local-6989586621680818535"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Llvm.Types.html#ExternallyVisible"><span class="hs-identifier hs-var">ExternallyVisible</span></a><span>
</span><a name="line-205"></a><span>                             </span><a href="Llvm.Types.html#CC_Ccc"><span class="hs-identifier hs-var">CC_Ccc</span></a><span> </span><a href="Llvm.Types.html#LMVoid"><span class="hs-identifier hs-var">LMVoid</span></a><span> </span><a href="Llvm.Types.html#FixedArgs"><span class="hs-identifier hs-var">FixedArgs</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#tysToParams"><span class="hs-identifier hs-var">tysToParams</span></a><span> </span><a href="#local-6989586621680818533"><span class="hs-identifier hs-var">argTy</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680818536"><a href="#local-6989586621680818536"><span class="hs-identifier">arg_hints</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#foreignTargetHints"><span class="hs-identifier hs-var">foreignTargetHints</span></a><span> </span><a href="#local-6989586621680818530"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-208"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818537"><a href="#local-6989586621680818537"><span class="hs-identifier">args_hints'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818532"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621680818536"><span class="hs-identifier hs-var">arg_hints</span></a><span>
</span><a name="line-209"></a><span>    </span><a name="local-6989586621680818538"><a href="#local-6989586621680818538"><span class="hs-identifier">argVars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#arg_varsW"><span class="hs-identifier hs-var">arg_varsW</span></a><span> </span><a href="#local-6989586621680818537"><span class="hs-identifier hs-var">args_hints'</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>    </span><a name="local-6989586621680818539"><a href="#local-6989586621680818539"><span class="hs-identifier">fptr</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#liftExprData"><span class="hs-identifier hs-var">liftExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getFunPtr"><span class="hs-identifier hs-var">getFunPtr</span></a><span> </span><a href="#local-6989586621680818534"><span class="hs-identifier hs-var">funTy</span></a><span> </span><a href="#local-6989586621680818530"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-211"></a><span>    </span><a name="local-6989586621680818540"><a href="#local-6989586621680818540"><span class="hs-identifier">argVars'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVarsW"><span class="hs-identifier hs-var">castVarsW</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818538"><span class="hs-identifier hs-var">argVars</span></a><span> </span><a href="#local-6989586621680818533"><span class="hs-identifier hs-var">argTy</span></a><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#doTrashStmts"><span class="hs-identifier hs-var">doTrashStmts</span></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818541"><a href="#local-6989586621680818541"><span class="hs-identifier">argSuffix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span> </span><a href="#local-6989586621680818531"><span class="hs-identifier hs-var">localityInt</span></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-215"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Expr"><span class="hs-identifier hs-var">Expr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="Llvm.Types.html#StdCall"><span class="hs-identifier hs-var">StdCall</span></a><span> </span><a href="#local-6989586621680818539"><span class="hs-identifier hs-var">fptr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818540"><span class="hs-identifier hs-var">argVars'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818541"><span class="hs-identifier hs-var">argSuffix</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-216"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;prefetch locality level integer must be between 0 and 3, given: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680818531"><span class="hs-identifier hs-var">localityInt</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">-- Handle PopCnt, Clz, Ctz, and BSwap that need to only convert arg</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- and return types</span><span>
</span><a name="line-220"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818542"><a href="#local-6989586621680818542"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_PopCnt"><span class="hs-identifier hs-var">MO_PopCnt</span></a><span> </span><a name="local-6989586621680818543"><a href="#local-6989586621680818543"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680818544"><a href="#local-6989586621680818544"><span class="hs-identifier">dsts</span></a></a><span> </span><a name="local-6989586621680818545"><a href="#local-6989586621680818545"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-221"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallSimpleCast"><span class="hs-identifier hs-var">genCallSimpleCast</span></a><span> </span><a href="#local-6989586621680818543"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621680818542"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818544"><span class="hs-identifier hs-var">dsts</span></a><span> </span><a href="#local-6989586621680818545"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818546"><a href="#local-6989586621680818546"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Pdep"><span class="hs-identifier hs-var">MO_Pdep</span></a><span> </span><a name="local-6989586621680818547"><a href="#local-6989586621680818547"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680818548"><a href="#local-6989586621680818548"><span class="hs-identifier">dsts</span></a></a><span> </span><a name="local-6989586621680818549"><a href="#local-6989586621680818549"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-224"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallSimpleCast2"><span class="hs-identifier hs-var">genCallSimpleCast2</span></a><span> </span><a href="#local-6989586621680818547"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621680818546"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818548"><span class="hs-identifier hs-var">dsts</span></a><span> </span><a href="#local-6989586621680818549"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-225"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818550"><a href="#local-6989586621680818550"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Pext"><span class="hs-identifier hs-var">MO_Pext</span></a><span> </span><a name="local-6989586621680818551"><a href="#local-6989586621680818551"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680818552"><a href="#local-6989586621680818552"><span class="hs-identifier">dsts</span></a></a><span> </span><a name="local-6989586621680818553"><a href="#local-6989586621680818553"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-226"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallSimpleCast2"><span class="hs-identifier hs-var">genCallSimpleCast2</span></a><span> </span><a href="#local-6989586621680818551"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621680818550"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818552"><span class="hs-identifier hs-var">dsts</span></a><span> </span><a href="#local-6989586621680818553"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-227"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818554"><a href="#local-6989586621680818554"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Clz"><span class="hs-identifier hs-var">MO_Clz</span></a><span> </span><a name="local-6989586621680818555"><a href="#local-6989586621680818555"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680818556"><a href="#local-6989586621680818556"><span class="hs-identifier">dsts</span></a></a><span> </span><a name="local-6989586621680818557"><a href="#local-6989586621680818557"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-228"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallSimpleCast"><span class="hs-identifier hs-var">genCallSimpleCast</span></a><span> </span><a href="#local-6989586621680818555"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621680818554"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818556"><span class="hs-identifier hs-var">dsts</span></a><span> </span><a href="#local-6989586621680818557"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-229"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818558"><a href="#local-6989586621680818558"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Ctz"><span class="hs-identifier hs-var">MO_Ctz</span></a><span> </span><a name="local-6989586621680818559"><a href="#local-6989586621680818559"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680818560"><a href="#local-6989586621680818560"><span class="hs-identifier">dsts</span></a></a><span> </span><a name="local-6989586621680818561"><a href="#local-6989586621680818561"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-230"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallSimpleCast"><span class="hs-identifier hs-var">genCallSimpleCast</span></a><span> </span><a href="#local-6989586621680818559"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621680818558"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818560"><span class="hs-identifier hs-var">dsts</span></a><span> </span><a href="#local-6989586621680818561"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-231"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818562"><a href="#local-6989586621680818562"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_BSwap"><span class="hs-identifier hs-var">MO_BSwap</span></a><span> </span><a name="local-6989586621680818563"><a href="#local-6989586621680818563"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680818564"><a href="#local-6989586621680818564"><span class="hs-identifier">dsts</span></a></a><span> </span><a name="local-6989586621680818565"><a href="#local-6989586621680818565"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-232"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallSimpleCast"><span class="hs-identifier hs-var">genCallSimpleCast</span></a><span> </span><a href="#local-6989586621680818563"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621680818562"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818564"><span class="hs-identifier hs-var">dsts</span></a><span> </span><a href="#local-6989586621680818565"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-var">MO_AtomicRMW</span></a><span> </span><a name="local-6989586621680818566"><a href="#local-6989586621680818566"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621680818567"><a href="#local-6989586621680818567"><span class="hs-identifier">amop</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818568"><a href="#local-6989586621680818568"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818569"><a href="#local-6989586621680818569"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818570"><a href="#local-6989586621680818570"><span class="hs-identifier">n</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-235"></a><span>    </span><a name="local-6989586621680818571"><a href="#local-6989586621680818571"><span class="hs-identifier">addrVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818569"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-236"></a><span>    </span><a name="local-6989586621680818572"><a href="#local-6989586621680818572"><span class="hs-identifier">nVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818570"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-237"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818573"><a href="#local-6989586621680818573"><span class="hs-identifier">targetTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818566"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-238"></a><span>        </span><a name="local-6989586621680818574"><a href="#local-6989586621680818574"><span class="hs-identifier">ptrExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span> </span><a href="#local-6989586621680818571"><span class="hs-identifier hs-var">addrVar</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680818573"><span class="hs-identifier hs-var">targetTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>    </span><a name="local-6989586621680818575"><a href="#local-6989586621680818575"><span class="hs-identifier">ptrVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680818573"><span class="hs-identifier hs-var">targetTy</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818574"><span class="hs-identifier hs-var">ptrExpr</span></a><span>
</span><a name="line-240"></a><span>    </span><a name="local-6989586621680818576"><a href="#local-6989586621680818576"><span class="hs-identifier">dstVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegW"><span class="hs-identifier hs-var">getCmmRegW</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818568"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818577"><a href="#local-6989586621680818577"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818567"><span class="hs-identifier hs-var">amop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-242"></a><span>               </span><a href="CmmMachOp.html#AMO_Add"><span class="hs-identifier hs-var">AMO_Add</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.AbsSyn.html#LAO_Add"><span class="hs-identifier hs-var">LAO_Add</span></a><span>
</span><a name="line-243"></a><span>               </span><a href="CmmMachOp.html#AMO_Sub"><span class="hs-identifier hs-var">AMO_Sub</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.AbsSyn.html#LAO_Sub"><span class="hs-identifier hs-var">LAO_Sub</span></a><span>
</span><a name="line-244"></a><span>               </span><a href="CmmMachOp.html#AMO_And"><span class="hs-identifier hs-var">AMO_And</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.AbsSyn.html#LAO_And"><span class="hs-identifier hs-var">LAO_And</span></a><span>
</span><a name="line-245"></a><span>               </span><a href="CmmMachOp.html#AMO_Nand"><span class="hs-identifier hs-var">AMO_Nand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.AbsSyn.html#LAO_Nand"><span class="hs-identifier hs-var">LAO_Nand</span></a><span>
</span><a name="line-246"></a><span>               </span><a href="CmmMachOp.html#AMO_Or"><span class="hs-identifier hs-var">AMO_Or</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.AbsSyn.html#LAO_Or"><span class="hs-identifier hs-var">LAO_Or</span></a><span>
</span><a name="line-247"></a><span>               </span><a href="CmmMachOp.html#AMO_Xor"><span class="hs-identifier hs-var">AMO_Xor</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.AbsSyn.html#LAO_Xor"><span class="hs-identifier hs-var">LAO_Xor</span></a><span>
</span><a name="line-248"></a><span>    </span><a name="local-6989586621680818578"><a href="#local-6989586621680818578"><span class="hs-identifier">retVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818573"><span class="hs-identifier hs-var">targetTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#AtomicRMW"><span class="hs-identifier hs-var">AtomicRMW</span></a><span> </span><a href="#local-6989586621680818577"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680818575"><span class="hs-identifier hs-var">ptrVar</span></a><span> </span><a href="#local-6989586621680818572"><span class="hs-identifier hs-var">nVar</span></a><span> </span><a href="Llvm.AbsSyn.html#SyncSeqCst"><span class="hs-identifier hs-var">SyncSeqCst</span></a><span>
</span><a name="line-249"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818578"><span class="hs-identifier hs-var">retVar</span></a><span> </span><a href="#local-6989586621680818576"><span class="hs-identifier hs-var">dstVar</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicRead"><span class="hs-identifier hs-var">MO_AtomicRead</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818579"><a href="#local-6989586621680818579"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818580"><a href="#local-6989586621680818580"><span class="hs-identifier">addr</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-252"></a><span>    </span><a name="local-6989586621680818581"><a href="#local-6989586621680818581"><span class="hs-identifier">dstV</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegW"><span class="hs-identifier hs-var">getCmmRegW</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818579"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>    </span><a name="local-6989586621680818582"><a href="#local-6989586621680818582"><span class="hs-identifier">v1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoadW"><span class="hs-identifier hs-var">genLoadW</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621680818580"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#localRegType"><span class="hs-identifier hs-var">localRegType</span></a><span> </span><a href="#local-6989586621680818579"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818582"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621680818581"><span class="hs-identifier hs-var">dstV</span></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-var">MO_Cmpxchg</span></a><span> </span><a name="local-6989586621680818583"><a href="#local-6989586621680818583"><span class="hs-identifier">_width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>        </span><span class="hs-special">[</span><a name="local-6989586621680818584"><a href="#local-6989586621680818584"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818585"><a href="#local-6989586621680818585"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818586"><a href="#local-6989586621680818586"><span class="hs-identifier">old</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818587"><a href="#local-6989586621680818587"><span class="hs-identifier">new</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-258"></a><span>    </span><a name="local-6989586621680818588"><a href="#local-6989586621680818588"><span class="hs-identifier">addrVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818585"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621680818589"><a href="#local-6989586621680818589"><span class="hs-identifier">oldVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818586"><span class="hs-identifier hs-var">old</span></a><span>
</span><a name="line-260"></a><span>    </span><a name="local-6989586621680818590"><a href="#local-6989586621680818590"><span class="hs-identifier">newVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818587"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-261"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818591"><a href="#local-6989586621680818591"><span class="hs-identifier">targetTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818589"><span class="hs-identifier hs-var">oldVar</span></a><span>
</span><a name="line-262"></a><span>        </span><a name="local-6989586621680818592"><a href="#local-6989586621680818592"><span class="hs-identifier">ptrExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span> </span><a href="#local-6989586621680818588"><span class="hs-identifier hs-var">addrVar</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680818591"><span class="hs-identifier hs-var">targetTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>    </span><a name="local-6989586621680818593"><a href="#local-6989586621680818593"><span class="hs-identifier">ptrVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680818591"><span class="hs-identifier hs-var">targetTy</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818592"><span class="hs-identifier hs-var">ptrExpr</span></a><span>
</span><a name="line-264"></a><span>    </span><a name="local-6989586621680818594"><a href="#local-6989586621680818594"><span class="hs-identifier">dstVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegW"><span class="hs-identifier hs-var">getCmmRegW</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818584"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>    </span><a name="local-6989586621680818595"><a href="#local-6989586621680818595"><span class="hs-identifier">retVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMStructU"><span class="hs-identifier hs-var">LMStructU</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818591"><span class="hs-identifier hs-var">targetTy</span></a><span class="hs-special">,</span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span>              </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#CmpXChg"><span class="hs-identifier hs-var">CmpXChg</span></a><span> </span><a href="#local-6989586621680818593"><span class="hs-identifier hs-var">ptrVar</span></a><span> </span><a href="#local-6989586621680818589"><span class="hs-identifier hs-var">oldVar</span></a><span> </span><a href="#local-6989586621680818590"><span class="hs-identifier hs-var">newVar</span></a><span> </span><a href="Llvm.AbsSyn.html#SyncSeqCst"><span class="hs-identifier hs-var">SyncSeqCst</span></a><span> </span><a href="Llvm.AbsSyn.html#SyncSeqCst"><span class="hs-identifier hs-var">SyncSeqCst</span></a><span>
</span><a name="line-267"></a><span>    </span><a name="local-6989586621680818596"><a href="#local-6989586621680818596"><span class="hs-identifier">retVar'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818591"><span class="hs-identifier hs-var">targetTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#ExtractV"><span class="hs-identifier hs-var">ExtractV</span></a><span> </span><a href="#local-6989586621680818595"><span class="hs-identifier hs-var">retVar</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-268"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818596"><span class="hs-identifier hs-var">retVar'</span></a><span> </span><a href="#local-6989586621680818594"><span class="hs-identifier hs-var">dstVar</span></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-var">MO_AtomicWrite</span></a><span> </span><a name="local-6989586621680818597"><a href="#local-6989586621680818597"><span class="hs-identifier">_width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818598"><a href="#local-6989586621680818598"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818599"><a href="#local-6989586621680818599"><span class="hs-identifier">val</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-271"></a><span>    </span><a name="local-6989586621680818600"><a href="#local-6989586621680818600"><span class="hs-identifier">addrVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818598"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-272"></a><span>    </span><a name="local-6989586621680818601"><a href="#local-6989586621680818601"><span class="hs-identifier">valVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818599"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-273"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818602"><a href="#local-6989586621680818602"><span class="hs-identifier">ptrTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818601"><span class="hs-identifier hs-var">valVar</span></a><span>
</span><a name="line-274"></a><span>        </span><a name="local-6989586621680818603"><a href="#local-6989586621680818603"><span class="hs-identifier">ptrExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span> </span><a href="#local-6989586621680818600"><span class="hs-identifier hs-var">addrVar</span></a><span> </span><a href="#local-6989586621680818602"><span class="hs-identifier hs-var">ptrTy</span></a><span>
</span><a name="line-275"></a><span>    </span><a name="local-6989586621680818604"><a href="#local-6989586621680818604"><span class="hs-identifier">ptrVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818602"><span class="hs-identifier hs-var">ptrTy</span></a><span> </span><a href="#local-6989586621680818603"><span class="hs-identifier hs-var">ptrExpr</span></a><span>
</span><a name="line-276"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Expr"><span class="hs-identifier hs-var">Expr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#AtomicRMW"><span class="hs-identifier hs-var">AtomicRMW</span></a><span> </span><a href="Llvm.AbsSyn.html#LAO_Xchg"><span class="hs-identifier hs-var">LAO_Xchg</span></a><span> </span><a href="#local-6989586621680818604"><span class="hs-identifier hs-var">ptrVar</span></a><span> </span><a href="#local-6989586621680818601"><span class="hs-identifier hs-var">valVar</span></a><span> </span><a href="Llvm.AbsSyn.html#SyncSeqCst"><span class="hs-identifier hs-var">SyncSeqCst</span></a><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- Handle memcpy function specifically since llvm's intrinsic version takes</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- some extra parameters.</span><span>
</span><a name="line-280"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818605"><a href="#local-6989586621680818605"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621680818606"><a href="#local-6989586621680818606"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680818607"><a href="#local-6989586621680818607"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-281"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680818608"><a href="#local-6989586621680818608"><span class="hs-identifier">align</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmmMachOp.html#machOpMemcpyishAlign"><span class="hs-identifier hs-var">machOpMemcpyishAlign</span></a><span> </span><a href="#local-6989586621680818606"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-282"></a><span>    </span><a name="local-6989586621680818609"><a href="#local-6989586621680818609"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-283"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818610"><a href="#local-6989586621680818610"><span class="hs-identifier">isVolTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span class="hs-special">]</span><span>
</span><a name="line-284"></a><span>        </span><a name="local-6989586621680818611"><a href="#local-6989586621680818611"><span class="hs-identifier">isVolVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">]</span><span>
</span><a name="line-285"></a><span>        </span><a name="local-6989586621680818612"><a href="#local-6989586621680818612"><span class="hs-identifier">argTy</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="CmmMachOp.html#MO_Memset"><span class="hs-identifier hs-var">MO_Memset</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680818606"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Llvm.Types.html#i8Ptr"><span class="hs-identifier hs-var">i8Ptr</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#i8"><span class="hs-identifier hs-var">i8</span></a><span class="hs-special">,</span><span>    </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680818609"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818610"><span class="hs-identifier hs-var">isVolTy</span></a><span>
</span><a name="line-286"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Llvm.Types.html#i8Ptr"><span class="hs-identifier hs-var">i8Ptr</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#i8Ptr"><span class="hs-identifier hs-var">i8Ptr</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680818609"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818610"><span class="hs-identifier hs-var">isVolTy</span></a><span>
</span><a name="line-287"></a><span>        </span><a name="local-6989586621680818613"><a href="#local-6989586621680818613"><span class="hs-identifier">funTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680818614"><a href="#local-6989586621680818614"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LMFunction"><span class="hs-identifier hs-var">LMFunction</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LlvmFunctionDecl"><span class="hs-identifier hs-var">LlvmFunctionDecl</span></a><span> </span><a href="#local-6989586621680818614"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Llvm.Types.html#ExternallyVisible"><span class="hs-identifier hs-var">ExternallyVisible</span></a><span>
</span><a name="line-288"></a><span>                             </span><a href="Llvm.Types.html#CC_Ccc"><span class="hs-identifier hs-var">CC_Ccc</span></a><span> </span><a href="Llvm.Types.html#LMVoid"><span class="hs-identifier hs-var">LMVoid</span></a><span> </span><a href="Llvm.Types.html#FixedArgs"><span class="hs-identifier hs-var">FixedArgs</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#tysToParams"><span class="hs-identifier hs-var">tysToParams</span></a><span> </span><a href="#local-6989586621680818612"><span class="hs-identifier hs-var">argTy</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680818615"><a href="#local-6989586621680818615"><span class="hs-identifier">arg_hints</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#foreignTargetHints"><span class="hs-identifier hs-var">foreignTargetHints</span></a><span> </span><a href="#local-6989586621680818605"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-291"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818616"><a href="#local-6989586621680818616"><span class="hs-identifier">args_hints</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818607"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621680818615"><span class="hs-identifier hs-var">arg_hints</span></a><span>
</span><a name="line-292"></a><span>    </span><a name="local-6989586621680818617"><a href="#local-6989586621680818617"><span class="hs-identifier">argVars</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#arg_varsW"><span class="hs-identifier hs-var">arg_varsW</span></a><span> </span><a href="#local-6989586621680818616"><span class="hs-identifier hs-var">args_hints</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>    </span><a name="local-6989586621680818618"><a href="#local-6989586621680818618"><span class="hs-identifier">fptr</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getFunPtrW"><span class="hs-identifier hs-var">getFunPtrW</span></a><span> </span><a href="#local-6989586621680818613"><span class="hs-identifier hs-var">funTy</span></a><span> </span><a href="#local-6989586621680818605"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-294"></a><span>    </span><a name="local-6989586621680818619"><a href="#local-6989586621680818619"><span class="hs-identifier">argVars'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVarsW"><span class="hs-identifier hs-var">castVarsW</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818617"><span class="hs-identifier hs-var">argVars</span></a><span> </span><a href="#local-6989586621680818612"><span class="hs-identifier hs-var">argTy</span></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#doTrashStmts"><span class="hs-identifier hs-var">doTrashStmts</span></a><span>
</span><a name="line-297"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818620"><a href="#local-6989586621680818620"><span class="hs-identifier">alignVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span> </span><a href="#local-6989586621680818608"><span class="hs-identifier hs-var">align</span></a><span>
</span><a name="line-298"></a><span>        </span><a name="local-6989586621680818621"><a href="#local-6989586621680818621"><span class="hs-identifier">arguments</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818619"><span class="hs-identifier hs-var">argVars'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818620"><span class="hs-identifier hs-var">alignVal</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680818611"><span class="hs-identifier hs-var">isVolVal</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Expr"><span class="hs-identifier hs-var">Expr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="Llvm.Types.html#StdCall"><span class="hs-identifier hs-var">StdCall</span></a><span> </span><a href="#local-6989586621680818618"><span class="hs-identifier hs-var">fptr</span></a><span> </span><a href="#local-6989586621680818621"><span class="hs-identifier hs-var">arguments</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- We handle MO_U_Mul2 by simply using a 'mul' instruction, but with operands</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- twice the width (we first zero-extend them), e.g., on 64-bit arch we will</span><span>
</span><a name="line-303"></a><span class="hs-comment">-- generate 'mul' on 128-bit operands. Then we only need some plumbing to</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- extract the two 64-bit values out of 128-bit result.</span><span>
</span><a name="line-305"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_Mul2"><span class="hs-identifier hs-var">MO_U_Mul2</span></a><span> </span><a name="local-6989586621680818622"><a href="#local-6989586621680818622"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818623"><a href="#local-6989586621680818623"><span class="hs-identifier">dstH</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818624"><a href="#local-6989586621680818624"><span class="hs-identifier">dstL</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818625"><a href="#local-6989586621680818625"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818626"><a href="#local-6989586621680818626"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-306"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818627"><a href="#local-6989586621680818627"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818622"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-307"></a><span>        </span><a name="local-6989586621680818628"><a href="#local-6989586621680818628"><span class="hs-identifier">bitWidth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621680818622"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-308"></a><span>        </span><a name="local-6989586621680818629"><a href="#local-6989586621680818629"><span class="hs-identifier">width2x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMInt"><span class="hs-identifier hs-var">LMInt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818628"><span class="hs-identifier hs-var">bitWidth</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-309"></a><span>    </span><span class="hs-comment">-- First zero-extend the operands ('mul' instruction requires the operands</span><span>
</span><a name="line-310"></a><span>    </span><span class="hs-comment">-- and the result to be of the same type). Note that we don't use 'castVars'</span><span>
</span><a name="line-311"></a><span>    </span><span class="hs-comment">-- because it tries to do LM_Sext.</span><span>
</span><a name="line-312"></a><span>    </span><a name="local-6989586621680818630"><a href="#local-6989586621680818630"><span class="hs-identifier">lhsVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818625"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-313"></a><span>    </span><a name="local-6989586621680818631"><a href="#local-6989586621680818631"><span class="hs-identifier">rhsVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818626"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-314"></a><span>    </span><a name="local-6989586621680818632"><a href="#local-6989586621680818632"><span class="hs-identifier">lhsExt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818629"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Zext"><span class="hs-identifier hs-var">LM_Zext</span></a><span> </span><a href="#local-6989586621680818630"><span class="hs-identifier hs-var">lhsVar</span></a><span> </span><a href="#local-6989586621680818629"><span class="hs-identifier hs-var">width2x</span></a><span>
</span><a name="line-315"></a><span>    </span><a name="local-6989586621680818633"><a href="#local-6989586621680818633"><span class="hs-identifier">rhsExt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818629"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Zext"><span class="hs-identifier hs-var">LM_Zext</span></a><span> </span><a href="#local-6989586621680818631"><span class="hs-identifier hs-var">rhsVar</span></a><span> </span><a href="#local-6989586621680818629"><span class="hs-identifier hs-var">width2x</span></a><span>
</span><a name="line-316"></a><span>    </span><span class="hs-comment">-- Do the actual multiplication (note that the result is also 2x width).</span><span>
</span><a name="line-317"></a><span>    </span><a name="local-6989586621680818634"><a href="#local-6989586621680818634"><span class="hs-identifier">retV</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818629"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Mul"><span class="hs-identifier hs-var">LM_MO_Mul</span></a><span> </span><a href="#local-6989586621680818632"><span class="hs-identifier hs-var">lhsExt</span></a><span> </span><a href="#local-6989586621680818633"><span class="hs-identifier hs-var">rhsExt</span></a><span>
</span><a name="line-318"></a><span>    </span><span class="hs-comment">-- Extract the lower bits of the result into retL.</span><span>
</span><a name="line-319"></a><span>    </span><a name="local-6989586621680818635"><a href="#local-6989586621680818635"><span class="hs-identifier">retL</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818627"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="#local-6989586621680818634"><span class="hs-identifier hs-var">retV</span></a><span> </span><a href="#local-6989586621680818627"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-320"></a><span>    </span><span class="hs-comment">-- Now we right-shift the higher bits by width.</span><span>
</span><a name="line-321"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818636"><a href="#local-6989586621680818636"><span class="hs-identifier">widthLlvmLit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMIntLit"><span class="hs-identifier hs-var">LMIntLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680818628"><span class="hs-identifier hs-var">bitWidth</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818627"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-322"></a><span>    </span><a name="local-6989586621680818637"><a href="#local-6989586621680818637"><span class="hs-identifier">retShifted</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818629"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_LShr"><span class="hs-identifier hs-var">LM_MO_LShr</span></a><span> </span><a href="#local-6989586621680818634"><span class="hs-identifier hs-var">retV</span></a><span> </span><a href="#local-6989586621680818636"><span class="hs-identifier hs-var">widthLlvmLit</span></a><span>
</span><a name="line-323"></a><span>    </span><span class="hs-comment">-- And extract them into retH.</span><span>
</span><a name="line-324"></a><span>    </span><a name="local-6989586621680818638"><a href="#local-6989586621680818638"><span class="hs-identifier">retH</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818627"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="#local-6989586621680818637"><span class="hs-identifier hs-var">retShifted</span></a><span> </span><a href="#local-6989586621680818627"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-325"></a><span>    </span><a name="local-6989586621680818639"><a href="#local-6989586621680818639"><span class="hs-identifier">dstRegL</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegW"><span class="hs-identifier hs-var">getCmmRegW</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818624"><span class="hs-identifier hs-var">dstL</span></a><span class="hs-special">)</span><span>
</span><a name="line-326"></a><span>    </span><a name="local-6989586621680818640"><a href="#local-6989586621680818640"><span class="hs-identifier">dstRegH</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegW"><span class="hs-identifier hs-var">getCmmRegW</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818623"><span class="hs-identifier hs-var">dstH</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818635"><span class="hs-identifier hs-var">retL</span></a><span> </span><a href="#local-6989586621680818639"><span class="hs-identifier hs-var">dstRegL</span></a><span>
</span><a name="line-328"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818638"><span class="hs-identifier hs-var">retH</span></a><span> </span><a href="#local-6989586621680818640"><span class="hs-identifier hs-var">dstRegH</span></a><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span class="hs-comment">-- MO_U_QuotRem2 is another case we handle by widening the registers to double</span><span>
</span><a name="line-331"></a><span class="hs-comment">-- the width and use normal LLVM instructions (similarly to the MO_U_Mul2). The</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- main difference here is that we need to combine two words into one register</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- and then use both 'udiv' and 'urem' instructions to compute the result.</span><span>
</span><a name="line-334"></a><span class="hs-identifier">genCall</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_QuotRem2"><span class="hs-identifier hs-var">MO_U_QuotRem2</span></a><span> </span><a name="local-6989586621680818641"><a href="#local-6989586621680818641"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-335"></a><span>        </span><span class="hs-special">[</span><a name="local-6989586621680818642"><a href="#local-6989586621680818642"><span class="hs-identifier">dstQ</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818643"><a href="#local-6989586621680818643"><span class="hs-identifier">dstR</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818644"><a href="#local-6989586621680818644"><span class="hs-identifier">lhsH</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818645"><a href="#local-6989586621680818645"><span class="hs-identifier">lhsL</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818646"><a href="#local-6989586621680818646"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-336"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818647"><a href="#local-6989586621680818647"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818641"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-337"></a><span>        </span><a name="local-6989586621680818648"><a href="#local-6989586621680818648"><span class="hs-identifier">bitWidth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621680818641"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-338"></a><span>        </span><a name="local-6989586621680818649"><a href="#local-6989586621680818649"><span class="hs-identifier">width2x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMInt"><span class="hs-identifier hs-var">LMInt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818648"><span class="hs-identifier hs-var">bitWidth</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>    </span><span class="hs-comment">-- First zero-extend all parameters to double width.</span><span>
</span><a name="line-340"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818650"><a href="#local-6989586621680818650"><span class="hs-identifier">zeroExtend</span></a></a><span> </span><a name="local-6989586621680818651"><a href="#local-6989586621680818651"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-341"></a><span>            </span><a name="local-6989586621680818652"><a href="#local-6989586621680818652"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680818651"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-342"></a><span>            </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818649"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Zext"><span class="hs-identifier hs-var">LM_Zext</span></a><span> </span><a href="#local-6989586621680818652"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621680818649"><span class="hs-identifier hs-var">width2x</span></a><span>
</span><a name="line-343"></a><span>    </span><a name="local-6989586621680818653"><a href="#local-6989586621680818653"><span class="hs-identifier">lhsExtH</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680818650"><span class="hs-identifier hs-var">zeroExtend</span></a><span> </span><a href="#local-6989586621680818644"><span class="hs-identifier hs-var">lhsH</span></a><span>
</span><a name="line-344"></a><span>    </span><a name="local-6989586621680818654"><a href="#local-6989586621680818654"><span class="hs-identifier">lhsExtL</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680818650"><span class="hs-identifier hs-var">zeroExtend</span></a><span> </span><a href="#local-6989586621680818645"><span class="hs-identifier hs-var">lhsL</span></a><span>
</span><a name="line-345"></a><span>    </span><a name="local-6989586621680818655"><a href="#local-6989586621680818655"><span class="hs-identifier">rhsExt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680818650"><span class="hs-identifier hs-var">zeroExtend</span></a><span> </span><a href="#local-6989586621680818646"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-346"></a><span>    </span><span class="hs-comment">-- Now we combine the first two parameters (that represent the high and low</span><span>
</span><a name="line-347"></a><span>    </span><span class="hs-comment">-- bits of the value). So first left-shift the high bits to their position</span><span>
</span><a name="line-348"></a><span>    </span><span class="hs-comment">-- and then bit-or them with the low bits.</span><span>
</span><a name="line-349"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818656"><a href="#local-6989586621680818656"><span class="hs-identifier">widthLlvmLit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMIntLit"><span class="hs-identifier hs-var">LMIntLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680818648"><span class="hs-identifier hs-var">bitWidth</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818647"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-350"></a><span>    </span><a name="local-6989586621680818657"><a href="#local-6989586621680818657"><span class="hs-identifier">lhsExtHShifted</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818649"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Shl"><span class="hs-identifier hs-var">LM_MO_Shl</span></a><span> </span><a href="#local-6989586621680818653"><span class="hs-identifier hs-var">lhsExtH</span></a><span> </span><a href="#local-6989586621680818656"><span class="hs-identifier hs-var">widthLlvmLit</span></a><span>
</span><a name="line-351"></a><span>    </span><a name="local-6989586621680818658"><a href="#local-6989586621680818658"><span class="hs-identifier">lhsExt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818649"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Or"><span class="hs-identifier hs-var">LM_MO_Or</span></a><span> </span><a href="#local-6989586621680818657"><span class="hs-identifier hs-var">lhsExtHShifted</span></a><span> </span><a href="#local-6989586621680818654"><span class="hs-identifier hs-var">lhsExtL</span></a><span>
</span><a name="line-352"></a><span>    </span><span class="hs-comment">-- Finally, we can call 'udiv' and 'urem' to compute the results.</span><span>
</span><a name="line-353"></a><span>    </span><a name="local-6989586621680818659"><a href="#local-6989586621680818659"><span class="hs-identifier">retExtDiv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818649"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_UDiv"><span class="hs-identifier hs-var">LM_MO_UDiv</span></a><span> </span><a href="#local-6989586621680818658"><span class="hs-identifier hs-var">lhsExt</span></a><span> </span><a href="#local-6989586621680818655"><span class="hs-identifier hs-var">rhsExt</span></a><span>
</span><a name="line-354"></a><span>    </span><a name="local-6989586621680818660"><a href="#local-6989586621680818660"><span class="hs-identifier">retExtRem</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818649"><span class="hs-identifier hs-var">width2x</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_URem"><span class="hs-identifier hs-var">LM_MO_URem</span></a><span> </span><a href="#local-6989586621680818658"><span class="hs-identifier hs-var">lhsExt</span></a><span> </span><a href="#local-6989586621680818655"><span class="hs-identifier hs-var">rhsExt</span></a><span>
</span><a name="line-355"></a><span>    </span><span class="hs-comment">-- And since everything is in 2x width, we need to truncate the results and</span><span>
</span><a name="line-356"></a><span>    </span><span class="hs-comment">-- then return them.</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818661"><a href="#local-6989586621680818661"><span class="hs-identifier">narrow</span></a></a><span> </span><a name="local-6989586621680818662"><a href="#local-6989586621680818662"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818647"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="#local-6989586621680818662"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621680818647"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-358"></a><span>    </span><a name="local-6989586621680818663"><a href="#local-6989586621680818663"><span class="hs-identifier">retDiv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680818661"><span class="hs-identifier hs-var">narrow</span></a><span> </span><a href="#local-6989586621680818659"><span class="hs-identifier hs-var">retExtDiv</span></a><span>
</span><a name="line-359"></a><span>    </span><a name="local-6989586621680818664"><a href="#local-6989586621680818664"><span class="hs-identifier">retRem</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680818661"><span class="hs-identifier hs-var">narrow</span></a><span> </span><a href="#local-6989586621680818660"><span class="hs-identifier hs-var">retExtRem</span></a><span>
</span><a name="line-360"></a><span>    </span><a name="local-6989586621680818665"><a href="#local-6989586621680818665"><span class="hs-identifier">dstRegQ</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818642"><span class="hs-identifier hs-var">dstQ</span></a><span class="hs-special">)</span><span>
</span><a name="line-361"></a><span>    </span><a name="local-6989586621680818666"><a href="#local-6989586621680818666"><span class="hs-identifier">dstRegR</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818643"><span class="hs-identifier hs-var">dstR</span></a><span class="hs-special">)</span><span>
</span><a name="line-362"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818663"><span class="hs-identifier hs-var">retDiv</span></a><span> </span><a href="#local-6989586621680818665"><span class="hs-identifier hs-var">dstRegQ</span></a><span>
</span><a name="line-363"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818664"><span class="hs-identifier hs-var">retRem</span></a><span> </span><a href="#local-6989586621680818666"><span class="hs-identifier hs-var">dstRegR</span></a><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-comment">-- Handle the MO_{Add,Sub}IntC separately. LLVM versions return a record from</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- which we need to extract the actual values.</span><span>
</span><a name="line-367"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818667"><a href="#local-6989586621680818667"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AddIntC"><span class="hs-identifier hs-var">MO_AddIntC</span></a><span> </span><a name="local-6989586621680818668"><a href="#local-6989586621680818668"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818669"><a href="#local-6989586621680818669"><span class="hs-identifier">dstV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818670"><a href="#local-6989586621680818670"><span class="hs-identifier">dstO</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818671"><a href="#local-6989586621680818671"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818672"><a href="#local-6989586621680818672"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-368"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallWithOverflow"><span class="hs-identifier hs-var">genCallWithOverflow</span></a><span> </span><a href="#local-6989586621680818667"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818668"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818669"><span class="hs-identifier hs-var">dstV</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818670"><span class="hs-identifier hs-var">dstO</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818671"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818672"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">]</span><span>
</span><a name="line-369"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818673"><a href="#local-6989586621680818673"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SubIntC"><span class="hs-identifier hs-var">MO_SubIntC</span></a><span> </span><a name="local-6989586621680818674"><a href="#local-6989586621680818674"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818675"><a href="#local-6989586621680818675"><span class="hs-identifier">dstV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818676"><a href="#local-6989586621680818676"><span class="hs-identifier">dstO</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818677"><a href="#local-6989586621680818677"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818678"><a href="#local-6989586621680818678"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-370"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallWithOverflow"><span class="hs-identifier hs-var">genCallWithOverflow</span></a><span> </span><a href="#local-6989586621680818673"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818674"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818675"><span class="hs-identifier hs-var">dstV</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818676"><span class="hs-identifier hs-var">dstO</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818677"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818678"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">]</span><span>
</span><a name="line-371"></a><span>
</span><a name="line-372"></a><span class="hs-comment">-- Similar to MO_{Add,Sub}IntC, but MO_Add2 expects the first element of the</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- return tuple to be the overflow bit and the second element to contain the</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- actual result of the addition. So we still use genCallWithOverflow but swap</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- the return registers.</span><span>
</span><a name="line-376"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818679"><a href="#local-6989586621680818679"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add2"><span class="hs-identifier hs-var">MO_Add2</span></a><span> </span><a name="local-6989586621680818680"><a href="#local-6989586621680818680"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818681"><a href="#local-6989586621680818681"><span class="hs-identifier">dstO</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818682"><a href="#local-6989586621680818682"><span class="hs-identifier">dstV</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818683"><a href="#local-6989586621680818683"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818684"><a href="#local-6989586621680818684"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-377"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallWithOverflow"><span class="hs-identifier hs-var">genCallWithOverflow</span></a><span> </span><a href="#local-6989586621680818679"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818680"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818682"><span class="hs-identifier hs-var">dstV</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818681"><span class="hs-identifier hs-var">dstO</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818683"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818684"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">]</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818685"><a href="#local-6989586621680818685"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AddWordC"><span class="hs-identifier hs-var">MO_AddWordC</span></a><span> </span><a name="local-6989586621680818686"><a href="#local-6989586621680818686"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818687"><a href="#local-6989586621680818687"><span class="hs-identifier">dstV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818688"><a href="#local-6989586621680818688"><span class="hs-identifier">dstO</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818689"><a href="#local-6989586621680818689"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818690"><a href="#local-6989586621680818690"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-380"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallWithOverflow"><span class="hs-identifier hs-var">genCallWithOverflow</span></a><span> </span><a href="#local-6989586621680818685"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818686"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818687"><span class="hs-identifier hs-var">dstV</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818688"><span class="hs-identifier hs-var">dstO</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818689"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818690"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">]</span><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818691"><a href="#local-6989586621680818691"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SubWordC"><span class="hs-identifier hs-var">MO_SubWordC</span></a><span> </span><a name="local-6989586621680818692"><a href="#local-6989586621680818692"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818693"><a href="#local-6989586621680818693"><span class="hs-identifier">dstV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818694"><a href="#local-6989586621680818694"><span class="hs-identifier">dstO</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818695"><a href="#local-6989586621680818695"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818696"><a href="#local-6989586621680818696"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-383"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#genCallWithOverflow"><span class="hs-identifier hs-var">genCallWithOverflow</span></a><span> </span><a href="#local-6989586621680818691"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818692"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818693"><span class="hs-identifier hs-var">dstV</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818694"><span class="hs-identifier hs-var">dstO</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818695"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818696"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">]</span><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span class="hs-comment">-- Handle all other foreign calls and prim ops.</span><span>
</span><a name="line-386"></a><span class="hs-identifier">genCall</span><span> </span><a name="local-6989586621680818697"><a href="#local-6989586621680818697"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621680818698"><a href="#local-6989586621680818698"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-6989586621680818699"><a href="#local-6989586621680818699"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier hs-var">runStmtsDecls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-387"></a><span>    </span><a name="local-6989586621680818700"><a href="#local-6989586621680818700"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span>    </span><span class="hs-comment">-- parameter types</span><span>
</span><a name="line-390"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818701"><a href="#local-6989586621680818701"><span class="hs-identifier">arg_type</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">AddrHint</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#i8Ptr"><span class="hs-identifier hs-var">i8Ptr</span></a><span>
</span><a name="line-391"></a><span>        </span><span class="hs-comment">-- cast pointers to i8*. Llvm equivalent of void*</span><span>
</span><a name="line-392"></a><span>        </span><span class="hs-identifier">arg_type</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818702"><a href="#local-6989586621680818702"><span class="hs-identifier">expr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621680818700"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680818702"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span>    </span><span class="hs-comment">-- ret type</span><span>
</span><a name="line-395"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818703"><a href="#local-6989586621680818703"><span class="hs-identifier">ret_type</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMVoid"><span class="hs-identifier hs-var">LMVoid</span></a><span>
</span><a name="line-396"></a><span>        </span><span class="hs-identifier">ret_type</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">AddrHint</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#i8Ptr"><span class="hs-identifier hs-var">i8Ptr</span></a><span>
</span><a name="line-397"></a><span>        </span><span class="hs-identifier">ret_type</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-6989586621680818704"><a href="#local-6989586621680818704"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#localRegType"><span class="hs-identifier hs-var">localRegType</span></a><span> </span><a href="#local-6989586621680818704"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-398"></a><span>        </span><span class="hs-identifier">ret_type</span><span> </span><a name="local-6989586621680818705"><a href="#local-6989586621680818705"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCall: Too many return values! Can only handle&quot;</span><span>
</span><a name="line-399"></a><span>                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; 0 or 1, given &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680818705"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-400"></a><span>
</span><a name="line-401"></a><span>    </span><span class="hs-comment">-- extract Cmm call convention, and translate to LLVM call convention</span><span>
</span><a name="line-402"></a><span>    </span><a name="local-6989586621680818706"><a href="#local-6989586621680818706"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#getLlvmPlatform"><span class="hs-identifier hs-var">getLlvmPlatform</span></a><span>
</span><a name="line-403"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818707"><a href="#local-6989586621680818707"><span class="hs-identifier">lmconv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818697"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-404"></a><span>            </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><a name="local-6989586621680818708"><a href="#local-6989586621680818708"><span class="hs-identifier">conv</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-405"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818708"><span class="hs-identifier hs-var">conv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-406"></a><span>                 </span><span class="hs-identifier hs-var">StdCallConv</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-6989586621680818706"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-407"></a><span>                                 </span><span class="hs-identifier hs-var">ArchX86</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#CC_X86_Stdcc"><span class="hs-identifier hs-var">CC_X86_Stdcc</span></a><span>
</span><a name="line-408"></a><span>                                 </span><span class="hs-identifier hs-var">ArchX86_64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#CC_X86_Stdcc"><span class="hs-identifier hs-var">CC_X86_Stdcc</span></a><span>
</span><a name="line-409"></a><span>                                 </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#CC_Ccc"><span class="hs-identifier hs-var">CC_Ccc</span></a><span>
</span><a name="line-410"></a><span>                 </span><span class="hs-identifier hs-var">CCallConv</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#CC_Ccc"><span class="hs-identifier hs-var">CC_Ccc</span></a><span>
</span><a name="line-411"></a><span>                 </span><span class="hs-identifier hs-var">CApiConv</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#CC_Ccc"><span class="hs-identifier hs-var">CC_Ccc</span></a><span>
</span><a name="line-412"></a><span>                 </span><span class="hs-identifier hs-var">PrimCallConv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;LlvmCodeGen.CodeGen.genCall: PrimCallConv&quot;</span><span>
</span><a name="line-413"></a><span>                 </span><span class="hs-identifier hs-var">JavaScriptCallConv</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;LlvmCodeGen.CodeGen.genCall: JavaScriptCallConv&quot;</span><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span>            </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#CC_Ccc"><span class="hs-identifier hs-var">CC_Ccc</span></a><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span>    </span><span class="hs-comment">{-
        CC_Ccc of the possibilities here are a worry with the use of a custom
        calling convention for passing STG args. In practice the more
        dangerous combinations (e.g StdCall + llvmGhcCC) don't occur.

        The native code generator only handles StdCall and CCallConv.
    -}</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span>    </span><span class="hs-comment">-- call attributes</span><span>
</span><a name="line-426"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818709"><a href="#local-6989586621680818709"><span class="hs-identifier">fnAttrs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680818710"><span class="hs-identifier hs-var">never_returns</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#NoReturn"><span class="hs-identifier hs-var">NoReturn</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="LlvmCodeGen.Base.html#llvmStdFunAttrs"><span class="hs-identifier hs-var">llvmStdFunAttrs</span></a><span>
</span><a name="line-427"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#llvmStdFunAttrs"><span class="hs-identifier hs-var">llvmStdFunAttrs</span></a><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><span>        </span><a name="local-6989586621680818710"><a href="#local-6989586621680818710"><span class="hs-identifier">never_returns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818697"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-430"></a><span>             </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="CmmNode.html#CmmNeverReturns"><span class="hs-identifier hs-var">CmmNeverReturns</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-431"></a><span>             </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span>    </span><span class="hs-comment">-- fun type</span><span>
</span><a name="line-434"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818711"><a href="#local-6989586621680818711"><span class="hs-identifier">res_hints</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818712"><a href="#local-6989586621680818712"><span class="hs-identifier">arg_hints</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#foreignTargetHints"><span class="hs-identifier hs-var">foreignTargetHints</span></a><span> </span><a href="#local-6989586621680818697"><span class="hs-identifier hs-var">target</span></a><span>
</span><a name="line-435"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818713"><a href="#local-6989586621680818713"><span class="hs-identifier">args_hints</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818699"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621680818712"><span class="hs-identifier hs-var">arg_hints</span></a><span>
</span><a name="line-436"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818714"><a href="#local-6989586621680818714"><span class="hs-identifier">ress_hints</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818698"><span class="hs-identifier hs-var">res</span></a><span>  </span><a href="#local-6989586621680818711"><span class="hs-identifier hs-var">res_hints</span></a><span>
</span><a name="line-437"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818715"><a href="#local-6989586621680818715"><span class="hs-identifier">ccTy</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#StdCall"><span class="hs-identifier hs-var">StdCall</span></a><span> </span><span class="hs-comment">-- tail calls should be done through CmmJump</span><span>
</span><a name="line-438"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818716"><a href="#local-6989586621680818716"><span class="hs-identifier">retTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818703"><span class="hs-identifier hs-var">ret_type</span></a><span> </span><a href="#local-6989586621680818714"><span class="hs-identifier hs-var">ress_hints</span></a><span>
</span><a name="line-439"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818717"><a href="#local-6989586621680818717"><span class="hs-identifier">argTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#tysToParams"><span class="hs-identifier hs-var">tysToParams</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621680818701"><span class="hs-identifier hs-var">arg_type</span></a><span> </span><a href="#local-6989586621680818713"><span class="hs-identifier hs-var">args_hints</span></a><span>
</span><a name="line-440"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818718"><a href="#local-6989586621680818718"><span class="hs-identifier">funTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680818719"><a href="#local-6989586621680818719"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LMFunction"><span class="hs-identifier hs-var">LMFunction</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LlvmFunctionDecl"><span class="hs-identifier hs-var">LlvmFunctionDecl</span></a><span> </span><a href="#local-6989586621680818719"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Llvm.Types.html#ExternallyVisible"><span class="hs-identifier hs-var">ExternallyVisible</span></a><span>
</span><a name="line-441"></a><span>                             </span><a href="#local-6989586621680818707"><span class="hs-identifier hs-var">lmconv</span></a><span> </span><a href="#local-6989586621680818716"><span class="hs-identifier hs-var">retTy</span></a><span> </span><a href="Llvm.Types.html#FixedArgs"><span class="hs-identifier hs-var">FixedArgs</span></a><span> </span><a href="#local-6989586621680818717"><span class="hs-identifier hs-var">argTy</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#llvmFunAlign"><span class="hs-identifier hs-var">llvmFunAlign</span></a><span> </span><a href="#local-6989586621680818700"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span>    </span><a name="local-6989586621680818720"><a href="#local-6989586621680818720"><span class="hs-identifier">argVars</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#arg_varsW"><span class="hs-identifier hs-var">arg_varsW</span></a><span> </span><a href="#local-6989586621680818713"><span class="hs-identifier hs-var">args_hints</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-445"></a><span>    </span><a name="local-6989586621680818721"><a href="#local-6989586621680818721"><span class="hs-identifier">fptr</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getFunPtrW"><span class="hs-identifier hs-var">getFunPtrW</span></a><span> </span><a href="#local-6989586621680818718"><span class="hs-identifier hs-var">funTy</span></a><span> </span><a href="#local-6989586621680818697"><span class="hs-identifier hs-var">target</span></a><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818722"><a href="#local-6989586621680818722"><span class="hs-identifier">doReturn</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680818715"><span class="hs-identifier hs-var">ccTy</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#TailCall"><span class="hs-identifier hs-var">TailCall</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Return"><span class="hs-identifier hs-var">Return</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-448"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680818710"><span class="hs-identifier hs-var">never_returns</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Unreachable"><span class="hs-identifier hs-var">Unreachable</span></a><span>
</span><a name="line-449"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#doTrashStmts"><span class="hs-identifier hs-var">doTrashStmts</span></a><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span>    </span><span class="hs-comment">-- make the actual call</span><span>
</span><a name="line-454"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818716"><span class="hs-identifier hs-var">retTy</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-455"></a><span>        </span><a href="Llvm.Types.html#LMVoid"><span class="hs-identifier hs-var">LMVoid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-456"></a><span>            </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Expr"><span class="hs-identifier hs-var">Expr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="#local-6989586621680818715"><span class="hs-identifier hs-var">ccTy</span></a><span> </span><a href="#local-6989586621680818721"><span class="hs-identifier hs-var">fptr</span></a><span> </span><a href="#local-6989586621680818720"><span class="hs-identifier hs-var">argVars</span></a><span> </span><a href="#local-6989586621680818709"><span class="hs-identifier hs-var">fnAttrs</span></a><span>
</span><a name="line-457"></a><span>
</span><a name="line-458"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-459"></a><span>            </span><a name="local-6989586621680818723"><a href="#local-6989586621680818723"><span class="hs-identifier">v1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818716"><span class="hs-identifier hs-var">retTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="#local-6989586621680818715"><span class="hs-identifier hs-var">ccTy</span></a><span> </span><a href="#local-6989586621680818721"><span class="hs-identifier hs-var">fptr</span></a><span> </span><a href="#local-6989586621680818720"><span class="hs-identifier hs-var">argVars</span></a><span> </span><a href="#local-6989586621680818709"><span class="hs-identifier hs-var">fnAttrs</span></a><span>
</span><a name="line-460"></a><span>            </span><span class="hs-comment">-- get the return register</span><span>
</span><a name="line-461"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818724"><a href="#local-6989586621680818724"><span class="hs-identifier">ret_reg</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621680818725"><a href="#local-6989586621680818725"><span class="hs-identifier">reg</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818725"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-462"></a><span>                </span><span class="hs-identifier">ret_reg</span><span> </span><a name="local-6989586621680818726"><a href="#local-6989586621680818726"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCall: Bad number of registers! Can only handle&quot;</span><span>
</span><a name="line-463"></a><span>                                </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; 1, given &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680818726"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-464"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818727"><a href="#local-6989586621680818727"><span class="hs-identifier">creg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818724"><span class="hs-identifier hs-var">ret_reg</span></a><span> </span><a href="#local-6989586621680818698"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-465"></a><span>            </span><a name="local-6989586621680818728"><a href="#local-6989586621680818728"><span class="hs-identifier">vreg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegW"><span class="hs-identifier hs-var">getCmmRegW</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818727"><span class="hs-identifier hs-var">creg</span></a><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680818716"><span class="hs-identifier hs-var">retTy</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818728"><span class="hs-identifier hs-var">vreg</span></a><span class="hs-special">)</span><span>
</span><a name="line-467"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-468"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818723"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621680818728"><span class="hs-identifier hs-var">vreg</span></a><span>
</span><a name="line-469"></a><span>                    </span><a href="#local-6989586621680818722"><span class="hs-identifier hs-var">doReturn</span></a><span>
</span><a name="line-470"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-471"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818729"><a href="#local-6989586621680818729"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818728"><span class="hs-identifier hs-var">vreg</span></a><span>
</span><a name="line-472"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818730"><a href="#local-6989586621680818730"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818729"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-473"></a><span>                            </span><a name="local-6989586621680818731"><a href="#local-6989586621680818731"><span class="hs-identifier">vt</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818731"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span>
</span><a name="line-474"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span>     </span><a href="#local-6989586621680818731"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Ptrtoint"><span class="hs-identifier hs-var">LM_Ptrtoint</span></a><span>
</span><a name="line-475"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-476"></a><span>                                   </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCall: CmmReg bad match for&quot;</span><span>
</span><a name="line-477"></a><span>                                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; returned type!&quot;</span><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span>                    </span><a name="local-6989586621680818732"><a href="#local-6989586621680818732"><span class="hs-identifier">v2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680818729"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="#local-6989586621680818730"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680818723"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621680818729"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-480"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818732"><span class="hs-identifier hs-var">v2</span></a><span> </span><a href="#local-6989586621680818728"><span class="hs-identifier hs-var">vreg</span></a><span>
</span><a name="line-481"></a><span>                    </span><a href="#local-6989586621680818722"><span class="hs-identifier hs-var">doReturn</span></a><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span class="hs-comment">-- | Generate a call to an LLVM intrinsic that performs arithmetic operation</span><span>
</span><a name="line-484"></a><span class="hs-comment">-- with overflow bit (i.e., returns a struct containing the actual result of the</span><span>
</span><a name="line-485"></a><span class="hs-comment">-- operation and an overflow bit). This function will also extract the overflow</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- bit and zero-extend it (all the corresponding Cmm PrimOps represent the</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- overflow &quot;bit&quot; as a usual Int# or Word#).</span><span>
</span><a name="line-488"></a><span class="hs-identifier">genCallWithOverflow</span><span>
</span><a name="line-489"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-490"></a><a name="genCallWithOverflow"><a href="LlvmCodeGen.CodeGen.html#genCallWithOverflow"><span class="hs-identifier">genCallWithOverflow</span></a></a><span> </span><a name="local-6989586621680818733"><a href="#local-6989586621680818733"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621680818734"><a href="#local-6989586621680818734"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680818735"><a href="#local-6989586621680818735"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621680818736"><a href="#local-6989586621680818736"><span class="hs-identifier">dstV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818737"><a href="#local-6989586621680818737"><span class="hs-identifier">dstO</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818738"><a href="#local-6989586621680818738"><span class="hs-identifier">lhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818739"><a href="#local-6989586621680818739"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-491"></a><span>    </span><span class="hs-comment">-- So far this was only tested for the following four CallishMachOps.</span><span>
</span><a name="line-492"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818740"><a href="#local-6989586621680818740"><span class="hs-identifier">valid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818734"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span>   </span><span class="hs-special">[</span><span> </span><a href="CmmMachOp.html#MO_Add2"><span class="hs-identifier hs-var">MO_Add2</span></a><span> </span><a href="#local-6989586621680818735"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-493"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="CmmMachOp.html#MO_AddIntC"><span class="hs-identifier hs-var">MO_AddIntC</span></a><span> </span><a href="#local-6989586621680818735"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-494"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="CmmMachOp.html#MO_SubIntC"><span class="hs-identifier hs-var">MO_SubIntC</span></a><span> </span><a href="#local-6989586621680818735"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-495"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="CmmMachOp.html#MO_AddWordC"><span class="hs-identifier hs-var">MO_AddWordC</span></a><span> </span><a href="#local-6989586621680818735"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-496"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="CmmMachOp.html#MO_SubWordC"><span class="hs-identifier hs-var">MO_SubWordC</span></a><span> </span><a href="#local-6989586621680818735"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-497"></a><span>                            </span><span class="hs-special">]</span><span>
</span><a name="line-498"></a><span>    </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span class="hs-identifier">valid</span><span class="hs-special">)</span><span>
</span><a name="line-499"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818741"><a href="#local-6989586621680818741"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818735"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-500"></a><span>    </span><span class="hs-comment">-- This will do most of the work of generating the call to the intrinsic and</span><span>
</span><a name="line-501"></a><span>    </span><span class="hs-comment">-- extracting the values from the struct.</span><span>
</span><a name="line-502"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818742"><a href="#local-6989586621680818742"><span class="hs-identifier">value</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818743"><a href="#local-6989586621680818743"><span class="hs-identifier">overflowBit</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818744"><a href="#local-6989586621680818744"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818745"><a href="#local-6989586621680818745"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-503"></a><span>      </span><a href="LlvmCodeGen.CodeGen.html#genCallExtract"><span class="hs-identifier hs-var">genCallExtract</span></a><span> </span><a href="#local-6989586621680818733"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621680818735"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818738"><span class="hs-identifier hs-var">lhs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818739"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818741"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span>    </span><span class="hs-comment">-- value is i&lt;width&gt;, but overflowBit is i1, so we need to cast (Cmm expects</span><span>
</span><a name="line-505"></a><span>    </span><span class="hs-comment">-- both to be i&lt;width&gt;)</span><span>
</span><a name="line-506"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818746"><a href="#local-6989586621680818746"><span class="hs-identifier">overflow</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818747"><a href="#local-6989586621680818747"><span class="hs-identifier">zext</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818741"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Zext"><span class="hs-identifier hs-var">LM_Zext</span></a><span> </span><a href="#local-6989586621680818743"><span class="hs-identifier hs-var">overflowBit</span></a><span> </span><a href="#local-6989586621680818741"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-507"></a><span>    </span><a name="local-6989586621680818748"><a href="#local-6989586621680818748"><span class="hs-identifier">dstRegV</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818736"><span class="hs-identifier hs-var">dstV</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><span>    </span><a name="local-6989586621680818749"><a href="#local-6989586621680818749"><span class="hs-identifier">dstRegO</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818737"><span class="hs-identifier hs-var">dstO</span></a><span class="hs-special">)</span><span>
</span><a name="line-509"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818750"><a href="#local-6989586621680818750"><span class="hs-identifier">storeV</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818742"><span class="hs-identifier hs-var">value</span></a><span> </span><a href="#local-6989586621680818748"><span class="hs-identifier hs-var">dstRegV</span></a><span>
</span><a name="line-510"></a><span>        </span><a name="local-6989586621680818751"><a href="#local-6989586621680818751"><span class="hs-identifier">storeO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818746"><span class="hs-identifier hs-var">overflow</span></a><span> </span><a href="#local-6989586621680818749"><span class="hs-identifier hs-var">dstRegO</span></a><span>
</span><a name="line-511"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818744"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818747"><span class="hs-identifier hs-var">zext</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818750"><span class="hs-identifier hs-var">storeV</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818751"><span class="hs-identifier hs-var">storeO</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818745"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-512"></a><span class="hs-identifier">genCallWithOverflow</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-513"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genCallExtract: wrong ForeignTarget or number of arguments&quot;</span><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><span class="hs-comment">-- | A helper function for genCallWithOverflow that handles generating the call</span><span>
</span><a name="line-516"></a><span class="hs-comment">-- to the LLVM intrinsic and extracting the result from the struct to LlvmVars.</span><span>
</span><a name="line-517"></a><span class="hs-identifier">genCallExtract</span><span>
</span><a name="line-518"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>           </span><span class="hs-comment">-- ^ PrimOp</span><span>
</span><a name="line-519"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span>                   </span><span class="hs-comment">-- ^ Width of the operands.</span><span>
</span><a name="line-520"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">,</span><span> </span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ Actual arguments.</span><span>
</span><a name="line-521"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ LLVM types of the returned struct.</span><span>
</span><a name="line-522"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span class="hs-special">)</span><span>
</span><a name="line-523"></a><a name="genCallExtract"><a href="LlvmCodeGen.CodeGen.html#genCallExtract"><span class="hs-identifier">genCallExtract</span></a></a><span> </span><a name="local-6989586621680818752"><a href="#local-6989586621680818752"><span class="hs-identifier">target</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621680818753"><a href="#local-6989586621680818753"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680818754"><a href="#local-6989586621680818754"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680818755"><a href="#local-6989586621680818755"><span class="hs-identifier">argA</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818756"><a href="#local-6989586621680818756"><span class="hs-identifier">argB</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818757"><a href="#local-6989586621680818757"><span class="hs-identifier">llvmTypeA</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818758"><a href="#local-6989586621680818758"><span class="hs-identifier">llvmTypeB</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-524"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818759"><a href="#local-6989586621680818759"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818754"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-525"></a><span>        </span><a name="local-6989586621680818760"><a href="#local-6989586621680818760"><span class="hs-identifier">argTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818759"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818759"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">]</span><span>
</span><a name="line-526"></a><span>        </span><a name="local-6989586621680818761"><a href="#local-6989586621680818761"><span class="hs-identifier">retTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMStructU"><span class="hs-identifier hs-var">LMStructU</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818757"><span class="hs-identifier hs-var">llvmTypeA</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818758"><span class="hs-identifier hs-var">llvmTypeB</span></a><span class="hs-special">]</span><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span>    </span><span class="hs-comment">-- Process the arguments.</span><span>
</span><a name="line-529"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818762"><a href="#local-6989586621680818762"><span class="hs-identifier">args_hints</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818755"><span class="hs-identifier hs-var">argA</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818756"><span class="hs-identifier hs-var">argB</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmNode.html#foreignTargetHints"><span class="hs-identifier hs-var">foreignTargetHints</span></a><span> </span><a href="#local-6989586621680818752"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span>
</span><a name="line-530"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818763"><a href="#local-6989586621680818763"><span class="hs-identifier">argsV1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818764"><a href="#local-6989586621680818764"><span class="hs-identifier">args1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818765"><a href="#local-6989586621680818765"><span class="hs-identifier">top1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#arg_vars"><span class="hs-identifier hs-var">arg_vars</span></a><span> </span><a href="#local-6989586621680818762"><span class="hs-identifier hs-var">args_hints</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818766"><a href="#local-6989586621680818766"><span class="hs-identifier">argsV2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818767"><a href="#local-6989586621680818767"><span class="hs-identifier">args2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVars"><span class="hs-identifier hs-var">castVars</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818763"><span class="hs-identifier hs-var">argsV1</span></a><span> </span><a href="#local-6989586621680818760"><span class="hs-identifier hs-var">argTy</span></a><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span>    </span><span class="hs-comment">-- Get the function and make the call.</span><span>
</span><a name="line-534"></a><span>    </span><a name="local-6989586621680818768"><a href="#local-6989586621680818768"><span class="hs-identifier">fname</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#cmmPrimOpFunctions"><span class="hs-identifier hs-var">cmmPrimOpFunctions</span></a><span> </span><a href="#local-6989586621680818753"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-535"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818769"><a href="#local-6989586621680818769"><span class="hs-identifier">fptr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680818770"><a href="#local-6989586621680818770"><span class="hs-identifier">top2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getInstrinct"><span class="hs-identifier hs-var">getInstrinct</span></a><span> </span><a href="#local-6989586621680818768"><span class="hs-identifier hs-var">fname</span></a><span> </span><a href="#local-6989586621680818761"><span class="hs-identifier hs-var">retTy</span></a><span> </span><a href="#local-6989586621680818760"><span class="hs-identifier hs-var">argTy</span></a><span>
</span><a name="line-536"></a><span>    </span><span class="hs-comment">-- We use StdCall for primops. See also the last case of genCall.</span><span>
</span><a name="line-537"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818771"><a href="#local-6989586621680818771"><span class="hs-identifier">retV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818772"><a href="#local-6989586621680818772"><span class="hs-identifier">call</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818761"><span class="hs-identifier hs-var">retTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="Llvm.Types.html#StdCall"><span class="hs-identifier hs-var">StdCall</span></a><span> </span><a href="#local-6989586621680818769"><span class="hs-identifier hs-var">fptr</span></a><span> </span><a href="#local-6989586621680818766"><span class="hs-identifier hs-var">argsV2</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span>    </span><span class="hs-comment">-- This will result in a two element struct, we need to use &quot;extractvalue&quot;</span><span>
</span><a name="line-540"></a><span>    </span><span class="hs-comment">-- to get them out of it.</span><span>
</span><a name="line-541"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818773"><a href="#local-6989586621680818773"><span class="hs-identifier">res1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818774"><a href="#local-6989586621680818774"><span class="hs-identifier">ext1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818757"><span class="hs-identifier hs-var">llvmTypeA</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#ExtractV"><span class="hs-identifier hs-var">ExtractV</span></a><span> </span><a href="#local-6989586621680818771"><span class="hs-identifier hs-var">retV</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818775"><a href="#local-6989586621680818775"><span class="hs-identifier">res2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818776"><a href="#local-6989586621680818776"><span class="hs-identifier">ext2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818758"><span class="hs-identifier hs-var">llvmTypeB</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#ExtractV"><span class="hs-identifier hs-var">ExtractV</span></a><span> </span><a href="#local-6989586621680818771"><span class="hs-identifier hs-var">retV</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-543"></a><span>
</span><a name="line-544"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818777"><a href="#local-6989586621680818777"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818764"><span class="hs-identifier hs-var">args1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818767"><span class="hs-identifier hs-var">args2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818772"><span class="hs-identifier hs-var">call</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818774"><span class="hs-identifier hs-var">ext1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818776"><span class="hs-identifier hs-var">ext2</span></a><span>
</span><a name="line-545"></a><span>        </span><a name="local-6989586621680818778"><a href="#local-6989586621680818778"><span class="hs-identifier">tops</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818765"><span class="hs-identifier hs-var">top1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818770"><span class="hs-identifier hs-var">top2</span></a><span>
</span><a name="line-546"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818773"><span class="hs-identifier hs-var">res1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818775"><span class="hs-identifier hs-var">res2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818777"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818778"><span class="hs-identifier hs-var">tops</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-identifier">genCallExtract</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-549"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genCallExtract: unsupported ForeignTarget&quot;</span><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span class="hs-comment">-- Handle simple function call that only need simple type casting, of the form:</span><span>
</span><a name="line-552"></a><span class="hs-comment">--   truncate arg &gt;&gt;= \a -&gt; call(a) &gt;&gt;= zext</span><span>
</span><a name="line-553"></a><span class="hs-comment">--</span><span>
</span><a name="line-554"></a><span class="hs-comment">-- since GHC only really has i32 and i64 types and things like Word8 are backed</span><span>
</span><a name="line-555"></a><span class="hs-comment">-- by an i32 and just present a logical i8 range. So we must handle conversions</span><span>
</span><a name="line-556"></a><span class="hs-comment">-- from i32 to i8 explicitly as LLVM is strict about types.</span><span>
</span><a name="line-557"></a><span class="hs-identifier">genCallSimpleCast</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>
</span><a name="line-558"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-559"></a><a name="genCallSimpleCast"><a href="LlvmCodeGen.CodeGen.html#genCallSimpleCast"><span class="hs-identifier">genCallSimpleCast</span></a></a><span> </span><a name="local-6989586621680818779"><a href="#local-6989586621680818779"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621680818780"><a href="#local-6989586621680818780"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621680818781"><a href="#local-6989586621680818781"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818782"><a href="#local-6989586621680818782"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621680818783"><a href="#local-6989586621680818783"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-560"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818784"><a href="#local-6989586621680818784"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818779"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-561"></a><span>        </span><a name="local-6989586621680818785"><a href="#local-6989586621680818785"><span class="hs-identifier">dstTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#localRegType"><span class="hs-identifier hs-var">localRegType</span></a><span> </span><a href="#local-6989586621680818782"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span>    </span><a name="local-6989586621680818786"><a href="#local-6989586621680818786"><span class="hs-identifier">fname</span></a></a><span>                       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#cmmPrimOpFunctions"><span class="hs-identifier hs-var">cmmPrimOpFunctions</span></a><span> </span><a href="#local-6989586621680818781"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-564"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818787"><a href="#local-6989586621680818787"><span class="hs-identifier">fptr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680818788"><a href="#local-6989586621680818788"><span class="hs-identifier">top3</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getInstrinct"><span class="hs-identifier hs-var">getInstrinct</span></a><span> </span><a href="#local-6989586621680818786"><span class="hs-identifier hs-var">fname</span></a><span> </span><a href="#local-6989586621680818784"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818784"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">]</span><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span>    </span><a name="local-6989586621680818789"><a href="#local-6989586621680818789"><span class="hs-identifier">dstV</span></a></a><span>                        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818782"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680818790"><a href="#local-6989586621680818790"><span class="hs-identifier">arg_hints</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#foreignTargetHints"><span class="hs-identifier hs-var">foreignTargetHints</span></a><span> </span><a href="#local-6989586621680818780"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-569"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818791"><a href="#local-6989586621680818791"><span class="hs-identifier">args_hints</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818783"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621680818790"><span class="hs-identifier hs-var">arg_hints</span></a><span>
</span><a name="line-570"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818792"><a href="#local-6989586621680818792"><span class="hs-identifier">argsV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818793"><a href="#local-6989586621680818793"><span class="hs-identifier">stmts2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818794"><a href="#local-6989586621680818794"><span class="hs-identifier">top2</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#arg_vars"><span class="hs-identifier hs-var">arg_vars</span></a><span> </span><a href="#local-6989586621680818791"><span class="hs-identifier hs-var">args_hints</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-571"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818795"><a href="#local-6989586621680818795"><span class="hs-identifier">argsV'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818796"><a href="#local-6989586621680818796"><span class="hs-identifier">stmts4</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVars"><span class="hs-identifier hs-var">castVars</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818792"><span class="hs-identifier hs-var">argsV</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818784"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">]</span><span>
</span><a name="line-572"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818797"><a href="#local-6989586621680818797"><span class="hs-identifier">retV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818798"><a href="#local-6989586621680818798"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818784"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="Llvm.Types.html#StdCall"><span class="hs-identifier hs-var">StdCall</span></a><span> </span><a href="#local-6989586621680818787"><span class="hs-identifier hs-var">fptr</span></a><span> </span><a href="#local-6989586621680818795"><span class="hs-identifier hs-var">argsV'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-573"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818799"><a href="#local-6989586621680818799"><span class="hs-identifier">retVs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818800"><a href="#local-6989586621680818800"><span class="hs-identifier">stmts5</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVars"><span class="hs-identifier hs-var">castVars</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.CodeGen.html#cmmPrimOpRetValSignage"><span class="hs-identifier hs-var">cmmPrimOpRetValSignage</span></a><span> </span><a href="#local-6989586621680818781"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680818797"><span class="hs-identifier hs-var">retV</span></a><span class="hs-special">,</span><a href="#local-6989586621680818785"><span class="hs-identifier hs-var">dstTy</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-574"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818801"><a href="#local-6989586621680818801"><span class="hs-identifier">retV'</span></a></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#singletonPanic"><span class="hs-identifier hs-var">singletonPanic</span></a><span> </span><span class="hs-string">&quot;genCallSimpleCast&quot;</span><span> </span><a href="#local-6989586621680818799"><span class="hs-identifier hs-var">retVs'</span></a><span>
</span><a name="line-575"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818802"><a href="#local-6989586621680818802"><span class="hs-identifier">s2</span></a></a><span>                       </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818801"><span class="hs-identifier hs-var">retV'</span></a><span> </span><a href="#local-6989586621680818789"><span class="hs-identifier hs-var">dstV</span></a><span>
</span><a name="line-576"></a><span>
</span><a name="line-577"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818803"><a href="#local-6989586621680818803"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818793"><span class="hs-identifier hs-var">stmts2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818796"><span class="hs-identifier hs-var">stmts4</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-578"></a><span>                </span><a href="#local-6989586621680818798"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818800"><span class="hs-identifier hs-var">stmts5</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818802"><span class="hs-identifier hs-var">s2</span></a><span>
</span><a name="line-579"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818803"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818794"><span class="hs-identifier hs-var">top2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818788"><span class="hs-identifier hs-var">top3</span></a><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span class="hs-identifier">genCallSimpleCast</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680818804"><a href="#local-6989586621680818804"><span class="hs-identifier">dsts</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-581"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;genCallSimpleCast: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680818804"><span class="hs-identifier hs-var">dsts</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; dsts&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span class="hs-comment">-- Handle simple function call that only need simple type casting, of the form:</span><span>
</span><a name="line-584"></a><span class="hs-comment">--   truncate arg &gt;&gt;= \a -&gt; call(a) &gt;&gt;= zext</span><span>
</span><a name="line-585"></a><span class="hs-comment">--</span><span>
</span><a name="line-586"></a><span class="hs-comment">-- since GHC only really has i32 and i64 types and things like Word8 are backed</span><span>
</span><a name="line-587"></a><span class="hs-comment">-- by an i32 and just present a logical i8 range. So we must handle conversions</span><span>
</span><a name="line-588"></a><span class="hs-comment">-- from i32 to i8 explicitly as LLVM is strict about types.</span><span>
</span><a name="line-589"></a><span class="hs-identifier">genCallSimpleCast2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>
</span><a name="line-590"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-591"></a><a name="genCallSimpleCast2"><a href="LlvmCodeGen.CodeGen.html#genCallSimpleCast2"><span class="hs-identifier">genCallSimpleCast2</span></a></a><span> </span><a name="local-6989586621680818805"><a href="#local-6989586621680818805"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621680818806"><a href="#local-6989586621680818806"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621680818807"><a href="#local-6989586621680818807"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680818808"><a href="#local-6989586621680818808"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621680818809"><a href="#local-6989586621680818809"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-592"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818810"><a href="#local-6989586621680818810"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818805"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-593"></a><span>        </span><a name="local-6989586621680818811"><a href="#local-6989586621680818811"><span class="hs-identifier">dstTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#localRegType"><span class="hs-identifier hs-var">localRegType</span></a><span> </span><a href="#local-6989586621680818808"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span>    </span><a name="local-6989586621680818812"><a href="#local-6989586621680818812"><span class="hs-identifier">fname</span></a></a><span>                       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#cmmPrimOpFunctions"><span class="hs-identifier hs-var">cmmPrimOpFunctions</span></a><span> </span><a href="#local-6989586621680818807"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-596"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818813"><a href="#local-6989586621680818813"><span class="hs-identifier">fptr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680818814"><a href="#local-6989586621680818814"><span class="hs-identifier">top3</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getInstrinct"><span class="hs-identifier hs-var">getInstrinct</span></a><span> </span><a href="#local-6989586621680818812"><span class="hs-identifier hs-var">fname</span></a><span> </span><a href="#local-6989586621680818810"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621680818810"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621680818809"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span>    </span><a name="local-6989586621680818815"><a href="#local-6989586621680818815"><span class="hs-identifier">dstV</span></a></a><span>                        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680818808"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-599"></a><span>
</span><a name="line-600"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680818816"><a href="#local-6989586621680818816"><span class="hs-identifier">arg_hints</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#foreignTargetHints"><span class="hs-identifier hs-var">foreignTargetHints</span></a><span> </span><a href="#local-6989586621680818806"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-601"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818817"><a href="#local-6989586621680818817"><span class="hs-identifier">args_hints</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818809"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621680818816"><span class="hs-identifier hs-var">arg_hints</span></a><span>
</span><a name="line-602"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818818"><a href="#local-6989586621680818818"><span class="hs-identifier">argsV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818819"><a href="#local-6989586621680818819"><span class="hs-identifier">stmts2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818820"><a href="#local-6989586621680818820"><span class="hs-identifier">top2</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#arg_vars"><span class="hs-identifier hs-var">arg_vars</span></a><span> </span><a href="#local-6989586621680818817"><span class="hs-identifier hs-var">args_hints</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818821"><a href="#local-6989586621680818821"><span class="hs-identifier">argsV'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818822"><a href="#local-6989586621680818822"><span class="hs-identifier">stmts4</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVars"><span class="hs-identifier hs-var">castVars</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680818818"><span class="hs-identifier hs-var">argsV</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621680818810"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621680818818"><span class="hs-identifier hs-var">argsV</span></a><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818823"><a href="#local-6989586621680818823"><span class="hs-identifier">retV</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818824"><a href="#local-6989586621680818824"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818810"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="Llvm.Types.html#StdCall"><span class="hs-identifier hs-var">StdCall</span></a><span> </span><a href="#local-6989586621680818813"><span class="hs-identifier hs-var">fptr</span></a><span> </span><a href="#local-6989586621680818821"><span class="hs-identifier hs-var">argsV'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-605"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818825"><a href="#local-6989586621680818825"><span class="hs-identifier">retVs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818826"><a href="#local-6989586621680818826"><span class="hs-identifier">stmts5</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVars"><span class="hs-identifier hs-var">castVars</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.CodeGen.html#cmmPrimOpRetValSignage"><span class="hs-identifier hs-var">cmmPrimOpRetValSignage</span></a><span> </span><a href="#local-6989586621680818807"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680818823"><span class="hs-identifier hs-var">retV</span></a><span class="hs-special">,</span><a href="#local-6989586621680818811"><span class="hs-identifier hs-var">dstTy</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-606"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818827"><a href="#local-6989586621680818827"><span class="hs-identifier">retV'</span></a></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#singletonPanic"><span class="hs-identifier hs-var">singletonPanic</span></a><span> </span><span class="hs-string">&quot;genCallSimpleCast2&quot;</span><span> </span><a href="#local-6989586621680818825"><span class="hs-identifier hs-var">retVs'</span></a><span>
</span><a name="line-607"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818828"><a href="#local-6989586621680818828"><span class="hs-identifier">s2</span></a></a><span>                       </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818827"><span class="hs-identifier hs-var">retV'</span></a><span> </span><a href="#local-6989586621680818815"><span class="hs-identifier hs-var">dstV</span></a><span>
</span><a name="line-608"></a><span>
</span><a name="line-609"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818829"><a href="#local-6989586621680818829"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818819"><span class="hs-identifier hs-var">stmts2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818822"><span class="hs-identifier hs-var">stmts4</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-610"></a><span>                </span><a href="#local-6989586621680818824"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818826"><span class="hs-identifier hs-var">stmts5</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818828"><span class="hs-identifier hs-var">s2</span></a><span>
</span><a name="line-611"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818829"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818820"><span class="hs-identifier hs-var">top2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818814"><span class="hs-identifier hs-var">top3</span></a><span class="hs-special">)</span><span>
</span><a name="line-612"></a><span class="hs-identifier">genCallSimpleCast2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680818830"><a href="#local-6989586621680818830"><span class="hs-identifier">dsts</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-613"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;genCallSimpleCast2: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680818830"><span class="hs-identifier hs-var">dsts</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; dsts&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-614"></a><span>
</span><a name="line-615"></a><span class="hs-comment">-- | Create a function pointer from a target.</span><span>
</span><a name="line-616"></a><span class="hs-identifier">getFunPtrW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMString"><span class="hs-identifier hs-type">LMString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>
</span><a name="line-617"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-618"></a><a name="getFunPtrW"><a href="LlvmCodeGen.CodeGen.html#getFunPtrW"><span class="hs-identifier">getFunPtrW</span></a></a><span> </span><a name="local-6989586621680818831"><a href="#local-6989586621680818831"><span class="hs-identifier">funTy</span></a></a><span> </span><a name="local-6989586621680818832"><a href="#local-6989586621680818832"><span class="hs-identifier">targ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#liftExprData"><span class="hs-identifier hs-var">liftExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getFunPtr"><span class="hs-identifier hs-var">getFunPtr</span></a><span> </span><a href="#local-6989586621680818831"><span class="hs-identifier hs-var">funTy</span></a><span> </span><a href="#local-6989586621680818832"><span class="hs-identifier hs-var">targ</span></a><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span class="hs-comment">-- | Create a function pointer from a target.</span><span>
</span><a name="line-621"></a><span class="hs-identifier">getFunPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMString"><span class="hs-identifier hs-type">LMString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>
</span><a name="line-622"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-623"></a><a name="getFunPtr"><a href="LlvmCodeGen.CodeGen.html#getFunPtr"><span class="hs-identifier">getFunPtr</span></a></a><span> </span><a name="local-6989586621680818833"><a href="#local-6989586621680818833"><span class="hs-identifier">funTy</span></a></a><span> </span><a name="local-6989586621680818834"><a href="#local-6989586621680818834"><span class="hs-identifier">targ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818834"><span class="hs-identifier hs-var">targ</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-624"></a><span>    </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621680818835"><a href="#local-6989586621680818835"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-625"></a><span>        </span><a name="local-6989586621680818836"><a href="#local-6989586621680818836"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#strCLabel_llvm"><span class="hs-identifier hs-var">strCLabel_llvm</span></a><span> </span><a href="#local-6989586621680818835"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-626"></a><span>        </span><a href="LlvmCodeGen.CodeGen.html#getHsFunc%27"><span class="hs-identifier hs-var">getHsFunc'</span></a><span> </span><a href="#local-6989586621680818836"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818833"><span class="hs-identifier hs-var">funTy</span></a><span> </span><a href="#local-6989586621680818836"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>
</span><a name="line-628"></a><span>    </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a name="local-6989586621680818837"><a href="#local-6989586621680818837"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-629"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680818838"><a href="#local-6989586621680818838"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818839"><a href="#local-6989586621680818839"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818840"><a href="#local-6989586621680818840"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680818837"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-630"></a><span>        </span><a name="local-6989586621680818841"><a href="#local-6989586621680818841"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-631"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818842"><a href="#local-6989586621680818842"><span class="hs-identifier">fty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818833"><span class="hs-identifier hs-var">funTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;dynamic&quot;</span><span>
</span><a name="line-632"></a><span>            </span><a name="local-6989586621680818843"><a href="#local-6989586621680818843"><span class="hs-identifier">cast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818838"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-633"></a><span>                </span><a name="local-6989586621680818844"><a href="#local-6989586621680818844"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818844"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span>
</span><a name="line-634"></a><span>                </span><a name="local-6989586621680818845"><a href="#local-6989586621680818845"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680818845"><span class="hs-identifier hs-var">ty</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span>                </span><a name="local-6989586621680818846"><a href="#local-6989586621680818846"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCall: Expr is of bad type for function&quot;</span><span>
</span><a name="line-637"></a><span>                              </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; call! (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818841"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680818846"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-638"></a><span>
</span><a name="line-639"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680818847"><a href="#local-6989586621680818847"><span class="hs-identifier">v2</span></a></a><span class="hs-special">,</span><a name="local-6989586621680818848"><a href="#local-6989586621680818848"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680818842"><span class="hs-identifier hs-var">fty</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="#local-6989586621680818843"><span class="hs-identifier hs-var">cast</span></a><span> </span><a href="#local-6989586621680818838"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680818842"><span class="hs-identifier hs-var">fty</span></a><span class="hs-special">)</span><span>
</span><a name="line-640"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818847"><span class="hs-identifier hs-var">v2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818839"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818848"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818840"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span>
</span><a name="line-642"></a><span>    </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621680818849"><a href="#local-6989586621680818849"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-643"></a><span>        </span><a name="local-6989586621680818850"><a href="#local-6989586621680818850"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#cmmPrimOpFunctions"><span class="hs-identifier hs-var">cmmPrimOpFunctions</span></a><span> </span><a href="#local-6989586621680818849"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-644"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818851"><a href="#local-6989586621680818851"><span class="hs-identifier">fty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818833"><span class="hs-identifier hs-var">funTy</span></a><span> </span><a href="#local-6989586621680818850"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-645"></a><span>        </span><a href="LlvmCodeGen.CodeGen.html#getInstrinct2"><span class="hs-identifier hs-var">getInstrinct2</span></a><span> </span><a href="#local-6989586621680818850"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680818851"><span class="hs-identifier hs-var">fty</span></a><span>
</span><a name="line-646"></a><span>
</span><a name="line-647"></a><span class="hs-comment">-- | Conversion of call arguments.</span><span>
</span><a name="line-648"></a><span class="hs-identifier">arg_varsW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ForeignHint</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-649"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-650"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">[</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-651"></a><a name="arg_varsW"><a href="LlvmCodeGen.CodeGen.html#arg_varsW"><span class="hs-identifier">arg_varsW</span></a></a><span> </span><a name="local-6989586621680818852"><a href="#local-6989586621680818852"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621680818853"><a href="#local-6989586621680818853"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-652"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818854"><a href="#local-6989586621680818854"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818855"><a href="#local-6989586621680818855"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818856"><a href="#local-6989586621680818856"><span class="hs-identifier">decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#arg_vars"><span class="hs-identifier hs-var">arg_vars</span></a><span> </span><a href="#local-6989586621680818852"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680818853"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-653"></a><span>    </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><a href="#local-6989586621680818855"><span class="hs-identifier hs-var">stmts</span></a><span> </span><a href="#local-6989586621680818856"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-654"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680818854"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-655"></a><span>
</span><a name="line-656"></a><span class="hs-comment">-- | Conversion of call arguments.</span><span>
</span><a name="line-657"></a><span class="hs-identifier">arg_vars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ForeignHint</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-658"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-659"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><a name="arg_vars"><a href="LlvmCodeGen.CodeGen.html#arg_vars"><span class="hs-identifier">arg_vars</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818857"><a href="#local-6989586621680818857"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818858"><a href="#local-6989586621680818858"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818859"><a href="#local-6989586621680818859"><span class="hs-identifier">tops</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818857"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818858"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818859"><span class="hs-identifier hs-var">tops</span></a><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-identifier">arg_vars</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621680818860"><a href="#local-6989586621680818860"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">AddrHint</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621680818861"><a href="#local-6989586621680818861"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818862"><a href="#local-6989586621680818862"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818863"><a href="#local-6989586621680818863"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818864"><a href="#local-6989586621680818864"><span class="hs-identifier">tops</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-665"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818865"><a href="#local-6989586621680818865"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818866"><a href="#local-6989586621680818866"><span class="hs-identifier">stmts'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818867"><a href="#local-6989586621680818867"><span class="hs-identifier">top'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680818860"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-666"></a><span>       </span><a name="local-6989586621680818868"><a href="#local-6989586621680818868"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-667"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818869"><a href="#local-6989586621680818869"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818865"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-668"></a><span>               </span><a name="local-6989586621680818870"><a href="#local-6989586621680818870"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818870"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span>
</span><a name="line-669"></a><span>               </span><a name="local-6989586621680818871"><a href="#local-6989586621680818871"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680818871"><span class="hs-identifier hs-var">ty</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span>               </span><a name="local-6989586621680818872"><a href="#local-6989586621680818872"><span class="hs-identifier">a</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCall: Can't cast llvmType to i8*! (&quot;</span><span>
</span><a name="line-672"></a><span>                           </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818868"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680818872"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621680818873"><a href="#local-6989586621680818873"><span class="hs-identifier">v2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818874"><a href="#local-6989586621680818874"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="Llvm.Types.html#i8Ptr"><span class="hs-identifier hs-var">i8Ptr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="#local-6989586621680818869"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680818865"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="Llvm.Types.html#i8Ptr"><span class="hs-identifier hs-var">i8Ptr</span></a><span>
</span><a name="line-675"></a><span>       </span><a href="LlvmCodeGen.CodeGen.html#arg_vars"><span class="hs-identifier hs-var">arg_vars</span></a><span> </span><a href="#local-6989586621680818861"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818862"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818873"><span class="hs-identifier hs-var">v2</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818863"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818866"><span class="hs-identifier hs-var">stmts'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818874"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span>
</span><a name="line-676"></a><span>                               </span><a href="#local-6989586621680818864"><span class="hs-identifier hs-var">tops</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818867"><span class="hs-identifier hs-var">top'</span></a><span class="hs-special">)</span><span>
</span><a name="line-677"></a><span>
</span><a name="line-678"></a><span class="hs-identifier">arg_vars</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621680818875"><a href="#local-6989586621680818875"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621680818876"><a href="#local-6989586621680818876"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818877"><a href="#local-6989586621680818877"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818878"><a href="#local-6989586621680818878"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818879"><a href="#local-6989586621680818879"><span class="hs-identifier">tops</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-679"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818880"><a href="#local-6989586621680818880"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818881"><a href="#local-6989586621680818881"><span class="hs-identifier">stmts'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818882"><a href="#local-6989586621680818882"><span class="hs-identifier">top'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680818875"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-680"></a><span>       </span><a href="LlvmCodeGen.CodeGen.html#arg_vars"><span class="hs-identifier hs-var">arg_vars</span></a><span> </span><a href="#local-6989586621680818876"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818877"><span class="hs-identifier hs-var">vars</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818880"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818878"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818881"><span class="hs-identifier hs-var">stmts'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818879"><span class="hs-identifier hs-var">tops</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818882"><span class="hs-identifier hs-var">top'</span></a><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span class="hs-comment">-- | Cast a collection of LLVM variables to specific types.</span><span>
</span><a name="line-684"></a><span class="hs-identifier">castVarsW</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Signage"><span class="hs-identifier hs-type">Signage</span></a><span>
</span><a name="line-685"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-686"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">[</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-687"></a><a name="castVarsW"><a href="LlvmCodeGen.CodeGen.html#castVarsW"><span class="hs-identifier">castVarsW</span></a></a><span> </span><a name="local-6989586621680818883"><a href="#local-6989586621680818883"><span class="hs-identifier">signage</span></a></a><span> </span><a name="local-6989586621680818884"><a href="#local-6989586621680818884"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-688"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818885"><a href="#local-6989586621680818885"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818886"><a href="#local-6989586621680818886"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVars"><span class="hs-identifier hs-var">castVars</span></a><span> </span><a href="#local-6989586621680818883"><span class="hs-identifier hs-var">signage</span></a><span> </span><a href="#local-6989586621680818884"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-689"></a><span>    </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><a href="#local-6989586621680818886"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-690"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680818885"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-691"></a><span>
</span><a name="line-692"></a><span class="hs-comment">-- | Cast a collection of LLVM variables to specific types.</span><span>
</span><a name="line-693"></a><span class="hs-identifier">castVars</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Signage"><span class="hs-identifier hs-type">Signage</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-694"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">)</span><span>
</span><a name="line-695"></a><a name="castVars"><a href="LlvmCodeGen.CodeGen.html#castVars"><span class="hs-identifier">castVars</span></a></a><span> </span><a name="local-6989586621680818887"><a href="#local-6989586621680818887"><span class="hs-identifier">signage</span></a></a><span> </span><a name="local-6989586621680818888"><a href="#local-6989586621680818888"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-696"></a><span>                </span><a name="local-6989586621680818889"><a href="#local-6989586621680818889"><span class="hs-identifier">done</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.CodeGen.html#castVar"><span class="hs-identifier hs-var">castVar</span></a><span> </span><a href="#local-6989586621680818887"><span class="hs-identifier hs-var">signage</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818888"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-697"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818890"><a href="#local-6989586621680818890"><span class="hs-identifier">vars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818891"><a href="#local-6989586621680818891"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-6989586621680818889"><span class="hs-identifier hs-var">done</span></a><span>
</span><a name="line-698"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818890"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><a href="#local-6989586621680818891"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">)</span><span>
</span><a name="line-699"></a><span>
</span><a name="line-700"></a><span class="hs-comment">-- | Cast an LLVM variable to a specific type, panicing if it can't be done.</span><span>
</span><a name="line-701"></a><span class="hs-identifier">castVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Signage"><span class="hs-identifier hs-type">Signage</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.AbsSyn.html#LlvmStatement"><span class="hs-identifier hs-type">LlvmStatement</span></a><span class="hs-special">)</span><span>
</span><a name="line-702"></a><a name="castVar"><a href="LlvmCodeGen.CodeGen.html#castVar"><span class="hs-identifier">castVar</span></a></a><span> </span><a name="local-6989586621680818892"><a href="#local-6989586621680818892"><span class="hs-identifier">signage</span></a></a><span> </span><a name="local-6989586621680818893"><a href="#local-6989586621680818893"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621680818894"><a href="#local-6989586621680818894"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818893"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-703"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818893"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.AbsSyn.html#Nop"><span class="hs-identifier hs-var">Nop</span></a><span class="hs-special">)</span><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-706"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680818896"><a href="#local-6989586621680818896"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-707"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818897"><a href="#local-6989586621680818897"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818893"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-708"></a><span>                      </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMInt"><span class="hs-identifier hs-var">LMInt</span></a><span> </span><a name="local-6989586621680818898"><a href="#local-6989586621680818898"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#LMInt"><span class="hs-identifier hs-var">LMInt</span></a><span> </span><a name="local-6989586621680818899"><a href="#local-6989586621680818899"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-709"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680818898"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621680818899"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621680818895"><span class="hs-identifier hs-var">extend</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span>
</span><a name="line-710"></a><span>                      </span><span class="hs-special">(</span><a name="local-6989586621680818900"><a href="#local-6989586621680818900"><span class="hs-identifier">vt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isFloat"><span class="hs-identifier hs-var">isFloat</span></a><span> </span><a href="#local-6989586621680818900"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Llvm.Types.html#isFloat"><span class="hs-identifier hs-var">isFloat</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-711"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680818896"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680818900"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680818896"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-712"></a><span>                                </span><span class="hs-keyword">then</span><span> </span><a href="Llvm.Types.html#LM_Fpext"><span class="hs-identifier hs-var">LM_Fpext</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Llvm.Types.html#LM_Fptrunc"><span class="hs-identifier hs-var">LM_Fptrunc</span></a><span>
</span><a name="line-713"></a><span>                      </span><span class="hs-special">(</span><a name="local-6989586621680818901"><a href="#local-6989586621680818901"><span class="hs-identifier">vt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680818901"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Llvm.Types.html#isFloat"><span class="hs-identifier hs-var">isFloat</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Sitofp"><span class="hs-identifier hs-var">LM_Sitofp</span></a><span>
</span><a name="line-714"></a><span>                      </span><span class="hs-special">(</span><a name="local-6989586621680818902"><a href="#local-6989586621680818902"><span class="hs-identifier">vt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isFloat"><span class="hs-identifier hs-var">isFloat</span></a><span> </span><a href="#local-6989586621680818902"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Fptosi"><span class="hs-identifier hs-var">LM_Fptosi</span></a><span>
</span><a name="line-715"></a><span>                      </span><span class="hs-special">(</span><a name="local-6989586621680818903"><a href="#local-6989586621680818903"><span class="hs-identifier">vt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680818903"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span>
</span><a name="line-716"></a><span>                      </span><span class="hs-special">(</span><a name="local-6989586621680818904"><a href="#local-6989586621680818904"><span class="hs-identifier">vt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818904"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Ptrtoint"><span class="hs-identifier hs-var">LM_Ptrtoint</span></a><span>
</span><a name="line-717"></a><span>                      </span><span class="hs-special">(</span><a name="local-6989586621680818905"><a href="#local-6989586621680818905"><span class="hs-identifier">vt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818905"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span>
</span><a name="line-718"></a><span>                      </span><span class="hs-special">(</span><a name="local-6989586621680818906"><a href="#local-6989586621680818906"><span class="hs-identifier">vt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isVector"><span class="hs-identifier hs-var">isVector</span></a><span> </span><a href="#local-6989586621680818906"><span class="hs-identifier hs-var">vt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Llvm.Types.html#isVector"><span class="hs-identifier hs-var">isVector</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span>
</span><a name="line-719"></a><span>
</span><a name="line-720"></a><span>                      </span><span class="hs-special">(</span><a name="local-6989586621680818907"><a href="#local-6989586621680818907"><span class="hs-identifier">vt</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;castVars: Can't cast this type (&quot;</span><span>
</span><a name="line-721"></a><span>                                  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818896"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680818907"><span class="hs-identifier hs-var">vt</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;) to (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818896"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-722"></a><span>                 </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="#local-6989586621680818897"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680818893"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621680818894"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-723"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680818895"><a href="#local-6989586621680818895"><span class="hs-identifier">extend</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818892"><span class="hs-identifier hs-var">signage</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-724"></a><span>            </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Sext"><span class="hs-identifier hs-var">LM_Sext</span></a><span>
</span><a name="line-725"></a><span>            </span><a href="LlvmCodeGen.CodeGen.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Zext"><span class="hs-identifier hs-var">LM_Zext</span></a><span>
</span><a name="line-726"></a><span>
</span><a name="line-727"></a><span>
</span><a name="line-728"></a><span class="hs-identifier">cmmPrimOpRetValSignage</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmMachOp.html#CallishMachOp"><span class="hs-identifier hs-type">CallishMachOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Signage"><span class="hs-identifier hs-type">Signage</span></a><span>
</span><a name="line-729"></a><a name="cmmPrimOpRetValSignage"><a href="LlvmCodeGen.CodeGen.html#cmmPrimOpRetValSignage"><span class="hs-identifier">cmmPrimOpRetValSignage</span></a></a><span> </span><a name="local-6989586621680818908"><a href="#local-6989586621680818908"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818908"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-730"></a><span>    </span><a href="CmmMachOp.html#MO_Pdep"><span class="hs-identifier hs-var">MO_Pdep</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a><span>
</span><a name="line-731"></a><span>    </span><a href="CmmMachOp.html#MO_Pext"><span class="hs-identifier hs-var">MO_Pext</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a><span>
</span><a name="line-732"></a><span>    </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span>
</span><a name="line-733"></a><span>
</span><a name="line-734"></a><span class="hs-comment">-- | Decide what C function to use to implement a CallishMachOp</span><span>
</span><a name="line-735"></a><span class="hs-identifier">cmmPrimOpFunctions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmMachOp.html#CallishMachOp"><span class="hs-identifier hs-type">CallishMachOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LMString"><span class="hs-identifier hs-type">LMString</span></a><span>
</span><a name="line-736"></a><a name="cmmPrimOpFunctions"><a href="LlvmCodeGen.CodeGen.html#cmmPrimOpFunctions"><span class="hs-identifier">cmmPrimOpFunctions</span></a></a><span> </span><a name="local-6989586621680818909"><a href="#local-6989586621680818909"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-737"></a><span>
</span><a name="line-738"></a><span>  </span><a name="local-6989586621680818910"><a href="#local-6989586621680818910"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-739"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818911"><a href="#local-6989586621680818911"><span class="hs-identifier">intrinTy1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;p0i8.p0i8.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-740"></a><span>      </span><a name="local-6989586621680818912"><a href="#local-6989586621680818912"><span class="hs-identifier">intrinTy2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;p0i8.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-741"></a><span>      </span><a name="local-6989586621680818913"><a href="#local-6989586621680818913"><span class="hs-identifier">unsupported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cmmPrimOpFunctions: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680818909"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-742"></a><span>                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; not supported here&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-743"></a><span>
</span><a name="line-744"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818909"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-745"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Exp"><span class="hs-identifier hs-var">MO_F32_Exp</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;expf&quot;</span><span>
</span><a name="line-746"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Log"><span class="hs-identifier hs-var">MO_F32_Log</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;logf&quot;</span><span>
</span><a name="line-747"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Sqrt"><span class="hs-identifier hs-var">MO_F32_Sqrt</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.sqrt.f32&quot;</span><span>
</span><a name="line-748"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Fabs"><span class="hs-identifier hs-var">MO_F32_Fabs</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.fabs.f32&quot;</span><span>
</span><a name="line-749"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Pwr"><span class="hs-identifier hs-var">MO_F32_Pwr</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.pow.f32&quot;</span><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Sin"><span class="hs-identifier hs-var">MO_F32_Sin</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.sin.f32&quot;</span><span>
</span><a name="line-752"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Cos"><span class="hs-identifier hs-var">MO_F32_Cos</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.cos.f32&quot;</span><span>
</span><a name="line-753"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Tan"><span class="hs-identifier hs-var">MO_F32_Tan</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanf&quot;</span><span>
</span><a name="line-754"></a><span>
</span><a name="line-755"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Asin"><span class="hs-identifier hs-var">MO_F32_Asin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinf&quot;</span><span>
</span><a name="line-756"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Acos"><span class="hs-identifier hs-var">MO_F32_Acos</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acosf&quot;</span><span>
</span><a name="line-757"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Atan"><span class="hs-identifier hs-var">MO_F32_Atan</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanf&quot;</span><span>
</span><a name="line-758"></a><span>
</span><a name="line-759"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Sinh"><span class="hs-identifier hs-var">MO_F32_Sinh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinhf&quot;</span><span>
</span><a name="line-760"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Cosh"><span class="hs-identifier hs-var">MO_F32_Cosh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;coshf&quot;</span><span>
</span><a name="line-761"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Tanh"><span class="hs-identifier hs-var">MO_F32_Tanh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanhf&quot;</span><span>
</span><a name="line-762"></a><span>
</span><a name="line-763"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Asinh"><span class="hs-identifier hs-var">MO_F32_Asinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinhf&quot;</span><span>
</span><a name="line-764"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Acosh"><span class="hs-identifier hs-var">MO_F32_Acosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acoshf&quot;</span><span>
</span><a name="line-765"></a><span>    </span><a href="CmmMachOp.html#MO_F32_Atanh"><span class="hs-identifier hs-var">MO_F32_Atanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanhf&quot;</span><span>
</span><a name="line-766"></a><span>
</span><a name="line-767"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Exp"><span class="hs-identifier hs-var">MO_F64_Exp</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;exp&quot;</span><span>
</span><a name="line-768"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Log"><span class="hs-identifier hs-var">MO_F64_Log</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;log&quot;</span><span>
</span><a name="line-769"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Sqrt"><span class="hs-identifier hs-var">MO_F64_Sqrt</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.sqrt.f64&quot;</span><span>
</span><a name="line-770"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Fabs"><span class="hs-identifier hs-var">MO_F64_Fabs</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.fabs.f64&quot;</span><span>
</span><a name="line-771"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Pwr"><span class="hs-identifier hs-var">MO_F64_Pwr</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.pow.f64&quot;</span><span>
</span><a name="line-772"></a><span>
</span><a name="line-773"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Sin"><span class="hs-identifier hs-var">MO_F64_Sin</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.sin.f64&quot;</span><span>
</span><a name="line-774"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Cos"><span class="hs-identifier hs-var">MO_F64_Cos</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.cos.f64&quot;</span><span>
</span><a name="line-775"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Tan"><span class="hs-identifier hs-var">MO_F64_Tan</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tan&quot;</span><span>
</span><a name="line-776"></a><span>
</span><a name="line-777"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Asin"><span class="hs-identifier hs-var">MO_F64_Asin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asin&quot;</span><span>
</span><a name="line-778"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Acos"><span class="hs-identifier hs-var">MO_F64_Acos</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acos&quot;</span><span>
</span><a name="line-779"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Atan"><span class="hs-identifier hs-var">MO_F64_Atan</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atan&quot;</span><span>
</span><a name="line-780"></a><span>
</span><a name="line-781"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Sinh"><span class="hs-identifier hs-var">MO_F64_Sinh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinh&quot;</span><span>
</span><a name="line-782"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Cosh"><span class="hs-identifier hs-var">MO_F64_Cosh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cosh&quot;</span><span>
</span><a name="line-783"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Tanh"><span class="hs-identifier hs-var">MO_F64_Tanh</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanh&quot;</span><span>
</span><a name="line-784"></a><span>
</span><a name="line-785"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Asinh"><span class="hs-identifier hs-var">MO_F64_Asinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinh&quot;</span><span>
</span><a name="line-786"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Acosh"><span class="hs-identifier hs-var">MO_F64_Acosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acosh&quot;</span><span>
</span><a name="line-787"></a><span>    </span><a href="CmmMachOp.html#MO_F64_Atanh"><span class="hs-identifier hs-var">MO_F64_Atanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanh&quot;</span><span>
</span><a name="line-788"></a><span>
</span><a name="line-789"></a><span>    </span><a href="CmmMachOp.html#MO_Memcpy"><span class="hs-identifier hs-var">MO_Memcpy</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.memcpy.&quot;</span><span>  </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818911"><span class="hs-identifier hs-var">intrinTy1</span></a><span>
</span><a name="line-790"></a><span>    </span><a href="CmmMachOp.html#MO_Memmove"><span class="hs-identifier hs-var">MO_Memmove</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.memmove.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818911"><span class="hs-identifier hs-var">intrinTy1</span></a><span>
</span><a name="line-791"></a><span>    </span><a href="CmmMachOp.html#MO_Memset"><span class="hs-identifier hs-var">MO_Memset</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.memset.&quot;</span><span>  </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818912"><span class="hs-identifier hs-var">intrinTy2</span></a><span>
</span><a name="line-792"></a><span>    </span><a href="CmmMachOp.html#MO_Memcmp"><span class="hs-identifier hs-var">MO_Memcmp</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;memcmp&quot;</span><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span>    </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_PopCnt"><span class="hs-identifier hs-var">MO_PopCnt</span></a><span> </span><a name="local-6989586621680818914"><a href="#local-6989586621680818914"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.ctpop.&quot;</span><span>  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818914"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-795"></a><span>    </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_BSwap"><span class="hs-identifier hs-var">MO_BSwap</span></a><span> </span><a name="local-6989586621680818915"><a href="#local-6989586621680818915"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.bswap.&quot;</span><span>  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818915"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-796"></a><span>    </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Clz"><span class="hs-identifier hs-var">MO_Clz</span></a><span> </span><a name="local-6989586621680818916"><a href="#local-6989586621680818916"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.ctlz.&quot;</span><span>   </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818916"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-797"></a><span>    </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Ctz"><span class="hs-identifier hs-var">MO_Ctz</span></a><span> </span><a name="local-6989586621680818917"><a href="#local-6989586621680818917"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.cttz.&quot;</span><span>   </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818917"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span>    </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Pdep"><span class="hs-identifier hs-var">MO_Pdep</span></a><span> </span><a name="local-6989586621680818918"><a href="#local-6989586621680818918"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818919"><a href="#local-6989586621680818919"><span class="hs-identifier">w'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621680818918"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-800"></a><span>                      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isBmi2Enabled</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-801"></a><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.x86.bmi.pdep.&quot;</span><span>   </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818919"><span class="hs-identifier hs-var">w'</span></a><span>
</span><a name="line-802"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;hs_pdep&quot;</span><span>              </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818919"><span class="hs-identifier hs-var">w'</span></a><span>
</span><a name="line-803"></a><span>    </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Pext"><span class="hs-identifier hs-var">MO_Pext</span></a><span> </span><a name="local-6989586621680818920"><a href="#local-6989586621680818920"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818921"><a href="#local-6989586621680818921"><span class="hs-identifier">w'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621680818920"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-804"></a><span>                      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isBmi2Enabled</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-805"></a><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.x86.bmi.pext.&quot;</span><span>   </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818921"><span class="hs-identifier hs-var">w'</span></a><span>
</span><a name="line-806"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;hs_pext&quot;</span><span>              </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680818921"><span class="hs-identifier hs-var">w'</span></a><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span>    </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-var">MO_Prefetch_Data</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;llvm.prefetch&quot;</span><span>
</span><a name="line-809"></a><span>
</span><a name="line-810"></a><span>    </span><a href="CmmMachOp.html#MO_AddIntC"><span class="hs-identifier hs-var">MO_AddIntC</span></a><span> </span><a name="local-6989586621680818922"><a href="#local-6989586621680818922"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.sadd.with.overflow.&quot;</span><span>
</span><a name="line-811"></a><span>                             </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818922"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-812"></a><span>    </span><a href="CmmMachOp.html#MO_SubIntC"><span class="hs-identifier hs-var">MO_SubIntC</span></a><span> </span><a name="local-6989586621680818923"><a href="#local-6989586621680818923"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.ssub.with.overflow.&quot;</span><span>
</span><a name="line-813"></a><span>                             </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818923"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-814"></a><span>    </span><a href="CmmMachOp.html#MO_Add2"><span class="hs-identifier hs-var">MO_Add2</span></a><span> </span><a name="local-6989586621680818924"><a href="#local-6989586621680818924"><span class="hs-identifier">w</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.uadd.with.overflow.&quot;</span><span>
</span><a name="line-815"></a><span>                             </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818924"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-816"></a><span>    </span><a href="CmmMachOp.html#MO_AddWordC"><span class="hs-identifier hs-var">MO_AddWordC</span></a><span> </span><a name="local-6989586621680818925"><a href="#local-6989586621680818925"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.uadd.with.overflow.&quot;</span><span>
</span><a name="line-817"></a><span>                             </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818925"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-818"></a><span>    </span><a href="CmmMachOp.html#MO_SubWordC"><span class="hs-identifier hs-var">MO_SubWordC</span></a><span> </span><a name="local-6989586621680818926"><a href="#local-6989586621680818926"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.usub.with.overflow.&quot;</span><span>
</span><a name="line-819"></a><span>                             </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680818926"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span>
</span><a name="line-821"></a><span>    </span><a href="CmmMachOp.html#MO_S_QuotRem"><span class="hs-identifier hs-var">MO_S_QuotRem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-822"></a><span>    </span><a href="CmmMachOp.html#MO_U_QuotRem"><span class="hs-identifier hs-var">MO_U_QuotRem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-823"></a><span>    </span><a href="CmmMachOp.html#MO_U_QuotRem2"><span class="hs-identifier hs-var">MO_U_QuotRem2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-824"></a><span>    </span><span class="hs-comment">-- We support MO_U_Mul2 through ordinary LLVM mul instruction, see the</span><span>
</span><a name="line-825"></a><span>    </span><span class="hs-comment">-- appropriate case of genCall.</span><span>
</span><a name="line-826"></a><span>    </span><a href="CmmMachOp.html#MO_U_Mul2"><span class="hs-identifier hs-var">MO_U_Mul2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-827"></a><span>    </span><a href="CmmMachOp.html#MO_WriteBarrier"><span class="hs-identifier hs-var">MO_WriteBarrier</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-828"></a><span>    </span><a href="CmmMachOp.html#MO_Touch"><span class="hs-identifier hs-var">MO_Touch</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-829"></a><span>    </span><a href="CmmMachOp.html#MO_UF_Conv"><span class="hs-identifier hs-var">MO_UF_Conv</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-830"></a><span>
</span><a name="line-831"></a><span>    </span><a href="CmmMachOp.html#MO_AtomicRead"><span class="hs-identifier hs-var">MO_AtomicRead</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-832"></a><span>    </span><a href="CmmMachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-var">MO_AtomicRMW</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-833"></a><span>    </span><a href="CmmMachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-var">MO_AtomicWrite</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-834"></a><span>    </span><a href="CmmMachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-var">MO_Cmpxchg</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818913"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-835"></a><span>
</span><a name="line-836"></a><span class="hs-comment">-- | Tail function calls</span><span>
</span><a name="line-837"></a><span class="hs-identifier">genJump</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-838"></a><span>
</span><a name="line-839"></a><span class="hs-comment">-- Call to known function</span><span>
</span><a name="line-840"></a><a name="genJump"><a href="LlvmCodeGen.CodeGen.html#genJump"><span class="hs-identifier">genJump</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621680818927"><a href="#local-6989586621680818927"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680818928"><a href="#local-6989586621680818928"><span class="hs-identifier">live</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-841"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818929"><a href="#local-6989586621680818929"><span class="hs-identifier">vf</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818930"><a href="#local-6989586621680818930"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818931"><a href="#local-6989586621680818931"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getHsFunc"><span class="hs-identifier hs-var">getHsFunc</span></a><span> </span><a href="#local-6989586621680818928"><span class="hs-identifier hs-var">live</span></a><span> </span><a href="#local-6989586621680818927"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-842"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818932"><a href="#local-6989586621680818932"><span class="hs-identifier">stgRegs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818933"><a href="#local-6989586621680818933"><span class="hs-identifier">stgStmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#funEpilogue"><span class="hs-identifier hs-var">funEpilogue</span></a><span> </span><a href="#local-6989586621680818928"><span class="hs-identifier hs-var">live</span></a><span>
</span><a name="line-843"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818934"><a href="#local-6989586621680818934"><span class="hs-identifier">s1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Expr"><span class="hs-identifier hs-var">Expr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="Llvm.Types.html#TailCall"><span class="hs-identifier hs-var">TailCall</span></a><span> </span><a href="#local-6989586621680818929"><span class="hs-identifier hs-var">vf</span></a><span> </span><a href="#local-6989586621680818932"><span class="hs-identifier hs-var">stgRegs</span></a><span> </span><a href="LlvmCodeGen.Base.html#llvmStdFunAttrs"><span class="hs-identifier hs-var">llvmStdFunAttrs</span></a><span>
</span><a name="line-844"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818935"><a href="#local-6989586621680818935"><span class="hs-identifier">s2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Return"><span class="hs-identifier hs-var">Return</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-845"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818930"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818933"><span class="hs-identifier hs-var">stgStmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818934"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818935"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818931"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span>
</span><a name="line-848"></a><span class="hs-comment">-- Call to unknown function / address</span><span>
</span><a name="line-849"></a><span class="hs-identifier">genJump</span><span> </span><a name="local-6989586621680818936"><a href="#local-6989586621680818936"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621680818937"><a href="#local-6989586621680818937"><span class="hs-identifier">live</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-850"></a><span>    </span><a name="local-6989586621680818938"><a href="#local-6989586621680818938"><span class="hs-identifier">fty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#llvmFunTy"><span class="hs-identifier hs-var">llvmFunTy</span></a><span> </span><a href="#local-6989586621680818937"><span class="hs-identifier hs-var">live</span></a><span>
</span><a name="line-851"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818939"><a href="#local-6989586621680818939"><span class="hs-identifier">vf</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818940"><a href="#local-6989586621680818940"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818941"><a href="#local-6989586621680818941"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680818936"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-852"></a><span>    </span><a name="local-6989586621680818942"><a href="#local-6989586621680818942"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-853"></a><span>
</span><a name="line-854"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818943"><a href="#local-6989586621680818943"><span class="hs-identifier">cast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818939"><span class="hs-identifier hs-var">vf</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-855"></a><span>         </span><a name="local-6989586621680818944"><a href="#local-6989586621680818944"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818944"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span>
</span><a name="line-856"></a><span>         </span><a name="local-6989586621680818945"><a href="#local-6989586621680818945"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680818945"><span class="hs-identifier hs-var">ty</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span>         </span><a name="local-6989586621680818946"><a href="#local-6989586621680818946"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genJump: Expr is of bad type for function call! (&quot;</span><span>
</span><a name="line-859"></a><span>                     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680818942"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680818946"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-860"></a><span>
</span><a name="line-861"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818947"><a href="#local-6989586621680818947"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818948"><a href="#local-6989586621680818948"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680818938"><span class="hs-identifier hs-var">fty</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="#local-6989586621680818943"><span class="hs-identifier hs-var">cast</span></a><span> </span><a href="#local-6989586621680818939"><span class="hs-identifier hs-var">vf</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680818938"><span class="hs-identifier hs-var">fty</span></a><span class="hs-special">)</span><span>
</span><a name="line-862"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818949"><a href="#local-6989586621680818949"><span class="hs-identifier">stgRegs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818950"><a href="#local-6989586621680818950"><span class="hs-identifier">stgStmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#funEpilogue"><span class="hs-identifier hs-var">funEpilogue</span></a><span> </span><a href="#local-6989586621680818937"><span class="hs-identifier hs-var">live</span></a><span>
</span><a name="line-863"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818951"><a href="#local-6989586621680818951"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Expr"><span class="hs-identifier hs-var">Expr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="Llvm.Types.html#TailCall"><span class="hs-identifier hs-var">TailCall</span></a><span> </span><a href="#local-6989586621680818947"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621680818949"><span class="hs-identifier hs-var">stgRegs</span></a><span> </span><a href="LlvmCodeGen.Base.html#llvmStdFunAttrs"><span class="hs-identifier hs-var">llvmStdFunAttrs</span></a><span>
</span><a name="line-864"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818952"><a href="#local-6989586621680818952"><span class="hs-identifier">s3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Return"><span class="hs-identifier hs-var">Return</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-865"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818940"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818948"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818950"><span class="hs-identifier hs-var">stgStmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818951"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818952"><span class="hs-identifier hs-var">s3</span></a><span class="hs-special">,</span><span>
</span><a name="line-866"></a><span>            </span><a href="#local-6989586621680818941"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><span>
</span><a name="line-869"></a><span class="hs-comment">-- | CmmAssign operation</span><span>
</span><a name="line-870"></a><span class="hs-comment">--</span><span>
</span><a name="line-871"></a><span class="hs-comment">-- We use stack allocated variables for CmmReg. The optimiser will replace</span><span>
</span><a name="line-872"></a><span class="hs-comment">-- these with registers when possible.</span><span>
</span><a name="line-873"></a><span class="hs-identifier">genAssign</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-874"></a><a name="genAssign"><a href="LlvmCodeGen.CodeGen.html#genAssign"><span class="hs-identifier">genAssign</span></a></a><span> </span><a name="local-6989586621680818953"><a href="#local-6989586621680818953"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621680818954"><a href="#local-6989586621680818954"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-875"></a><span>    </span><a name="local-6989586621680818955"><a href="#local-6989586621680818955"><span class="hs-identifier">vreg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><a href="#local-6989586621680818953"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-876"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680818956"><a href="#local-6989586621680818956"><span class="hs-identifier">vval</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818957"><a href="#local-6989586621680818957"><span class="hs-identifier">stmts2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818958"><a href="#local-6989586621680818958"><span class="hs-identifier">top2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680818954"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-877"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818959"><a href="#local-6989586621680818959"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818957"><span class="hs-identifier hs-var">stmts2</span></a><span>
</span><a name="line-878"></a><span>
</span><a name="line-879"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818960"><a href="#local-6989586621680818960"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818955"><span class="hs-identifier hs-var">vreg</span></a><span>
</span><a name="line-880"></a><span>    </span><a name="local-6989586621680818961"><a href="#local-6989586621680818961"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-881"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680818960"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-882"></a><span>      </span><span class="hs-comment">-- Some registers are pointer types, so need to cast value to pointer</span><span>
</span><a name="line-883"></a><span>      </span><a href="Llvm.Types.html#LMPointer"><span class="hs-identifier hs-var">LMPointer</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818956"><span class="hs-identifier hs-var">vval</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680818961"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-884"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621680818962"><a href="#local-6989586621680818962"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818963"><a href="#local-6989586621680818963"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818960"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span> </span><a href="#local-6989586621680818956"><span class="hs-identifier hs-var">vval</span></a><span> </span><a href="#local-6989586621680818960"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-885"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818964"><a href="#local-6989586621680818964"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818962"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621680818955"><span class="hs-identifier hs-var">vreg</span></a><span>
</span><a name="line-886"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818959"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818963"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818964"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818958"><span class="hs-identifier hs-var">top2</span></a><span class="hs-special">)</span><span>
</span><a name="line-887"></a><span>
</span><a name="line-888"></a><span>      </span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-889"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621680818965"><a href="#local-6989586621680818965"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818966"><a href="#local-6989586621680818966"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818960"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span> </span><a href="#local-6989586621680818956"><span class="hs-identifier hs-var">vval</span></a><span> </span><a href="#local-6989586621680818960"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-890"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818967"><a href="#local-6989586621680818967"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818965"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621680818955"><span class="hs-identifier hs-var">vreg</span></a><span>
</span><a name="line-891"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818959"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818966"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818967"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818958"><span class="hs-identifier hs-var">top2</span></a><span class="hs-special">)</span><span>
</span><a name="line-892"></a><span>
</span><a name="line-893"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-894"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680818968"><a href="#local-6989586621680818968"><span class="hs-identifier">s1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818956"><span class="hs-identifier hs-var">vval</span></a><span> </span><a href="#local-6989586621680818955"><span class="hs-identifier hs-var">vreg</span></a><span>
</span><a name="line-895"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818959"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818968"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818958"><span class="hs-identifier hs-var">top2</span></a><span class="hs-special">)</span><span>
</span><a name="line-896"></a><span>
</span><a name="line-897"></a><span>
</span><a name="line-898"></a><span class="hs-comment">-- | CmmStore operation</span><span>
</span><a name="line-899"></a><span class="hs-identifier">genStore</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-900"></a><span>
</span><a name="line-901"></a><span class="hs-comment">-- First we try to detect a few common cases and produce better code for</span><span>
</span><a name="line-902"></a><span class="hs-comment">-- these then the default case. We are mostly trying to detect Cmm code</span><span>
</span><a name="line-903"></a><span class="hs-comment">-- like I32[Sp + n] and use 'getelementptr' operations instead of the</span><span>
</span><a name="line-904"></a><span class="hs-comment">-- generic case that uses casts and pointer arithmetic</span><span>
</span><a name="line-905"></a><a name="genStore"><a href="LlvmCodeGen.CodeGen.html#genStore"><span class="hs-identifier">genStore</span></a></a><span> </span><a name="local-6989586621680818969"><a href="#local-6989586621680818969"><span class="hs-identifier">addr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680818970"><a href="#local-6989586621680818970"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680818971"><a href="#local-6989586621680818971"><span class="hs-identifier">val</span></a></a><span>
</span><a name="line-906"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genStore_fast"><span class="hs-identifier hs-var">genStore_fast</span></a><span> </span><a href="#local-6989586621680818969"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621680818970"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621680818971"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-907"></a><span>
</span><a name="line-908"></a><span class="hs-identifier">genStore</span><span> </span><a name="local-6989586621680818972"><a href="#local-6989586621680818972"><span class="hs-identifier">addr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680818973"><a href="#local-6989586621680818973"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680818974"><a href="#local-6989586621680818974"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680818975"><a href="#local-6989586621680818975"><span class="hs-identifier">val</span></a></a><span>
</span><a name="line-909"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genStore_fast"><span class="hs-identifier hs-var">genStore_fast</span></a><span> </span><a href="#local-6989586621680818972"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621680818973"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621680818974"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680818975"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-910"></a><span>
</span><a name="line-911"></a><span class="hs-identifier">genStore</span><span> </span><a name="local-6989586621680818976"><a href="#local-6989586621680818976"><span class="hs-identifier">addr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-912"></a><span>                            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680818977"><a href="#local-6989586621680818977"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-913"></a><span>                            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621680818978"><a href="#local-6989586621680818978"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-914"></a><span>                </span><a name="local-6989586621680818979"><a href="#local-6989586621680818979"><span class="hs-identifier">val</span></a></a><span>
</span><a name="line-915"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genStore_fast"><span class="hs-identifier hs-var">genStore_fast</span></a><span> </span><a href="#local-6989586621680818976"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621680818977"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680818978"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818979"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-916"></a><span>
</span><a name="line-917"></a><span class="hs-identifier">genStore</span><span> </span><a name="local-6989586621680818980"><a href="#local-6989586621680818980"><span class="hs-identifier">addr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-918"></a><span>                            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680818981"><a href="#local-6989586621680818981"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-919"></a><span>                            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621680818982"><a href="#local-6989586621680818982"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-920"></a><span>                </span><a name="local-6989586621680818983"><a href="#local-6989586621680818983"><span class="hs-identifier">val</span></a></a><span>
</span><a name="line-921"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genStore_fast"><span class="hs-identifier hs-var">genStore_fast</span></a><span> </span><a href="#local-6989586621680818980"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621680818981"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680818982"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818983"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-922"></a><span>
</span><a name="line-923"></a><span class="hs-comment">-- generic case</span><span>
</span><a name="line-924"></a><span class="hs-identifier">genStore</span><span> </span><a name="local-6989586621680818984"><a href="#local-6989586621680818984"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621680818985"><a href="#local-6989586621680818985"><span class="hs-identifier">val</span></a></a><span>
</span><a name="line-925"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getTBAAMeta"><span class="hs-identifier hs-var">getTBAAMeta</span></a><span> </span><a href="LlvmCodeGen.Regs.html#topN"><span class="hs-identifier hs-var">topN</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genStore_slow"><span class="hs-identifier hs-var">genStore_slow</span></a><span> </span><a href="#local-6989586621680818984"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621680818985"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-926"></a><span>
</span><a name="line-927"></a><span class="hs-comment">-- | CmmStore operation</span><span>
</span><a name="line-928"></a><span class="hs-comment">-- This is a special case for storing to a global register pointer</span><span>
</span><a name="line-929"></a><span class="hs-comment">-- offset such as I32[Sp+8].</span><span>
</span><a name="line-930"></a><span class="hs-identifier">genStore_fast</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-931"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-932"></a><a name="genStore_fast"><a href="LlvmCodeGen.CodeGen.html#genStore_fast"><span class="hs-identifier">genStore_fast</span></a></a><span> </span><a name="local-6989586621680818986"><a href="#local-6989586621680818986"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621680818987"><a href="#local-6989586621680818987"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621680818988"><a href="#local-6989586621680818988"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680818989"><a href="#local-6989586621680818989"><span class="hs-identifier">val</span></a></a><span>
</span><a name="line-933"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680818990"><a href="#local-6989586621680818990"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-934"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621680818991"><a href="#local-6989586621680818991"><span class="hs-identifier">gv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818992"><a href="#local-6989586621680818992"><span class="hs-identifier">grt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818993"><a href="#local-6989586621680818993"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegVal"><span class="hs-identifier hs-var">getCmmRegVal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="#local-6989586621680818987"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-935"></a><span>       </span><a name="local-6989586621680818994"><a href="#local-6989586621680818994"><span class="hs-identifier">meta</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getTBAARegMeta"><span class="hs-identifier hs-var">getTBAARegMeta</span></a><span> </span><a href="#local-6989586621680818987"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-936"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680818995"><a href="#local-6989586621680818995"><span class="hs-identifier">ix</span></a></a><span class="hs-special">,</span><a name="local-6989586621680818996"><a href="#local-6989586621680818996"><span class="hs-identifier">rem</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680818988"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680818990"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818992"><span class="hs-identifier hs-var">grt</span></a><span>  </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-937"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680818992"><span class="hs-identifier hs-var">grt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680818996"><span class="hs-identifier hs-var">rem</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-938"></a><span>            </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-939"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621680818997"><a href="#local-6989586621680818997"><span class="hs-identifier">vval</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621680818998"><a href="#local-6989586621680818998"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680818999"><a href="#local-6989586621680818999"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680818989"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-940"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621680819000"><a href="#local-6989586621680819000"><span class="hs-identifier">ptr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819001"><a href="#local-6989586621680819001"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680818992"><span class="hs-identifier hs-var">grt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#GetElemPtr"><span class="hs-identifier hs-var">GetElemPtr</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621680818991"><span class="hs-identifier hs-var">gv</span></a><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.CodeGen.html#toI32"><span class="hs-identifier hs-var">toI32</span></a><span> </span><a href="#local-6989586621680818995"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">]</span><span>
</span><a name="line-941"></a><span>                </span><span class="hs-comment">-- We might need a different pointer type, so check</span><span>
</span><a name="line-942"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><a href="#local-6989586621680818992"><span class="hs-identifier hs-var">grt</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680818997"><span class="hs-identifier hs-var">vval</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-943"></a><span>                     </span><span class="hs-comment">-- were fine</span><span>
</span><a name="line-944"></a><span>                     </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-945"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819002"><a href="#local-6989586621680819002"><span class="hs-identifier">s3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#MetaStmt"><span class="hs-identifier hs-var">MetaStmt</span></a><span> </span><a href="#local-6989586621680818994"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818997"><span class="hs-identifier hs-var">vval</span></a><span> </span><a href="#local-6989586621680819000"><span class="hs-identifier hs-var">ptr</span></a><span>
</span><a name="line-946"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818998"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818993"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819001"><span class="hs-identifier hs-var">s2</span></a><span>
</span><a name="line-947"></a><span>                                 </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819002"><span class="hs-identifier hs-var">s3</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818999"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-948"></a><span>
</span><a name="line-949"></a><span>                     </span><span class="hs-comment">-- cast to pointer type needed</span><span>
</span><a name="line-950"></a><span>                     </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-951"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819003"><a href="#local-6989586621680819003"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680818997"><span class="hs-identifier hs-var">vval</span></a><span>
</span><a name="line-952"></a><span>                         </span><span class="hs-special">(</span><a name="local-6989586621680819004"><a href="#local-6989586621680819004"><span class="hs-identifier">ptr'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819005"><a href="#local-6989586621680819005"><span class="hs-identifier">s3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819003"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span> </span><a href="#local-6989586621680819000"><span class="hs-identifier hs-var">ptr</span></a><span> </span><a href="#local-6989586621680819003"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-953"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819006"><a href="#local-6989586621680819006"><span class="hs-identifier">s4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#MetaStmt"><span class="hs-identifier hs-var">MetaStmt</span></a><span> </span><a href="#local-6989586621680818994"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680818997"><span class="hs-identifier hs-var">vval</span></a><span> </span><a href="#local-6989586621680819004"><span class="hs-identifier hs-var">ptr'</span></a><span>
</span><a name="line-954"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818998"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680818993"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819001"><span class="hs-identifier hs-var">s2</span></a><span>
</span><a name="line-955"></a><span>                                 </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819005"><span class="hs-identifier hs-var">s3</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819006"><span class="hs-identifier hs-var">s4</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680818999"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-956"></a><span>
</span><a name="line-957"></a><span>            </span><span class="hs-comment">-- If its a bit type then we use the slow method since</span><span>
</span><a name="line-958"></a><span>            </span><span class="hs-comment">-- we can't avoid casting anyway.</span><span>
</span><a name="line-959"></a><span>            </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genStore_slow"><span class="hs-identifier hs-var">genStore_slow</span></a><span> </span><a href="#local-6989586621680818986"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621680818989"><span class="hs-identifier hs-var">val</span></a><span> </span><a href="#local-6989586621680818994"><span class="hs-identifier hs-var">meta</span></a><span>
</span><a name="line-960"></a><span>
</span><a name="line-961"></a><span>
</span><a name="line-962"></a><span class="hs-comment">-- | CmmStore operation</span><span>
</span><a name="line-963"></a><span class="hs-comment">-- Generic case. Uses casts and pointer arithmetic if needed.</span><span>
</span><a name="line-964"></a><span class="hs-identifier">genStore_slow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Llvm.MetaData.html#MetaAnnot"><span class="hs-identifier hs-type">MetaAnnot</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-965"></a><a name="genStore_slow"><a href="LlvmCodeGen.CodeGen.html#genStore_slow"><span class="hs-identifier">genStore_slow</span></a></a><span> </span><a name="local-6989586621680819007"><a href="#local-6989586621680819007"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621680819008"><a href="#local-6989586621680819008"><span class="hs-identifier">val</span></a></a><span> </span><a name="local-6989586621680819009"><a href="#local-6989586621680819009"><span class="hs-identifier">meta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-966"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819010"><a href="#local-6989586621680819010"><span class="hs-identifier">vaddr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819011"><a href="#local-6989586621680819011"><span class="hs-identifier">stmts1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819012"><a href="#local-6989586621680819012"><span class="hs-identifier">top1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680819007"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-967"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819013"><a href="#local-6989586621680819013"><span class="hs-identifier">vval</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621680819014"><a href="#local-6989586621680819014"><span class="hs-identifier">stmts2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819015"><a href="#local-6989586621680819015"><span class="hs-identifier">top2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680819008"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-968"></a><span>
</span><a name="line-969"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819016"><a href="#local-6989586621680819016"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819011"><span class="hs-identifier hs-var">stmts1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819014"><span class="hs-identifier hs-var">stmts2</span></a><span>
</span><a name="line-970"></a><span>    </span><a name="local-6989586621680819017"><a href="#local-6989586621680819017"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-971"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819010"><span class="hs-identifier hs-var">vaddr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-972"></a><span>        </span><span class="hs-comment">-- sometimes we need to cast an int to a pointer before storing</span><span>
</span><a name="line-973"></a><span>        </span><a href="Llvm.Types.html#LMPointer"><span class="hs-identifier hs-var">LMPointer</span></a><span> </span><a name="local-6989586621680819018"><a href="#local-6989586621680819018"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Llvm.Types.html#LMPointer"><span class="hs-identifier hs-var">LMPointer</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819013"><span class="hs-identifier hs-var">vval</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819017"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-974"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819019"><a href="#local-6989586621680819019"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819020"><a href="#local-6989586621680819020"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819018"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span> </span><a href="#local-6989586621680819013"><span class="hs-identifier hs-var">vval</span></a><span> </span><a href="#local-6989586621680819018"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-975"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819021"><a href="#local-6989586621680819021"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#MetaStmt"><span class="hs-identifier hs-var">MetaStmt</span></a><span> </span><a href="#local-6989586621680819009"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680819019"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621680819010"><span class="hs-identifier hs-var">vaddr</span></a><span>
</span><a name="line-976"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819016"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819020"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819021"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819012"><span class="hs-identifier hs-var">top1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819015"><span class="hs-identifier hs-var">top2</span></a><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>
</span><a name="line-978"></a><span>        </span><a href="Llvm.Types.html#LMPointer"><span class="hs-identifier hs-var">LMPointer</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-979"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819022"><a href="#local-6989586621680819022"><span class="hs-identifier">s1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#MetaStmt"><span class="hs-identifier hs-var">MetaStmt</span></a><span> </span><a href="#local-6989586621680819009"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680819013"><span class="hs-identifier hs-var">vval</span></a><span> </span><a href="#local-6989586621680819010"><span class="hs-identifier hs-var">vaddr</span></a><span>
</span><a name="line-980"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819016"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819022"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819012"><span class="hs-identifier hs-var">top1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819015"><span class="hs-identifier hs-var">top2</span></a><span class="hs-special">)</span><span>
</span><a name="line-981"></a><span>
</span><a name="line-982"></a><span>        </span><a name="local-6989586621680819023"><a href="#local-6989586621680819023"><span class="hs-identifier">i</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Llvm.Types.html#LMInt"><span class="hs-identifier hs-var">LMInt</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680819023"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819017"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-983"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819024"><a href="#local-6989586621680819024"><span class="hs-identifier">vty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819013"><span class="hs-identifier hs-var">vval</span></a><span>
</span><a name="line-984"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819025"><a href="#local-6989586621680819025"><span class="hs-identifier">vptr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819026"><a href="#local-6989586621680819026"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819024"><span class="hs-identifier hs-var">vty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span> </span><a href="#local-6989586621680819010"><span class="hs-identifier hs-var">vaddr</span></a><span> </span><a href="#local-6989586621680819024"><span class="hs-identifier hs-var">vty</span></a><span>
</span><a name="line-985"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819027"><a href="#local-6989586621680819027"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#MetaStmt"><span class="hs-identifier hs-var">MetaStmt</span></a><span> </span><a href="#local-6989586621680819009"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680819013"><span class="hs-identifier hs-var">vval</span></a><span> </span><a href="#local-6989586621680819025"><span class="hs-identifier hs-var">vptr</span></a><span>
</span><a name="line-986"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819016"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819026"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819027"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819012"><span class="hs-identifier hs-var">top1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819015"><span class="hs-identifier hs-var">top2</span></a><span class="hs-special">)</span><span>
</span><a name="line-987"></a><span>
</span><a name="line-988"></a><span>        </span><a name="local-6989586621680819028"><a href="#local-6989586621680819028"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-989"></a><span>            </span><a href="LlvmCodeGen.CodeGen.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;genStore: ptr not right type!&quot;</span><span>
</span><a name="line-990"></a><span>                    </span><span class="hs-special">(</span><a href="PprCmmExpr.html#pprExpr"><span class="hs-identifier hs-var">PprCmm.pprExpr</span></a><span> </span><a href="#local-6989586621680819007"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-991"></a><span>                        </span><span class="hs-string">&quot;Size of Ptr: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#llvmPtrBits"><span class="hs-identifier hs-var">llvmPtrBits</span></a><span> </span><a href="#local-6989586621680819017"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-992"></a><span>                        </span><span class="hs-string">&quot;, Size of var: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819017"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819028"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-993"></a><span>                        </span><span class="hs-string">&quot;, Var: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680819017"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680819010"><span class="hs-identifier hs-var">vaddr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-994"></a><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span class="hs-comment">-- | Unconditional branch</span><span>
</span><a name="line-997"></a><span class="hs-identifier">genBranch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-998"></a><a name="genBranch"><a href="LlvmCodeGen.CodeGen.html#genBranch"><span class="hs-identifier">genBranch</span></a></a><span> </span><a name="local-6989586621680819029"><a href="#local-6989586621680819029"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-999"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-keyword">label</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#blockIdToLlvm"><span class="hs-identifier hs-var">blockIdToLlvm</span></a><span> </span><a href="#local-6989586621680819029"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1000"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Branch"><span class="hs-identifier hs-var">Branch</span></a><span> </span><span class="hs-keyword">label</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1001"></a><span>
</span><a name="line-1002"></a><span>
</span><a name="line-1003"></a><span class="hs-comment">-- | Conditional branch</span><span>
</span><a name="line-1004"></a><span class="hs-identifier">genCondBranch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-1005"></a><a name="genCondBranch"><a href="LlvmCodeGen.CodeGen.html#genCondBranch"><span class="hs-identifier">genCondBranch</span></a></a><span> </span><a name="local-6989586621680819031"><a href="#local-6989586621680819031"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621680819032"><a href="#local-6989586621680819032"><span class="hs-identifier">idT</span></a></a><span> </span><a name="local-6989586621680819033"><a href="#local-6989586621680819033"><span class="hs-identifier">idF</span></a></a><span> </span><a name="local-6989586621680819034"><a href="#local-6989586621680819034"><span class="hs-identifier">likely</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1006"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819035"><a href="#local-6989586621680819035"><span class="hs-identifier">labelT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#blockIdToLlvm"><span class="hs-identifier hs-var">blockIdToLlvm</span></a><span> </span><a href="#local-6989586621680819032"><span class="hs-identifier hs-var">idT</span></a><span>
</span><a name="line-1007"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819036"><a href="#local-6989586621680819036"><span class="hs-identifier">labelF</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#blockIdToLlvm"><span class="hs-identifier hs-var">blockIdToLlvm</span></a><span> </span><a href="#local-6989586621680819033"><span class="hs-identifier hs-var">idF</span></a><span>
</span><a name="line-1008"></a><span>    </span><span class="hs-comment">-- See Note [Literals and branch conditions].</span><span>
</span><a name="line-1009"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819037"><a href="#local-6989586621680819037"><span class="hs-identifier">vc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819038"><a href="#local-6989586621680819038"><span class="hs-identifier">stmts1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819039"><a href="#local-6989586621680819039"><span class="hs-identifier">top1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarOpt"><span class="hs-identifier hs-var">exprToVarOpt</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#i1Option"><span class="hs-identifier hs-var">i1Option</span></a><span> </span><a href="#local-6989586621680819031"><span class="hs-identifier hs-var">cond</span></a><span>
</span><a name="line-1010"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819037"><span class="hs-identifier hs-var">vc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span>
</span><a name="line-1011"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1012"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819041"><a href="#local-6989586621680819041"><span class="hs-identifier">vc'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680819042"><a href="#local-6989586621680819042"><span class="hs-identifier">stmts2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819043"><a href="#local-6989586621680819043"><span class="hs-identifier">top2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819034"><span class="hs-identifier hs-var">likely</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1013"></a><span>              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680819040"><a href="#local-6989586621680819040"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genExpectLit"><span class="hs-identifier hs-var">genExpectLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680819040"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span>  </span><a href="#local-6989586621680819037"><span class="hs-identifier hs-var">vc</span></a><span>
</span><a name="line-1014"></a><span>              </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819037"><span class="hs-identifier hs-var">vc</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1015"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819044"><a href="#local-6989586621680819044"><span class="hs-identifier">s1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#BranchIf"><span class="hs-identifier hs-var">BranchIf</span></a><span> </span><a href="#local-6989586621680819041"><span class="hs-identifier hs-var">vc'</span></a><span> </span><a href="#local-6989586621680819035"><span class="hs-identifier hs-var">labelT</span></a><span> </span><a href="#local-6989586621680819036"><span class="hs-identifier hs-var">labelF</span></a><span>
</span><a name="line-1016"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819038"><span class="hs-identifier hs-var">stmts1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819042"><span class="hs-identifier hs-var">stmts2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819044"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819039"><span class="hs-identifier hs-var">top1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819043"><span class="hs-identifier hs-var">top2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1017"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1018"></a><span>            </span><a name="local-6989586621680819045"><a href="#local-6989586621680819045"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1019"></a><span>            </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCondBranch: Cond expr not bool! (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680819045"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680819037"><span class="hs-identifier hs-var">vc</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-1020"></a><span>
</span><a name="line-1021"></a><span>
</span><a name="line-1022"></a><span class="hs-comment">-- | Generate call to llvm.expect.x intrinsic. Assigning result to a new var.</span><span>
</span><a name="line-1023"></a><span class="hs-identifier">genExpectLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span class="hs-special">)</span><span>
</span><a name="line-1024"></a><a name="genExpectLit"><a href="LlvmCodeGen.CodeGen.html#genExpectLit"><span class="hs-identifier">genExpectLit</span></a></a><span> </span><a name="local-6989586621680819046"><a href="#local-6989586621680819046"><span class="hs-identifier">expLit</span></a></a><span> </span><a name="local-6989586621680819047"><a href="#local-6989586621680819047"><span class="hs-identifier">expTy</span></a></a><span> </span><a name="local-6989586621680819048"><a href="#local-6989586621680819048"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1025"></a><span>  </span><a name="local-6989586621680819049"><a href="#local-6989586621680819049"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1026"></a><span>
</span><a name="line-1027"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-1028"></a><span>    </span><a name="local-6989586621680819050"><a href="#local-6989586621680819050"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMIntLit"><span class="hs-identifier hs-var">LMIntLit</span></a><span> </span><a href="#local-6989586621680819046"><span class="hs-identifier hs-var">expLit</span></a><span> </span><a href="#local-6989586621680819047"><span class="hs-identifier hs-var">expTy</span></a><span>
</span><a name="line-1029"></a><span>
</span><a name="line-1030"></a><span>    </span><a name="local-6989586621680819051"><a href="#local-6989586621680819051"><span class="hs-identifier">llvmExpectName</span></a></a><span>
</span><a name="line-1031"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680819047"><span class="hs-identifier hs-var">expTy</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.expect.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680819049"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680819047"><span class="hs-identifier hs-var">expTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-1032"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genExpectedLit: Type not an int!&quot;</span><span>
</span><a name="line-1033"></a><span>
</span><a name="line-1034"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621680819052"><a href="#local-6989586621680819052"><span class="hs-identifier">llvmExpect</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819053"><a href="#local-6989586621680819053"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819054"><a href="#local-6989586621680819054"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1035"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#getInstrinct"><span class="hs-identifier hs-var">getInstrinct</span></a><span> </span><a href="#local-6989586621680819051"><span class="hs-identifier hs-var">llvmExpectName</span></a><span> </span><a href="#local-6989586621680819047"><span class="hs-identifier hs-var">expTy</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680819047"><span class="hs-identifier hs-var">expTy</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819047"><span class="hs-identifier hs-var">expTy</span></a><span class="hs-special">]</span><span>
</span><a name="line-1036"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621680819055"><a href="#local-6989586621680819055"><span class="hs-identifier">var'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819056"><a href="#local-6989586621680819056"><span class="hs-identifier">call</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819047"><span class="hs-identifier hs-var">expTy</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a href="Llvm.Types.html#StdCall"><span class="hs-identifier hs-var">StdCall</span></a><span> </span><a href="#local-6989586621680819052"><span class="hs-identifier hs-var">llvmExpect</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621680819048"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819050"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1037"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819055"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819053"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819056"><span class="hs-identifier hs-var">call</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819054"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1038"></a><span>
</span><a name="line-1039"></a><span class="hs-comment">{- Note [Literals and branch conditions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

It is important that whenever we generate branch conditions for
literals like '1', they are properly narrowed to an LLVM expression of
type 'i1' (for bools.) Otherwise, nobody is happy. So when we convert
a CmmExpr to an LLVM expression for a branch conditional, exprToVarOpt
must be certain to return a properly narrowed type. genLit is
responsible for this, in the case of literal integers.

Often, we won't see direct statements like:

    if(1) {
      ...
    } else {
      ...
    }

at this point in the pipeline, because the Glorious Code Generator
will do trivial branch elimination in the sinking pass (among others,)
which will eliminate the expression entirely.

However, it's certainly possible and reasonable for this to occur in
hand-written C-- code. Consider something like:

    #if !defined(SOME_CONDITIONAL)
    #define CHECK_THING(x) 1
    #else
    #define CHECK_THING(x) some_operation((x))
    #endif

    f() {

      if (CHECK_THING(xyz)) {
        ...
      } else {
        ...
      }

    }

In such an instance, CHECK_THING might result in an *expression* in
one case, and a *literal* in the other, depending on what in
particular was #define'd. So we must be sure to properly narrow the
literal in this case to i1 as it won't be eliminated beforehand.

For a real example of this, see ./rts/StgStdThunks.cmm

-}</span><span>
</span><a name="line-1088"></a><span>
</span><a name="line-1089"></a><span>
</span><a name="line-1090"></a><span>
</span><a name="line-1091"></a><span class="hs-comment">-- | Switch branch</span><span>
</span><a name="line-1092"></a><span class="hs-identifier">genSwitch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmSwitch.html#SwitchTargets"><span class="hs-identifier hs-type">SwitchTargets</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-1093"></a><a name="genSwitch"><a href="LlvmCodeGen.CodeGen.html#genSwitch"><span class="hs-identifier">genSwitch</span></a></a><span> </span><a name="local-6989586621680819057"><a href="#local-6989586621680819057"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621680819058"><a href="#local-6989586621680819058"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1094"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819059"><a href="#local-6989586621680819059"><span class="hs-identifier">vc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819060"><a href="#local-6989586621680819060"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819061"><a href="#local-6989586621680819061"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680819057"><span class="hs-identifier hs-var">cond</span></a><span>
</span><a name="line-1095"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819062"><a href="#local-6989586621680819062"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819059"><span class="hs-identifier hs-var">vc</span></a><span>
</span><a name="line-1096"></a><span>
</span><a name="line-1097"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819063"><a href="#local-6989586621680819063"><span class="hs-identifier">labels</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="#local-6989586621680819062"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680819064"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#blockIdToLlvm"><span class="hs-identifier hs-var">blockIdToLlvm</span></a><span> </span><a href="#local-6989586621680819065"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1098"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680819064"><a href="#local-6989586621680819064"><span class="hs-identifier">ix</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819065"><a href="#local-6989586621680819065"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmmSwitch.html#switchTargetsCases"><span class="hs-identifier hs-var">switchTargetsCases</span></a><span> </span><a href="#local-6989586621680819058"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1099"></a><span>    </span><span class="hs-comment">-- out of range is undefined, so let's just branch to first label</span><span>
</span><a name="line-1100"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819066"><a href="#local-6989586621680819066"><span class="hs-identifier">defLbl</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680819067"><a href="#local-6989586621680819067"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmmSwitch.html#switchTargetsDefault"><span class="hs-identifier hs-var">switchTargetsDefault</span></a><span> </span><a href="#local-6989586621680819058"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#blockIdToLlvm"><span class="hs-identifier hs-var">blockIdToLlvm</span></a><span> </span><a href="#local-6989586621680819067"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1101"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621680819063"><span class="hs-identifier hs-var">labels</span></a><span class="hs-special">)</span><span>
</span><a name="line-1102"></a><span>
</span><a name="line-1103"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819068"><a href="#local-6989586621680819068"><span class="hs-identifier">s1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Switch"><span class="hs-identifier hs-var">Switch</span></a><span> </span><a href="#local-6989586621680819059"><span class="hs-identifier hs-var">vc</span></a><span> </span><a href="#local-6989586621680819066"><span class="hs-identifier hs-var">defLbl</span></a><span> </span><a href="#local-6989586621680819063"><span class="hs-identifier hs-var">labels</span></a><span>
</span><a name="line-1104"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819060"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819068"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819061"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-1105"></a><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1108"></a><span class="hs-comment">-- * CmmExpr code generation</span><span>
</span><a name="line-1109"></a><span class="hs-comment">--</span><span>
</span><a name="line-1110"></a><span>
</span><a name="line-1111"></a><span class="hs-comment">-- | An expression conversion return data:</span><span>
</span><a name="line-1112"></a><span class="hs-comment">--   * LlvmVar: The var holding the result of the expression</span><span>
</span><a name="line-1113"></a><span class="hs-comment">--   * LlvmStatements: Any statements needed to evaluate the expression</span><span>
</span><a name="line-1114"></a><span class="hs-comment">--   * LlvmCmmDecl: Any global data needed for this expression</span><span>
</span><a name="line-1115"></a><span class="hs-keyword">type</span><span> </span><a name="ExprData"><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier">ExprData</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1116"></a><span>
</span><a name="line-1117"></a><span class="hs-comment">-- | Values which can be passed to 'exprToVar' to configure its</span><span>
</span><a name="line-1118"></a><span class="hs-comment">-- behaviour in certain circumstances.</span><span>
</span><a name="line-1119"></a><span class="hs-comment">--</span><span>
</span><a name="line-1120"></a><span class="hs-comment">-- Currently just used for determining if a comparison should return</span><span>
</span><a name="line-1121"></a><span class="hs-comment">-- a boolean (i1) or a word. See Note [Literals and branch conditions].</span><span>
</span><a name="line-1122"></a><span class="hs-keyword">newtype</span><span> </span><a name="EOption"><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier">EOption</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EOption"><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier">EOption</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="i1Expected"><a href="LlvmCodeGen.CodeGen.html#i1Expected"><span class="hs-identifier">i1Expected</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1123"></a><span class="hs-comment">-- XXX: EOption is an ugly and inefficient solution to this problem.</span><span>
</span><a name="line-1124"></a><span>
</span><a name="line-1125"></a><span class="hs-comment">-- | i1 type expected (condition scrutinee).</span><span>
</span><a name="line-1126"></a><span class="hs-identifier">i1Option</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-type">EOption</span></a><span>
</span><a name="line-1127"></a><a name="i1Option"><a href="LlvmCodeGen.CodeGen.html#i1Option"><span class="hs-identifier">i1Option</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-var">EOption</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1128"></a><span>
</span><a name="line-1129"></a><span class="hs-comment">-- | Word type expected (usual).</span><span>
</span><a name="line-1130"></a><span class="hs-identifier">wordOption</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-type">EOption</span></a><span>
</span><a name="line-1131"></a><a name="wordOption"><a href="LlvmCodeGen.CodeGen.html#wordOption"><span class="hs-identifier">wordOption</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-var">EOption</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><span class="hs-comment">-- | Convert a CmmExpr to a list of LlvmStatements with the result of the</span><span>
</span><a name="line-1134"></a><span class="hs-comment">-- expression being stored in the returned LlvmVar.</span><span>
</span><a name="line-1135"></a><span class="hs-identifier">exprToVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1136"></a><a name="exprToVar"><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier">exprToVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarOpt"><span class="hs-identifier hs-var">exprToVarOpt</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#wordOption"><span class="hs-identifier hs-var">wordOption</span></a><span>
</span><a name="line-1137"></a><span>
</span><a name="line-1138"></a><span class="hs-identifier">exprToVarOpt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-type">EOption</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1139"></a><a name="exprToVarOpt"><a href="LlvmCodeGen.CodeGen.html#exprToVarOpt"><span class="hs-identifier">exprToVarOpt</span></a></a><span> </span><a name="local-6989586621680819069"><a href="#local-6989586621680819069"><span class="hs-identifier">opt</span></a></a><span> </span><a name="local-6989586621680819070"><a href="#local-6989586621680819070"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819070"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1140"></a><span>
</span><a name="line-1141"></a><span>    </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621680819071"><a href="#local-6989586621680819071"><span class="hs-identifier">lit</span></a></a><span>
</span><a name="line-1142"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLit"><span class="hs-identifier hs-var">genLit</span></a><span> </span><a href="#local-6989586621680819069"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="#local-6989586621680819071"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1143"></a><span>
</span><a name="line-1144"></a><span>    </span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621680819072"><a href="#local-6989586621680819072"><span class="hs-identifier">e'</span></a></a><span> </span><a name="local-6989586621680819073"><a href="#local-6989586621680819073"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1145"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoad"><span class="hs-identifier hs-var">genLoad</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621680819072"><span class="hs-identifier hs-var">e'</span></a><span> </span><a href="#local-6989586621680819073"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1146"></a><span>
</span><a name="line-1147"></a><span>    </span><span class="hs-comment">-- Cmmreg in expression is the value, so must load. If you want actual</span><span>
</span><a name="line-1148"></a><span>    </span><span class="hs-comment">-- reg pointer, call getCmmReg directly.</span><span>
</span><a name="line-1149"></a><span>    </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><a name="local-6989586621680819074"><a href="#local-6989586621680819074"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1150"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680819075"><a href="#local-6989586621680819075"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819076"><a href="#local-6989586621680819076"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819077"><a href="#local-6989586621680819077"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegVal"><span class="hs-identifier hs-var">getCmmRegVal</span></a><span> </span><a href="#local-6989586621680819074"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1151"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680819076"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1152"></a><span>             </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1153"></a><span>                 </span><span class="hs-comment">-- Cmm wants the value, so pointer types must be cast to ints</span><span>
</span><a name="line-1154"></a><span>                 </span><a name="local-6989586621680819078"><a href="#local-6989586621680819078"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1155"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621680819079"><a href="#local-6989586621680819079"><span class="hs-identifier">v2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819080"><a href="#local-6989586621680819080"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819078"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Ptrtoint"><span class="hs-identifier hs-var">LM_Ptrtoint</span></a><span> </span><a href="#local-6989586621680819075"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819078"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1156"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819079"><span class="hs-identifier hs-var">v2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819077"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819080"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1157"></a><span>
</span><a name="line-1158"></a><span>             </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819075"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819077"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1159"></a><span>
</span><a name="line-1160"></a><span>    </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621680819081"><a href="#local-6989586621680819081"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621680819082"><a href="#local-6989586621680819082"><span class="hs-identifier">exprs</span></a></a><span>
</span><a name="line-1161"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genMachOp"><span class="hs-identifier hs-var">genMachOp</span></a><span> </span><a href="#local-6989586621680819069"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="#local-6989586621680819081"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680819082"><span class="hs-identifier hs-var">exprs</span></a><span>
</span><a name="line-1162"></a><span>
</span><a name="line-1163"></a><span>    </span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><a name="local-6989586621680819083"><a href="#local-6989586621680819083"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621680819084"><a href="#local-6989586621680819084"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-1164"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680819085"><a href="#local-6989586621680819085"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1165"></a><span>              </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#expandCmmReg"><span class="hs-identifier hs-var">expandCmmReg</span></a><span> </span><a href="#local-6989586621680819085"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819083"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819084"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-1166"></a><span>
</span><a name="line-1167"></a><span>    </span><a href="CmmExpr.html#CmmStackSlot"><span class="hs-identifier hs-var">CmmStackSlot</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1168"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprToVar: CmmStackSlot not supported!&quot;</span><span>
</span><a name="line-1169"></a><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span class="hs-comment">-- | Handle CmmMachOp expressions</span><span>
</span><a name="line-1172"></a><span class="hs-identifier">genMachOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-type">EOption</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmMachOp.html#MachOp"><span class="hs-identifier hs-type">MachOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1173"></a><span>
</span><a name="line-1174"></a><span class="hs-comment">-- Unary Machop</span><span>
</span><a name="line-1175"></a><a name="genMachOp"><a href="LlvmCodeGen.CodeGen.html#genMachOp"><span class="hs-identifier">genMachOp</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680819086"><a href="#local-6989586621680819086"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621680819087"><a href="#local-6989586621680819087"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819086"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1176"></a><span>
</span><a name="line-1177"></a><span>    </span><a href="CmmMachOp.html#MO_Not"><span class="hs-identifier hs-var">MO_Not</span></a><span> </span><a name="local-6989586621680819136"><a href="#local-6989586621680819136"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1178"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819137"><a href="#local-6989586621680819137"><span class="hs-identifier">all1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819136"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1179"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621680819088"><span class="hs-identifier hs-var">negate</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819136"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819137"><span class="hs-identifier hs-var">all1</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Xor"><span class="hs-identifier hs-var">LM_MO_Xor</span></a><span>
</span><a name="line-1180"></a><span>
</span><a name="line-1181"></a><span>    </span><a href="CmmMachOp.html#MO_S_Neg"><span class="hs-identifier hs-var">MO_S_Neg</span></a><span> </span><a name="local-6989586621680819138"><a href="#local-6989586621680819138"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1182"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819139"><a href="#local-6989586621680819139"><span class="hs-identifier">all0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819138"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1183"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621680819088"><span class="hs-identifier hs-var">negate</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819138"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819139"><span class="hs-identifier hs-var">all0</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Sub"><span class="hs-identifier hs-var">LM_MO_Sub</span></a><span>
</span><a name="line-1184"></a><span>
</span><a name="line-1185"></a><span>    </span><a href="CmmMachOp.html#MO_F_Neg"><span class="hs-identifier hs-var">MO_F_Neg</span></a><span> </span><a name="local-6989586621680819140"><a href="#local-6989586621680819140"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1186"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819141"><a href="#local-6989586621680819141"><span class="hs-identifier">all0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMFloatLit"><span class="hs-identifier hs-var">LMFloatLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819140"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1187"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621680819088"><span class="hs-identifier hs-var">negate</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819140"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819141"><span class="hs-identifier hs-var">all0</span></a><span> </span><a href="Llvm.Types.html#LM_MO_FSub"><span class="hs-identifier hs-var">LM_MO_FSub</span></a><span>
</span><a name="line-1188"></a><span>
</span><a name="line-1189"></a><span>    </span><a href="CmmMachOp.html#MO_SF_Conv"><span class="hs-identifier hs-var">MO_SF_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680819142"><a href="#local-6989586621680819142"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819090"><span class="hs-identifier hs-var">fiConv</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819142"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_Sitofp"><span class="hs-identifier hs-var">LM_Sitofp</span></a><span>
</span><a name="line-1190"></a><span>    </span><a href="CmmMachOp.html#MO_FS_Conv"><span class="hs-identifier hs-var">MO_FS_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680819143"><a href="#local-6989586621680819143"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819090"><span class="hs-identifier hs-var">fiConv</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819143"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_Fptosi"><span class="hs-identifier hs-var">LM_Fptosi</span></a><span>
</span><a name="line-1191"></a><span>
</span><a name="line-1192"></a><span>    </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><a name="local-6989586621680819144"><a href="#local-6989586621680819144"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621680819145"><a href="#local-6989586621680819145"><span class="hs-identifier">to</span></a></a><span>
</span><a name="line-1193"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819091"><span class="hs-identifier hs-var">sameConv</span></a><span> </span><a href="#local-6989586621680819144"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819145"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="Llvm.Types.html#LM_Sext"><span class="hs-identifier hs-var">LM_Sext</span></a><span>
</span><a name="line-1194"></a><span>
</span><a name="line-1195"></a><span>    </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><a name="local-6989586621680819146"><a href="#local-6989586621680819146"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621680819147"><a href="#local-6989586621680819147"><span class="hs-identifier">to</span></a></a><span>
</span><a name="line-1196"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819091"><span class="hs-identifier hs-var">sameConv</span></a><span> </span><a href="#local-6989586621680819146"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819147"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="Llvm.Types.html#LM_Zext"><span class="hs-identifier hs-var">LM_Zext</span></a><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span>    </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><a name="local-6989586621680819148"><a href="#local-6989586621680819148"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621680819149"><a href="#local-6989586621680819149"><span class="hs-identifier">to</span></a></a><span>
</span><a name="line-1199"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819091"><span class="hs-identifier hs-var">sameConv</span></a><span> </span><a href="#local-6989586621680819148"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819149"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="Llvm.Types.html#LM_Zext"><span class="hs-identifier hs-var">LM_Zext</span></a><span>
</span><a name="line-1200"></a><span>
</span><a name="line-1201"></a><span>    </span><a href="CmmMachOp.html#MO_FF_Conv"><span class="hs-identifier hs-var">MO_FF_Conv</span></a><span> </span><a name="local-6989586621680819150"><a href="#local-6989586621680819150"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621680819151"><a href="#local-6989586621680819151"><span class="hs-identifier">to</span></a></a><span>
</span><a name="line-1202"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819091"><span class="hs-identifier hs-var">sameConv</span></a><span> </span><a href="#local-6989586621680819150"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819151"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_Fptrunc"><span class="hs-identifier hs-var">LM_Fptrunc</span></a><span> </span><a href="Llvm.Types.html#LM_Fpext"><span class="hs-identifier hs-var">LM_Fpext</span></a><span>
</span><a name="line-1203"></a><span>
</span><a name="line-1204"></a><span>    </span><a href="CmmMachOp.html#MO_VS_Neg"><span class="hs-identifier hs-var">MO_VS_Neg</span></a><span> </span><a name="local-6989586621680819152"><a href="#local-6989586621680819152"><span class="hs-identifier">len</span></a></a><span> </span><a name="local-6989586621680819153"><a href="#local-6989586621680819153"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1205"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819154"><a href="#local-6989586621680819154"><span class="hs-identifier">ty</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819153"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1206"></a><span>            </span><a name="local-6989586621680819155"><a href="#local-6989586621680819155"><span class="hs-identifier">vecty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819152"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621680819154"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1207"></a><span>            </span><a name="local-6989586621680819156"><a href="#local-6989586621680819156"><span class="hs-identifier">all0</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMIntLit"><span class="hs-identifier hs-var">LMIntLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819154"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1208"></a><span>            </span><a name="local-6989586621680819157"><a href="#local-6989586621680819157"><span class="hs-identifier">all0s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMVectorLit"><span class="hs-identifier hs-var">LMVectorLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621680819152"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621680819156"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621680819089"><span class="hs-identifier hs-var">negateVec</span></a><span> </span><a href="#local-6989586621680819155"><span class="hs-identifier hs-var">vecty</span></a><span> </span><a href="#local-6989586621680819157"><span class="hs-identifier hs-var">all0s</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Sub"><span class="hs-identifier hs-var">LM_MO_Sub</span></a><span>
</span><a name="line-1210"></a><span>
</span><a name="line-1211"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Neg"><span class="hs-identifier hs-var">MO_VF_Neg</span></a><span> </span><a name="local-6989586621680819158"><a href="#local-6989586621680819158"><span class="hs-identifier">len</span></a></a><span> </span><a name="local-6989586621680819159"><a href="#local-6989586621680819159"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1212"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819160"><a href="#local-6989586621680819160"><span class="hs-identifier">ty</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819159"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1213"></a><span>            </span><a name="local-6989586621680819161"><a href="#local-6989586621680819161"><span class="hs-identifier">vecty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819158"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621680819160"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1214"></a><span>            </span><a name="local-6989586621680819162"><a href="#local-6989586621680819162"><span class="hs-identifier">all0</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMFloatLit"><span class="hs-identifier hs-var">LMFloatLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819160"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1215"></a><span>            </span><a name="local-6989586621680819163"><a href="#local-6989586621680819163"><span class="hs-identifier">all0s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMVectorLit"><span class="hs-identifier hs-var">LMVectorLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621680819158"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621680819162"><span class="hs-identifier hs-var">all0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1216"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621680819089"><span class="hs-identifier hs-var">negateVec</span></a><span> </span><a href="#local-6989586621680819161"><span class="hs-identifier hs-var">vecty</span></a><span> </span><a href="#local-6989586621680819163"><span class="hs-identifier hs-var">all0s</span></a><span> </span><a href="Llvm.Types.html#LM_MO_FSub"><span class="hs-identifier hs-var">LM_MO_FSub</span></a><span>
</span><a name="line-1217"></a><span>
</span><a name="line-1218"></a><span>    </span><a href="CmmMachOp.html#MO_AlignmentCheck"><span class="hs-identifier hs-var">MO_AlignmentCheck</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;-falignment-sanitisation is not supported by -fllvm&quot;</span><span>
</span><a name="line-1219"></a><span>
</span><a name="line-1220"></a><span>    </span><span class="hs-comment">-- Handle unsupported cases explicitly so we get a warning</span><span>
</span><a name="line-1221"></a><span>    </span><span class="hs-comment">-- of missing case when new MachOps added</span><span>
</span><a name="line-1222"></a><span>    </span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1223"></a><span>    </span><a href="CmmMachOp.html#MO_Mul"><span class="hs-identifier hs-var">MO_Mul</span></a><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1224"></a><span>    </span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1225"></a><span>    </span><a href="CmmMachOp.html#MO_S_MulMayOflo"><span class="hs-identifier hs-var">MO_S_MulMayOflo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1226"></a><span>    </span><a href="CmmMachOp.html#MO_S_Quot"><span class="hs-identifier hs-var">MO_S_Quot</span></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1227"></a><span>    </span><a href="CmmMachOp.html#MO_S_Rem"><span class="hs-identifier hs-var">MO_S_Rem</span></a><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1228"></a><span>    </span><a href="CmmMachOp.html#MO_U_MulMayOflo"><span class="hs-identifier hs-var">MO_U_MulMayOflo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1229"></a><span>    </span><a href="CmmMachOp.html#MO_U_Quot"><span class="hs-identifier hs-var">MO_U_Quot</span></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1230"></a><span>    </span><a href="CmmMachOp.html#MO_U_Rem"><span class="hs-identifier hs-var">MO_U_Rem</span></a><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1231"></a><span>
</span><a name="line-1232"></a><span>    </span><a href="CmmMachOp.html#MO_Eq"><span class="hs-identifier hs-var">MO_Eq</span></a><span>  </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1233"></a><span>    </span><a href="CmmMachOp.html#MO_Ne"><span class="hs-identifier hs-var">MO_Ne</span></a><span>  </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1234"></a><span>    </span><a href="CmmMachOp.html#MO_S_Ge"><span class="hs-identifier hs-var">MO_S_Ge</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1235"></a><span>    </span><a href="CmmMachOp.html#MO_S_Gt"><span class="hs-identifier hs-var">MO_S_Gt</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1236"></a><span>    </span><a href="CmmMachOp.html#MO_S_Le"><span class="hs-identifier hs-var">MO_S_Le</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1237"></a><span>    </span><a href="CmmMachOp.html#MO_S_Lt"><span class="hs-identifier hs-var">MO_S_Lt</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1238"></a><span>    </span><a href="CmmMachOp.html#MO_U_Ge"><span class="hs-identifier hs-var">MO_U_Ge</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1239"></a><span>    </span><a href="CmmMachOp.html#MO_U_Gt"><span class="hs-identifier hs-var">MO_U_Gt</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1240"></a><span>    </span><a href="CmmMachOp.html#MO_U_Le"><span class="hs-identifier hs-var">MO_U_Le</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1241"></a><span>    </span><a href="CmmMachOp.html#MO_U_Lt"><span class="hs-identifier hs-var">MO_U_Lt</span></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1242"></a><span>
</span><a name="line-1243"></a><span>    </span><a href="CmmMachOp.html#MO_F_Add"><span class="hs-identifier hs-var">MO_F_Add</span></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1244"></a><span>    </span><a href="CmmMachOp.html#MO_F_Sub"><span class="hs-identifier hs-var">MO_F_Sub</span></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1245"></a><span>    </span><a href="CmmMachOp.html#MO_F_Mul"><span class="hs-identifier hs-var">MO_F_Mul</span></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1246"></a><span>    </span><a href="CmmMachOp.html#MO_F_Quot"><span class="hs-identifier hs-var">MO_F_Quot</span></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1247"></a><span>    </span><a href="CmmMachOp.html#MO_F_Eq"><span class="hs-identifier hs-var">MO_F_Eq</span></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1248"></a><span>    </span><a href="CmmMachOp.html#MO_F_Ne"><span class="hs-identifier hs-var">MO_F_Ne</span></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1249"></a><span>    </span><a href="CmmMachOp.html#MO_F_Ge"><span class="hs-identifier hs-var">MO_F_Ge</span></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1250"></a><span>    </span><a href="CmmMachOp.html#MO_F_Gt"><span class="hs-identifier hs-var">MO_F_Gt</span></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1251"></a><span>    </span><a href="CmmMachOp.html#MO_F_Le"><span class="hs-identifier hs-var">MO_F_Le</span></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1252"></a><span>    </span><a href="CmmMachOp.html#MO_F_Lt"><span class="hs-identifier hs-var">MO_F_Lt</span></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1253"></a><span>
</span><a name="line-1254"></a><span>    </span><a href="CmmMachOp.html#MO_And"><span class="hs-identifier hs-var">MO_And</span></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1255"></a><span>    </span><a href="CmmMachOp.html#MO_Or"><span class="hs-identifier hs-var">MO_Or</span></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1256"></a><span>    </span><a href="CmmMachOp.html#MO_Xor"><span class="hs-identifier hs-var">MO_Xor</span></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1257"></a><span>    </span><a href="CmmMachOp.html#MO_Shl"><span class="hs-identifier hs-var">MO_Shl</span></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1258"></a><span>    </span><a href="CmmMachOp.html#MO_U_Shr"><span class="hs-identifier hs-var">MO_U_Shr</span></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1259"></a><span>    </span><a href="CmmMachOp.html#MO_S_Shr"><span class="hs-identifier hs-var">MO_S_Shr</span></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1260"></a><span>
</span><a name="line-1261"></a><span>    </span><a href="CmmMachOp.html#MO_V_Insert"><span class="hs-identifier hs-var">MO_V_Insert</span></a><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1262"></a><span>    </span><a href="CmmMachOp.html#MO_V_Extract"><span class="hs-identifier hs-var">MO_V_Extract</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1263"></a><span>
</span><a name="line-1264"></a><span>    </span><a href="CmmMachOp.html#MO_V_Add"><span class="hs-identifier hs-var">MO_V_Add</span></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1265"></a><span>    </span><a href="CmmMachOp.html#MO_V_Sub"><span class="hs-identifier hs-var">MO_V_Sub</span></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1266"></a><span>    </span><a href="CmmMachOp.html#MO_V_Mul"><span class="hs-identifier hs-var">MO_V_Mul</span></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1267"></a><span>
</span><a name="line-1268"></a><span>    </span><a href="CmmMachOp.html#MO_VS_Quot"><span class="hs-identifier hs-var">MO_VS_Quot</span></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1269"></a><span>    </span><a href="CmmMachOp.html#MO_VS_Rem"><span class="hs-identifier hs-var">MO_VS_Rem</span></a><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1270"></a><span>
</span><a name="line-1271"></a><span>    </span><a href="CmmMachOp.html#MO_VU_Quot"><span class="hs-identifier hs-var">MO_VU_Quot</span></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1272"></a><span>    </span><a href="CmmMachOp.html#MO_VU_Rem"><span class="hs-identifier hs-var">MO_VU_Rem</span></a><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1273"></a><span>
</span><a name="line-1274"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Insert"><span class="hs-identifier hs-var">MO_VF_Insert</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1275"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Extract"><span class="hs-identifier hs-var">MO_VF_Extract</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1276"></a><span>
</span><a name="line-1277"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Add"><span class="hs-identifier hs-var">MO_VF_Add</span></a><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1278"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Sub"><span class="hs-identifier hs-var">MO_VF_Sub</span></a><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1279"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Mul"><span class="hs-identifier hs-var">MO_VF_Mul</span></a><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1280"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Quot"><span class="hs-identifier hs-var">MO_VF_Quot</span></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819092"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1281"></a><span>
</span><a name="line-1282"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1283"></a><span>        </span><a name="local-6989586621680819088"><a href="#local-6989586621680819088"><span class="hs-identifier">negate</span></a></a><span> </span><a name="local-6989586621680819093"><a href="#local-6989586621680819093"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819094"><a href="#local-6989586621680819094"><span class="hs-identifier">v2</span></a></a><span> </span><a name="local-6989586621680819095"><a href="#local-6989586621680819095"><span class="hs-identifier">negOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1284"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819096"><a href="#local-6989586621680819096"><span class="hs-identifier">vx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819097"><a href="#local-6989586621680819097"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819098"><a href="#local-6989586621680819098"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680819087"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1285"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819099"><a href="#local-6989586621680819099"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819100"><a href="#local-6989586621680819100"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819093"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="#local-6989586621680819095"><span class="hs-identifier hs-var">negOp</span></a><span> </span><a href="#local-6989586621680819094"><span class="hs-identifier hs-var">v2</span></a><span> </span><a href="#local-6989586621680819096"><span class="hs-identifier hs-var">vx</span></a><span>
</span><a name="line-1286"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819099"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819097"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819100"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819098"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-1287"></a><span>
</span><a name="line-1288"></a><span>        </span><a name="local-6989586621680819089"><a href="#local-6989586621680819089"><span class="hs-identifier">negateVec</span></a></a><span> </span><a name="local-6989586621680819101"><a href="#local-6989586621680819101"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819102"><a href="#local-6989586621680819102"><span class="hs-identifier">v2</span></a></a><span> </span><a name="local-6989586621680819103"><a href="#local-6989586621680819103"><span class="hs-identifier">negOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1289"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819104"><a href="#local-6989586621680819104"><span class="hs-identifier">vx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819105"><a href="#local-6989586621680819105"><span class="hs-identifier">stmts1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819106"><a href="#local-6989586621680819106"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680819087"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1290"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819107"><a href="#local-6989586621680819107"><span class="hs-identifier">vxs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819108"><a href="#local-6989586621680819108"><span class="hs-identifier">stmts2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVars"><span class="hs-identifier hs-var">castVars</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680819104"><span class="hs-identifier hs-var">vx</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819101"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1291"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819109"><a href="#local-6989586621680819109"><span class="hs-identifier">vx'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#singletonPanic"><span class="hs-identifier hs-var">singletonPanic</span></a><span> </span><span class="hs-string">&quot;genMachOp: negateVec&quot;</span><span> </span><a href="#local-6989586621680819107"><span class="hs-identifier hs-var">vxs'</span></a><span>
</span><a name="line-1292"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819110"><a href="#local-6989586621680819110"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819111"><a href="#local-6989586621680819111"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819101"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="#local-6989586621680819103"><span class="hs-identifier hs-var">negOp</span></a><span> </span><a href="#local-6989586621680819102"><span class="hs-identifier hs-var">v2</span></a><span> </span><a href="#local-6989586621680819109"><span class="hs-identifier hs-var">vx'</span></a><span>
</span><a name="line-1293"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819110"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819105"><span class="hs-identifier hs-var">stmts1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819108"><span class="hs-identifier hs-var">stmts2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819111"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819106"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-1294"></a><span>
</span><a name="line-1295"></a><span>        </span><a name="local-6989586621680819090"><a href="#local-6989586621680819090"><span class="hs-identifier">fiConv</span></a></a><span> </span><a name="local-6989586621680819112"><a href="#local-6989586621680819112"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819113"><a href="#local-6989586621680819113"><span class="hs-identifier">convOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1296"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819114"><a href="#local-6989586621680819114"><span class="hs-identifier">vx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819115"><a href="#local-6989586621680819115"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819116"><a href="#local-6989586621680819116"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680819087"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1297"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819117"><a href="#local-6989586621680819117"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819118"><a href="#local-6989586621680819118"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819112"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="#local-6989586621680819113"><span class="hs-identifier hs-var">convOp</span></a><span> </span><a href="#local-6989586621680819114"><span class="hs-identifier hs-var">vx</span></a><span> </span><a href="#local-6989586621680819112"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1298"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819117"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819115"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819118"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819116"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-1299"></a><span>
</span><a name="line-1300"></a><span>        </span><a name="local-6989586621680819091"><a href="#local-6989586621680819091"><span class="hs-identifier">sameConv</span></a></a><span> </span><a name="local-6989586621680819119"><a href="#local-6989586621680819119"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621680819120"><a href="#local-6989586621680819120"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819121"><a href="#local-6989586621680819121"><span class="hs-identifier">reduce</span></a></a><span> </span><a name="local-6989586621680819122"><a href="#local-6989586621680819122"><span class="hs-identifier">expand</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1301"></a><span>            </span><a name="local-6989586621680819123"><a href="#local-6989586621680819123"><span class="hs-identifier">x'</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680819124"><a href="#local-6989586621680819124"><span class="hs-identifier">vx</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819125"><a href="#local-6989586621680819125"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819126"><a href="#local-6989586621680819126"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span> </span><a href="#local-6989586621680819087"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1302"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819127"><a href="#local-6989586621680819127"><span class="hs-identifier">sameConv'</span></a></a><span> </span><a name="local-6989586621680819128"><a href="#local-6989586621680819128"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1303"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621680819129"><a href="#local-6989586621680819129"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819130"><a href="#local-6989586621680819130"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819120"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="#local-6989586621680819128"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680819124"><span class="hs-identifier hs-var">vx</span></a><span> </span><a href="#local-6989586621680819120"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1304"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819129"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819125"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819130"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819126"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-1305"></a><span>            </span><a name="local-6989586621680819131"><a href="#local-6989586621680819131"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1306"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819132"><a href="#local-6989586621680819132"><span class="hs-identifier">toWidth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819131"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819120"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1307"></a><span>            </span><span class="hs-comment">-- LLVM doesn't like trying to convert to same width, so</span><span>
</span><a name="line-1308"></a><span>            </span><span class="hs-comment">-- need to check for that as we do get Cmm code doing it.</span><span>
</span><a name="line-1309"></a><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621680819119"><span class="hs-identifier hs-var">from</span></a><span>  </span><span class="hs-keyword">of</span><span>
</span><a name="line-1310"></a><span>                 </span><a name="local-6989586621680819133"><a href="#local-6989586621680819133"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680819133"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621680819132"><span class="hs-identifier hs-var">toWidth</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819127"><span class="hs-identifier hs-var">sameConv'</span></a><span> </span><a href="#local-6989586621680819122"><span class="hs-identifier hs-var">expand</span></a><span>
</span><a name="line-1311"></a><span>                 </span><a name="local-6989586621680819134"><a href="#local-6989586621680819134"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680819134"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621680819132"><span class="hs-identifier hs-var">toWidth</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819127"><span class="hs-identifier hs-var">sameConv'</span></a><span> </span><a href="#local-6989586621680819121"><span class="hs-identifier hs-var">reduce</span></a><span>
</span><a name="line-1312"></a><span>                 </span><a name="local-6989586621680819135"><a href="#local-6989586621680819135"><span class="hs-identifier">_w</span></a></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680819123"><span class="hs-identifier hs-var">x'</span></a><span>
</span><a name="line-1313"></a><span>
</span><a name="line-1314"></a><span>        </span><a name="local-6989586621680819092"><a href="#local-6989586621680819092"><span class="hs-identifier">panicOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;LLVM.CodeGen.genMachOp: non unary op encountered&quot;</span><span>
</span><a name="line-1315"></a><span>                       </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;with one argument! (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680819086"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-1316"></a><span>
</span><a name="line-1317"></a><span class="hs-comment">-- Handle GlobalRegs pointers</span><span>
</span><a name="line-1318"></a><span class="hs-identifier">genMachOp</span><span> </span><a name="local-6989586621680819164"><a href="#local-6989586621680819164"><span class="hs-identifier">opt</span></a></a><span> </span><a name="local-6989586621680819165"><a href="#local-6989586621680819165"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680819166"><a href="#local-6989586621680819166"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819167"><a href="#local-6989586621680819167"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621680819168"><a href="#local-6989586621680819168"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1319"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genMachOp_fast"><span class="hs-identifier hs-var">genMachOp_fast</span></a><span> </span><a href="#local-6989586621680819164"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="#local-6989586621680819165"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621680819167"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680819168"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819166"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1320"></a><span>
</span><a name="line-1321"></a><span class="hs-identifier">genMachOp</span><span> </span><a name="local-6989586621680819169"><a href="#local-6989586621680819169"><span class="hs-identifier">opt</span></a></a><span> </span><a name="local-6989586621680819170"><a href="#local-6989586621680819170"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680819171"><a href="#local-6989586621680819171"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819172"><a href="#local-6989586621680819172"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621680819173"><a href="#local-6989586621680819173"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1322"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genMachOp_fast"><span class="hs-identifier hs-var">genMachOp_fast</span></a><span> </span><a href="#local-6989586621680819169"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="#local-6989586621680819170"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621680819172"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819173"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819171"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1323"></a><span>
</span><a name="line-1324"></a><span class="hs-comment">-- Generic case</span><span>
</span><a name="line-1325"></a><span class="hs-identifier">genMachOp</span><span> </span><a name="local-6989586621680819174"><a href="#local-6989586621680819174"><span class="hs-identifier">opt</span></a></a><span> </span><a name="local-6989586621680819175"><a href="#local-6989586621680819175"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621680819176"><a href="#local-6989586621680819176"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genMachOp_slow"><span class="hs-identifier hs-var">genMachOp_slow</span></a><span> </span><a href="#local-6989586621680819174"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="#local-6989586621680819175"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680819176"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1326"></a><span>
</span><a name="line-1327"></a><span>
</span><a name="line-1328"></a><span class="hs-comment">-- | Handle CmmMachOp expressions</span><span>
</span><a name="line-1329"></a><span class="hs-comment">-- This is a specialised method that handles Global register manipulations like</span><span>
</span><a name="line-1330"></a><span class="hs-comment">-- 'Sp - 16', using the getelementptr instruction.</span><span>
</span><a name="line-1331"></a><span class="hs-identifier">genMachOp_fast</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-type">EOption</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmMachOp.html#MachOp"><span class="hs-identifier hs-type">MachOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">]</span><span>
</span><a name="line-1332"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1333"></a><a name="genMachOp_fast"><a href="LlvmCodeGen.CodeGen.html#genMachOp_fast"><span class="hs-identifier">genMachOp_fast</span></a></a><span> </span><a name="local-6989586621680819177"><a href="#local-6989586621680819177"><span class="hs-identifier">opt</span></a></a><span> </span><a name="local-6989586621680819178"><a href="#local-6989586621680819178"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621680819179"><a href="#local-6989586621680819179"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621680819180"><a href="#local-6989586621680819180"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680819181"><a href="#local-6989586621680819181"><span class="hs-identifier">e</span></a></a><span>
</span><a name="line-1334"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680819182"><a href="#local-6989586621680819182"><span class="hs-identifier">gv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819183"><a href="#local-6989586621680819183"><span class="hs-identifier">grt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819184"><a href="#local-6989586621680819184"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegVal"><span class="hs-identifier hs-var">getCmmRegVal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="#local-6989586621680819179"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1335"></a><span>       </span><a name="local-6989586621680819185"><a href="#local-6989586621680819185"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1336"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680819186"><a href="#local-6989586621680819186"><span class="hs-identifier">ix</span></a></a><span class="hs-special">,</span><a name="local-6989586621680819187"><a href="#local-6989586621680819187"><span class="hs-identifier">rem</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819180"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819185"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819183"><span class="hs-identifier hs-var">grt</span></a><span>  </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-1337"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680819183"><span class="hs-identifier hs-var">grt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680819187"><span class="hs-identifier hs-var">rem</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1338"></a><span>            </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1339"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621680819188"><a href="#local-6989586621680819188"><span class="hs-identifier">ptr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819189"><a href="#local-6989586621680819189"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819183"><span class="hs-identifier hs-var">grt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#GetElemPtr"><span class="hs-identifier hs-var">GetElemPtr</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621680819182"><span class="hs-identifier hs-var">gv</span></a><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.CodeGen.html#toI32"><span class="hs-identifier hs-var">toI32</span></a><span> </span><a href="#local-6989586621680819186"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">]</span><span>
</span><a name="line-1340"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621680819190"><a href="#local-6989586621680819190"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819191"><a href="#local-6989586621680819191"><span class="hs-identifier">s3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819185"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Ptrtoint"><span class="hs-identifier hs-var">LM_Ptrtoint</span></a><span> </span><a href="#local-6989586621680819188"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819185"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1341"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819190"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819184"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819189"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819191"><span class="hs-identifier hs-var">s3</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1342"></a><span>
</span><a name="line-1343"></a><span>            </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genMachOp_slow"><span class="hs-identifier hs-var">genMachOp_slow</span></a><span> </span><a href="#local-6989586621680819177"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="#local-6989586621680819178"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621680819181"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1344"></a><span>
</span><a name="line-1345"></a><span>
</span><a name="line-1346"></a><span class="hs-comment">-- | Handle CmmMachOp expressions</span><span>
</span><a name="line-1347"></a><span class="hs-comment">-- This handles all the cases not handle by the specialised genMachOp_fast.</span><span>
</span><a name="line-1348"></a><span class="hs-identifier">genMachOp_slow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-type">EOption</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmMachOp.html#MachOp"><span class="hs-identifier hs-type">MachOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span class="hs-comment">-- Element extraction</span><span>
</span><a name="line-1351"></a><a name="genMachOp_slow"><a href="LlvmCodeGen.CodeGen.html#genMachOp_slow"><span class="hs-identifier">genMachOp_slow</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_V_Extract"><span class="hs-identifier hs-var">MO_V_Extract</span></a><span> </span><a name="local-6989586621680819192"><a href="#local-6989586621680819192"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819193"><a href="#local-6989586621680819193"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680819194"><a href="#local-6989586621680819194"><span class="hs-identifier">val</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819195"><a href="#local-6989586621680819195"><span class="hs-identifier">idx</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier hs-var">runExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1352"></a><span>    </span><a name="local-6989586621680819197"><a href="#local-6989586621680819197"><span class="hs-identifier">vval</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819194"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-1353"></a><span>    </span><a name="local-6989586621680819198"><a href="#local-6989586621680819198"><span class="hs-identifier">vidx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819195"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-1354"></a><span>    </span><a name="local-6989586621680819199"><a href="#local-6989586621680819199"><span class="hs-identifier">vval'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#singletonPanic"><span class="hs-identifier hs-var">singletonPanic</span></a><span> </span><span class="hs-string">&quot;genMachOp_slow&quot;</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1355"></a><span>             </span><a href="LlvmCodeGen.CodeGen.html#castVarsW"><span class="hs-identifier hs-var">castVarsW</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680819197"><span class="hs-identifier hs-var">vval</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819192"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621680819196"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1356"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819196"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Extract"><span class="hs-identifier hs-var">Extract</span></a><span> </span><a href="#local-6989586621680819199"><span class="hs-identifier hs-var">vval'</span></a><span> </span><a href="#local-6989586621680819198"><span class="hs-identifier hs-var">vidx</span></a><span>
</span><a name="line-1357"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1358"></a><span>    </span><a name="local-6989586621680819196"><a href="#local-6989586621680819196"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819193"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1359"></a><span>
</span><a name="line-1360"></a><span class="hs-identifier">genMachOp_slow</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Extract"><span class="hs-identifier hs-var">MO_VF_Extract</span></a><span> </span><a name="local-6989586621680819200"><a href="#local-6989586621680819200"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819201"><a href="#local-6989586621680819201"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680819202"><a href="#local-6989586621680819202"><span class="hs-identifier">val</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819203"><a href="#local-6989586621680819203"><span class="hs-identifier">idx</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier hs-var">runExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1361"></a><span>    </span><a name="local-6989586621680819205"><a href="#local-6989586621680819205"><span class="hs-identifier">vval</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819202"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-1362"></a><span>    </span><a name="local-6989586621680819206"><a href="#local-6989586621680819206"><span class="hs-identifier">vidx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819203"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-1363"></a><span>    </span><a name="local-6989586621680819207"><a href="#local-6989586621680819207"><span class="hs-identifier">vval'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#singletonPanic"><span class="hs-identifier hs-var">singletonPanic</span></a><span> </span><span class="hs-string">&quot;genMachOp_slow&quot;</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1364"></a><span>             </span><a href="LlvmCodeGen.CodeGen.html#castVarsW"><span class="hs-identifier hs-var">castVarsW</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680819205"><span class="hs-identifier hs-var">vval</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819200"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621680819204"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1365"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819204"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Extract"><span class="hs-identifier hs-var">Extract</span></a><span> </span><a href="#local-6989586621680819207"><span class="hs-identifier hs-var">vval'</span></a><span> </span><a href="#local-6989586621680819206"><span class="hs-identifier hs-var">vidx</span></a><span>
</span><a name="line-1366"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1367"></a><span>    </span><a name="local-6989586621680819204"><a href="#local-6989586621680819204"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819201"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1368"></a><span>
</span><a name="line-1369"></a><span class="hs-comment">-- Element insertion</span><span>
</span><a name="line-1370"></a><span class="hs-identifier">genMachOp_slow</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_V_Insert"><span class="hs-identifier hs-var">MO_V_Insert</span></a><span> </span><a name="local-6989586621680819208"><a href="#local-6989586621680819208"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819209"><a href="#local-6989586621680819209"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680819210"><a href="#local-6989586621680819210"><span class="hs-identifier">val</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819211"><a href="#local-6989586621680819211"><span class="hs-identifier">elt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819212"><a href="#local-6989586621680819212"><span class="hs-identifier">idx</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier hs-var">runExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1371"></a><span>    </span><a name="local-6989586621680819214"><a href="#local-6989586621680819214"><span class="hs-identifier">vval</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819210"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-1372"></a><span>    </span><a name="local-6989586621680819215"><a href="#local-6989586621680819215"><span class="hs-identifier">velt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819211"><span class="hs-identifier hs-var">elt</span></a><span>
</span><a name="line-1373"></a><span>    </span><a name="local-6989586621680819216"><a href="#local-6989586621680819216"><span class="hs-identifier">vidx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819212"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-1374"></a><span>    </span><a name="local-6989586621680819217"><a href="#local-6989586621680819217"><span class="hs-identifier">vval'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#singletonPanic"><span class="hs-identifier hs-var">singletonPanic</span></a><span> </span><span class="hs-string">&quot;genMachOp_slow&quot;</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1375"></a><span>             </span><a href="LlvmCodeGen.CodeGen.html#castVarsW"><span class="hs-identifier hs-var">castVarsW</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680819214"><span class="hs-identifier hs-var">vval</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819213"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1376"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819213"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Insert"><span class="hs-identifier hs-var">Insert</span></a><span> </span><a href="#local-6989586621680819217"><span class="hs-identifier hs-var">vval'</span></a><span> </span><a href="#local-6989586621680819215"><span class="hs-identifier hs-var">velt</span></a><span> </span><a href="#local-6989586621680819216"><span class="hs-identifier hs-var">vidx</span></a><span>
</span><a name="line-1377"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1378"></a><span>    </span><a name="local-6989586621680819213"><a href="#local-6989586621680819213"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819208"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819209"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><span>
</span><a name="line-1380"></a><span class="hs-identifier">genMachOp_slow</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Insert"><span class="hs-identifier hs-var">MO_VF_Insert</span></a><span> </span><a name="local-6989586621680819218"><a href="#local-6989586621680819218"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819219"><a href="#local-6989586621680819219"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680819220"><a href="#local-6989586621680819220"><span class="hs-identifier">val</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819221"><a href="#local-6989586621680819221"><span class="hs-identifier">elt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819222"><a href="#local-6989586621680819222"><span class="hs-identifier">idx</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier hs-var">runExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1381"></a><span>    </span><a name="local-6989586621680819224"><a href="#local-6989586621680819224"><span class="hs-identifier">vval</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819220"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-1382"></a><span>    </span><a name="local-6989586621680819225"><a href="#local-6989586621680819225"><span class="hs-identifier">velt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819221"><span class="hs-identifier hs-var">elt</span></a><span>
</span><a name="line-1383"></a><span>    </span><a name="local-6989586621680819226"><a href="#local-6989586621680819226"><span class="hs-identifier">vidx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819222"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-1384"></a><span>    </span><a name="local-6989586621680819227"><a href="#local-6989586621680819227"><span class="hs-identifier">vval'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#singletonPanic"><span class="hs-identifier hs-var">singletonPanic</span></a><span> </span><span class="hs-string">&quot;genMachOp_slow&quot;</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-1385"></a><span>             </span><a href="LlvmCodeGen.CodeGen.html#castVarsW"><span class="hs-identifier hs-var">castVarsW</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680819224"><span class="hs-identifier hs-var">vval</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819223"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1386"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819223"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Insert"><span class="hs-identifier hs-var">Insert</span></a><span> </span><a href="#local-6989586621680819227"><span class="hs-identifier hs-var">vval'</span></a><span> </span><a href="#local-6989586621680819225"><span class="hs-identifier hs-var">velt</span></a><span> </span><a href="#local-6989586621680819226"><span class="hs-identifier hs-var">vidx</span></a><span>
</span><a name="line-1387"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1388"></a><span>    </span><a name="local-6989586621680819223"><a href="#local-6989586621680819223"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819218"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819219"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1389"></a><span>
</span><a name="line-1390"></a><span class="hs-comment">-- Binary MachOp</span><span>
</span><a name="line-1391"></a><span class="hs-identifier">genMachOp_slow</span><span> </span><a name="local-6989586621680819228"><a href="#local-6989586621680819228"><span class="hs-identifier">opt</span></a></a><span> </span><a name="local-6989586621680819229"><a href="#local-6989586621680819229"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621680819230"><a href="#local-6989586621680819230"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819231"><a href="#local-6989586621680819231"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819229"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1392"></a><span>
</span><a name="line-1393"></a><span>    </span><a href="CmmMachOp.html#MO_Eq"><span class="hs-identifier hs-var">MO_Eq</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Eq"><span class="hs-identifier hs-var">LM_CMP_Eq</span></a><span>
</span><a name="line-1394"></a><span>    </span><a href="CmmMachOp.html#MO_Ne"><span class="hs-identifier hs-var">MO_Ne</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Ne"><span class="hs-identifier hs-var">LM_CMP_Ne</span></a><span>
</span><a name="line-1395"></a><span>
</span><a name="line-1396"></a><span>    </span><a href="CmmMachOp.html#MO_S_Gt"><span class="hs-identifier hs-var">MO_S_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Sgt"><span class="hs-identifier hs-var">LM_CMP_Sgt</span></a><span>
</span><a name="line-1397"></a><span>    </span><a href="CmmMachOp.html#MO_S_Ge"><span class="hs-identifier hs-var">MO_S_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Sge"><span class="hs-identifier hs-var">LM_CMP_Sge</span></a><span>
</span><a name="line-1398"></a><span>    </span><a href="CmmMachOp.html#MO_S_Lt"><span class="hs-identifier hs-var">MO_S_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Slt"><span class="hs-identifier hs-var">LM_CMP_Slt</span></a><span>
</span><a name="line-1399"></a><span>    </span><a href="CmmMachOp.html#MO_S_Le"><span class="hs-identifier hs-var">MO_S_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Sle"><span class="hs-identifier hs-var">LM_CMP_Sle</span></a><span>
</span><a name="line-1400"></a><span>
</span><a name="line-1401"></a><span>    </span><a href="CmmMachOp.html#MO_U_Gt"><span class="hs-identifier hs-var">MO_U_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Ugt"><span class="hs-identifier hs-var">LM_CMP_Ugt</span></a><span>
</span><a name="line-1402"></a><span>    </span><a href="CmmMachOp.html#MO_U_Ge"><span class="hs-identifier hs-var">MO_U_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Uge"><span class="hs-identifier hs-var">LM_CMP_Uge</span></a><span>
</span><a name="line-1403"></a><span>    </span><a href="CmmMachOp.html#MO_U_Lt"><span class="hs-identifier hs-var">MO_U_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Ult"><span class="hs-identifier hs-var">LM_CMP_Ult</span></a><span>
</span><a name="line-1404"></a><span>    </span><a href="CmmMachOp.html#MO_U_Le"><span class="hs-identifier hs-var">MO_U_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Ule"><span class="hs-identifier hs-var">LM_CMP_Ule</span></a><span>
</span><a name="line-1405"></a><span>
</span><a name="line-1406"></a><span>    </span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Add"><span class="hs-identifier hs-var">LM_MO_Add</span></a><span>
</span><a name="line-1407"></a><span>    </span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Sub"><span class="hs-identifier hs-var">LM_MO_Sub</span></a><span>
</span><a name="line-1408"></a><span>    </span><a href="CmmMachOp.html#MO_Mul"><span class="hs-identifier hs-var">MO_Mul</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Mul"><span class="hs-identifier hs-var">LM_MO_Mul</span></a><span>
</span><a name="line-1409"></a><span>
</span><a name="line-1410"></a><span>    </span><a href="CmmMachOp.html#MO_U_MulMayOflo"><span class="hs-identifier hs-var">MO_U_MulMayOflo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genMachOp: MO_U_MulMayOflo unsupported!&quot;</span><span>
</span><a name="line-1411"></a><span>
</span><a name="line-1412"></a><span>    </span><a href="CmmMachOp.html#MO_S_MulMayOflo"><span class="hs-identifier hs-var">MO_S_MulMayOflo</span></a><span> </span><a name="local-6989586621680819285"><a href="#local-6989586621680819285"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819237"><span class="hs-identifier hs-var">isSMulOK</span></a><span> </span><a href="#local-6989586621680819285"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621680819230"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680819231"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1413"></a><span>
</span><a name="line-1414"></a><span>    </span><a href="CmmMachOp.html#MO_S_Quot"><span class="hs-identifier hs-var">MO_S_Quot</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_SDiv"><span class="hs-identifier hs-var">LM_MO_SDiv</span></a><span>
</span><a name="line-1415"></a><span>    </span><a href="CmmMachOp.html#MO_S_Rem"><span class="hs-identifier hs-var">MO_S_Rem</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_SRem"><span class="hs-identifier hs-var">LM_MO_SRem</span></a><span>
</span><a name="line-1416"></a><span>
</span><a name="line-1417"></a><span>    </span><a href="CmmMachOp.html#MO_U_Quot"><span class="hs-identifier hs-var">MO_U_Quot</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_UDiv"><span class="hs-identifier hs-var">LM_MO_UDiv</span></a><span>
</span><a name="line-1418"></a><span>    </span><a href="CmmMachOp.html#MO_U_Rem"><span class="hs-identifier hs-var">MO_U_Rem</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_URem"><span class="hs-identifier hs-var">LM_MO_URem</span></a><span>
</span><a name="line-1419"></a><span>
</span><a name="line-1420"></a><span>    </span><a href="CmmMachOp.html#MO_F_Eq"><span class="hs-identifier hs-var">MO_F_Eq</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Feq"><span class="hs-identifier hs-var">LM_CMP_Feq</span></a><span>
</span><a name="line-1421"></a><span>    </span><a href="CmmMachOp.html#MO_F_Ne"><span class="hs-identifier hs-var">MO_F_Ne</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Fne"><span class="hs-identifier hs-var">LM_CMP_Fne</span></a><span>
</span><a name="line-1422"></a><span>    </span><a href="CmmMachOp.html#MO_F_Gt"><span class="hs-identifier hs-var">MO_F_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Fgt"><span class="hs-identifier hs-var">LM_CMP_Fgt</span></a><span>
</span><a name="line-1423"></a><span>    </span><a href="CmmMachOp.html#MO_F_Ge"><span class="hs-identifier hs-var">MO_F_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Fge"><span class="hs-identifier hs-var">LM_CMP_Fge</span></a><span>
</span><a name="line-1424"></a><span>    </span><a href="CmmMachOp.html#MO_F_Lt"><span class="hs-identifier hs-var">MO_F_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Flt"><span class="hs-identifier hs-var">LM_CMP_Flt</span></a><span>
</span><a name="line-1425"></a><span>    </span><a href="CmmMachOp.html#MO_F_Le"><span class="hs-identifier hs-var">MO_F_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819234"><span class="hs-identifier hs-var">genBinComp</span></a><span> </span><a href="#local-6989586621680819228"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="Llvm.Types.html#LM_CMP_Fle"><span class="hs-identifier hs-var">LM_CMP_Fle</span></a><span>
</span><a name="line-1426"></a><span>
</span><a name="line-1427"></a><span>    </span><a href="CmmMachOp.html#MO_F_Add"><span class="hs-identifier hs-var">MO_F_Add</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_FAdd"><span class="hs-identifier hs-var">LM_MO_FAdd</span></a><span>
</span><a name="line-1428"></a><span>    </span><a href="CmmMachOp.html#MO_F_Sub"><span class="hs-identifier hs-var">MO_F_Sub</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_FSub"><span class="hs-identifier hs-var">LM_MO_FSub</span></a><span>
</span><a name="line-1429"></a><span>    </span><a href="CmmMachOp.html#MO_F_Mul"><span class="hs-identifier hs-var">MO_F_Mul</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_FMul"><span class="hs-identifier hs-var">LM_MO_FMul</span></a><span>
</span><a name="line-1430"></a><span>    </span><a href="CmmMachOp.html#MO_F_Quot"><span class="hs-identifier hs-var">MO_F_Quot</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_FDiv"><span class="hs-identifier hs-var">LM_MO_FDiv</span></a><span>
</span><a name="line-1431"></a><span>
</span><a name="line-1432"></a><span>    </span><a href="CmmMachOp.html#MO_And"><span class="hs-identifier hs-var">MO_And</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_And"><span class="hs-identifier hs-var">LM_MO_And</span></a><span>
</span><a name="line-1433"></a><span>    </span><a href="CmmMachOp.html#MO_Or"><span class="hs-identifier hs-var">MO_Or</span></a><span>  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Or"><span class="hs-identifier hs-var">LM_MO_Or</span></a><span>
</span><a name="line-1434"></a><span>    </span><a href="CmmMachOp.html#MO_Xor"><span class="hs-identifier hs-var">MO_Xor</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Xor"><span class="hs-identifier hs-var">LM_MO_Xor</span></a><span>
</span><a name="line-1435"></a><span>    </span><a href="CmmMachOp.html#MO_Shl"><span class="hs-identifier hs-var">MO_Shl</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Shl"><span class="hs-identifier hs-var">LM_MO_Shl</span></a><span>
</span><a name="line-1436"></a><span>    </span><a href="CmmMachOp.html#MO_U_Shr"><span class="hs-identifier hs-var">MO_U_Shr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_LShr"><span class="hs-identifier hs-var">LM_MO_LShr</span></a><span>
</span><a name="line-1437"></a><span>    </span><a href="CmmMachOp.html#MO_S_Shr"><span class="hs-identifier hs-var">MO_S_Shr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819235"><span class="hs-identifier hs-var">genBinMach</span></a><span> </span><a href="Llvm.Types.html#LM_MO_AShr"><span class="hs-identifier hs-var">LM_MO_AShr</span></a><span>
</span><a name="line-1438"></a><span>
</span><a name="line-1439"></a><span>    </span><a href="CmmMachOp.html#MO_V_Add"><span class="hs-identifier hs-var">MO_V_Add</span></a><span> </span><a name="local-6989586621680819286"><a href="#local-6989586621680819286"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819287"><a href="#local-6989586621680819287"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819286"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819287"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_Add"><span class="hs-identifier hs-var">LM_MO_Add</span></a><span>
</span><a name="line-1440"></a><span>    </span><a href="CmmMachOp.html#MO_V_Sub"><span class="hs-identifier hs-var">MO_V_Sub</span></a><span> </span><a name="local-6989586621680819288"><a href="#local-6989586621680819288"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819289"><a href="#local-6989586621680819289"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819288"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819289"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_Sub"><span class="hs-identifier hs-var">LM_MO_Sub</span></a><span>
</span><a name="line-1441"></a><span>    </span><a href="CmmMachOp.html#MO_V_Mul"><span class="hs-identifier hs-var">MO_V_Mul</span></a><span> </span><a name="local-6989586621680819290"><a href="#local-6989586621680819290"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819291"><a href="#local-6989586621680819291"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819290"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819291"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_Mul"><span class="hs-identifier hs-var">LM_MO_Mul</span></a><span>
</span><a name="line-1442"></a><span>
</span><a name="line-1443"></a><span>    </span><a href="CmmMachOp.html#MO_VS_Quot"><span class="hs-identifier hs-var">MO_VS_Quot</span></a><span> </span><a name="local-6989586621680819292"><a href="#local-6989586621680819292"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819293"><a href="#local-6989586621680819293"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819292"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819293"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_SDiv"><span class="hs-identifier hs-var">LM_MO_SDiv</span></a><span>
</span><a name="line-1444"></a><span>    </span><a href="CmmMachOp.html#MO_VS_Rem"><span class="hs-identifier hs-var">MO_VS_Rem</span></a><span>  </span><a name="local-6989586621680819294"><a href="#local-6989586621680819294"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819295"><a href="#local-6989586621680819295"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819294"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819295"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_SRem"><span class="hs-identifier hs-var">LM_MO_SRem</span></a><span>
</span><a name="line-1445"></a><span>
</span><a name="line-1446"></a><span>    </span><a href="CmmMachOp.html#MO_VU_Quot"><span class="hs-identifier hs-var">MO_VU_Quot</span></a><span> </span><a name="local-6989586621680819296"><a href="#local-6989586621680819296"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819297"><a href="#local-6989586621680819297"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819296"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819297"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_UDiv"><span class="hs-identifier hs-var">LM_MO_UDiv</span></a><span>
</span><a name="line-1447"></a><span>    </span><a href="CmmMachOp.html#MO_VU_Rem"><span class="hs-identifier hs-var">MO_VU_Rem</span></a><span>  </span><a name="local-6989586621680819298"><a href="#local-6989586621680819298"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819299"><a href="#local-6989586621680819299"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819298"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819299"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_URem"><span class="hs-identifier hs-var">LM_MO_URem</span></a><span>
</span><a name="line-1448"></a><span>
</span><a name="line-1449"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Add"><span class="hs-identifier hs-var">MO_VF_Add</span></a><span>  </span><a name="local-6989586621680819300"><a href="#local-6989586621680819300"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819301"><a href="#local-6989586621680819301"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819300"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819301"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_FAdd"><span class="hs-identifier hs-var">LM_MO_FAdd</span></a><span>
</span><a name="line-1450"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Sub"><span class="hs-identifier hs-var">MO_VF_Sub</span></a><span>  </span><a name="local-6989586621680819302"><a href="#local-6989586621680819302"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819303"><a href="#local-6989586621680819303"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819302"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819303"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_FSub"><span class="hs-identifier hs-var">LM_MO_FSub</span></a><span>
</span><a name="line-1451"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Mul"><span class="hs-identifier hs-var">MO_VF_Mul</span></a><span>  </span><a name="local-6989586621680819304"><a href="#local-6989586621680819304"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819305"><a href="#local-6989586621680819305"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819304"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819305"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_FMul"><span class="hs-identifier hs-var">LM_MO_FMul</span></a><span>
</span><a name="line-1452"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Quot"><span class="hs-identifier hs-var">MO_VF_Quot</span></a><span> </span><a name="local-6989586621680819306"><a href="#local-6989586621680819306"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680819307"><a href="#local-6989586621680819307"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819236"><span class="hs-identifier hs-var">genCastBinMach</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMVector"><span class="hs-identifier hs-var">LMVector</span></a><span> </span><a href="#local-6989586621680819306"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819307"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LM_MO_FDiv"><span class="hs-identifier hs-var">LM_MO_FDiv</span></a><span>
</span><a name="line-1453"></a><span>
</span><a name="line-1454"></a><span>    </span><a href="CmmMachOp.html#MO_Not"><span class="hs-identifier hs-var">MO_Not</span></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1455"></a><span>    </span><a href="CmmMachOp.html#MO_S_Neg"><span class="hs-identifier hs-var">MO_S_Neg</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1456"></a><span>    </span><a href="CmmMachOp.html#MO_F_Neg"><span class="hs-identifier hs-var">MO_F_Neg</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1457"></a><span>
</span><a name="line-1458"></a><span>    </span><a href="CmmMachOp.html#MO_SF_Conv"><span class="hs-identifier hs-var">MO_SF_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1459"></a><span>    </span><a href="CmmMachOp.html#MO_FS_Conv"><span class="hs-identifier hs-var">MO_FS_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1460"></a><span>    </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1461"></a><span>    </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1462"></a><span>    </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1463"></a><span>    </span><a href="CmmMachOp.html#MO_FF_Conv"><span class="hs-identifier hs-var">MO_FF_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1464"></a><span>
</span><a name="line-1465"></a><span>    </span><a href="CmmMachOp.html#MO_V_Insert"><span class="hs-identifier hs-var">MO_V_Insert</span></a><span>  </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1466"></a><span>    </span><a href="CmmMachOp.html#MO_V_Extract"><span class="hs-identifier hs-var">MO_V_Extract</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1467"></a><span>
</span><a name="line-1468"></a><span>    </span><a href="CmmMachOp.html#MO_VS_Neg"><span class="hs-identifier hs-var">MO_VS_Neg</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1469"></a><span>
</span><a name="line-1470"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Insert"><span class="hs-identifier hs-var">MO_VF_Insert</span></a><span>  </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1471"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Extract"><span class="hs-identifier hs-var">MO_VF_Extract</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1472"></a><span>
</span><a name="line-1473"></a><span>    </span><a href="CmmMachOp.html#MO_VF_Neg"><span class="hs-identifier hs-var">MO_VF_Neg</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1474"></a><span>
</span><a name="line-1475"></a><span>    </span><a href="CmmMachOp.html#MO_AlignmentCheck"><span class="hs-identifier hs-var">MO_AlignmentCheck</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819238"><span class="hs-identifier hs-var">panicOp</span></a><span>
</span><a name="line-1476"></a><span>
</span><a name="line-1477"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1478"></a><span>        </span><a name="local-6989586621680819232"><a href="#local-6989586621680819232"><span class="hs-identifier">binLlvmOp</span></a></a><span> </span><a name="local-6989586621680819239"><a href="#local-6989586621680819239"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819240"><a href="#local-6989586621680819240"><span class="hs-identifier">binOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier hs-var">runExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1479"></a><span>            </span><a name="local-6989586621680819241"><a href="#local-6989586621680819241"><span class="hs-identifier">vx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819230"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1480"></a><span>            </span><a name="local-6989586621680819242"><a href="#local-6989586621680819242"><span class="hs-identifier">vy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819231"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1481"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819241"><span class="hs-identifier hs-var">vx</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819242"><span class="hs-identifier hs-var">vy</span></a><span>
</span><a name="line-1482"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1483"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819239"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680819241"><span class="hs-identifier hs-var">vx</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819240"><span class="hs-identifier hs-var">binOp</span></a><span> </span><a href="#local-6989586621680819241"><span class="hs-identifier hs-var">vx</span></a><span> </span><a href="#local-6989586621680819242"><span class="hs-identifier hs-var">vy</span></a><span>
</span><a name="line-1484"></a><span>
</span><a name="line-1485"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1486"></a><span>                    </span><span class="hs-comment">-- Error. Continue anyway so we can debug the generated ll file.</span><span>
</span><a name="line-1487"></a><span>                    </span><a name="local-6989586621680819243"><a href="#local-6989586621680819243"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1488"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819244"><a href="#local-6989586621680819244"><span class="hs-identifier">style</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkCodeStyle</span><span> </span><span class="hs-identifier hs-var">CStyle</span><span>
</span><a name="line-1489"></a><span>                        </span><a name="local-6989586621680819245"><a href="#local-6989586621680819245"><span class="hs-identifier">toString</span></a></a><span> </span><a name="local-6989586621680819247"><a href="#local-6989586621680819247"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">renderWithStyle</span><span> </span><a href="#local-6989586621680819243"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819247"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621680819244"><span class="hs-identifier hs-var">style</span></a><span>
</span><a name="line-1490"></a><span>                        </span><a name="local-6989586621680819246"><a href="#local-6989586621680819246"><span class="hs-identifier">cmmToStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lines</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621680819245"><span class="hs-identifier hs-var">toString</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="PprCmmExpr.html#pprExpr"><span class="hs-identifier hs-var">PprCmm.pprExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1491"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Comment"><span class="hs-identifier hs-var">Comment</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819246"><span class="hs-identifier hs-var">cmmToStr</span></a><span> </span><a href="#local-6989586621680819230"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1492"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Comment"><span class="hs-identifier hs-var">Comment</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819246"><span class="hs-identifier hs-var">cmmToStr</span></a><span> </span><a href="#local-6989586621680819231"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1493"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819239"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680819241"><span class="hs-identifier hs-var">vx</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819240"><span class="hs-identifier hs-var">binOp</span></a><span> </span><a href="#local-6989586621680819241"><span class="hs-identifier hs-var">vx</span></a><span> </span><a href="#local-6989586621680819242"><span class="hs-identifier hs-var">vy</span></a><span>
</span><a name="line-1494"></a><span>
</span><a name="line-1495"></a><span>        </span><a name="local-6989586621680819233"><a href="#local-6989586621680819233"><span class="hs-identifier">binCastLlvmOp</span></a></a><span> </span><a name="local-6989586621680819248"><a href="#local-6989586621680819248"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819249"><a href="#local-6989586621680819249"><span class="hs-identifier">binOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier hs-var">runExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1496"></a><span>            </span><a name="local-6989586621680819250"><a href="#local-6989586621680819250"><span class="hs-identifier">vx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819230"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1497"></a><span>            </span><a name="local-6989586621680819251"><a href="#local-6989586621680819251"><span class="hs-identifier">vy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819231"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1498"></a><span>            </span><a name="local-6989586621680819252"><a href="#local-6989586621680819252"><span class="hs-identifier">vxy'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#castVarsW"><span class="hs-identifier hs-var">castVarsW</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#Signed"><span class="hs-identifier hs-var">Signed</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680819250"><span class="hs-identifier hs-var">vx</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819248"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819251"><span class="hs-identifier hs-var">vy</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819248"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1499"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819252"><span class="hs-identifier hs-var">vxy'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1500"></a><span>              </span><span class="hs-special">[</span><a name="local-6989586621680819253"><a href="#local-6989586621680819253"><span class="hs-identifier">vx'</span></a></a><span class="hs-special">,</span><a name="local-6989586621680819254"><a href="#local-6989586621680819254"><span class="hs-identifier">vy'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819248"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819249"><span class="hs-identifier hs-var">binOp</span></a><span> </span><a href="#local-6989586621680819253"><span class="hs-identifier hs-var">vx'</span></a><span> </span><a href="#local-6989586621680819254"><span class="hs-identifier hs-var">vy'</span></a><span>
</span><a name="line-1501"></a><span>              </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genMachOp_slow: binCastLlvmOp&quot;</span><span>
</span><a name="line-1502"></a><span>
</span><a name="line-1503"></a><span>        </span><span class="hs-comment">-- | Need to use EOption here as Cmm expects word size results from</span><span>
</span><a name="line-1504"></a><span>        </span><span class="hs-comment">-- comparisons while LLVM return i1. Need to extend to llvmWord type</span><span>
</span><a name="line-1505"></a><span>        </span><span class="hs-comment">-- if expected. See Note [Literals and branch conditions].</span><span>
</span><a name="line-1506"></a><span>        </span><a name="local-6989586621680819234"><a href="#local-6989586621680819234"><span class="hs-identifier">genBinComp</span></a></a><span> </span><a name="local-6989586621680819255"><a href="#local-6989586621680819255"><span class="hs-identifier">opt</span></a></a><span> </span><a name="local-6989586621680819256"><a href="#local-6989586621680819256"><span class="hs-identifier">cmp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1507"></a><span>            </span><a name="local-6989586621680819257"><a href="#local-6989586621680819257"><span class="hs-identifier">ed</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680819258"><a href="#local-6989586621680819258"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819259"><a href="#local-6989586621680819259"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819260"><a href="#local-6989586621680819260"><span class="hs-identifier">top</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680819232"><span class="hs-identifier hs-var">binLlvmOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#Compare"><span class="hs-identifier hs-var">Compare</span></a><span> </span><a href="#local-6989586621680819256"><span class="hs-identifier hs-var">cmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1508"></a><span>            </span><a name="local-6989586621680819261"><a href="#local-6989586621680819261"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1509"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819258"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span>
</span><a name="line-1510"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">i1Expected</span><span> </span><a href="#local-6989586621680819255"><span class="hs-identifier hs-var">opt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1511"></a><span>                    </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680819257"><span class="hs-identifier hs-var">ed</span></a><span>
</span><a name="line-1512"></a><span>                    </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1513"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819262"><a href="#local-6989586621680819262"><span class="hs-identifier">w_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819261"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1514"></a><span>                        </span><span class="hs-special">(</span><a name="local-6989586621680819263"><a href="#local-6989586621680819263"><span class="hs-identifier">v2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819264"><a href="#local-6989586621680819264"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819262"><span class="hs-identifier hs-var">w_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Zext"><span class="hs-identifier hs-var">LM_Zext</span></a><span> </span><a href="#local-6989586621680819258"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621680819262"><span class="hs-identifier hs-var">w_</span></a><span>
</span><a name="line-1515"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819263"><span class="hs-identifier hs-var">v2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819259"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819264"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819260"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">)</span><span>
</span><a name="line-1516"></a><span>                </span><span class="hs-keyword">else</span><span>
</span><a name="line-1517"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genBinComp: Compare returned type other then i1! &quot;</span><span>
</span><a name="line-1518"></a><span>                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680819261"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819258"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1519"></a><span>
</span><a name="line-1520"></a><span>        </span><a name="local-6989586621680819235"><a href="#local-6989586621680819235"><span class="hs-identifier">genBinMach</span></a></a><span> </span><a name="local-6989586621680819265"><a href="#local-6989586621680819265"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819232"><span class="hs-identifier hs-var">binLlvmOp</span></a><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="#local-6989586621680819265"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-1521"></a><span>
</span><a name="line-1522"></a><span>        </span><a name="local-6989586621680819236"><a href="#local-6989586621680819236"><span class="hs-identifier">genCastBinMach</span></a></a><span> </span><a name="local-6989586621680819266"><a href="#local-6989586621680819266"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819267"><a href="#local-6989586621680819267"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819233"><span class="hs-identifier hs-var">binCastLlvmOp</span></a><span> </span><a href="#local-6989586621680819266"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="#local-6989586621680819267"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-1523"></a><span>
</span><a name="line-1524"></a><span>        </span><span class="hs-comment">-- | Detect if overflow will occur in signed multiply of the two</span><span>
</span><a name="line-1525"></a><span>        </span><span class="hs-comment">-- CmmExpr's. This is the LLVM assembly equivalent of the NCG</span><span>
</span><a name="line-1526"></a><span>        </span><span class="hs-comment">-- implementation. Its much longer due to type information/safety.</span><span>
</span><a name="line-1527"></a><span>        </span><span class="hs-comment">-- This should actually compile to only about 3 asm instructions.</span><span>
</span><a name="line-1528"></a><span>        </span><span class="hs-identifier">isSMulOK</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1529"></a><span>        </span><a name="local-6989586621680819237"><a href="#local-6989586621680819237"><span class="hs-identifier">isSMulOK</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680819268"><a href="#local-6989586621680819268"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680819269"><a href="#local-6989586621680819269"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier hs-var">runExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1530"></a><span>            </span><a name="local-6989586621680819270"><a href="#local-6989586621680819270"><span class="hs-identifier">vx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819268"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1531"></a><span>            </span><a name="local-6989586621680819271"><a href="#local-6989586621680819271"><span class="hs-identifier">vy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819269"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1532"></a><span>
</span><a name="line-1533"></a><span>            </span><a name="local-6989586621680819272"><a href="#local-6989586621680819272"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1534"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819273"><a href="#local-6989586621680819273"><span class="hs-identifier">word</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819270"><span class="hs-identifier hs-var">vx</span></a><span>
</span><a name="line-1535"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819274"><a href="#local-6989586621680819274"><span class="hs-identifier">word2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMInt"><span class="hs-identifier hs-var">LMInt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819272"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819270"><span class="hs-identifier hs-var">vx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1536"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819275"><a href="#local-6989586621680819275"><span class="hs-identifier">shift</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819272"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-1537"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819276"><a href="#local-6989586621680819276"><span class="hs-identifier">shift1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#toIWord"><span class="hs-identifier hs-var">toIWord</span></a><span> </span><a href="#local-6989586621680819272"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819275"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1538"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819277"><a href="#local-6989586621680819277"><span class="hs-identifier">shift2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#toIWord"><span class="hs-identifier hs-var">toIWord</span></a><span> </span><a href="#local-6989586621680819272"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819275"><span class="hs-identifier hs-var">shift</span></a><span>
</span><a name="line-1539"></a><span>
</span><a name="line-1540"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-1541"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1542"></a><span>                    </span><a name="local-6989586621680819278"><a href="#local-6989586621680819278"><span class="hs-identifier">x1</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819274"><span class="hs-identifier hs-var">word2</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Sext"><span class="hs-identifier hs-var">LM_Sext</span></a><span> </span><a href="#local-6989586621680819270"><span class="hs-identifier hs-var">vx</span></a><span> </span><a href="#local-6989586621680819274"><span class="hs-identifier hs-var">word2</span></a><span>
</span><a name="line-1543"></a><span>                    </span><a name="local-6989586621680819279"><a href="#local-6989586621680819279"><span class="hs-identifier">y1</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819274"><span class="hs-identifier hs-var">word2</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Sext"><span class="hs-identifier hs-var">LM_Sext</span></a><span> </span><a href="#local-6989586621680819271"><span class="hs-identifier hs-var">vy</span></a><span> </span><a href="#local-6989586621680819274"><span class="hs-identifier hs-var">word2</span></a><span>
</span><a name="line-1544"></a><span>                    </span><a name="local-6989586621680819280"><a href="#local-6989586621680819280"><span class="hs-identifier">r1</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819274"><span class="hs-identifier hs-var">word2</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Mul"><span class="hs-identifier hs-var">LM_MO_Mul</span></a><span> </span><a href="#local-6989586621680819278"><span class="hs-identifier hs-var">x1</span></a><span> </span><a href="#local-6989586621680819279"><span class="hs-identifier hs-var">y1</span></a><span>
</span><a name="line-1545"></a><span>                    </span><a name="local-6989586621680819281"><a href="#local-6989586621680819281"><span class="hs-identifier">rlow1</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="#local-6989586621680819280"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-1546"></a><span>                    </span><a name="local-6989586621680819282"><a href="#local-6989586621680819282"><span class="hs-identifier">rlow2</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_AShr"><span class="hs-identifier hs-var">LM_MO_AShr</span></a><span> </span><a href="#local-6989586621680819281"><span class="hs-identifier hs-var">rlow1</span></a><span> </span><a href="#local-6989586621680819276"><span class="hs-identifier hs-var">shift1</span></a><span>
</span><a name="line-1547"></a><span>                    </span><a name="local-6989586621680819283"><a href="#local-6989586621680819283"><span class="hs-identifier">rhigh1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819274"><span class="hs-identifier hs-var">word2</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_AShr"><span class="hs-identifier hs-var">LM_MO_AShr</span></a><span> </span><a href="#local-6989586621680819280"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621680819277"><span class="hs-identifier hs-var">shift2</span></a><span>
</span><a name="line-1548"></a><span>                    </span><a name="local-6989586621680819284"><a href="#local-6989586621680819284"><span class="hs-identifier">rhigh2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="#local-6989586621680819283"><span class="hs-identifier hs-var">rhigh1</span></a><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-1549"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Sub"><span class="hs-identifier hs-var">LM_MO_Sub</span></a><span> </span><a href="#local-6989586621680819282"><span class="hs-identifier hs-var">rlow2</span></a><span> </span><a href="#local-6989586621680819284"><span class="hs-identifier hs-var">rhigh2</span></a><span>
</span><a name="line-1550"></a><span>
</span><a name="line-1551"></a><span>                </span><span class="hs-keyword">else</span><span>
</span><a name="line-1552"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;isSMulOK: Not bit type! (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680819272"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680819273"><span class="hs-identifier hs-var">word</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-1553"></a><span>
</span><a name="line-1554"></a><span>        </span><a name="local-6989586621680819238"><a href="#local-6989586621680819238"><span class="hs-identifier">panicOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;LLVM.CodeGen.genMachOp_slow: unary op encountered&quot;</span><span>
</span><a name="line-1555"></a><span>                       </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;with two arguments! (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680819229"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-1556"></a><span>
</span><a name="line-1557"></a><span class="hs-comment">-- More than two expression, invalid!</span><span>
</span><a name="line-1558"></a><span class="hs-identifier">genMachOp_slow</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genMachOp: More than 2 expressions in MachOp!&quot;</span><span>
</span><a name="line-1559"></a><span>
</span><a name="line-1560"></a><span>
</span><a name="line-1561"></a><span class="hs-comment">-- | Handle CmmLoad expression.</span><span>
</span><a name="line-1562"></a><span class="hs-identifier">genLoad</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Atomic"><span class="hs-identifier hs-type">Atomic</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CmmType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1563"></a><span>
</span><a name="line-1564"></a><span class="hs-comment">-- First we try to detect a few common cases and produce better code for</span><span>
</span><a name="line-1565"></a><span class="hs-comment">-- these then the default case. We are mostly trying to detect Cmm code</span><span>
</span><a name="line-1566"></a><span class="hs-comment">-- like I32[Sp + n] and use 'getelementptr' operations instead of the</span><span>
</span><a name="line-1567"></a><span class="hs-comment">-- generic case that uses casts and pointer arithmetic</span><span>
</span><a name="line-1568"></a><a name="genLoad"><a href="LlvmCodeGen.CodeGen.html#genLoad"><span class="hs-identifier">genLoad</span></a></a><span> </span><a name="local-6989586621680819308"><a href="#local-6989586621680819308"><span class="hs-identifier">atomic</span></a></a><span> </span><a name="local-6989586621680819309"><a href="#local-6989586621680819309"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819310"><a href="#local-6989586621680819310"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680819311"><a href="#local-6989586621680819311"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1569"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoad_fast"><span class="hs-identifier hs-var">genLoad_fast</span></a><span> </span><a href="#local-6989586621680819308"><span class="hs-identifier hs-var">atomic</span></a><span> </span><a href="#local-6989586621680819309"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621680819310"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621680819311"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1570"></a><span>
</span><a name="line-1571"></a><span class="hs-identifier">genLoad</span><span> </span><a name="local-6989586621680819312"><a href="#local-6989586621680819312"><span class="hs-identifier">atomic</span></a></a><span> </span><a name="local-6989586621680819313"><a href="#local-6989586621680819313"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819314"><a href="#local-6989586621680819314"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680819315"><a href="#local-6989586621680819315"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680819316"><a href="#local-6989586621680819316"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1572"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoad_fast"><span class="hs-identifier hs-var">genLoad_fast</span></a><span> </span><a href="#local-6989586621680819312"><span class="hs-identifier hs-var">atomic</span></a><span> </span><a href="#local-6989586621680819313"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621680819314"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621680819315"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680819316"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1573"></a><span>
</span><a name="line-1574"></a><span class="hs-identifier">genLoad</span><span> </span><a name="local-6989586621680819317"><a href="#local-6989586621680819317"><span class="hs-identifier">atomic</span></a></a><span> </span><a name="local-6989586621680819318"><a href="#local-6989586621680819318"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-1575"></a><span>                            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819319"><a href="#local-6989586621680819319"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1576"></a><span>                            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621680819320"><a href="#local-6989586621680819320"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1577"></a><span>                </span><a name="local-6989586621680819321"><a href="#local-6989586621680819321"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1578"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoad_fast"><span class="hs-identifier hs-var">genLoad_fast</span></a><span> </span><a href="#local-6989586621680819317"><span class="hs-identifier hs-var">atomic</span></a><span> </span><a href="#local-6989586621680819318"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621680819319"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680819320"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819321"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1579"></a><span>
</span><a name="line-1580"></a><span class="hs-identifier">genLoad</span><span> </span><a name="local-6989586621680819322"><a href="#local-6989586621680819322"><span class="hs-identifier">atomic</span></a></a><span> </span><a name="local-6989586621680819323"><a href="#local-6989586621680819323"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-1581"></a><span>                            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819324"><a href="#local-6989586621680819324"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1582"></a><span>                            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621680819325"><a href="#local-6989586621680819325"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1583"></a><span>                </span><a name="local-6989586621680819326"><a href="#local-6989586621680819326"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1584"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoad_fast"><span class="hs-identifier hs-var">genLoad_fast</span></a><span> </span><a href="#local-6989586621680819322"><span class="hs-identifier hs-var">atomic</span></a><span> </span><a href="#local-6989586621680819323"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621680819324"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680819325"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819326"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1585"></a><span>
</span><a name="line-1586"></a><span class="hs-comment">-- generic case</span><span>
</span><a name="line-1587"></a><span class="hs-identifier">genLoad</span><span> </span><a name="local-6989586621680819327"><a href="#local-6989586621680819327"><span class="hs-identifier">atomic</span></a></a><span> </span><a name="local-6989586621680819328"><a href="#local-6989586621680819328"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621680819329"><a href="#local-6989586621680819329"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1588"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getTBAAMeta"><span class="hs-identifier hs-var">getTBAAMeta</span></a><span> </span><a href="LlvmCodeGen.Regs.html#topN"><span class="hs-identifier hs-var">topN</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoad_slow"><span class="hs-identifier hs-var">genLoad_slow</span></a><span> </span><a href="#local-6989586621680819327"><span class="hs-identifier hs-var">atomic</span></a><span> </span><a href="#local-6989586621680819328"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621680819329"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1589"></a><span>
</span><a name="line-1590"></a><span class="hs-comment">-- | Handle CmmLoad expression.</span><span>
</span><a name="line-1591"></a><span class="hs-comment">-- This is a special case for loading from a global register pointer</span><span>
</span><a name="line-1592"></a><span class="hs-comment">-- offset such as I32[Sp+8].</span><span>
</span><a name="line-1593"></a><span class="hs-identifier">genLoad_fast</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Atomic"><span class="hs-identifier hs-type">Atomic</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CmmType</span><span>
</span><a name="line-1594"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1595"></a><a name="genLoad_fast"><a href="LlvmCodeGen.CodeGen.html#genLoad_fast"><span class="hs-identifier">genLoad_fast</span></a></a><span> </span><a name="local-6989586621680819330"><a href="#local-6989586621680819330"><span class="hs-identifier">atomic</span></a></a><span> </span><a name="local-6989586621680819331"><a href="#local-6989586621680819331"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621680819332"><a href="#local-6989586621680819332"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621680819333"><a href="#local-6989586621680819333"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680819334"><a href="#local-6989586621680819334"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1596"></a><span>    </span><a name="local-6989586621680819337"><a href="#local-6989586621680819337"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1597"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819338"><a href="#local-6989586621680819338"><span class="hs-identifier">gv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819339"><a href="#local-6989586621680819339"><span class="hs-identifier">grt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819340"><a href="#local-6989586621680819340"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegVal"><span class="hs-identifier hs-var">getCmmRegVal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="#local-6989586621680819332"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1598"></a><span>    </span><a name="local-6989586621680819341"><a href="#local-6989586621680819341"><span class="hs-identifier">meta</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getTBAARegMeta"><span class="hs-identifier hs-var">getTBAARegMeta</span></a><span> </span><a href="#local-6989586621680819332"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1599"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819342"><a href="#local-6989586621680819342"><span class="hs-identifier">ty'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><a href="#local-6989586621680819334"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1600"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680819343"><a href="#local-6989586621680819343"><span class="hs-identifier">ix</span></a></a><span class="hs-special">,</span><a name="local-6989586621680819344"><a href="#local-6989586621680819344"><span class="hs-identifier">rem</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819333"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819337"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819339"><span class="hs-identifier hs-var">grt</span></a><span>  </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-1601"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#isPointer"><span class="hs-identifier hs-var">isPointer</span></a><span> </span><a href="#local-6989586621680819339"><span class="hs-identifier hs-var">grt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680819344"><span class="hs-identifier hs-var">rem</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1602"></a><span>            </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1603"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621680819345"><a href="#local-6989586621680819345"><span class="hs-identifier">ptr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819346"><a href="#local-6989586621680819346"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819339"><span class="hs-identifier hs-var">grt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#GetElemPtr"><span class="hs-identifier hs-var">GetElemPtr</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621680819338"><span class="hs-identifier hs-var">gv</span></a><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.CodeGen.html#toI32"><span class="hs-identifier hs-var">toI32</span></a><span> </span><a href="#local-6989586621680819343"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">]</span><span>
</span><a name="line-1604"></a><span>                </span><span class="hs-comment">-- We might need a different pointer type, so check</span><span>
</span><a name="line-1605"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819339"><span class="hs-identifier hs-var">grt</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680819342"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1606"></a><span>                     </span><span class="hs-comment">-- were fine</span><span>
</span><a name="line-1607"></a><span>                     </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1608"></a><span>                         </span><span class="hs-special">(</span><a name="local-6989586621680819347"><a href="#local-6989586621680819347"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819348"><a href="#local-6989586621680819348"><span class="hs-identifier">s3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819342"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#MExpr"><span class="hs-identifier hs-var">MExpr</span></a><span> </span><a href="#local-6989586621680819341"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819335"><span class="hs-identifier hs-var">loadInstr</span></a><span> </span><a href="#local-6989586621680819345"><span class="hs-identifier hs-var">ptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1609"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819347"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819340"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819346"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819348"><span class="hs-identifier hs-var">s3</span></a><span class="hs-special">,</span><span>
</span><a name="line-1610"></a><span>                                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1611"></a><span>
</span><a name="line-1612"></a><span>                     </span><span class="hs-comment">-- cast to pointer type needed</span><span>
</span><a name="line-1613"></a><span>                     </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1614"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819349"><a href="#local-6989586621680819349"><span class="hs-identifier">pty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680819342"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1615"></a><span>                         </span><span class="hs-special">(</span><a name="local-6989586621680819350"><a href="#local-6989586621680819350"><span class="hs-identifier">ptr'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819351"><a href="#local-6989586621680819351"><span class="hs-identifier">s3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819349"><span class="hs-identifier hs-var">pty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span> </span><a href="#local-6989586621680819345"><span class="hs-identifier hs-var">ptr</span></a><span> </span><a href="#local-6989586621680819349"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-1616"></a><span>                         </span><span class="hs-special">(</span><a name="local-6989586621680819352"><a href="#local-6989586621680819352"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819353"><a href="#local-6989586621680819353"><span class="hs-identifier">s4</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819342"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#MExpr"><span class="hs-identifier hs-var">MExpr</span></a><span> </span><a href="#local-6989586621680819341"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819335"><span class="hs-identifier hs-var">loadInstr</span></a><span> </span><a href="#local-6989586621680819350"><span class="hs-identifier hs-var">ptr'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1617"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819352"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819340"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819346"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819351"><span class="hs-identifier hs-var">s3</span></a><span>
</span><a name="line-1618"></a><span>                                    </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819353"><span class="hs-identifier hs-var">s4</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1619"></a><span>
</span><a name="line-1620"></a><span>            </span><span class="hs-comment">-- If its a bit type then we use the slow method since</span><span>
</span><a name="line-1621"></a><span>            </span><span class="hs-comment">-- we can't avoid casting anyway.</span><span>
</span><a name="line-1622"></a><span>            </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoad_slow"><span class="hs-identifier hs-var">genLoad_slow</span></a><span> </span><a href="#local-6989586621680819330"><span class="hs-identifier hs-var">atomic</span></a><span>  </span><a href="#local-6989586621680819331"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621680819334"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621680819341"><span class="hs-identifier hs-var">meta</span></a><span>
</span><a name="line-1623"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1624"></a><span>    </span><a name="local-6989586621680819335"><a href="#local-6989586621680819335"><span class="hs-identifier">loadInstr</span></a></a><span> </span><a name="local-6989586621680819336"><a href="#local-6989586621680819336"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680819330"><span class="hs-identifier hs-var">atomic</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#ALoad"><span class="hs-identifier hs-var">ALoad</span></a><span> </span><a href="Llvm.AbsSyn.html#SyncSeqCst"><span class="hs-identifier hs-var">SyncSeqCst</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621680819336"><span class="hs-identifier hs-var">ptr</span></a><span>
</span><a name="line-1625"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Load"><span class="hs-identifier hs-var">Load</span></a><span> </span><a href="#local-6989586621680819336"><span class="hs-identifier hs-var">ptr</span></a><span>
</span><a name="line-1626"></a><span>
</span><a name="line-1627"></a><span class="hs-comment">-- | Handle Cmm load expression.</span><span>
</span><a name="line-1628"></a><span class="hs-comment">-- Generic case. Uses casts and pointer arithmetic if needed.</span><span>
</span><a name="line-1629"></a><span class="hs-identifier">genLoad_slow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Atomic"><span class="hs-identifier hs-type">Atomic</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CmmType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Llvm.MetaData.html#MetaAnnot"><span class="hs-identifier hs-type">MetaAnnot</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1630"></a><a name="genLoad_slow"><a href="LlvmCodeGen.CodeGen.html#genLoad_slow"><span class="hs-identifier">genLoad_slow</span></a></a><span> </span><a name="local-6989586621680819354"><a href="#local-6989586621680819354"><span class="hs-identifier">atomic</span></a></a><span> </span><a name="local-6989586621680819355"><a href="#local-6989586621680819355"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621680819356"><a href="#local-6989586621680819356"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819357"><a href="#local-6989586621680819357"><span class="hs-identifier">meta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier hs-var">runExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1631"></a><span>    </span><a name="local-6989586621680819360"><a href="#local-6989586621680819360"><span class="hs-identifier">iptr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier hs-var">exprToVarW</span></a><span> </span><a href="#local-6989586621680819355"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1632"></a><span>    </span><a name="local-6989586621680819361"><a href="#local-6989586621680819361"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1633"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819360"><span class="hs-identifier hs-var">iptr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1634"></a><span>         </span><a href="Llvm.Types.html#LMPointer"><span class="hs-identifier hs-var">LMPointer</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1635"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><a href="#local-6989586621680819356"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#MExpr"><span class="hs-identifier hs-var">MExpr</span></a><span> </span><a href="#local-6989586621680819357"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819358"><span class="hs-identifier hs-var">loadInstr</span></a><span> </span><a href="#local-6989586621680819360"><span class="hs-identifier hs-var">iptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1636"></a><span>
</span><a name="line-1637"></a><span>         </span><a name="local-6989586621680819362"><a href="#local-6989586621680819362"><span class="hs-identifier">i</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Llvm.Types.html#LMInt"><span class="hs-identifier hs-var">LMInt</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680819362"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819361"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1638"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819363"><a href="#local-6989586621680819363"><span class="hs-identifier">pty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMPointer"><span class="hs-identifier hs-var">LMPointer</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><a href="#local-6989586621680819356"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1639"></a><span>                    </span><a name="local-6989586621680819364"><a href="#local-6989586621680819364"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><a href="#local-6989586621680819363"><span class="hs-identifier hs-var">pty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Inttoptr"><span class="hs-identifier hs-var">LM_Inttoptr</span></a><span> </span><a href="#local-6989586621680819360"><span class="hs-identifier hs-var">iptr</span></a><span> </span><a href="#local-6989586621680819363"><span class="hs-identifier hs-var">pty</span></a><span>
</span><a name="line-1640"></a><span>                    </span><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier hs-var">doExprW</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><a href="#local-6989586621680819356"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#MExpr"><span class="hs-identifier hs-var">MExpr</span></a><span> </span><a href="#local-6989586621680819357"><span class="hs-identifier hs-var">meta</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819358"><span class="hs-identifier hs-var">loadInstr</span></a><span> </span><a href="#local-6989586621680819364"><span class="hs-identifier hs-var">ptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1641"></a><span>
</span><a name="line-1642"></a><span>         </span><a name="local-6989586621680819365"><a href="#local-6989586621680819365"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="LlvmCodeGen.CodeGen.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;exprToVar: CmmLoad expression is not right type!&quot;</span><span>
</span><a name="line-1643"></a><span>                        </span><span class="hs-special">(</span><a href="PprCmmExpr.html#pprExpr"><span class="hs-identifier hs-var">PprCmm.pprExpr</span></a><span> </span><a href="#local-6989586621680819355"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1644"></a><span>                            </span><span class="hs-string">&quot;Size of Ptr: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#llvmPtrBits"><span class="hs-identifier hs-var">llvmPtrBits</span></a><span> </span><a href="#local-6989586621680819361"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-1645"></a><span>                            </span><span class="hs-string">&quot;, Size of var: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819361"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819365"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-1646"></a><span>                            </span><span class="hs-string">&quot;, Var: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680819361"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680819360"><span class="hs-identifier hs-var">iptr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1647"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1648"></a><span>    </span><a name="local-6989586621680819358"><a href="#local-6989586621680819358"><span class="hs-identifier">loadInstr</span></a></a><span> </span><a name="local-6989586621680819359"><a href="#local-6989586621680819359"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680819354"><span class="hs-identifier hs-var">atomic</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#ALoad"><span class="hs-identifier hs-var">ALoad</span></a><span> </span><a href="Llvm.AbsSyn.html#SyncSeqCst"><span class="hs-identifier hs-var">SyncSeqCst</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621680819359"><span class="hs-identifier hs-var">ptr</span></a><span>
</span><a name="line-1649"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Load"><span class="hs-identifier hs-var">Load</span></a><span> </span><a href="#local-6989586621680819359"><span class="hs-identifier hs-var">ptr</span></a><span>
</span><a name="line-1650"></a><span>
</span><a name="line-1651"></a><span>
</span><a name="line-1652"></a><span class="hs-comment">-- | Handle CmmReg expression. This will return a pointer to the stack</span><span>
</span><a name="line-1653"></a><span class="hs-comment">-- location of the register. Throws an error if it isn't allocated on</span><span>
</span><a name="line-1654"></a><span class="hs-comment">-- the stack.</span><span>
</span><a name="line-1655"></a><span class="hs-identifier">getCmmReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1656"></a><a name="getCmmReg"><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier">getCmmReg</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621680819366"><a href="#local-6989586621680819366"><span class="hs-identifier">un</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1657"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680819367"><a href="#local-6989586621680819367"><span class="hs-identifier">exists</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#varLookup"><span class="hs-identifier hs-var">varLookup</span></a><span> </span><a href="#local-6989586621680819366"><span class="hs-identifier hs-var">un</span></a><span>
</span><a name="line-1658"></a><span>       </span><a name="local-6989586621680819368"><a href="#local-6989586621680819368"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1659"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819367"><span class="hs-identifier hs-var">exists</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1660"></a><span>         </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680819369"><a href="#local-6989586621680819369"><span class="hs-identifier">ety</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMLocalVar"><span class="hs-identifier hs-var">LMLocalVar</span></a><span> </span><a href="#local-6989586621680819366"><span class="hs-identifier hs-var">un</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680819369"><span class="hs-identifier hs-var">ety</span></a><span class="hs-special">)</span><span>
</span><a name="line-1661"></a><span>         </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;getCmmReg: Cmm register &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680819368"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680819366"><span class="hs-identifier hs-var">un</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; was not allocated!&quot;</span><span>
</span><a name="line-1662"></a><span>           </span><span class="hs-comment">-- This should never happen, as every local variable should</span><span>
</span><a name="line-1663"></a><span>           </span><span class="hs-comment">-- have been assigned a value at some point, triggering</span><span>
</span><a name="line-1664"></a><span>           </span><span class="hs-comment">-- &quot;funPrologue&quot; to allocate it on the stack.</span><span>
</span><a name="line-1665"></a><span>
</span><a name="line-1666"></a><span class="hs-identifier">getCmmReg</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819370"><a href="#local-6989586621680819370"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1667"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680819371"><a href="#local-6989586621680819371"><span class="hs-identifier">onStack</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#checkStackReg"><span class="hs-identifier hs-var">checkStackReg</span></a><span> </span><a href="#local-6989586621680819370"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1668"></a><span>       </span><a name="local-6989586621680819372"><a href="#local-6989586621680819372"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1669"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680819371"><span class="hs-identifier hs-var">onStack</span></a><span>
</span><a name="line-1670"></a><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Regs.html#lmGlobalRegVar"><span class="hs-identifier hs-var">lmGlobalRegVar</span></a><span> </span><a href="#local-6989586621680819372"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819370"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-1671"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;getCmmReg: Cmm register &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">showSDoc</span><span> </span><a href="#local-6989586621680819372"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621680819370"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; not stack-allocated!&quot;</span><span>
</span><a name="line-1672"></a><span>
</span><a name="line-1673"></a><span class="hs-comment">-- | Return the value of a given register, as well as its type. Might</span><span>
</span><a name="line-1674"></a><span class="hs-comment">-- need to be load from stack.</span><span>
</span><a name="line-1675"></a><span class="hs-identifier">getCmmRegVal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">)</span><span>
</span><a name="line-1676"></a><a name="getCmmRegVal"><a href="LlvmCodeGen.CodeGen.html#getCmmRegVal"><span class="hs-identifier">getCmmRegVal</span></a></a><span> </span><a name="local-6989586621680819373"><a href="#local-6989586621680819373"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1677"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819373"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1678"></a><span>    </span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819379"><a href="#local-6989586621680819379"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1679"></a><span>      </span><a name="local-6989586621680819380"><a href="#local-6989586621680819380"><span class="hs-identifier">onStack</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#checkStackReg"><span class="hs-identifier hs-var">checkStackReg</span></a><span> </span><a href="#local-6989586621680819379"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1680"></a><span>      </span><a name="local-6989586621680819381"><a href="#local-6989586621680819381"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1681"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680819380"><span class="hs-identifier hs-var">onStack</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621680819374"><span class="hs-identifier hs-var">loadFromStack</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1682"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819382"><a href="#local-6989586621680819382"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Regs.html#lmGlobalRegArg"><span class="hs-identifier hs-var">lmGlobalRegArg</span></a><span> </span><a href="#local-6989586621680819381"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819379"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1683"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819382"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819382"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1684"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819374"><span class="hs-identifier hs-var">loadFromStack</span></a><span>
</span><a name="line-1685"></a><span> </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680819374"><a href="#local-6989586621680819374"><span class="hs-identifier">loadFromStack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1686"></a><span>         </span><a name="local-6989586621680819375"><a href="#local-6989586621680819375"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><a href="#local-6989586621680819373"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-1687"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819376"><a href="#local-6989586621680819376"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819375"><span class="hs-identifier hs-var">ptr</span></a><span>
</span><a name="line-1688"></a><span>         </span><span class="hs-special">(</span><a name="local-6989586621680819377"><a href="#local-6989586621680819377"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819378"><a href="#local-6989586621680819378"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819376"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.AbsSyn.html#Load"><span class="hs-identifier hs-var">Load</span></a><span> </span><a href="#local-6989586621680819375"><span class="hs-identifier hs-var">ptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1689"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819377"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819376"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="#local-6989586621680819378"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1690"></a><span>
</span><a name="line-1691"></a><span class="hs-comment">-- | Allocate a local CmmReg on the stack</span><span>
</span><a name="line-1692"></a><span class="hs-identifier">allocReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">)</span><span>
</span><a name="line-1693"></a><a name="allocReg"><a href="LlvmCodeGen.CodeGen.html#allocReg"><span class="hs-identifier">allocReg</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621680819383"><a href="#local-6989586621680819383"><span class="hs-identifier">un</span></a></a><span> </span><a name="local-6989586621680819384"><a href="#local-6989586621680819384"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1694"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819385"><a href="#local-6989586621680819385"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><a href="#local-6989586621680819384"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1695"></a><span>        </span><a name="local-6989586621680819386"><a href="#local-6989586621680819386"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLocalVar"><span class="hs-identifier hs-var">LMLocalVar</span></a><span> </span><a href="#local-6989586621680819383"><span class="hs-identifier hs-var">un</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMPointer"><span class="hs-identifier hs-var">LMPointer</span></a><span> </span><a href="#local-6989586621680819385"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1696"></a><span>        </span><a name="local-6989586621680819387"><a href="#local-6989586621680819387"><span class="hs-identifier">alc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Alloca"><span class="hs-identifier hs-var">Alloca</span></a><span> </span><a href="#local-6989586621680819385"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1697"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819386"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a><span> </span><a href="#local-6989586621680819386"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621680819387"><span class="hs-identifier hs-var">alc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1698"></a><span>
</span><a name="line-1699"></a><span class="hs-identifier">allocReg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;allocReg: Global reg encountered! Global registers should&quot;</span><span>
</span><a name="line-1700"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; have been handled elsewhere!&quot;</span><span>
</span><a name="line-1701"></a><span>
</span><a name="line-1702"></a><span>
</span><a name="line-1703"></a><span class="hs-comment">-- | Generate code for a literal</span><span>
</span><a name="line-1704"></a><span class="hs-identifier">genLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#EOption"><span class="hs-identifier hs-type">EOption</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1705"></a><a name="genLit"><a href="LlvmCodeGen.CodeGen.html#genLit"><span class="hs-identifier">genLit</span></a></a><span> </span><a name="local-6989586621680819388"><a href="#local-6989586621680819388"><span class="hs-identifier">opt</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621680819389"><a href="#local-6989586621680819389"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621680819390"><a href="#local-6989586621680819390"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1706"></a><span>  </span><span class="hs-comment">-- See Note [Literals and branch conditions].</span><span>
</span><a name="line-1707"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819391"><a href="#local-6989586621680819391"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i1Expected</span><span> </span><a href="#local-6989586621680819388"><span class="hs-identifier hs-var">opt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#i1"><span class="hs-identifier hs-var">i1</span></a><span>
</span><a name="line-1708"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMInt"><span class="hs-identifier hs-var">LMInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621680819390"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1709"></a><span>        </span><span class="hs-comment">-- comm  = Comment [ fsLit $ &quot;EOption: &quot; ++ show opt</span><span>
</span><a name="line-1710"></a><span>        </span><span class="hs-comment">--                 , fsLit $ &quot;Width  : &quot; ++ show w</span><span>
</span><a name="line-1711"></a><span>        </span><span class="hs-comment">--                 , fsLit $ &quot;Width' : &quot; ++ show (widthInBits w)</span><span>
</span><a name="line-1712"></a><span>        </span><span class="hs-comment">--                 ]</span><span>
</span><a name="line-1713"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="#local-6989586621680819391"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621680819389"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1714"></a><span>
</span><a name="line-1715"></a><span class="hs-identifier">genLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><a name="local-6989586621680819392"><a href="#local-6989586621680819392"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621680819393"><a href="#local-6989586621680819393"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1716"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMFloatLit"><span class="hs-identifier hs-var">LMFloatLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621680819392"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.Base.html#widthToLlvmFloat"><span class="hs-identifier hs-var">widthToLlvmFloat</span></a><span> </span><a href="#local-6989586621680819393"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1717"></a><span>              </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1718"></a><span>
</span><a name="line-1719"></a><span class="hs-identifier">genLit</span><span> </span><a name="local-6989586621680819394"><a href="#local-6989586621680819394"><span class="hs-identifier">opt</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmVec"><span class="hs-identifier hs-var">CmmVec</span></a><span> </span><a name="local-6989586621680819395"><a href="#local-6989586621680819395"><span class="hs-identifier">ls</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1720"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680819400"><a href="#local-6989586621680819400"><span class="hs-identifier">llvmLits</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621680819396"><span class="hs-identifier hs-var">toLlvmLit</span></a><span> </span><a href="#local-6989586621680819395"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-1721"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMVectorLit"><span class="hs-identifier hs-var">LMVectorLit</span></a><span> </span><a href="#local-6989586621680819400"><span class="hs-identifier hs-var">llvmLits</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1722"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1723"></a><span>    </span><span class="hs-identifier">toLlvmLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmLit"><span class="hs-identifier hs-type">LlvmLit</span></a><span>
</span><a name="line-1724"></a><span>    </span><a name="local-6989586621680819396"><a href="#local-6989586621680819396"><span class="hs-identifier">toLlvmLit</span></a></a><span> </span><a name="local-6989586621680819397"><a href="#local-6989586621680819397"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1725"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680819398"><a href="#local-6989586621680819398"><span class="hs-identifier">llvmLitVar</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLit"><span class="hs-identifier hs-var">genLit</span></a><span> </span><a href="#local-6989586621680819394"><span class="hs-identifier hs-var">opt</span></a><span> </span><a href="#local-6989586621680819397"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1726"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819398"><span class="hs-identifier hs-var">llvmLitVar</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1727"></a><span>          </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><a name="local-6989586621680819399"><a href="#local-6989586621680819399"><span class="hs-identifier">llvmLit</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680819399"><span class="hs-identifier hs-var">llvmLit</span></a><span>
</span><a name="line-1728"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genLit&quot;</span><span>
</span><a name="line-1729"></a><span>
</span><a name="line-1730"></a><span class="hs-identifier">genLit</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680819401"><a href="#local-6989586621680819401"><span class="hs-identifier">cmm</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621680819402"><a href="#local-6989586621680819402"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1731"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680819403"><a href="#local-6989586621680819403"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#getGlobalPtr"><span class="hs-identifier hs-var">getGlobalPtr</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="LlvmCodeGen.Base.html#strCLabel_llvm"><span class="hs-identifier hs-var">strCLabel_llvm</span></a><span> </span><a href="#local-6989586621680819402"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1732"></a><span>       </span><a name="local-6989586621680819404"><a href="#local-6989586621680819404"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1733"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819405"><a href="#local-6989586621680819405"><span class="hs-identifier">lmty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#cmmToLlvmType"><span class="hs-identifier hs-var">cmmToLlvmType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a><span> </span><a href="#local-6989586621680819404"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819401"><span class="hs-identifier hs-var">cmm</span></a><span>
</span><a name="line-1734"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621680819406"><a href="#local-6989586621680819406"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819407"><a href="#local-6989586621680819407"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819405"><span class="hs-identifier hs-var">lmty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Ptrtoint"><span class="hs-identifier hs-var">LM_Ptrtoint</span></a><span> </span><a href="#local-6989586621680819403"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819404"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1735"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819406"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="#local-6989586621680819407"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1736"></a><span>
</span><a name="line-1737"></a><span class="hs-identifier">genLit</span><span> </span><a name="local-6989586621680819408"><a href="#local-6989586621680819408"><span class="hs-identifier">opt</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabelOff"><span class="hs-identifier hs-var">CmmLabelOff</span></a><span> </span><span class="hs-keyword">label</span><span> </span><a name="local-6989586621680819410"><a href="#local-6989586621680819410"><span class="hs-identifier">off</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1738"></a><span>    </span><a name="local-6989586621680819411"><a href="#local-6989586621680819411"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1739"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819412"><a href="#local-6989586621680819412"><span class="hs-identifier">vlbl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819413"><a href="#local-6989586621680819413"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819414"><a href="#local-6989586621680819414"><span class="hs-identifier">stat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLit"><span class="hs-identifier hs-var">genLit</span></a><span> </span><a href="#local-6989586621680819408"><span class="hs-identifier hs-var">opt</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><span class="hs-keyword">label</span><span class="hs-special">)</span><span>
</span><a name="line-1740"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819415"><a href="#local-6989586621680819415"><span class="hs-identifier">voff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#toIWord"><span class="hs-identifier hs-var">toIWord</span></a><span> </span><a href="#local-6989586621680819411"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819410"><span class="hs-identifier hs-var">off</span></a><span>
</span><a name="line-1741"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819416"><a href="#local-6989586621680819416"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819417"><a href="#local-6989586621680819417"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819412"><span class="hs-identifier hs-var">vlbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Add"><span class="hs-identifier hs-var">LM_MO_Add</span></a><span> </span><a href="#local-6989586621680819412"><span class="hs-identifier hs-var">vlbl</span></a><span> </span><a href="#local-6989586621680819415"><span class="hs-identifier hs-var">voff</span></a><span>
</span><a name="line-1742"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819416"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819413"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819417"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819414"><span class="hs-identifier hs-var">stat</span></a><span class="hs-special">)</span><span>
</span><a name="line-1743"></a><span>
</span><a name="line-1744"></a><span class="hs-identifier">genLit</span><span> </span><a name="local-6989586621680819418"><a href="#local-6989586621680819418"><span class="hs-identifier">opt</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabelDiffOff"><span class="hs-identifier hs-var">CmmLabelDiffOff</span></a><span> </span><a name="local-6989586621680819419"><a href="#local-6989586621680819419"><span class="hs-identifier">l1</span></a></a><span> </span><a name="local-6989586621680819420"><a href="#local-6989586621680819420"><span class="hs-identifier">l2</span></a></a><span> </span><a name="local-6989586621680819421"><a href="#local-6989586621680819421"><span class="hs-identifier">off</span></a></a><span> </span><a name="local-6989586621680819422"><a href="#local-6989586621680819422"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1745"></a><span>    </span><a name="local-6989586621680819423"><a href="#local-6989586621680819423"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1746"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819424"><a href="#local-6989586621680819424"><span class="hs-identifier">vl1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819425"><a href="#local-6989586621680819425"><span class="hs-identifier">stmts1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819426"><a href="#local-6989586621680819426"><span class="hs-identifier">stat1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLit"><span class="hs-identifier hs-var">genLit</span></a><span> </span><a href="#local-6989586621680819418"><span class="hs-identifier hs-var">opt</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a href="#local-6989586621680819419"><span class="hs-identifier hs-var">l1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1747"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819427"><a href="#local-6989586621680819427"><span class="hs-identifier">vl2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819428"><a href="#local-6989586621680819428"><span class="hs-identifier">stmts2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819429"><a href="#local-6989586621680819429"><span class="hs-identifier">stat2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLit"><span class="hs-identifier hs-var">genLit</span></a><span> </span><a href="#local-6989586621680819418"><span class="hs-identifier hs-var">opt</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a href="#local-6989586621680819420"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1748"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819430"><a href="#local-6989586621680819430"><span class="hs-identifier">voff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#toIWord"><span class="hs-identifier hs-var">toIWord</span></a><span> </span><a href="#local-6989586621680819423"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819421"><span class="hs-identifier hs-var">off</span></a><span>
</span><a name="line-1749"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819431"><a href="#local-6989586621680819431"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819424"><span class="hs-identifier hs-var">vl1</span></a><span>
</span><a name="line-1750"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819432"><a href="#local-6989586621680819432"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819427"><span class="hs-identifier hs-var">vl2</span></a><span>
</span><a name="line-1751"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680819431"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#isInt"><span class="hs-identifier hs-var">isInt</span></a><span> </span><a href="#local-6989586621680819432"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1752"></a><span>       </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819423"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819431"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Llvm.Types.html#llvmWidthInBits"><span class="hs-identifier hs-var">llvmWidthInBits</span></a><span> </span><a href="#local-6989586621680819423"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819432"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1753"></a><span>       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1754"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819433"><a href="#local-6989586621680819433"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819434"><a href="#local-6989586621680819434"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819424"><span class="hs-identifier hs-var">vl1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Sub"><span class="hs-identifier hs-var">LM_MO_Sub</span></a><span> </span><a href="#local-6989586621680819424"><span class="hs-identifier hs-var">vl1</span></a><span> </span><a href="#local-6989586621680819427"><span class="hs-identifier hs-var">vl2</span></a><span>
</span><a name="line-1755"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621680819435"><a href="#local-6989586621680819435"><span class="hs-identifier">v2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819436"><a href="#local-6989586621680819436"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819433"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#LlvmOp"><span class="hs-identifier hs-var">LlvmOp</span></a><span> </span><a href="Llvm.Types.html#LM_MO_Add"><span class="hs-identifier hs-var">LM_MO_Add</span></a><span> </span><a href="#local-6989586621680819433"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621680819430"><span class="hs-identifier hs-var">voff</span></a><span>
</span><a name="line-1756"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819437"><a href="#local-6989586621680819437"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Base.html#widthToLlvmInt"><span class="hs-identifier hs-var">widthToLlvmInt</span></a><span> </span><a href="#local-6989586621680819422"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1757"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819438"><a href="#local-6989586621680819438"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819425"><span class="hs-identifier hs-var">stmts1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819428"><span class="hs-identifier hs-var">stmts2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819434"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819436"><span class="hs-identifier hs-var">s2</span></a><span>
</span><a name="line-1758"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680819422"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621680819423"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1759"></a><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1760"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621680819439"><a href="#local-6989586621680819439"><span class="hs-identifier">v3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819440"><a href="#local-6989586621680819440"><span class="hs-identifier">s3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819437"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Trunc"><span class="hs-identifier hs-var">LM_Trunc</span></a><span> </span><a href="#local-6989586621680819435"><span class="hs-identifier hs-var">v2</span></a><span> </span><a href="#local-6989586621680819437"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1761"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819439"><span class="hs-identifier hs-var">v3</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819438"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819440"><span class="hs-identifier hs-var">s3</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819426"><span class="hs-identifier hs-var">stat1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819429"><span class="hs-identifier hs-var">stat2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1762"></a><span>              </span><span class="hs-keyword">else</span><span>
</span><a name="line-1763"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819435"><span class="hs-identifier hs-var">v2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819438"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819426"><span class="hs-identifier hs-var">stat1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819429"><span class="hs-identifier hs-var">stat2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1764"></a><span>        </span><span class="hs-keyword">else</span><span>
</span><a name="line-1765"></a><span>            </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genLit: CmmLabelDiffOff encountered with different label ty!&quot;</span><span>
</span><a name="line-1766"></a><span>
</span><a name="line-1767"></a><span class="hs-identifier">genLit</span><span> </span><a name="local-6989586621680819441"><a href="#local-6989586621680819441"><span class="hs-identifier">opt</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmBlock"><span class="hs-identifier hs-var">CmmBlock</span></a><span> </span><a name="local-6989586621680819442"><a href="#local-6989586621680819442"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1768"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLit"><span class="hs-identifier hs-var">genLit</span></a><span> </span><a href="#local-6989586621680819441"><span class="hs-identifier hs-var">opt</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="BlockId.html#infoTblLbl"><span class="hs-identifier hs-var">infoTblLbl</span></a><span> </span><a href="#local-6989586621680819442"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1769"></a><span>
</span><a name="line-1770"></a><span class="hs-identifier">genLit</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="CmmExpr.html#CmmHighStackMark"><span class="hs-identifier hs-var">CmmHighStackMark</span></a><span>
</span><a name="line-1771"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;genStaticLit - CmmHighStackMark unsupported!&quot;</span><span>
</span><a name="line-1772"></a><span>
</span><a name="line-1773"></a><span>
</span><a name="line-1774"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1775"></a><span class="hs-comment">-- * Misc</span><span>
</span><a name="line-1776"></a><span class="hs-comment">--</span><span>
</span><a name="line-1777"></a><span>
</span><a name="line-1778"></a><span class="hs-comment">-- | Find CmmRegs that get assigned and allocate them on the stack</span><span>
</span><a name="line-1779"></a><span class="hs-comment">--</span><span>
</span><a name="line-1780"></a><span class="hs-comment">-- Any register that gets written needs to be allcoated on the</span><span>
</span><a name="line-1781"></a><span class="hs-comment">-- stack. This avoids having to map a CmmReg to an equivalent SSA form</span><span>
</span><a name="line-1782"></a><span class="hs-comment">-- and avoids having to deal with Phi node insertion.  This is also</span><span>
</span><a name="line-1783"></a><span class="hs-comment">-- the approach recommended by LLVM developers.</span><span>
</span><a name="line-1784"></a><span class="hs-comment">--</span><span>
</span><a name="line-1785"></a><span class="hs-comment">-- On the other hand, this is unnecessarily verbose if the register in</span><span>
</span><a name="line-1786"></a><span class="hs-comment">-- question is never written. Therefore we skip it where we can to</span><span>
</span><a name="line-1787"></a><span class="hs-comment">-- save a few lines in the output and hopefully speed compilation up a</span><span>
</span><a name="line-1788"></a><span class="hs-comment">-- bit.</span><span>
</span><a name="line-1789"></a><span class="hs-identifier">funPrologue</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.Base.html#LiveGlobalRegs"><span class="hs-identifier hs-type">LiveGlobalRegs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#StmtData"><span class="hs-identifier hs-type">StmtData</span></a><span>
</span><a name="line-1790"></a><a name="funPrologue"><a href="LlvmCodeGen.CodeGen.html#funPrologue"><span class="hs-identifier">funPrologue</span></a></a><span> </span><a name="local-6989586621680819443"><a href="#local-6989586621680819443"><span class="hs-identifier">live</span></a></a><span> </span><a name="local-6989586621680819444"><a href="#local-6989586621680819444"><span class="hs-identifier">cmmBlocks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1791"></a><span>
</span><a name="line-1792"></a><span>  </span><a name="local-6989586621680819445"><a href="#local-6989586621680819445"><span class="hs-identifier">trash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getTrashRegs"><span class="hs-identifier hs-var">getTrashRegs</span></a><span>
</span><a name="line-1793"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">getAssignedRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="Hoopl.Block.html#O"><span class="hs-identifier hs-type">O</span></a><span> </span><a href="Hoopl.Block.html#O"><span class="hs-identifier hs-type">O</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1794"></a><span>      </span><a name="local-6989586621680819446"><a href="#local-6989586621680819446"><span class="hs-identifier">getAssignedRegs</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a><span> </span><a name="local-6989586621680819450"><a href="#local-6989586621680819450"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680819450"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1795"></a><span>      </span><span class="hs-comment">-- Calls will trash all registers. Unfortunately, this needs them to</span><span>
</span><a name="line-1796"></a><span>      </span><span class="hs-comment">-- be stack-allocated in the first place.</span><span>
</span><a name="line-1797"></a><span>      </span><span class="hs-identifier">getAssignedRegs</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-var">CmmUnsafeForeignCall</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680819451"><a href="#local-6989586621680819451"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="#local-6989586621680819445"><span class="hs-identifier hs-var">trash</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621680819451"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-1798"></a><span>      </span><span class="hs-identifier">getAssignedRegs</span><span> </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1799"></a><span>      </span><a name="local-6989586621680819447"><a href="#local-6989586621680819447"><span class="hs-identifier">getRegsBlock</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680819452"><a href="#local-6989586621680819452"><span class="hs-identifier">body</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="#local-6989586621680819446"><span class="hs-identifier hs-var">getAssignedRegs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Hoopl.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a><span> </span><a href="#local-6989586621680819452"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1800"></a><span>      </span><a name="local-6989586621680819448"><a href="#local-6989586621680819448"><span class="hs-identifier">assignedRegs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819447"><span class="hs-identifier hs-var">getRegsBlock</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Hoopl.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819444"><span class="hs-identifier hs-var">cmmBlocks</span></a><span>
</span><a name="line-1801"></a><span>      </span><a name="local-6989586621680819449"><a href="#local-6989586621680819449"><span class="hs-identifier">isLive</span></a></a><span> </span><a name="local-6989586621680819453"><a href="#local-6989586621680819453"><span class="hs-identifier">r</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819453"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="LlvmCodeGen.Regs.html#alwaysLive"><span class="hs-identifier hs-var">alwaysLive</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680819453"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819443"><span class="hs-identifier hs-var">live</span></a><span>
</span><a name="line-1802"></a><span>
</span><a name="line-1803"></a><span>  </span><a name="local-6989586621680819454"><a href="#local-6989586621680819454"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1804"></a><span>  </span><a name="local-6989586621680819466"><a href="#local-6989586621680819466"><span class="hs-identifier">stmtss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621680819448"><span class="hs-identifier hs-var">assignedRegs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680819455"><a href="#local-6989586621680819455"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1805"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680819455"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1806"></a><span>      </span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621680819456"><a href="#local-6989586621680819456"><span class="hs-identifier">un</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1807"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680819457"><a href="#local-6989586621680819457"><span class="hs-identifier">newv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819458"><a href="#local-6989586621680819458"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#allocReg"><span class="hs-identifier hs-var">allocReg</span></a><span> </span><a href="#local-6989586621680819455"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-1808"></a><span>        </span><a href="LlvmCodeGen.Base.html#varInsert"><span class="hs-identifier hs-var">varInsert</span></a><span> </span><a href="#local-6989586621680819456"><span class="hs-identifier hs-var">un</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819457"><span class="hs-identifier hs-var">newv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1809"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680819458"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-1810"></a><span>      </span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621680819459"><a href="#local-6989586621680819459"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1811"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819460"><a href="#local-6989586621680819460"><span class="hs-identifier">reg</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Regs.html#lmGlobalRegVar"><span class="hs-identifier hs-var">lmGlobalRegVar</span></a><span> </span><a href="#local-6989586621680819454"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819459"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1812"></a><span>            </span><a name="local-6989586621680819461"><a href="#local-6989586621680819461"><span class="hs-identifier">arg</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Regs.html#lmGlobalRegArg"><span class="hs-identifier hs-var">lmGlobalRegArg</span></a><span> </span><a href="#local-6989586621680819454"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819459"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1813"></a><span>            </span><a name="local-6989586621680819462"><a href="#local-6989586621680819462"><span class="hs-identifier">ty</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819460"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-1814"></a><span>            </span><a name="local-6989586621680819463"><a href="#local-6989586621680819463"><span class="hs-identifier">trash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMUndefLit"><span class="hs-identifier hs-var">LMUndefLit</span></a><span> </span><a href="#local-6989586621680819462"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1815"></a><span>            </span><a name="local-6989586621680819464"><a href="#local-6989586621680819464"><span class="hs-identifier">rval</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680819449"><span class="hs-identifier hs-var">isLive</span></a><span> </span><a href="#local-6989586621680819459"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621680819461"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680819463"><span class="hs-identifier hs-var">trash</span></a><span>
</span><a name="line-1816"></a><span>            </span><a name="local-6989586621680819465"><a href="#local-6989586621680819465"><span class="hs-identifier">alloc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.AbsSyn.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a><span> </span><a href="#local-6989586621680819460"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Alloca"><span class="hs-identifier hs-var">Alloca</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819460"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1817"></a><span>        </span><a href="LlvmCodeGen.Base.html#markStackReg"><span class="hs-identifier hs-var">markStackReg</span></a><span> </span><a href="#local-6989586621680819459"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1818"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680819465"><span class="hs-identifier hs-var">alloc</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><a href="#local-6989586621680819464"><span class="hs-identifier hs-var">rval</span></a><span> </span><a href="#local-6989586621680819460"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1819"></a><span>
</span><a name="line-1820"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621680819466"><span class="hs-identifier hs-var">stmtss</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1821"></a><span>
</span><a name="line-1822"></a><span class="hs-comment">-- | Function epilogue. Load STG variables to use as argument for call.</span><span>
</span><a name="line-1823"></a><span class="hs-comment">-- STG Liveness optimisation done here.</span><span>
</span><a name="line-1824"></a><span class="hs-identifier">funEpilogue</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.Base.html#LiveGlobalRegs"><span class="hs-identifier hs-type">LiveGlobalRegs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">)</span><span>
</span><a name="line-1825"></a><a name="funEpilogue"><a href="LlvmCodeGen.CodeGen.html#funEpilogue"><span class="hs-identifier">funEpilogue</span></a></a><span> </span><a name="local-6989586621680819467"><a href="#local-6989586621680819467"><span class="hs-identifier">live</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1826"></a><span>
</span><a name="line-1827"></a><span>    </span><span class="hs-comment">-- Have information and liveness optimisation is enabled?</span><span>
</span><a name="line-1828"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819468"><a href="#local-6989586621680819468"><span class="hs-identifier">liveRegs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.Regs.html#alwaysLive"><span class="hs-identifier hs-var">alwaysLive</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819467"><span class="hs-identifier hs-var">live</span></a><span>
</span><a name="line-1829"></a><span>        </span><a name="local-6989586621680819469"><a href="#local-6989586621680819469"><span class="hs-identifier">isSSE</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#FloatReg"><span class="hs-identifier hs-var">FloatReg</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1830"></a><span>        </span><span class="hs-identifier">isSSE</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#DoubleReg"><span class="hs-identifier hs-var">DoubleReg</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1831"></a><span>        </span><span class="hs-identifier">isSSE</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#XmmReg"><span class="hs-identifier hs-var">XmmReg</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1832"></a><span>        </span><span class="hs-identifier">isSSE</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#YmmReg"><span class="hs-identifier hs-var">YmmReg</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1833"></a><span>        </span><span class="hs-identifier">isSSE</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#ZmmReg"><span class="hs-identifier hs-var">ZmmReg</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1834"></a><span>        </span><span class="hs-identifier">isSSE</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1835"></a><span>
</span><a name="line-1836"></a><span>    </span><span class="hs-comment">-- Set to value or &quot;undef&quot; depending on whether the register is</span><span>
</span><a name="line-1837"></a><span>    </span><span class="hs-comment">-- actually live</span><span>
</span><a name="line-1838"></a><span>    </span><a name="local-6989586621680819470"><a href="#local-6989586621680819470"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1839"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819471"><a href="#local-6989586621680819471"><span class="hs-identifier">loadExpr</span></a></a><span> </span><a name="local-6989586621680819473"><a href="#local-6989586621680819473"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1840"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621680819474"><a href="#local-6989586621680819474"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680819475"><a href="#local-6989586621680819475"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmRegVal"><span class="hs-identifier hs-var">getCmmRegVal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="#local-6989586621680819473"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1841"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680819474"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819475"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1842"></a><span>        </span><a name="local-6989586621680819472"><a href="#local-6989586621680819472"><span class="hs-identifier">loadUndef</span></a></a><span> </span><a name="local-6989586621680819476"><a href="#local-6989586621680819476"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1843"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819477"><a href="#local-6989586621680819477"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.Regs.html#lmGlobalRegVar"><span class="hs-identifier hs-var">lmGlobalRegVar</span></a><span> </span><a href="#local-6989586621680819470"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819476"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1844"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMUndefLit"><span class="hs-identifier hs-var">LMUndefLit</span></a><span> </span><a href="#local-6989586621680819477"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1845"></a><span>    </span><a name="local-6989586621680819478"><a href="#local-6989586621680819478"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#getDynFlag"><span class="hs-identifier hs-var">getDynFlag</span></a><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span>
</span><a name="line-1846"></a><span>    </span><a name="local-6989586621680819480"><a href="#local-6989586621680819480"><span class="hs-identifier">loads</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="CodeGen.Platform.html#activeStgRegs"><span class="hs-identifier hs-var">activeStgRegs</span></a><span> </span><a href="#local-6989586621680819478"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680819479"><a href="#local-6989586621680819479"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1847"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680819479"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680819468"><span class="hs-identifier hs-var">liveRegs</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819471"><span class="hs-identifier hs-var">loadExpr</span></a><span> </span><a href="#local-6989586621680819479"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1848"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819469"><span class="hs-identifier hs-var">isSSE</span></a><span> </span><a href="#local-6989586621680819479"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680819472"><span class="hs-identifier hs-var">loadUndef</span></a><span> </span><a href="#local-6989586621680819479"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1849"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1850"></a><span>
</span><a name="line-1851"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680819481"><a href="#local-6989586621680819481"><span class="hs-identifier">vars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819482"><a href="#local-6989586621680819482"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-6989586621680819480"><span class="hs-identifier hs-var">loads</span></a><span>
</span><a name="line-1852"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span> </span><a href="#local-6989586621680819481"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621680819482"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1853"></a><span>
</span><a name="line-1854"></a><span>
</span><a name="line-1855"></a><span class="hs-comment">-- | A series of statements to trash all the STG registers.</span><span>
</span><a name="line-1856"></a><span class="hs-comment">--</span><span>
</span><a name="line-1857"></a><span class="hs-comment">-- In LLVM we pass the STG registers around everywhere in function calls.</span><span>
</span><a name="line-1858"></a><span class="hs-comment">-- So this means LLVM considers them live across the entire function, when</span><span>
</span><a name="line-1859"></a><span class="hs-comment">-- in reality they usually aren't. For Caller save registers across C calls</span><span>
</span><a name="line-1860"></a><span class="hs-comment">-- the saving and restoring of them is done by the Cmm code generator,</span><span>
</span><a name="line-1861"></a><span class="hs-comment">-- using Cmm local vars. So to stop LLVM saving them as well (and saving</span><span>
</span><a name="line-1862"></a><span class="hs-comment">-- all of them since it thinks they're always live, we trash them just</span><span>
</span><a name="line-1863"></a><span class="hs-comment">-- before the call by assigning the 'undef' value to them. The ones we</span><span>
</span><a name="line-1864"></a><span class="hs-comment">-- need are restored from the Cmm local var and the ones we don't need</span><span>
</span><a name="line-1865"></a><span class="hs-comment">-- are fine to be trashed.</span><span>
</span><a name="line-1866"></a><span class="hs-identifier">getTrashStmts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span>
</span><a name="line-1867"></a><a name="getTrashStmts"><a href="LlvmCodeGen.CodeGen.html#getTrashStmts"><span class="hs-identifier">getTrashStmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1868"></a><span>  </span><a name="local-6989586621680819483"><a href="#local-6989586621680819483"><span class="hs-identifier">regs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getTrashRegs"><span class="hs-identifier hs-var">getTrashRegs</span></a><span>
</span><a name="line-1869"></a><span>  </span><a name="local-6989586621680819487"><a href="#local-6989586621680819487"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621680819483"><span class="hs-identifier hs-var">regs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621680819484"><a href="#local-6989586621680819484"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1870"></a><span>    </span><a name="local-6989586621680819485"><a href="#local-6989586621680819485"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="#local-6989586621680819484"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1871"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819486"><a href="#local-6989586621680819486"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLower"><span class="hs-identifier hs-var">pLower</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819485"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-1872"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Store"><span class="hs-identifier hs-var">Store</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMUndefLit"><span class="hs-identifier hs-var">LMUndefLit</span></a><span> </span><a href="#local-6989586621680819486"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819485"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-1873"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><a href="#local-6989586621680819487"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-1874"></a><span>
</span><a name="line-1875"></a><span class="hs-identifier">getTrashRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a><span class="hs-special">]</span><span>
</span><a name="line-1876"></a><a name="getTrashRegs"><a href="LlvmCodeGen.CodeGen.html#getTrashRegs"><span class="hs-identifier">getTrashRegs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680819488"><a href="#local-6989586621680819488"><span class="hs-identifier">plat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#getLlvmPlatform"><span class="hs-identifier hs-var">getLlvmPlatform</span></a><span>
</span><a name="line-1877"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="CodeGen.Platform.html#callerSaves"><span class="hs-identifier hs-var">callerSaves</span></a><span> </span><a href="#local-6989586621680819488"><span class="hs-identifier hs-var">plat</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CodeGen.Platform.html#activeStgRegs"><span class="hs-identifier hs-var">activeStgRegs</span></a><span> </span><a href="#local-6989586621680819488"><span class="hs-identifier hs-var">plat</span></a><span class="hs-special">)</span><span>
</span><a name="line-1878"></a><span>
</span><a name="line-1879"></a><span class="hs-comment">-- | Get a function pointer to the CLabel specified.</span><span>
</span><a name="line-1880"></a><span class="hs-comment">--</span><span>
</span><a name="line-1881"></a><span class="hs-comment">-- This is for Haskell functions, function type is assumed, so doesn't work</span><span>
</span><a name="line-1882"></a><span class="hs-comment">-- with foreign functions.</span><span>
</span><a name="line-1883"></a><span class="hs-identifier">getHsFunc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.Base.html#LiveGlobalRegs"><span class="hs-identifier hs-type">LiveGlobalRegs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1884"></a><a name="getHsFunc"><a href="LlvmCodeGen.CodeGen.html#getHsFunc"><span class="hs-identifier">getHsFunc</span></a></a><span> </span><a name="local-6989586621680819489"><a href="#local-6989586621680819489"><span class="hs-identifier">live</span></a></a><span> </span><a name="local-6989586621680819490"><a href="#local-6989586621680819490"><span class="hs-identifier">lbl</span></a></a><span>
</span><a name="line-1885"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680819491"><a href="#local-6989586621680819491"><span class="hs-identifier">fty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#llvmFunTy"><span class="hs-identifier hs-var">llvmFunTy</span></a><span> </span><a href="#local-6989586621680819489"><span class="hs-identifier hs-var">live</span></a><span>
</span><a name="line-1886"></a><span>       </span><a name="local-6989586621680819492"><a href="#local-6989586621680819492"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#strCLabel_llvm"><span class="hs-identifier hs-var">strCLabel_llvm</span></a><span> </span><a href="#local-6989586621680819490"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-1887"></a><span>       </span><a href="LlvmCodeGen.CodeGen.html#getHsFunc%27"><span class="hs-identifier hs-var">getHsFunc'</span></a><span> </span><a href="#local-6989586621680819492"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680819491"><span class="hs-identifier hs-var">fty</span></a><span>
</span><a name="line-1888"></a><span>
</span><a name="line-1889"></a><span class="hs-identifier">getHsFunc'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Llvm.Types.html#LMString"><span class="hs-identifier hs-type">LMString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1890"></a><a name="getHsFunc%27"><a href="LlvmCodeGen.CodeGen.html#getHsFunc%27"><span class="hs-identifier">getHsFunc'</span></a></a><span> </span><a name="local-6989586621680819493"><a href="#local-6989586621680819493"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621680819494"><a href="#local-6989586621680819494"><span class="hs-identifier">fty</span></a></a><span>
</span><a name="line-1891"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680819495"><a href="#local-6989586621680819495"><span class="hs-identifier">fun</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#getGlobalPtr"><span class="hs-identifier hs-var">getGlobalPtr</span></a><span> </span><a href="#local-6989586621680819493"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1892"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="Llvm.Types.html#getVarType"><span class="hs-identifier hs-var">getVarType</span></a><span> </span><a href="#local-6989586621680819495"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680819494"><span class="hs-identifier hs-var">fty</span></a><span>
</span><a name="line-1893"></a><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819495"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1894"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680819496"><a href="#local-6989586621680819496"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819497"><a href="#local-6989586621680819497"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680819494"><span class="hs-identifier hs-var">fty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1895"></a><span>                               </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.AbsSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="Llvm.Types.html#LM_Bitcast"><span class="hs-identifier hs-var">LM_Bitcast</span></a><span> </span><a href="#local-6989586621680819495"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#pLift"><span class="hs-identifier hs-var">pLift</span></a><span> </span><a href="#local-6989586621680819494"><span class="hs-identifier hs-var">fty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1896"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span>  </span><span class="hs-special">(</span><a href="#local-6989586621680819496"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="#local-6989586621680819497"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1897"></a><span>
</span><a name="line-1898"></a><span class="hs-comment">-- | Create a new local var</span><span>
</span><a name="line-1899"></a><span class="hs-identifier">mkLocalVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1900"></a><a name="mkLocalVar"><a href="LlvmCodeGen.CodeGen.html#mkLocalVar"><span class="hs-identifier">mkLocalVar</span></a></a><span> </span><a name="local-6989586621680819498"><a href="#local-6989586621680819498"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1901"></a><span>    </span><a name="local-6989586621680819499"><a href="#local-6989586621680819499"><span class="hs-identifier">un</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getUniqueM</span><span>
</span><a name="line-1902"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMLocalVar"><span class="hs-identifier hs-var">LMLocalVar</span></a><span> </span><a href="#local-6989586621680819499"><span class="hs-identifier hs-var">un</span></a><span> </span><a href="#local-6989586621680819498"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1903"></a><span>
</span><a name="line-1904"></a><span>
</span><a name="line-1905"></a><span class="hs-comment">-- | Execute an expression, assigning result to a var</span><span>
</span><a name="line-1906"></a><span class="hs-identifier">doExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.AbsSyn.html#LlvmExpression"><span class="hs-identifier hs-type">LlvmExpression</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.AbsSyn.html#LlvmStatement"><span class="hs-identifier hs-type">LlvmStatement</span></a><span class="hs-special">)</span><span>
</span><a name="line-1907"></a><a name="doExpr"><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier">doExpr</span></a></a><span> </span><a name="local-6989586621680819500"><a href="#local-6989586621680819500"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819501"><a href="#local-6989586621680819501"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1908"></a><span>    </span><a name="local-6989586621680819502"><a href="#local-6989586621680819502"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkLocalVar"><span class="hs-identifier hs-var">mkLocalVar</span></a><span> </span><a href="#local-6989586621680819500"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1909"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819502"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="Llvm.AbsSyn.html#Assignment"><span class="hs-identifier hs-var">Assignment</span></a><span> </span><a href="#local-6989586621680819502"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621680819501"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1910"></a><span>
</span><a name="line-1911"></a><span>
</span><a name="line-1912"></a><span class="hs-comment">-- | Expand CmmRegOff</span><span>
</span><a name="line-1913"></a><span class="hs-identifier">expandCmmReg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-1914"></a><a name="expandCmmReg"><a href="LlvmCodeGen.CodeGen.html#expandCmmReg"><span class="hs-identifier">expandCmmReg</span></a></a><span> </span><a name="local-6989586621680819503"><a href="#local-6989586621680819503"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680819504"><a href="#local-6989586621680819504"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819505"><a href="#local-6989586621680819505"><span class="hs-identifier">off</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1915"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680819506"><a href="#local-6989586621680819506"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621680819503"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680819504"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1916"></a><span>        </span><a name="local-6989586621680819507"><a href="#local-6989586621680819507"><span class="hs-identifier">voff</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680819505"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819506"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1917"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><a href="#local-6989586621680819506"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><a href="#local-6989586621680819504"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819507"><span class="hs-identifier hs-var">voff</span></a><span class="hs-special">]</span><span>
</span><a name="line-1918"></a><span>
</span><a name="line-1919"></a><span>
</span><a name="line-1920"></a><span class="hs-comment">-- | Convert a block id into a appropriate Llvm label</span><span>
</span><a name="line-1921"></a><span class="hs-identifier">blockIdToLlvm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1922"></a><a name="blockIdToLlvm"><a href="LlvmCodeGen.CodeGen.html#blockIdToLlvm"><span class="hs-identifier">blockIdToLlvm</span></a></a><span> </span><a name="local-6989586621680819508"><a href="#local-6989586621680819508"><span class="hs-identifier">bid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLocalVar"><span class="hs-identifier hs-var">LMLocalVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getUnique</span><span> </span><a href="#local-6989586621680819508"><span class="hs-identifier hs-var">bid</span></a><span class="hs-special">)</span><span> </span><a href="Llvm.Types.html#LMLabel"><span class="hs-identifier hs-var">LMLabel</span></a><span>
</span><a name="line-1923"></a><span>
</span><a name="line-1924"></a><span class="hs-comment">-- | Create Llvm int Literal</span><span>
</span><a name="line-1925"></a><span class="hs-identifier">mkIntLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621680818452"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818452"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1926"></a><a name="mkIntLit"><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier">mkIntLit</span></a></a><span> </span><a name="local-6989586621680819509"><a href="#local-6989586621680819509"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621680819510"><a href="#local-6989586621680819510"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Llvm.Types.html#LMLitVar"><span class="hs-identifier hs-var">LMLitVar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Llvm.Types.html#LMIntLit"><span class="hs-identifier hs-var">LMIntLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621680819510"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819509"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1927"></a><span>
</span><a name="line-1928"></a><span class="hs-comment">-- | Convert int type to a LLvmVar of word or i32 size</span><span>
</span><a name="line-1929"></a><span class="hs-identifier">toI32</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621680818451"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680818451"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1930"></a><a name="toI32"><a href="LlvmCodeGen.CodeGen.html#toI32"><span class="hs-identifier">toI32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="Llvm.Types.html#i32"><span class="hs-identifier hs-var">i32</span></a><span>
</span><a name="line-1931"></a><span>
</span><a name="line-1932"></a><span class="hs-identifier">toIWord</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621680818450"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818450"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1933"></a><a name="toIWord"><a href="LlvmCodeGen.CodeGen.html#toIWord"><span class="hs-identifier">toIWord</span></a></a><span> </span><a name="local-6989586621680819511"><a href="#local-6989586621680819511"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.Types.html#llvmWord"><span class="hs-identifier hs-var">llvmWord</span></a><span> </span><a href="#local-6989586621680819511"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1934"></a><span>
</span><a name="line-1935"></a><span>
</span><a name="line-1936"></a><span class="hs-comment">-- | Error functions</span><span>
</span><a name="line-1937"></a><span class="hs-identifier">panic</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818449"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1938"></a><a name="panic"><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier">panic</span></a></a><span> </span><a name="local-6989586621680819512"><a href="#local-6989586621680819512"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Outputable.panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;LlvmCodeGen.CodeGen.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819512"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1939"></a><span>
</span><a name="line-1940"></a><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818448"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1941"></a><a name="pprPanic"><a href="LlvmCodeGen.CodeGen.html#pprPanic"><span class="hs-identifier">pprPanic</span></a></a><span> </span><a name="local-6989586621680819513"><a href="#local-6989586621680819513"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621680819514"><a href="#local-6989586621680819514"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Outputable.pprPanic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;LlvmCodeGen.CodeGen.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680819513"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680819514"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-1942"></a><span>
</span><a name="line-1943"></a><span>
</span><a name="line-1944"></a><span class="hs-comment">-- | Returns TBAA meta data by unique</span><span>
</span><a name="line-1945"></a><span class="hs-identifier">getTBAAMeta</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Unique</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">[</span><a href="Llvm.MetaData.html#MetaAnnot"><span class="hs-identifier hs-type">MetaAnnot</span></a><span class="hs-special">]</span><span>
</span><a name="line-1946"></a><a name="getTBAAMeta"><a href="LlvmCodeGen.CodeGen.html#getTBAAMeta"><span class="hs-identifier">getTBAAMeta</span></a></a><span> </span><a name="local-6989586621680819515"><a href="#local-6989586621680819515"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1947"></a><span>    </span><a name="local-6989586621680819516"><a href="#local-6989586621680819516"><span class="hs-identifier">mi</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LlvmCodeGen.Base.html#getUniqMeta"><span class="hs-identifier hs-var">getUniqMeta</span></a><span> </span><a href="#local-6989586621680819515"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-1948"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Llvm.MetaData.html#MetaAnnot"><span class="hs-identifier hs-var">MetaAnnot</span></a><span> </span><a href="LlvmCodeGen.Regs.html#tbaa"><span class="hs-identifier hs-var">tbaa</span></a><span> </span><span class="hs-special">(</span><a href="Llvm.MetaData.html#MetaNode"><span class="hs-identifier hs-var">MetaNode</span></a><span> </span><a href="#local-6989586621680819517"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680819517"><a href="#local-6989586621680819517"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819516"><span class="hs-identifier hs-var">mi</span></a><span class="hs-special">]</span><span>
</span><a name="line-1949"></a><span>
</span><a name="line-1950"></a><span class="hs-comment">-- | Returns TBAA meta data for given register</span><span>
</span><a name="line-1951"></a><span class="hs-identifier">getTBAARegMeta</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">[</span><a href="Llvm.MetaData.html#MetaAnnot"><span class="hs-identifier hs-type">MetaAnnot</span></a><span class="hs-special">]</span><span>
</span><a name="line-1952"></a><a name="getTBAARegMeta"><a href="LlvmCodeGen.CodeGen.html#getTBAARegMeta"><span class="hs-identifier">getTBAARegMeta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getTBAAMeta"><span class="hs-identifier hs-var">getTBAAMeta</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="LlvmCodeGen.Regs.html#getTBAA"><span class="hs-identifier hs-var">getTBAA</span></a><span>
</span><a name="line-1953"></a><span>
</span><a name="line-1954"></a><span>
</span><a name="line-1955"></a><span class="hs-comment">-- | A more convenient way of accumulating LLVM statements and declarations.</span><span>
</span><a name="line-1956"></a><span class="hs-keyword">data</span><span> </span><a name="LlvmAccum"><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier">LlvmAccum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="LlvmAccum"><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier">LlvmAccum</span></a></a><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span>
</span><a name="line-1957"></a><span>
</span><a name="line-1958"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1959"></a><span>  </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><a name="local-6989586621680818146"><a href="#local-6989586621680818146"><span class="hs-identifier">stmtsA</span></a></a><span> </span><a name="local-6989586621680818147"><a href="#local-6989586621680818147"><span class="hs-identifier">declsA</span></a></a><span> </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><a name="local-6989586621680818148"><a href="#local-6989586621680818148"><span class="hs-identifier">stmtsB</span></a></a><span> </span><a name="local-6989586621680818149"><a href="#local-6989586621680818149"><span class="hs-identifier">declsB</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1960"></a><span>        </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818146"><span class="hs-identifier hs-var">stmtsA</span></a><span> </span><span class="hs-operator hs-var">Semigroup.&lt;&gt;</span><span> </span><a href="#local-6989586621680818148"><span class="hs-identifier hs-var">stmtsB</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680818147"><span class="hs-identifier hs-var">declsA</span></a><span> </span><span class="hs-operator hs-var">Semigroup.&lt;&gt;</span><span> </span><a href="#local-6989586621680818149"><span class="hs-identifier hs-var">declsB</span></a><span class="hs-special">)</span><span>
</span><a name="line-1961"></a><span>
</span><a name="line-1962"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1963"></a><span>    </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><span class="hs-identifier hs-var">nilOL</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1964"></a><span>    </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">Semigroup.&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-1965"></a><span>
</span><a name="line-1966"></a><span class="hs-identifier">liftExprData</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1967"></a><a name="liftExprData"><a href="LlvmCodeGen.CodeGen.html#liftExprData"><span class="hs-identifier">liftExprData</span></a></a><span> </span><a name="local-6989586621680819518"><a href="#local-6989586621680819518"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1968"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819519"><a href="#local-6989586621680819519"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819520"><a href="#local-6989586621680819520"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819521"><a href="#local-6989586621680819521"><span class="hs-identifier">decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><a href="#local-6989586621680819518"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-1969"></a><span>    </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><a href="#local-6989586621680819520"><span class="hs-identifier hs-var">stmts</span></a><span> </span><a href="#local-6989586621680819521"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-1970"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680819519"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-1971"></a><span>
</span><a name="line-1972"></a><span class="hs-identifier">statement</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Llvm.AbsSyn.html#LlvmStatement"><span class="hs-identifier hs-type">LlvmStatement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1973"></a><a name="statement"><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier">statement</span></a></a><span> </span><a name="local-6989586621680819522"><a href="#local-6989586621680819522"><span class="hs-identifier">stmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="#local-6989586621680819522"><span class="hs-identifier hs-var">stmt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1974"></a><span>
</span><a name="line-1975"></a><span class="hs-identifier">doExprW</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Llvm.Types.html#LlvmType"><span class="hs-identifier hs-type">LlvmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Llvm.AbsSyn.html#LlvmExpression"><span class="hs-identifier hs-type">LlvmExpression</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1976"></a><a name="doExprW"><a href="LlvmCodeGen.CodeGen.html#doExprW"><span class="hs-identifier">doExprW</span></a></a><span> </span><a name="local-6989586621680819523"><a href="#local-6989586621680819523"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621680819524"><a href="#local-6989586621680819524"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1977"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819525"><a href="#local-6989586621680819525"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680819526"><a href="#local-6989586621680819526"><span class="hs-identifier">stmt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#doExpr"><span class="hs-identifier hs-var">doExpr</span></a><span> </span><a href="#local-6989586621680819523"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680819524"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1978"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#statement"><span class="hs-identifier hs-var">statement</span></a><span> </span><a href="#local-6989586621680819526"><span class="hs-identifier hs-var">stmt</span></a><span>
</span><a name="line-1979"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680819525"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-1980"></a><span>
</span><a name="line-1981"></a><span class="hs-identifier">exprToVarW</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1982"></a><a name="exprToVarW"><a href="LlvmCodeGen.CodeGen.html#exprToVarW"><span class="hs-identifier">exprToVarW</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#liftExprData"><span class="hs-identifier hs-var">liftExprData</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="LlvmCodeGen.CodeGen.html#exprToVar"><span class="hs-identifier hs-var">exprToVar</span></a><span>
</span><a name="line-1983"></a><span>
</span><a name="line-1984"></a><span class="hs-identifier">runExprData</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="LlvmCodeGen.CodeGen.html#ExprData"><span class="hs-identifier hs-type">ExprData</span></a><span>
</span><a name="line-1985"></a><a name="runExprData"><a href="LlvmCodeGen.CodeGen.html#runExprData"><span class="hs-identifier">runExprData</span></a></a><span> </span><a name="local-6989586621680819527"><a href="#local-6989586621680819527"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1986"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680819528"><a href="#local-6989586621680819528"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><a name="local-6989586621680819529"><a href="#local-6989586621680819529"><span class="hs-identifier">stmts</span></a></a><span> </span><a name="local-6989586621680819530"><a href="#local-6989586621680819530"><span class="hs-identifier">decls</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">runWriterT</span><span> </span><a href="#local-6989586621680819527"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-1987"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819528"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819529"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819530"><span class="hs-identifier hs-var">decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-1988"></a><span>
</span><a name="line-1989"></a><span class="hs-identifier">runStmtsDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><a href="LlvmCodeGen.CodeGen.html#LlvmStatements"><span class="hs-identifier hs-type">LlvmStatements</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="LlvmCodeGen.Base.html#LlvmCmmDecl"><span class="hs-identifier hs-type">LlvmCmmDecl</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1990"></a><a name="runStmtsDecls"><a href="LlvmCodeGen.CodeGen.html#runStmtsDecls"><span class="hs-identifier">runStmtsDecls</span></a></a><span> </span><a name="local-6989586621680819531"><a href="#local-6989586621680819531"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1991"></a><span>    </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><a name="local-6989586621680819532"><a href="#local-6989586621680819532"><span class="hs-identifier">stmts</span></a></a><span> </span><a name="local-6989586621680819533"><a href="#local-6989586621680819533"><span class="hs-identifier">decls</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">execWriterT</span><span> </span><a href="#local-6989586621680819531"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-1992"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680819532"><span class="hs-identifier hs-var">stmts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680819533"><span class="hs-identifier hs-var">decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-1993"></a><span>
</span><a name="line-1994"></a><span class="hs-identifier">getCmmRegW</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1995"></a><a name="getCmmRegW"><a href="LlvmCodeGen.CodeGen.html#getCmmRegW"><span class="hs-identifier">getCmmRegW</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getCmmReg"><span class="hs-identifier hs-var">getCmmReg</span></a><span>
</span><a name="line-1996"></a><span>
</span><a name="line-1997"></a><span class="hs-identifier">genLoadW</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="LlvmCodeGen.CodeGen.html#Atomic"><span class="hs-identifier hs-type">Atomic</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CmmType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><a href="Llvm.Types.html#LlvmVar"><span class="hs-identifier hs-type">LlvmVar</span></a><span>
</span><a name="line-1998"></a><a name="genLoadW"><a href="LlvmCodeGen.CodeGen.html#genLoadW"><span class="hs-identifier">genLoadW</span></a></a><span> </span><a name="local-6989586621680819534"><a href="#local-6989586621680819534"><span class="hs-identifier">atomic</span></a></a><span> </span><a name="local-6989586621680819535"><a href="#local-6989586621680819535"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621680819536"><a href="#local-6989586621680819536"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#liftExprData"><span class="hs-identifier hs-var">liftExprData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#genLoad"><span class="hs-identifier hs-var">genLoad</span></a><span> </span><a href="#local-6989586621680819534"><span class="hs-identifier hs-var">atomic</span></a><span> </span><a href="#local-6989586621680819535"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621680819536"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1999"></a><span>
</span><a name="line-2000"></a><span class="hs-identifier">doTrashStmts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">WriterT</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-type">LlvmAccum</span></a><span> </span><a href="LlvmCodeGen.Base.html#LlvmM"><span class="hs-identifier hs-type">LlvmM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2001"></a><a name="doTrashStmts"><a href="LlvmCodeGen.CodeGen.html#doTrashStmts"><span class="hs-identifier">doTrashStmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2002"></a><span>    </span><a name="local-6989586621680819537"><a href="#local-6989586621680819537"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><a href="LlvmCodeGen.CodeGen.html#getTrashStmts"><span class="hs-identifier hs-var">getTrashStmts</span></a><span>
</span><a name="line-2003"></a><span>    </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="LlvmCodeGen.CodeGen.html#LlvmAccum"><span class="hs-identifier hs-var">LlvmAccum</span></a><span> </span><a href="#local-6989586621680819537"><span class="hs-identifier hs-var">stmts</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-2004"></a><span>
</span><a name="line-2005"></a><span class="hs-comment">-- | Return element of single-element list; 'panic' if list is not a single-element list</span><span>
</span><a name="line-2006"></a><span class="hs-identifier">singletonPanic</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680818150"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680818150"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-2007"></a><a name="singletonPanic"><a href="LlvmCodeGen.CodeGen.html#singletonPanic"><span class="hs-identifier">singletonPanic</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621680819538"><a href="#local-6989586621680819538"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680819538"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2008"></a><span class="hs-identifier">singletonPanic</span><span> </span><a name="local-6989586621680819539"><a href="#local-6989586621680819539"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="LlvmCodeGen.CodeGen.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><a href="#local-6989586621680819539"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-2009"></a></pre></body></html>