<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">{- |
   Module     : System.Log.Handler.Syslog
   Copyright  : Copyright (C) 2004-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt; 
   Stability  : provisional
   Portability: portable

Syslog handler for the Haskell Logging Framework

Written by John Goerzen, jgoerzen\@complete.org

This module implements an interface to the Syslog service commonly
found in Unix\/Linux systems.  This interface is primarily of interest to
developers of servers, as Syslog does not typically display messages in
an interactive fashion.

This module is written in pure Haskell and is capable of logging to a local
or remote machine using the Syslog protocol.

You can create a new Syslog 'LogHandler' by calling 'openlog'.

More information on the Haskell Logging Framework can be found at
&quot;System.Log.Logger&quot;.  This module can also be used outside
of the rest of that framework for those interested in that.
-}</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Log.Handler.Syslog</span><span class="hs-special">(</span><span>
</span><a name="line-32"></a><span>                                       </span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-type">SyslogHandler</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- No constructors.</span><span>
</span><a name="line-33"></a><span>                                       </span><span class="hs-comment">-- * Handler Initialization</span><span>
</span><a name="line-34"></a><span>                                       </span><a href="System.Log.Handler.Syslog.html#openlog"><span class="hs-identifier hs-var">openlog</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>                                       </span><span class="hs-comment">-- * Advanced handler initialization</span><span>
</span><a name="line-36"></a><span class="hs-cpp">#ifndef mingw32_HOST_OS
</span><span>                                       </span><a href="System.Log.Handler.Syslog.html#openlog_local"><span class="hs-identifier hs-var">openlog_local</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span class="hs-cpp">#endif
</span><span>                                       </span><a href="System.Log.Handler.Syslog.html#openlog_remote"><span class="hs-identifier hs-var">openlog_remote</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>                                       </span><a href="System.Log.Handler.Syslog.html#openlog_generic"><span class="hs-identifier hs-var">openlog_generic</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>                                       </span><span class="hs-comment">-- * Data Types</span><span>
</span><a name="line-42"></a><span>                                       </span><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier hs-type">Facility</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>                                       </span><a href="System.Log.Handler.Syslog.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>                                       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">E</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="System.Log.html"><span class="hs-identifier">System.Log</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="System.Log.Formatter.html"><span class="hs-identifier">System.Log.Formatter</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="System.Log.Handler.html"><span class="hs-identifier">System.Log.Handler</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Network.Socket</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Network.BSD</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-54"></a><span class="hs-cpp">#ifndef mingw32_HOST_OS
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Posix.Process</span><span class="hs-special">(</span><span class="hs-identifier hs-var">getProcessID</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-cpp">#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">when</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-identifier">code_of_pri</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-61"></a><a name="code_of_pri"><a href="System.Log.Handler.Syslog.html#code_of_pri"><span class="hs-identifier">code_of_pri</span></a></a><span> </span><a name="local-6989586621679057305"><a href="#local-6989586621679057305"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679057305"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-62"></a><span>                       </span><a href="System.Log.html#EMERGENCY"><span class="hs-identifier hs-var">EMERGENCY</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-63"></a><span>                       </span><a href="System.Log.html#ALERT"><span class="hs-identifier hs-var">ALERT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-64"></a><span>                       </span><a href="System.Log.html#CRITICAL"><span class="hs-identifier hs-var">CRITICAL</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-65"></a><span>                       </span><a href="System.Log.html#ERROR"><span class="hs-identifier hs-var">ERROR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-66"></a><span>                       </span><a href="System.Log.html#WARNING"><span class="hs-identifier hs-var">WARNING</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-67"></a><span>                       </span><a href="System.Log.html#NOTICE"><span class="hs-identifier hs-var">NOTICE</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-68"></a><span>                       </span><a href="System.Log.html#INFO"><span class="hs-identifier hs-var">INFO</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-69"></a><span>                       </span><a href="System.Log.html#DEBUG"><span class="hs-identifier hs-var">DEBUG</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">{- | Facilities are used by the system to determine where messages
are sent. -}</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-keyword">data</span><span> </span><a name="Facility"><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier">Facility</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-75"></a><span>              </span><a name="KERN"><a href="System.Log.Handler.Syslog.html#KERN"><span class="hs-identifier">KERN</span></a></a><span>                      </span><span class="hs-comment">-- ^ Kernel messages; you should likely never use this in your programs</span><span>
</span><a name="line-76"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="USER"><a href="System.Log.Handler.Syslog.html#USER"><span class="hs-identifier">USER</span></a></a><span>                    </span><span class="hs-comment">-- ^ General userland messages.  Use this if nothing else is appropriate</span><span>
</span><a name="line-77"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="MAIL"><a href="System.Log.Handler.Syslog.html#MAIL"><span class="hs-identifier">MAIL</span></a></a><span>                    </span><span class="hs-comment">-- ^ E-Mail system</span><span>
</span><a name="line-78"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="DAEMON"><a href="System.Log.Handler.Syslog.html#DAEMON"><span class="hs-identifier">DAEMON</span></a></a><span>                  </span><span class="hs-comment">-- ^ Daemon (server process) messages</span><span>
</span><a name="line-79"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="AUTH"><a href="System.Log.Handler.Syslog.html#AUTH"><span class="hs-identifier">AUTH</span></a></a><span>                    </span><span class="hs-comment">-- ^ Authentication or security messages</span><span>
</span><a name="line-80"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="SYSLOG"><a href="System.Log.Handler.Syslog.html#SYSLOG"><span class="hs-identifier">SYSLOG</span></a></a><span>                  </span><span class="hs-comment">-- ^ Internal syslog messages; you should likely never use this in your programs</span><span>
</span><a name="line-81"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LPR"><a href="System.Log.Handler.Syslog.html#LPR"><span class="hs-identifier">LPR</span></a></a><span>                     </span><span class="hs-comment">-- ^ Printer messages</span><span>
</span><a name="line-82"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="NEWS"><a href="System.Log.Handler.Syslog.html#NEWS"><span class="hs-identifier">NEWS</span></a></a><span>                    </span><span class="hs-comment">-- ^ Usenet news</span><span>
</span><a name="line-83"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="UUCP"><a href="System.Log.Handler.Syslog.html#UUCP"><span class="hs-identifier">UUCP</span></a></a><span>                    </span><span class="hs-comment">-- ^ UUCP messages</span><span>
</span><a name="line-84"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="CRON"><a href="System.Log.Handler.Syslog.html#CRON"><span class="hs-identifier">CRON</span></a></a><span>                    </span><span class="hs-comment">-- ^ Cron messages</span><span>
</span><a name="line-85"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="AUTHPRIV"><a href="System.Log.Handler.Syslog.html#AUTHPRIV"><span class="hs-identifier">AUTHPRIV</span></a></a><span>                </span><span class="hs-comment">-- ^ Private authentication messages</span><span>
</span><a name="line-86"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="FTP"><a href="System.Log.Handler.Syslog.html#FTP"><span class="hs-identifier">FTP</span></a></a><span>                     </span><span class="hs-comment">-- ^ FTP messages</span><span>
</span><a name="line-87"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LOCAL0"><a href="System.Log.Handler.Syslog.html#LOCAL0"><span class="hs-identifier">LOCAL0</span></a></a><span>                  </span><span class="hs-comment">-- ^ LOCAL0 through LOCAL7 are reserved for you to customize as you wish</span><span>
</span><a name="line-88"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LOCAL1"><a href="System.Log.Handler.Syslog.html#LOCAL1"><span class="hs-identifier">LOCAL1</span></a></a><span>
</span><a name="line-89"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LOCAL2"><a href="System.Log.Handler.Syslog.html#LOCAL2"><span class="hs-identifier">LOCAL2</span></a></a><span>
</span><a name="line-90"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LOCAL3"><a href="System.Log.Handler.Syslog.html#LOCAL3"><span class="hs-identifier">LOCAL3</span></a></a><span>
</span><a name="line-91"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LOCAL4"><a href="System.Log.Handler.Syslog.html#LOCAL4"><span class="hs-identifier">LOCAL4</span></a></a><span>
</span><a name="line-92"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LOCAL5"><a href="System.Log.Handler.Syslog.html#LOCAL5"><span class="hs-identifier">LOCAL5</span></a></a><span>
</span><a name="line-93"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LOCAL6"><a href="System.Log.Handler.Syslog.html#LOCAL6"><span class="hs-identifier">LOCAL6</span></a></a><span>
</span><a name="line-94"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="LOCAL7"><a href="System.Log.Handler.Syslog.html#LOCAL7"><span class="hs-identifier">LOCAL7</span></a></a><span>
</span><a name="line-95"></a><span>                </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-identifier">code_of_fac</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier hs-type">Facility</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-98"></a><a name="code_of_fac"><a href="System.Log.Handler.Syslog.html#code_of_fac"><span class="hs-identifier">code_of_fac</span></a></a><span> </span><a name="local-6989586621679057306"><a href="#local-6989586621679057306"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679057306"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-99"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#KERN"><span class="hs-identifier hs-var">KERN</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-100"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#USER"><span class="hs-identifier hs-var">USER</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-101"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#MAIL"><span class="hs-identifier hs-var">MAIL</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-102"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#DAEMON"><span class="hs-identifier hs-var">DAEMON</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-103"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#AUTH"><span class="hs-identifier hs-var">AUTH</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-104"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#SYSLOG"><span class="hs-identifier hs-var">SYSLOG</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-105"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LPR"><span class="hs-identifier hs-var">LPR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-106"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#NEWS"><span class="hs-identifier hs-var">NEWS</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-107"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#UUCP"><span class="hs-identifier hs-var">UUCP</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-108"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#CRON"><span class="hs-identifier hs-var">CRON</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-109"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#AUTHPRIV"><span class="hs-identifier hs-var">AUTHPRIV</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-110"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#FTP"><span class="hs-identifier hs-var">FTP</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">11</span><span>
</span><a name="line-111"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LOCAL0"><span class="hs-identifier hs-var">LOCAL0</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-112"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LOCAL1"><span class="hs-identifier hs-var">LOCAL1</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">17</span><span>
</span><a name="line-113"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LOCAL2"><span class="hs-identifier hs-var">LOCAL2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">18</span><span>
</span><a name="line-114"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LOCAL3"><span class="hs-identifier hs-var">LOCAL3</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">19</span><span>
</span><a name="line-115"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LOCAL4"><span class="hs-identifier hs-var">LOCAL4</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">20</span><span>
</span><a name="line-116"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LOCAL5"><span class="hs-identifier hs-var">LOCAL5</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">21</span><span>
</span><a name="line-117"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LOCAL6"><span class="hs-identifier hs-var">LOCAL6</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">22</span><span>
</span><a name="line-118"></a><span>                       </span><a href="System.Log.Handler.Syslog.html#LOCAL7"><span class="hs-identifier hs-var">LOCAL7</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">23</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-identifier">makeCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier hs-type">Facility</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-121"></a><a name="makeCode"><a href="System.Log.Handler.Syslog.html#makeCode"><span class="hs-identifier">makeCode</span></a></a><span> </span><a name="local-6989586621679057307"><a href="#local-6989586621679057307"><span class="hs-identifier">fac</span></a></a><span> </span><a name="local-6989586621679057308"><a href="#local-6989586621679057308"><span class="hs-identifier">pri</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679057309"><a href="#local-6989586621679057309"><span class="hs-identifier">faccode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Log.Handler.Syslog.html#code_of_fac"><span class="hs-identifier hs-var">code_of_fac</span></a><span> </span><a href="#local-6989586621679057307"><span class="hs-identifier hs-var">fac</span></a><span>
</span><a name="line-123"></a><span>        </span><a name="local-6989586621679057310"><a href="#local-6989586621679057310"><span class="hs-identifier">pricode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Log.Handler.Syslog.html#code_of_pri"><span class="hs-identifier hs-var">code_of_pri</span></a><span> </span><a href="#local-6989586621679057308"><span class="hs-identifier hs-var">pri</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-124"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621679057309"><span class="hs-identifier hs-var">faccode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621679057310"><span class="hs-identifier hs-var">pricode</span></a><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-comment">{- | Options for 'openlog'. -}</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-keyword">data</span><span> </span><a name="Option"><a href="System.Log.Handler.Syslog.html#Option"><span class="hs-identifier">Option</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PID"><a href="System.Log.Handler.Syslog.html#PID"><span class="hs-identifier">PID</span></a></a><span>                       </span><span class="hs-comment">-- ^ Automatically log process ID (PID) with each message</span><span>
</span><a name="line-129"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="PERROR"><a href="System.Log.Handler.Syslog.html#PERROR"><span class="hs-identifier">PERROR</span></a></a><span>                    </span><span class="hs-comment">-- ^ Send a copy of each message to stderr</span><span>
</span><a name="line-130"></a><span>            </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Read</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-keyword">data</span><span> </span><a name="SyslogHandler"><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier">SyslogHandler</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SyslogHandler"><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier">SyslogHandler</span></a></a><span> </span><span class="hs-special">{</span><a name="options"><a href="System.Log.Handler.Syslog.html#options"><span class="hs-identifier">options</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="System.Log.Handler.Syslog.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-133"></a><span>                                    </span><a name="facility"><a href="System.Log.Handler.Syslog.html#facility"><span class="hs-identifier">facility</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier hs-type">Facility</span></a><span class="hs-special">,</span><span>
</span><a name="line-134"></a><span>                                    </span><a name="identity"><a href="System.Log.Handler.Syslog.html#identity"><span class="hs-identifier">identity</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span>
</span><a name="line-135"></a><span>                                    </span><a name="logsocket"><a href="System.Log.Handler.Syslog.html#logsocket"><span class="hs-identifier">logsocket</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Socket</span><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>                                    </span><a name="address"><a href="System.Log.Handler.Syslog.html#address"><span class="hs-identifier">address</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SockAddr</span><span class="hs-special">,</span><span>
</span><a name="line-137"></a><span>                                    </span><a name="sock_type"><a href="System.Log.Handler.Syslog.html#sock_type"><span class="hs-identifier">sock_type</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SocketType</span><span class="hs-special">,</span><span>
</span><a name="line-138"></a><span>                                    </span><a name="priority"><a href="System.Log.Handler.Syslog.html#priority"><span class="hs-identifier">priority</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span class="hs-special">,</span><span>
</span><a name="line-139"></a><span>                                    </span><a name="formatter"><a href="System.Log.Handler.Syslog.html#formatter"><span class="hs-identifier">formatter</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Log.Formatter.html#LogFormatter"><span class="hs-identifier hs-type">LogFormatter</span></a><span> </span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-type">SyslogHandler</span></a><span>
</span><a name="line-140"></a><span>                                   </span><span class="hs-special">}</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">{- | Initialize the Syslog system using the local system's default interface,
\/dev\/log.  Will return a new 'System.Log.Handler.LogHandler'.

On Windows, instead of using \/dev\/log, this will attempt to send
UDP messages to something listening on the syslog port (514) on localhost.

Use 'openlog_remote' if you need more control.
-}</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-identifier">openlog</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>                       </span><span class="hs-comment">-- ^ The name of this program -- will be prepended to every log message</span><span>
</span><a name="line-152"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="System.Log.Handler.Syslog.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>                     </span><span class="hs-comment">-- ^ A list of 'Option's.  The list [] is perfectly valid.  ['PID'] is probably most common here.</span><span>
</span><a name="line-153"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier hs-type">Facility</span></a><span>                     </span><span class="hs-comment">-- ^ The 'Facility' value to pass to the syslog system for every message logged</span><span>
</span><a name="line-154"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span>                     </span><span class="hs-comment">-- ^ Messages logged below this priority will be ignored.  To include every message, set this to 'DEBUG'.</span><span>
</span><a name="line-155"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-type">SyslogHandler</span></a><span>             </span><span class="hs-comment">-- ^ Returns the new handler</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-cpp">#ifdef mingw32_HOST_OS
</span><span class="hs-identifier">openlog</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">openlog_remote</span><span> </span><span class="hs-identifier">AF_INET</span><span> </span><span class="hs-string">&quot;localhost&quot;</span><span> </span><span class="hs-number">514</span><span>
</span><a name="line-159"></a><span class="hs-cpp">#elif darwin_HOST_OS
</span><span class="hs-identifier">openlog</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">openlog_local</span><span> </span><span class="hs-string">&quot;/var/run/syslog&quot;</span><span>
</span><a name="line-161"></a><span class="hs-cpp">#else
</span><a name="openlog"><a href="System.Log.Handler.Syslog.html#openlog"><span class="hs-identifier">openlog</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Log.Handler.Syslog.html#openlog_local"><span class="hs-identifier hs-var">openlog_local</span></a><span> </span><span class="hs-string">&quot;/dev/log&quot;</span><span>
</span><a name="line-163"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-165"></a><span class="hs-comment">{- | Initialize the Syslog system using an arbitrary Unix socket (FIFO).

Not supported under Windows.
-}</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-cpp">#ifndef mingw32_HOST_OS
</span><span class="hs-identifier">openlog_local</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>                 </span><span class="hs-comment">-- ^ Path to FIFO</span><span>
</span><a name="line-172"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                 </span><span class="hs-comment">-- ^ Program name</span><span>
</span><a name="line-173"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="System.Log.Handler.Syslog.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- ^ 'Option's</span><span>
</span><a name="line-174"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier hs-type">Facility</span></a><span>               </span><span class="hs-comment">-- ^ Facility value</span><span>
</span><a name="line-175"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span>               </span><span class="hs-comment">-- ^ Priority limit</span><span>
</span><a name="line-176"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-type">SyslogHandler</span></a><span>
</span><a name="line-177"></a><a name="openlog_local"><a href="System.Log.Handler.Syslog.html#openlog_local"><span class="hs-identifier">openlog_local</span></a></a><span> </span><a name="local-6989586621679057311"><a href="#local-6989586621679057311"><span class="hs-identifier">fifopath</span></a></a><span> </span><a name="local-6989586621679057312"><a href="#local-6989586621679057312"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679057313"><a href="#local-6989586621679057313"><span class="hs-identifier">options</span></a></a><span> </span><a name="local-6989586621679057314"><a href="#local-6989586621679057314"><span class="hs-identifier">fac</span></a></a><span> </span><a name="local-6989586621679057315"><a href="#local-6989586621679057315"><span class="hs-identifier">pri</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679057325"><a href="#local-6989586621679057325"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679057326"><a href="#local-6989586621679057326"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- &quot;/dev/log&quot; is usually Datagram,</span><span>
</span><a name="line-179"></a><span>                    </span><span class="hs-comment">-- but most of syslog loggers allow it to be</span><span>
</span><a name="line-180"></a><span>                    </span><span class="hs-comment">-- of Stream type. glibc's&quot; openlog()&quot;</span><span>
</span><a name="line-181"></a><span>                    </span><span class="hs-comment">-- does roughly the similar thing:</span><span>
</span><a name="line-182"></a><span>                    </span><span class="hs-comment">--     http://www.gnu.org/software/libc/manual/html_node/openlog.html</span><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span>                    </span><a name="local-6989586621679057324"><a href="#local-6989586621679057324"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">socket</span><span> </span><span class="hs-identifier hs-var">AF_UNIX</span><span> </span><span class="hs-identifier hs-var">Stream</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-185"></a><span>                    </span><a href="#local-6989586621679057317"><span class="hs-identifier hs-var">tryStream</span></a><span> </span><a href="#local-6989586621679057324"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">E.catch</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679057316"><span class="hs-identifier hs-var">onIOException</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679057318"><span class="hs-identifier hs-var">fallbackToDgram</span></a><span> </span><a href="#local-6989586621679057324"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>       </span><a href="System.Log.Handler.Syslog.html#openlog_generic"><span class="hs-identifier hs-var">openlog_generic</span></a><span> </span><a href="#local-6989586621679057325"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SockAddrUnix</span><span> </span><a href="#local-6989586621679057311"><span class="hs-identifier hs-var">fifopath</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679057326"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679057312"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679057313"><span class="hs-identifier hs-var">options</span></a><span> </span><a href="#local-6989586621679057314"><span class="hs-identifier hs-var">fac</span></a><span> </span><a href="#local-6989586621679057315"><span class="hs-identifier hs-var">pri</span></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">onIOException</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679057319"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">E.IOException</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679057319"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-189"></a><span>        </span><a name="local-6989586621679057316"><a href="#local-6989586621679057316"><span class="hs-identifier">onIOException</span></a></a><span> </span><a name="local-6989586621679057320"><a href="#local-6989586621679057320"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057320"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>        </span><span class="hs-identifier">tryStream</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Socket</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Socket</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SocketType</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>        </span><a name="local-6989586621679057317"><a href="#local-6989586621679057317"><span class="hs-identifier">tryStream</span></a></a><span> </span><a name="local-6989586621679057321"><a href="#local-6989586621679057321"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-193"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">connect</span><span> </span><a href="#local-6989586621679057321"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SockAddrUnix</span><span> </span><a href="#local-6989586621679057311"><span class="hs-identifier hs-var">fifopath</span></a><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679057321"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Stream</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span>        </span><span class="hs-identifier">fallbackToDgram</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Socket</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Socket</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SocketType</span><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>        </span><a name="local-6989586621679057318"><a href="#local-6989586621679057318"><span class="hs-identifier">fallbackToDgram</span></a></a><span> </span><a name="local-6989586621679057322"><a href="#local-6989586621679057322"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-198"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">S.sClose</span><span> </span><a href="#local-6989586621679057322"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-comment">-- close Stream variant</span><span>
</span><a name="line-199"></a><span>               </span><a name="local-6989586621679057323"><a href="#local-6989586621679057323"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">socket</span><span> </span><span class="hs-identifier hs-var">AF_UNIX</span><span> </span><span class="hs-identifier hs-var">Datagram</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-200"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679057323"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Datagram</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-203"></a><span class="hs-comment">{- | Log to a remote server via UDP. -}</span><span>
</span><a name="line-204"></a><span class="hs-identifier">openlog_remote</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Family</span><span>                </span><span class="hs-comment">-- ^ Usually AF_INET or AF_INET6; see Network.Socket</span><span>
</span><a name="line-205"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HostName</span><span>              </span><span class="hs-comment">-- ^ Remote hostname.  Some use @localhost@</span><span>
</span><a name="line-206"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PortNumber</span><span>            </span><span class="hs-comment">-- ^ 514 is the default for syslog</span><span>
</span><a name="line-207"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                </span><span class="hs-comment">-- ^ Program name</span><span>
</span><a name="line-208"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="System.Log.Handler.Syslog.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- ^ 'Option's</span><span>
</span><a name="line-209"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier hs-type">Facility</span></a><span>              </span><span class="hs-comment">-- ^ Facility value</span><span>
</span><a name="line-210"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span>              </span><span class="hs-comment">-- ^ Priority limit</span><span>
</span><a name="line-211"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-type">SyslogHandler</span></a><span>
</span><a name="line-212"></a><a name="openlog_remote"><a href="System.Log.Handler.Syslog.html#openlog_remote"><span class="hs-identifier">openlog_remote</span></a></a><span> </span><a name="local-6989586621679057327"><a href="#local-6989586621679057327"><span class="hs-identifier">fam</span></a></a><span> </span><a name="local-6989586621679057328"><a href="#local-6989586621679057328"><span class="hs-identifier">hostname</span></a></a><span> </span><a name="local-6989586621679057329"><a href="#local-6989586621679057329"><span class="hs-identifier">port</span></a></a><span> </span><a name="local-6989586621679057330"><a href="#local-6989586621679057330"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679057331"><a href="#local-6989586621679057331"><span class="hs-identifier">options</span></a></a><span> </span><a name="local-6989586621679057332"><a href="#local-6989586621679057332"><span class="hs-identifier">fac</span></a></a><span> </span><a name="local-6989586621679057333"><a href="#local-6989586621679057333"><span class="hs-identifier">pri</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-214"></a><span>    </span><a name="local-6989586621679057334"><a href="#local-6989586621679057334"><span class="hs-identifier">he</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getHostByName</span><span> </span><a href="#local-6989586621679057328"><span class="hs-identifier hs-var">hostname</span></a><span>
</span><a name="line-215"></a><span>    </span><a name="local-6989586621679057335"><a href="#local-6989586621679057335"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">socket</span><span> </span><a href="#local-6989586621679057327"><span class="hs-identifier hs-var">fam</span></a><span> </span><span class="hs-identifier hs-var">Datagram</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-216"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679057336"><a href="#local-6989586621679057336"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SockAddrInet</span><span> </span><a href="#local-6989586621679057329"><span class="hs-identifier hs-var">port</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hostAddresses</span><span> </span><a href="#local-6989586621679057334"><span class="hs-identifier hs-var">he</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>    </span><a href="System.Log.Handler.Syslog.html#openlog_generic"><span class="hs-identifier hs-var">openlog_generic</span></a><span> </span><a href="#local-6989586621679057335"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679057336"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-identifier hs-var">Datagram</span><span> </span><a href="#local-6989586621679057330"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679057331"><span class="hs-identifier hs-var">options</span></a><span> </span><a href="#local-6989586621679057332"><span class="hs-identifier hs-var">fac</span></a><span> </span><a href="#local-6989586621679057333"><span class="hs-identifier hs-var">pri</span></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">{- | The most powerful initialization mechanism.  Takes an open datagram
socket. -}</span><span>
</span><a name="line-221"></a><span class="hs-identifier">openlog_generic</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Socket</span><span>               </span><span class="hs-comment">-- ^ A datagram socket</span><span>
</span><a name="line-222"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SockAddr</span><span>             </span><span class="hs-comment">-- ^ Address for transmissions</span><span>
</span><a name="line-223"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SocketType</span><span>           </span><span class="hs-comment">-- ^ socket connection mode (stream / datagram)</span><span>
</span><a name="line-224"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>               </span><span class="hs-comment">-- ^ Program name</span><span>
</span><a name="line-225"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="System.Log.Handler.Syslog.html#Option"><span class="hs-identifier hs-type">Option</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- ^ 'Option's</span><span>
</span><a name="line-226"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.Handler.Syslog.html#Facility"><span class="hs-identifier hs-type">Facility</span></a><span>             </span><span class="hs-comment">-- ^ Facility value</span><span>
</span><a name="line-227"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span>             </span><span class="hs-comment">-- ^ Priority limit</span><span>
</span><a name="line-228"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-type">SyslogHandler</span></a><span>
</span><a name="line-229"></a><a name="openlog_generic"><a href="System.Log.Handler.Syslog.html#openlog_generic"><span class="hs-identifier">openlog_generic</span></a></a><span> </span><a name="local-6989586621679057337"><a href="#local-6989586621679057337"><span class="hs-identifier">sock</span></a></a><span> </span><a name="local-6989586621679057338"><a href="#local-6989586621679057338"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621679057339"><a href="#local-6989586621679057339"><span class="hs-identifier">sock_t</span></a></a><span> </span><a name="local-6989586621679057340"><a href="#local-6989586621679057340"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679057341"><a href="#local-6989586621679057341"><span class="hs-identifier">opt</span></a></a><span> </span><a name="local-6989586621679057342"><a href="#local-6989586621679057342"><span class="hs-identifier">fac</span></a></a><span> </span><a name="local-6989586621679057343"><a href="#local-6989586621679057343"><span class="hs-identifier">pri</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-230"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-var">SyslogHandler</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">options</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057341"><span class="hs-identifier hs-var">opt</span></a><span class="hs-special">,</span><span>
</span><a name="line-231"></a><span>                            </span><span class="hs-identifier">facility</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057342"><span class="hs-identifier hs-var">fac</span></a><span class="hs-special">,</span><span>
</span><a name="line-232"></a><span>                            </span><span class="hs-identifier">identity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057340"><span class="hs-identifier hs-var">ident</span></a><span class="hs-special">,</span><span>
</span><a name="line-233"></a><span>                            </span><span class="hs-identifier">logsocket</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057337"><span class="hs-identifier hs-var">sock</span></a><span class="hs-special">,</span><span>
</span><a name="line-234"></a><span>                            </span><span class="hs-identifier">address</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057338"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">,</span><span>
</span><a name="line-235"></a><span>                            </span><span class="hs-identifier">sock_type</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057339"><span class="hs-identifier hs-var">sock_t</span></a><span class="hs-special">,</span><span>
</span><a name="line-236"></a><span>                            </span><span class="hs-identifier">priority</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057343"><span class="hs-identifier hs-var">pri</span></a><span class="hs-special">,</span><span>
</span><a name="line-237"></a><span>                            </span><span class="hs-identifier">formatter</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Log.Handler.Syslog.html#syslogFormatter"><span class="hs-identifier hs-var">syslogFormatter</span></a><span>
</span><a name="line-238"></a><span>                          </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-identifier">syslogFormatter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Log.Formatter.html#LogFormatter"><span class="hs-identifier hs-type">LogFormatter</span></a><span> </span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-type">SyslogHandler</span></a><span>
</span><a name="line-241"></a><a name="syslogFormatter"><a href="System.Log.Handler.Syslog.html#syslogFormatter"><span class="hs-identifier">syslogFormatter</span></a></a><span> </span><a name="local-6989586621679057344"><a href="#local-6989586621679057344"><span class="hs-identifier">sh</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679057345"><a href="#local-6989586621679057345"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679057346"><a href="#local-6989586621679057346"><span class="hs-identifier">msg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679057347"><a href="#local-6989586621679057347"><span class="hs-identifier">logname</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-242"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679057348"><a href="#local-6989586621679057348"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;[$loggername/$prio] $msg&quot;</span><span>
</span><a name="line-243"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="System.Log.Formatter.html#varFormatter"><span class="hs-identifier hs-var">varFormatter</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679057348"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621679057344"><span class="hs-identifier hs-var">sh</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679057345"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679057346"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679057347"><span class="hs-identifier hs-var">logname</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-keyword">instance</span><span> </span><a href="System.Log.Handler.html#LogHandler"><span class="hs-identifier hs-type">LogHandler</span></a><span> </span><a href="System.Log.Handler.Syslog.html#SyslogHandler"><span class="hs-identifier hs-type">SyslogHandler</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-247"></a><span>    </span><a name="local-8214565720323813868"><a href="System.Log.Handler.html#setLevel"><span class="hs-identifier">setLevel</span></a></a><span> </span><a name="local-6989586621679057283"><a href="#local-6989586621679057283"><span class="hs-identifier">sh</span></a></a><span> </span><a name="local-6989586621679057284"><a href="#local-6989586621679057284"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057283"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">{</span><span class="hs-identifier">priority</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057284"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">}</span><span>
</span><a name="line-248"></a><span>    </span><a name="local-8214565720323813869"><a href="System.Log.Handler.html#getLevel"><span class="hs-identifier">getLevel</span></a></a><span> </span><a name="local-6989586621679057285"><a href="#local-6989586621679057285"><span class="hs-identifier">sh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">priority</span><span> </span><a href="#local-6989586621679057285"><span class="hs-identifier hs-var">sh</span></a><span>
</span><a name="line-249"></a><span>    </span><a name="local-8214565720323813870"><a href="System.Log.Handler.html#setFormatter"><span class="hs-identifier">setFormatter</span></a></a><span> </span><a name="local-6989586621679057286"><a href="#local-6989586621679057286"><span class="hs-identifier">sh</span></a></a><span> </span><a name="local-6989586621679057287"><a href="#local-6989586621679057287"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057286"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">{</span><span class="hs-identifier">formatter</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057287"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">}</span><span>
</span><a name="line-250"></a><span>    </span><a name="local-8214565720323813871"><a href="System.Log.Handler.html#getFormatter"><span class="hs-identifier">getFormatter</span></a></a><span> </span><a name="local-6989586621679057288"><a href="#local-6989586621679057288"><span class="hs-identifier">sh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">formatter</span><span> </span><a href="#local-6989586621679057288"><span class="hs-identifier hs-var">sh</span></a><span>
</span><a name="line-251"></a><span>    </span><a name="local-8214565720323813873"><a href="System.Log.Handler.html#emit"><span class="hs-identifier">emit</span></a></a><span> </span><a name="local-6989586621679057289"><a href="#local-6989586621679057289"><span class="hs-identifier">sh</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679057290"><a href="#local-6989586621679057290"><span class="hs-identifier">prio</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679057291"><a href="#local-6989586621679057291"><span class="hs-identifier">msg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-252"></a><span>      </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">elem</span><span> </span><a href="System.Log.Handler.Syslog.html#PERROR"><span class="hs-identifier hs-var">PERROR</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">options</span><span> </span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hPutStrLn</span><span> </span><span class="hs-identifier hs-var">stderr</span><span> </span><a href="#local-6989586621679057291"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>      </span><a name="local-6989586621679057303"><a href="#local-6989586621679057303"><span class="hs-identifier">pidPart</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679057296"><span class="hs-identifier hs-var">getPidPart</span></a><span>
</span><a name="line-254"></a><span>      </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679057292"><span class="hs-identifier hs-var">sendstr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679057293"><span class="hs-identifier hs-var">toSyslogFormat</span></a><span> </span><a href="#local-6989586621679057291"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679057303"><span class="hs-identifier hs-var">pidPart</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-256"></a><span>        </span><span class="hs-identifier">sendstr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-257"></a><span>        </span><a name="local-6989586621679057292"><a href="#local-6989586621679057292"><span class="hs-identifier">sendstr</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-258"></a><span>        </span><span class="hs-identifier">sendstr</span><span> </span><a name="local-6989586621679057298"><a href="#local-6989586621679057298"><span class="hs-identifier">omsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-259"></a><span>          </span><a name="local-6989586621679057299"><a href="#local-6989586621679057299"><span class="hs-identifier">sent</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">sock_type</span><span> </span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">sh</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-260"></a><span>                    </span><span class="hs-identifier hs-var">Datagram</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sendTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">logsocket</span><span> </span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679057298"><span class="hs-identifier hs-var">omsg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">address</span><span> </span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>                    </span><span class="hs-identifier hs-var">Stream</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">send</span><span>   </span><span class="hs-special">(</span><span class="hs-identifier">logsocket</span><span> </span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679057298"><span class="hs-identifier hs-var">omsg</span></a><span>
</span><a name="line-262"></a><span>          </span><a href="#local-6989586621679057292"><span class="hs-identifier hs-var">sendstr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericDrop</span><span> </span><a href="#local-6989586621679057299"><span class="hs-identifier hs-var">sent</span></a><span> </span><a href="#local-6989586621679057298"><span class="hs-identifier hs-var">omsg</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>        </span><a name="local-6989586621679057293"><a href="#local-6989586621679057293"><span class="hs-identifier">toSyslogFormat</span></a></a><span> </span><a name="local-6989586621679057300"><a href="#local-6989586621679057300"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679057301"><a href="#local-6989586621679057301"><span class="hs-identifier">pidPart</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-264"></a><span>            </span><span class="hs-string">&quot;&lt;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679057294"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;&gt;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679057295"><span class="hs-identifier hs-var">identity'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679057301"><span class="hs-identifier hs-var">pidPart</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679057300"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\0&quot;</span><span>
</span><a name="line-265"></a><span>        </span><a name="local-6989586621679057294"><a href="#local-6989586621679057294"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Log.Handler.Syslog.html#makeCode"><span class="hs-identifier hs-var">makeCode</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">facility</span><span> </span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679057290"><span class="hs-identifier hs-var">prio</span></a><span>
</span><a name="line-266"></a><span>        </span><a name="local-6989586621679057295"><a href="#local-6989586621679057295"><span class="hs-identifier">identity'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">identity</span><span> </span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">sh</span></a><span>
</span><a name="line-267"></a><span>        </span><a name="local-6989586621679057296"><a href="#local-6989586621679057296"><span class="hs-identifier">getPidPart</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">elem</span><span> </span><a href="System.Log.Handler.Syslog.html#PID"><span class="hs-identifier hs-var">PID</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">options</span><span> </span><a href="#local-6989586621679057289"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679057297"><span class="hs-identifier hs-var">getPid</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679057302"><a href="#local-6989586621679057302"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;[&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679057302"><span class="hs-identifier hs-var">pid</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;]&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-269"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-270"></a><span>        </span><span class="hs-identifier">getPid</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-271"></a><span>        </span><a name="local-6989586621679057297"><a href="#local-6989586621679057297"><span class="hs-identifier">getPid</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-272"></a><span class="hs-cpp">#ifndef mingw32_HOST_OS
</span><span>          </span><span class="hs-identifier hs-var">getProcessID</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span>
</span><a name="line-274"></a><span class="hs-cpp">#else
</span><span>          </span><span class="hs-identifier">return</span><span> </span><span class="hs-string">&quot;windows&quot;</span><span>
</span><a name="line-276"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-278"></a><span>    </span><a name="local-8214565720323813874"><a href="System.Log.Handler.html#close"><span class="hs-identifier">close</span></a></a><span> </span><a name="local-6989586621679057304"><a href="#local-6989586621679057304"><span class="hs-identifier">sh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sClose</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">logsocket</span><span> </span><a href="#local-6989586621679057304"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a></pre></body></html>