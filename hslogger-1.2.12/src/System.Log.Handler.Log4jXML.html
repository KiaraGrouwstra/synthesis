<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{- |
   Module     : System.Log.Handler.Log4jXML
   Copyright  : Copyright (C) 2007-2011 John Goerzen
   License    : BSD3

   Maintainer : bjorn.buckwalter@gmail.com
   Stability  : experimental
   Portability: GHC only?

log4j[1] XMLLayout log handlers.

Written by Bjorn Buckwalter, bjorn.buckwalter\@gmail.com
-}</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Log.Handler.Log4jXML</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>    </span><span class="hs-comment">-- * Introduction</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-comment">{- | This module provides handlers for hslogger that are
    compatible with log4j's XMLLayout. In particular log messages
    created by the handlers can be published directly to the GUI-based
    log viewer Chainsaw v2[2].

    The set of log levels in hslogger is richer than the basic set
    of log4j levels. Two sets of handlers are provided with hslogger4j,
    one which produces logs with hslogger's levels and one which
    \&quot;demotes\&quot; them to the basic log4j levels. If full hslogger
    levels are used some Java installation (see below) is necessary
    to make Chainsaw aware of them.

    Usage of the handlers in hslogger4j is analoguous to usage of
    the 'System.Log.Handler.Simple.StreamHandler' and
    'System.Log.Handler.Simple.FileHandler' in &quot;System.Log.Handler.Simple&quot;.
    The following handlers are provided: -}</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>    </span><span class="hs-comment">-- ** Handlers with hslogger levels </span><span>
</span><a name="line-39"></a><span>    </span><a href="System.Log.Handler.Log4jXML.html#log4jStreamHandler"><span class="hs-identifier hs-var">log4jStreamHandler</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><a href="System.Log.Handler.Log4jXML.html#log4jFileHandler"><span class="hs-identifier hs-var">log4jFileHandler</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-comment">-- ** Handlers with log4j levels</span><span>
</span><a name="line-43"></a><span>    </span><a href="System.Log.Handler.Log4jXML.html#log4jStreamHandler%27"><span class="hs-identifier hs-var">log4jStreamHandler'</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>    </span><a href="System.Log.Handler.Log4jXML.html#log4jFileHandler%27"><span class="hs-identifier hs-var">log4jFileHandler'</span></a><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>    </span><span class="hs-comment">-- * Java install process</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-comment">{- | This is only necessary if you want to use the hslogger levels.

    Add @hslogger4j.jar@ from @contrib\/java@ to your classpath.
    To use you will also need to have the jars @log4j-1.3alpha-7.jar@
    and @log4j-xml-1.3alpha-7.jar@ that are distributed with Chainsaw
    on your classpath.

    (On Mac OS X I added all three jars to @~\/Library\/Java\/Extensions@.
    It seems that it is not sufficient that Chainsaw already includes
    its jars in the classpath when launching - perhaps the plugin
    classloader does not inherit Chainsaw's classpath. Adding the
    jars to @~\/.chainsaw\/plugins@ wouldn't work either.)

    If for whatever reason you have to rebuild the hslogger4j jar
    just run @ant@[3] in the @contrib\/java@ directory. The new jar
    will be created in the @contrib\/java\/dist@ directory. The Java
    source code is copyright The Apache Software Foundation and
    licensed under the Apache Licence version 2.0. -}</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span>    </span><span class="hs-comment">-- * Chainsaw setup</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span>    </span><span class="hs-comment">{- | If you are only using the basic log4j levels just use
    Chainsaw's regular facilities to browse logs or listen for log
    messages (e.g. @XMLSocketReceiver@).

    If you want to use the hslogger levels the easiest way to set
    up Chainsaw is to load the plugins in @hslogger4j-plugins.xml@
    in @contrib\/java@ when launching Chainsaw. Two receivers will
    be defined, one that listens for logmessages and one for reading
    log files.  Edit the properties of those receivers as needed
    (e.g. @port@, @fileURL@) and restart them. You will also want
    to modify Chainsaw's formatting preferences to display levels
    as text instead of icons. -}</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-comment">-- * Example usage</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>    </span><span class="hs-comment">{- | In the IO monad:

    &gt; lh2 &lt;- log4jFileHandler &quot;log.xml&quot; DEBUG
    &gt; updateGlobalLogger rootLoggerName (addHandler lh2)

    &gt; h  &lt;- connectTo &quot;localhost&quot; (PortNumber 4448)
    &gt; lh &lt;- log4jStreamHandler h NOTICE
    &gt; updateGlobalLogger rootLoggerName (addHandler lh)
    -}</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>    </span><span class="hs-comment">-- * References</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span>    </span><span class="hs-comment">{- |
    (1) &lt;http://logging.apache.org/log4j/&gt;

    (2) &lt;http://logging.apache.org/chainsaw/&gt;

    (3) &lt;http://ant.apache.org/&gt;
    -}</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Concurrent</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ThreadId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">myThreadId</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- myThreadId is GHC only!</span><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Concurrent.MVar</span><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO</span><span>
</span><a name="line-113"></a><span class="hs-cpp">#if MIN_VERSION_time(1,5,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Time.Format</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">defaultTimeLocale</span><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span class="hs-cpp">#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Locale</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">defaultTimeLocale</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span class="hs-cpp">#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Time</span><span>
</span><a name="line-119"></a><span class="hs-keyword">import</span><span> </span><a href="System.Log.html"><span class="hs-identifier">System.Log</span></a><span>
</span><a name="line-120"></a><span class="hs-keyword">import</span><span> </span><a href="System.Log.Handler.html"><span class="hs-identifier">System.Log.Handler</span></a><span>
</span><a name="line-121"></a><span class="hs-keyword">import</span><span> </span><a href="System.Log.Handler.Simple.html"><span class="hs-identifier">System.Log.Handler.Simple</span></a><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Simple.html#streamHandler"><span class="hs-identifier hs-var">streamHandler</span></a><span class="hs-special">,</span><span> </span><a href="System.Log.Handler.Simple.html#GenericHandler"><span class="hs-identifier hs-type">GenericHandler</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">-- Handler that logs to a handle rendering message priorities according</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- to the supplied function.</span><span>
</span><a name="line-126"></a><span class="hs-identifier">log4jHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Simple.html#GenericHandler"><span class="hs-identifier hs-type">GenericHandler</span></a><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><a name="log4jHandler"><a href="System.Log.Handler.Log4jXML.html#log4jHandler"><span class="hs-identifier">log4jHandler</span></a></a><span> </span><a name="local-6989586621679055830"><a href="#local-6989586621679055830"><span class="hs-identifier">showPrio</span></a></a><span> </span><a name="local-6989586621679055831"><a href="#local-6989586621679055831"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679055832"><a href="#local-6989586621679055832"><span class="hs-identifier">pri</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-128"></a><span>    </span><a name="local-6989586621679055842"><a href="#local-6989586621679055842"><span class="hs-identifier">hndlr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Log.Handler.Simple.html#streamHandler"><span class="hs-identifier hs-var">streamHandler</span></a><span> </span><a href="#local-6989586621679055831"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679055832"><span class="hs-identifier hs-var">pri</span></a><span>
</span><a name="line-129"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Log.Handler.html#setFormatter"><span class="hs-identifier hs-var">setFormatter</span></a><span> </span><a href="#local-6989586621679055842"><span class="hs-identifier hs-var">hndlr</span></a><span> </span><a href="#local-6989586621679055833"><span class="hs-identifier hs-var">xmlFormatter</span></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-132"></a><span>        </span><span class="hs-comment">-- A Log Formatter that creates an XML element representing a log4j event/message.</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-identifier">xmlFormatter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679055834"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-134"></a><span>        </span><a name="local-6989586621679055833"><a href="#local-6989586621679055833"><span class="hs-identifier">xmlFormatter</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679055835"><a href="#local-6989586621679055835"><span class="hs-identifier">prio</span></a></a><span class="hs-special">,</span><a name="local-6989586621679055836"><a href="#local-6989586621679055836"><span class="hs-identifier">msg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679055837"><a href="#local-6989586621679055837"><span class="hs-identifier">logger</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-135"></a><span>              </span><a name="local-6989586621679055840"><a href="#local-6989586621679055840"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getCurrentTime</span><span>
</span><a name="line-136"></a><span>              </span><a name="local-6989586621679055841"><a href="#local-6989586621679055841"><span class="hs-identifier">thread</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">myThreadId</span><span>
</span><a name="line-137"></a><span>              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Log.Handler.Log4jXML.html#Elem"><span class="hs-identifier hs-var">Elem</span></a><span> </span><span class="hs-string">&quot;log4j:event&quot;</span><span>
</span><a name="line-138"></a><span>                         </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;logger&quot;</span><span>   </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055837"><span class="hs-identifier hs-var">logger</span></a><span>       </span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;timestamp&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055838"><span class="hs-identifier hs-var">millis</span></a><span> </span><a href="#local-6989586621679055840"><span class="hs-identifier hs-var">time</span></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;level&quot;</span><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679055830"><span class="hs-identifier hs-var">showPrio</span></a><span> </span><a href="#local-6989586621679055835"><span class="hs-identifier hs-var">prio</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;thread&quot;</span><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679055841"><span class="hs-identifier hs-var">thread</span></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>                         </span><span class="hs-special">]</span><span>
</span><a name="line-143"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Log.Handler.Log4jXML.html#Elem"><span class="hs-identifier hs-var">Elem</span></a><span> </span><span class="hs-string">&quot;log4j:message&quot;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Log.Handler.Log4jXML.html#CDATA"><span class="hs-identifier hs-var">CDATA</span></a><span> </span><a href="#local-6989586621679055836"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-145"></a><span>                </span><span class="hs-comment">-- This is an ugly hack to get a unix epoch with milliseconds.</span><span>
</span><a name="line-146"></a><span>                </span><span class="hs-comment">-- The use of &quot;take 3&quot; causes the milliseconds to always be</span><span>
</span><a name="line-147"></a><span>                </span><span class="hs-comment">-- rounded downwards, which I suppose may be the expected</span><span>
</span><a name="line-148"></a><span>                </span><span class="hs-comment">-- behaviour for time.</span><span>
</span><a name="line-149"></a><span>                </span><a name="local-6989586621679055838"><a href="#local-6989586621679055838"><span class="hs-identifier">millis</span></a></a><span> </span><a name="local-6989586621679055839"><a href="#local-6989586621679055839"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">formatTime</span><span> </span><span class="hs-identifier hs-var">defaultTimeLocale</span><span> </span><span class="hs-string">&quot;%s&quot;</span><span> </span><a href="#local-6989586621679055839"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-150"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">formatTime</span><span> </span><span class="hs-identifier hs-var">defaultTimeLocale</span><span> </span><span class="hs-string">&quot;%q&quot;</span><span> </span><a href="#local-6989586621679055839"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-comment">-- | Create a stream log handler that uses hslogger priorities.</span><span>
</span><a name="line-154"></a><span class="hs-identifier">log4jStreamHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Simple.html#GenericHandler"><span class="hs-identifier hs-type">GenericHandler</span></a><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-155"></a><a name="log4jStreamHandler"><a href="System.Log.Handler.Log4jXML.html#log4jStreamHandler"><span class="hs-identifier">log4jStreamHandler</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Log.Handler.Log4jXML.html#log4jHandler"><span class="hs-identifier hs-var">log4jHandler</span></a><span> </span><span class="hs-identifier hs-var">show</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">{- | Create a stream log handler that uses log4j levels (priorities). The
   priorities of messages are shoehorned into log4j levels as follows:

@
    DEBUG                  -&gt; DEBUG
    INFO, NOTICE           -&gt; INFO
    WARNING                -&gt; WARN
    ERROR, CRITICAL, ALERT -&gt; ERROR
    EMERGENCY              -&gt; FATAL
@

   This is useful when the log will only be consumed by log4j tools and
   you don't want to go out of your way transforming the log or configuring
   the tools. -}</span><span>
</span><a name="line-171"></a><span class="hs-identifier">log4jStreamHandler'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Simple.html#GenericHandler"><span class="hs-identifier hs-type">GenericHandler</span></a><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><a name="log4jStreamHandler%27"><a href="System.Log.Handler.Log4jXML.html#log4jStreamHandler%27"><span class="hs-identifier">log4jStreamHandler'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Log.Handler.Log4jXML.html#log4jHandler"><span class="hs-identifier hs-var">log4jHandler</span></a><span> </span><a href="#local-6989586621679055843"><span class="hs-identifier hs-var">show'</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-173"></a><span>    </span><span class="hs-identifier">show'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-174"></a><span>    </span><a name="local-6989586621679055843"><a href="#local-6989586621679055843"><span class="hs-identifier">show'</span></a></a><span> </span><a href="System.Log.html#NOTICE"><span class="hs-identifier hs-var">NOTICE</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;INFO&quot;</span><span>
</span><a name="line-175"></a><span>    </span><span class="hs-identifier">show'</span><span> </span><a href="System.Log.html#WARNING"><span class="hs-identifier hs-var">WARNING</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;WARN&quot;</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-identifier">show'</span><span> </span><a href="System.Log.html#CRITICAL"><span class="hs-identifier hs-var">CRITICAL</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ERROR&quot;</span><span>
</span><a name="line-177"></a><span>    </span><span class="hs-identifier">show'</span><span> </span><a href="System.Log.html#ALERT"><span class="hs-identifier hs-var">ALERT</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ERROR&quot;</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-identifier">show'</span><span> </span><a href="System.Log.html#EMERGENCY"><span class="hs-identifier hs-var">EMERGENCY</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;FATAL&quot;</span><span>
</span><a name="line-179"></a><span>    </span><span class="hs-identifier">show'</span><span> </span><a name="local-6989586621679055844"><a href="#local-6989586621679055844"><span class="hs-identifier">p</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679055844"><span class="hs-identifier hs-var">p</span></a><span>  </span><span class="hs-comment">-- Identical for DEBUG, INFO, ERROR.</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span class="hs-comment">-- | Create a file log handler that uses hslogger priorities.</span><span>
</span><a name="line-183"></a><span class="hs-identifier">log4jFileHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Simple.html#GenericHandler"><span class="hs-identifier hs-type">GenericHandler</span></a><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-184"></a><a name="log4jFileHandler"><a href="System.Log.Handler.Log4jXML.html#log4jFileHandler"><span class="hs-identifier">log4jFileHandler</span></a></a><span> </span><a name="local-6989586621679055845"><a href="#local-6989586621679055845"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679055846"><a href="#local-6989586621679055846"><span class="hs-identifier">pri</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-185"></a><span>                          </span><a name="local-6989586621679055847"><a href="#local-6989586621679055847"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">openFile</span><span> </span><a href="#local-6989586621679055845"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-identifier hs-var">AppendMode</span><span>
</span><a name="line-186"></a><span>                          </span><a name="local-6989586621679055848"><a href="#local-6989586621679055848"><span class="hs-identifier">sh</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Log.Handler.Log4jXML.html#log4jStreamHandler"><span class="hs-identifier hs-var">log4jStreamHandler</span></a><span> </span><a href="#local-6989586621679055847"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679055846"><span class="hs-identifier hs-var">pri</span></a><span>
</span><a name="line-187"></a><span>                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055848"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">{</span><span class="hs-identifier">closeFunc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hClose</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-comment">{- | Create a file log handler that uses log4j levels (see
   'log4jStreamHandler'' for mappings). -}</span><span>
</span><a name="line-191"></a><span class="hs-identifier">log4jFileHandler'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Log.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Simple.html#GenericHandler"><span class="hs-identifier hs-type">GenericHandler</span></a><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><a name="log4jFileHandler%27"><a href="System.Log.Handler.Log4jXML.html#log4jFileHandler%27"><span class="hs-identifier">log4jFileHandler'</span></a></a><span> </span><a name="local-6989586621679055849"><a href="#local-6989586621679055849"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679055850"><a href="#local-6989586621679055850"><span class="hs-identifier">pri</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-193"></a><span>                           </span><a name="local-6989586621679055851"><a href="#local-6989586621679055851"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">openFile</span><span> </span><a href="#local-6989586621679055849"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-identifier hs-var">AppendMode</span><span>
</span><a name="line-194"></a><span>                           </span><a name="local-6989586621679055852"><a href="#local-6989586621679055852"><span class="hs-identifier">sh</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Log.Handler.Log4jXML.html#log4jStreamHandler%27"><span class="hs-identifier hs-var">log4jStreamHandler'</span></a><span> </span><a href="#local-6989586621679055851"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679055850"><span class="hs-identifier hs-var">pri</span></a><span>
</span><a name="line-195"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055852"><span class="hs-identifier hs-var">sh</span></a><span class="hs-special">{</span><span class="hs-identifier">closeFunc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hClose</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- A type for building and showing XML elements. Could use a fancy XML</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- library but am reluctant to introduce dependencies.</span><span>
</span><a name="line-200"></a><span class="hs-keyword">data</span><span> </span><a name="XML"><a href="System.Log.Handler.Log4jXML.html#XML"><span class="hs-identifier">XML</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Elem"><a href="System.Log.Handler.Log4jXML.html#Elem"><span class="hs-identifier">Elem</span></a></a><span>  </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="System.Log.Handler.Log4jXML.html#XML"><span class="hs-identifier hs-type">XML</span></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a name="CDATA"><a href="System.Log.Handler.Log4jXML.html#CDATA"><span class="hs-identifier">CDATA</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="System.Log.Handler.Log4jXML.html#XML"><span class="hs-identifier hs-type">XML</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-204"></a><span>    </span><a name="local-8214565720323790323"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Log4jXML.html#CDATA"><span class="hs-identifier hs-var">CDATA</span></a><span> </span><a name="local-6989586621679055817"><a href="#local-6989586621679055817"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;![CDATA[&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055818"><span class="hs-identifier hs-var">escapeCDATA</span></a><span> </span><a href="#local-6989586621679055817"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;]]&gt;&quot;</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-205"></a><span>        </span><a name="local-6989586621679055818"><a href="#local-6989586621679055818"><span class="hs-identifier">escapeCDATA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Log.Handler.Log4jXML.html#replace"><span class="hs-identifier hs-var">replace</span></a><span> </span><span class="hs-string">&quot;]]&gt;&quot;</span><span> </span><span class="hs-string">&quot;]]&amp;lt;&quot;</span><span>  </span><span class="hs-comment">-- The best we can do, I guess.</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="System.Log.Handler.Log4jXML.html#Elem"><span class="hs-identifier hs-var">Elem</span></a><span> </span><a name="local-6989586621679055819"><a href="#local-6989586621679055819"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679055820"><a href="#local-6989586621679055820"><span class="hs-identifier">attrs</span></a></a><span> </span><a name="local-6989586621679055821"><a href="#local-6989586621679055821"><span class="hs-identifier">child</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055819"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055822"><span class="hs-identifier hs-var">showAttrs</span></a><span> </span><a href="#local-6989586621679055820"><span class="hs-identifier hs-var">attrs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055823"><span class="hs-identifier hs-var">showChild</span></a><span> </span><a href="#local-6989586621679055821"><span class="hs-identifier hs-var">child</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-207"></a><span>        </span><a name="local-6989586621679055822"><a href="#local-6989586621679055822"><span class="hs-identifier">showAttrs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-208"></a><span>        </span><span class="hs-identifier">showAttrs</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679055824"><a href="#local-6989586621679055824"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621679055825"><a href="#local-6989586621679055825"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055824"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;=\&quot;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055827"><span class="hs-identifier hs-var">escapeAttr</span></a><span> </span><a href="#local-6989586621679055825"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span>
</span><a name="line-209"></a><span>                             </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055822"><span class="hs-identifier hs-var">showAttrs</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-210"></a><span>            </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055827"><a href="#local-6989586621679055827"><span class="hs-identifier">escapeAttr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Log.Handler.Log4jXML.html#replace"><span class="hs-identifier hs-var">replace</span></a><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span> </span><span class="hs-string">&quot;&amp;quot;&quot;</span><span>
</span><a name="line-211"></a><span>                             </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.Log.Handler.Log4jXML.html#replace"><span class="hs-identifier hs-var">replace</span></a><span> </span><span class="hs-string">&quot;&lt;&quot;</span><span> </span><span class="hs-string">&quot;&amp;lt;&quot;</span><span>
</span><a name="line-212"></a><span>                             </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.Log.Handler.Log4jXML.html#replace"><span class="hs-identifier hs-var">replace</span></a><span> </span><span class="hs-string">&quot;&amp;&quot;</span><span> </span><span class="hs-string">&quot;&amp;amp;&quot;</span><span>
</span><a name="line-213"></a><span>        </span><a name="local-6989586621679055823"><a href="#local-6989586621679055823"><span class="hs-identifier">showChild</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;/&gt;&quot;</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-identifier">showChild</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055828"><a href="#local-6989586621679055828"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&gt;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679055828"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;&lt;/&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679055819"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;&gt;&quot;</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-comment">-- Replaces instances of first list by second list in third list.</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- Definition blatantly stoled from jethr0's comment at</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- http://bluebones.net/2007/01/replace-in-haskell/. Can be swapped</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- with definition (or import) from MissingH.</span><span>
</span><a name="line-221"></a><span class="hs-identifier">replace</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679055829"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055829"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055829"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055829"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679055829"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-222"></a><a name="replace"><a href="System.Log.Handler.Log4jXML.html#replace"><span class="hs-identifier">replace</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">[</span><span>       </span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-223"></a><span class="hs-identifier">replace</span><span> </span><a name="local-6989586621679055853"><a href="#local-6989586621679055853"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621679055854"><a href="#local-6989586621679055854"><span class="hs-identifier">to</span></a></a><span> </span><a name="local-6989586621679055855"><a href="#local-6989586621679055855"><span class="hs-identifier">xs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679055856"><a href="#local-6989586621679055856"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isPrefixOf</span><span> </span><a href="#local-6989586621679055853"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621679055855"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679055854"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679055853"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055855"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679055856"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="System.Log.Handler.Log4jXML.html#replace"><span class="hs-identifier hs-var">replace</span></a><span> </span><a href="#local-6989586621679055853"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621679055854"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a></pre></body></html>